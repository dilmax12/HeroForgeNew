{"version":3,"mappings":"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N,SAAU,EACZ,CACF,EACA,EAAG,CACD,CACE,KAAM,WACN,KAAM,aACN,YAAa,6BACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,WACN,KAAM,eACN,YAAa,mCACb,KAAM,IACN,SAAU,EACZ,CACF,EACA,EAAG,CACD,CACE,KAAM,SACN,KAAM,uBACN,YAAa,sCACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,WACN,KAAM,oBACN,YAAa,wCACb,KAAM,KACN,SAAU,EACZ,CACF,EACA,EAAG,CACD,CACE,KAAM,WACN,KAAM,gBACN,YAAa,mCACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,WACN,KAAM,kBACN,YAAa,gCACb,KAAM,KACN,SAAU,EACZ,CACF,EACA,EAAG,CACD,CACE,KAAM,SACN,KAAM,eACN,YAAa,mCACb,KAAM,IACN,SAAU,EACZ,EACA,CACE,KAAM,UACN,KAAM,qBACN,YAAa,kCACb,KAAM,KACN,SAAU,EACZ,CACF,EACA,EAAG,CACD,CACE,KAAM,WACN,KAAM,kBACN,YAAa,mCACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,UACN,KAAM,oBACN,YAAa,uCACb,KAAM,KACN,SAAU,EACZ,CACF,EACA,EAAG,CACD,CACE,KAAM,UACN,KAAM,sBACN,YAAa,mCACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,SACN,KAAM,kBACN,YAAa,iCACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,WACN,KAAM,eACN,YAAa,yCACb,KAAM,MACN,SAAU,EACZ,CACF,EACA,GAAI,CACF,CACE,KAAM,WACN,KAAM,uCACN,YAAa,4DACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,WACN,KAAM,sBACN,YAAa,iCACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,SACN,KAAM,cACN,YAAa,yBACb,KAAM,IACN,SAAU,EACZ,CACF,EACA,IAAK,CACH,CACE,KAAM,UACN,KAAM,mCACN,YAAa,mDACb,KAAM,KACN,SAAU,EACZ,EACA,CACE,KAAM,WACN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","names":["m","require$$0","client","createJSONStorage","getStorage","options","storage","name","_a","parse","str2","str","newValue","toThenable","fn","input","result","onFulfilled","_onRejected","e","_onFulfilled","onRejected","oldImpl","config","baseOptions","set","get","api","state","persistedState","currentState","hasHydrated","hydrationListeners","finishHydrationListeners","args","thenableSerialize","setItem","errorInSync","thenable","serializedValue","savedSetState","replace","configResult","stateFromStorage","hydrate","cb","postRehydrationCallback","storageValue","deserializedStorageValue","migratedState","_a2","newOptions","newImpl","_b","migrationResult","migrated","persistImpl","persist","getRandomValues","rnds8","rng","byteToHex","i","unsafeStringify","arr","offset","randomUUID","native","v4","buf","rnds","RANK_CONFIG","RANK_THRESHOLDS","RANK_ORDER","RANK_REWARDS","RANK_XP_BONUS_PERCENT","RANK_MISSION_PROFILE","QUEST_TEMPLATES","COMPANION_GUILD_TEMPLATES","LOCATIONS","NPCS","ITEMS","ARTIFACTS","THREATS","GUARDIANS","DIFFICULTY_MODIFIERS","getRandomElement","array","interpolateTemplate","template","variables","match","key","applyDifficultyModifier","baseReward","difficulty","modifier","generateEnemies","baseEnemies","enemy","generateQuest","heroLevel","isGuildQuest","_d","_c","questId","rewards","enemies","quest","loc","generateQuestBoard","guildLevel","heroRank","quests","profile","basicsMastered","raw","st","steps","hasTraining","preferBasicsOnly","qid","guildQuests","q","tuned","escortId","basicList","QUEST_ACHIEVEMENTS","DEFAULTS","useGameSettingsStore","create","updates","next","xpBuffPercent","trainingDiscountPercent","eventName","expiresAt","sourceGuildId","current","getGameSettings","clamp","v","min","max","computeTier","updateOnSocial","npc","player","mood","s","basePos","baseNeg","mem","historyBoost","timeBoost","delta","map","intensity","diminish","deltaScaled","newVal","tier","cascadeGlobalReputation","npcs","totalPos","f","percent","n","last","randomNpcNpcEvent","a","b","relA","relB","getBestRelationTier","hero","ids","vals","id","order","getShopDiscountPercent","best","getMissionBuffPercent","SHOP_ITEMS","SHOP_ITEMS_MAP","it","SHOP_CATEGORIES","item","RARITY_CONFIG","ITEM_SETS","canAfford","currency","prog","balance","price","getDiscountedPrice","purchaseItem","itemId","currencyName","newBalance","sellItem","quantity","currentQuantity","sellPrice","equipItem","hasItem","minLevel","allow","deny","inv","target","slotLabelMap","useConsumable","message","effects","currentHp","newHp","currentMp","newMp","currentFatigue","reduction","newFatigue","getDailyOffers","seed","acc","char","x","offers","availableItems","index","RANK_PRICE_DISCOUNT","RARITY_DISCOUNT_FACTOR","getReputationDiscount","reputation","reputationDiscount","rankLevel","rankDiscount","rarityFactor","relationDiscount","effectiveDiscount","basePrice","computeItemBasePrice","rarityKey","rarityMult","computed","generateProceduralItem","luck","bases","baseType","prefixes","suffixes","prefix","suffix","rarityRoll","rarity","sockets","elementOverride","bonus","getWeeklyMutatorEnemyElement","obj","el","getGlobalCritBonus","rawRelics","list","r","getEnemyDamageMultiplier","mult","getRareItemChanceBonus","dungeonConfig","isBossFloor","floor","isMiniBossFloor","computeRewardMultiplier","streak","getDifficultyParams","diff","ELEMENT_ADVANTAGES","ELEMENT_INFO","getElementAdvantageInfo","element","strong","weak","neutral","elem","data","currentElement","generateRandomElement","elements","getRecommendedElements","heroClass","calculateElementalAffinity","heroElement","skillElement","getElementInfoSafe","ELEMENT_ADV","computeElementMultiplier","atkElem","defElem","atkAffinity","defResistance","base","ENEMY_TEMPLATES","LOOT_TABLES","createEnemyFromTemplate","enemyType","level","levelMultiplier","heroToCombatEntity","resolveAttack","attacker","defender","opts","baseHit","hitChance","weaponAtk","baseDamage","critChance","isCrit","ramp","elemMult","effectiveArmor","enemyMult","finalDamage","weaponName","critText","elemText","generateLoot","lootTable","loot","dropRate","extra","chance","calculateXpReward","baseXp","levelDiff","multiplier","calculateGoldReward","resolveSkillUse","user","skill","targetElement","basePower","elementMultiplier","healing","targetDefense","dmg","healVal","effectTexts","ls","successRate","success","resolveCombat","combatLog","totalXp","totalGold","allLoot","heroEntity","activePet","p","petEnergy","petEnergyUsed","petCooldownLeft","petDamageTotal","petHealingTotal","petStunCount","heroElementOverride","heroElementOverrideTurns","petElementSet","questEnemy","enemyElement","enemyBurn","heroBurn","turn","enemyFled","maxTurns","heroFirst","siphon","oldDex","useSkill","stunned","atkSkill","skillRes","heroAttack","extraD","extraH","petStun","cost","icon","h","ov","enemyStunned","enemyAttack","leech","enemyLow","heroHealthy","fleeChance","xp","gold","coreItem","floorBias","partyBonus","ringBonus","_e","_f","bonusChance","eligibleTypes","rarityOrder","minIndex","pool","bonusItem","reducedXp","autoResolveCombat","totalPower","enemyPower","guildBonus","powerDiff","winChance","victory","narrative","enemyNames","baseBias","damage","Jewel","tipo","nivel","__publicField","out","RECIPES","getAvailableRecipes","rankOrder","heroRankIdx","reqIdx","inp","_ActivityManager","type","isPublic","activity","heroName","enemiesText","restLabel","recovered","spent","parts","effectText","itemLabel","petLabel","tr","sep","guildLabel","roll","critical","bet","opponent","filter","filteredActivities","heroId","limit","activityId","authorId","authorName","content","comment","shareUrl","shareText","activities","now","weekAgo","monthAgo","activitiesByType","activitiesByDay","day","mostActiveDay","daysToKeep","cutoffDate","initialCount","removedCount","error","saved","c","exportData","ActivityManager","activityManager","logActivity","_RankSystem","currentRank","rank","threshold","meetsXP","meetsMissions","meetsTitles","meetsSpecial","requirements","req","currentIndex","nextRank","nextThreshold","currentThreshold","xpProgress","missionProgress","progressPercentage","canPromote","currentRankData","progress","newRank","celebration","rankInfo","animationType","_rank","achievements","basePoints","missionBonus","levelBonus","titleBonus","achievementBonus","position","availableRewards","unlockedIds","reward","initialRank","rankPoints","newHistory","currentUnlocked","unlockedNames","newRewards","xpNeeded","missionsNeeded","daysForXP","estimatedDays","description","RankSystem","rankSystem","REPUTATION_LEVELS","FACTION_DESCRIPTIONS","getReputationLevel","updateHeroReputation","factionName","change","updatedFactions","faction","newReputation","factionInfo","opposingFaction","opposingIndex","calculateReputationModifiers","info","getReputationDescription","generateReputationEvents","events","inferQuestFactionChanges","text","changes","gb","rule","merged","mergedArray","LEADERBOARD_CONFIGS","value","sum","safeValue","generateLeaderboard","heroes","validEntries","rawValue","entry","generateAllLeaderboards","getHeroRanking","xpLeaderboard","lb","globalRank","sameClassHeroes","classRank","totalScore","calculateTotalScore","epicItems","decisions","getTopHeroes","leaderboard","count","getHeroesAroundRank","range","heroIndex","start","end","formatRankChange","getRankColor","getRankIcon","DAILY_GOAL_TEMPLATES","generateDailyGoals","availableTemplates","goals","tomorrow","easyTemplates","t","createDailyGoalFromTemplate","mediumTemplates","mediumCount","g","hardTemplates","perfectDayTemplate","perfectDayGoal","updateDailyGoalProgress","goalType","amount","goal","shouldUpdate","newProgress","checkPerfectDayGoal","completedOtherGoals","removeExpiredGoals","getDailyGoalRewards","bonusMultiplier","getDailyGoalCategoryIcon","goalId","getDailyGoalDifficultyColor","AVAILABLE_TITLES","TITLE_ACHIEVEMENTS","getTitlesByCategory","titles","category","title","getTitlesByRarity","getActiveTitle","formatTitleDisplay","activeTitle","updateAchievementProgress","achievement","unlocked","TITLE_PASSIVE_ATTRIBUTE_BONUSES","getTitleAttributeBonus","titleId","getRarityColor","getRarityBg","ONBOARDING_FLOWS","_OnboardingManager","flowId","flow","prereq","currentStep","moved","stepId","totalSteps","completedSteps","event","callback","callbacks","OnboardingManager","onboardingManager","DAILY_EVENT_TEMPLATES","WEEKLY_EVENT_TEMPLATES","_EventManager","nextDaily","nextWeekly","endOfDay","endOfWeek","shuffled","j","newDailyEvents","nextRotation","newWeeklyEvents","progressType","eventId","hours","minutes","dailyEvents","weeklyEvents","EventManager","eventManager","_MetricsManager","eventType","metric","params","endTime","duration","days","recentSessions","dailyUsers","weeklyUsers","monthlyUsers","totalDuration","averageSessionDuration","totalActions","averageActionsPerSession","heroCreationEvents","questEvents","xpEvents","goldEvents","classCount","mostPopularClass","questCount","questName","mostCompletedQuest","performanceEntries","engagement","gameplay","performance","totalUsers","activeUsers","levelUpEvents","levels","uniqueUsers","heroCreated","firstQuest","firstLevelUp","firstAchievement","_","date","dayStart","dayEnd","newUsers","daySessions","avgDuration","dayQuests","dayXp","renderMetrics","totalEvents","errorEvents","metricName","condition","alert","ratio","ruleId","alertId","MetricsManager","metricsManager","trackMetric","page","feature","productId","receiptId","placement","kpi","featureEvents","installs","purchases","themeSwitches","frameSwitches","body","url","blob","supabaseUrl","supabaseAnonKey","supabaseDisabled","supabaseConfigured","fetchWithRetry","init","retries","baseDelayMs","attempt","res","err","warnedOnce","createDisabledClient","errorPayload","builder","resolve","_cb","supabase","createClient","HERO_SCHEMA_VERSION","getStoredHeroVersion","storedData","sanitizeStoredHeroData","candidate","__schema_version","sanitized","saveHero","userId","nameValue","classValue","payload","listHeroesByUser","canPerformAction","actionType","performAction","NotificationItem","notification","onRemove","useEffect","timer","getNotificationStyle","getIcon","customIcon","jsx","jsxs","NotificationSystem","notifications","useNotifications","setNotifications","useState","addNotification","prev","source","newLevel","itemName","achievementName","NotificationBus","listener","ts","k","cap","notificationBus","CLASS_METADATA","attributes","computeSynergyBonus","meta","raceGood","elemGood","score","CLASS_SKILLS","getClassSkills","PROGRESSION_SKILLS","getNewSkillsForLevel","prevLevel","d","updateProgressDelta","heartbeatTimer","startPlaytimeHeartbeat","intervalMinutes","stopPlaytimeHeartbeat","ms","_WorldStateManager","rollModifiers","baseRoll","modifiers","attributeValue","choiceId","choiceText","successEffects","failureEffects","riskThreshold","rollResult","effectsToApply","reputationTargets","topTargets","appliedEffects","immediateImpact","longTermImpact","factionAlias","effect","targetName","logEntry","alias","minRep","mustBeAlive","npcData","worldState","avgReputation","tone","recentDecisions","factionSummary","currentValue","lastTs","minutesElapsed","wholeMinutes","settings","hpPerMin","mpPerMin","statsAny","restBuffUntil","inDungeon","meditationUntil","hpRegenAmount","mpRegenAmount","staminaCost","effective","mm","buff","mb","refine","mastery","masteryStep","baseCost","red","eff","dayKey","recover","nextFatigue","ws","WorldStateManager","worldStateManager","nowIso","maybeTriggerSpecialEvents","relVal","lastEv","daysMin","freqPerDay","rivalChance","progressLevels","tierIndex","shouldProgressEvent","msg","li","pick","seedPersonality","archetypes","chatStyles","traitsPool","pers","routine","improveAttributes","attrs","runTick","emit","hour","needs","fatigueHigh","hungerHigh","socialLow","baseMood","currentSlot","sh","sm","eh","em","bias","pref","action","gainXp","gainGold","ra","adjust","baseDelta","repBoost","notes","cdSec","canEmitKey","positives","lastTsStr","lastMs","sinceMin","status","pFriends","pBest","found","mod","moderate","high","maxDiff","rivals","friendlyTrainChance","friendly","shouldTrain","challenger","invite","invites","allowedTitles","filtered","maxPerTick","idx","simulateDuel","log","aHp","bHp","aMp","bMp","frames","aAtk","bAtk","aDef","bDef","aIni","bIni","aMag","bMag","aLuck","bLuck","turns","isA","atk","mag","def","crit","useMagic","aWins","winner","loser","baseGold","playAmbient","volume","ctx","osc","gain","playVoiceCue","pitch","durationMs","useMonetizationStore","cfg","clientId","reason","minMs","receipt","currentOwned","currentReceipts","frameId","themeId","themes","theme","getMonetization","initialFlags","useProgressionStore","flags","enabled","lvl","qc","needLevel","needQuests","nextHint","okRank","coleta","okQuests","okLevel","doneQuest","details","prevRank","prevIdx","newIdx","reqShop","reqForge","reqSt","EGG_IDENTIFY_COST","INCUBATION_MS","generateMysteryEgg","chosen","templates","uuidv4","TYPES","CLASSES","identifyEgg","egg","petClass","skillChancePercent","candidates","revealedName","capitalize","incubateEgg","canHatch","markReadyToHatch","rollMutation","variants","variant","PET_CANDIDATES","hatchPet","namePool","qualityRoll","mutation","exclusiveSkill","skillMap","getStageFromLevel","addPetXP","pet","levelsGained","newStage","accelerateIncubation","msReduction","endMs","newEnd","updated","KEY","load","save","getProgressionSlots","ranks","hasB","hasS","slots","getCapacity","getUsed","canCreateHero","getNextSlotPrice","purchaseSlot","spendGold","ATTRIBUTE_CONSTRAINTS","getMaxAttributeForRank","getTotalAttributePointsCapForRank","ATTRIBUTE_INFO","createInitialAttributes","calculateRemainingPoints","_attributes","validateAttributes","errors","attr","totalPoints","canIncreaseAttribute","attribute","canDecreaseAttribute","increaseAttribute","decreaseAttribute","autoDistributePoints","baseAttributes","inc","LEVEL_CAP","ATTRIBUTE_POINTS_PER_LEVEL","calculateXPForLevel","checkLevelUp","currentXP","currentLevel","total","calculateTotalAttributes","inventory","totalAttributes","upgradeLevel","adjusted","jewels","attrAdds","jk","scale","val","add","weaponSetIds","custom","sid","armorSetIds","accessorySetIds","w","activeSet","calculateDerivedAttributes","activeTitleId","companionBonus","cacheKey","selfAny","cached","baseTotal","hpBase","mpBase","hp","mp","initiative","armorClass","eq","acBonus","mountSpeed","finalInitiative","attackBase","magicBase","defenseBase","wa","wm","wd","power","first","computeCompanionBonus","masteryBonus","agileTypes","strongTypes","useHeroStore","heroData","timestamp","heroesNow","validation","initialInventory","newHero","sel","ok","cur","overrides","races","classes","names","baseRel","initialRelations","targetCount","needed","pickCount","relMap","anySelf","tick","runNPCTick","compBonus","derived","overlay","modal","choice","check","perf","newLog","gs","mode","freq","location","lastIso","cooldownMin","lines","keyOf","groups","removed","toRemoveIds","replacements","primary","others","o","_g","_h","_i","_j","_k","_l","_m","_n","_o","_p","memA","memB","newHeroes","partyId","targetHeroId","terms","party","inviter","inviteTerms","npcId","inviteIdx","nowInvites","duelRes","stats","rel","won","members","acceptedTerms","contractByHeroId","xpBonus","goldBonus","existing","inviterId","inviterRank","targetRank","parties","MAX_EGGS","eggs","eggId","costRange","utilIdentifyEgg","updatedEgg","nextEggs","slotIndex","usedSlots","targetSlot","method","invest","MAX_PETS","ends","hatchCost","pets","hatchHistory","cooldownMs","progression","goldAmount","reduceMs","mins","qty","newItems","petId","nextPets","refineBonus","mutationBonus","nextId","mountId","exists","mounts","hist","nextMounts","note","nextFavs","MAX_MOUNTS","types","pickType","pickRarity","speedBase","attrBase","confNameList","confName","speedBaseVal","mount","stageOrder","attrSum","compBonus2","derived2","newName","finalPrice","json","parsed","remain","take","validTypes","validRarities","mountsToAdd","favs","costGold","increment","maxCap","nextCap","bonusSpeed","durMin","mountBuff","prevTier","items","nextStage","hasScroll","needsEssence","hasEssence","updatedSpeed","stageAttrBoost","newAttrs","newMount","kind","stonesMagic","stonesLink","updateRefine","changed","missing","inviterHeroId","code","validityDays","inviterTag","personalizedSlug","newHeroId","inviteIndex","expiredInvite","updatedInvite","bonusGold","bonusXP","acceptedCount","inviteId","pending","accepted","expired","rewardsGranted","extraDays","updatedTop","finalAttributes","finalClass","finalLevel","finalInventory","finalActiveTitle","beforeCompleted","afterCompleted","beforeMissions","afterMissions","incomingHero","selectAfter","ensuredDerived","normalized","updatedHeroes","line","summary","chapter","selectedHero","defaultGuild","calcLevel","newQuests","nextCatalog","previousStickyLimited","stickyIds","activeIds","carryOverActive","promoQuestId","promo","stq","existingIds","aq","hasCaca","hasExploracao","qTry","completedSet","autoResolve","combatResult","factionFail","curStats","isColeta","nextColeta","stableQuestDone","prevHeroBeforeXP","heroAfter","eggChance","dropBase","diffBonus","compDone","updatedHero","finalHero","initializedRankData","newRankData","nextActive","buffPercent","synergyPercent","rankPercent","extraPercent","effectiveXP","newXP","currentStars","crossed","titleToAward","progressionUpdated","titlesUpdated","newTitle","planned","nowUnlockedPlanned","crossedMilestones","chaptersToAdd","relatedQuestTitles","qId","nowSeason","prevRankData","prevUnlockedNames","newlyUnlocked","grantItem","slot","goldPercent","auras","bonusPercent","effectiveGold","glory","essence","newAchievements","updatedProgression","updatedInventory","snapshot","finalCost","recipeId","recipe","equippedId","baseItem","currentRarity","costTable","refined","itemAId","itemBId","qtyA","qtyB","itemA","itemB","ch","iconMap","newItemId","mapped","customItems","nextJewels","jewelKey","maxSlots","reqLevel","socketIndex","nextKey","enchant","costEssence","ench","beforeHp","beforeMp","beforeFatigue","nextItems","itemInfo","afterHero","afterHp","afterMp","afterFatigue","hpRecovered","mpRecovered","fatigueRecovered","fatigueRecovery","restType","currentGold","guildName","newGuild","guildId","guild","isRankS","councilMembers","nextCouncil","roles","actorId","targetId","role","newLeaderId","newRoles","hid","actor","isCouncil","totalCost","lastActivatedIso","nowMs","requestId","nextPending","setActive","has","favored","prevAchievements","updatedAchievements","updateTitleAchievementProgress","updatedTitles","rewardTitleId","tpl","rewardTotals","latest","factions","allRevered","anyHonored","allHonoredOrBetter","toAdd","newTitles","selectedHeroId","selected","newGoals","goalsSource","activeGoals","previouslyCompletedCount","updatedGoals","nowCompletedCount","updatedStats","today","lastCompletionRaw","lastCompletion","yesterday","wasYesterday","currentStreak","allocations","availablePoints","increments","pointsToSpend","maxAttr","newAttributes","proposed","remainingPoints","allocationsSummary","goalIndex","todayStr","lastStr","newStreak","promotion","aRankIndex","bRankIndex","comparison","celebrationIndex","updatedCelebrations","_version","migratedHero","medievalTheme","getRankGradient","getClassIcon","seasonalThemes","getSeasonalButtonGradient","season","getSeasonalButtonColors","OnboardingOverlay","visible","setVisible","rect","setRect","setPosition","setTitle","setDescription","skippable","setSkippable","navigate","useNavigate","activeSeasonalTheme","accents","updateFromStep","step","pos","onStep","onResize","boxStyle","useMemo","glowStyle","pad","arrowStyle","cx","cy","Fragment","useAuthStore","token","loginWithGoogleCredential","credential","FALLBACK_AVATAR_DATA_URL","GoogleLoginButton","btnRef","useRef","gsiInitDoneRef","gsiScriptAddedRef","gsiButtonRenderedRef","login","isAuthenticated","loading","setLoading","resp","u","validClientId","supabaseOAuthGoogleEnabled","FLOW_STEPS","getStepIndex","pathname","ensurePlayerProfile","username","safeUsername","fetchError","updateError","inserted","insertError","getMonetizationConfig","saveQuest","listQuestsByHero","listFriends","addFriend","removeFriend","listNotifications","envAny","apiBase","listEventsHistory","getProfile","API_BASE","makeUrl","path","qs","authHeaders","headers","handleError","listEvents","viewerId","listEventsPaged","pagination","createEvent","getEvent","updateEvent","deleteEvent","attendEvent","fetchEventChat","signal","sendEventChat","addEventMedia","caption","listEventMedia","rateEvent","stars","recommendEvents","interestsCsv","recommendEventsPaged","getYesCount","attendees","computeOccupancyPercent","capacity","yes","isNearFull","EnhancedHUDLazy","React","__vitePreload","QuickNavigationLazy","AdBannerLazy","InterstitialAdLazy","SeasonalDecorLazy","Layout","useLocation","hudVisible","setHudVisible","getSelectedHero","updateHero","importHero","getHeroQuests","availableQuests","removeNotification","currentIdx","sbEmail","setSbEmail","sbUserId","setSbUserId","syncing","setSyncing","lastSyncedFor","setLastSyncedFor","setConfig","activeThemeId","notifCount","setNotifCount","organizerNearCount","setOrganizerNearCount","installPrompt","setInstallPrompt","installAvailable","setInstallAvailable","iosTipOpen","setIosTipOpen","openGroup","setOpenGroup","partyInvitesCount","setPartyInvitesCount","mounted","loadUser","sub","_event","session","handler","me","loadOrganizer","near","calc","runSync","localHero","injectedRemoteQuestObjs","remoteQuests","remoteActiveIds","localActiveQuests","localActiveIds","safeRemote","safeLocal","mergedActiveIds","localOnlyIds","byId","questObj","currentAvail","rq","mergedAvail","onBeforeInstallPrompt","onInstalled","interval","nextEnergy","mergedStats","isActive","navLinkClass","active","GatedLink","to","label","testId","Link","DungeonNavLink","groupButtonClass","isAnyActive","paths","themeBg","outcome","ua","isIOS","isStandalone","medal","ref","by","Outlet","STORAGE_KEY","loadStore","saveStore","store","getCachedImage","prompt","setCachedImage","ttlMs","CLASS_ICONS","Sword","Wand2","UserX","Heart","Target","Crown","Star","ELEMENT_GRADIENTS","ELEMENT_COLORS","HeroGalleryCard","onClick","showDetails","size","onEdit","onImageChange","onDelete","isHovered","setIsHovered","imageError","setImageError","selectHero","isNPC","allowAnimations","isSelected","elementInfo","sizeClasses","handleCardClick","imageSrc","onImgLoad","genderTag","img","imageSrcSet","w256","w384","w512","Eye","Edit","Camera","GalleryLightbox","HeroGallery","onCreateHero","onHeroSelect","onHeroEdit","onHeroImageChange","showCreateButton","cardSize","initialViewMode","deleteHero","purchaseHeroSlotForSelected","searchTerm","setSearchTerm","debouncedSearch","setDebouncedSearch","selectedClass","setSelectedClass","selectedElement","setSelectedElement","selectedRace","setSelectedRace","viewMode","setViewMode","showFilters","setShowFilters","sortBy","setSortBy","sortOrder","setSortOrder","lightboxIndex","setLightboxIndex","promptHero","setPromptHero","promptText","setPromptText","generatingImg","setGeneratingImg","prefetchRef","listContainerRef","searchParams","setSearchParams","useSearchParams","confirmDeleteId","setConfirmDeleteId","isDeleting","setIsDeleting","nonNpcHeroes","slotsUsed","getSlotsUsed","slotsCap","getSlotsCapacity","canCreate","nextPrice","uniqueRaces","filteredHeroes","matchesSearch","matchesClass","matchesElement","matchesRace","sortedHeroes","cmp","getStr","vm","sb","so","sc","se","sr","handleHeroClick","useCallback","openPromptEditor","story","withStory","generateFromPrompt","handleRemoveSelected","gridClasses","moveFocus","nodes","onGridKeyDown","Search","ArrowUpDown","Filter","Grid","List","Plus","Trash2","reader","dataUrl","nameCtx","ErrorBoundary","props","AIError","AIService","timeoutMs","controller","messageOrHeader","asNumber","secs","providerName","provider","model","imageModel","request","hash","chr","cache","override","endpoint","maxRetries","lastErrorMsg","maxTokensForAttempt","response","retryAfterHeader","retryAfterFromHeader","retryAfterFromMsg","exponentialMs","jitterMs","textRaw","errObj","errMsg","cacheEnabled","cachedUrl","imageUrl","res2","data2","width","height","srcType","startTime","sys","trimmed","tokens","responseTime","aiService","classVariations","places","dominantAttribute","labels","entries","generateStory","generateFallbackStory","place","dom","attributeLine","ALTHARION_LORE_VERSIONS","getAltharionLore","version","HeroList","createHero","fileInputRef","selectedHeroForImage","setSelectedHeroForImage","handleCreateHero","handleHeroSelect","handleHeroEdit","handleHeroImageChange","handleImageUpload","file","shortLore","buildParams","contexto","gerarTexto","systemMessage","maxTokens","temperature","texto","surnames","generateHeroWithAI","NAME_POOLS","BATTLE_QUOTES","isLikelyFemale","fSuffix","lower","getBattleQuote","generateNameOptions","race","gender","firsts","validateCustomName","TalentTreePreview","plannedTalents","onToggle","defs","setSelected","getRaceCompatibility","getRecommendedAttributePlan","priority","getPrefs","setPrefs","CLASS_PREF","getRecommendedTalentPlan","plan","getClassPreset","PRESETS","getPresetOptions","buildFromPreset","saveDraft","validateBuild","issues","buildChecklist","recEls","hasElem","basicsOk","buildReadiness","TIPS","getClassTips","HeroForm","formData","setFormData","loadingStory","setLoadingStory","loadingName","setLoadingName","loadingNameAI","setLoadingNameAI","loadingQuoteAI","setLoadingQuoteAI","loadingHFStory","setLoadingHFStory","loadingImageAI","setLoadingImageAI","nameOptions","setNameOptions","showNameOptions","setShowNameOptions","showSkillDetails","setShowSkillDetails","showElementTooltip","setShowElementTooltip","limitWarning","setLimitWarning","confirmOpen","setConfirmOpen","creationLog","setCreationLog","decisionHistory","setDecisionHistory","redoHistory","setRedoHistory","acceptReferralInvite","referralCode","inviterBy","buttonPrimary","buttonSecondary","classSkills","derivedPreview","adv","prefs","setDisableAutoSuggestion","onKey","handleElementChange","handleAutoDistributeRecommended","draftTimer","handleGenerateName","handleSelectName","handleGenerateNameAI","nome","handleAttributeChange","increase","handleAutoDistribute","weights","elemBonus","remaining","advWeights","elementAutoSuggested","setElementAutoSuggested","prevElement","setPrevElement","disableAutoSuggestion","showSuggestionInfo","setShowSuggestionInfo","advancedOpen","setAdvancedOpen","setAdvWeights","showSynergyDetails","setShowSynergyDetails","handleGenerateRandomElement","randomElement","handleClassChange","newClass","newSkills","newBattleQuote","nextElement","handleRaceChange","finalizeCreation","created","handleGenerateBattleQuote","quote","handleGenerateBattleQuoteAI","frase","handleGenerateImageAI","handleSubmit","nameValidation","handleUndoLastDecision","prevClass","newQuote","prevRace","prevEl","handleRedoLastDecision","nextClass","nextRace","nextEl","curIdx","advObj","rc","historia","disabled","Achievement","isUnlocked","showProgress","getRarityTrack","AchievementsList","setFilter","rarityFilter","setRarityFilter","allAchievements","unlockedAchievement","currentProgress","cardsWins","rpsBest","titleAchievements","combinedAchievements","filteredAchievements","unlockedCount","totalCount","completionPercentage","seasonalBorder","ReputationPanel","getProgressPercentage","nextLevelIndex","AttributeAllocationPanel","allocateAttributePoints","setPending","setMessage","pointsAvailable","pointsRemaining","attributesList","canIncrease","canDecrease","decrement","reset","apply","final","HeroProgression","activeTab","setActiveTab","useItem","unequipItem","isMaxLevel","currentLevelXP","nextLevelXP","xpProgressRaw","xpPercentage","equippedWeapons","equippedArmorSlots","equippedAccessories","totalBonuses","bonuses","forcaBonus","destrezaBonus","constituicaoBonus","inteligenciaBonus","tabs","derivedKey","highlightDerived","setHighlightDerived","powerValue","tab","ActivitiesPanel","activitiesLog","setLoc","GuildSystem","newGuildName","setNewGuildName","newGuildDescription","setNewGuildDescription","guilds","createGuild","joinGuild","leaveGuild","acceptQuest","completeQuest","refreshQuests","depositGoldToGuild","withdrawGoldFromGuild","contributeXPToGuild","ensureDefaultGuildExists","depositAmount","setDepositAmount","withdrawAmount","setWithdrawAmount","contributeXPAmount","setContributeXPAmount","currentGuild","handleCreateGuild","handleJoinGuild","handleLeaveGuild","handleQuickJoinDefaultGuild","amt","memberId","isCurrentHero","displayName","displayClass","avatar","saveDungeonRun","usr","startDungeonRun","startedAt","updateDungeonRun","runId","finishDungeonRun","getDungeonLeaderboard","getWeeklyDungeonHighlights","oneWeekAgo","bestRuns","errBest","lootRuns","errLoot","bestRun","biggestLoot","TRAINING_OPTIONS","Training","activeTraining","setActiveTraining","trainingEndTime","setTrainingEndTime","setTick","attemptsByStatus","activeUntilISO","activeName","endTs","option","completeTraining","getDiscountedCost","discountPercent","capped","discounted","canAffordTraining","meetsRequirements","startTraining","nowISO","lastDateStr","dailyLimitPerStatus","newProgression","effectiveCost","effectiveDuration","fatigue","effectiveness","baseXP","gained","trainingsToday","penalty","isFirstTrainingAtLv1","getRemainingTime","formatTime","seconds","used","boxCls","meetsReqs","attrCapBlocked","perStatusBlocked","isAvailable","blocked","cls","dateKey","y","pickEnemiesForLevel","storageKey","runDailyAutoMissions","maxRuns","runsCount","runs","xpTotal","goldTotal","victories","getDailyResult","getOrRunDailyResult","Leaderboards","seasonalHeaderBorder","localHeroId","setLocalHeroId","viewHero","selectedLeaderboard","setSelectedLeaderboard","leaderboards","setLeaderboards","dailyEntries","setDailyEntries","dailySubmitting","setDailySubmitting","dailySummary","setDailySummary","generatedLeaderboards","currentLeaderboard","heroRanking","renderLeaderboardEntry","dataLb","GUILD_HUB_VERSION","Tabs","activeId","onChange","className","NPCPresenceLayer","visibleCap","rotationSeconds","visibleIds","setVisibleIds","sample","iv","moodEmoji","SimsDialogueModal","npcInteractionOverlay","setNPCInteractionOverlay","respondToNPCInteraction","open","setIdx","face","gesture","anim","RecommendationAI","stripFences","escapeNewlinesInStrings","inString","escaped","cleaned","slice","noLines","context","maxRecommendations","rec","recommendations","weakestAttribute","recommendationAI","RankCard","animated","isGlowing","setIsGlowing","safeRank","getSizeClasses","getRankStyles","getGlowEffect","RankProgress","showEstimate","compact","currentRankInfo","nextRankInfo","estimate","getProgressColor","percentage","thresholds","missingXP","missingMissions","missingTitles","specials","reqs","GuildAdvicePanel","getHeroRankProgress","weaknesses","setWeaknesses","build","setBuild","rankProgress","cancelled","EggIdentificationNPC","RelationshipsPanel","GuildHub","activateGuildEvent","clearGuildEvent","approvePartyAlliance","rejectPartyAlliance","ensureNPCAdventurersSeedExists","startNPCSimulation","stopNPCSimulation","npcSeedTarget","qtyByItem","setQtyByItem","selectedType","setSelectedType","selectedRarity","setSelectedRarity","activeCategory","setActiveCategory","activeSection","setActiveSection","categories","currentCategory","allSections","getLabel","autoIv","levelBoard","top5","dungeonTop","setDungeonTop","dungeonError","setDungeonError","dungeonOffline","setDungeonOffline","hof","setHof","feed","epicOrBest","promotions","weeklyEventActivity","weekly","offline","inventoryEntries","filteredInventoryEntries","handleQtyChange","safe","handleSell","currentQty","isEquipped","handleSellAllConsumables","consumableEntries","totalItems","unitSell","handleSellAll","sellQty","Suspense","HeroSelector","handleClick","QuestBoard","abandonQuest","clearActiveQuests","gainXP","addItemToInventory","getQuestById","playerHeroes","availableUniq","seen","activeIdsUniq","completedIdsUniq","selectedTab","setSelectedTab","companionsOnly","setCompanionsOnly","forceUpdate","setForceUpdate","refreshCooldownEndsAt","setRefreshCooldownEndsAt","nowTs","setNowTs","intervalId","handleManualRefresh","selectedHeroData","currentSelected","getDifficultyColor","getDifficultyLabel","getTypeIcon","cdMs","cdActive","formatRemaining","hh","ss","canAcceptQuest","handleAcceptQuest","ActiveMissionRunner","running","setRunning","finished","setFinished","phaseIndex","setPhaseIndex","setLog","autoRun","setAutoRun","npcIntegrity","setNpcIntegrity","anyLoot","setAnyLoot","setStreak","setError","phasesTotal","low","mid","staminaCostPerPhase","biome","cdMsQ","cdActiveQ","persistState","pi","ni","run","fin","logsArr","resolvePhase","extraPhaseCost","help","staminaDiscount","riskStep","classBonus","helpSuccessBoost","successChance","xpBaseRaw","goldBaseRaw","phaseScaling","xpBase","goldBase","boss","bossMult","buffPct","getHeroParty","consumeOneMissionContract","contractSharePct","helpXpPct","helpGoldPct","itemsEquip","extraIds","dropChanceBase","phaseDropBoost","helpLootBonus","dropChance","isNight","isDay","eligible","pickId","ENEMIES_BY_BIOME","baseAmbush","ambushShield","ambush","npcAfter","ambushText","foe","ambushDamageBaseRaw","ambushDamageBase","curHp2","newHp2","maxHp2","maxHp","curHp","damageBase","mapName","nextLogs","nextPhase","willFinish","cdMin","endsMs","consolation","leader","ConcludeButton","renderQuestCard","isCompleted","pct","compSet","rewardIds","have","phases","objective","alreadyCompleted","bannerQuest","AutoCompleteMission","onConcluded","busy","setBusy","handle","started","setStarted","stAll","TitlesManager","setActiveTitle","addTitleToSelectedHero","toggleFavoriteTitle","selectedCategory","setSelectedCategory","showFavoritesOnly","setShowFavoritesOnly","showNewOnly","setShowNewOnly","sortMode","setSortMode","suggestedTitleId","setSuggestedTitleId","toastMessage","setToastMessage","toastTimerRef","setCelebration","celebrationTitle","setCelebrationTitle","prevTitlesRef","fav","cat","rar","sort","nw","filteredTitles","cutoff","rarityRank","suggestBestTitle","bestId","bestScore","bonusSum","recentBoost","equipSuggested","currentIds","prevIds","added","addedTitle","handleSetActiveTitle","handleRemoveActiveTitle","getCategoryIcon","getCategoryName","getRarityName","suggested","rows","DailyGoals","generateDailyGoalsForHero","completeDailyGoal","cleanupExpiredGoals","initializedRef","currentHero","hasExpiredGoals","hasValidGoals","handleClaimReward","getTimeRemaining","timeLeft","completedGoals","claimableGoals","totalGoals","difficultyColor","timeRemaining","EventsPanel","addTitle","activeEvents","setActiveEvents","eventProgress","setEventProgress","timeUntilRotation","setTimeUntilRotation","loadEvents","getEventProgress","handleClaimRewards","formatRewards","specialEvents","canClaim","ActivityFeed","maxItems","setActivities","showComments","setShowComments","newComment","setNewComment","loadActivities","loadedActivities","handleLike","handleComment","handleShare","shareData","copyToClipboard","toggleComments","formatTimeAgo","diffMs","diffMins","diffHours","diffDays","FilterPanel","dateRange","showOnlyPublic","ActivityCard","audioCtx","lastPlayAt","getAudioContext","playSequence","gapMs","stop","rateLimit","minIntervalMs","playSuccess","playFailure","playLevelUp","resumeAudioContextIfNeeded","playHammer","playPolish","playForgeStart","RankPromotionAnimation","isVisible","onComplete","showParticles","setShowParticles","showRankBadge","setShowRankBadge","timer1","timer2","timer3","AnimatePresence","motion","RankProgressAnimation","isAnimating","color","FloatingRankBadge","isFloating","LocalRankCard","EvolutionPanel","getRankLeaderboard","promoteHero","selectedHeroForComparison","setSelectedHeroForComparison","historyFilter","setHistoryFilter","filteredHistory","comparisonData","compareHero","Trophy","handlePromotion","renderOverview","Award","renderProgress","Clock","renderHistory","Calendar","renderLeaderboard","Users","renderComparison","BarChart3","viewModes","TrendingUp","Icon","RankCelebration","onClose","onViewRewards","setIsVisible","showRewards","setShowRewards","animationPhase","setAnimationPhase","handleClose","Sparkles","Zap","RankCelebrationManager","celebrations","onCelebrationViewed","setCurrentIndex","currentCelebration","FRAME_STYLES","DialogueFrame","children","activeFrameId","style","ThemePreviewModal","previewFrameId","setActiveFrame","Shop","ownedFrames","markPurchase","ownedThemes","setActiveTheme","previewOpen","setPreviewOpen","previewId","setPreviewId","showDailyOffers","setShowDailyOffers","showForgeServices","setShowForgeServices","fusionA","setFusionA","fusionB","setFusionB","handlePurchase","renderItem","canBuy","discountedPrice","hasDiscount","stat","dailyOffers","handleRefine","handleFuse","handleEnchant","startCheckout","verifyPurchase","enchanted","chapters","l","ENHANCED_MISSION_TEMPLATES","_EnhancedMissionGenerator","storySeeds","mission","_hero","baseNarrative","rollNarrative","EnhancedMissionGenerator","enhancedMissionGenerator","StaminaDisplay","currentTime","setCurrentTime","trainingUntilISO","trainingName","trainingSeconds","setTrainingSeconds","until","remainingMs","formatSecondsToMMSS","getStaminaColor","WorldStateDemo","demoResults","setDemoResults","runDemo","results","clearDemo","decision","choiceIndex","effectIndex","decIndex","rankByReputation","rep","addGuildReputation","newRep","generateChestLoot","rIdx","unique","BattleModal","onResult","partyRarityBonusPercent","setResult","petSkillInfo","setPetSkillInfo","skillName","strIncludes","humanizeMemory","getNPCDialogue","arch","exclamations","colloquials","survival","whispers","thoughts","biomeColloquials","archCatch","archPrefix","envCue","excitement","tip","aside","think","archLine","bg","lead","core","friendlyWrap","Dungeon20","gainGlory","gainArcaneEssence","generateEggForSelected","useStoreRef","floorIndex","setFloorIndex","awaitingDecision","setAwaitingDecision","setStartedAt","battleEnemies","setBattleEnemies","showBattle","setShowBattle","exitedVoluntarily","setExitedVoluntarily","pendingEvent","setPendingEvent","awaitingEventChoice","setAwaitingEventChoice","awaitingCombatChoice","setAwaitingCombatChoice","blessingFloors","setBlessingFloors","blessingMult","setBlessingMult","trapFloors","setTrapFloors","trapPenaltyMult","setTrapPenaltyMult","lootFeedback","setLootFeedback","activeRunId","setActiveRunId","bossRewardPending","setBossRewardPending","selectedAttrReward","setSelectedAttrReward","totalXP","getMaxFloorsByRank","maxFloorsAllowed","setDifficulty","diffParams","getBiomeByFloor","getBiomeClasses","startRun","cdEnds","makeNarrative","DUNGEON_STAMINA_COST","handleChoice","risk","baseSuccess","re","currentFloor","miniboss","bossRewardMult","currentMax","nextMax","goldLoss","xpLoss","ascend","exitRun","saveRun","resetRun","handleEventAction","gloryChest","essenceChest","itemNames","itemIds","healed","dirForward","speech","forward","biomeNow","lightPos","setLightPos","buffs","rarityClass","equipable","consumable","bonusParts","tooltip","rb","essenceChance","scrollChance","BIOME_TARGETS","chooseBiome","biomes","gatingByRank","phasesByCategory","rankRequirement","generateHuntingMission","preferredBiome","preferredCategory","allowed","pickPool","rankReq","baseRewards","staminaPerPhase","timeHint","classHint","HuntingMissions","setBiome","categorySel","setCategorySel","setMission","setShowDetails","getHuntingCooldownMinutes","prefCat","canEnter","idxHero","idxReq","estimatedSuccess","estimatedTotals","xpPer","goldPer","estimatedTotalStamina","mountRed","rewardBoost","lootTier","rankIsF","ambushDamage","loss","baseLoss","narrativeExtra","hour2","night2","eggBase","newStats","ensuredRank","retreat","reroll","guard","effTotal","boostPct","cf","need","baseNext","effNext","redPct","Inventory","upgradeItem","socketJewel","removeJewel","fuseJewels","search","setSearch","feedback","setFeedback","getMaxSlotsForItem","getJewelLabel","nivelStr","buildTooltip","labelKey","onDragStart","ev","onJewelDragStart","makeDropHandler","onDragOver","newLvl","Row","HatchResultModal","setActivePet","hatchInfo","iso","TabButton","EggCard","onIdentify","onIncubate","onAccelerateEssencia","onAccelerateBrasas","onAccelerateGold","onHatch","full","cd","goldInsufficient","cdText","hatchCostByRarity","PetCard","onTrain","onSoulStone","onFeedBasic","onFeedDeluxe","onSetActive","onRename","onRefine","onSuggestMission","onSell","ready","readyCount","PetsPanel","identifyEggForSelected","startIncubationForSelected","accelerateIncubationForSelected","hatchEggForSelected","consumeInventoryItem","addPetXPForSelected","refinePetForSelected","suggestCompanionQuestForSelected","setTab","hatchingEggId","setHatchingEggId","hatchResultPetId","setHatchResultPetId","confirmEggId","setConfirmEggId","confirmAccelerateGold","setConfirmAccelerateGold","confirmSellPetId","setConfirmSellPetId","isSelling","setIsSelling","hatchNext","eggsArr","statusOrder","eggsSorted","sa","rarityCounts","hatchSummary","mut","counts","last7","last30","pp","rate","rate7","rate30","minIdx","incubatingSlots","handleIdentify","handleIncubate","handleAccelerateEssencia","handleAccelerateBrasas","handleAccelerateGold","handleHatch","confirmHatchProceed","h2","readyList","baseClass","gradient","insufficient","reduceMsPreview","newCdMsPreview","MountsPanel","addMountToSelected","setActiveMount","evolveMountForSelected","refineCompanion","buyItem","setFavoriteMount","generateMountForSelected","sortKey","setSortKey","compareAId","setCompareAId","compareBId","setCompareBId","selectedStage","setSelectedStage","detailId","setDetailId","canRefineAny","canEvolveAny","sortedMounts","copy","bestMountId","activeSpeed","am","typeIcon","byRarity","topTypes","fid","fm","isActiveFav","rand","rarities","priceByRarity","aInit","bInit","enoughGold","evolvable","refinable","canEvolve","isMaxRefine","nextRefine","refineChance","predictedInitiative","rem","totalReq","toNext","HeroJournal","selectedEntry","setSelectedEntry","filterType","setFilterType","decisionLog","filteredEntries","formatDate","getImpactSummary","impacts","reputationSummary","__","worldTopics","sec","clampProb","pickDifficulty","defaultMissionFromHero","klass","challenge","diffPenalty","probA","probB","probC","resolveOutcomeLocal","choiceKey","prob","baseWithLevel","xpRaw","lootChance","titleChance","gotLoot","gotTitle","outcomeTextSuccess","outcomeTextFail","generateMission","text1","text2","resolveMission","QuickMission","autoStart","levelUp","setLevelUp","xpForLevel","handleGenerate","xpCurBase","xpNextBase","xpIntoLevel","NarrativeChapters","nextMilestone","StepCard","ctaLabel","highlight","examples","stepIndex","ProgressBar","JourneyFlow","daily","setDaily","submitting","setSubmitting","setLeaderboard","progressLoading","setProgressLoading","progressError","setProgressError","playerProgress","setPlayerProgress","onbPct","setOnbPct","onbCounts","setOnbCounts","onbStep","setOnbStep","prefShowHints","setPrefShowHints","prefSkipTutorials","setPrefSkipTutorials","fbChoice","setFbChoice","fbText","setFbText","recommendedEvents","setRecommendedEvents","recLoading","setRecLoading","trackerExpandedFlowId","setTrackerExpandedFlowId","progressAbortRef","isMountedRef","xpPercent","currentXp","nextLevelXp","prevLevelXp","inLevelXp","levelSpan","fetchPlayerProgress","onVis","csv","np","goToCurrentStep","startTutorial","nextTutorialStep","prevTutorialStep","skipCurrentStep","submitFeedback","flowStats","completed","completedFlow","supportedVersions","lineVariants","IntroCinematic","lore","linesArr","setIndex","autoPlay","setAutoPlay","ttsEnabled","setTtsEnabled","nextTimeout","ambientRef","crescendoRef","utterRef","voices","pickVoice","vs","matchesGooglePtBr","uri","hay","preferredNames","voiceByName","voiceByHeuristic","isFemaleName","preferPool","ptbr","pt","computeDelay","speak","onEnd","utter","voice","synth","delayMs","ambientSrc","crescendoSrc","isFinished","handleSkip","nv","bank","isMorning","isEvening","generateDialogue","tags","generateMixed","actionConversar","actionElogiar","good","relCur","factor","actionPedirAjuda","helpStatus","refill","actionDarPresente","giftStats","actionProvocar","Badge","TavernInteractions","restAtTavern","latestIds","activeNpcId","setActiveNpcId","morning","evening","gossip","uniqueLines","aiCompact","setAiCompact","picked","displayMood","sameDay","globalDate","globalCount","canGlobal","can","mark","baseStats","prevDate","prevCount","nextCount","runIfAllowed","cdUntil","hs","restUntil","medUntil","medCd","recordDiceEvent","getTavernSettings","incrementRerollUsage","sampleRumors","pickDailyEvent","dayIdx","Tavern","generatedRumors","setGeneratedRumors","rumorIntervalSec","setRumorIntervalSec","rumorFilter","setRumorFilter","lastRumorTs","setLastRumorTs","restMessage","setRestMessage","diceRolling","setDiceRolling","lastRoll","setLastRoll","criticalGlow","setCriticalGlow","diceMessage","setDiceMessage","rerollCap","setRerollCap","rollCap","setRollCap","npcDiceResults","setNpcDiceResults","getRerollTokens","getRerollDaily","getRollDaily","offlineRumors","todayEvent","simulateNPCDiceNight","npcList","injectTavernQuests","baseLevel","sres","capStr","rollCapStr","vr","acts","isDice","isRest","topName","rd","heroNow","expires","wins","losses","draw","playerScore","npcPool","npcScore","win","npcChoice","prevStreak","baseHelper","opt","canRest","DIALOGUES","BlacksmithNPC","craftItem","refineEquippedItem","fuseItems","enchantEquippedItem","currentWork","setCurrentWork","isNear","setIsNear","activeDialogue","setActiveDialogue","showPanel","setShowPanel","containerRef","npcRef","npcPos","setNpcPos","audioReady","setAudioReady","lastAction","setLastAction","forgingId","setForgingId","forgingProgress","setForgingProgress","forgingStage","setForgingStage","forgingTimerRef","detailsOpenId","setDetailsOpenId","forgingQueue","setForgingQueue","forgeView","setForgeView","recipeQuery","setRecipeQuery","startForging","rid","rname","elapsed","rest","rnext","rr","quickBuyMaterial","quickBuyAllForRecipe","successCount","idleCommentTimer","actions","nx","ny","onMove","npcEl","dx","dy","dist","ke","recipes","rankEligibleRecipes","smartTips","rarityScore","rankOk","maxRarity","ta","tb","rarityClasses","dynamic","canUp","canDown","estSec","nq","outItem","deficits","priceEach","totals","haveGold","haveGlory","haveEss","enough","currencyLabel","affordable","HammerAudio","ActionFollowUp","GlowBurst","work","titleName","baseOk","baseFail","okCount","failCount","evt","onEvt","HeroForge","sessionId","uid","PremiumCenter","removeAdsForever","seasonPassActive","adsRemoved","priceRemoveAds","priceSeasonPass","priceThemeMedieval","priceFrameOrnate","fmt","valRemoveAds","valSeasonPass","valThemeMedieval","valFrameOrnate","displayPrice","txt","statusMsg","setStatusMsg","checkout","prod","paymentsService","SocialEventsPage","setEvents","recommended","setRecommended","filters","setFilters","nearFullOnly","setNearFullOnly","limitRecommended","setLimitRecommended","recOffset","setRecOffset","limitEvents","setLimitEvents","eventsOffset","setEventsOffset","hasMoreRec","setHasMoreRec","hasMoreEvents","setHasMoreEvents","loadingMoreRec","setLoadingMoreRec","loadingMoreEvents","setLoadingMoreEvents","errorRec","setErrorRec","setErrorEvents","retryRecCount","setRetryRecCount","retryEventsCount","setRetryEventsCount","setName","dateTime","setDateTime","locationText","setLocationText","lat","setLat","lng","setLng","setCapacity","setTags","privacy","setPrivacy","invitedCsv","setInvitedCsv","friends","setFriends","isLogged","listPaged","recPaged","showMoreRecommended","showMoreEvents","sortedRecommended","sortedEvents","handleCreate","invited","EventDetailPage","useParams","setEv","attStatus","setAttStatus","chat","setChat","chatInput","setChatInput","chatSending","setChatSending","media","setMedia","mediaUrl","setMediaUrl","mediaCaption","setMediaCaption","chatLoading","setChatLoading","mediaLoading","setMediaLoading","uploading","setUploading","uploadProgress","setUploadProgress","rating","setRating","ratingComment","setRatingComment","addingInvite","setAddingInvite","presenceError","setPresenceError","mediaRefreshCount","setMediaRefreshCount","autoRefreshMedia","setAutoRefreshMedia","refreshIntervalSec","setRefreshIntervalSec","mediaAutoRef","autoRefreshChat","setAutoRefreshChat","chatIntervalSec","setChatIntervalSec","chatAutoRef","newMsgCount","setNewMsgCount","lastSeenTs","setLastSeenTs","initialAbortRef","mediaAbortRef","chatAbortRef","msgs","attendeesCount","nearFull","occupancyPercent","canRate","dt","past","attended","googleMapSrc","setPresence","sendMsg","addMediaItem","submitRating","addFriendInvite","upd","downloadICS","toUTC","yyyy","dd","HH","MM","SS","shareEvent","nav","copyEventLink","OrganizerDashboard","ownerId","importing","setImporting","remove","exportEvents","importEvents","avg","FriendsPage","setTargetId","SocialNotificationsPage","setItems","UserEventsHistoryPage","PartyInvitesPanel","acceptInvite","declineInvite","myInvites","leaderName","MetricsDashboard","eng","gp","install","dismissed","byDevice","dev","deviceRows","installsByDay","byDay","monetizationFunnel","shopOpens","premiumOpens","premiumBannerClicks","purchaseInitiated","purchaseCompleted","rateBanner","rateCheckout","ratePurchase","adImpressions","adClicks","adCtr","PRODUCT_PRICES","revenue","uniqueBuyers","arppu","customizationLocal","dailyRemote","setDailyRemote","summaryRemote","setSummaryRemote","abort","row","StableHub","tabClass","BlockedView","FeatureGate","HeroDetailLazy","DynamicMissionsPanelLazy","AIRecommendationsPanelLazy","MissionsHubLazy","AdminDashboardLazy","HeroProgressionWrapper","GuildSystemWrapper","DailyGoalsWrapper","EvolutionPanelWrapper","DynamicMissionsPanelWrapper","handleMissionAccept","_mission","AIRecommendationsPanelWrapper","handleApply","HeroJournalWrapper","QuickMissionWrapper","HuntingGateWrapper","QuestBoardGateWrapper","ShopGateWrapper","ForgeGateWrapper","DungeonGateWrapper","curRank","InventoryGateWrapper","StableGateWrapper","App","markCelebrationViewed","topWin","cspMeta","sbUrl","sbOrigin","connectSrc","adsOrigins","fontOrigins","localTimer","startLocal","stopLocal","allCelebrations","handleCelebrationViewed","Routes","Route","Navigate","getBasename","ReactDOM","BrowserRouter","initAnalytics","script","inline","reduced","conn","saveData","effectiveType"],"sources":["../../node_modules/react-dom/client.js","../../node_modules/zustand/esm/middleware.mjs","../../node_modules/uuid/dist/esm-browser/rng.js","../../node_modules/uuid/dist/esm-browser/stringify.js","../../node_modules/uuid/dist/esm-browser/native.js","../../node_modules/uuid/dist/esm-browser/v4.js","../../src/types/ranks.ts","../../src/utils/quests.ts","../../src/store/gameSettingsStore.ts","../../src/utils/relationshipSystem.ts","../../src/utils/relationBenefits.ts","../../src/utils/shop.ts","../../src/utils/replayModifiers.ts","../../src/utils/dungeonConfig.ts","../../src/utils/elementSystem.ts","../../src/utils/combat.ts","../../src/types/jewel.ts","../../src/utils/forging.ts","../../src/utils/activitySystem.ts","../../src/utils/rankSystem.ts","../../src/utils/reputationSystem.ts","../../src/utils/leaderboardSystem.ts","../../src/utils/dailyGoalsSystem.ts","../../src/utils/titles.ts","../../src/utils/onboardingSystem.ts","../../src/utils/eventSystem.ts","../../src/utils/metricsSystem.ts","../../src/lib/supabaseClient.ts","../../src/services/heroesService.ts","../../src/components/NotificationSystem.tsx","../../src/utils/classRegistry.ts","../../src/utils/synergy.ts","../../src/utils/skillSystem.ts","../../src/services/progressService.ts","../../src/utils/worldState.ts","../../src/utils/relationshipEvents.ts","../../src/utils/npcAI.ts","../../src/utils/duel.ts","../../src/utils/audio.ts","../../src/store/monetizationStore.ts","../../src/store/progressionStore.ts","../../src/utils/pets.ts","../../src/services/heroSlots.ts","../../src/utils/attributeSystem.ts","../../src/utils/progression.ts","../../src/store/heroStore.ts","../../src/styles/medievalTheme.ts","../../src/components/OnboardingOverlay.tsx","../../src/store/authStore.ts","../../src/services/authService.ts","../../src/components/GoogleLoginButton.tsx","../../src/utils/flow.ts","../../src/services/playersService.ts","../../src/services/monetizationService.ts","../../src/services/questsService.ts","../../src/services/userService.ts","../../src/services/socialEventsService.ts","../../src/utils/eventsHelpers.ts","../../src/components/Layout.tsx","../../src/utils/imageCache.ts","../../src/components/HeroGalleryCard.tsx","../../src/components/HeroGallery.tsx","../../src/components/ErrorBoundary.tsx","../../src/services/aiService.ts","../../src/utils/story.ts","../../src/components/HeroList.tsx","../../src/services/groqTextService.ts","../../src/services/heroCreateService.ts","../../src/utils/nameGenerator.ts","../../src/components/TalentTreePreview.tsx","../../src/utils/compatibility.ts","../../src/utils/userPreferences.ts","../../src/utils/talentRecommendations.ts","../../src/utils/buildPresets.ts","../../src/utils/presetLibrary.ts","../../src/utils/creationDraft.ts","../../src/utils/buildValidate.ts","../../src/utils/buildSummary.ts","../../src/utils/classTips.ts","../../src/components/HeroForm.tsx","../../src/components/Achievement.tsx","../../src/components/AchievementsList.tsx","../../src/components/ReputationPanel.tsx","../../src/components/AttributeAllocationPanel.tsx","../../src/styles/designTokens.ts","../../src/components/HeroProgression.tsx","../../src/components/ActivitiesPanel.tsx","../../src/components/GuildSystem.tsx","../../src/services/dungeonService.ts","../../src/components/Training.tsx","../../src/services/idleBattleService.ts","../../src/components/Leaderboards.tsx","../../src/features/guild/version.ts","../../src/components/ui/Tabs.tsx","../../src/components/NPCPresenceLayer.tsx","../../src/components/SimsDialogueModal.tsx","../../src/services/recommendationAI.ts","../../src/components/RankCard.tsx","../../src/components/RankProgress.tsx","../../src/components/GuildAdvicePanel.tsx","../../src/features/guild/Hub.tsx","../../src/components/QuestBoard.tsx","../../src/components/TitlesManager.tsx","../../src/components/DailyGoals.tsx","../../src/components/EventsPanel.tsx","../../src/components/ActivityFeed.tsx","../../src/utils/audioEffects.ts","../../src/components/RankAnimations.tsx","../../src/components/EvolutionPanel.tsx","../../src/components/RankCelebration.tsx","../../src/components/DialogueFrame.tsx","../../src/components/ThemePreviewModal.tsx","../../src/components/Shop.tsx","../../src/utils/enhancedMissions.ts","../../src/components/StaminaDisplay.tsx","../../src/components/WorldStateDemo.tsx","../../src/services/guildService.ts","../../src/utils/chestLoot.ts","../../src/components/BattleModal.tsx","../../src/services/npcDialogueService.ts","../../src/components/Dungeon20.tsx","../../src/utils/huntingGenerator.ts","../../src/components/HuntingMissions.tsx","../../src/components/Inventory.tsx","../../src/components/HatchResultModal.tsx","../../src/components/PetsPanel.tsx","../../src/components/MountsPanel.tsx","../../src/components/HeroJournal.tsx","../../src/services/missionService.ts","../../src/components/QuickMission.tsx","../../src/components/NarrativeChapters.tsx","../../src/components/JourneyFlow.tsx","../../src/components/IntroCinematic.tsx","../../src/utils/dialogueEngine.ts","../../src/utils/socialActions.ts","../../src/components/TavernInteractions.tsx","../../src/services/tavernService.ts","../../src/components/Tavern.tsx","../../src/components/BlacksmithNPC.tsx","../../src/components/HeroForge.tsx","../../src/services/paymentsService.ts","../../src/components/PremiumCenterSimple.tsx","../../src/components/SocialEventsPage.tsx","../../src/components/EventDetailPage.tsx","../../src/components/OrganizerDashboard.tsx","../../src/components/FriendsPage.tsx","../../src/components/SocialNotificationsPage.tsx","../../src/components/UserEventsHistoryPage.tsx","../../src/components/PartyInvitesPanel.tsx","../../src/components/MetricsDashboard.tsx","../../src/components/StableHub.tsx","../../src/components/FeatureGate.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","const reduxImpl = (reducer, initial) => (set, _get, api) => {\n  api.dispatch = (action) => {\n    set((state) => reducer(state, action), false, action);\n    return action;\n  };\n  api.dispatchFromDevtools = true;\n  return { dispatch: (...a) => api.dispatch(...a), ...initial };\n};\nconst redux = reduxImpl;\n\nconst trackedConnections = /* @__PURE__ */ new Map();\nconst getTrackedConnectionState = (name) => {\n  const api = trackedConnections.get(name);\n  if (!api) return {};\n  return Object.fromEntries(\n    Object.entries(api.stores).map(([key, api2]) => [key, api2.getState()])\n  );\n};\nconst extractConnectionInformation = (store, extensionConnector, options) => {\n  if (store === void 0) {\n    return {\n      type: \"untracked\",\n      connection: extensionConnector.connect(options)\n    };\n  }\n  const existingConnection = trackedConnections.get(options.name);\n  if (existingConnection) {\n    return { type: \"tracked\", store, ...existingConnection };\n  }\n  const newConnection = {\n    connection: extensionConnector.connect(options),\n    stores: {}\n  };\n  trackedConnections.set(options.name, newConnection);\n  return { type: \"tracked\", store, ...newConnection };\n};\nconst devtoolsImpl = (fn, devtoolsOptions = {}) => (set, get, api) => {\n  const { enabled, anonymousActionType, store, ...options } = devtoolsOptions;\n  let extensionConnector;\n  try {\n    extensionConnector = (enabled != null ? enabled : (import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") && window.__REDUX_DEVTOOLS_EXTENSION__;\n  } catch (_e) {\n  }\n  if (!extensionConnector) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && enabled) {\n      console.warn(\n        \"[zustand devtools middleware] Please install/enable Redux devtools extension\"\n      );\n    }\n    return fn(set, get, api);\n  }\n  const { connection, ...connectionInformation } = extractConnectionInformation(store, extensionConnector, options);\n  let isRecording = true;\n  api.setState = (state, replace, nameOrAction) => {\n    const r = set(state, replace);\n    if (!isRecording) return r;\n    const action = nameOrAction === void 0 ? { type: anonymousActionType || \"anonymous\" } : typeof nameOrAction === \"string\" ? { type: nameOrAction } : nameOrAction;\n    if (store === void 0) {\n      connection == null ? void 0 : connection.send(action, get());\n      return r;\n    }\n    connection == null ? void 0 : connection.send(\n      {\n        ...action,\n        type: `${store}/${action.type}`\n      },\n      {\n        ...getTrackedConnectionState(options.name),\n        [store]: api.getState()\n      }\n    );\n    return r;\n  };\n  const setStateFromDevtools = (...a) => {\n    const originalIsRecording = isRecording;\n    isRecording = false;\n    set(...a);\n    isRecording = originalIsRecording;\n  };\n  const initialState = fn(api.setState, get, api);\n  if (connectionInformation.type === \"untracked\") {\n    connection == null ? void 0 : connection.init(initialState);\n  } else {\n    connectionInformation.stores[connectionInformation.store] = api;\n    connection == null ? void 0 : connection.init(\n      Object.fromEntries(\n        Object.entries(connectionInformation.stores).map(([key, store2]) => [\n          key,\n          key === connectionInformation.store ? initialState : store2.getState()\n        ])\n      )\n    );\n  }\n  if (api.dispatchFromDevtools && typeof api.dispatch === \"function\") {\n    let didWarnAboutReservedActionType = false;\n    const originalDispatch = api.dispatch;\n    api.dispatch = (...a) => {\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && a[0].type === \"__setState\" && !didWarnAboutReservedActionType) {\n        console.warn(\n          '[zustand devtools middleware] \"__setState\" action type is reserved to set state from the devtools. Avoid using it.'\n        );\n        didWarnAboutReservedActionType = true;\n      }\n      originalDispatch(...a);\n    };\n  }\n  connection.subscribe((message) => {\n    var _a;\n    switch (message.type) {\n      case \"ACTION\":\n        if (typeof message.payload !== \"string\") {\n          console.error(\n            \"[zustand devtools middleware] Unsupported action format\"\n          );\n          return;\n        }\n        return parseJsonThen(\n          message.payload,\n          (action) => {\n            if (action.type === \"__setState\") {\n              if (store === void 0) {\n                setStateFromDevtools(action.state);\n                return;\n              }\n              if (Object.keys(action.state).length !== 1) {\n                console.error(\n                  `\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { \"type\": \"__setState\", \"state\": { \"abc123Store\": { \"foo\": \"bar\" } } }\n                    `\n                );\n              }\n              const stateFromDevtools = action.state[store];\n              if (stateFromDevtools === void 0 || stateFromDevtools === null) {\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(stateFromDevtools)) {\n                setStateFromDevtools(stateFromDevtools);\n              }\n              return;\n            }\n            if (!api.dispatchFromDevtools) return;\n            if (typeof api.dispatch !== \"function\") return;\n            api.dispatch(action);\n          }\n        );\n      case \"DISPATCH\":\n        switch (message.payload.type) {\n          case \"RESET\":\n            setStateFromDevtools(initialState);\n            if (store === void 0) {\n              return connection == null ? void 0 : connection.init(api.getState());\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"COMMIT\":\n            if (store === void 0) {\n              connection == null ? void 0 : connection.init(api.getState());\n              return;\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"ROLLBACK\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                connection == null ? void 0 : connection.init(api.getState());\n                return;\n              }\n              setStateFromDevtools(state[store]);\n              connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n            });\n          case \"JUMP_TO_STATE\":\n          case \"JUMP_TO_ACTION\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(state[store])) {\n                setStateFromDevtools(state[store]);\n              }\n            });\n          case \"IMPORT_STATE\": {\n            const { nextLiftedState } = message.payload;\n            const lastComputedState = (_a = nextLiftedState.computedStates.slice(-1)[0]) == null ? void 0 : _a.state;\n            if (!lastComputedState) return;\n            if (store === void 0) {\n              setStateFromDevtools(lastComputedState);\n            } else {\n              setStateFromDevtools(lastComputedState[store]);\n            }\n            connection == null ? void 0 : connection.send(\n              null,\n              // FIXME no-any\n              nextLiftedState\n            );\n            return;\n          }\n          case \"PAUSE_RECORDING\":\n            return isRecording = !isRecording;\n        }\n        return;\n    }\n  });\n  return initialState;\n};\nconst devtools = devtoolsImpl;\nconst parseJsonThen = (stringified, f) => {\n  let parsed;\n  try {\n    parsed = JSON.parse(stringified);\n  } catch (e) {\n    console.error(\n      \"[zustand devtools middleware] Could not parse the received json\",\n      e\n    );\n  }\n  if (parsed !== void 0) f(parsed);\n};\n\nconst subscribeWithSelectorImpl = (fn) => (set, get, api) => {\n  const origSubscribe = api.subscribe;\n  api.subscribe = (selector, optListener, options) => {\n    let listener = selector;\n    if (optListener) {\n      const equalityFn = (options == null ? void 0 : options.equalityFn) || Object.is;\n      let currentSlice = selector(api.getState());\n      listener = (state) => {\n        const nextSlice = selector(state);\n        if (!equalityFn(currentSlice, nextSlice)) {\n          const previousSlice = currentSlice;\n          optListener(currentSlice = nextSlice, previousSlice);\n        }\n      };\n      if (options == null ? void 0 : options.fireImmediately) {\n        optListener(currentSlice, currentSlice);\n      }\n    }\n    return origSubscribe(listener);\n  };\n  const initialState = fn(set, get, api);\n  return initialState;\n};\nconst subscribeWithSelector = subscribeWithSelectorImpl;\n\nconst combine = (initialState, create) => (...a) => Object.assign({}, initialState, create(...a));\n\nfunction createJSONStorage(getStorage, options) {\n  let storage;\n  try {\n    storage = getStorage();\n  } catch (_e) {\n    return;\n  }\n  const persistStorage = {\n    getItem: (name) => {\n      var _a;\n      const parse = (str2) => {\n        if (str2 === null) {\n          return null;\n        }\n        return JSON.parse(str2, options == null ? void 0 : options.reviver);\n      };\n      const str = (_a = storage.getItem(name)) != null ? _a : null;\n      if (str instanceof Promise) {\n        return str.then(parse);\n      }\n      return parse(str);\n    },\n    setItem: (name, newValue) => storage.setItem(\n      name,\n      JSON.stringify(newValue, options == null ? void 0 : options.replacer)\n    ),\n    removeItem: (name) => storage.removeItem(name)\n  };\n  return persistStorage;\n}\nconst toThenable = (fn) => (input) => {\n  try {\n    const result = fn(input);\n    if (result instanceof Promise) {\n      return result;\n    }\n    return {\n      then(onFulfilled) {\n        return toThenable(onFulfilled)(result);\n      },\n      catch(_onRejected) {\n        return this;\n      }\n    };\n  } catch (e) {\n    return {\n      then(_onFulfilled) {\n        return this;\n      },\n      catch(onRejected) {\n        return toThenable(onRejected)(e);\n      }\n    };\n  }\n};\nconst oldImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    getStorage: () => localStorage,\n    serialize: JSON.stringify,\n    deserialize: JSON.parse,\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage;\n  try {\n    storage = options.getStorage();\n  } catch (_e) {\n  }\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const thenableSerialize = toThenable(options.serialize);\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    let errorInSync;\n    const thenable = thenableSerialize({ state, version: options.version }).then(\n      (serializedValue) => storage.setItem(options.name, serializedValue)\n    ).catch((e) => {\n      errorInSync = e;\n    });\n    if (errorInSync) {\n      throw errorInSync;\n    }\n    return thenable;\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => cb(get()));\n    const postRehydrationCallback = ((_a = options.onRehydrateStorage) == null ? void 0 : _a.call(options, get())) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((storageValue) => {\n      if (storageValue) {\n        return options.deserialize(storageValue);\n      }\n    }).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return options.migrate(\n              deserializedStorageValue.state,\n              deserializedStorageValue.version\n            );\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return deserializedStorageValue.state;\n        }\n      }\n    }).then((migratedState) => {\n      var _a2;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      return setItem();\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.getStorage) {\n        storage = newOptions.getStorage();\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  hydrate();\n  return stateFromStorage || configResult;\n};\nconst newImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    storage: createJSONStorage(() => localStorage),\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage = options.storage;\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    return storage.setItem(options.name, {\n      state,\n      version: options.version\n    });\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  api.getInitialState = () => configResult;\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a, _b;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => {\n      var _a2;\n      return cb((_a2 = get()) != null ? _a2 : configResult);\n    });\n    const postRehydrationCallback = ((_b = options.onRehydrateStorage) == null ? void 0 : _b.call(options, (_a = get()) != null ? _a : configResult)) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return [\n              true,\n              options.migrate(\n                deserializedStorageValue.state,\n                deserializedStorageValue.version\n              )\n            ];\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return [false, deserializedStorageValue.state];\n        }\n      }\n      return [false, void 0];\n    }).then((migrationResult) => {\n      var _a2;\n      const [migrated, migratedState] = migrationResult;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      if (migrated) {\n        return setItem();\n      }\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      stateFromStorage = get();\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.storage) {\n        storage = newOptions.storage;\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  if (!options.skipHydration) {\n    hydrate();\n  }\n  return stateFromStorage || configResult;\n};\nconst persistImpl = (config, baseOptions) => {\n  if (\"getStorage\" in baseOptions || \"serialize\" in baseOptions || \"deserialize\" in baseOptions) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead.\"\n      );\n    }\n    return oldImpl(config, baseOptions);\n  }\n  return newImpl(config, baseOptions);\n};\nconst persist = persistImpl;\n\nexport { combine, createJSONStorage, devtools, persist, redux, subscribeWithSelector };\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","// Sistema de Ranks e Progresso Visual - HeroForge v2.2\n\nexport type RankLevel = 'F' | 'E' | 'D' | 'C' | 'B' | 'A' | 'S' | 'SS' | 'SSS';\n\nexport interface RankInfo {\n  level: RankLevel;\n  name: string;\n  color: string;\n  icon: string;\n  description: string;\n  gradient: string;\n  textColor: string;\n  glowColor: string;\n}\n\nexport interface RankThreshold {\n  xp: number;\n  missions: number;\n  titles?: number;\n  specialRequirements?: string[];\n}\n\nexport interface RankReward {\n  type: 'visual' | 'gameplay' | 'cosmetic' | 'special';\n  name: string;\n  description: string;\n  icon: string;\n  unlocked: boolean;\n}\n\nexport interface RankProgress {\n  currentRank: RankLevel;\n  nextRank: RankLevel | null;\n  currentXP: number;\n  requiredXP: number;\n  currentMissions: number;\n  requiredMissions: number;\n  progressPercentage: number;\n  canPromote: boolean;\n}\n\nexport interface RankHistory {\n  rank: RankLevel;\n  achievedAt: Date;\n  heroLevel: number;\n  notableAchievement: string;\n  celebrationViewed: boolean;\n}\n\nexport interface RankCelebration {\n  rank: RankLevel;\n  title: string;\n  message: string;\n  rewards: RankReward[];\n  animationType: 'ascension' | 'legendary' | 'epic';\n  soundEffect: string;\n  particleEffect: string;\n}\n\nexport interface HeroRankData {\n  currentRank: RankLevel;\n  rankHistory: RankHistory[];\n  totalRankPoints: number;\n  rankProgress: RankProgress;\n  unlockedRewards: RankReward[];\n  pendingCelebrations: RankCelebration[];\n  rankAchievements: {\n    fastestPromotion: number; // dias\n    highestRankReached: RankLevel;\n    totalPromotions: number;\n    legendaryStoriesUnlocked: number;\n  };\n}\n\nexport interface RankComparison {\n  heroId: string;\n  heroName: string;\n  rank: RankLevel;\n  level: number;\n  totalXP: number;\n  missionsCompleted: number;\n  rankPoints: number;\n  position: number;\n}\n\nexport interface RankLeaderboard {\n  global: RankComparison[];\n  byClass: Record<string, RankComparison[]>;\n  recent: RankComparison[]; // ltimas 24h\n  friends: RankComparison[];\n}\n\n// Configuraes visuais para cada rank\nexport const RANK_CONFIG: Record<RankLevel, RankInfo> = {\n  F: {\n    level: 'F',\n    name: 'Novato',\n    color: '#9CA3AF', // Cinza metlico\n    icon: '',\n    description: 'Um recm-chegado ao mundo das aventuras.',\n    gradient: 'from-gray-400 to-gray-600',\n    textColor: 'text-gray-600',\n    glowColor: 'shadow-gray-400/50'\n  },\n  E: {\n    level: 'E',\n    name: 'Aventureiro',\n    color: '#10B981', // Verde esmeralda\n    icon: '',\n    description: 'Um viajante experiente com pequenas vitrias.',\n    gradient: 'from-emerald-400 to-emerald-600',\n    textColor: 'text-emerald-600',\n    glowColor: 'shadow-emerald-400/50'\n  },\n  D: {\n    level: 'D',\n    name: 'Explorador',\n    color: '#3B82F6', // Azul safira\n    icon: '',\n    description: 'Aventureiro constante, conhecido nas tavernas.',\n    gradient: 'from-blue-400 to-blue-600',\n    textColor: 'text-blue-600',\n    glowColor: 'shadow-blue-400/50'\n  },\n  C: {\n    level: 'C',\n    name: 'Heri Local',\n    color: '#8B5CF6', // Roxo real\n    icon: '',\n    description: 'Reconhecido em cidades e aldeias.',\n    gradient: 'from-purple-400 to-purple-600',\n    textColor: 'text-purple-600',\n    glowColor: 'shadow-purple-400/50'\n  },\n  B: {\n    level: 'B',\n    name: 'Guardio',\n    color: '#F59E0B', // Dourado\n    icon: '',\n    description: 'Um protetor notvel, admirado pelo povo.',\n    gradient: 'from-amber-400 to-amber-600',\n    textColor: 'text-amber-600',\n    glowColor: 'shadow-amber-400/50'\n  },\n  A: {\n    level: 'A',\n    name: 'Campeo',\n    color: '#EF4444', // Vermelho rubi\n    icon: '',\n    description: 'Heri de elite, famoso em todo o reino.',\n    gradient: 'from-red-400 to-red-600',\n    textColor: 'text-red-600',\n    glowColor: 'shadow-red-400/50'\n  },\n  S: {\n    level: 'S',\n    name: 'Lenda Viva',\n    color: '#FFD700', // Dourado com brilho\n    icon: '',\n    description: 'Um mito vivo, smbolo de glria eterna.',\n    gradient: 'from-yellow-300 via-yellow-400 to-amber-500',\n    textColor: 'text-yellow-600',\n    glowColor: 'shadow-yellow-400/75 animate-pulse'\n  }\n  ,\n  SS: {\n    level: 'SS',\n    name: 'cone Imortal',\n    color: '#FFE55C',\n    icon: '',\n    description: 'Alm da lenda: referncia viva de todos os heris.',\n    gradient: 'from-amber-300 via-amber-400 to-yellow-500',\n    textColor: 'text-amber-600',\n    glowColor: 'shadow-amber-300/80 animate-pulse'\n  },\n  SSS: {\n    level: 'SSS',\n    name: 'Mito Absoluto',\n    color: '#FFF1A6',\n    icon: '',\n    description: 'O pinculo da guilda: inspirao eterna.',\n    gradient: 'from-yellow-200 via-yellow-300 to-amber-400',\n    textColor: 'text-yellow-700',\n    glowColor: 'shadow-yellow-200/90 animate-pulse'\n  }\n};\n\n// Thresholds para progresso de rank\nexport const RANK_THRESHOLDS: Record<RankLevel, RankThreshold> = {\n  F: { xp: 0, missions: 0 },\n  E: { xp: 200, missions: 2 },\n  D: { xp: 600, missions: 5 },\n  C: { xp: 1200, missions: 10, titles: 1 },\n  B: { xp: 2500, missions: 20, titles: 2 },\n  A: { xp: 4000, missions: 30, titles: 3, specialRequirements: ['legendary_quest'] },\n  S: { xp: 7000, missions: 50, titles: 5, specialRequirements: ['legendary_quest', 'epic_achievement'] },\n  SS: { xp: 9500, missions: 70, titles: 6, specialRequirements: ['legendary_quest', 'epic_achievement'] },\n  SSS: { xp: 13000, missions: 100, titles: 8, specialRequirements: ['legendary_quest', 'epic_achievement'] }\n};\n\n// Ordem dos ranks para progresso\nexport const RANK_ORDER: RankLevel[] = ['F', 'E', 'D', 'C', 'B', 'A', 'S', 'SS', 'SSS'];\n\n// Recompensas por rank\nexport const RANK_REWARDS: Record<RankLevel, RankReward[]> = {\n  F: [\n    {\n      type: 'visual',\n      name: 'Emblema de Novato',\n      description: 'Seu primeiro emblema de aventureiro',\n      icon: '',\n      unlocked: true\n    }\n  ],\n  E: [\n    {\n      type: 'cosmetic',\n      name: 'Capa Verde',\n      description: 'Uma capa simples mas digna',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'gameplay',\n      name: '+5% XP Bonus',\n      description: 'Experincia adicional em misses',\n      icon: '',\n      unlocked: false\n    }\n  ],\n  D: [\n    {\n      type: 'visual',\n      name: 'Braso de Explorador',\n      description: 'Smbolo de um verdadeiro explorador',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'gameplay',\n      name: 'Misses Especiais',\n      description: 'Acesso a misses de dificuldade mdia',\n      icon: '',\n      unlocked: false\n    }\n  ],\n  C: [\n    {\n      type: 'cosmetic',\n      name: 'Armadura Roxa',\n      description: 'Armadura digna de um heri local',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'gameplay',\n      name: '+10% Gold Bonus',\n      description: 'Ouro adicional em recompensas',\n      icon: '',\n      unlocked: false\n    }\n  ],\n  B: [\n    {\n      type: 'visual',\n      name: 'Aura Dourada',\n      description: 'Uma aura que demonstra seu poder',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'special',\n      name: 'Ttulo de Guardio',\n      description: 'Reconhecimento oficial do reino',\n      icon: '',\n      unlocked: false\n    }\n  ],\n  A: [\n    {\n      type: 'cosmetic',\n      name: 'Capa de Campeo',\n      description: 'Capa vermelha dos grandes heris',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'special',\n      name: 'Histria pica IA',\n      description: 'Histria personalizada gerada por IA',\n      icon: '',\n      unlocked: false\n    }\n  ],\n  S: [\n    {\n      type: 'special',\n      name: 'Lenda Personalizada',\n      description: 'Histria e imagem lendria nica',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'visual',\n      name: 'Efeito Lendrio',\n      description: 'Partculas e brilho permanente',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'gameplay',\n      name: 'Acesso Total',\n      description: 'Todas as funcionalidades desbloqueadas',\n      icon: '',\n      unlocked: false\n    }\n  ],\n  SS: [\n    {\n      type: 'gameplay',\n      name: 'Habilidade Exclusiva: Ordem Superior',\n      description: 'Nova habilidade de elite disponvel na rvore de talentos',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'cosmetic',\n      name: 'Traje cone Imortal',\n      description: 'Visual nico da guilda para SS',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'visual',\n      name: 'Aura Mtica',\n      description: 'Aura dourada reforada',\n      icon: '',\n      unlocked: false\n    }\n  ],\n  SSS: [\n    {\n      type: 'special',\n      name: 'Carta de Parabenizao da Guilda',\n      description: 'Mensagem oficial celebrando sua ascenso ao topo',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'gameplay',\n      name: 'Convite para Misses Mticas',\n      description: 'Desbloqueia misso de raridade mtica',\n      icon: '',\n      unlocked: false\n    },\n    {\n      type: 'cosmetic',\n      name: 'Coroa do Mito Absoluto',\n      description: 'Adorno nico para SSS',\n      icon: '',\n      unlocked: false\n    }\n  ]\n};\n\n// Bnus de XP por Rank (cada promoo concede +5%)\nexport const RANK_XP_BONUS_PERCENT: Record<RankLevel, number> = {\n  F: 0,\n  E: 5,\n  D: 10,\n  C: 15,\n  B: 20,\n  A: 25,\n  S: 30,\n  SS: 35,\n  SSS: 45\n};\n\n// Perfil de misses por Rank (melhoria de qualidade e raridade)\nexport const RANK_MISSION_PROFILE: Record<RankLevel, { epicSlots: number; rewardMultiplier: number }> = {\n  F: { epicSlots: 1, rewardMultiplier: 1.0 },\n  E: { epicSlots: 1, rewardMultiplier: 1.05 },\n  D: { epicSlots: 1, rewardMultiplier: 1.1 },\n  C: { epicSlots: 1, rewardMultiplier: 1.12 },\n  B: { epicSlots: 1, rewardMultiplier: 1.15 },\n  A: { epicSlots: 1, rewardMultiplier: 1.18 },\n  S: { epicSlots: 2, rewardMultiplier: 1.22 },\n  SS: { epicSlots: 2, rewardMultiplier: 1.25 },\n  SSS: { epicSlots: 3, rewardMultiplier: 1.3 }\n};","/**\n * Sistema de Misses - Gerao Procedural e Templates\n */\n\nimport { Quest, QuestType, QuestDifficulty, QuestReward, QuestEnemy } from '../types/hero';\nimport { RankLevel, RANK_MISSION_PROFILE } from '../types/ranks';\n\n// === TEMPLATES DE MISSES ===\n\ninterface QuestTemplate {\n  id: string;\n  titleTemplate: string;\n  descriptionTemplate: string;\n  type: QuestType;\n  baseReward: QuestReward;\n  enemies?: QuestEnemy[];\n  modifiers?: string[];\n}\n\nconst QUEST_TEMPLATES: QuestTemplate[] = [\n  // CONTRATOS (Entrega/Escolta)\n  {\n    id: 'contrato-entrega',\n    titleTemplate: 'Entrega para {location}',\n    descriptionTemplate: 'Leve esta {item} para {npc} em {location}. Cuidado com {threat} no caminho.',\n    type: 'contrato',\n    baseReward: { gold: 30, xp: 20, glory: 2 },\n    modifiers: ['neblina', 'bandidos', 'tempo-ruim']\n  },\n  {\n    id: 'contrato-escolta',\n    titleTemplate: 'Escolta de {npc}',\n    descriptionTemplate: 'Proteja {npc} durante a viagem at {location}. H relatos de {threat} na regio.',\n    type: 'contrato',\n    baseReward: { gold: 50, xp: 35, glory: 3 },\n    enemies: [{ type: 'Bandido', count: 2 }]\n  },\n\n  // CAA (Derrotar inimigos)\n  {\n    id: 'caca-lobos',\n    titleTemplate: 'Perigo na {location}',\n    descriptionTemplate: 'Uma matilha de {enemy} est aterrorizando {location}. Derrote {count} deles.',\n    type: 'caca',\n    baseReward: { gold: 40, xp: 30, glory: 2 },\n    enemies: [{ type: 'Lobo', count: 3 }]\n  },\n  {\n    id: 'caca-goblins',\n    titleTemplate: 'Invaso Goblin',\n    descriptionTemplate: 'Goblins esto saqueando {location}. Elimine {count} invasores.',\n    type: 'caca',\n    baseReward: { gold: 60, xp: 45, glory: 3 },\n    enemies: [{ type: 'Goblin', count: 4 }]\n  },\n\n  // EXPLORAO (Encontrar/Descobrir)\n  {\n    id: 'exploracao-artefato',\n    titleTemplate: 'Artefato Perdido',\n    descriptionTemplate: 'Encontre o {artifact} perdido nas {location}. Dizem que est guardado por {guardian}.',\n    type: 'exploracao',\n    baseReward: { gold: 80, xp: 60, glory: 4, arcaneEssence: 1, items: [{ id: 'pocao-media', qty: 1 }] },\n    enemies: [{ type: 'Esqueleto', count: 2 }]\n  },\n  {\n    id: 'exploracao-mapa',\n    titleTemplate: 'Mapeamento de {location}',\n    descriptionTemplate: 'Explore e mapeie a regio de {location}. Registre pontos de interesse e perigos.',\n    type: 'exploracao',\n    baseReward: { gold: 70, xp: 50, glory: 3 }\n  },\n\n  // HISTRIA (Ramificada)\n  {\n    id: 'historia-misterio',\n    titleTemplate: 'Mistrio em {location}',\n    descriptionTemplate: 'Estranhos eventos ocorrem em {location}. Investigue e descubra a verdade.',\n    type: 'historia',\n    baseReward: { gold: 100, xp: 80, glory: 5, arcaneEssence: 1, items: [{ id: 'pergaminho-xp', qty: 1 }] }\n  }\n];\n\n// === TEMPLATES DE MISSES DE COMPANHEIROS (GUILDA) ===\nconst COMPANION_GUILD_TEMPLATES: QuestTemplate[] = [\n  {\n    id: 'guild-treinar-mascote',\n    titleTemplate: 'Treinar o Mascote com {npc}',\n    descriptionTemplate: 'Participe de treinos supervisionados em {location} com {npc}. Aumente a experincia do seu mascote.',\n    type: 'caca',\n    baseReward: { gold: 40, xp: 35, glory: 3, items: [{ id: 'racao-basica', qty: 2 }, { id: 'pedra-alma', qty: 1 }] }\n  },\n  {\n    id: 'guild-capturar-criatura',\n    titleTemplate: 'Capturar uma Criatura Jovem em {location}',\n    descriptionTemplate: 'Localize e capture uma criatura jovem com a ajuda de {npc}. Traga o espcime para estudo.',\n    type: 'exploracao',\n    baseReward: { gold: 60, xp: 50, glory: 4, arcaneEssence: 1, items: [{ id: 'essencia-vinculo', qty: 1 }] }\n  },\n  {\n    id: 'guild-acalmar-fera',\n    titleTemplate: 'Acalmar uma Fera Selvagem perto de {location}',\n    descriptionTemplate: 'Aproxime-se com cuidado e acalme a fera sob orientao de {npc}. Evite confrontos desnecessrios.',\n    type: 'caca',\n    baseReward: { gold: 70, xp: 55, glory: 4, items: [{ id: 'racao-deluxe', qty: 1 }] },\n    enemies: [{ type: 'Lobo', count: 1 }]\n  },\n  {\n    id: 'guild-essencia-bestial',\n    titleTemplate: 'Encontrar a Essncia Bestial em {location}',\n    descriptionTemplate: 'Explore runas e cavernas antigas com {npc} para recuperar a Essncia Bestial.',\n    type: 'exploracao',\n    baseReward: { gold: 90, xp: 70, glory: 5, arcaneEssence: 1, items: [{ id: 'essencia-bestial', qty: 1 }] }\n  }\n  ,\n  {\n    id: 'guild-ovo-basico',\n    titleTemplate: 'Primeiro Ovo da Guilda em {location}',\n    descriptionTemplate: 'Participe de uma coleta supervisionada com {npc} para obter um ovo comum.',\n    type: 'exploracao',\n    baseReward: { gold: 30, xp: 40, glory: 3, items: [{ id: 'reward-egg-basico', qty: 1 }] }\n  }\n];\n\n// === DADOS PARA GERAO PROCEDURAL ===\n\nconst LOCATIONS = [\n  'Vila do Vale', 'Bosque Sombrio', 'Montanhas Geladas', 'Pntano Negro',\n  'Runas Antigas', 'Porto dos Ventos', 'Cavernas Profundas', 'Torre Abandonada',\n  'Floresta Encantada', 'Deserto Ardente', 'Cidade Perdida', 'Cemitrio Assombrado'\n];\n\nconst NPCS = [\n  'Mercador Aldric', 'Sbia Elara', 'Ferreiro Gorin', 'Curandeira Mira',\n  'Capito Theron', 'Escriba Lysander', 'Caador Kael', 'Bruxa Morgana'\n];\n\nconst ITEMS = [\n  'carta importante', 'poo rara', 'mapa antigo', 'gema preciosa',\n  'pergaminho mgico', 'relquia sagrada', 'chave misteriosa', 'amuleto protetor'\n];\n\nconst ARTIFACTS = [\n  'Orbe de Cristal', 'Espada lfica', 'Anel dos Antigos', 'Cajado do Poder',\n  'Escudo Sagrado', 'Coroa Perdida', 'Livro dos Segredos', 'Clice Dourado'\n];\n\nconst THREATS = [\n  'bandidos', 'lobos famintos', 'espritos inquietos', 'goblins selvagens',\n  'trolls das montanhas', 'serpentes venenosas', 'mortos-vivos', 'drages jovens'\n];\n\nconst GUARDIANS = [\n  'um golem de pedra', 'esqueletos guerreiros', 'um troll antigo',\n  'espritos guardies', 'uma hidra menor', 'grgulas de pedra'\n];\n\n// === MODIFICADORES DE DIFICULDADE ===\n\nconst DIFFICULTY_MODIFIERS = {\n  rapida: {\n    goldMultiplier: 0.7,\n    xpMultiplier: 0.8,\n    enemyCountMultiplier: 0.7\n  },\n  padrao: {\n    goldMultiplier: 1.0,\n    xpMultiplier: 1.0,\n    enemyCountMultiplier: 1.0\n  },\n  epica: {\n    goldMultiplier: 1.5,\n    xpMultiplier: 1.8,\n    enemyCountMultiplier: 1.4\n  }\n};\n\n// === FUNES DE GERAO ===\n\nfunction getRandomElement<T>(array: T[]): T {\n  return array[Math.floor(Math.random() * array.length)];\n}\n\nfunction interpolateTemplate(template: string, variables: Record<string, string>): string {\n  return template.replace(/\\{(\\w+)\\}/g, (match, key) => variables[key] || match);\n}\n\nfunction applyDifficultyModifier(baseReward: QuestReward, difficulty: QuestDifficulty): QuestReward {\n  const modifier = DIFFICULTY_MODIFIERS[difficulty];\n  \n  return {\n    gold: Math.floor(baseReward.gold * modifier.goldMultiplier),\n    xp: Math.floor(baseReward.xp * modifier.xpMultiplier),\n    items: baseReward.items,\n    glory: baseReward.glory ? Math.floor(baseReward.glory * modifier.goldMultiplier) : undefined,\n    arcaneEssence: baseReward.arcaneEssence ? Math.floor(baseReward.arcaneEssence * modifier.goldMultiplier) : undefined\n  };\n}\n\nfunction generateEnemies(baseEnemies: QuestEnemy[] = [], difficulty: QuestDifficulty): QuestEnemy[] {\n  const modifier = DIFFICULTY_MODIFIERS[difficulty];\n  \n  return baseEnemies.map(enemy => ({\n    ...enemy,\n    count: Math.max(1, Math.floor(enemy.count * modifier.enemyCountMultiplier)),\n    level: difficulty === 'rapida' ? 1 : difficulty === 'padrao' ? 2 : 3\n  }));\n}\n\nexport function generateQuest(\n  difficulty: QuestDifficulty = 'padrao',\n  heroLevel: number = 1,\n  isGuildQuest: boolean = false\n): Quest {\n  const template = isGuildQuest ? getRandomElement(COMPANION_GUILD_TEMPLATES) : getRandomElement(QUEST_TEMPLATES);\n  const modifier = DIFFICULTY_MODIFIERS[difficulty];\n  \n  // Variveis para interpolao\n  const variables = {\n    location: getRandomElement(LOCATIONS),\n    npc: getRandomElement(NPCS),\n    item: getRandomElement(ITEMS),\n    artifact: getRandomElement(ARTIFACTS),\n    threat: getRandomElement(THREATS),\n    guardian: getRandomElement(GUARDIANS),\n    enemy: template.enemies?.[0]?.type || 'Inimigo',\n    count: template.enemies?.[0]?.count.toString() || '1'\n  };\n  \n  // Gerar ID nico\n  const questId = `quest-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  \n  // Aplicar modificadores\n  const rewards = applyDifficultyModifier(template.baseReward, difficulty);\n  const enemies = template.enemies ? generateEnemies(template.enemies, difficulty) : undefined;\n  \n  const quest = {\n    id: questId,\n    title: interpolateTemplate(template.titleTemplate, variables),\n    description: interpolateTemplate(template.descriptionTemplate, variables),\n    type: template.type,\n    difficulty,\n    levelRequirement: Math.max(1, heroLevel - 1),\n    timeLimit: (() => {\n      if (difficulty === 'rapida') return Math.floor(Math.random() * 16) + 5;\n      if (difficulty === 'epica') return Math.floor(Math.random() * 61) + 120;\n      return 60;\n    })(),\n    enemies,\n    rewards,\n    repeatable: template.type === 'caca' || template.type === 'contrato',\n    isGuildQuest,\n    failurePenalty: difficulty === 'epica' ? { gold: 20, reputation: -5 } : undefined,\n    templateId: template.id,\n    categoryHint: template.id === 'contrato-escolta' ? 'escolta' : (template.type === 'caca' ? 'controle' : (template.type === 'exploracao' ? 'coleta' : undefined)),\n    biomeHint: (() => {\n      const loc = variables.location;\n      if (loc === 'Runas Antigas') return 'Runas Antigas';\n      if (loc === 'Cavernas Profundas') return 'Caverna Antiga';\n      if (loc === 'Floresta Encantada') return 'Floresta Nebulosa';\n      if (loc === 'Bosque Sombrio') return 'Floresta Umbral';\n      if (loc === 'Montanhas Geladas') return 'Colinas de Boravon';\n      if (loc === 'Porto dos Ventos' || loc === 'Rio Marfim') return 'Rio Marfim';\n      return 'Floresta Nebulosa';\n    })(),\n    phasesHint: difficulty === 'rapida' ? 3 : difficulty === 'epica' ? 6 : 4,\n    baseRewardsHint: { xp: rewards.xp, gold: rewards.gold }\n  };\n  \n  if (isGuildQuest) {\n    console.log(' Misso de guilda gerada:', quest.title, '- Dificuldade:', difficulty);\n  }\n  \n  return quest;\n}\n\nexport function generateQuestBoard(heroLevel: number = 1, guildLevel: number = 0, heroRank: RankLevel = 'F'): Quest[] {\n  console.log(' generateQuestBoard chamada:', { heroLevel, guildLevel });\n  const quests: Quest[] = [];\n  const profile = RANK_MISSION_PROFILE[heroRank] || RANK_MISSION_PROFILE['F'];\n  const basicsMastered = (() => {\n    try {\n      const raw = localStorage.getItem('heroforge-onboarding');\n      const st = raw ? JSON.parse(raw) : {};\n      const steps: string[] = Array.isArray(st?.validatedSteps) ? st.validatedSteps : [];\n      const hasTraining = localStorage.getItem('hfn_training_basic_done') === '1';\n      return steps.includes('create-hero') && steps.includes('accept-quest') && hasTraining;\n    } catch { return false; }\n  })();\n  // Para rank F, nunca retornar vazio: priorizar misses de coleta/escolta\n  const preferBasicsOnly = heroRank === 'F' && !basicsMastered;\n  \n  // 2 misses rpidas\n  quests.push(generateQuest('rapida', heroLevel));\n  quests.push(generateQuest('rapida', heroLevel));\n  \n  // 3 misses padro\n  quests.push(generateQuest('padrao', heroLevel));\n  quests.push(generateQuest('padrao', heroLevel));\n  quests.push(generateQuest('padrao', heroLevel));\n  \n  // Misses picas por perfil de Rank\n  for (let i = 0; i < Math.max(1, profile.epicSlots); i++) {\n    quests.push(generateQuest('epica', heroLevel));\n  }\n  \n  // Misses de guilda (se aplicvel)\n  console.log(' Verificando misses de guilda - guildLevel:', guildLevel);\n  if (guildLevel > 0) {\n    console.log(' Gerando misso de guilda padro');\n    quests.push(generateQuest('padrao', heroLevel, true));\n    if (guildLevel >= 3) {\n      console.log(' Gerando misso de guilda pica');\n      quests.push(generateQuest('epica', heroLevel, true));\n    }\n    if (heroLevel >= 5) {\n      const variables = {\n        location: getRandomElement(LOCATIONS),\n        npc: getRandomElement(NPCS)\n      } as any;\n      const qid = `guild-ovo-${Date.now()}-${Math.random().toString(36).slice(2)}`;\n      quests.push({\n        id: qid,\n        title: interpolateTemplate('Primeiro Ovo da Guilda em {location}', variables),\n        description: interpolateTemplate('Participe de uma coleta supervisionada com {npc} para obter um ovo comum.', variables),\n        type: 'exploracao',\n        difficulty: 'padrao',\n        levelRequirement: Math.max(5, heroLevel),\n        timeLimit: 60,\n        enemies: undefined,\n        rewards: { gold: 30, xp: 40, glory: 3, items: [{ id: 'reward-egg-basico', qty: 1 }] },\n        repeatable: false,\n        isGuildQuest: true,\n        failurePenalty: { gold: 10 },\n        templateId: 'guild-ovo-basico',\n        categoryHint: 'coleta'\n      } as any);\n      console.log(' Misso especial da guilda para Estbulo inserida');\n    }\n  } else {\n    console.log(' Nenhuma misso de guilda gerada - guildLevel  0');\n  }\n  \n  const guildQuests = quests.filter(q => q.isGuildQuest);\n  console.log(' Misses geradas:', {\n    total: quests.length,\n    guildQuests: guildQuests.length,\n    guildQuestTitles: guildQuests.map(q => q.title)\n  });\n\n  // Aplicar multiplicador de recompensa por Rank\n  const tuned = quests.map(q => ({\n    ...q,\n    rewards: {\n      ...q.rewards,\n      gold: Math.floor((q.rewards?.gold || 0) * profile.rewardMultiplier),\n      xp: Math.floor((q.rewards?.xp || 0) * profile.rewardMultiplier)\n    }\n  }));\n  // Garantir presena de pelo menos uma misso de escolta\n  const hasEscolta = tuned.some(q => q.categoryHint === 'escolta');\n  if (!hasEscolta) {\n    const variables = {\n      location: getRandomElement(LOCATIONS),\n      npc: getRandomElement(NPCS),\n      threat: getRandomElement(THREATS)\n    } as any;\n    const escortId = `quest-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    tuned.push({\n      id: escortId,\n      title: interpolateTemplate('Escolta de {npc}', variables),\n      description: interpolateTemplate('Proteja {npc} durante a viagem at {location}. H relatos de {threat} na regio.', variables),\n      type: 'contrato',\n      difficulty: 'padrao',\n      levelRequirement: Math.max(1, heroLevel - 1),\n      timeLimit: 60,\n      enemies: [{ type: 'Bandido', count: 2, level: 2 }],\n      rewards: applyDifficultyModifier({ gold: 50, xp: 35, glory: 3 }, 'padrao'),\n      repeatable: true,\n      isGuildQuest: false,\n      failurePenalty: undefined,\n      templateId: 'contrato-escolta',\n      categoryHint: 'escolta',\n      phasesHint: 4,\n      baseRewardsHint: { xp: 35, gold: 50 }\n    } as any);\n  }\n\n  // Para rank F com onboarding feito, mostrar coleta e escolta\n  if (heroRank === 'F' && basicsMastered) {\n    return tuned.filter(q => q.categoryHint === 'coleta' || q.categoryHint === 'escolta');\n  }\n  // Para rank F sem onboarding feito, restringir a coleta/escolta (no vazio)\n  if (preferBasicsOnly) {\n    const basicList = tuned.filter(q => q.categoryHint === 'coleta' || q.categoryHint === 'escolta');\n    return basicList.length ? basicList : tuned;\n  }\n  return tuned;\n}\n\n// === SISTEMA DE ACHIEVEMENTS RELACIONADOS A MISSES ===\n\nexport const QUEST_ACHIEVEMENTS = [\n  {\n    id: 'primeira-missao',\n    title: 'Primeira Misso',\n    description: 'Complete sua primeira misso',\n    icon: '',\n    maxProgress: 1\n  },\n  {\n    id: 'heroi-da-vila',\n    title: 'Heri da Vila',\n    description: 'Complete 10 misses',\n    icon: '',\n    maxProgress: 10\n  },\n  {\n    id: 'cacador-experiente',\n    title: 'Caador Experiente',\n    description: 'Complete 5 misses de caa',\n    icon: '',\n    maxProgress: 5\n  },\n  {\n    id: 'explorador-corajoso',\n    title: 'Explorador Corajoso',\n    description: 'Complete 3 misses de explorao',\n    icon: '',\n    maxProgress: 3\n  },\n  {\n    id: 'lenda-epica',\n    title: 'Lenda pica',\n    description: 'Complete uma misso pica',\n    icon: '',\n    maxProgress: 1\n  }\n  ,\n  {\n    id: 'amigo-dos-animais',\n    title: 'Amigo dos Animais',\n    description: 'Complete 5 misses de companheiros da guilda',\n    icon: '',\n    maxProgress: 5\n  },\n  {\n    id: 'domador-de-feras',\n    title: 'Domador de Feras',\n    description: 'Coletar 3 Essncias Bestiais',\n    icon: '',\n    maxProgress: 3\n  },\n  {\n    id: 'cavaleiro-mitico',\n    title: 'Cavaleiro Mtico',\n    description: 'Encontrar 2 Pergaminhos de Montaria',\n    icon: '',\n    maxProgress: 2\n  }\n];\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface GameSettingsState {\n  regenHpPerMin: number;\n  regenMpPerMin: number;\n  regenStaminaPerMin: number;\n  deathRecoveryMinutes: number;\n  deathPenaltyEnabled: boolean;\n\n  restBuffHpMpMultiplier?: number;\n  restBuffStaminaMultiplier?: number;\n  restBuffDurationMinutes?: number;\n  meditationMpBonusPerMin?: number;\n  meditationDurationMinutes?: number;\n  meditationCooldownMinutes?: number;\n  dungeonRegenMultiplier?: number;\n\n  // Buffs globais aplicados pela Guilda (Conselho)\n  guildXpBuffPercent?: number; // ex.: 20 para +20% XP\n  trainingCostReductionPercent?: number; // ex.: 10 para -10% custo\n  activeGuildEventName?: string;\n  guildEventExpiresAt?: string; // ISO timestamp\n  guildBuffSourceGuildId?: string; // para rastrear origem\n\n  inviteLinksEnabled: boolean;\n  inviteLinkValidityDays: number;\n  invitePrivacyLevel: 'public' | 'friends' | 'private';\n  inviteShareIncludeContacts: boolean;\n  inviteRewardGold: number;\n  inviteRewardXP: number;\n\n  // NPC Immersive mode and dialogue fine-tuning\n  npcImmersiveModeEnabled?: boolean;\n  npcDialogueWhisperProb?: number; // 0..1\n  npcDialogueThoughtProb?: number; // 0..1\n  npcBiomeLexiconEnabled?: boolean;\n  npcSeedTarget?: number;\n  npcVisibleCap?: number;\n  npcRotationSeconds?: number;\n  npcNotificationsMode?: 'off' | 'compact' | 'normal';\n  npcNotifyMaxPerTick?: number;\n  npcInteractionDifficulty?: 'low' | 'normal' | 'high';\n  npcRelationKnownThreshold?: number;\n  npcRelationFriendThreshold?: number;\n  npcRelationBestFriendThreshold?: number;\n  npcRelationAllyThreshold?: number;\n  npcRelationRivalThreshold?: number;\n  npcDuelRivalryModerate?: number;\n  npcDuelRivalryHigh?: number;\n  npcDuelLevelDiffMax?: number;\n  npcInteractionCooldownSeconds?: number;\n  npcRelationDecayPerDay?: number;\n  npcRelationPositiveWeight?: number;\n  npcRelationNegativeWeight?: number;\n  npcRelationFactionCascadePercent?: number;\n  relationIntensityPercent?: number;\n  eventsCascadePerDay?: number;\n  interactionsCooldownMinutes?: number;\n  randomEventsEnabled?: boolean;\n  eventsCooldownDaysMin?: number;\n  eventsCooldownDaysMax?: number;\n  rivalEncounterChance?: number;\n  autoInteractionEnabled?: boolean;\n  autoChanceMinPercent?: number;\n  autoChanceMaxPercent?: number;\n  notifSoundEnabled?: boolean;\n  notifVisualMode?: 'compact' | 'full';\n  notifPriorityMode?: 'important_first' | 'normal';\n  notifFrequency?: 'low' | 'normal' | 'high';\n  dailyNpcInteractionsLimit?: number;\n\n  reducedMotionEnabled?: boolean;\n  saveDataEnabled?: boolean;\n  networkEffectiveType?: string;\n\n  updateSettings: (updates: Partial<GameSettingsState>) => void;\n  resetDefaults: () => void;\n  applyGuildBuffs: (params: {\n    xpBuffPercent?: number;\n    trainingDiscountPercent?: number;\n    eventName?: string;\n    expiresAt?: string;\n    sourceGuildId?: string;\n  }) => void;\n  clearGuildBuffs: () => void;\n}\n\nconst DEFAULTS = {\n  regenHpPerMin: 6,\n  regenMpPerMin: 5,\n  regenStaminaPerMin: 5,\n  deathRecoveryMinutes: 10,\n  deathPenaltyEnabled: true,\n  restBuffHpMpMultiplier: 1.5,\n  restBuffStaminaMultiplier: 2,\n  restBuffDurationMinutes: 10,\n  meditationMpBonusPerMin: 8,\n  meditationDurationMinutes: 2,\n  meditationCooldownMinutes: 10,\n  dungeonRegenMultiplier: 0.5,\n  inviteLinksEnabled: true,\n  inviteLinkValidityDays: 7,\n  invitePrivacyLevel: 'public' as const,\n  inviteShareIncludeContacts: false,\n  inviteRewardGold: 100,\n  inviteRewardXP: 150,\n  npcImmersiveModeEnabled: false,\n  npcDialogueWhisperProb: 0.25,\n  npcDialogueThoughtProb: 0.35,\n  npcBiomeLexiconEnabled: true,\n  npcSeedTarget: 30,\n  npcVisibleCap: 6,\n  npcRotationSeconds: 60,\n  npcNotificationsMode: 'compact' as const,\n  npcNotifyMaxPerTick: 3,\n  npcInteractionDifficulty: 'normal' as const,\n  npcRelationKnownThreshold: 10,\n  npcRelationFriendThreshold: 40,\n  npcRelationBestFriendThreshold: 75,\n  npcRelationAllyThreshold: 90,\n  npcRelationRivalThreshold: -30,\n  npcDuelRivalryModerate: -30,\n  npcDuelRivalryHigh: -60,\n  npcDuelLevelDiffMax: 5,\n  npcInteractionCooldownSeconds: 90,\n  npcRelationDecayPerDay: 1,\n  npcRelationPositiveWeight: 4,\n  npcRelationNegativeWeight: 5,\n  npcRelationFactionCascadePercent: 0.005,\n  relationIntensityPercent: 100,\n  eventsCascadePerDay: 2,\n  interactionsCooldownMinutes: 15,\n  randomEventsEnabled: true,\n  eventsCooldownDaysMin: 2,\n  eventsCooldownDaysMax: 4,\n  rivalEncounterChance: 0.2,\n  autoInteractionEnabled: true,\n  autoChanceMinPercent: 30,\n  autoChanceMaxPercent: 70,\n  notifSoundEnabled: true,\n  notifVisualMode: 'compact' as const,\n  notifPriorityMode: 'important_first' as const,\n  notifFrequency: 'normal' as const,\n  dailyNpcInteractionsLimit: 2,\n  reducedMotionEnabled: false,\n  saveDataEnabled: false,\n  networkEffectiveType: 'unknown',\n};\n\nexport const useGameSettingsStore = create<GameSettingsState>()(\n  persist(\n    (set, get) => ({\n      ...DEFAULTS,\n      updateSettings: (updates) => {\n        const next = { ...get(), ...updates } as GameSettingsState;\n        set(next);\n      },\n      resetDefaults: () => set(DEFAULTS),\n      applyGuildBuffs: ({ xpBuffPercent, trainingDiscountPercent, eventName, expiresAt, sourceGuildId }) => {\n        const current = get();\n        set({\n          ...current,\n          guildXpBuffPercent: xpBuffPercent ?? current.guildXpBuffPercent ?? 0,\n          trainingCostReductionPercent: trainingDiscountPercent ?? current.trainingCostReductionPercent ?? 0,\n          activeGuildEventName: eventName ?? current.activeGuildEventName,\n          guildEventExpiresAt: expiresAt ?? current.guildEventExpiresAt,\n          guildBuffSourceGuildId: sourceGuildId ?? current.guildBuffSourceGuildId,\n        });\n      },\n      clearGuildBuffs: () => {\n        const current = get();\n        set({\n          ...current,\n          guildXpBuffPercent: 0,\n          trainingCostReductionPercent: 0,\n          activeGuildEventName: undefined,\n          guildEventExpiresAt: undefined,\n          guildBuffSourceGuildId: undefined,\n        });\n      }\n    }),\n    {\n      name: 'heroforge-game-settings',\n      version: 1,\n      partialize: (state) => ({\n        regenHpPerMin: state.regenHpPerMin,\n        regenMpPerMin: state.regenMpPerMin,\n        regenStaminaPerMin: state.regenStaminaPerMin,\n        deathRecoveryMinutes: state.deathRecoveryMinutes,\n        deathPenaltyEnabled: state.deathPenaltyEnabled,\n        restBuffHpMpMultiplier: state.restBuffHpMpMultiplier,\n        restBuffStaminaMultiplier: state.restBuffStaminaMultiplier,\n        restBuffDurationMinutes: state.restBuffDurationMinutes,\n        meditationMpBonusPerMin: state.meditationMpBonusPerMin,\n        meditationDurationMinutes: state.meditationDurationMinutes,\n        meditationCooldownMinutes: state.meditationCooldownMinutes,\n        dungeonRegenMultiplier: state.dungeonRegenMultiplier,\n        guildXpBuffPercent: state.guildXpBuffPercent,\n        trainingCostReductionPercent: state.trainingCostReductionPercent,\n        activeGuildEventName: state.activeGuildEventName,\n        guildEventExpiresAt: state.guildEventExpiresAt,\n        guildBuffSourceGuildId: state.guildBuffSourceGuildId,\n        inviteLinksEnabled: state.inviteLinksEnabled,\n        inviteLinkValidityDays: state.inviteLinkValidityDays,\n        invitePrivacyLevel: state.invitePrivacyLevel,\n        inviteShareIncludeContacts: state.inviteShareIncludeContacts,\n        inviteRewardGold: state.inviteRewardGold,\n        inviteRewardXP: state.inviteRewardXP,\n        npcImmersiveModeEnabled: state.npcImmersiveModeEnabled,\n        npcDialogueWhisperProb: state.npcDialogueWhisperProb,\n        npcDialogueThoughtProb: state.npcDialogueThoughtProb,\n        npcBiomeLexiconEnabled: state.npcBiomeLexiconEnabled,\n        npcSeedTarget: state.npcSeedTarget,\n        npcVisibleCap: state.npcVisibleCap,\n        npcRotationSeconds: state.npcRotationSeconds,\n        npcNotificationsMode: state.npcNotificationsMode,\n        npcNotifyMaxPerTick: state.npcNotifyMaxPerTick,\n        npcInteractionDifficulty: state.npcInteractionDifficulty,\n        npcRelationKnownThreshold: state.npcRelationKnownThreshold,\n        npcRelationFriendThreshold: state.npcRelationFriendThreshold,\n        npcRelationBestFriendThreshold: state.npcRelationBestFriendThreshold,\n        npcRelationAllyThreshold: state.npcRelationAllyThreshold,\n        npcRelationRivalThreshold: state.npcRelationRivalThreshold,\n        npcDuelRivalryModerate: state.npcDuelRivalryModerate,\n        npcDuelRivalryHigh: state.npcDuelRivalryHigh,\n        npcDuelLevelDiffMax: state.npcDuelLevelDiffMax,\n        npcInteractionCooldownSeconds: state.npcInteractionCooldownSeconds,\n        npcRelationDecayPerDay: state.npcRelationDecayPerDay,\n        npcRelationPositiveWeight: state.npcRelationPositiveWeight,\n        npcRelationNegativeWeight: state.npcRelationNegativeWeight,\n        npcRelationFactionCascadePercent: state.npcRelationFactionCascadePercent,\n        relationIntensityPercent: state.relationIntensityPercent,\n        eventsCascadePerDay: state.eventsCascadePerDay,\n        interactionsCooldownMinutes: state.interactionsCooldownMinutes,\n        randomEventsEnabled: state.randomEventsEnabled,\n        eventsCooldownDaysMin: state.eventsCooldownDaysMin,\n        eventsCooldownDaysMax: state.eventsCooldownDaysMax,\n        rivalEncounterChance: state.rivalEncounterChance,\n        autoInteractionEnabled: state.autoInteractionEnabled,\n        autoChanceMinPercent: state.autoChanceMinPercent,\n        autoChanceMaxPercent: state.autoChanceMaxPercent,\n        notifSoundEnabled: state.notifSoundEnabled,\n        notifVisualMode: state.notifVisualMode,\n        notifPriorityMode: state.notifPriorityMode,\n        notifFrequency: state.notifFrequency,\n        dailyNpcInteractionsLimit: state.dailyNpcInteractionsLimit,\n        reducedMotionEnabled: state.reducedMotionEnabled,\n        saveDataEnabled: state.saveDataEnabled,\n        networkEffectiveType: state.networkEffectiveType,\n      }),\n    }\n  )\n);\n\n// Helper para acesso fora de componentes React\nexport const getGameSettings = () => useGameSettingsStore.getState();\n","import { Hero } from '../types/hero';\nimport { getGameSettings } from '../store/gameSettingsStore';\n\nexport type RelationTier = 'rival' | 'neutro' | 'conhecido' | 'amigo' | 'melhor_amigo' | 'aliado';\n\nfunction clamp(v: number, min: number, max: number) { return Math.max(min, Math.min(max, v)); }\n\nexport function computeTier(v: number): RelationTier {\n  const s = getGameSettings();\n  if (v <= (s.npcRelationRivalThreshold ?? -30)) return 'rival';\n  if (v >= (s.npcRelationAllyThreshold ?? 90)) return 'aliado';\n  if (v >= (s.npcRelationBestFriendThreshold ?? 75)) return 'melhor_amigo';\n  if (v >= (s.npcRelationFriendThreshold ?? 40)) return 'amigo';\n  if (v >= (s.npcRelationKnownThreshold ?? 10)) return 'conhecido';\n  return 'neutro';\n}\n\nexport function applyDecay(npc: Hero, targetId: string) {\n  const s = getGameSettings();\n  const last = npc.npcMemory?.lastContactByHeroId?.[targetId];\n  const rel = (npc.socialRelations || {})[targetId] || 0;\n  if (!last) return rel;\n  const elapsedDays = (Date.now() - new Date(last).getTime()) / (24 * 60 * 60 * 1000);\n  const decayPerDay = s.npcRelationDecayPerDay ?? 0.5;\n  const decayed = rel - elapsedDays * decayPerDay;\n  const newVal = clamp(decayed, -100, 100);\n  const map = { ...(npc.socialRelations || {}) };\n  map[targetId] = newVal;\n  npc.socialRelations = map;\n  return newVal;\n}\n\nexport function updateOnSocial(npc: Hero, player: Hero, mood: 'amigvel' | 'neutro' | 'hostil') {\n  const s = getGameSettings();\n  const basePos = s.npcRelationPositiveWeight ?? 4;\n  const baseNeg = s.npcRelationNegativeWeight ?? 5;\n  const mem = npc.npcMemory || { interactions: [], preferences: {}, scoreByAction: {}, friendStatusByHeroId: {}, lastContactByHeroId: {}, lastInteractionByType: {} };\n  const historyBoost = mem.interactions.filter(i => i.heroId === player.id && (i.impact || 0) > 0).length;\n  const timeBoost = mem.lastContactByHeroId?.[player.id] ? Math.max(0, 3 - ((Date.now() - new Date(mem.lastContactByHeroId[player.id]).getTime()) / (60 * 60 * 1000))) : 0;\n  const delta = mood === 'amigvel' ? basePos + Math.min(3, historyBoost) + Math.floor(timeBoost) : mood === 'neutro' ? 1 : -baseNeg;\n  const map = { ...(npc.socialRelations || {}) };\n  const current = map[player.id] || 0;\n  const intensity = (s.relationIntensityPercent ?? 100) / 100;\n  const diminish = Math.max(0.2, (100 - Math.max(0, current)) / 100);\n  const deltaScaled = Math.ceil(delta * intensity * diminish);\n  const newVal = clamp(current + deltaScaled, -100, 100);\n  map[player.id] = newVal;\n  npc.socialRelations = map;\n  const tier = computeTier(newVal);\n  mem.friendStatusByHeroId = { ...(mem.friendStatusByHeroId || {}), [player.id]: tier === 'neutro' ? mem.friendStatusByHeroId?.[player.id] || 'neutro' : (tier as any) };\n  mem.lastContactByHeroId = { ...(mem.lastContactByHeroId || {}), [player.id]: new Date().toISOString() };\n  npc.npcMemory = mem;\n  return { value: newVal, tier };\n}\n\nexport function cascadeGlobalReputation(player: Hero, npcs: Hero[]) {\n  const totalPos = (player.reputationFactions || []).reduce((s, f) => s + Math.max(0, f.reputation || 0), 0);\n  if (totalPos <= 0) return;\n  const s = getGameSettings();\n  const percent = s.npcRelationFactionCascadePercent ?? 0.02;\n  const delta = Math.floor(totalPos * percent);\n  npcs.forEach(n => {\n    const map = { ...(n.socialRelations || {}) };\n    const last = n.npcMemory?.lastContactByHeroId?.[player.id];\n    const recentDays = last ? (Date.now() - new Date(last).getTime()) / (24 * 60 * 60 * 1000) : Infinity;\n    if (recentDays <= 3) {\n      map[player.id] = clamp((map[player.id] || 0) + Math.min(2, delta), -100, 100);\n    }\n    n.socialRelations = map;\n  });\n}\n\nexport function randomNpcNpcEvent(npcs: Hero[]) {\n  if (npcs.length < 2) return null;\n  const a = npcs[Math.floor(Math.random() * npcs.length)];\n  let b = npcs[Math.floor(Math.random() * npcs.length)];\n  if (a.id === b.id) b = npcs[(npcs.indexOf(a) + 1) % npcs.length];\n  const delta = Math.floor(-3 + Math.random() * 7);\n  const relA = { ...(a.socialRelations || {}) };\n  relA[b.id] = clamp((relA[b.id] || 0) + delta, -100, 100);\n  a.socialRelations = relA;\n  const relB = { ...(b.socialRelations || {}) };\n  relB[a.id] = clamp((relB[a.id] || 0) + delta, -100, 100);\n  b.socialRelations = relB;\n  return { a, b, delta };\n}","import { Hero } from '../types/hero';\nimport { getGameSettings } from '../store/gameSettingsStore';\nimport { computeTier } from './relationshipSystem';\n\nexport type BenefitTier = 'none' | 'tier1' | 'tier3' | 'tier5';\n\nfunction getBestRelationTier(hero: Hero): { tierName: string; value: number } {\n  try {\n    const map = hero.npcMemory?.friendStatusByHeroId || {};\n    const ids = Object.keys(map);\n    if (ids.length === 0) return { tierName: 'neutro', value: 0 };\n    const vals = ids.map(id => ({ id, status: map[id] }));\n    const order = ['rival','neutro','conhecido','amigo','melhor_amigo','aliado'];\n    vals.sort((a,b) => order.indexOf(b.status) - order.indexOf(a.status));\n    return { tierName: vals[0].status, value: 1 } as any;\n  } catch { return { tierName: 'neutro', value: 0 }; }\n}\n\nexport function getShopDiscountPercent(hero: Hero): number {\n  const s = getGameSettings();\n  const intensity = (s.relationIntensityPercent ?? 100) / 100;\n  const best = getBestRelationTier(hero).tierName;\n  const base = best === 'amigo' ? 0.10 : best === 'melhor_amigo' ? 0.20 : best === 'aliado' ? 0.30 : 0;\n  return Math.min(0.5, base * intensity);\n}\n\nexport function getMissionBuffPercent(hero: Hero): number {\n  const s = getGameSettings();\n  const intensity = (s.relationIntensityPercent ?? 100) / 100;\n  const best = getBestRelationTier(hero).tierName;\n  const base = best === 'amigo' ? 0.05 : best === 'melhor_amigo' ? 0.10 : best === 'aliado' ? 0.15 : 0;\n  return Math.min(0.25, base * intensity);\n}\n\nexport function getUnlockTier(hero: Hero): BenefitTier {\n  const val = Math.max(...Object.values(hero.socialRelations || {}));\n  const tier = computeTier(val);\n  if (tier === 'conhecido') return 'tier1';\n  if (tier === 'melhor_amigo') return 'tier5';\n  if (tier === 'amigo') return 'tier3';\n  return 'none';\n}","/**\n * Sistema de Loja e Economia\n */\n\nimport { Item, Hero, HeroAttributes } from '../types/hero';\nimport { getShopDiscountPercent } from './relationBenefits';\nimport { RankLevel } from '../types/ranks';\n\n// === CATLOGO DE ITENS DA LOJA ===\n\nexport const SHOP_ITEMS: Item[] = [\n  // === ITENS NARRATIVOS (ARTEFATOS) ===\n  {\n    id: 'orbe-amaldicoado',\n    name: 'Orbe Amaldioado',\n    description: 'Artefato sombrio que exala energia maligna. No consumvel.',\n    type: 'material',\n    rarity: 'epico',\n    price: 500,\n    icon: '',\n    currency: 'arcaneEssence'\n  },\n  {\n    id: 'orbe-purificado',\n    name: 'Orbe Purificado',\n    description: 'Artefato purificado por magia sagrada. No consumvel.',\n    type: 'material',\n    rarity: 'raro',\n    price: 480,\n    icon: '',\n    currency: 'glory'\n  },\n  // === CONSUMVEIS ===\n  {\n    id: 'pocao-pequena',\n    name: 'Poo de Cura Pequena',\n    description: 'Restaura 20 HP instantaneamente',\n    type: 'consumable',\n    rarity: 'comum',\n    price: 25,\n    icon: '',\n    effects: { hp: 20 }\n  },\n  {\n    id: 'pocao-media',\n    name: 'Poo de Cura Mdia',\n    description: 'Restaura 50 HP instantaneamente',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 60,\n    icon: '',\n    effects: { hp: 50 }\n  },\n  {\n    id: 'pocao-grande',\n    name: 'Poo de Cura Grande',\n    description: 'Restaura 100 HP instantaneamente',\n    type: 'consumable',\n    rarity: 'epico',\n    price: 150,\n    icon: '',\n    effects: { hp: 100 }\n  },\n  {\n    id: 'pocao-mana',\n    name: 'Poo de Mana',\n    description: 'Restaura 30 MP instantaneamente',\n    type: 'consumable',\n    rarity: 'comum',\n    price: 30,\n    icon: '',\n    effects: { mp: 30 }\n  },\n  {\n    id: 'contrato-montaria',\n    name: 'Contrato de Estbulo',\n    description: 'Permite recrutar uma montaria aleatria.',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 300,\n    icon: ''\n  },\n  {\n    id: 'kit-montaria',\n    name: 'Kit de Montaria',\n    description: 'Pacote com itens para montar e evoluir: contrato, pergaminho, essncia bestial e pedra mgica.',\n    type: 'bundle',\n    rarity: 'raro',\n    price: 950,\n    icon: ''\n  },\n  {\n    id: 'pergaminho-xp',\n    name: 'Pergaminho de Experincia',\n    description: 'Concede 50 XP de bnus',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 80,\n    icon: '',\n    effects: { duration: 0 } // Efeito instantneo\n  },\n  // === Mascotes: Itens de Cmara de Ecloso ===\n  {\n    id: 'essencia-calor',\n    name: 'Essncia de Calor',\n    description: 'Acelera a incubao de ovos em 15 minutos.',\n    type: 'consumable',\n    rarity: 'comum',\n    price: 35,\n    icon: ''\n  },\n  {\n    id: 'brasas-magicas',\n    name: 'Brasas Mgicas',\n    description: 'Acelera a incubao de ovos em 1 hora.',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 120,\n    icon: ''\n  },\n  {\n    id: 'pedra-alma',\n    name: 'Pedra de Alma',\n    description: 'Canaliza energia para evoluo de mascotes (+300 XP).',\n    type: 'consumable',\n    rarity: 'epico',\n    price: 200,\n    icon: ''\n  },\n  {\n    id: 'racao-basica',\n    name: 'Rao Bsica de Mascote',\n    description: '+50 XP para mascotes ao alimentar.',\n    type: 'consumable',\n    rarity: 'comum',\n    price: 30,\n    icon: ''\n  },\n  {\n    id: 'racao-deluxe',\n    name: 'Rao Deluxe de Mascote',\n    description: '+150 XP para mascotes ao alimentar.',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 90,\n    icon: ''\n  },\n  {\n    id: 'essencia-vinculo',\n    name: 'Essncia de Vnculo',\n    description: 'Aprimora o vnculo com o mascote, aumentando seus bnus em 1%.',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 140,\n    icon: ''\n  },\n  {\n    id: 'tonico-companheiro',\n    name: 'Tnico do Companheiro',\n    description: 'Restaura 50 de energia do mascote ativo.',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 120,\n    icon: ''\n  },\n  {\n    id: 'tonico-descanso',\n    name: 'Tnico de Descanso',\n    description: 'Reduz 20 pontos de Fadiga imediatamente',\n    type: 'consumable',\n    rarity: 'comum',\n    price: 35,\n    icon: '',\n    effects: { fatigue: 20 }\n  },\n  {\n    id: 'elixir-vigor',\n    name: 'Elixir de Vigor',\n    description: 'Reduz 40 pontos de Fadiga imediatamente',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 95,\n    icon: '',\n    effects: { fatigue: 40 }\n  },\n  {\n    id: 'elixir-forca',\n    name: 'Elixir de Fora',\n    description: '+2 Fora por 60 minutos',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 100,\n    icon: '',\n    bonus: { forca: 2 },\n    effects: { duration: 60 }\n  },\n\n  // Expanso de consumveis\n  {\n    id: 'elixir-agilidade',\n    name: 'Elixir de Agilidade',\n    description: '+2 Destreza por 60 minutos',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 100,\n    icon: '',\n    bonus: { destreza: 2 },\n    effects: { duration: 60 }\n  },\n  {\n    id: 'elixir-intelecto',\n    name: 'Elixir de Intelecto',\n    description: '+2 Inteligncia por 60 minutos',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 100,\n    icon: '',\n    bonus: { inteligencia: 2 },\n    effects: { duration: 60 }\n  },\n  {\n    id: 'pocao-mana-grande',\n    name: 'Poo de Mana Grande',\n    description: 'Restaura 100 MP instantaneamente',\n    type: 'consumable',\n    rarity: 'epico',\n    price: 160,\n    icon: '',\n    effects: { mp: 100 }\n  },\n  {\n    id: 'pergaminho-fortuna',\n    name: 'Pergaminho de Fortuna',\n    description: 'Aumenta ganho de ouro em 10% por 30 minutos',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 120,\n    icon: '',\n    effects: { duration: 30 }\n  },\n\n  // === ARMAS ===\n  {\n    id: 'espada-aprendiz',\n    name: 'Espada de Aprendiz',\n    description: 'Lmina leve para iniciantes. +3 Fora, +1 Destreza',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 80,\n    icon: '',\n    bonus: { forca: 3, destreza: 1 },\n    slot: 'mainHand'\n  },\n  {\n    id: 'machado-rustico',\n    name: 'Machado Rstico',\n    description: 'Pesado e bruto. +4 Fora, -1 Destreza',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 100,\n    icon: '',\n    bonus: { forca: 4, destreza: -1 },\n    slot: 'mainHand'\n  },\n  {\n    id: 'arco-simples',\n    name: 'Arco Simples',\n    description: 'Arco de treino. +3 Destreza (alcance duplo)',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { destreza: 3 },\n    slot: 'mainHand'\n  },\n  {\n    id: 'lamina-viajante',\n    name: 'Lmina do Viajante',\n    description: 'Edio limitada. +4 Fora, +1 Destreza',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 180,\n    icon: '',\n    bonus: { forca: 4, destreza: 1 },\n    slot: 'mainHand'\n  },\n  {\n    id: 'escudo-madeira',\n    name: 'Escudo de Madeira',\n    description: 'Proteo simples para a mo secundria. +2 Constituio',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { constituicao: 2 },\n    slot: 'offHand'\n  },\n  {\n    id: 'adaga-leve',\n    name: 'Adaga Leve',\n    description: 'Perfeita para mo secundria. +2 Destreza',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 85,\n    icon: '',\n    bonus: { destreza: 2 },\n    slot: 'offHand'\n  },\n  {\n    id: 'espada-ferro',\n    name: 'Espada de Ferro',\n    description: 'Uma espada confivel de ferro forjado. +3 Fora',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 100,\n    icon: '',\n    bonus: { forca: 3 }\n  },\n  {\n    id: 'espada-aco',\n    name: 'Espada de Ao',\n    description: 'Lmina afiada de ao temperado. +5 Fora',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 250,\n    icon: '',\n    bonus: { forca: 5 }\n  },\n  {\n    id: 'adaga-sombras',\n    name: 'Adaga das Sombras',\n    description: 'Lmina lfica encantada. +3 Destreza, +2 Fora',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 400,\n    icon: '',\n    bonus: { destreza: 3, forca: 2 }\n  },\n  {\n    id: 'cajado-sabio',\n    name: 'Cajado do Sbio',\n    description: 'Cajado mgico antigo. +4 Inteligncia, +2 Sabedoria',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 450,\n    icon: '',\n    bonus: { inteligencia: 4, sabedoria: 2 },\n    currency: 'arcaneEssence',\n    setId: 'arcanista'\n  },\n  {\n    id: 'arco-madeira',\n    name: 'Arco de Madeira',\n    description: 'Arco simples de madeira resistente. +2 Destreza',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 80,\n    icon: '',\n    bonus: { destreza: 2 }\n  },\n  {\n    id: 'arco-composto',\n    name: 'Arco Composto',\n    description: 'Arco avanado com maior alcance. +4 Destreza, +1 Fora',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 220,\n    icon: '',\n    bonus: { destreza: 4, forca: 1 }\n  },\n  {\n    id: 'arco-elfico',\n    name: 'Arco lfico Encantado',\n    description: 'Arco lfico com runas mgicas. +5 Destreza, +2 Sabedoria',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 480,\n    icon: '',\n    bonus: { destreza: 5, sabedoria: 2 },\n    currency: 'glory',\n    setId: 'elfico'\n  },\n  {\n    id: 'besta-pesada',\n    name: 'Besta Pesada',\n    description: 'Besta de guerra com grande poder. +3 Fora, +3 Destreza',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 320,\n    icon: '',\n    bonus: { forca: 3, destreza: 3 }\n  },\n\n  // === ARREMESSO DO FORJADOR: NOVAS ARMAS ===\n  {\n    id: 'lanca-guarda',\n    name: 'Lana da Guarda',\n    description: 'Leve e resistente, usada pelos sentinelas da cidade. +3 Fora, +1 Constituio',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 110,\n    icon: '',\n    bonus: { forca: 3, constituicao: 1 }\n  },\n  {\n    id: 'machado-ferro',\n    name: 'Machado de Ferro',\n    description: 'Perfeito para quem confia mais na fora que na tcnica. +4 Fora',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 120,\n    icon: '',\n    bonus: { forca: 4 }\n  },\n  {\n    id: 'espada-flamejante',\n    name: 'Espada Flamejante',\n    description: 'Brilha como um sol em batalha. Chance temtica de causar dano de fogo.',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 280,\n    icon: '',\n    bonus: { forca: 5 }\n  },\n  {\n    id: 'martelo-guerra',\n    name: 'Martelo de Guerra',\n    description: 'Seu impacto ecoa como trovo. +6 Fora, +3 Constituio',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 520,\n    icon: '',\n    bonus: { forca: 6, constituicao: 3 },\n    currency: 'glory'\n  },\n  {\n    id: 'katana-vento',\n    name: 'Katana do Vento',\n    description: 'A lmina canta ao cortar o ar. +4 Fora, +5 Destreza',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 540,\n    icon: '',\n    bonus: { forca: 4, destreza: 5 },\n    currency: 'glory'\n  },\n  {\n    id: 'lanca-aurora',\n    name: 'Lana da Aurora',\n    description: 'Smbolo dos cavaleiros celestiais. +6 Fora, +2 Sabedoria (sagrado)',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 560,\n    icon: '',\n    bonus: { forca: 6, sabedoria: 2 },\n    currency: 'glory',\n    setId: 'aurora'\n  },\n  {\n    id: 'espada-ultimo-heroi',\n    name: 'Espada do ltimo Heri',\n    description: 'Forjada nas chamas do destino. Bnus temtico de crtico/XP.',\n    type: 'weapon',\n    rarity: 'lendario',\n    price: 1200,\n    icon: '',\n    bonus: { forca: 8, carisma: 2 },\n    currency: 'arcaneEssence',\n    setId: 'eterno'\n  },\n\n  // === ARMAS  LISTA CURADA ===\n  // Guerreiro / Gladiador\n  {\n    id: 'espada-longa-ferro',\n    name: 'Espada Longa de Ferro',\n    description: 'Bsica e confivel. +3 Fora',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 100,\n    icon: '',\n    bonus: { forca: 3 }\n  },\n  {\n    id: 'montante-aco',\n    name: 'Montante de Ao',\n    description: 'Duas mos; alto dano, mais lenta. +6 Fora, -1 Destreza',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 280,\n    icon: '',\n    bonus: { forca: 6, destreza: -1 }\n  },\n  {\n    id: 'machado-guerra',\n    name: 'Machado de Guerra',\n    description: 'Feito para quebrar defesas. +5 Fora, -1 Destreza',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { forca: 5, destreza: -1 }\n  },\n  {\n    id: 'lanca-gladiador',\n    name: 'Lana do Gladiador',\n    description: 'Alcance longo e preciso. +4 Fora, +1 Destreza',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { forca: 4, destreza: 1 }\n  },\n  {\n    id: 'montante-flamejante',\n    name: 'Montante Flamejante',\n    description: 'Lendria; emite chamas ao atacar. +8 Fora',\n    type: 'weapon',\n    rarity: 'lendario',\n    price: 1300,\n    icon: '',\n    bonus: { forca: 8 },\n    currency: 'arcaneEssence'\n  },\n  // Assassino / Ladino\n  {\n    id: 'adagas-gemeas',\n    name: 'Adagas Gmeas',\n    description: 'Rpidas; ideais para crticos. +4 Destreza, +1 Fora',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 230,\n    icon: '',\n    bonus: { destreza: 4, forca: 1 }\n  },\n  {\n    id: 'katar-sombrio',\n    name: 'Katar Sombrio',\n    description: 'Perfura armaduras leves. +5 Destreza, -1 Constituio',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { destreza: 5, constituicao: -1 }\n  },\n  {\n    id: 'lamina-nevoa',\n    name: 'Lmina de Nvoa',\n    description: 'A nvoa envolve o portador. +4 Destreza, +2 Sabedoria',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 420,\n    icon: '',\n    bonus: { destreza: 4, sabedoria: 2 }\n  },\n  {\n    id: 'laminas-ocultas',\n    name: 'Lminas Ocultas',\n    description: 'Lendrias; chance de ataque duplo. +6 Destreza, +2 Fora',\n    type: 'weapon',\n    rarity: 'lendario',\n    price: 1150,\n    icon: '',\n    bonus: { destreza: 6, forca: 2 },\n    currency: 'arcaneEssence'\n  },\n  {\n    id: 'espadas-curtas-duplas',\n    name: 'Espadas Curtas Duplas',\n    description: 'Equilbrio entre velocidade e dano. +4 Destreza, +2 Fora',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { destreza: 4, forca: 2 }\n  },\n  // Mago / Feiticeiro\n  {\n    id: 'cajado-carvalho',\n    name: 'Cajado de Carvalho',\n    description: 'Bsico; canaliza magia elemental. +2 Inteligncia',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { inteligencia: 2 }\n  },\n  {\n    id: 'cajado-cristal',\n    name: 'Cajado de Cristal',\n    description: 'Amplifica feitios de gelo. +3 Inteligncia, +1 Sabedoria',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { inteligencia: 3, sabedoria: 1 }\n  },\n  {\n    id: 'cajado-arcano',\n    name: 'Cajado Arcano',\n    description: 'Runas aceleram conjurao. +4 Inteligncia',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 420,\n    icon: '',\n    bonus: { inteligencia: 4 }\n  },\n  {\n    id: 'cajado-vortice',\n    name: 'Cajado do Vrtice',\n    description: 'Dano mgico em rea. +5 Inteligncia, +2 Sabedoria',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 560,\n    icon: '',\n    bonus: { inteligencia: 5, sabedoria: 2 },\n    currency: 'glory'\n  },\n  {\n    id: 'cetro-almas',\n    name: 'Cetro das Almas',\n    description: 'Lendrio; regenera mana ao causar dano. +3 Sabedoria, +4 Inteligncia',\n    type: 'weapon',\n    rarity: 'lendario',\n    price: 1200,\n    icon: '',\n    bonus: { sabedoria: 3, inteligencia: 4 },\n    currency: 'arcaneEssence'\n  },\n  // Clrigo / Sacerdote\n  {\n    id: 'cajado-luz',\n    name: 'Cajado da Luz',\n    description: 'Bsico; concede magias de cura. +2 Sabedoria, +1 Constituio',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { sabedoria: 2, constituicao: 1 }\n  },\n  {\n    id: 'cajado-fe-duas-maos',\n    name: 'Cajado de Duas Mos da F',\n    description: 'Amplia bnos. +3 Sabedoria, +1 Constituio',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { sabedoria: 3, constituicao: 1 }\n  },\n  {\n    id: 'maca-devoto',\n    name: 'Maa do Devoto',\n    description: 'Aumenta cura e resistncia. +2 Fora, +2 Sabedoria',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 250,\n    icon: '',\n    bonus: { forca: 2, sabedoria: 2 }\n  },\n  {\n    id: 'cajado-divino',\n    name: 'Cajado Divino',\n    description: 'Chance de curar aliados ao atacar. +4 Sabedoria, +2 Constituio',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 520,\n    icon: '',\n    bonus: { sabedoria: 4, constituicao: 2 },\n    currency: 'glory'\n  },\n  {\n    id: 'reliquia-sagrada',\n    name: 'Relquia Sagrada',\n    description: 'Aura protetora. +3 Sabedoria, +3 Constituio',\n    type: 'weapon',\n    rarity: 'lendario',\n    price: 1100,\n    icon: '',\n    bonus: { sabedoria: 3, constituicao: 3 },\n    currency: 'arcaneEssence'\n  },\n  // Bardo\n  {\n    id: 'alaude-carvalho',\n    name: 'Alade de Carvalho',\n    description: 'Bsico; melhora a moral do grupo. +1 Carisma, +1 Sabedoria',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 80,\n    icon: '',\n    bonus: { carisma: 1, sabedoria: 1 }\n  },\n  {\n    id: 'alaude-cristal',\n    name: 'Alade de Cristal',\n    description: 'Amplifica habilidades musicais. +2 Carisma, +2 Sabedoria',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 220,\n    icon: '',\n    bonus: { carisma: 2, sabedoria: 2 }\n  },\n  {\n    id: 'harpa-prata',\n    name: 'Harpa de Prata',\n    description: 'Magia sonora de cura e buffs. +2 Sabedoria, +2 Carisma',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 420,\n    icon: '',\n    bonus: { sabedoria: 2, carisma: 2 }\n  },\n  {\n    id: 'tambor-guerra',\n    name: 'Tambor de Guerra',\n    description: 'Bnus de ataque e defesa em grupo. +3 Carisma, +2 Constituio',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 520,\n    icon: '',\n    bonus: { carisma: 3, constituicao: 2 },\n    currency: 'glory'\n  },\n  {\n    id: 'alaude-lendas',\n    name: 'Alade das Lendas',\n    description: 'Lendrio; multiplica inspirao. +4 Carisma, +3 Sabedoria',\n    type: 'weapon',\n    rarity: 'lendario',\n    price: 1100,\n    icon: '',\n    bonus: { carisma: 4, sabedoria: 3 },\n    currency: 'arcaneEssence'\n  },\n  // Monge / Lanceiro\n  {\n    id: 'bastao-madeira',\n    name: 'Basto de Madeira',\n    description: 'Bsico; equilbrio ataque/defesa. +2 Destreza, +1 Constituio',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { destreza: 2, constituicao: 1 }\n  },\n  {\n    id: 'lanca-vento',\n    name: 'Lana do Vento',\n    description: 'Ataques em rea e longo alcance. +3 Destreza, +2 Constituio',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { destreza: 3, constituicao: 2 }\n  },\n  {\n    id: 'naginata',\n    name: 'Naginata',\n    description: 'Arma hbrida; bnus em esquiva. +4 Destreza, +1 Fora',\n    type: 'weapon',\n    rarity: 'raro',\n    price: 280,\n    icon: '',\n    bonus: { destreza: 4, forca: 1 }\n  },\n  {\n    id: 'punhos-ferro',\n    name: 'Punhos de Ferro',\n    description: 'Estilo corpo a corpo puro. +3 Destreza, +1 Fora',\n    type: 'weapon',\n    rarity: 'comum',\n    price: 120,\n    icon: '',\n    bonus: { destreza: 3, forca: 1 }\n  },\n  {\n    id: 'bastao-dragao',\n    name: 'Basto do Drago',\n    description: 'Lendrio; canaliza energia espiritual. +3 Destreza, +4 Sabedoria',\n    type: 'weapon',\n    rarity: 'lendario',\n    price: 1200,\n    icon: '',\n    bonus: { destreza: 3, sabedoria: 4 },\n    currency: 'arcaneEssence'\n  },\n\n  // === ARMADURAS ===\n  {\n    id: 'peitoral-couro-leve',\n    name: 'Peitoral de Couro Leve',\n    description: 'Proteo gil. +2 Constituio, +1 Destreza',\n    type: 'armor',\n    rarity: 'comum',\n    price: 75,\n    icon: '',\n    bonus: { constituicao: 2, destreza: 1 },\n    slot: 'chest'\n  },\n  {\n    id: 'tunica-estudioso',\n    name: 'Tnica do Estudioso',\n    description: 'Favorece o estudo arcano. +1 Constituio, +2 Inteligncia',\n    type: 'armor',\n    rarity: 'comum',\n    price: 70,\n    icon: '',\n    bonus: { constituicao: 1, inteligencia: 2 },\n    slot: 'chest'\n  },\n  {\n    id: 'armadura-novato',\n    name: 'Armadura do Novato',\n    description: 'Proteo bsica para quem est comeando. +3 Constituio',\n    type: 'armor',\n    rarity: 'comum',\n    price: 100,\n    icon: '',\n    bonus: { constituicao: 3 },\n    slot: 'chest'\n  },\n  {\n    id: 'armadura-couro',\n    name: 'Armadura de Couro',\n    description: 'Proteo bsica de couro curtido. +2 Constituio',\n    type: 'armor',\n    rarity: 'comum',\n    price: 75,\n    icon: '',\n    bonus: { constituicao: 2 },\n    slot: 'chest'\n  },\n  {\n    id: 'armadura-cota',\n    name: 'Cota de Malha',\n    description: 'Armadura de anis entrelaados. +4 Constituio',\n    type: 'armor',\n    rarity: 'raro',\n    price: 200,\n    icon: '',\n    bonus: { constituicao: 4 },\n    slot: 'chest'\n  },\n  {\n    id: 'armadura-placas',\n    name: 'Armadura de Placas',\n    description: 'Proteo mxima em placas de ao. +6 Constituio, -1 Destreza',\n    type: 'armor',\n    rarity: 'epico',\n    price: 500,\n    icon: '',\n    bonus: { constituicao: 6, destreza: -1 },\n    slot: 'chest',\n    currency: 'glory'\n  },\n  {\n    id: 'armadura-couro-tachas',\n    name: 'Armadura de Couro com Tachas',\n    description: 'Couro reforado com tachas metlicas. +3 Constituio, +1 Destreza',\n    type: 'armor',\n    rarity: 'raro',\n    price: 180,\n    icon: '',\n    bonus: { constituicao: 3, destreza: 1 }\n  },\n  {\n    id: 'gibao-elfico',\n    name: 'Gibo lfico',\n    description: 'Armadura lfica leve e flexvel. +2 Constituio, +3 Destreza',\n    type: 'armor',\n    rarity: 'epico',\n    price: 420,\n    icon: '',\n    bonus: { constituicao: 2, destreza: 3 },\n    slot: 'chest'\n    ,setId: 'elfico'\n  },\n\n  // === FORJADOR: NOVAS ARMADURAS ===\n  {\n    id: 'armadura-ferro',\n    name: 'Armadura de Ferro',\n    description: 'Padro entre os guardas da cidade. +4 Constituio',\n    type: 'armor',\n    rarity: 'comum',\n    price: 120,\n    icon: '',\n    bonus: { constituicao: 4 },\n    slot: 'chest'\n  },\n  {\n    id: 'manto-arcano',\n    name: 'Manto Arcano',\n    description: 'Bordado com smbolos antigos. +1 Constituio, +3 Inteligncia',\n    type: 'armor',\n    rarity: 'raro',\n    price: 220,\n    icon: '',\n    bonus: { constituicao: 1, inteligencia: 3 },\n    slot: 'cape',\n    setId: 'arcanista'\n  },\n  {\n    id: 'armadura-cacador',\n    name: 'Armadura do Caador',\n    description: 'Perfeita para quem caa monstros nas sombras. +2 Constituio, +3 Destreza',\n    type: 'armor',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { constituicao: 2, destreza: 3 },\n    slot: 'chest'\n  },\n  {\n    id: 'armadura-escamas',\n    name: 'Armadura de Escamas',\n    description: 'Forjada a partir de escamas de draco. +4 Constituio, +2 Sabedoria',\n    type: 'armor',\n    rarity: 'raro',\n    price: 320,\n    icon: '',\n    bonus: { constituicao: 4, sabedoria: 2 },\n    slot: 'chest'\n  },\n  {\n    id: 'cota-sagrada',\n    name: 'Cota Sagrada',\n    description: 'Imbuda com bnos divinas. +4 Constituio, +3 Sabedoria',\n    type: 'armor',\n    rarity: 'epico',\n    price: 520,\n    icon: '',\n    bonus: { constituicao: 4, sabedoria: 3 },\n    slot: 'chest',\n    currency: 'glory',\n    setId: 'aurora'\n  },\n  {\n    id: 'armadura-cristal',\n    name: 'Armadura de Cristal',\n    description: 'Reflete tanto luz quanto feitios. +5 Constituio, +3 Sabedoria',\n    type: 'armor',\n    rarity: 'epico',\n    price: 560,\n    icon: '',\n    bonus: { constituicao: 5, sabedoria: 3 },\n    slot: 'chest',\n    currency: 'glory'\n  },\n  {\n    id: 'vestes-arcanista',\n    name: 'Vestes do Arcanista',\n    description: 'Brilha suavemente sob a lua. +2 Constituio, +6 Inteligncia',\n    type: 'armor',\n    rarity: 'epico',\n    price: 600,\n    icon: '',\n    bonus: { constituicao: 2, inteligencia: 6 },\n    slot: 'chest',\n    currency: 'arcaneEssence',\n    setId: 'arcanista'\n  },\n  {\n    id: 'armadura-dragao-anciao',\n    name: 'Armadura do Drago Ancio',\n    description: 'Forjada das escamas de um drago lendrio. Bnus temticos de resistncia e XP.',\n    type: 'armor',\n    rarity: 'lendario',\n    price: 1400,\n    icon: '',\n    bonus: { constituicao: 8, sabedoria: 4 },\n    slot: 'chest',\n    currency: 'arcaneEssence',\n    setId: 'eterno'\n  },\n\n  // === ARMADURAS  LISTA CURADA ===\n  // Pesadas (Guerreiro, Gladiador)\n  {\n    id: 'armadura-couro-reforcado',\n    name: 'Armadura de Couro Reforado',\n    description: 'Couro reforado para iniciantes. +3 Constituio, +1 Destreza',\n    type: 'armor',\n    rarity: 'comum',\n    price: 110,\n    icon: '',\n    bonus: { constituicao: 3, destreza: 1 },\n    slot: 'chest'\n  },\n  {\n    id: 'cota-malha-abencoada',\n    name: 'Cota de Malha Abenoada',\n    description: 'Proteo com bnos leves. +4 Constituio, +1 Sabedoria',\n    type: 'armor',\n    rarity: 'raro',\n    price: 280,\n    icon: '',\n    bonus: { constituicao: 4, sabedoria: 1 },\n    slot: 'chest'\n  },\n  {\n    id: 'platina-imperial',\n    name: 'Platina Imperial',\n    description: 'Placas imperiais. +6 Constituio, +1 Carisma',\n    type: 'armor',\n    rarity: 'epico',\n    price: 560,\n    icon: '',\n    bonus: { constituicao: 6, carisma: 1 },\n    slot: 'chest',\n    currency: 'glory'\n  },\n  // Leves (Assassino, Bardo, Monge)\n  {\n    id: 'tunica-couro',\n    name: 'Tnica de Couro',\n    description: 'Leve e prtica. +2 Constituio, +1 Destreza',\n    type: 'armor',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { constituicao: 2, destreza: 1 },\n    slot: 'chest'\n  },\n  {\n    id: 'roupa-sombras',\n    name: 'Roupa das Sombras',\n    description: 'Feita para discrio. +3 Destreza, +1 Inteligncia',\n    type: 'armor',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { destreza: 3, inteligencia: 1 },\n    slot: 'chest'\n  },\n  {\n    id: 'traje-viajante',\n    name: 'Traje do Viajante',\n    description: 'Confortvel para longas jornadas. +2 Destreza, +1 Constituio',\n    type: 'armor',\n    rarity: 'comum',\n    price: 120,\n    icon: '',\n    bonus: { destreza: 2, constituicao: 1 },\n    slot: 'chest'\n  },\n  {\n    id: 'veste-bardo-errante',\n    name: 'Veste do Bardo Errante',\n    description: 'Cativa multides. +2 Destreza, +2 Carisma',\n    type: 'armor',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { destreza: 2, carisma: 2 },\n    slot: 'chest'\n  },\n  {\n    id: 'roupas-celestes-monge',\n    name: 'Roupas Celestes do Monge',\n    description: 'Lendria; leve e espiritual. +3 Destreza, +3 Sabedoria',\n    type: 'armor',\n    rarity: 'lendario',\n    price: 900,\n    icon: '',\n    bonus: { destreza: 3, sabedoria: 3 },\n    slot: 'chest',\n    currency: 'arcaneEssence'\n  },\n  // Msticas (Mago, Clrigo)\n  {\n    id: 'veste-arcana',\n    name: 'Veste Arcana',\n    description: 'Favorece o estudo arcano. +1 Constituio, +4 Inteligncia',\n    type: 'armor',\n    rarity: 'raro',\n    price: 300,\n    icon: '',\n    bonus: { constituicao: 1, inteligencia: 4 },\n    slot: 'chest'\n  },\n  {\n    id: 'manto-seda-espiritual',\n    name: 'Manto de Seda Espiritual',\n    description: 'Sereno e protetor. +2 Sabedoria, +1 Constituio',\n    type: 'armor',\n    rarity: 'raro',\n    price: 280,\n    icon: '',\n    bonus: { sabedoria: 2, constituicao: 1 },\n    slot: 'chest'\n  },\n  {\n    id: 'tunica-sol',\n    name: 'Tnica do Sol',\n    description: 'Banho de luz. +2 Constituio, +4 Sabedoria',\n    type: 'armor',\n    rarity: 'epico',\n    price: 520,\n    icon: '',\n    bonus: { constituicao: 2, sabedoria: 4 },\n    slot: 'chest',\n    currency: 'glory'\n  },\n  {\n    id: 'roupas-sabio-eterno',\n    name: 'Roupas do Sbio Eterno',\n    description: 'Sabedoria acumulada. +2 Constituio, +5 Inteligncia',\n    type: 'armor',\n    rarity: 'epico',\n    price: 560,\n    icon: '',\n    bonus: { constituicao: 2, inteligencia: 5 },\n    slot: 'chest',\n    currency: 'glory'\n  },\n  {\n    id: 'manto-eternidade',\n    name: 'Manto da Eternidade',\n    description: 'Lendrio; protege contra o esquecimento. +3 Constituio, +6 Inteligncia',\n    type: 'armor',\n    rarity: 'lendario',\n    price: 1200,\n    icon: '',\n    bonus: { constituicao: 3, inteligencia: 6 },\n    slot: 'cape',\n    currency: 'arcaneEssence'\n  },\n\n  // === NOVOS ITENS DE SLOT ESPECFICO ===\n  {\n    id: 'capacete-ferro',\n    name: 'Capacete de Ferro',\n    description: 'Protege a cabea com firmeza. +1 Constituio',\n    type: 'armor',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { constituicao: 1 },\n    slot: 'helm'\n  },\n  {\n    id: 'elmo-guardiao',\n    name: 'Elmo do Guardio',\n    description: 'Bnos leves e proteo slida. +2 Constituio, +1 Sabedoria',\n    type: 'armor',\n    rarity: 'raro',\n    price: 220,\n    icon: '',\n    bonus: { constituicao: 2, sabedoria: 1 },\n    slot: 'helm'\n  },\n  {\n    id: 'cinto-couro',\n    name: 'Cinto de Couro',\n    description: 'Suporte bsico. +1 Destreza',\n    type: 'armor',\n    rarity: 'comum',\n    price: 70,\n    icon: '',\n    bonus: { destreza: 1 },\n    slot: 'belt'\n  },\n  {\n    id: 'cinto-gladiador',\n    name: 'Cinto do Gladiador',\n    description: 'Firmeza no centro. +2 Fora',\n    type: 'armor',\n    rarity: 'raro',\n    price: 180,\n    icon: '',\n    bonus: { forca: 2 },\n    slot: 'belt'\n  },\n  {\n    id: 'luvas-couro',\n    name: 'Luvas de Couro',\n    description: 'Aprimora a pegada. +1 Destreza',\n    type: 'armor',\n    rarity: 'comum',\n    price: 60,\n    icon: '',\n    bonus: { destreza: 1 },\n    slot: 'gloves'\n  },\n  {\n    id: 'luvas-runicas',\n    name: 'Luvas Rnicas',\n    description: 'Inscries arcanas. +2 Destreza, +1 Inteligncia',\n    type: 'armor',\n    rarity: 'epico',\n    price: 320,\n    icon: '',\n    bonus: { destreza: 2, inteligencia: 1 },\n    slot: 'gloves'\n  },\n  {\n    id: 'botas-caminhante',\n    name: 'Botas do Caminhante',\n    description: 'Confortveis para longas viagens. +1 Destreza, +1 Constituio',\n    type: 'armor',\n    rarity: 'comum',\n    price: 90,\n    icon: '',\n    bonus: { destreza: 1, constituicao: 1 },\n    slot: 'boots'\n  },\n  {\n    id: 'botas-velozes',\n    name: 'Botas Velozes',\n    description: 'Passos rpidos e precisos. +2 Destreza',\n    type: 'armor',\n    rarity: 'raro',\n    price: 200,\n    icon: '',\n    bonus: { destreza: 2 },\n    slot: 'boots'\n  },\n  {\n    id: 'capa-iniciante',\n    name: 'Capa do Iniciante',\n    description: 'Proteo leve e estilo bsico. +1 Destreza',\n    type: 'armor',\n    rarity: 'comum',\n    price: 60,\n    icon: '',\n    bonus: { destreza: 1 },\n    slot: 'cape'\n  },\n  {\n    id: 'capa-aventura',\n    name: 'Capa da Aventura',\n    description: 'Ideal para exploradores. +2 Destreza, +1 Constituio',\n    type: 'armor',\n    rarity: 'raro',\n    price: 180,\n    icon: '',\n    bonus: { destreza: 2, constituicao: 1 },\n    slot: 'cape'\n  },\n  {\n    id: 'capa-heroi',\n    name: 'Capa do Heri',\n    description: 'Ecoa histrias picas. +3 Destreza, +2 Sabedoria',\n    type: 'armor',\n    rarity: 'epico',\n    price: 420,\n    icon: '',\n    bonus: { destreza: 3, sabedoria: 2 },\n    slot: 'cape'\n  },\n  {\n    id: 'asas-lendarias',\n    name: 'Asas Lendrias',\n    description: 'Voos mticos. +4 Destreza, +2 Inteligncia, +1 Sabedoria',\n    type: 'armor',\n    rarity: 'lendario',\n    price: 900,\n    icon: '',\n    bonus: { destreza: 4, inteligencia: 2, sabedoria: 1 },\n    slot: 'cape',\n    currency: 'arcaneEssence'\n  },\n\n  // === ACESSRIOS ===\n  {\n    id: 'anel-forca',\n    name: 'Anel da Fora',\n    description: 'Anel mgico que aumenta a fora fsica. +2 Fora',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 150,\n    icon: '',\n    bonus: { forca: 2 },\n    slot: 'ring'\n  },\n  {\n    id: 'amuleto-sabedoria',\n    name: 'Amuleto da Sabedoria',\n    description: 'Amuleto lfico que clareia a mente. +3 Sabedoria',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 180,\n    icon: '',\n    bonus: { sabedoria: 3 },\n    slot: 'necklace',\n    currency: 'arcaneEssence',\n    setId: 'arcanista'\n  },\n  {\n    id: 'colar-carisma',\n    name: 'Colar do Carisma',\n    description: 'Joia encantada que aumenta o charme. +3 Carisma',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 300,\n    icon: '',\n    bonus: { carisma: 3 },\n    slot: 'necklace'\n  },\n  {\n    id: 'aljava-encantada',\n    name: 'Aljava Encantada',\n    description: 'Aljava mgica que melhora a preciso. +2 Destreza, +1 Sabedoria',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 200,\n    icon: '',\n    bonus: { destreza: 2, sabedoria: 1 },\n    currency: 'arcaneEssence'\n  },\n  {\n    id: 'bracadeira-arqueiro',\n    name: 'Braadeira do Arqueiro',\n    description: 'Proteo para o brao que saca a corda. +3 Destreza',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 160,\n    icon: '',\n    bonus: { destreza: 3 }\n    ,setId: 'elfico'\n  },\n  {\n    id: 'anel-precisao',\n    name: 'Anel da Preciso',\n    description: 'Anel que aprimora a mira. +2 Destreza, +1 Inteligncia',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 280,\n    icon: '',\n    bonus: { destreza: 2, inteligencia: 1 },\n    slot: 'ring',\n    setId: 'elfico'\n  },\n  {\n    id: 'anel-aventureiro',\n    name: 'Anel do Aventureiro',\n    description: '+5% XP recebido (temtico)',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 120,\n    icon: '',\n    slot: 'ring'\n  },\n  {\n    id: 'pingente-sorte',\n    name: 'Pingente da Sorte',\n    description: 'Chance de evitar armadilhas em masmorras',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 150,\n    icon: '',\n    slot: 'necklace'\n  },\n  {\n    id: 'brincos-eco',\n    name: 'Brincos do Eco',\n    description: '+1 em todos os atributos por 10 minutos',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 200,\n    icon: '',\n    bonus: { forca: 1, destreza: 1, constituicao: 1, inteligencia: 1, sabedoria: 1, carisma: 1 },\n    effects: { duration: 10 },\n    slot: 'earring'\n  },\n  {\n    id: 'amuleto-brisa',\n    name: 'Amuleto da Brisa',\n    description: '+2 Defesa Mgica / +10% velocidade em masmorras (temtico)',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 120,\n    icon: ''\n  },\n\n  // === FORJADOR: NOVOS ACESSRIOS ===\n  {\n    id: 'anel-bronze',\n    name: 'Anel de Bronze',\n    description: 'Um simples anel de sorte. +1 Sabedoria',\n    type: 'accessory',\n    rarity: 'comum',\n    price: 60,\n    icon: '',\n    bonus: { sabedoria: 1 },\n    slot: 'ring'\n  },\n  {\n    id: 'colar-madeira',\n    name: 'Colar de Madeira',\n    description: 'Amuleto de proteo bsica. +1 Constituio',\n    type: 'accessory',\n    rarity: 'comum',\n    price: 60,\n    icon: '',\n    bonus: { constituicao: 1 },\n    slot: 'necklace'\n  },\n  {\n    id: 'amuleto-vitalidade',\n    name: 'Amuleto da Vitalidade',\n    description: 'Energiza o corpo e a alma. Aumenta a vitalidade.',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { constituicao: 3 },\n    slot: 'necklace'\n  },\n  {\n    id: 'anel-precisao-raro',\n    name: 'Anel de Preciso',\n    description: 'Ideal para arqueiros e assassinos. Bnus temtico de crtico.',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 220,\n    icon: '',\n    bonus: { destreza: 2 },\n    slot: 'ring'\n  },\n  {\n    id: 'medalhao-guardiao',\n    name: 'Medalho do Guardio',\n    description: 'Carrega uma prece antiga. +2 Constituio, +3 Sabedoria',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { constituicao: 2, sabedoria: 3 },\n    slot: 'necklace',\n    setId: 'aurora'\n  },\n  {\n    id: 'anel-furia',\n    name: 'Anel da Fria',\n    description: 'Libera um poder destrutivo, a um custo. +5 Fora, -2 Constituio',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 380,\n    icon: '',\n    bonus: { forca: 5, constituicao: -2 },\n    slot: 'ring'\n  },\n  {\n    id: 'colar-equilibrio',\n    name: 'Colar do Equilbrio',\n    description: 'Harmoniza corpo e mente. +3 Fora, +3 Constituio',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 400,\n    icon: '',\n    bonus: { forca: 3, constituicao: 3 },\n    slot: 'necklace'\n  },\n  {\n    id: 'amuleto-tempo',\n    name: 'Amuleto do Tempo',\n    description: 'Manipula o tempo a seu favor. Bnus temtico de velocidade/XP.',\n    type: 'accessory',\n    rarity: 'lendario',\n    price: 900,\n    icon: '',\n    bonus: { destreza: 3, carisma: 2 },\n    slot: 'necklace',\n    currency: 'arcaneEssence'\n  },\n  {\n    id: 'anel-eternidade',\n    name: 'Anel da Eternidade',\n    description: 'Smbolo da imortalidade dos verdadeiros heris. Bnus temtico de crtico/esprito.',\n    type: 'accessory',\n    rarity: 'lendario',\n    price: 1100,\n    icon: '',\n    bonus: { sabedoria: 5, destreza: 3 },\n    slot: 'ring',\n    currency: 'arcaneEssence',\n    setId: 'eterno'\n  },\n\n  // === ACESSRIOS  LISTA CURADA ===\n  {\n    id: 'anel-vitalidade',\n    name: 'Anel da Vitalidade',\n    description: '+HP (representado por Constituio). +3 Constituio',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 220,\n    icon: '',\n    bonus: { constituicao: 3 },\n    slot: 'ring'\n  },\n  {\n    id: 'anel-foco-arcano',\n    name: 'Anel do Foco Arcano',\n    description: '+Mana (representado por Inteligncia). +3 Inteligncia',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { inteligencia: 3 },\n    slot: 'ring'\n  },\n  {\n    id: 'colar-viajante',\n    name: 'Colar do Viajante',\n    description: 'Velocidade e leveza. +2 Destreza',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 200,\n    icon: '',\n    bonus: { destreza: 2 },\n    slot: 'necklace'\n  },\n  {\n    id: 'bracelete-gladiador',\n    name: 'Bracelete do Gladiador',\n    description: 'Poder do arena. +3 Fora',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { forca: 3 },\n    slot: 'ring'\n  },\n  {\n    id: 'amuleto-cura',\n    name: 'Amuleto da Cura',\n    description: 'Restaura HP gradualmente (temtico). +2 Constituio',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 420,\n    icon: '',\n    bonus: { constituicao: 2 },\n    slot: 'necklace',\n    currency: 'glory'\n  },\n  {\n    id: 'anel-destreza',\n    name: 'Anel da Destreza',\n    description: 'Aprimora chances de crtico (temtico). +2 Destreza',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 220,\n    icon: '',\n    bonus: { destreza: 2 },\n    slot: 'ring'\n  },\n  {\n    id: 'colar-inspiracao',\n    name: 'Colar da Inspirao',\n    description: 'Perfeito para bardos e clrigos. +3 Carisma, +1 Sabedoria',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 400,\n    icon: '',\n    bonus: { carisma: 3, sabedoria: 1 },\n    slot: 'necklace'\n  },\n  {\n    id: 'pingente-resistencia',\n    name: 'Pingente da Resistncia',\n    description: 'Proteo arcana. +2 Sabedoria',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 240,\n    icon: '',\n    bonus: { sabedoria: 2 },\n    slot: 'necklace'\n  },\n  {\n    id: 'anel-tempestade',\n    name: 'Anel da Tempestade',\n    description: 'Chance de relmpago (temtico). +2 Destreza, +1 Inteligncia',\n    type: 'accessory',\n    rarity: 'epico',\n    price: 420,\n    icon: '',\n    bonus: { destreza: 2, inteligencia: 1 },\n    slot: 'ring',\n    currency: 'glory'\n  },\n  {\n    id: 'simbolo-luz',\n    name: 'Smbolo da Luz',\n    description: 'Reduz dano das trevas (temtico). +2 Sabedoria, +1 Constituio',\n    type: 'accessory',\n    rarity: 'raro',\n    price: 260,\n    icon: '',\n    bonus: { sabedoria: 2, constituicao: 1 },\n    slot: 'necklace'\n  },\n\n  // === COSMTICOS ===\n  {\n    id: 'capa-vermelha',\n    name: 'Capa Vermelha',\n    description: 'Capa elegante de cor carmesim. Puramente cosmtica.',\n    type: 'cosmetic',\n    rarity: 'comum',\n    price: 50,\n    icon: ''\n  },\n  {\n    id: 'coroa-ouro',\n    name: 'Coroa de Ouro',\n    description: 'Coroa dourada para verdadeiros lderes. Cosmtica.',\n    type: 'cosmetic',\n    rarity: 'lendario',\n    price: 1000,\n    icon: ''\n  },\n  {\n    id: 'mascara-sombras',\n    name: 'Mscara das Sombras',\n    description: 'Mscara misteriosa para heris discretos. Cosmtica.',\n    type: 'cosmetic',\n    rarity: 'epico',\n    price: 200,\n    icon: ''\n  }\n  ,\n  // Molduras e fundos temticos\n  {\n    id: 'moldura-dourada',\n    name: 'Moldura Dourada',\n    description: 'Visual desbloquevel por XP (temtico)',\n    type: 'cosmetic',\n    rarity: 'raro',\n    price: 300,\n    icon: ''\n  },\n  {\n    id: 'moldura-real',\n    name: 'Moldura Real',\n    description: 'Visual de prestgio por rank (temtico)',\n    type: 'cosmetic',\n    rarity: 'epico',\n    price: 600,\n    icon: ''\n  },\n  {\n    id: 'reliquia-brilho-eterno',\n    name: 'Relquia do Brilho Eterno',\n    description: 'Artefato antigo que conta histrias de heris esquecidos.',\n    type: 'material',\n    rarity: 'epico',\n    price: 0,\n    icon: ''\n  },\n  {\n    id: 'reliquia-contos-sussurrados',\n    name: 'Relquia dos Contos Sussurrados',\n    description: 'Ao toc-la, ouvem-se vozes narrando aventuras.',\n    type: 'material',\n    rarity: 'raro',\n    price: 0,\n    icon: ''\n  },\n  {\n    id: 'coroa-quebrada',\n    name: 'Coroa Quebrada do Rei Goblin',\n    description: 'Fragmento que testemunha uma ascenso e queda.',\n    type: 'material',\n    rarity: 'raro',\n    price: 0,\n    icon: ''\n  },\n  {\n    id: 'fundo-aurora',\n    name: 'Fundo Aurora',\n    description: 'Visual por reputao (temtico)',\n    type: 'cosmetic',\n    rarity: 'raro',\n    price: 350,\n    icon: ''\n  },\n\n  // === MATERIAIS / NCLEOS DE MANA ===\n  {\n    id: 'nucleo-mana-menor',\n    name: 'Ncleo Menor de Mana',\n    description: 'Essncia bruta para forjas e encantamentos. No consumvel.',\n    type: 'material',\n    rarity: 'comum',\n    price: 40,\n    icon: '',\n    \n  },\n  {\n    id: 'nucleo-mana',\n    name: 'Ncleo de Mana',\n    description: 'Ncleo usado em encantamentos e forjas. No consumvel.',\n    type: 'material',\n    rarity: 'raro',\n    price: 90,\n    icon: '',\n    \n  },\n  {\n    id: 'nucleo-mana-raro',\n    name: 'Ncleo Raro de Mana',\n    description: 'Ncleo refinado para obras complexas. No consumvel.',\n    type: 'material',\n    rarity: 'epico',\n    price: 220,\n    icon: '',\n    \n  },\n  {\n    id: 'nucleo-ancestral',\n    name: 'Ncleo Ancestral',\n    description: 'Ncleo lendrio usado em obras-primas. No consumvel.',\n    type: 'material',\n    rarity: 'lendario',\n    price: 500,\n    icon: '',\n    \n  }\n  ,\n  // === Itens de Caa: Partes de Monstros ===\n  {\n    id: 'pele-lobo-sombrio',\n    name: 'Pele de Lobo Sombrio',\n    description: 'Material obtido em caadas. Usado para reforar armaduras leves.',\n    type: 'material',\n    rarity: 'comum',\n    price: 25,\n    icon: ''\n  },\n  {\n    id: 'colmilho-vampirico',\n    name: 'Colmilho Vamprico',\n    description: 'Parte rara de monstros noturnos. til em forjas sombrias.',\n    type: 'material',\n    rarity: 'raro',\n    price: 80,\n    icon: ''\n  },\n  {\n    id: 'osso-antigo',\n    name: 'Osso Antigo',\n    description: 'Osso resistente de criatura ancestral. Componente de armaduras.',\n    type: 'material',\n    rarity: 'raro',\n    price: 70,\n    icon: ''\n  },\n  // === Itens de Caa: Ervas e Recursos ===\n  {\n    id: 'erva-sangue',\n    name: 'Erva de Sangue',\n    description: 'Planta vermelha usada por curandeiros em poes de vida.',\n    type: 'material',\n    rarity: 'comum',\n    price: 20,\n    icon: ''\n  },\n  {\n    id: 'essencia-lunar',\n    name: 'Essncia Lunar',\n    description: 'Essncia rara coletada em clareiras sob lua cheia.',\n    type: 'material',\n    rarity: 'raro',\n    price: 120,\n    icon: ''\n  },\n  {\n    id: 'cristal-runico',\n    name: 'Cristal Rnico',\n    description: 'Cristal com inscries arcanas, usado em encantamentos.',\n    type: 'material',\n    rarity: 'epico',\n    price: 220,\n    icon: ''\n  },\n  // === Itens de Caa: Pergaminhos de Suporte ===\n  {\n    id: 'pergaminho-protecao',\n    name: 'Pergaminho de Proteo',\n    description: 'Aumenta a resistncia a dano por 20 minutos.',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 140,\n    icon: '',\n    effects: { duration: 20 }\n  },\n  {\n    id: 'pergaminho-velocidade',\n    name: 'Pergaminho de Velocidade',\n    description: 'Agilidade temporria para escoltas e evaso (20 min).',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 140,\n    icon: '',\n    effects: { duration: 20 }\n  },\n  // === Caadas Especiais: Recompensas picas garantidas ===\n  {\n    id: 'lamina-alpha',\n    name: 'Lmina Alpha',\n    description: 'Forjada do lder da alcateia. +4 Fora, +3 Destreza',\n    type: 'weapon',\n    rarity: 'epico',\n    price: 620,\n    icon: '',\n    bonus: { forca: 4, destreza: 3 }\n  },\n  {\n    id: 'armadura-pedra-rachada',\n    name: 'Armadura de Pedra Rachada',\n    description: 'Resduo de golem, pesado e protetor. +6 Constituio',\n    type: 'armor',\n    rarity: 'epico',\n    price: 640,\n    icon: '',\n    bonus: { constituicao: 6 }\n  }\n  ,\n  {\n    id: 'pedra-alma',\n    name: 'Pedra de Alma',\n    description: 'Canaliza energia para evoluo de mascotes.',\n    type: 'material',\n    rarity: 'raro',\n    price: 180,\n    icon: ''\n  },\n  {\n    id: 'pedra-magica',\n    name: 'Pedra Mgica',\n    description: 'Usada para refinar mascotes e montarias (+1% por nvel).',\n    type: 'material',\n    rarity: 'raro',\n    price: 220,\n    icon: ''\n  },\n  {\n    id: 'pergaminho-montaria',\n    name: 'Pergaminho de Montaria',\n    description: 'Permite evoluir a montaria para o prximo estgio.',\n    type: 'material',\n    rarity: 'epico',\n    price: 400,\n    icon: ''\n  },\n  {\n    id: 'essencia-bestial',\n    name: 'Essncia Bestial',\n    description: 'Essncia rara necessria para montarias lendrias.',\n    type: 'material',\n    rarity: 'lendario',\n    price: 800,\n    icon: ''\n  },\n  {\n    id: 'carne-selvagem',\n    name: 'Carne Selvagem',\n    description: 'Comida para treinar mascotes (+50 XP).',\n    type: 'consumable',\n    rarity: 'comum',\n    price: 30,\n    icon: ''\n  },\n  {\n    id: 'peixe-mistico',\n    name: 'Peixe Mstico',\n    description: 'Comida rara para mascotes (+120 XP).',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 90,\n    icon: ''\n  },\n  {\n    id: 'frutas-rubras',\n    name: 'Frutas Rubras',\n    description: 'Comida doce para mascotes (+80 XP).',\n    type: 'consumable',\n    rarity: 'incomum',\n    price: 50,\n    icon: ''\n  },\n  {\n    id: 'essencia-calor',\n    name: 'Essncia de Calor',\n    description: 'Acelera incubao de ovos (-15min).',\n    type: 'material',\n    rarity: 'raro',\n    price: 100,\n    icon: ''\n  },\n  {\n    id: 'brasas-magicas',\n    name: 'Brasas Mgicas',\n    description: 'Acelera incubao de ovos (-1h).',\n    type: 'material',\n    rarity: 'epico',\n    price: 160,\n    icon: ''\n  }\n  ,\n  {\n    id: 'racao-basica',\n    name: 'Rao Bsica',\n    description: 'Comida comum para mascotes (+50 XP).',\n    type: 'consumable',\n    rarity: 'comum',\n    price: 25,\n    icon: ''\n  },\n  {\n    id: 'racao-deluxe',\n    name: 'Rao Deluxe',\n    description: 'Comida premium para mascotes (+150 XP).',\n    type: 'consumable',\n    rarity: 'raro',\n    price: 120,\n    icon: ''\n  },\n  {\n    id: 'essencia-vinculo',\n    name: 'Essncia de Vnculo',\n    description: 'Refina o vnculo com mascotes/montarias (+1%).',\n    type: 'material',\n    rarity: 'raro',\n    price: 220,\n    icon: ''\n  }\n];\n\nexport const SHOP_ITEMS_MAP: Record<string, Item> = (() => {\n  const map: Record<string, Item> = {};\n  for (const it of SHOP_ITEMS) map[it.id] = it;\n  return map;\n})();\n\n// === CATEGORIAS DA LOJA ===\n\nexport const SHOP_CATEGORIES = {\n  consumables: {\n    name: 'Consumveis',\n    icon: '',\n    items: SHOP_ITEMS.filter(item => item.type === 'consumable')\n  },\n  weapons: {\n    name: 'Armas',\n    icon: '',\n    items: SHOP_ITEMS.filter(item => item.type === 'weapon')\n  },\n  armor: {\n    name: 'Armaduras',\n    icon: '',\n    items: SHOP_ITEMS.filter(item => item.type === 'armor')\n  },\n  accessories: {\n    name: 'Acessrios',\n    icon: '',\n    items: SHOP_ITEMS.filter(item => item.type === 'accessory')\n  },\n  // Categoria de materiais oculta na loja; ncleos devem ser vendidos  guilda\n  cosmetics: {\n    name: 'Cosmticos',\n    icon: '',\n    items: SHOP_ITEMS.filter(item => item.type === 'cosmetic')\n  }\n};\n\n// === SISTEMA DE RARIDADE E CORES ===\n\nexport const RARITY_CONFIG = {\n  comum: {\n    color: '#9CA3AF', // Gray\n    bgColor: '#F3F4F6',\n    multiplier: 1.0\n  },\n  incomum: {\n    color: '#10B981', // Emerald\n    bgColor: '#ECFDF5',\n    multiplier: 1.3\n  },\n  raro: {\n    color: '#3B82F6', // Blue\n    bgColor: '#EFF6FF',\n    multiplier: 1.6\n  },\n  epico: {\n    color: '#8B5CF6', // Purple\n    bgColor: '#F5F3FF',\n    multiplier: 2.0\n  },\n  lendario: {\n    color: '#F59E0B', // Amber\n    bgColor: '#FFFBEB',\n    multiplier: 3.0\n  }\n};\n\n// === CONJUNTOS DE ITENS ===\nexport const ITEM_SETS: Record<string, { name: string; bonus: Partial<HeroAttributes> }> = {\n  arcanista: {\n    name: 'Conjunto Arcanista',\n    bonus: { inteligencia: 2, sabedoria: 1 }\n  },\n  aurora: {\n    name: 'Conjunto Aurora',\n    bonus: { forca: 2, sabedoria: 2 }\n  },\n  elfico: {\n    name: 'Conjunto lfico do Arqueiro',\n    bonus: { destreza: 2, sabedoria: 1 }\n  },\n  eterno: {\n    name: 'Conjunto do ltimo Heri',\n    bonus: { forca: 3, carisma: 1, sabedoria: 1 }\n  }\n};\n\n// === FUNES DE COMPRA ===\n\nexport interface PurchaseResult {\n  success: boolean;\n  message: string;\n  newGold?: number; // compatibilidade retro\n  currency?: 'gold' | 'glory' | 'arcaneEssence';\n  newBalance?: number;\n  item?: Item;\n}\n\nexport function canAfford(hero: Hero, item: Item): boolean {\n  const currency = item.currency || 'gold';\n  const prog = hero.progression;\n  const balance = currency === 'gold' ? (prog.gold || 0)\n                  : currency === 'glory' ? (prog.glory || 0)\n                  : (prog.arcaneEssence || 0);\n  const price = getDiscountedPrice(item, hero);\n  return balance >= price;\n}\n\nexport function purchaseItem(hero: Hero, itemId: string): PurchaseResult {\n  const item = SHOP_ITEMS.find(i => i.id === itemId);\n  \n  if (!item) {\n    return {\n      success: false,\n      message: 'Item no encontrado na loja!'\n    };\n  }\n  \n  if (!canAfford(hero, item)) {\n    const currency = item.currency || 'gold';\n    const prog = hero.progression;\n    const balance = currency === 'gold' ? (prog.gold || 0)\n                    : currency === 'glory' ? (prog.glory || 0)\n                    : (prog.arcaneEssence || 0);\n    const currencyName = currency === 'gold' ? 'ouro' : currency === 'glory' ? 'glria' : 'essncia arcana';\n    return {\n      success: false,\n      message: `${currencyName.charAt(0).toUpperCase() + currencyName.slice(1)} insuficiente! Voc precisa de ${getDiscountedPrice(item, hero)} ${currencyName}, mas tem apenas ${balance}.`\n    };\n  }\n  \n  // Verificar se j possui o item (para equipamentos nicos)\n  if (item.type !== 'consumable') {\n    const currentQuantity = hero.inventory.items[itemId] || 0;\n    if (currentQuantity > 0 && (item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory')) {\n      return {\n        success: false,\n        message: 'Voc j possui este equipamento!'\n      };\n    }\n  }\n  \n  const currency = item.currency || 'gold';\n  const prog = hero.progression;\n  const current = currency === 'gold' ? (prog.gold || 0)\n                  : currency === 'glory' ? (prog.glory || 0)\n                  : (prog.arcaneEssence || 0);\n  const price = getDiscountedPrice(item, hero);\n  const newBalance = current - price;\n  const currencyName = currency === 'gold' ? 'ouro' : currency === 'glory' ? 'glria' : 'essncia arcana';\n  return {\n    success: true,\n    message: `${item.name} comprado com sucesso! (-${price} ${currencyName})`,\n    // compat: manter newGold preenchido quando moeda for ouro\n    newGold: currency === 'gold' ? newBalance : undefined,\n    currency,\n    newBalance,\n    item\n  };\n}\n\n// === SISTEMA DE VENDA ===\n\nexport function sellItem(hero: Hero, itemId: string, quantity: number = 1): PurchaseResult {\n  const item = SHOP_ITEMS.find(i => i.id === itemId);\n  const currentQuantity = hero.inventory.items[itemId] || 0;\n  \n  if (!item) {\n    return {\n      success: false,\n      message: 'Item no encontrado!'\n    };\n  }\n  \n  if (currentQuantity < quantity) {\n    return {\n      success: false,\n      message: `Voc no possui ${quantity}x ${item.name}!`\n    };\n  }\n  \n  // Preo de venda  60% do preo de compra\n  const sellPrice = Math.floor(item.price * 0.6 * quantity);\n  \n  return {\n    success: true,\n    message: `${quantity}x ${item.name} vendido por ${sellPrice} ouro!`,\n    newGold: hero.progression.gold + sellPrice,\n    item\n  };\n}\n\n// === SISTEMA DE EQUIPAMENTOS ===\n\nexport function equipItem(hero: Hero, itemId: string): { success: boolean; message: string } {\n  const item = SHOP_ITEMS_MAP[itemId] || SHOP_ITEMS.find(i => i.id === itemId);\n  const hasItem = (hero.inventory.items[itemId] || 0) > 0;\n  \n  if (!item || !hasItem) {\n    return {\n      success: false,\n      message: 'Voc no possui este item!'\n    };\n  }\n  \n  if (item.type === 'consumable' || item.type === 'cosmetic') {\n    return {\n      success: false,\n      message: 'Este item no pode ser equipado!'\n    };\n  }\n\n  if (item.requirements) {\n    const minLevel = item.requirements.minLevel || 0;\n    if ((hero.progression.level || hero.level || 1) < minLevel) {\n      return { success: false, message: `Requer nvel ${minLevel}` };\n    }\n    const allow = item.requirements.classAllow;\n    const deny = item.requirements.classDeny;\n    if (allow && allow.length > 0 && !allow.includes(hero.class)) {\n      return { success: false, message: 'Classe incompatvel para este item' };\n    }\n    if (deny && deny.length > 0 && deny.includes(hero.class)) {\n      return { success: false, message: 'Sua classe no pode usar este item' };\n    }\n  }\n  \n  const inv = hero.inventory;\n  const placeInSlot = (): string | null => {\n    if (item.type === 'weapon') {\n      const prefer = item.slot === 'offHand' ? 'offHand' : 'mainHand';\n      const free = prefer === 'mainHand' ? (!inv.equippedMainHand ? 'mainHand' : (!inv.equippedOffHand ? 'offHand' : null)) : (!inv.equippedOffHand ? 'offHand' : (!inv.equippedMainHand ? 'mainHand' : null));\n      return free;\n    }\n    if (item.type === 'armor') {\n      const s = item.slot;\n      if (s === 'helm' && !inv.equippedHelm) return 'helm';\n      if (s === 'chest' && !inv.equippedChest) return 'chest';\n      if (s === 'belt' && !inv.equippedBelt) return 'belt';\n      if (s === 'gloves' && !inv.equippedGloves) return 'gloves';\n      if (s === 'boots' && !inv.equippedBoots) return 'boots';\n      if (s === 'cape' && !inv.equippedCape) return 'cape';\n      if (!s) return !inv.equippedChest ? 'chest' : null;\n      return null;\n    }\n    if (item.type === 'accessory') {\n      const s = item.slot;\n      if (s === 'necklace' && !inv.equippedNecklace) return 'necklace';\n      if (s === 'ring') {\n        if (!inv.equippedRingLeft) return 'ringLeft';\n        if (!inv.equippedRingRight) return 'ringRight';\n        return null;\n      }\n      if (s === 'earring') {\n        if (!inv.equippedEarringLeft) return 'earringLeft';\n        if (!inv.equippedEarringRight) return 'earringRight';\n        return null;\n      }\n      if (!s) {\n        if (!inv.equippedRingLeft) return 'ringLeft';\n        if (!inv.equippedRingRight) return 'ringRight';\n        if (!inv.equippedNecklace) return 'necklace';\n        if (!inv.equippedEarringLeft) return 'earringLeft';\n        if (!inv.equippedEarringRight) return 'earringRight';\n        return null;\n      }\n      return null;\n    }\n    return null;\n  };\n  const target = placeInSlot();\n  if (!target) return { success: false, message: 'Sem slot disponvel compatvel' };\n  const slotLabelMap: Record<string, string> = {\n    mainHand: 'mo principal', offHand: 'mo secundria', helm: 'helmo', chest: 'armadura', belt: 'cintura', gloves: 'luvas', boots: 'botas', cape: 'asa/capa',\n    ringLeft: 'anel (esq.)', ringRight: 'anel (dir.)', necklace: 'colar', earringLeft: 'brinco (esq.)', earringRight: 'brinco (dir.)'\n  };\n  return { success: true, message: `${item.name} equipado no slot ${slotLabelMap[target]}!` };\n}\n\n// === SISTEMA DE USO DE CONSUMVEIS ===\n\nexport function useConsumable(hero: Hero, itemId: string): { success: boolean; message: string; effects?: any } {\n  const item = SHOP_ITEMS.find(i => i.id === itemId);\n  const hasItem = (hero.inventory.items[itemId] || 0) > 0;\n  \n  if (!item || !hasItem) {\n    return {\n      success: false,\n      message: 'Voc no possui este item!'\n    };\n  }\n  \n  if (item.type !== 'consumable') {\n    return {\n      success: false,\n      message: 'Este item no pode ser usado!'\n    };\n  }\n  \n  let message = `${item.name} usado!`;\n  const effects: any = {};\n  \n  // Aplicar efeitos\n  if (item.effects?.hp) {\n    const currentHp = hero.derivedAttributes.currentHp || hero.derivedAttributes.hp;\n    const newHp = Math.min(hero.derivedAttributes.hp, currentHp + item.effects.hp);\n    effects.hp = newHp;\n    message += ` +${item.effects.hp} HP`;\n  }\n  \n  if (item.effects?.mp) {\n    const currentMp = hero.derivedAttributes.currentMp || hero.derivedAttributes.mp;\n    const newMp = Math.min(hero.derivedAttributes.mp, currentMp + item.effects.mp);\n    effects.mp = newMp;\n    message += ` +${item.effects.mp} MP`;\n  }\n  \n  if (item.id === 'pergaminho-xp') {\n    effects.xp = 50;\n    message += ` +50 XP`;\n  }\n\n  // Fadiga: reduzir diretamente na progresso\n  if (item.effects?.fatigue) {\n    const currentFatigue = hero.progression.fatigue ?? 0;\n    const reduction = Math.min(item.effects.fatigue, currentFatigue);\n    const newFatigue = Math.max(0, currentFatigue - reduction);\n    effects.fatigue = newFatigue;\n    if (reduction > 0) {\n      message += ` -${reduction} Fadiga`;\n    } else {\n      message += ` (sem efeito: Fadiga j 0)`;\n    }\n  }\n\n  return {\n    success: true,\n    message,\n    effects\n  };\n}\n\n// === OFERTAS ESPECIAIS E ROTAO ===\n\nexport function getDailyOffers(): Item[] {\n  // Simular ofertas dirias baseadas na data\n  const today = new Date().toDateString();\n  const seed = today.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n  \n  // Usar seed para gerar ofertas consistentes por dia\n  const rng = () => {\n    const x = Math.sin(seed) * 10000;\n    return x - Math.floor(x);\n  };\n  \n  const offers: Item[] = [];\n  const availableItems = SHOP_ITEMS.filter(item => item.rarity !== 'lendario');\n  \n  // 3 ofertas dirias com desconto\n  for (let i = 0; i < 3; i++) {\n    const index = Math.floor(rng() * availableItems.length);\n    const item = { ...availableItems[index] };\n    item.price = Math.floor(item.price * 0.8); // 20% de desconto\n    offers.push(item);\n  }\n  \n  return offers;\n}\n\n// === SISTEMA DE REPUTAO E DESCONTOS ===\n\n// Desconto adicional por rank do heri\nexport const RANK_PRICE_DISCOUNT: Record<RankLevel, number> = {\n  F: 0.00,\n  E: 0.02,\n  D: 0.04,\n  C: 0.06,\n  B: 0.08,\n  A: 0.10,\n  S: 0.12\n};\n\n// Fator de moderao por raridade: itens mais raros recebem menos desconto efetivo\nexport const RARITY_DISCOUNT_FACTOR: Record<'comum' | 'raro' | 'epico' | 'lendario', number> = {\n  comum: 1.0,\n  raro: 0.9,\n  epico: 0.8,\n  lendario: 0.7\n};\n\nexport function getReputationDiscount(reputation: number): number {\n  if (reputation >= 1000) return 0.15; // 15% desconto\n  if (reputation >= 500) return 0.10;  // 10% desconto\n  if (reputation >= 200) return 0.05;  // 5% desconto\n  return 0;\n}\n\nexport function getDiscountedPrice(item: Item, hero: Hero): number {\n  const reputationDiscount = getReputationDiscount(hero.progression.reputation);\n  const rankLevel: RankLevel = hero.rankData?.currentRank ?? 'F';\n  const rankDiscount = RANK_PRICE_DISCOUNT[rankLevel] ?? 0;\n  const rarityFactor = RARITY_DISCOUNT_FACTOR[item.rarity as 'comum' | 'incomum' | 'raro' | 'epico' | 'lendario'] ?? 1.0;\n  const relationDiscount = getShopDiscountPercent(hero);\n\n  // Soma descontos de reputao e rank, moderados pela raridade; limita desconto total para evitar preos zero\n  const effectiveDiscount = Math.max(0, Math.min(0.5, (reputationDiscount + rankDiscount + relationDiscount) * rarityFactor));\n  const basePrice = computeItemBasePrice(item);\n  return Math.floor(basePrice * (1 - effectiveDiscount));\n}\n\nexport function getDiscountBreakdown(item: Item, hero: Hero) {\n  const reputationDiscount = getReputationDiscount(hero.progression.reputation);\n  const rankLevel: RankLevel = hero.rankData?.currentRank ?? 'F';\n  const rankDiscount = RANK_PRICE_DISCOUNT[rankLevel] ?? 0;\n  const rarityFactor = RARITY_DISCOUNT_FACTOR[item.rarity as 'comum' | 'incomum' | 'raro' | 'epico' | 'lendario'] ?? 1.0;\n  const relationDiscount = getShopDiscountPercent(hero);\n  const effectiveDiscount = Math.max(0, Math.min(0.5, (reputationDiscount + rankDiscount + relationDiscount) * rarityFactor));\n  const basePrice = computeItemBasePrice(item);\n  const effectivePrice = Math.floor(basePrice * (1 - effectiveDiscount));\n  const saved = Math.max(0, basePrice - effectivePrice);\n  return { reputationDiscount, rankDiscount, relationDiscount, rarityFactor, effectiveDiscount, basePrice, effectivePrice, saved };\n}\n\n// Preo base dinmico: nvel  multiplicador de raridade  100.\n// Lendrios com nvel utilizam preo fixo dentro de 10k25k.\nexport function computeItemBasePrice(item: Item): number {\n  const rarityKey = item.rarity as keyof typeof RARITY_CONFIG;\n  const rarityMult = RARITY_CONFIG[rarityKey]?.multiplier ?? 1.0;\n  if (item.level && item.level > 0) {\n    if (item.rarity === 'lendario') {\n      const computed = item.level * rarityMult * 100;\n      return Math.max(10000, Math.min(25000, Math.floor(computed)));\n    }\n    return Math.floor(item.level * rarityMult * 100);\n  }\n  return item.price;\n}\n\nexport type ItemPrefix = 'Flamejante' | 'do Caador' | 'dos Ecos' | 'Glido' | 'Trovejante';\nexport type ItemSuffix = 'da Rapidez' | 'da Fria' | 'da Preciso' | 'do Guardio';\n\nexport interface ProceduralItem {\n  id: string;\n  name: string;\n  baseType: 'espada' | 'arco' | 'cajado' | 'machado';\n  rarity: 'comum' | 'raro' | 'epico' | 'lendario';\n  sockets?: number;\n  bonus?: Partial<HeroAttributes>;\n  elementOverride?: Element;\n}\n\nexport function generateProceduralItem(seed: number, luck = 0): ProceduralItem {\n  const bases: ProceduralItem['baseType'][] = ['espada', 'arco', 'cajado', 'machado'];\n  const baseType = bases[seed % bases.length];\n  const prefixes: ItemPrefix[] = ['Flamejante', 'do Caador', 'dos Ecos', 'Glido', 'Trovejante'];\n  const suffixes: ItemSuffix[] = ['da Rapidez', 'da Fria', 'da Preciso', 'do Guardio'];\n  const prefix = prefixes[(seed + 1) % prefixes.length];\n  const suffix = suffixes[(seed + 2) % suffixes.length];\n  const rarityRoll = (seed % 100) + luck;\n  const rarity: ProceduralItem['rarity'] = rarityRoll > 90 ? 'lendario' : rarityRoll > 70 ? 'epico' : rarityRoll > 40 ? 'raro' : 'comum';\n  const sockets = rarity === 'lendario' ? 3 : rarity === 'epico' ? 2 : rarity === 'raro' ? 1 : 0;\n  const elementOverride: Element | undefined = prefix === 'Flamejante' ? 'fire' : prefix === 'Glido' ? 'ice' : prefix === 'Trovejante' ? 'thunder' : undefined;\n  const bonus = { forca: baseType === 'espada' ? 2 : 0, destreza: baseType === 'arco' ? 2 : 0, inteligencia: baseType === 'cajado' ? 2 : 0 };\n  return { id: crypto.randomUUID(), name: `${baseType} ${prefix} ${suffix}`, baseType, rarity, sockets, bonus, elementOverride };\n}\n","export function getWeeklyMutatorEnemyElement(): string | null {\n  try {\n    const raw = localStorage.getItem('replay_weekly_mutator')\n    if (!raw) return null\n    const obj = JSON.parse(raw)\n    const el = obj?.modifiers?.enemy_element\n    return typeof el === 'string' ? el : null\n  } catch { return null }\n}\n\nexport function getGlobalCritBonus(): number {\n  try {\n    const rawRelics = localStorage.getItem('replay_player_relics')\n    const list = rawRelics ? JSON.parse(rawRelics) : []\n    let bonus = 0\n    for (const r of list || []) {\n      const b = r?.effect?.global_crit_bonus\n      if (typeof b === 'number') bonus += b\n    }\n    return Math.max(0, Math.min(0.5, bonus))\n  } catch { return 0 }\n}\n\nexport function getEnemyDamageMultiplier(): number {\n  try {\n    const raw = localStorage.getItem('replay_global_events')\n    const list = raw ? JSON.parse(raw) : []\n    let mult = 1\n    for (const e of list || []) {\n      const m = e?.modifiers?.enemy_damage_multiplier\n      if (typeof m === 'number') mult *= m\n    }\n    return Math.max(0.5, Math.min(3, mult))\n  } catch { return 1 }\n}\n\nexport function getRareItemChanceBonus(): number {\n  try {\n    const raw = localStorage.getItem('replay_global_events')\n    const list = raw ? JSON.parse(raw) : []\n    let bonus = 0\n    for (const e of list || []) {\n      const b = e?.modifiers?.rare_item_chance\n      if (typeof b === 'number') bonus += b\n    }\n    return Math.max(0, Math.min(0.5, bonus))\n  } catch { return 0 }\n}","export type DungeonDifficulty = 'facil' | 'normal' | 'dificil' | 'epico' | 'hardcore' | 'caotico';\n\nexport type DungeonConfig = {\n  enemyBase: { hp: number; atk: number; def: number };\n  scaling: { hpPerFloor: number; atkPerFloor: number; defPerFloor: number; bossMultiplier: number; affixBonus: number };\n  rewards: { xpPerFloor: number; goldPerFloor: number; rarityIncreasePerFloor: number; streakMultiplierPerFloor: number };\n  events: { baseChance: number };\n  deathPenalty: { normal: { gold: number; xp: number }, hardcore: { gold: number; xp: number } };\n  difficultyMultipliers: Record<DungeonDifficulty, { enemy: number; rewards: number; successBaseBias: number }>;\n};\n\nexport const dungeonConfig: DungeonConfig = {\n  enemyBase: { hp: 30, atk: 6, def: 3 },\n  scaling: { hpPerFloor: 0.12, atkPerFloor: 0.1, defPerFloor: 0.08, bossMultiplier: 1.8, affixBonus: 0.2 },\n  rewards: { xpPerFloor: 6, goldPerFloor: 2, rarityIncreasePerFloor: 0.6, streakMultiplierPerFloor: 0.07 },\n  events: { baseChance: 0.1 },\n  deathPenalty: { normal: { gold: 0.5, xp: 0.3 }, hardcore: { gold: 0.8, xp: 0.6 } },\n  difficultyMultipliers: {\n    facil: { enemy: 0.85, rewards: 0.9, successBaseBias: 0.1 },\n    normal: { enemy: 1.0, rewards: 1.0, successBaseBias: 0.0 },\n    dificil: { enemy: 1.2, rewards: 1.25, successBaseBias: -0.05 },\n    epico: { enemy: 1.45, rewards: 1.5, successBaseBias: -0.1 },\n    hardcore: { enemy: 1.6, rewards: 1.7, successBaseBias: -0.15 },\n    caotico: { enemy: 1.3, rewards: 1.6, successBaseBias: -0.2 }\n  }\n};\n\nexport function isBossFloor(floor: number): boolean {\n  return floor > 0 && floor % 10 === 0;\n}\n\nexport function isMiniBossFloor(floor: number): boolean {\n  return floor > 0 && floor % 5 === 0 && floor % 10 !== 0;\n}\n\nexport function computeRewardMultiplier(streak: number) {\n  return 1 + streak * dungeonConfig.rewards.streakMultiplierPerFloor;\n}\n\nexport function getDifficultyParams(diff: DungeonDifficulty) {\n  return dungeonConfig.difficultyMultipliers[diff] || dungeonConfig.difficultyMultipliers.normal;\n}\n","/**\n * Sistema Elemental\n * Verso 3.0 - Forjador de Heris\n */\n\nimport { Element } from '../types/hero';\n\nexport const ELEMENT_ADVANTAGES: Record<Element, { beats?: Element | Element[]; weak?: Element | Element[] }> = {\n  fire:  { beats: 'earth', weak: 'water' },\n  water: { beats: 'fire', weak: 'thunder' },\n  earth: { beats: 'thunder', weak: 'fire' },\n  air:   { },\n  thunder: { beats: 'water', weak: 'earth' },\n  light: { beats: 'dark', weak: 'dark' },\n  dark:  { beats: ['fire','water','earth','air','thunder'], weak: 'light' },\n  physical: {}\n};\n\nexport const ELEMENT_INFO: Record<Element, { name: string; icon: string; color: string; description: string }> = {\n  fire:     { name: 'Fogo',    icon: '', color: '#FF4500', description: '+10% dano contnuo; vence Terra; perde para gua' },\n  water:    { name: 'gua',    icon: '', color: '#1E90FF', description: '+10% cura recebida; vence Fogo; perde para Raio' },\n  earth:    { name: 'Terra',   icon: '', color: '#8B4513', description: '+20% defesa base; vence Raio; perde para Fogo' },\n  air:      { name: 'Ar',      icon: '', color: '#87CEEB', description: '+10% chance de crtico; instvel' },\n  thunder:  { name: 'Raio',    icon: '', color: '#FFD700', description: '+10% velocidade; vence gua; perde para Terra' },\n  light:    { name: 'Luz',     icon: '', color: '#FFFF00', description: '+5% cura e dano sagrado; vence Trevas' },\n  dark:     { name: 'Trevas',  icon: '', color: '#4B0082', description: 'Roubo de vida 5%; vence todos exceto Luz' },\n  physical: { name: 'Fsico',  icon: '', color: '#808080', description: 'Neutro' }\n};\n\n/**\n * Calcula o multiplicador de dano elemental\n */\nexport function getElementMultiplier(attackElement: Element, defendElement: Element): number {\n  if (attackElement === defendElement) return 1.0;\n  const adv = ELEMENT_ADVANTAGES[attackElement];\n  const beats = Array.isArray(adv.beats) ? adv.beats : adv.beats ? [adv.beats] : [];\n  const weaks = Array.isArray(adv.weak) ? adv.weak : adv.weak ? [adv.weak] : [];\n  if (beats.includes(defendElement)) return 1.3;\n  if (weaks.includes(defendElement)) return 0.7;\n  return 1.0;\n}\n\n/**\n * Obtm informaes sobre vantagens elementais\n */\nexport function getElementAdvantageInfo(element: Element): {\n  strong: Element[];\n  weak: Element[];\n  neutral: Element[];\n} {\n  const strong: Element[] = [];\n  const weak: Element[] = [];\n  const neutral: Element[] = [];\n  \n  Object.entries(ELEMENT_ADVANTAGES).forEach(([elem, data]) => {\n    const currentElement = elem as Element;\n    \n    if (currentElement === element) return;\n    \n    if (data.beats === element) {\n      weak.push(currentElement);\n    } else if (data.weak === element) {\n      strong.push(currentElement);\n    } else {\n      neutral.push(currentElement);\n    }\n  });\n  \n  return { strong, weak, neutral };\n}\n\n/**\n * Gera um elemento aleatrio\n */\nexport function generateRandomElement(): Element {\n  const elements: Element[] = ['fire','water','earth','air','thunder','light','dark'];\n  return elements[Math.floor(Math.random() * elements.length)];\n}\n\n/**\n * Obtm elementos recomendados para uma classe\n */\nexport function getRecommendedElements(heroClass: string): Element[] {\n  const recommendations: Record<string, Element[]> = {\n    guerreiro: ['earth','fire','physical'],\n    mago: ['fire','water','thunder'],\n    arqueiro: ['air','thunder','earth'],\n    clerigo: ['light','water','earth'],\n    ladino: ['dark','air','thunder'],\n    patrulheiro: ['earth','air','water'],\n    paladino: ['light','fire','earth']\n  };\n  return recommendations[heroClass.toLowerCase()] || ['physical'];\n}\n\n/**\n * Calcula afinidade elemental (bnus para skills do mesmo elemento)\n */\nexport function calculateElementalAffinity(heroElement: Element, skillElement?: Element): number {\n  if (!skillElement || skillElement === 'physical') return 1.0;\n  if (heroElement === skillElement) return 1.1; // +10% para mesmo elemento\n  return 1.0;\n}\n\n// Fallback centralizado: retorna info de 'physical' se no encontrado\nexport function getElementInfoSafe(element: Element | string) {\n  const key = element as Element;\n  return ELEMENT_INFO[key] || ELEMENT_INFO['physical'];\n}\n\nexport const ELEMENT_ADV: Record<Element, { beats: Element[]; weak?: Element[] }> = {\n  fire: { beats: ['earth'], weak: ['water'] },\n  water: { beats: ['fire'], weak: ['thunder'] },\n  earth: { beats: ['thunder'], weak: ['fire'] },\n  air: { beats: [] },\n  thunder: { beats: ['water'], weak: ['earth'] },\n  light: { beats: ['dark'], weak: ['dark'] },\n  dark: { beats: ['fire','water','earth','air','thunder'], weak: ['light'] },\n  physical: { beats: [] }\n};\n\nexport function computeElementMultiplier(atkElem: Element, defElem: Element, atkAffinity = 0, defResistance = 0): number {\n  let base = 1.0;\n  if (ELEMENT_ADV[atkElem]?.beats.includes(defElem)) base *= 1.3;\n  if (ELEMENT_ADV[defElem]?.beats.includes(atkElem)) base *= 0.75;\n  base *= 1 + (atkAffinity - defResistance) / 100;\n  return Math.max(0.4, Math.min(base, 2.5));\n}","/**\n * Sistema de Combate - RNG + Atributos\n */\n\nimport { Hero, CombatResult, QuestEnemy, Item, Skill, Element } from '../types/hero';\nimport { SHOP_ITEMS } from './shop';\nimport { getWeeklyMutatorEnemyElement, getGlobalCritBonus, getEnemyDamageMultiplier } from './replayModifiers';\nimport { dungeonConfig } from './dungeonConfig';\nimport { getElementMultiplier, generateRandomElement, computeElementMultiplier, calculateElementalAffinity } from './elementSystem';\n\n// === TIPOS DE COMBATE ===\n\ninterface CombatEntity {\n  name: string;\n  hp: number;\n  maxHp: number;\n  forca: number;\n  destreza: number;\n  constituicao: number;\n  inteligencia: number;\n  sabedoria: number;\n  carisma: number;\n  armor: number;\n  weapon?: {\n    name: string;\n    atk: number;\n    critChance?: number;\n  };\n}\n\ninterface AttackResult {\n  hit: boolean;\n  damage: number;\n  crit: boolean;\n  message: string;\n}\n\n// === DADOS DOS INIMIGOS ===\n\nconst ENEMY_TEMPLATES: Record<string, Partial<CombatEntity>> = {\n  'Lobo': {\n    hp: 25,\n    forca: 6,\n    destreza: 8,\n    constituicao: 5,\n    inteligencia: 2,\n    sabedoria: 6,\n    carisma: 3,\n    armor: 1,\n    weapon: { name: 'Presas', atk: 4, critChance: 0.1 }\n  },\n  'Goblin': {\n    hp: 20,\n    forca: 4,\n    destreza: 9,\n    constituicao: 4,\n    inteligencia: 5,\n    sabedoria: 4,\n    carisma: 2,\n    armor: 2,\n    weapon: { name: 'Adaga Enferrujada', atk: 3, critChance: 0.15 }\n  },\n  'Bandido': {\n    hp: 35,\n    forca: 7,\n    destreza: 6,\n    constituicao: 6,\n    inteligencia: 4,\n    sabedoria: 5,\n    carisma: 4,\n    armor: 3,\n    weapon: { name: 'Espada Curta', atk: 5, critChance: 0.08 }\n  },\n  'Esqueleto': {\n    hp: 30,\n    forca: 5,\n    destreza: 7,\n    constituicao: 8,\n    inteligencia: 3,\n    sabedoria: 4,\n    carisma: 1,\n    armor: 2,\n    weapon: { name: 'Espada Antiga', atk: 4, critChance: 0.05 }\n  },\n  'Troll': {\n    hp: 80,\n    forca: 12,\n    destreza: 3,\n    constituicao: 10,\n    inteligencia: 2,\n    sabedoria: 3,\n    carisma: 2,\n    armor: 4,\n    weapon: { name: 'Clava Gigante', atk: 8, critChance: 0.12 }\n  },\n  'Guardio de Pedra': {\n    hp: 120,\n    forca: 14,\n    destreza: 2,\n    constituicao: 16,\n    inteligencia: 3,\n    sabedoria: 5,\n    carisma: 1,\n    armor: 8,\n    weapon: { name: 'Punhos Monolticos', atk: 10, critChance: 0.08 }\n  },\n  'Rei Goblin': {\n    hp: 95,\n    forca: 10,\n    destreza: 12,\n    constituicao: 10,\n    inteligencia: 6,\n    sabedoria: 4,\n    carisma: 6,\n    armor: 5,\n    weapon: { name: 'Lmina Real Goblin', atk: 9, critChance: 0.18 }\n  },\n  'Feiticeiro das Sombras': {\n    hp: 90,\n    forca: 6,\n    destreza: 7,\n    constituicao: 9,\n    inteligencia: 14,\n    sabedoria: 10,\n    carisma: 5,\n    armor: 3,\n    weapon: { name: 'Cajado Obscuro', atk: 11, critChance: 0.15 }\n  },\n  'Tit de Gelo': {\n    hp: 130,\n    forca: 13,\n    destreza: 4,\n    constituicao: 18,\n    inteligencia: 4,\n    sabedoria: 6,\n    carisma: 2,\n    armor: 7,\n    weapon: { name: 'Martelo Glacial', atk: 12, critChance: 0.12 }\n  },\n  'Draco Etreo': {\n    hp: 140,\n    forca: 15,\n    destreza: 8,\n    constituicao: 14,\n    inteligencia: 8,\n    sabedoria: 6,\n    carisma: 8,\n    armor: 6,\n    weapon: { name: 'Garras Etreas', atk: 13, critChance: 0.2 }\n  },\n  'Arauto gneo': {\n    hp: 125,\n    forca: 14,\n    destreza: 6,\n    constituicao: 12,\n    inteligencia: 10,\n    sabedoria: 5,\n    carisma: 4,\n    armor: 5,\n    weapon: { name: 'Lana Flamejante', atk: 12, critChance: 0.16 }\n  }\n};\n\n// === LOOT TABLES ===\n\nconst LOOT_TABLES: Record<string, { items: Item[], dropRates: number[] }> = {\n  'Lobo': {\n    items: [\n      { id: 'pele-lobo', name: 'Pele de Lobo', description: 'Material para crafting', type: 'consumable', rarity: 'comum', price: 15 },\n      { id: 'pocao-pequena', name: 'Poo de Cura Pequena', description: 'Restaura 20 HP', type: 'consumable', rarity: 'comum', price: 25, effects: { hp: 20 } }\n    ],\n    dropRates: [0.6, 0.3] // 60% pele, 30% poo\n  },\n  'Goblin': {\n    items: [\n      { id: 'moeda-goblin', name: 'Moeda Goblin', description: 'Moeda de valor duvidoso', type: 'consumable', rarity: 'comum', price: 10 },\n      { id: 'adaga-ferro', name: 'Adaga de Ferro', description: '+2 Fora', type: 'weapon', rarity: 'comum', price: 50, bonus: { forca: 2 } }\n    ],\n    dropRates: [0.7, 0.2]\n  },\n  'Bandido': {\n    items: [\n      { id: 'espada-ferro', name: 'Espada de Ferro', description: '+3 Fora', type: 'weapon', rarity: 'raro', price: 100, bonus: { forca: 3 } },\n      { id: 'armadura-couro', name: 'Armadura de Couro', description: '+2 Constituio', type: 'armor', rarity: 'comum', price: 75, bonus: { constituicao: 2 } }\n    ],\n    dropRates: [0.25, 0.4]\n  },\n  'Esqueleto': {\n    items: [\n      { id: 'osso-antigo', name: 'Osso Antigo', description: 'Material mgico', type: 'consumable', rarity: 'raro', price: 30 },\n      { id: 'pergaminho-xp', name: 'Pergaminho de Experincia', description: '+50 XP', type: 'consumable', rarity: 'raro', price: 80, effects: { duration: 0 } }\n    ],\n    dropRates: [0.5, 0.2]\n  },\n  'Guardio de Pedra': {\n    items: [\n      { id: 'armadura-pedra-rachada', name: 'Armadura de Pedra Rachada', description: '+6 Constituio', type: 'armor', rarity: 'epico', price: 640, bonus: { constituicao: 6 } }\n    ],\n    dropRates: [0.3]\n  },\n  'Rei Goblin': {\n    items: [\n      { id: 'adaga-ferro', name: 'Adaga de Ferro', description: '+2 Fora', type: 'weapon', rarity: 'comum', price: 50, bonus: { forca: 2 } },\n      { id: 'anel-precisao', name: 'Anel da Preciso', description: '+2 Destreza, +1 Inteligncia', type: 'accessory', rarity: 'epico', price: 280, bonus: { destreza: 2, inteligencia: 1 } }\n    ],\n    dropRates: [0.35, 0.15]\n  },\n  'Feiticeiro das Sombras': {\n    items: [\n      { id: 'cajado-arcano', name: 'Cajado Arcano', description: '+4 Inteligncia', type: 'weapon', rarity: 'epico', price: 420, bonus: { inteligencia: 4 } }\n    ],\n    dropRates: [0.25]\n  },\n  'Tit de Gelo': {\n    items: [\n      { id: 'cajado-cristal', name: 'Cajado de Cristal', description: '+3 Inteligncia, +1 Sabedoria', type: 'weapon', rarity: 'raro', price: 260, bonus: { inteligencia: 3, sabedoria: 1 } }\n    ],\n    dropRates: [0.3]\n  },\n  'Draco Etreo': {\n    items: [\n      { id: 'asas-lendarias', name: 'Asas Lendrias', description: '+4 Destreza, +2 Inteligncia, +1 Sabedoria', type: 'armor', rarity: 'lendario', price: 900, bonus: { destreza: 4, inteligencia: 2, sabedoria: 1 }, slot: 'cape' }\n    ],\n    dropRates: [0.08]\n  },\n  'Arauto gneo': {\n    items: [\n      { id: 'espada-flamejante', name: 'Espada Flamejante', description: 'Chance temtica de causar dano de fogo.', type: 'weapon', rarity: 'raro', price: 280, bonus: { forca: 5 } }\n    ],\n    dropRates: [0.25]\n  }\n};\n\n// === FUNES DE COMBATE ===\n\nfunction createEnemyFromTemplate(enemyType: string, level: number = 1): CombatEntity {\n  const template = ENEMY_TEMPLATES[enemyType];\n  if (!template) {\n    throw new Error(`Tipo de inimigo desconhecido: ${enemyType}`);\n  }\n\n  const levelMultiplier = 1 + (level - 1) * 0.3;\n  \n  return {\n    name: enemyType,\n    hp: Math.floor((template.hp || 20) * levelMultiplier),\n    maxHp: Math.floor((template.hp || 20) * levelMultiplier),\n    forca: Math.floor((template.forca || 5) * levelMultiplier),\n    destreza: Math.floor((template.destreza || 5) * levelMultiplier),\n    constituicao: Math.floor((template.constituicao || 5) * levelMultiplier),\n    inteligencia: template.inteligencia || 3,\n    sabedoria: template.sabedoria || 3,\n    carisma: template.carisma || 3,\n    armor: Math.floor((template.armor || 0) * levelMultiplier),\n    weapon: template.weapon\n  };\n}\n\nfunction heroToCombatEntity(hero: Hero): CombatEntity {\n  const currentHp = hero.derivedAttributes.currentHp || hero.derivedAttributes.hp;\n  \n  return {\n    name: hero.name,\n    hp: currentHp,\n    maxHp: hero.derivedAttributes.hp,\n    forca: hero.attributes.forca,\n    destreza: hero.attributes.destreza,\n    constituicao: hero.attributes.constituicao,\n    inteligencia: hero.attributes.inteligencia,\n    sabedoria: hero.attributes.sabedoria,\n    carisma: hero.attributes.carisma,\n    armor: hero.derivedAttributes.armorClass,\n    weapon: { name: 'Arma Bsica', atk: 2, critChance: 0.05 },\n    \n  };\n}\n\nexport function resolveAttack(attacker: CombatEntity, defender: CombatEntity, opts?: { ramp?: number; attackElement?: Element; defendElement?: Element; skillBonus?: number; atkAffinity?: number; defResistance?: number; isEnemyAttack?: boolean }): AttackResult {\n  // Calcular chance de acerto baseada em destreza\n  let baseHit = 50 + (attacker.destreza - defender.destreza) * 3;\n  if ((opts?.attackElement || 'physical') === 'thunder') baseHit += 5;\n  let hitChance = Math.max(5, Math.min(95, baseHit));\n  \n  \n  const roll = Math.floor(Math.random() * 100) + 1;\n  \n  if (roll <= hitChance) {\n    // Acertou! Calcular dano\n    const weaponAtk = attacker.weapon?.atk || 0;\n    let baseDamage = attacker.forca + weaponAtk + (opts?.skillBonus || 0);\n    \n    // Verificar crtico\n    let critChance = attacker.weapon?.critChance || 0.05;\n    critChance = Math.min(0.95, critChance + getGlobalCritBonus());\n    if ((opts?.attackElement || 'physical') === 'air') critChance = Math.min(0.95, critChance + 0.10);\n    \n    const isCrit = Math.random() < critChance;\n    \n    // Multiplicadores: crtico, ramp de dano e elemento\n    const ramp = opts?.ramp || 1;\n    const elemMult = computeElementMultiplier(\n      opts?.attackElement || 'physical',\n      opts?.defendElement || 'physical',\n      opts?.atkAffinity || 0,\n      opts?.defResistance || 0\n    );\n    const effectiveArmor = Math.floor((defender.armor || 0) * (((opts?.defendElement || 'physical') === 'earth') ? 1.20 : 1.0));\n    const enemyMult = opts?.isEnemyAttack ? getEnemyDamageMultiplier() : 1;\n    const finalDamage = Math.max(1, Math.floor(\n      baseDamage * (isCrit ? 1.5 : 1) * ramp * elemMult * enemyMult - effectiveArmor\n    ));\n    \n    const weaponName = attacker.weapon?.name || 'punhos';\n    const critText = isCrit ? ' CRTICO!' : '';\n    const elemText = elemMult > 1 ? ' (super efetivo!)' : (elemMult < 1 ? ' (pouco efetivo)' : '');\n    \n  return {\n    hit: true,\n    damage: finalDamage,\n    crit: isCrit,\n    message: `${attacker.name} ataca com ${weaponName} e causa ${finalDamage} de dano${critText}${elemText}`\n  };\n  } else {\n    return {\n      hit: false,\n      damage: 0,\n      crit: false,\n      message: `${attacker.name} erra o ataque!`\n    };\n  }\n}\n\nfunction generateLoot(enemyType: string): Item[] {\n  const lootTable = LOOT_TABLES[enemyType];\n  if (!lootTable) return [];\n  \n  const loot: Item[] = [];\n  \n  lootTable.items.forEach((item, index) => {\n    const dropRate = lootTable.dropRates[index] || 0;\n    if (Math.random() < dropRate) {\n      loot.push(item);\n    }\n  });\n  const extra: { id: string; chance: number }[] = [\n    { id: 'pedra-alma', chance: 0.05 },\n    { id: 'essencia-calor', chance: 0.02 },\n    { id: 'brasas-magicas', chance: 0.01 }\n  ];\n  if (enemyType === 'Troll') {\n    extra.push({ id: 'essencia-bestial', chance: 0.03 });\n    extra.push({ id: 'pergaminho-montaria', chance: 0.02 });\n  }\n  extra.forEach(({ id, chance }) => {\n    if (Math.random() < chance) {\n      const it = SHOP_ITEMS.find(i => i.id === id);\n      if (it) loot.push(it);\n    }\n  });\n  \n  return loot;\n}\n\nfunction calculateXpReward(enemy: CombatEntity, heroLevel: number): number {\n  const baseXp = enemy.maxHp + enemy.forca + enemy.destreza;\n  const levelDiff = Math.max(1, enemy.maxHp / 20) - heroLevel; // Estimar nvel do inimigo\n  \n  // Mais XP para inimigos de nvel similar ou superior\n  const multiplier = levelDiff >= 0 ? 1 + (levelDiff * 0.2) : Math.max(0.5, 1 + (levelDiff * 0.1));\n  \n  return Math.floor(baseXp * multiplier);\n}\n\nfunction calculateGoldReward(enemy: CombatEntity): number {\n  return Math.floor((enemy.maxHp + enemy.forca) * 0.8) + Math.floor(Math.random() * 10);\n}\n\n// === SISTEMA DE HABILIDADES ===\n\nexport interface SkillUseResult {\n  damage: number;\n  elementMultiplier: number;\n  healing?: number;\n  effects?: string[];\n  success: boolean;\n  message: string;\n}\n\n/**\n * Resolve o uso de uma habilidade em combate\n */\nexport function resolveSkillUse(user: Hero, target: Hero | CombatEntity, skill: Skill): SkillUseResult {\n  const targetElement = (target as Hero).element || 'physical';\n  console.debug('[combat] resolveSkillUse:start', {\n    user: user?.name,\n    target: (target as any)?.name || 'enemy',\n    skill: skill?.name,\n    effects: skill?.effects\n  });\n  \n  // Calcular poder base da habilidade\n  let basePower = skill.basePower || 0;\n  \n  // Modificadores baseados em atributos\n  switch (skill.type) {\n    case 'attack':\n      basePower += user.attributes.forca * 0.5;\n      break;\n    case 'support':\n      basePower += user.attributes.inteligencia * 0.3;\n      break;\n    case 'buff':\n      basePower += user.attributes.destreza * 0.2;\n      break;\n  }\n  console.debug('[combat] basePower', basePower);\n  \n  // Calcular multiplicador elemental\n  const elementMultiplier = computeElementMultiplier(\n    skill.element || 'physical',\n    targetElement,\n    calculateElementalAffinity(user.element, skill.element),\n    0\n  );\n  console.debug('[combat] elementMultiplier', elementMultiplier);\n  \n  // Calcular dano final\n  let finalDamage = 0;\n  let healing = 0;\n  const effects: string[] = [];\n  \n  if (skill.type === 'attack') {\n    const targetDefense = (target as any).constituicao || target.constituicao || 0;\n    let dmg = Math.max(0, Math.floor(basePower * elementMultiplier) - (targetDefense * 0.3));\n    if ((user.element || 'physical') === 'light' && (skill.element || 'physical') === 'light') {\n      dmg = Math.floor(dmg * 1.05);\n    }\n    finalDamage = dmg;\n    console.debug('[combat] attack calc', { targetDefense, finalDamage });\n  } else if (skill.type === 'support' && skill.name.includes('Cura')) {\n    let healVal = Math.floor(basePower);\n    if ((user.element || 'physical') === 'water') healVal = Math.floor(healVal * 1.10);\n    if ((user.element || 'physical') === 'light') healVal = Math.floor(healVal * 1.05);\n    healing = healVal;\n    console.debug('[combat] healing calc', { healing });\n  }\n  \n  // Adicionar efeitos especiais baseados na habilidade\n  if (skill.effects) {\n    const e = skill.effects;\n    const effectTexts: string[] = [];\n    if (e.special) effectTexts.push(e.special);\n    if (typeof e.heal === 'number' && e.heal > 0) effectTexts.push(`cura ${e.heal}`);\n    if (e.buff?.attribute) effectTexts.push(`buff ${String(e.buff.attribute)}`);\n    if (e.debuff?.attribute) effectTexts.push(`debuff ${String(e.debuff.attribute)}`);\n    effects.push(...effectTexts);\n    console.debug('[combat] effects parsed', effectTexts);\n\n    // Ajustes funcionais principais\n    if (e.special === 'double_strike' && finalDamage > 0) {\n      finalDamage = Math.floor(finalDamage * 2);\n    }\n    if (e.special === 'lifesteal_small' && finalDamage > 0) {\n      let ls = Math.floor(finalDamage * 0.2);\n      if ((user.element || 'physical') === 'water') ls = Math.floor(ls * 1.10);\n      if ((user.element || 'physical') === 'light') ls = Math.floor(ls * 1.05);\n      healing += ls;\n    }\n    if (e.special === 'heal_over_time') {\n      healing += e.heal ? e.heal : Math.floor(basePower * 0.5);\n    }\n  }\n  \n  // Determinar sucesso (pode falhar em casos especficos)\n  const successRate = 0.9; // 90% de chance base\n  const success = Math.random() < successRate;\n  console.debug('[combat] success roll', { success });\n  \n  // Gerar mensagem\n  let message = `${user.name} usa ${skill.name}!`;\n  if (!success) {\n    message += ' Mas falhou!';\n    return {\n      damage: 0,\n      elementMultiplier: 1,\n      effects: [],\n      success: false,\n      message\n    };\n  }\n  \n  if (finalDamage > 0) {\n    message += ` Causa ${finalDamage} de dano`;\n    if (elementMultiplier > 1) {\n      message += ' (super efetivo!)';\n    } else if (elementMultiplier < 1) {\n      message += ' (pouco efetivo)';\n    }\n  }\n  \n  if (healing > 0) {\n    message += ` Cura ${healing} HP`;\n  }\n  \n  if (effects.length > 0) {\n    message += ` (${effects.join(', ')})`;\n  }\n  \n  return {\n    damage: finalDamage,\n    elementMultiplier,\n    healing,\n    effects,\n    success: true,\n    message\n  };\n}\n\n// === FUNO PRINCIPAL DE COMBATE ===\n\nexport function resolveCombat(hero: Hero, enemies: QuestEnemy[], opts: { floor?: number; partyBonusPercent?: number } = {}): CombatResult {\n  const combatLog: string[] = [];\n  let totalXp = 0;\n  let totalGold = 0;\n  let allLoot: Item[] = [];\n  \n  const heroEntity = heroToCombatEntity(hero);\n  combatLog.push(`${heroEntity.name} entra em combate!`);\n\n  const heroElement: Element = hero.element || 'physical';\n  const activePet = (hero.pets || []).find(p => p.id === (hero as any).activePetId);\n  let petEnergy = activePet?.energy ?? 0;\n  let petEnergyUsed = 0;\n  let petCooldownLeft = 0;\n  let petDamageTotal = 0;\n  let petHealingTotal = 0;\n  let petStunCount = 0;\n  let heroElementOverride: Element | null = null;\n  let heroElementOverrideTurns = 0;\n  const petElementSet = new Set<Element>();\n  \n  // Processar cada inimigo\n  for (const questEnemy of enemies) {\n    for (let i = 0; i < questEnemy.count; i++) {\n      const enemy = createEnemyFromTemplate(questEnemy.type, questEnemy.level || 1);\n      let enemyElement: Element = (getWeeklyMutatorEnemyElement() as Element) || generateRandomElement();\n      if (enemy.name === 'Guardio de Pedra') enemyElement = 'earth';\n      if (enemy.name === 'Rei Goblin') enemyElement = 'air';\n      if (enemy.name === 'Feiticeiro das Sombras') enemyElement = 'dark';\n      if (enemy.name === 'Tit de Gelo') enemyElement = 'ice';\n      if (enemy.name === 'Draco Etreo') enemyElement = 'thunder';\n      if (enemy.name === 'Arauto gneo') enemyElement = 'fire';\n      combatLog.push(`\\n--- Enfrentando ${enemy.name} ---`);\n      combatLog.push(`Elemento do inimigo: ${enemyElement}`);\n      let enemyBurn = 0;\n      let heroBurn = 0;\n      \n      // Combate por turnos\n      let turn = 1;\n      let enemyFled = false;\n      const maxTurns = 20; // aumentar teto de turnos\n      while (heroEntity.hp > 0 && enemy.hp > 0 && turn <= maxTurns) {\n        // Determinar quem ataca primeiro (baseado em destreza, Raio +1)\n        const heroFirst = (heroEntity.destreza + (heroElement === 'thunder' ? 1 : 0)) >= (enemy.destreza + (enemyElement === 'thunder' ? 1 : 0));\n        const ramp = 1 + Math.min(0.10 + turn * 0.06, 2.0);\n        if (enemy.name === 'Guardio de Pedra') enemy.armor = Math.floor(enemy.armor * 1.2);\n        if (enemy.name === 'Rei Goblin') enemy.destreza = Math.floor(enemy.destreza * 1.15);\n        if (enemy.name === 'Feiticeiro das Sombras' && turn % 3 === 0 && enemy.hp > 0) {\n          const siphon = Math.floor(3 + Math.random() * 6);\n          heroEntity.hp = Math.max(0, heroEntity.hp - siphon);\n          enemy.hp = Math.min(enemy.maxHp, enemy.hp + siphon);\n          combatLog.push(` ${enemy.name} drena ${siphon} HP do heri`);\n        }\n        if (enemy.name === 'Tit de Gelo' && turn % 4 === 0) {\n          const chill = Math.floor(2 + Math.random() * 4);\n          const oldDex = heroEntity.destreza;\n          heroEntity.destreza = Math.max(1, heroEntity.destreza - 1);\n          combatLog.push(` ${enemy.name} reduz a destreza do heri (${oldDex}${heroEntity.destreza})`);\n        }\n        if (enemy.name === 'Draco Etreo' && turn % 3 === 0) {\n          const surge = Math.floor(3 + Math.random() * 5);\n          enemy.weapon = { ...(enemy.weapon || { name: 'Garras', atk: 10, critChance: 0.2 }), atk: (enemy.weapon?.atk || 10) + 1 };\n          combatLog.push(` ${enemy.name} acumula energia etrea`);\n        }\n        if (enemyBurn > 0 && enemy.hp > 0) {\n          enemy.hp = Math.max(0, enemy.hp - enemyBurn);\n          combatLog.push(` Queimadura causa ${enemyBurn} dano contnuo no inimigo`);\n          enemyBurn = 0;\n        }\n        if (heroBurn > 0 && heroEntity.hp > 0) {\n          heroEntity.hp = Math.max(0, heroEntity.hp - heroBurn);\n          combatLog.push(` Queimadura causa ${heroBurn} dano contnuo em ${heroEntity.name}`);\n          heroBurn = 0;\n        }\n        \n        if (heroFirst) {\n          // Heri ataca primeiro\n          // Chance de usar habilidade ofensiva\n          const useSkill = (hero.skills && hero.skills.length > 0) && Math.random() < 0.35;\n          let stunned = false;\n          if (useSkill) {\n            const atkSkill = hero.skills.find(s => (s as any).type === 'attack') || hero.skills[0];\n            const skillRes = resolveSkillUse(hero, enemy, atkSkill as any);\n            enemy.hp = Math.max(0, enemy.hp - Math.floor(skillRes.damage * ramp));\n            combatLog.push(`Turno ${turn}: ${skillRes.message}`);\n            if (skillRes.healing && skillRes.healing > 0) {\n              heroEntity.hp = Math.min(heroEntity.maxHp, heroEntity.hp + skillRes.healing);\n            }\n            stunned = (skillRes.effects || []).some(e => e.includes('freeze_stun') || e.includes('stun_1'));\n          } else {\n            const atkElem = heroElementOverride && heroElementOverrideTurns > 0 ? heroElementOverride : heroElement;\n            const heroAttack = resolveAttack(heroEntity, enemy, { ramp, attackElement: atkElem, defendElement: enemyElement, atkAffinity: atkElem !== 'physical' && atkElem === heroElement ? 10 : 0, defResistance: 0 });\n            enemy.hp = Math.max(0, enemy.hp - heroAttack.damage);\n            combatLog.push(`Turno ${turn}: ${heroAttack.message}`);\n            if (heroAttack.damage > 0 && (atkElem === 'fire')) {\n              enemyBurn = Math.floor(heroAttack.damage * 0.10);\n            }\n            if (enemy.name === 'Arauto gneo' && heroAttack.damage > 0) {\n              enemyBurn = Math.max(enemyBurn, Math.floor(heroAttack.damage * 0.15));\n            }\n            \n            if (atkElem === 'dark' && heroAttack.damage > 0) {\n              const ls = Math.floor(heroAttack.damage * 0.05);\n              if (ls > 0) {\n                heroEntity.hp = Math.min(heroEntity.maxHp, heroEntity.hp + ls);\n                combatLog.push(` ${heroEntity.name} rouba ${ls} HP`);\n              }\n            }\n          }\n          if (activePet?.exclusiveSkill && petEnergy >= 6 && petCooldownLeft <= 0) {\n            let extraD = 0;\n            let extraH = 0;\n            let petStun = false;\n            const skill = activePet.exclusiveSkill;\n            let cost = 8;\n            if (skill === 'Instinto Feral') {\n              extraD = Math.floor(2 + Math.random() * 4);\n              cost = 8;\n            } else if (skill === 'Pulso Arcano') {\n              extraD = Math.floor(3 + (hero.attributes.inteligencia || 0) * 0.1);\n              cost = 10;\n            } else if (skill === 'Aura Sagrada') {\n              extraH = Math.floor(2 + Math.random() * 4);\n              cost = 9;\n            } else if (skill === 'Sussurro Sombrio') {\n              petStun = Math.random() < 0.1;\n              cost = 12;\n            }\n            if (petEnergy >= cost) {\n              petEnergy -= cost;\n              petEnergyUsed += cost;\n            } else {\n              extraD = 0;\n              extraH = 0;\n              petStun = false;\n            }\n            if (extraD > 0 && enemy.hp > 0) {\n              enemy.hp = Math.max(0, enemy.hp - extraD);\n              const icon = skill === 'Instinto Feral' ? '' : skill === 'Pulso Arcano' ? '' : skill === 'Aura Sagrada' ? '' : '';\n              combatLog.push(`${icon} Companheiro (${skill}) causa ${extraD} dano extra`);\n              petDamageTotal += extraD;\n            }\n            if (extraH > 0) {\n              let h = extraH;\n              if ((heroElement || 'physical') === 'water') h = Math.floor(h * 1.10);\n              if ((heroElement || 'physical') === 'light') h = Math.floor(h * 1.05);\n              heroEntity.hp = Math.min(heroEntity.maxHp, heroEntity.hp + h);\n              combatLog.push(` Companheiro restaura ${h} HP`);\n              petHealingTotal += h;\n            }\n            if (petStun) {\n              stunned = true;\n              combatLog.push(` Companheiro impede a ao do inimigo`);\n              petStunCount += 1;\n            }\n            const cooldownMap: Record<string, number> = { 'Instinto Feral': 1, 'Pulso Arcano': 2, 'Aura Sagrada': 2, 'Sussurro Sombrio': 3 };\n            petCooldownLeft = cooldownMap[skill] || 1;\n            const elemMap: Record<string, Element> = { 'Instinto Feral': 'earth', 'Pulso Arcano': 'light', 'Aura Sagrada': 'light', 'Sussurro Sombrio': 'dark' };\n            const ov = elemMap[skill];\n            if (ov) { heroElementOverride = ov; heroElementOverrideTurns = 1; }\n            if (ov) {\n              petElementSet.add(ov);\n              const icon = ov === 'earth' ? '' : ov === 'light' ? '' : ov === 'dark' ? '' : '';\n              combatLog.push(`${icon} Elemento do heri aplicado: ${ov}`);\n            }\n          }\n          \n          const enemyStunned = stunned;\n          if (enemy.hp > 0 && !enemyStunned) {\n          const enemyAttack = resolveAttack(enemy, heroEntity, { ramp, attackElement: enemyElement, defendElement: heroElement, atkAffinity: 0, defResistance: 0, isEnemyAttack: true });\n          heroEntity.hp = Math.max(0, heroEntity.hp - enemyAttack.damage);\n          combatLog.push(`${enemyAttack.message}`);\n          if (enemyAttack.damage > 0 && enemyElement === 'fire') {\n            heroBurn = Math.floor(enemyAttack.damage * 0.10);\n          }\n          if (enemyElement === 'dark' && enemyAttack.damage > 0) {\n            const ls = Math.floor(enemyAttack.damage * 0.05);\n            if (ls > 0) {\n              enemy.hp = Math.min(enemy.maxHp, enemy.hp + ls);\n              combatLog.push(` ${enemy.name} rouba ${ls} HP`);\n            }\n          }\n          }\n          if (heroElementOverrideTurns > 0) heroElementOverrideTurns = Math.max(0, heroElementOverrideTurns - 1);\n        } else {\n          // Inimigo ataca primeiro\n          const enemyAttack = resolveAttack(enemy, heroEntity, { ramp, attackElement: enemyElement, defendElement: heroElement, atkAffinity: 0, defResistance: 0, isEnemyAttack: true });\n          heroEntity.hp = Math.max(0, heroEntity.hp - enemyAttack.damage);\n          combatLog.push(`Turno ${turn}: ${enemyAttack.message}`);\n          if (enemyAttack.damage > 0 && enemyElement === 'fire') {\n            heroBurn = Math.floor(enemyAttack.damage * 0.10);\n          }\n          if (enemyElement === 'dark' && enemyAttack.damage > 0) {\n            const ls = Math.floor(enemyAttack.damage * 0.05);\n            if (ls > 0) {\n              enemy.hp = Math.min(enemy.maxHp, enemy.hp + ls);\n              combatLog.push(` ${enemy.name} rouba ${ls} HP`);\n            }\n          }\n          \n          if (heroEntity.hp > 0) {\n            const useSkill = (hero.skills && hero.skills.length > 0) && Math.random() < 0.35;\n            let stunned = false;\n            if (useSkill) {\n              const atkSkill = hero.skills.find(s => (s as any).type === 'attack') || hero.skills[0];\n              const skillRes = resolveSkillUse(hero, enemy, atkSkill as any);\n              enemy.hp = Math.max(0, enemy.hp - Math.floor(skillRes.damage * ramp));\n              combatLog.push(`${skillRes.message}`);\n              if (skillRes.healing && skillRes.healing > 0) {\n                heroEntity.hp = Math.min(heroEntity.maxHp, heroEntity.hp + skillRes.healing);\n              }\n              stunned = (skillRes.effects || []).some(e => e.includes('freeze_stun') || e.includes('stun_1'));\n            } else {\n              const atkElem = heroElementOverride && heroElementOverrideTurns > 0 ? heroElementOverride : heroElement;\n              const heroAttack = resolveAttack(heroEntity, enemy, { ramp, attackElement: atkElem, defendElement: enemyElement, atkAffinity: atkElem !== 'physical' && atkElem === heroElement ? 10 : 0, defResistance: 0 });\n              enemy.hp = Math.max(0, enemy.hp - heroAttack.damage);\n              combatLog.push(`${heroAttack.message}`);\n              if (heroAttack.damage > 0 && (atkElem === 'fire')) {\n                enemyBurn = Math.floor(heroAttack.damage * 0.10);\n              }\n              if (enemy.name === 'Arauto gneo' && heroAttack.damage > 0) {\n                enemyBurn = Math.max(enemyBurn, Math.floor(heroAttack.damage * 0.15));\n              }\n              if ((hero.alignment || '').includes('mal') && heroAttack.damage > 0) {\n                const leech = Math.floor(heroAttack.damage * 0.20);\n                if (leech > 0) {\n                  heroEntity.hp = Math.min(heroEntity.maxHp, heroEntity.hp + leech);\n                  combatLog.push(` ${heroEntity.name} drena ${leech} HP`);\n                }\n              }\n              if (atkElem === 'dark' && heroAttack.damage > 0) {\n                const ls = Math.floor(heroAttack.damage * 0.05);\n                if (ls > 0) {\n                  heroEntity.hp = Math.min(heroEntity.maxHp, heroEntity.hp + ls);\n                  combatLog.push(` ${heroEntity.name} rouba ${ls} HP`);\n                }\n              }\n            }\n            if (activePet?.exclusiveSkill && petEnergy >= 6 && petCooldownLeft <= 0) {\n              let extraD = 0;\n              let extraH = 0;\n              let petStun = false;\n              const skill = activePet.exclusiveSkill;\n              let cost = 8;\n              if (skill === 'Instinto Feral') {\n                extraD = Math.floor(2 + Math.random() * 4);\n                cost = 8;\n              } else if (skill === 'Pulso Arcano') {\n                extraD = Math.floor(3 + (hero.attributes.inteligencia || 0) * 0.1);\n                cost = 10;\n              } else if (skill === 'Aura Sagrada') {\n                extraH = Math.floor(2 + Math.random() * 4);\n                cost = 9;\n              } else if (skill === 'Sussurro Sombrio') {\n                petStun = Math.random() < 0.1;\n                cost = 12;\n              }\n              if (petEnergy >= cost) {\n                petEnergy -= cost;\n                petEnergyUsed += cost;\n              } else {\n                extraD = 0;\n                extraH = 0;\n                petStun = false;\n              }\n              if (extraD > 0 && enemy.hp > 0) {\n                enemy.hp = Math.max(0, enemy.hp - extraD);\n                const icon = skill === 'Instinto Feral' ? '' : skill === 'Pulso Arcano' ? '' : skill === 'Aura Sagrada' ? '' : '';\n                combatLog.push(`${icon} Companheiro (${skill}) causa ${extraD} dano extra`);\n                petDamageTotal += extraD;\n              }\n              if (extraH > 0) {\n                heroEntity.hp = Math.min(heroEntity.maxHp, heroEntity.hp + extraH);\n                combatLog.push(` Companheiro restaura ${extraH} HP`);\n                petHealingTotal += extraH;\n              }\n              if (petStun) {\n                stunned = true;\n                combatLog.push(` Companheiro impede a ao do inimigo`);\n                petStunCount += 1;\n              }\n              const cooldownMap: Record<string, number> = { 'Instinto Feral': 1, 'Pulso Arcano': 2, 'Aura Sagrada': 2, 'Sussurro Sombrio': 3 };\n              petCooldownLeft = cooldownMap[skill] || 1;\n              const elemMap: Record<string, Element> = { 'Instinto Feral': 'earth', 'Pulso Arcano': 'light', 'Aura Sagrada': 'light', 'Sussurro Sombrio': 'dark' };\n              const ov = elemMap[skill];\n              if (ov) { heroElementOverride = ov; heroElementOverrideTurns = 1; }\n              if (ov) {\n                petElementSet.add(ov);\n                const icon = ov === 'earth' ? '' : ov === 'light' ? '' : ov === 'dark' ? '' : '';\n                combatLog.push(`${icon} Elemento do heri aplicado: ${ov}`);\n              }\n            }\n          }\n\n        if (petCooldownLeft > 0) petCooldownLeft = Math.max(0, petCooldownLeft - 1);\n        if (heroElementOverrideTurns > 0) heroElementOverrideTurns = Math.max(0, heroElementOverrideTurns - 1);\n        }\n        \n        // Lgica de fuga do inimigo quando em desvantagem\n        const enemyLow = enemy.hp / enemy.maxHp <= 0.25;\n        const heroHealthy = heroEntity.hp / heroEntity.maxHp >= 0.5;\n        if (!enemyFled && turn >= 8 && enemyLow && heroHealthy) {\n          let fleeChance = 0.5 + (0.2 * (heroEntity.destreza > enemy.destreza ? 1 : 0));\n          if (Math.random() < fleeChance) {\n            enemyFled = true;\n            combatLog.push(`${enemy.name} tenta fugir e consegue! Combate encerrado.`);\n            break;\n          }\n        }\n        \n        turn++;\n      }\n      \n      // Verificar resultado\n      if (heroEntity.hp <= 0) {\n        combatLog.push(`${heroEntity.name} foi derrotado!`);\n        return {\n          victory: false,\n          damage: heroEntity.maxHp - heroEntity.hp,\n          xpGained: 0,\n          goldGained: 0,\n          itemsGained: [],\n          log: combatLog\n        };\n      }\n      \n      if (enemy.hp <= 0) {\n        combatLog.push(`${enemy.name} foi derrotado!`);\n        \n        // Calcular recompensas\n        const xp = calculateXpReward(enemy, hero.progression.level);\n        const gold = calculateGoldReward(enemy);\n        const loot = generateLoot(questEnemy.type);\n\n        // Drop universal: Ncleos de Mana\n        const level = questEnemy.level || 1;\n        const coreCandidates: { id: string; chance: number }[] =\n          level >= 20\n            ? [\n                { id: 'nucleo-mana-raro', chance: 0.20 },\n                { id: 'nucleo-ancestral', chance: 0.10 }\n              ]\n            : level >= 10\n            ? [\n                { id: 'nucleo-mana', chance: 0.35 },\n                { id: 'nucleo-mana-raro', chance: 0.10 }\n              ]\n            : [\n                { id: 'nucleo-mana-menor', chance: 0.40 },\n                { id: 'nucleo-mana', chance: 0.15 }\n              ];\n        coreCandidates.forEach(({ id, chance }) => {\n          if (Math.random() < chance) {\n            const coreItem = SHOP_ITEMS.find(i => i.id === id);\n            if (coreItem) loot.push(coreItem);\n          }\n        });\n\n        // Bnus adaptativo de loot por andar/party/acessrio\n        const floor = opts.floor || 1;\n        const floorBias = (dungeonConfig.rarityIncreasePerFloor || 0) * floor; // % acumulado\n        const partyBonus = opts.partyBonusPercent || 0;\n        const accList = [hero.inventory?.equippedRingLeft, hero.inventory?.equippedRingRight, hero.inventory?.equippedNecklace, hero.inventory?.equippedEarringLeft, hero.inventory?.equippedEarringRight].filter(Boolean) as string[];\n        const ringBonus = accList.some(id => /anel|ring/i.test(String(id))) ? 2 : 0;\n        let bonusChance = Math.min(0.05 + (floorBias + partyBonus + ringBonus) / 100, 0.35);\n\n        if (Math.random() < bonusChance) {\n          const eligibleTypes = new Set(['weapon', 'armor', 'accessory']);\n          const rarityOrder: Array<'comum' | 'incomum' | 'raro' | 'epico' | 'lendario'> = ['comum', 'incomum', 'raro', 'epico', 'lendario'];\n          // Converter vis em um ndice mnimo aproximado\n          const minIndex = floorBias >= 35 ? 3 : floorBias >= 20 ? 2 : floorBias >= 10 ? 1 : 0;\n          const pool = SHOP_ITEMS.filter(i => eligibleTypes.has(i.type) && rarityOrder.indexOf(i.rarity as any) >= minIndex);\n          if (pool.length > 0) {\n            const bonusItem = pool[Math.floor(Math.random() * pool.length)];\n            loot.push(bonusItem);\n          }\n        }\n        \n        totalXp += xp;\n        totalGold += gold;\n        allLoot.push(...loot);\n        \n        combatLog.push(`Recompensas: +${xp} XP, +${gold} ouro`);\n        if (loot.length > 0) {\n          combatLog.push(`Itens encontrados: ${loot.map(item => item.name).join(', ')}`);\n        }\n      } else {\n        // inimigo fugiu ou combate encerrou por tempo\n        const baseXp = calculateXpReward(enemy, hero.progression.level);\n        const reducedXp = Math.floor(baseXp * 0.4);\n        totalXp += reducedXp;\n        combatLog.push(`Combate inconclusivo - ${enemy.name} foge! Recompensa reduzida: +${reducedXp} XP`);\n      }\n    }\n  }\n  \n  combatLog.push(`\\n=== VITRIA! ===`);\n  combatLog.push(`Total: +${totalXp} XP, +${totalGold} ouro`);\n  if (activePet && (petDamageTotal > 0 || petHealingTotal > 0 || petStunCount > 0)) {\n    combatLog.push(` Contribuio do Companheiro: +${petDamageTotal} dano, +${petHealingTotal} cura, ${petStunCount} controle(s)`);\n  }\n  \n  return {\n    victory: true,\n    damage: heroEntity.maxHp - heroEntity.hp,\n    xpGained: totalXp,\n    goldGained: totalGold,\n    itemsGained: allLoot,\n    log: combatLog,\n    petEnergyUsed,\n    petDamage: petDamageTotal,\n    petHealing: petHealingTotal,\n    petStuns: petStunCount,\n    petElementHighlights: Array.from(petElementSet)\n  };\n}\n\n// === FUNO DE AUTO-RESOLVE (PARA MISSES RPIDAS) ===\n\nexport function autoResolveCombat(hero: Hero, enemies: QuestEnemy[], isGuildQuest: boolean = false): CombatResult {\n  const heroEntity = heroToCombatEntity(hero);\n  let totalPower = heroEntity.forca + heroEntity.destreza + heroEntity.constituicao;\n  const activePet = (hero.pets || []).find(p => p.id === (hero as any).activePetId);\n  let petEnergyUsed = 0;\n  \n  let enemyPower = 0;\n  enemies.forEach(questEnemy => {\n    const enemy = createEnemyFromTemplate(questEnemy.type, questEnemy.level || 1);\n    enemyPower += (enemy.forca + enemy.destreza + enemy.constituicao) * questEnemy.count;\n  });\n  \n  // Bnus especial para misses de guilda\n  let guildBonus = 0;\n  if (isGuildQuest) {\n    // Bnus muito maior para tornar misses de guilda viveis\n    guildBonus = hero.progression.level * 30 + 40; // +40 base + 30 por nvel\n    console.log(` Bnus de guilda aplicado: +${guildBonus} poder`);\n  }\n  \n  // Calcular chance de vitria (50% base + diferena de poder + bnus de guilda)\n  const powerDiff = (totalPower + guildBonus) - enemyPower;\n  const baseWinChance = isGuildQuest ? 75 : 50; // Chance base muito maior para misses de guilda\n  let winChance = Math.max(25, Math.min(95, baseWinChance + powerDiff * 2));\n  if (activePet?.exclusiveSkill && (activePet.energy || 0) >= 12) {\n    winChance = Math.min(95, winChance + 7);\n    petEnergyUsed += 12;\n  }\n  \n  console.log(` Poder do heri: ${totalPower} + ${guildBonus} = ${totalPower + guildBonus}`);\n  console.log(` Poder dos inimigos: ${enemyPower}`);\n  console.log(` Chance de vitria: ${winChance.toFixed(1)}%`);\n  \n  const victory = Math.random() * 100 < winChance;\n  \n  // Gerar narrativa imersiva do combate\n  const generateCombatNarrative = (victory: boolean, enemies: QuestEnemy[], hero: Hero): string[] => {\n    const narrative: string[] = [];\n    const enemyNames = enemies.map(e => `${e.count} ${e.type}${e.count > 1 ? 's' : ''}`).join(', ');\n    \n    narrative.push(` ${hero.name} enfrenta ${enemyNames} em combate!`);\n    \n    if (isGuildQuest) {\n      narrative.push(` O poder da guilda fortalece ${hero.name} na batalha!`);\n    }\n    \n    if (victory) {\n      narrative.push(` ${hero.name} luta com bravura e determinao!`);\n      narrative.push(` Seus golpes encontram o alvo com preciso mortal!`);\n      \n      enemies.forEach(questEnemy => {\n        if (questEnemy.count === 1) {\n          narrative.push(` O ${questEnemy.type}  derrotado aps uma batalha intensa!`);\n        } else {\n          narrative.push(` Os ${questEnemy.count} ${questEnemy.type}s so derrotados um por um!`);\n        }\n      });\n      \n      narrative.push(` Vitria! ${hero.name} emerge triunfante do combate!`);\n    } else {\n      narrative.push(` ${hero.name} luta corajosamente, mas os inimigos so muito poderosos!`);\n      narrative.push(` Aps uma batalha feroz, ${hero.name}  forado a recuar!`);\n      narrative.push(` Ferido mas vivo, ${hero.name} aprende com a derrota...`);\n    }\n    \n    return narrative;\n  };\n  \n  const combatLog = generateCombatNarrative(victory, enemies, hero);\n  \n  if (victory) {\n    let totalXp = 0;\n    let totalGold = 0;\n    let allLoot: Item[] = [];\n    \n    enemies.forEach(questEnemy => {\n      for (let i = 0; i < questEnemy.count; i++) {\n        const enemy = createEnemyFromTemplate(questEnemy.type, questEnemy.level || 1);\n        totalXp += calculateXpReward(enemy, hero.progression.level);\n        totalGold += calculateGoldReward(enemy);\n        const loot = generateLoot(questEnemy.type);\n\n        // Drop universal de Ncleos de Mana tambm no auto-resolve\n        const level = questEnemy.level || 1;\n        const coreCandidates: { id: string; chance: number }[] =\n          level >= 20\n            ? [\n                { id: 'nucleo-mana-raro', chance: 0.20 },\n                { id: 'nucleo-ancestral', chance: 0.10 }\n              ]\n            : level >= 10\n            ? [\n                { id: 'nucleo-mana', chance: 0.35 },\n                { id: 'nucleo-mana-raro', chance: 0.10 }\n              ]\n            : [\n                { id: 'nucleo-mana-menor', chance: 0.40 },\n                { id: 'nucleo-mana', chance: 0.15 }\n              ];\n        coreCandidates.forEach(({ id, chance }) => {\n          if (Math.random() < chance) {\n            const coreItem = SHOP_ITEMS.find(i => i.id === id);\n            if (coreItem) loot.push(coreItem);\n          }\n        });\n        // Aplicar tambm bnus adaptativo em auto-resolve com vis reduzido\n        const eligibleTypes = new Set(['weapon', 'armor', 'accessory']);\n        const rarityOrder: Array<'comum' | 'incomum' | 'raro' | 'epico' | 'lendario'> = ['comum', 'incomum', 'raro', 'epico', 'lendario'];\n        const accList2 = [hero.inventory?.equippedRingLeft, hero.inventory?.equippedRingRight, hero.inventory?.equippedNecklace, hero.inventory?.equippedEarringLeft, hero.inventory?.equippedEarringRight].filter(Boolean) as string[];\n        const ringBonus = accList2.some(id => /anel|ring/i.test(String(id))) ? 2 : 0;\n        const baseBias = (dungeonConfig.rarityIncreasePerFloor || 0);\n        const minIndex = baseBias >= 20 ? 2 : baseBias >= 10 ? 1 : 0;\n        const bonusChance = Math.min(0.03 + (baseBias + ringBonus) / 100, 0.25);\n        if (Math.random() < bonusChance) {\n          const pool = SHOP_ITEMS.filter(i => eligibleTypes.has(i.type) && rarityOrder.indexOf(i.rarity as any) >= minIndex);\n          if (pool.length > 0) {\n            loot.push(pool[Math.floor(Math.random() * pool.length)]);\n          }\n        }\n        allLoot.push(...loot);\n      }\n    });\n    \n    combatLog.push(` Recompensas: ${totalXp} XP, ${totalGold} moedas de ouro`);\n    if (allLoot.length > 0) {\n      combatLog.push(` Itens encontrados: ${allLoot.map(item => item.name).join(', ')}`);\n    }\n    \n    return {\n      victory: true,\n      damage: Math.floor(Math.random() * 10), // Dano mnimo em auto-resolve\n      xpGained: totalXp,\n      goldGained: totalGold,\n      itemsGained: allLoot,\n      log: combatLog,\n      petEnergyUsed,\n      petDamage: 0,\n      petHealing: 0,\n      petStuns: 0\n    };\n  } else {\n    const damage = Math.floor(heroEntity.maxHp * 0.3);\n    combatLog.push(` ${hero.name} sofre ${damage} pontos de dano na derrota`);\n    \n    return {\n      victory: false,\n      damage: damage,\n      xpGained: 0,\n      goldGained: 0,\n      itemsGained: [],\n      log: combatLog,\n      petEnergyUsed,\n      petDamage: 0,\n      petHealing: 0,\n      petStuns: 0\n    };\n  }\n}\n\nexport type MonsterArchetype = 'humano' | 'bestial' | 'elemental' | 'esqueleto' | 'corrupto';\nexport type MonsterModifier = 'feroz' | 'agil' | 'versatil' | 'morto-vivo' | 'blindado';\n\nexport interface GeneratedMonster {\n  type: MonsterArchetype;\n  tier: number;\n  modifiers: MonsterModifier[];\n  level: number;\n  drops: string[]; // itemIds\n  stats: {\n    hp: number;\n    damage: number;\n    speed: number;\n    resistances?: Partial<Record<Element, number>>;\n  };\n}\n\nexport function generateMonster(seed: number, difficulty: 'facil' | 'medio' | 'dificil', luck = 0): GeneratedMonster {\n  const tier = difficulty === 'facil' ? 1 : difficulty === 'medio' ? 2 : 3;\n  const typePool: MonsterArchetype[] = ['humano', 'bestial', 'elemental', 'esqueleto', 'corrupto'];\n  const type = typePool[seed % typePool.length];\n  const modPool: MonsterModifier[] = ['feroz', 'agil', 'versatil', 'morto-vivo', 'blindado'];\n  const modifiers = [modPool[(seed + 3) % modPool.length]];\n  const level = tier + Math.floor(luck / 10);\n  const stats = { hp: 50 * tier + level * 5, damage: 10 * tier + level, speed: 5 + tier };\n  const drops = ['material-bruto', 'pedra-encantamento'];\n  return { type, tier, modifiers, level, drops, stats };\n}\n","export type JewelType = 'vermelha' | 'azul' | 'verde' | 'amarela' | 'roxa';\n\nexport interface JewelBonus {\n  forca?: number;\n  inteligencia?: number;\n  destreza?: number;\n  constituicao?: number;\n  armorClass?: number;\n}\n\nexport class Jewel {\n  id: string;\n  tipo: JewelType;\n  cor: string;\n  nivel: number;\n  baseBonus: JewelBonus;\n\n  constructor(id: string, tipo: JewelType, nivel: number) {\n    this.id = id;\n    this.tipo = tipo;\n    this.nivel = Math.max(1, Math.min(10, nivel));\n    this.cor = Jewel.getColorForType(tipo);\n    this.baseBonus = Jewel.getBaseBonusForType(tipo);\n  }\n\n  static getColorForType(tipo: JewelType): string {\n    if (tipo === 'vermelha') return '#EF4444';\n    if (tipo === 'azul') return '#3B82F6';\n    if (tipo === 'verde') return '#10B981';\n    if (tipo === 'amarela') return '#F59E0B';\n    return '#8B5CF6';\n  }\n\n  static getBaseBonusForType(tipo: JewelType): JewelBonus {\n    if (tipo === 'vermelha') return { forca: 2 };\n    if (tipo === 'azul') return { inteligencia: 2 };\n    if (tipo === 'verde') return { destreza: 2 };\n    if (tipo === 'amarela') return { armorClass: 1 };\n    return { constituicao: 2 };\n  }\n\n  getBonus(): JewelBonus {\n    const mult = 1 + (this.nivel - 1) * 0.2;\n    const out: JewelBonus = {};\n    if (this.baseBonus.forca) out.forca = Math.round(this.baseBonus.forca * mult);\n    if (this.baseBonus.inteligencia) out.inteligencia = Math.round(this.baseBonus.inteligencia * mult);\n    if (this.baseBonus.destreza) out.destreza = Math.round(this.baseBonus.destreza * mult);\n    if (this.baseBonus.constituicao) out.constituicao = Math.round(this.baseBonus.constituicao * mult);\n    if (this.baseBonus.armorClass) out.armorClass = Math.round(this.baseBonus.armorClass * mult);\n    return out;\n  }\n\n  static canFuse(a: Jewel, b: Jewel): boolean {\n    return a.tipo === b.tipo && a.nivel === b.nivel && a.nivel < 10;\n  }\n\n  static fuse(a: Jewel, b: Jewel): Jewel | null {\n    if (!Jewel.canFuse(a, b)) return null;\n    return new Jewel(crypto.randomUUID(), a.tipo, a.nivel + 1);\n  }\n\n  static minHeroLevelToEquip(nivel: number): number {\n    return Math.max(1, Math.min(99, nivel * 3));\n  }\n}","import { Hero } from '../types/hero'\n\nexport interface ForgeRecipe {\n  id: string\n  name: string\n  inputs: Array<{ id: string; qty: number }>\n  output: { id: string; qty: number }\n  rankRequired?: 'F'|'E'|'D'|'C'|'B'|'A'|'S'\n}\n\nexport const RECIPES: ForgeRecipe[] = [\n  {\n    id: 'peitoral-cacador',\n    name: 'Peitoral do Caador',\n    inputs: [\n      { id: 'pele-lobo-sombrio', qty: 3 },\n      { id: 'colmilho-vampirico', qty: 1 }\n    ],\n    output: { id: 'armadura-cacador', qty: 1 },\n    rankRequired: 'D'\n  },\n  {\n    id: 'lamina-ritual',\n    name: 'Lmina Ritual do Alpha',\n    inputs: [\n      { id: 'osso-antigo', qty: 2 },\n      { id: 'cristal-runico', qty: 1 }\n    ],\n    output: { id: 'lamina-alpha', qty: 1 },\n    rankRequired: 'B'\n  },\n  {\n    id: 'tunica-umbral',\n    name: 'Tnica Umbral',\n    inputs: [\n      { id: 'essencia-lunar', qty: 2 },\n      { id: 'erva-sangue', qty: 3 }\n    ],\n    output: { id: 'manto-arcano', qty: 1 },\n    rankRequired: 'C'\n  }\n]\n\nexport function getAvailableRecipes(hero: Hero): ForgeRecipe[] {\n  const rankOrder = ['F','E','D','C','B','A','S'] as const\n  const heroRank = (hero.rankData?.currentRank || 'F') as typeof rankOrder[number]\n  const heroRankIdx = rankOrder.indexOf(heroRank)\n  return RECIPES.filter(r => {\n    const reqIdx = rankOrder.indexOf((r.rankRequired || 'F') as any)\n    if (heroRankIdx < reqIdx) return false\n    return r.inputs.every(inp => (hero.inventory.items[inp.id] || 0) >= inp.qty)\n  })\n}\n\n","import { Activity, ActivityData, ActivityFeed, ShareableActivity, ActivityFilter, ActivityComment } from '../types/activity';\n\nexport class ActivityManager {\n  private static instance: ActivityManager;\n  private activities: Activity[] = [];\n  private maxActivities = 1000; // Limite para performance\n\n  private constructor() {\n    this.loadActivities();\n  }\n\n  static getInstance(): ActivityManager {\n    if (!ActivityManager.instance) {\n      ActivityManager.instance = new ActivityManager();\n    }\n    return ActivityManager.instance;\n  }\n\n  // Criar uma nova atividade\n  createActivity(\n    type: Activity['type'],\n    data: ActivityData,\n    isPublic: boolean = true\n  ): Activity {\n    const activity: Activity = {\n      id: `activity-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      type,\n      timestamp: new Date(),\n      data,\n      message: this.generateActivityMessage(type, data),\n      icon: this.getActivityIcon(type),\n      color: this.getActivityColor(type),\n      isPublic,\n      likes: 0,\n      comments: [],\n      shares: 0\n    };\n\n    this.activities.unshift(activity); // Adicionar no incio\n\n    // Manter apenas as atividades mais recentes\n    if (this.activities.length > this.maxActivities) {\n      this.activities = this.activities.slice(0, this.maxActivities);\n    }\n\n    this.saveActivities();\n    return activity;\n  }\n\n  // Gerar mensagem da atividade\n  private generateActivityMessage(type: Activity['type'], data: ActivityData): string {\n    const { heroName, heroClass } = data;\n\n    switch (type) {\n      case 'quest-completed':\n        return `${heroName} (${heroClass}) completou a misso \"${data.questName}\"${data.questDifficulty ? ` (${data.questDifficulty})` : ''}!`;\n      \n      case 'epic-quest-completed':\n        return ` ${heroName} (${heroClass}) conquistou a misso pica \"${data.questName}\"! Uma verdadeira lenda!`;\n      \n      case 'level-up':\n        return ` ${heroName} (${heroClass}) subiu para o nvel ${data.heroLevel}!`;\n      \n      case 'achievement-unlocked':\n        return ` ${heroName} (${heroClass}) desbloqueou a conquista \"${data.achievementUnlocked}\"!`;\n      \n      case 'title-earned':\n        return ` ${heroName} (${heroClass}) conquistou o ttulo \"${data.titleEarned}\"!`;\n      \n      case 'event-completed':\n        return ` ${heroName} (${heroClass}) completou o evento \"${data.eventCompleted}\"!`;\n      \n      case 'daily-goal-completed':\n        return ` ${heroName} (${heroClass}) completou a meta diria \"${data.dailyGoalCompleted}\"!`;\n      \n      case 'combat-victory':\n        const enemiesText = data.enemiesDefeated?.length === 1 \n          ? data.enemiesDefeated[0] \n          : `${data.enemiesDefeated?.length} inimigos`;\n        return ` ${heroName} (${heroClass}) derrotou ${enemiesText} em combate!`;\n      \n      case 'rank-promotion':\n        return ` ${heroName} (${heroClass}) foi promovido para Rank ${data.newRank}! Uma conquista pica!`;\n      \n      case 'tavern-rest': {\n        const restLabel = data.restType ? ` (${data.restType})` : '';\n        const recovered = typeof data.fatigueRecovered === 'number' ? data.fatigueRecovered : 0;\n        const spent = typeof data.goldSpent === 'number' ? data.goldSpent : 0;\n        return ` ${heroName} (${heroClass}) descansou na taverna${restLabel}, recuperou ${recovered} de Fadiga por ${spent} ouro.`;\n      }\n      \n      case 'item-used': {\n        const parts: string[] = [];\n        if (typeof data.hpRecovered === 'number' && data.hpRecovered > 0) {\n          parts.push(`+${data.hpRecovered} HP`);\n        }\n        if (typeof data.mpRecovered === 'number' && data.mpRecovered > 0) {\n          parts.push(`+${data.mpRecovered} MP`);\n        }\n        if (typeof data.xpGained === 'number' && data.xpGained > 0) {\n          parts.push(`+${data.xpGained} XP`);\n        }\n        if (typeof data.fatigueRecovered === 'number' && data.fatigueRecovered > 0) {\n          parts.push(`-${data.fatigueRecovered} Fadiga`);\n        }\n        const effectText = parts.length ? ` (${parts.join(', ')})` : '';\n        const itemLabel = data.itemName ? ` ${data.itemName}` : '';\n        return ` ${heroName} (${heroClass}) usou${itemLabel}${effectText}.`;\n      }\n\n      case 'pet-hatched': {\n        const rarity = data.eggRarity ? ` (${String(data.eggRarity)})` : '';\n        const petLabel = data.petName ? ` ${data.petName}` : 'um mascote';\n        return ` ${heroName} (${heroClass}) chocou${rarity} e obteve${petLabel}!`;\n      }\n\n      case 'guild-event-activated': {\n        const xp = typeof data.xpBuffPercent === 'number' ? `+${data.xpBuffPercent}% XP` : '';\n        const tr = typeof data.trainingDiscountPercent === 'number' ? `-${data.trainingDiscountPercent}% treino` : '';\n        const sep = xp && tr ? '  ' : '';\n        const guildLabel = data.guildName ? ` na guilda ${data.guildName}` : '';\n        return ` ${heroName} (${heroClass}) ativou \"${data.eventName || 'Evento da Guilda'}\"${guildLabel}: ${xp}${sep}${tr}.`;\n      }\n\n      case 'tavern-dice': {\n        const roll = typeof (data as any).roll === 'number' ? (data as any).roll : 0;\n        const critical = !!(data as any).critical;\n        const bet = (data as any).betAmount ? ` (aposta: ${(data as any).betAmount} )` : '';\n        const opponent = (data as any).opponentName ? ` contra ${(data as any).opponentName}` : '';\n        return `${critical ? '' : ''} ${heroName} (${heroClass}) rolou ${roll}${opponent}${bet}${critical ? '  CRTICO!' : ''}`;\n      }\n\n      default:\n        return `${heroName} (${heroClass}) realizou uma ao heroica!`;\n    }\n  }\n\n  // Obter cone da atividade\n  private getActivityIcon(type: Activity['type']): string {\n    const icons = {\n      'quest-completed': '',\n      'epic-quest-completed': '',\n      'level-up': '',\n      'achievement-unlocked': '',\n      'title-earned': '',\n      'event-completed': '',\n      'daily-goal-completed': '',\n      'combat-victory': '',\n      'rank-promotion': '',\n      'tavern-rest': '',\n      'item-used': '',\n      'guild-event-activated': '',\n      'pet-hatched': '',\n      'tavern-dice': ''\n    };\n    return icons[type] || '';\n  }\n\n  // Obter cor da atividade\n  private getActivityColor(type: Activity['type']): string {\n    const colors = {\n      'quest-completed': 'from-blue-400 to-blue-600',\n      'epic-quest-completed': 'from-purple-500 to-pink-600',\n      'level-up': 'from-green-400 to-green-600',\n      'achievement-unlocked': 'from-yellow-400 to-orange-500',\n      'title-earned': 'from-purple-400 to-purple-600',\n      'event-completed': 'from-pink-400 to-pink-600',\n      'daily-goal-completed': 'from-teal-400 to-teal-600',\n      'combat-victory': 'from-red-400 to-red-600',\n      'rank-promotion': 'from-amber-400 to-yellow-600',\n      'tavern-rest': 'from-amber-400 to-amber-600',\n      'item-used': 'from-indigo-400 to-indigo-600',\n      'guild-event-activated': 'from-indigo-500 to-indigo-700',\n      'pet-hatched': 'from-amber-400 to-emerald-600',\n      'tavern-dice': 'from-amber-400 to-purple-600'\n    };\n    return colors[type] || 'from-gray-400 to-gray-600';\n  }\n\n  // Obter feed de atividades\n  getActivityFeed(filter?: Partial<ActivityFilter>): ActivityFeed {\n    let filteredActivities = [...this.activities];\n\n    if (filter) {\n      if (filter.types && filter.types.length > 0) {\n        filteredActivities = filteredActivities.filter(a => filter.types!.includes(a.type));\n      }\n\n      if (filter.heroIds && filter.heroIds.length > 0) {\n        filteredActivities = filteredActivities.filter(a => filter.heroIds!.includes(a.data.heroId));\n      }\n\n      if (filter.showOnlyPublic) {\n        filteredActivities = filteredActivities.filter(a => a.isPublic);\n      }\n\n      if (filter.dateRange) {\n        filteredActivities = filteredActivities.filter(a => \n          a.timestamp >= filter.dateRange!.start && a.timestamp <= filter.dateRange!.end\n        );\n      }\n    }\n\n    return {\n      activities: filteredActivities,\n      lastUpdated: new Date(),\n      totalActivities: filteredActivities.length\n    };\n  }\n\n  // Obter atividades de um heri especfico\n  getHeroActivities(heroId: string, limit: number = 50): Activity[] {\n    return this.activities\n      .filter(a => a.data.heroId === heroId)\n      .slice(0, limit);\n  }\n\n  // Obter atividades recentes\n  getRecentActivities(limit: number = 20): Activity[] {\n    return this.activities.slice(0, limit);\n  }\n\n  // Curtir uma atividade\n  likeActivity(activityId: string): boolean {\n    const activity = this.activities.find(a => a.id === activityId);\n    if (activity) {\n      activity.likes++;\n      this.saveActivities();\n      return true;\n    }\n    return false;\n  }\n\n  // Adicionar comentrio\n  addComment(activityId: string, authorId: string, authorName: string, content: string): boolean {\n    const activity = this.activities.find(a => a.id === activityId);\n    if (activity) {\n      const comment: ActivityComment = {\n        id: `comment-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        authorId,\n        authorName,\n        content,\n        timestamp: new Date()\n      };\n      activity.comments.push(comment);\n      this.saveActivities();\n      return true;\n    }\n    return false;\n  }\n\n  // Compartilhar atividade\n  shareActivity(activityId: string): ShareableActivity | null {\n    const activity = this.activities.find(a => a.id === activityId);\n    if (!activity) return null;\n\n    activity.shares++;\n    this.saveActivities();\n\n    const shareUrl = `${window.location.origin}/activity/${activityId}`;\n    const shareText = `Confira esta conquista pica no HeroForge: ${activity.message}`;\n\n    return {\n      activity,\n      shareUrl,\n      shareText\n    };\n  }\n\n  // Gerar estatsticas de atividades\n  getActivityStats(heroId?: string): {\n    totalActivities: number;\n    activitiesByType: Record<string, number>;\n    activitiesThisWeek: number;\n    activitiesThisMonth: number;\n    mostActiveDay: string;\n  } {\n    const activities = heroId \n      ? this.activities.filter(a => a.data.heroId === heroId)\n      : this.activities;\n\n    const now = new Date();\n    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n    const activitiesByType: Record<string, number> = {};\n    const activitiesByDay: Record<string, number> = {};\n\n    activities.forEach(activity => {\n      // Por tipo\n      activitiesByType[activity.type] = (activitiesByType[activity.type] || 0) + 1;\n      \n      // Por dia\n      const day = activity.timestamp.toDateString();\n      activitiesByDay[day] = (activitiesByDay[day] || 0) + 1;\n    });\n\n    const mostActiveDay = Object.entries(activitiesByDay)\n      .sort(([,a], [,b]) => b - a)[0]?.[0] || 'Nenhum';\n\n    return {\n      totalActivities: activities.length,\n      activitiesByType,\n      activitiesThisWeek: activities.filter(a => a.timestamp >= weekAgo).length,\n      activitiesThisMonth: activities.filter(a => a.timestamp >= monthAgo).length,\n      mostActiveDay\n    };\n  }\n\n  // Limpar atividades antigas\n  cleanupOldActivities(daysToKeep: number = 90): number {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);\n\n    const initialCount = this.activities.length;\n    this.activities = this.activities.filter(a => a.timestamp >= cutoffDate);\n    \n    const removedCount = initialCount - this.activities.length;\n    if (removedCount > 0) {\n      this.saveActivities();\n    }\n\n    return removedCount;\n  }\n\n  // Salvar atividades no localStorage\n  private saveActivities(): void {\n    try {\n      const data = {\n        activities: this.activities,\n        lastSaved: new Date().toISOString()\n      };\n      localStorage.setItem('heroforge-activities', JSON.stringify(data));\n    } catch (error) {\n      console.error('Erro ao salvar atividades:', error);\n    }\n  }\n\n  // Carregar atividades do localStorage\n  private loadActivities(): void {\n    try {\n      const saved = localStorage.getItem('heroforge-activities');\n      if (saved) {\n        const data = JSON.parse(saved);\n        this.activities = (data.activities || []).map((a: any) => ({\n          ...a,\n          timestamp: new Date(a.timestamp),\n          comments: (a.comments || []).map((c: any) => ({\n            ...c,\n            timestamp: new Date(c.timestamp)\n          }))\n        }));\n      }\n    } catch (error) {\n      console.error('Erro ao carregar atividades:', error);\n      this.activities = [];\n    }\n  }\n\n  // Exportar atividades para compartilhamento\n  exportActivities(heroId?: string): string {\n    const activities = heroId \n      ? this.getHeroActivities(heroId)\n      : this.getRecentActivities();\n\n    const exportData = {\n      heroForgeActivities: activities,\n      exportedAt: new Date().toISOString(),\n      totalActivities: activities.length\n    };\n\n    return JSON.stringify(exportData, null, 2);\n  }\n}\n\n// Funes de convenincia para registrar atividades\nexport const activityManager = ActivityManager.getInstance();\n\nexport const logActivity = {\n  questCompleted: (data: ActivityData) => \n    activityManager.createActivity('quest-completed', data),\n  \n  epicQuestCompleted: (data: ActivityData) => \n    activityManager.createActivity('epic-quest-completed', data),\n  \n  levelUp: (data: ActivityData) => \n    activityManager.createActivity('level-up', data),\n  \n  achievementUnlocked: (data: ActivityData) => \n    activityManager.createActivity('achievement-unlocked', data),\n  \n  titleEarned: (data: ActivityData) => \n    activityManager.createActivity('title-earned', data),\n  \n  eventCompleted: (data: ActivityData) => \n    activityManager.createActivity('event-completed', data),\n  \n  dailyGoalCompleted: (data: ActivityData) => \n    activityManager.createActivity('daily-goal-completed', data),\n  \n  combatVictory: (data: ActivityData) => \n    activityManager.createActivity('combat-victory', data),\n  \n  rankPromotion: (data: ActivityData) => \n    activityManager.createActivity('rank-promotion', data),\n\n  tavernRest: (data: ActivityData) =>\n    activityManager.createActivity('tavern-rest', data),\n\n  itemUsed: (data: ActivityData) =>\n    activityManager.createActivity('item-used', data),\n\n  guildEventActivated: (data: ActivityData) =>\n    activityManager.createActivity('guild-event-activated', data)\n  ,\n  petHatched: (data: ActivityData) =>\n    activityManager.createActivity('pet-hatched', data)\n  ,\n  tavernDice: (data: ActivityData & { roll: number; critical?: boolean; betAmount?: number; opponentName?: string }) =>\n    activityManager.createActivity('tavern-dice', data)\n};\n","// Sistema de Ranks - Lgica e Progresso - HeroForge v2.2\n\nimport { \n  RankLevel, \n  RankProgress, \n  RankHistory, \n  RankCelebration, \n  HeroRankData,\n  RankReward,\n  RankComparison,\n  RANK_CONFIG,\n  RANK_THRESHOLDS,\n  RANK_ORDER,\n  RANK_REWARDS\n} from '../types/ranks';\nimport { Hero } from '../types/hero';\nimport { logActivity } from './activitySystem';\n\nexport class RankSystem {\n  private static instance: RankSystem;\n  private celebrations: RankCelebration[] = [];\n\n  static getInstance(): RankSystem {\n    if (!RankSystem.instance) {\n      RankSystem.instance = new RankSystem();\n    }\n    return RankSystem.instance;\n  }\n\n  /**\n   * Calcula o rank atual baseado no XP, misses e ttulos do heri\n   */\n  calculateRank(hero: Hero): RankLevel {\n    let currentRank: RankLevel = 'F';\n    \n    for (const rank of RANK_ORDER) {\n      const threshold = RANK_THRESHOLDS[rank];\n      const meetsXP = hero.progression.xp >= threshold.xp;\n      const meetsMissions = (hero.stats.questsCompleted || 0) >= threshold.missions;\n      const meetsTitles = !threshold.titles || (hero.titles?.length || 0) >= threshold.titles;\n      const meetsSpecial = this.checkSpecialRequirements(hero, threshold.specialRequirements);\n      \n      if (meetsXP && meetsMissions && meetsTitles && meetsSpecial) {\n        currentRank = rank;\n      } else {\n        break;\n      }\n    }\n    \n    return currentRank;\n  }\n\n  /**\n   * Verifica requisitos especiais para ranks avanados\n   */\n  private checkSpecialRequirements(hero: Hero, requirements?: string[]): boolean {\n    if (!requirements) return true;\n    \n    for (const req of requirements) {\n      switch (req) {\n        case 'legendary_quest':\n          if (!Array.isArray(hero.achievements) || !hero.achievements.some(a => (a?.rarity === 'lendario') || String(a?.name || '').toLowerCase().includes('lendrio') || String(a?.name || '').toLowerCase().includes('lendario') || String(a?.description || '').toLowerCase().includes('lendrio') || String(a?.description || '').toLowerCase().includes('lendario'))) {\n            return false;\n          }\n          break;\n        case 'epic_achievement':\n          if (!Array.isArray(hero.achievements) || !hero.achievements.some(a => (a?.rarity === 'epico') || String(a?.name || '').toLowerCase().includes('pico') || String(a?.name || '').toLowerCase().includes('epico') || String(a?.description || '').toLowerCase().includes('pico') || String(a?.description || '').toLowerCase().includes('epico'))) {\n            return false;\n          }\n          break;\n      }\n    }\n    \n    return true;\n  }\n\n  /**\n   * Calcula o progresso para o prximo rank\n   */\n  calculateProgress(hero: Hero): RankProgress {\n    const currentRank = this.calculateRank(hero);\n    const currentIndex = RANK_ORDER.indexOf(currentRank);\n    const nextRank = currentIndex < RANK_ORDER.length - 1 ? RANK_ORDER[currentIndex + 1] : null;\n    \n    if (!nextRank) {\n      return {\n        currentRank,\n        nextRank: null,\n        currentXP: hero.progression.xp,\n        requiredXP: hero.progression.xp,\n        currentMissions: hero.stats.questsCompleted || 0,\n        requiredMissions: hero.stats.questsCompleted || 0,\n        progressPercentage: 100,\n        canPromote: false\n      };\n    }\n    \n    const nextThreshold = RANK_THRESHOLDS[nextRank];\n    const currentThreshold = RANK_THRESHOLDS[currentRank];\n    \n    const xpProgress = Math.min(100, ((hero.progression.xp - currentThreshold.xp) / (nextThreshold.xp - currentThreshold.xp)) * 100);\n    const missionProgress = Math.min(100, ((hero.stats.questsCompleted || 0) / nextThreshold.missions) * 100);\n    \n    const progressPercentage = Math.min(xpProgress, missionProgress);\n    \n    const canPromote = hero.progression.xp >= nextThreshold.xp && \n                      (hero.stats.questsCompleted || 0) >= nextThreshold.missions &&\n                      (!nextThreshold.titles || (hero.titles?.length || 0) >= nextThreshold.titles) &&\n                      this.checkSpecialRequirements(hero, nextThreshold.specialRequirements);\n    \n    return {\n      currentRank,\n      nextRank,\n      currentXP: hero.progression.xp,\n      requiredXP: nextThreshold.xp,\n      currentMissions: hero.stats.questsCompleted || 0,\n      requiredMissions: nextThreshold.missions,\n      progressPercentage,\n      canPromote\n    };\n  }\n\n  /**\n   * Promove o heri para o prximo rank se elegvel\n   */\n  promoteHero(hero: Hero, currentRankData: HeroRankData): { promoted: boolean; newRank?: RankLevel; celebration?: RankCelebration } {\n    const progress = this.calculateProgress(hero);\n    \n    if (!progress.canPromote || !progress.nextRank) {\n      return { promoted: false };\n    }\n    \n    const newRank = progress.nextRank;\n    const celebration = this.createCelebration(newRank, hero);\n    \n    // Log da atividade de promoo\n    logActivity.rankPromotion({\n      heroId: hero.id,\n      heroName: hero.name,\n      heroClass: hero.class,\n      previousRank: currentRankData.currentRank,\n      newRank: newRank\n    });\n    \n    return {\n      promoted: true,\n      newRank,\n      celebration\n    };\n  }\n\n  /**\n   * Cria uma celebrao para a promoo de rank\n   */\n  private createCelebration(rank: RankLevel, hero: Hero): RankCelebration {\n    const rankInfo = RANK_CONFIG[rank];\n    const rewards = RANK_REWARDS[rank] || [];\n    \n    let animationType: 'ascension' | 'legendary' | 'epic' = 'ascension';\n    if (['S', 'SS', 'SSS'].includes(rank)) animationType = 'legendary';\n    else if (['A', 'B'].includes(rank)) animationType = 'epic';\n    \n    return {\n      rank,\n      title: `Promoo para ${rankInfo.name}!`,\n      message: `Parabns, ${hero.name}! Voc alcanou o rank ${rank} - ${rankInfo.name}. ${rankInfo.description}`,\n      rewards: [\n        ...rewards.map(r => ({ ...r, unlocked: true }))\n      ],\n      animationType,\n      soundEffect: ['S', 'SS', 'SSS'].includes(rank) ? 'legendary_fanfare' : 'rank_up_trumpet',\n      particleEffect: ['S', 'SS', 'SSS'].includes(rank) ? 'golden_explosion' : 'sparkle_burst'\n    };\n  }\n\n  /**\n   * Determina uma conquista notvel para o histrico\n   */\n  private getNotableAchievement(hero: Hero, _rank: RankLevel): string {\n    const achievements = [\n      `Alcanou ${hero.progression.xp} XP total`,\n      `Completou ${hero.stats.questsCompleted || 0} misses`,\n      `Nvel ${hero.progression.level} conquistado`,\n      `Classe ${hero.class} dominada`\n    ];\n    \n    if (hero.achievements && hero.achievements.length > 0) {\n      achievements.push(hero.achievements[hero.achievements.length - 1]);\n    }\n    \n    return achievements[Math.floor(Math.random() * achievements.length)];\n  }\n\n  /**\n   * Calcula pontos de rank baseado em mltiplos fatores\n   */\n  calculateRankPoints(hero: Hero): number {\n    const basePoints = hero.progression.xp;\n    const missionBonus = (hero.stats.questsCompleted || 0) * 50;\n    \n    const levelBonus = hero.progression.level * 100;\n    const titleBonus = (hero.titles?.length || 0) * 200;\n    const achievementBonus = (hero.achievements?.length || 0) * 150;\n    \n    return basePoints + missionBonus + levelBonus + titleBonus + achievementBonus;\n  }\n\n  /**\n   * Cria dados de comparao para rankings\n   */\n  createComparison(hero: Hero, position: number): RankComparison {\n    return {\n      heroId: hero.id,\n      heroName: hero.name,\n      rank: this.calculateRank(hero),\n      level: hero.progression.level,\n      totalXP: hero.progression.xp,\n      missionsCompleted: hero.stats.questsCompleted || 0,\n      rankPoints: this.calculateRankPoints(hero),\n      position\n    };\n  }\n\n  /**\n   * Verifica se h recompensas pendentes para desbloquear\n   */\n  checkPendingRewards(hero: Hero, currentRankData: HeroRankData): RankReward[] {\n    const currentRank = this.calculateRank(hero);\n    const availableRewards = RANK_REWARDS[currentRank] || [];\n    const unlockedIds = currentRankData.unlockedRewards.map(r => r.name);\n    \n    return availableRewards.filter(reward => !unlockedIds.includes(reward.name));\n  }\n\n  /**\n   * Inicializa dados de rank para um novo heri\n   */\n  initializeRankData(hero: Hero): HeroRankData {\n    const initialRank = this.calculateRank(hero);\n    \n    return {\n      currentRank: initialRank,\n      rankHistory: [{\n        rank: initialRank,\n        achievedAt: new Date(),\n        heroLevel: hero.progression.level,\n        notableAchievement: 'Incio da jornada pica',\n        celebrationViewed: true\n      }],\n      totalRankPoints: this.calculateRankPoints(hero),\n      rankProgress: this.calculateProgress(hero),\n      unlockedRewards: RANK_REWARDS[initialRank]?.map(r => ({ ...r, unlocked: true })) || [],\n      pendingCelebrations: [],\n      rankAchievements: {\n        fastestPromotion: 0,\n        highestRankReached: initialRank,\n        totalPromotions: 0,\n        legendaryStoriesUnlocked: 0\n      }\n    };\n  }\n\n  /**\n   * Atualiza dados de rank aps mudanas no heri\n   */\n  updateRankData(hero: Hero, currentRankData: HeroRankData): HeroRankData {\n    const newRank = this.calculateRank(hero);\n    const progress = this.calculateProgress(hero);\n    const rankPoints = this.calculateRankPoints(hero);\n    \n    // Verificar se houve promoo\n    if (newRank !== currentRankData.currentRank) {\n      const celebration = this.createCelebration(newRank, hero);\n      const newHistory: RankHistory = {\n        rank: newRank,\n        achievedAt: new Date(),\n        heroLevel: hero.progression.level,\n        notableAchievement: this.getNotableAchievement(hero, newRank),\n        celebrationViewed: false\n      };\n\n      try {\n        logActivity.rankPromotion({\n          heroId: hero.id,\n          heroName: hero.name,\n          heroClass: hero.class,\n          previousRank: currentRankData.currentRank,\n          newRank: newRank\n        });\n      } catch {}\n\n      \n\n      const currentUnlocked = currentRankData.unlockedRewards || [];\n      const unlockedNames = new Set(currentUnlocked.map(r => r.name));\n      const newRewards = (RANK_REWARDS[newRank] || []).filter(r => !unlockedNames.has(r.name)).map(r => ({ ...r, unlocked: true }));\n\n      return {\n        ...currentRankData,\n        currentRank: newRank,\n        rankHistory: [...currentRankData.rankHistory, newHistory],\n        totalRankPoints: rankPoints,\n        rankProgress: progress,\n        unlockedRewards: [...currentUnlocked, ...newRewards],\n        pendingCelebrations: [...currentRankData.pendingCelebrations, celebration],\n        rankAchievements: {\n          ...currentRankData.rankAchievements,\n          highestRankReached: newRank,\n          totalPromotions: currentRankData.rankAchievements.totalPromotions + 1\n        }\n      };\n    }\n    \n    return {\n      ...currentRankData,\n      totalRankPoints: rankPoints,\n      rankProgress: progress\n    };\n  }\n\n  /**\n   * Obtm informaes visuais do rank\n   */\n  getRankInfo(rank: RankLevel) {\n    return RANK_CONFIG[rank];\n  }\n\n  /**\n   * Obtm todas as recompensas disponveis para um rank\n   */\n  getRankRewards(rank: RankLevel): RankReward[] {\n    return RANK_REWARDS[rank] || [];\n  }\n\n  /**\n   * Calcula tempo estimado para prximo rank\n   */\n  estimateTimeToNextRank(hero: Hero): { days: number; description: string } {\n    const progress = this.calculateProgress(hero);\n    \n    if (!progress.nextRank) {\n      return { days: 0, description: 'Rank mximo alcanado!' };\n    }\n    \n    const xpNeeded = progress.requiredXP - progress.currentXP;\n    const missionsNeeded = progress.requiredMissions - progress.currentMissions;\n    \n    // Estimativa baseada em progresso mdio dirio (assumindo 100 XP e 1 misso por dia)\n    const daysForXP = Math.ceil(xpNeeded / 100);\n    const daysForMissions = missionsNeeded;\n    \n    const estimatedDays = Math.max(daysForXP, daysForMissions);\n    \n    let description = '';\n    if (estimatedDays <= 1) {\n      description = 'Muito prximo da promoo!';\n    } else if (estimatedDays <= 7) {\n      description = `Aproximadamente ${estimatedDays} dias`;\n    } else if (estimatedDays <= 30) {\n      description = `Cerca de ${Math.ceil(estimatedDays / 7)} semanas`;\n    } else {\n      description = `Aproximadamente ${Math.ceil(estimatedDays / 30)} meses`;\n    }\n    \n    return { days: estimatedDays, description };\n  }\n}\n\n// Instncia singleton\nexport const rankSystem = RankSystem.getInstance();\n","import { Hero } from '../types/hero';\nimport type { Quest } from '../types/hero';\nimport { rankSystem } from './rankSystem';\nimport { RANK_ORDER, RankLevel } from '../types/ranks';\n\nexport interface ReputationLevel {\n  name: string;\n  threshold: number;\n  color: string;\n  description: string;\n  questModifiers: {\n    goldBonus: number;\n    xpBonus: number;\n    specialQuestsUnlocked: string[];\n  };\n}\n\nexport const REPUTATION_LEVELS: ReputationLevel[] = [\n  {\n    name: 'Desprezado',\n    threshold: -1000,\n    color: 'text-red-500',\n    description: 'Voc  visto como um inimigo desta faco',\n    questModifiers: { goldBonus: -0.5, xpBonus: -0.3, specialQuestsUnlocked: [] }\n  },\n  {\n    name: 'Hostil',\n    threshold: -500,\n    color: 'text-red-400',\n    description: 'Esta faco no confia em voc',\n    questModifiers: {\n      goldBonus: -0.3,\n      xpBonus: -0.2,\n      specialQuestsUnlocked: []\n    }\n  },\n  {\n    name: 'Desconfiado',\n    threshold: -100,\n    color: 'text-orange-400',\n    description: 'Voc  visto com suspeita',\n    questModifiers: {\n      goldBonus: -0.1,\n      xpBonus: 0,\n      specialQuestsUnlocked: []\n    }\n  },\n  {\n    name: 'Neutro',\n    threshold: 0,\n    color: 'text-gray-400',\n    description: 'Voc no tem reputao especial',\n    questModifiers: {\n      goldBonus: 0,\n      xpBonus: 0,\n      specialQuestsUnlocked: []\n    }\n  },\n  {\n    name: 'Amigvel',\n    threshold: 100,\n    color: 'text-green-400',\n    description: 'Esta faco gosta de voc',\n    questModifiers: {\n      goldBonus: 0.1,\n      xpBonus: 0.1,\n      specialQuestsUnlocked: ['friendly_merchant', 'guild_favor']\n    }\n  },\n  {\n    name: 'Respeitado',\n    threshold: 500,\n    color: 'text-blue-400',\n    description: 'Voc  respeitado por esta faco',\n    questModifiers: {\n      goldBonus: 0.25,\n      xpBonus: 0.2,\n      specialQuestsUnlocked: ['elite_missions', 'faction_secrets']\n    }\n  },\n  {\n    name: 'Reverenciado',\n    threshold: 1000,\n    color: 'text-purple-400',\n    description: 'Voc  uma lenda para esta faco',\n    questModifiers: { goldBonus: 0.5, xpBonus: 0.3, specialQuestsUnlocked: ['legendary_quests', 'faction_champion'] }\n  }\n];\n\nexport const FACTION_DESCRIPTIONS = {\n  'Guarda da Cidade': {\n    description: 'Defensores da lei e da ordem nas ruas',\n    opposingFactions: ['Ladres', 'Cultistas'],\n    allyFactions: ['Clero', 'Comerciantes'],\n    minRankRequirement: 'E' as RankLevel\n  },\n  'Ladres': {\n    description: 'Guildas clandestinas e redes de contrabando',\n    opposingFactions: ['Guarda da Cidade', 'Comerciantes'],\n    allyFactions: ['Cultistas'],\n    minRankRequirement: 'D' as RankLevel\n  },\n  'Clero': {\n    description: 'Ordens sagradas, templos e curandeiros',\n    opposingFactions: ['Cultistas'],\n    allyFactions: ['Guarda da Cidade'],\n    minRankRequirement: 'D' as RankLevel\n  },\n  'Cultistas': {\n    description: 'Seitas profanas e rituais sombrios',\n    opposingFactions: ['Clero', 'Guarda da Cidade'],\n    allyFactions: ['Ladres'],\n    minRankRequirement: 'B' as RankLevel\n  },\n  'Comerciantes': {\n    description: 'Companhias de comrcio, caravanas e mercados',\n    opposingFactions: ['Ladres'],\n    allyFactions: ['Guarda da Cidade', 'Exploradores'],\n    minRankRequirement: 'E' as RankLevel\n  },\n  'Exploradores': {\n    description: 'Cartgrafos, aventureiros e descobridores de rotas',\n    opposingFactions: [],\n    allyFactions: ['Comerciantes'],\n    minRankRequirement: 'D' as RankLevel\n  }\n};\n\nexport function getReputationLevel(reputation: number): ReputationLevel {\n  const levels = [...REPUTATION_LEVELS].reverse();\n  return levels.find(level => reputation >= level.threshold) || REPUTATION_LEVELS[0];\n}\n\nexport function updateHeroReputation(\n  hero: Hero, \n  factionName: string, \n  change: number\n): Hero {\n  const updatedFactions = (hero.reputationFactions || []).map(faction => {\n    if (faction.name === factionName) {\n      const newReputation = Math.max(-1000, Math.min(1000, faction.reputation + change));\n      \n      // Aplicar mudanas em faces opostas\n      const factionInfo = FACTION_DESCRIPTIONS[factionName as keyof typeof FACTION_DESCRIPTIONS];\n      if (factionInfo && change > 0) {\n        // Reduzir reputao com faces opostas\n        factionInfo.opposingFactions.forEach(opposingFaction => {\n          const opposingIndex = (hero.reputationFactions || []).findIndex(f => f.name === opposingFaction);\n          if (opposingIndex !== -1) {\n            (hero.reputationFactions || [])[opposingIndex].reputation = Math.max(\n              -1000, \n              (hero.reputationFactions || [])[opposingIndex].reputation - Math.floor(change * 0.3)\n            );\n          }\n        });\n      }\n      \n      return { ...faction, reputation: newReputation };\n    }\n    return faction;\n  });\n\n  return {\n    ...hero,\n    reputationFactions: updatedFactions\n  };\n}\n\nexport function getAvailableQuestsByReputation(hero: Hero): string[] {\n  const availableQuests: string[] = [];\n  \n  (hero.reputationFactions || []).forEach(faction => {\n    const level = getReputationLevel(faction.reputation);\n    availableQuests.push(...level.questModifiers.specialQuestsUnlocked);\n  });\n  \n  return [...new Set(availableQuests)]; // Remove duplicatas\n}\n\nexport function calculateReputationModifiers(hero: Hero, factionName: string) {\n  const faction = (hero.reputationFactions || []).find(f => f.name === factionName);\n  if (!faction) return { goldBonus: 0, xpBonus: 0 };\n  \n  const level = getReputationLevel(faction.reputation);\n  const info = FACTION_DESCRIPTIONS[factionName as keyof typeof FACTION_DESCRIPTIONS] as any;\n  const heroRank = rankSystem.calculateRank(hero);\n  const meetsRank = !info?.minRankRequirement || (RANK_ORDER.indexOf(heroRank) >= RANK_ORDER.indexOf(info.minRankRequirement as RankLevel));\n  if (!meetsRank) {\n    return { goldBonus: 0, xpBonus: 0 };\n  }\n  return level.questModifiers;\n}\n\nexport function getReputationColor(reputation: number): string {\n  const level = getReputationLevel(reputation);\n  return level.color;\n}\n\nexport function getReputationDescription(reputation: number): string {\n  const level = getReputationLevel(reputation);\n  return `${level.name}: ${level.description}`;\n}\n\n// Funo para gerar eventos de reputao baseados nas aes do heri\nexport function generateReputationEvents(hero: Hero): Array<{\n  factionName: string;\n  change: number;\n  reason: string;\n}> {\n  const events = [];\n\n  // Exemplo simples de eventos (ajuste conforme sua lgica real)\n  // Melhor manter neutro, usando nomes das 3 faces\n  if ((hero.completedQuests || []).length > 0) {\n    events.push({\n      factionName: 'Guarda da Cidade',\n      change: 10,\n      reason: 'Apoiou a segurana urbana'\n    });\n    events.push({\n      factionName: 'Ladres',\n      change: -3,\n      reason: 'Aes que atrapalham redes clandestinas'\n    });\n  }\n\n  return events;\n}\n\nexport function formatReputationChange(change: number): string {\n  const sign = change > 0 ? '+' : '';\n  const color = change > 0 ? 'text-green-400' : 'text-red-400';\n  return `<span class=\"${color}\">${sign}${change}</span>`;\n}\n\n// Inferir mudanas de reputao com base no contedo da misso\nexport function inferQuestFactionChanges(quest: Quest): Array<{ factionName: string; change: number; reason?: string }> {\n  const text = `${quest.title} ${quest.description}`.toLowerCase();\n  const baseByDifficulty: Record<string, number> = { rapida: 1, facil: 2, padrao: 3, medio: 5, dificil: 8, epica: 12 };\n  const base = baseByDifficulty[quest.difficulty] ?? 3;\n\n  const changes: Array<{ factionName: string; change: number; reason?: string }> = [];\n\n  if (quest.isGuildQuest) {\n    const guildBase: Record<string, number> = { facil: 5, medio: 8, dificil: 12, epica: 20 };\n    const gb = guildBase[quest.difficulty] ?? 6;\n    changes.push({ factionName: 'Guarda da Cidade', change: gb, reason: 'Misso de guilda' });\n    return changes;\n  }\n\n  if (quest.type === 'exploracao') {\n    changes.push({ factionName: 'Exploradores', change: base, reason: 'Explorao e mapeamento' });\n  } else if (quest.type === 'caca' || quest.type === 'contrato' || quest.type === 'historia') {\n    changes.push({ factionName: 'Guarda da Cidade', change: base, reason: 'Proteo e estabilidade' });\n  }\n\n  const keywordMap: Array<{ re: RegExp; faction: string; delta: number; reason: string }> = [\n    { re: /(comerciante|mercador|rota|caravana)/, faction: 'Comerciantes', delta: Math.max(1, Math.floor(base * 0.5)), reason: 'Apoio ao comrcio' },\n    { re: /(cultista|ritual|profano|blasfemo)/, faction: 'Cultistas', delta: -Math.max(1, Math.floor(base * 0.4)), reason: 'Combate a seitas profanas' },\n    { re: /(ladrao|roubo|contrabando|clandestino|assassino)/, faction: 'Ladres', delta: -Math.max(1, Math.floor(base * 0.4)), reason: 'Represso ao crime' },\n    { re: /(resgatar|defender|patrulha|guarda|protege|lei|ordem)/, faction: 'Guarda da Cidade', delta: Math.max(1, Math.floor(base * 0.5)), reason: 'Aes de segurana' },\n    { re: /(igreja|templo|cura|sagrado)/, faction: 'Clero', delta: Math.max(1, Math.floor(base * 0.4)), reason: 'Servio aos templos' },\n    { re: /(mapear|explorar|runas|descobrir|cartografar)/, faction: 'Exploradores', delta: Math.max(1, Math.floor(base * 0.4)), reason: 'Explorao e cartografia' }\n  ];\n\n  keywordMap.forEach(rule => {\n    if (rule.re.test(text)) {\n      changes.push({ factionName: rule.faction, change: rule.delta, reason: rule.reason });\n    }\n  });\n\n  const merged: Record<string, { change: number; reason?: string[] }> = {};\n  changes.forEach(c => {\n    const key = c.factionName;\n    merged[key] = merged[key] || { change: 0, reason: [] };\n    merged[key].change += c.change;\n    if (c.reason) merged[key].reason!.push(c.reason);\n  });\n\n  const mergedArray = Object.entries(merged).map(([factionName, info]) => ({ factionName, change: info.change, reason: info.reason?.join('; ') }));\n  mergedArray.sort((a, b) => Math.abs(b.change) - Math.abs(a.change));\n  return mergedArray.slice(0, 2);\n}\n","import { Hero, Leaderboard, LeaderboardEntry, RankingSystem } from '../types/hero';\n\nexport interface LeaderboardConfig {\n  id: string;\n  name: string;\n  description: string;\n  type: 'xp' | 'gold' | 'quests' | 'achievements' | 'reputation' | 'playtime';\n  icon: string;\n  color: string;\n  getValue: (hero: Hero) => number;\n  formatValue: (value: number) => string;\n}\n\nexport const LEADERBOARD_CONFIGS: LeaderboardConfig[] = [\n  {\n    id: 'xp',\n    name: 'Experincia Total',\n    description: 'Heris com mais experincia acumulada',\n    type: 'xp',\n    icon: '',\n    color: 'text-yellow-400',\n    getValue: (hero) => hero.progression?.experience || 0,\n    formatValue: (value) => `${(value || 0).toLocaleString()} XP`\n  },\n  {\n    id: 'level',\n    name: 'Nvel Mais Alto',\n    description: 'Heris com o maior nvel alcanado',\n    type: 'xp',\n    icon: '',\n    color: 'text-amber-400',\n    getValue: (hero) => hero.progression?.level || 0,\n    formatValue: (value) => `Nvel ${value || 0}`\n  },\n  {\n    id: 'gold',\n    name: 'Riqueza',\n    description: 'Heris com mais ouro acumulado',\n    type: 'gold',\n    icon: '',\n    color: 'text-yellow-500',\n    getValue: (hero) => hero.progression?.gold || 0,\n    formatValue: (value) => `${(value || 0).toLocaleString()} `\n  },\n  {\n    id: 'quests',\n    name: 'Misses Completadas',\n    description: 'Heris que completaram mais misses',\n    type: 'quests',\n    icon: '',\n    color: 'text-blue-400',\n    getValue: (hero) => (hero.completedQuests || []).length,\n    formatValue: (value) => `${value || 0} misses`\n  },\n  {\n    id: 'achievements',\n    name: 'Conquistas',\n    description: 'Heris com mais conquistas desbloqueadas',\n    type: 'achievements',\n    icon: '',\n    color: 'text-purple-400',\n    getValue: (hero) => (hero.achievements || []).filter(a => a.unlockedAt).length,\n    formatValue: (value) => `${value || 0} conquistas`\n  },\n  {\n    id: 'reputation',\n    name: 'Reputao Total',\n    description: 'Heris com melhor reputao geral',\n    type: 'reputation',\n    icon: '',\n    color: 'text-green-400',\n    getValue: (hero) => (hero.reputationFactions || []).reduce((sum, faction) => sum + Math.max(0, faction.reputation), 0),\n    formatValue: (value) => `${value || 0} pontos`\n  },\n  {\n    id: 'playtime',\n    name: 'Tempo de Jogo',\n    description: 'Heris com mais tempo jogado',\n    type: 'playtime',\n    icon: '',\n    color: 'text-indigo-400',\n    getValue: (hero) => (hero.stats?.totalPlayTime || 0),\n    formatValue: (value) => {\n      const safeValue = value || 0;\n      return `${Math.floor(safeValue / 60)}h ${safeValue % 60}m`;\n    }\n  }\n];\n\nexport function generateLeaderboard(\n  heroes: Hero[], \n  config: LeaderboardConfig,\n  limit: number = 50\n): Leaderboard {\n  // Filtrar heris vlidos e calcular valores\n  const validEntries = heroes\n    .filter(hero => hero.progression.level > 0) // Apenas heris que comearam a jogar\n    .map(hero => {\n      const rawValue = config.getValue(hero);\n      const safeValue = typeof rawValue === 'number' && !isNaN(rawValue) ? rawValue : 0;\n      \n      return {\n        heroId: hero.id,\n        heroName: hero.name,\n        heroClass: hero.class,\n        heroRace: hero.race,\n        value: safeValue,\n        rank: 0, // Ser definido aps ordenao\n        change: 0, // TODO: Implementar comparao com ranking anterior\n        lastUpdated: new Date(),\n        isNPC: hero.origin === 'npc'\n      };\n    })\n    .sort((a, b) => b.value - a.value) // Ordenar por valor (maior primeiro)\n    .slice(0, limit); // Limitar nmero de entradas\n\n  // Atribuir ranks\n  validEntries.forEach((entry, index) => {\n    entry.rank = index + 1;\n  });\n\n  return {\n    id: config.id,\n    name: config.name,\n    description: config.description,\n    type: config.type,\n    entries: validEntries,\n    lastUpdated: new Date()\n  };\n}\n\nexport function generateAllLeaderboards(heroes: Hero[]): Leaderboard[] {\n  return LEADERBOARD_CONFIGS.map(config => \n    generateLeaderboard(heroes, config)\n  );\n}\n\nexport function getHeroRanking(hero: Hero, heroes: Hero[]): RankingSystem {\n  const leaderboards = generateAllLeaderboards(heroes);\n  \n  // Encontrar posio do heri em cada leaderboard\n  const xpLeaderboard = leaderboards.find(lb => lb.id === 'xp');\n  const globalRank = xpLeaderboard?.entries.findIndex(entry => entry.heroId === hero.id) + 1 || 0;\n  \n  // Ranking por classe\n  const sameClassHeroes = heroes.filter(h => h.class === hero.class);\n  const classLeaderboard = generateLeaderboard(sameClassHeroes, LEADERBOARD_CONFIGS[0]);\n  const classRank = classLeaderboard.entries.findIndex(entry => entry.heroId === hero.id) + 1 || 0;\n  \n  // Calcular pontuao total baseada em mltiplos fatores\n  const totalScore = calculateTotalScore(hero);\n  \n  return {\n    globalRank,\n    classRank,\n    weeklyRank: 0, // TODO: Implementar ranking semanal\n    achievements: (hero.achievements || []).filter(a => a.unlockedAt).length,\n    totalScore\n  };\n}\n\nexport function calculateTotalScore(hero: Hero): number {\n  const base = (hero.progression.xp || 0) + (hero.progression.gold || 0) + (hero.stats?.achievementsUnlocked || 0) * 100;\n  const epicItems = hero.inventory ? Object.keys(hero.inventory.items).length * 5 : 0;\n  const decisions = hero.worldState?.decisionLog?.length || 0;\n  const streak = hero.stats?.loginStreak || 0;\n  return base + epicItems + decisions * 10 + streak * 20;\n}\n\n// Seasons e prestgio (esqueleto)\nexport interface SeasonInfo { name: string; start: string; end?: string; prestigeMultiplier?: number; }\nexport function applySeasonalScore(score: number, season?: SeasonInfo): number {\n  if (!season?.prestigeMultiplier) return score;\n  return Math.floor(score * season.prestigeMultiplier);\n}\n\nexport function getLeaderboardPosition(heroId: string, leaderboard: Leaderboard): number {\n  const entry = leaderboard.entries.find(e => e.heroId === heroId);\n  return entry?.rank || 0;\n}\n\nexport function getTopHeroes(leaderboard: Leaderboard, count: number = 10): LeaderboardEntry[] {\n  return leaderboard.entries.slice(0, count);\n}\n\nexport function getHeroesAroundRank(\n  leaderboard: Leaderboard, \n  heroId: string, \n  range: number = 5\n): LeaderboardEntry[] {\n  const heroIndex = leaderboard.entries.findIndex(e => e.heroId === heroId);\n  if (heroIndex === -1) return [];\n  \n  const start = Math.max(0, heroIndex - range);\n  const end = Math.min(leaderboard.entries.length, heroIndex + range + 1);\n  \n  return leaderboard.entries.slice(start, end);\n}\n\nexport function formatRankChange(change: number): string {\n  if (change > 0) return ` +${change}`;\n  if (change < 0) return ` ${change}`;\n  return ' 0';\n}\n\nexport function getRankColor(rank: number): string {\n  if (rank === 1) return 'text-yellow-400'; // Ouro\n  if (rank === 2) return 'text-gray-300'; // Prata\n  if (rank === 3) return 'text-orange-400'; // Bronze\n  if (rank <= 10) return 'text-purple-400'; // Top 10\n  if (rank <= 50) return 'text-blue-400'; // Top 50\n  return 'text-gray-400'; // Outros\n}\n\nexport function getRankIcon(rank: number): string {\n  if (rank === 1) return '';\n  if (rank === 2) return '';\n  if (rank === 3) return '';\n  if (rank <= 10) return '';\n  if (rank <= 50) return '';\n  return '';\n}\n\n// Funo para simular dados de leaderboard para demonstrao\nexport function generateMockLeaderboardData(currentHero: Hero): Hero[] {\n  const mockHeroes: Hero[] = [];\n  \n  // Adicionar o heri atual\n  mockHeroes.push(currentHero);\n  \n  // Gerar heris fictcios para popular o leaderboard\n  const names = ['Aragorn', 'Legolas', 'Gimli', 'Gandalf', 'Boromir', 'Frodo', 'Sam', 'Merry', 'Pippin', 'Faramir'];\n  const classes = ['warrior', 'mage', 'rogue', 'paladin', 'ranger'];\n  const races = ['human', 'elf', 'dwarf', 'halfling', 'orc'];\n  \n  for (let i = 0; i < 20; i++) {\n    const mockHero: Hero = {\n      id: `mock-${i}`,\n      name: names[i % names.length] + ` ${i + 1}`,\n      race: races[Math.floor(Math.random() * races.length)],\n      class: classes[Math.floor(Math.random() * classes.length)],\n      alignment: 'neutral',\n      attributes: {\n        strength: 10,\n        dexterity: 10,\n        constitution: 10,\n        intelligence: 10,\n        wisdom: 10,\n        charisma: 10\n      },\n      progression: {\n        level: Math.floor(Math.random() * 20) + 1,\n        experience: Math.floor(Math.random() * 10000),\n        gold: Math.floor(Math.random() * 5000),\n        health: 100,\n        maxHealth: 100,\n        stamina: 100,\n        maxStamina: 100\n      },\n      inventory: [],\n      equipment: {},\n      activeQuests: [],\n      completedQuests: Array(Math.floor(Math.random() * 50)).fill(null).map((_, idx) => ({\n        id: `quest-${idx}`,\n        title: `Misso ${idx + 1}`,\n        description: 'Misso completada',\n        type: 'combat',\n        difficulty: 'normal' as const,\n        rewards: { xp: 100, gold: 50 },\n        requirements: {},\n        isCompleted: true\n      })),\n      stats: {\n        totalPlayTime: Math.floor(Math.random() * 1000),\n        loginStreak: Math.floor(Math.random() * 30),\n        lastLogin: new Date()\n      },\n      titles: [],\n      activeTitle: undefined,\n      reputationFactions: [\n        { name: 'Guarda da Cidade', reputation: Math.floor(Math.random() * 2000) - 1000 },\n        { name: 'Comerciantes', reputation: Math.floor(Math.random() * 2000) - 1000 },\n        { name: 'Ladres', reputation: Math.floor(Math.random() * 2000) - 1000 }\n      ],\n      dailyGoals: [],\n      achievements: [],\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    \n    mockHeroes.push(mockHero);\n  }\n  \n  return mockHeroes;\n}","/**\n * Sistema de Mini-Metas Dirias\n */\n\nimport { DailyGoal, Hero, Item } from '../types/hero';\n\nexport interface DailyGoalTemplate {\n  id: string;\n  name: string;\n  description: string;\n  category: 'combat' | 'exploration' | 'social' | 'progression' | 'collection';\n  maxProgress: number;\n  baseRewards: {\n    xp: number;\n    gold: number;\n    glory?: number;\n    arcaneEssence?: number;\n    items?: Item[];\n  };\n  difficulty: 'easy' | 'medium' | 'hard';\n  levelRequirement: number;\n}\n\nconst DAILY_GOAL_TEMPLATES: DailyGoalTemplate[] = [\n  // EASY GOALS (Level 1+)\n  {\n    id: 'complete-quest',\n    name: 'Aventureiro Ativo',\n    description: 'Complete 1 misso',\n    category: 'exploration',\n    maxProgress: 1,\n    baseRewards: { xp: 50, gold: 25, glory: 5 },\n    difficulty: 'easy',\n    levelRequirement: 1\n  },\n  {\n    id: 'gain-xp',\n    name: 'Crescimento Constante',\n    description: 'Ganhe 100 XP',\n    category: 'progression',\n    maxProgress: 100,\n    baseRewards: { xp: 25, gold: 15 },\n    difficulty: 'easy',\n    levelRequirement: 1\n  },\n  {\n    id: 'earn-gold',\n    name: 'Coletor de Moedas',\n    description: 'Ganhe 50 moedas de ouro',\n    category: 'collection',\n    maxProgress: 50,\n    baseRewards: { xp: 30, gold: 20 },\n    difficulty: 'easy',\n    levelRequirement: 1\n  },\n  {\n    id: 'train-attribute',\n    name: 'Fortalecimento',\n    description: 'Treine qualquer atributo 1 vez',\n    category: 'progression',\n    maxProgress: 1,\n    baseRewards: { xp: 40, gold: 30, arcaneEssence: 1 },\n    difficulty: 'easy',\n    levelRequirement: 1\n  },\n  {\n    id: 'hatch-pet',\n    name: 'Domador Iniciante',\n    description: 'Chocar 1 mascote',\n    category: 'collection',\n    maxProgress: 1,\n    baseRewards: { xp: 60, gold: 40, arcaneEssence: 1 },\n    difficulty: 'easy',\n    levelRequirement: 1\n  },\n  {\n    id: 'train-pet',\n    name: 'Cuidar do Companheiro',\n    description: 'Treinar ou alimentar um mascote 1 vez',\n    category: 'progression',\n    maxProgress: 1,\n    baseRewards: { xp: 50, gold: 30 },\n    difficulty: 'easy',\n    levelRequirement: 1\n  },\n\n  // MEDIUM GOALS (Level 3+)\n  {\n    id: 'complete-multiple-quests',\n    name: 'Heri Dedicado',\n    description: 'Complete 3 misses',\n    category: 'exploration',\n    maxProgress: 3,\n    baseRewards: { xp: 100, gold: 75, glory: 10 },\n    difficulty: 'medium',\n    levelRequirement: 3\n  },\n  {\n    id: 'defeat-enemies',\n    name: 'Caador de Monstros',\n    description: 'Derrote 5 inimigos',\n    category: 'combat',\n    maxProgress: 5,\n    baseRewards: { xp: 80, gold: 60, arcaneEssence: 1 },\n    difficulty: 'medium',\n    levelRequirement: 3\n  },\n  {\n    id: 'gain-large-xp',\n    name: 'Sede de Conhecimento',\n    description: 'Ganhe 300 XP',\n    category: 'progression',\n    maxProgress: 300,\n    baseRewards: { xp: 75, gold: 50 },\n    difficulty: 'medium',\n    levelRequirement: 3\n  },\n  {\n    id: 'social-interaction',\n    name: 'Diplomata',\n    description: 'Interaja com 3 NPCs diferentes',\n    category: 'social',\n    maxProgress: 3,\n    baseRewards: { xp: 60, gold: 40 },\n    difficulty: 'medium',\n    levelRequirement: 3\n  },\n\n  // HARD GOALS (Level 5+)\n  {\n    id: 'epic-quest',\n    name: 'Lenda em Formao',\n    description: 'Complete 1 misso pica',\n    category: 'exploration',\n    maxProgress: 1,\n    baseRewards: { xp: 200, gold: 150, glory: 15 },\n    difficulty: 'hard',\n    levelRequirement: 5\n  },\n  {\n    id: 'level-up',\n    name: 'Evoluo',\n    description: 'Suba 1 nvel',\n    category: 'progression',\n    maxProgress: 1,\n    baseRewards: { xp: 100, gold: 100, glory: 10 },\n    difficulty: 'hard',\n    levelRequirement: 5\n  },\n  {\n    id: 'reputation-gain',\n    name: 'Construtor de Reputao',\n    description: 'Ganhe 50 pontos de reputao',\n    category: 'social',\n    maxProgress: 50,\n    baseRewards: { xp: 120, gold: 80 },\n    difficulty: 'hard',\n    levelRequirement: 5\n  },\n  {\n    id: 'perfect-day',\n    name: 'Dia Perfeito',\n    description: 'Complete todas as outras metas dirias',\n    category: 'progression',\n    maxProgress: 1,\n    baseRewards: { xp: 300, gold: 200, glory: 20, arcaneEssence: 2 },\n    difficulty: 'hard',\n    levelRequirement: 3\n  }\n];\n\nexport function generateDailyGoals(hero: Hero): DailyGoal[] {\n  const availableTemplates = DAILY_GOAL_TEMPLATES.filter(\n    template => hero.progression.level >= template.levelRequirement\n  );\n\n  const goals: DailyGoal[] = [];\n  const tomorrow = new Date();\n  tomorrow.setDate(tomorrow.getDate() + 1);\n  tomorrow.setHours(0, 0, 0, 0);\n\n  // Always include 1 easy goal\n  const easyTemplates = availableTemplates.filter(t => t.difficulty === 'easy');\n  if (easyTemplates.length > 0) {\n    const template = easyTemplates[Math.floor(Math.random() * easyTemplates.length)];\n    goals.push(createDailyGoalFromTemplate(template, tomorrow));\n  }\n\n  // Include 1-2 medium goals if hero level >= 3\n  if (hero.progression.level >= 3) {\n    const mediumTemplates = availableTemplates.filter(t => t.difficulty === 'medium');\n    const mediumCount = Math.min(2, mediumTemplates.length);\n    \n    for (let i = 0; i < mediumCount; i++) {\n      const template = mediumTemplates[Math.floor(Math.random() * mediumTemplates.length)];\n      if (!goals.some(g => g.id.includes(template.id))) {\n        goals.push(createDailyGoalFromTemplate(template, tomorrow));\n      }\n    }\n  }\n\n  // Include 1 hard goal if hero level >= 5\n  if (hero.progression.level >= 5) {\n    const hardTemplates = availableTemplates.filter(t => t.difficulty === 'hard' && t.id !== 'perfect-day');\n    if (hardTemplates.length > 0) {\n      const template = hardTemplates[Math.floor(Math.random() * hardTemplates.length)];\n      goals.push(createDailyGoalFromTemplate(template, tomorrow));\n    }\n  }\n\n  // Add \"Perfect Day\" goal if there are other goals\n  if (goals.length >= 2 && hero.progression.level >= 3) {\n    const perfectDayTemplate = DAILY_GOAL_TEMPLATES.find(t => t.id === 'perfect-day');\n    if (perfectDayTemplate) {\n      const perfectDayGoal = createDailyGoalFromTemplate(perfectDayTemplate, tomorrow);\n      perfectDayGoal.maxProgress = goals.length; // Set to number of other goals\n      perfectDayGoal.description = `Complete todas as outras ${goals.length} metas dirias`;\n      goals.push(perfectDayGoal);\n    }\n  }\n\n  return goals;\n}\n\nfunction createDailyGoalFromTemplate(template: DailyGoalTemplate, expiresAt: Date): DailyGoal {\n  return {\n    id: `${template.id}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n    description: template.description,\n    progress: 0,\n    maxProgress: template.maxProgress,\n    completed: false,\n    claimed: false,\n    rewards: { ...template.baseRewards },\n    expiresAt\n  };\n}\n\nexport function updateDailyGoalProgress(\n  goals: DailyGoal[],\n  goalType: string,\n  amount: number = 1\n): DailyGoal[] {\n  return goals.map(goal => {\n    if (goal.completed) return goal;\n\n    let shouldUpdate = false;\n    \n    // Check if this goal should be updated based on the action type\n    switch (goalType) {\n      case 'quest-completed':\n        shouldUpdate = goal.id.includes('complete-quest') || goal.id.includes('complete-multiple-quests');\n        break;\n      case 'epic-quest-completed':\n        shouldUpdate = goal.id.includes('epic-quest');\n        break;\n      case 'xp-gained':\n        shouldUpdate = goal.id.includes('gain-xp') || goal.id.includes('gain-large-xp');\n        break;\n      case 'gold-earned':\n        shouldUpdate = goal.id.includes('earn-gold');\n        break;\n      case 'enemy-defeated':\n        shouldUpdate = goal.id.includes('defeat-enemies');\n        break;\n      case 'attribute-trained':\n        shouldUpdate = goal.id.includes('train-attribute');\n        break;\n      case 'level-up':\n        shouldUpdate = goal.id.includes('level-up');\n        break;\n      case 'reputation-gained':\n        shouldUpdate = goal.id.includes('reputation-gain');\n        break;\n      case 'npc-interaction':\n        shouldUpdate = goal.id.includes('social-interaction');\n        break;\n      case 'pet-hatched':\n        shouldUpdate = goal.id.includes('hatch-pet');\n        break;\n      case 'pet-trained':\n        shouldUpdate = goal.id.includes('train-pet');\n        break;\n    }\n\n    if (shouldUpdate) {\n      const newProgress = Math.min(goal.maxProgress, goal.progress + amount);\n      return {\n        ...goal,\n        progress: newProgress,\n        completed: newProgress >= goal.maxProgress\n      };\n    }\n\n    return goal;\n  });\n}\n\nexport function checkPerfectDayGoal(goals: DailyGoal[]): DailyGoal[] {\n  const perfectDayGoal = goals.find(g => g.id.includes('perfect-day'));\n  if (!perfectDayGoal || perfectDayGoal.completed) return goals;\n\n  const otherGoals = goals.filter(g => !g.id.includes('perfect-day'));\n  const completedOtherGoals = otherGoals.filter(g => g.completed).length;\n\n  return goals.map(goal => {\n    if (goal.id.includes('perfect-day')) {\n      return {\n        ...goal,\n        progress: completedOtherGoals,\n        completed: completedOtherGoals >= goal.maxProgress\n      };\n    }\n    return goal;\n  });\n}\n\nexport function getExpiredGoals(goals: DailyGoal[]): DailyGoal[] {\n  const now = new Date();\n  return goals.filter(goal => {\n    const exp = typeof (goal.expiresAt as any) === 'string'\n      ? new Date(goal.expiresAt as unknown as string)\n      : (goal.expiresAt as Date);\n    return exp <= now;\n  });\n}\n\nexport function removeExpiredGoals(goals: DailyGoal[]): DailyGoal[] {\n  const now = new Date();\n  return goals.filter(goal => {\n    const exp = typeof (goal.expiresAt as any) === 'string'\n      ? new Date(goal.expiresAt as unknown as string)\n      : (goal.expiresAt as Date);\n    return exp > now;\n  });\n}\n\nexport function getDailyGoalRewards(goal: DailyGoal): { xp: number; gold: number; glory?: number; arcaneEssence?: number; items?: Item[] } {\n  // Add bonus rewards based on difficulty\n  const bonusMultiplier = goal.id.includes('perfect-day') ? 1.5 : 1;\n  \n  return {\n    xp: Math.floor(goal.rewards.xp * bonusMultiplier),\n    gold: Math.floor(goal.rewards.gold * bonusMultiplier),\n    glory: goal.rewards.glory ? Math.floor(goal.rewards.glory * bonusMultiplier) : undefined,\n    arcaneEssence: goal.rewards.arcaneEssence ? Math.floor(goal.rewards.arcaneEssence * bonusMultiplier) : undefined,\n    items: goal.rewards.items\n  };\n}\n\nexport function getDailyGoalCategoryIcon(goalId: string): string {\n  if (goalId.includes('complete-quest') || goalId.includes('epic-quest')) return '';\n  if (goalId.includes('gain-xp') || goalId.includes('level-up')) return '';\n  if (goalId.includes('earn-gold')) return '';\n  if (goalId.includes('defeat-enemies')) return '';\n  if (goalId.includes('train-attribute')) return '';\n  if (goalId.includes('social-interaction') || goalId.includes('reputation-gain')) return '';\n  if (goalId.includes('perfect-day')) return '';\n  return '';\n}\n\nexport function getDailyGoalDifficultyColor(goalId: string): string {\n  if (goalId.includes('perfect-day')) return 'text-purple-400';\n  \n  const template = DAILY_GOAL_TEMPLATES.find(t => goalId.includes(t.id));\n  if (!template) return 'text-gray-400';\n  \n  switch (template.difficulty) {\n    case 'easy': return 'text-green-400';\n    case 'medium': return 'text-yellow-400';\n    case 'hard': return 'text-red-400';\n    default: return 'text-gray-400';\n  }\n}\n","/**\n * Sistema de Ttulos e Reputao\n */\n\nimport { Title, Achievement, ReputationFaction, Hero, HeroAttributes } from '../types/hero';\n\n// === TTULOS PREDEFINIDOS ===\n\nexport const AVAILABLE_TITLES: Title[] = [\n  // Ttulos simples por level\n  {\n    id: 'aprendiz',\n    name: 'Aprendiz',\n    description: 'Alcanou o nvel 2',\n    rarity: 'comum',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'veterano',\n    name: 'Veterano',\n    description: 'Alcanou o nvel 5',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'campeao',\n    name: 'Campeo',\n    description: 'Alcanou o nvel 10',\n    rarity: 'epico',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  // Ttulos de Combate\n  {\n    id: 'wolf-slayer',\n    name: 'Caador de Lobos',\n    description: 'Derrotou 50 lobos em combate',\n    rarity: 'comum',\n    category: 'combat',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'dragon-bane',\n    name: 'Perdio dos Drages',\n    description: 'Derrotou um drago lendrio',\n    rarity: 'lendario',\n    category: 'combat',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'undead-hunter',\n    name: 'Caador de Mortos-Vivos',\n    description: 'Derrotou 100 criaturas mortas-vivas',\n    rarity: 'raro',\n    category: 'combat',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'berserker',\n    name: 'Berserker',\n    description: 'Venceu 10 combates consecutivos sem usar poes',\n    rarity: 'epico',\n    category: 'combat',\n    badge: '',\n    unlockedAt: new Date()\n  },\n\n  // Ttulos de Explorao\n  {\n    id: 'pathfinder',\n    name: 'Desbravador',\n    description: 'Completou 25 misses de explorao',\n    rarity: 'comum',\n    category: 'exploration',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'treasure-hunter',\n    name: 'Caador de Tesouros',\n    description: 'Encontrou 50 itens raros ou superiores',\n    rarity: 'raro',\n    category: 'exploration',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'master-explorer',\n    name: 'Explorador Mestre',\n    description: 'Visitou todas as regies conhecidas',\n    rarity: 'epico',\n    category: 'exploration',\n    badge: '',\n    unlockedAt: new Date()\n  },\n\n  // Ttulos Sociais\n  {\n    id: 'guild-founder',\n    name: 'Fundador de Guilda',\n    description: 'Criou uma guilda prspera',\n    rarity: 'raro',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'mentor',\n    name: 'Mentor',\n    description: 'Ajudou 10 novos heris em suas primeiras misses',\n    rarity: 'comum',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'legend',\n    name: 'Lenda Viva',\n    description: 'Alcanou reputao mxima com todas as faces',\n    rarity: 'lendario',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  },\n\n  // Ttulos de Achievement\n  {\n    id: 'completionist',\n    name: 'Completista',\n    description: 'Desbloqueou todos os achievements bsicos',\n    rarity: 'epico',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'wealthy',\n    name: 'Magnata',\n    description: 'Acumulou 10.000 moedas de ouro',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n\n  // Ttulos Especiais\n  {\n    id: 'beta-tester',\n    name: 'Testador Beta',\n    description: 'Participou dos testes iniciais do Hero Forge',\n    rarity: 'especial',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'first-hero',\n    name: 'Primeiro Heri',\n    description: 'Criou o primeiro heri no Hero Forge',\n    rarity: 'especial',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  }\n  ,\n  // === Propostas do usurio: Ttulos de Classe ===\n  {\n    id: 'campeao-de-ferro',\n    name: 'Campeo de Ferro',\n    description: 'Guerreiro que alcanou marcos de domnio',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'portador-da-lamina-sagrada',\n    name: 'Portador da Lmina Sagrada',\n    description: 'Guerreiro celebrado por sua lmina consagrada',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'teurgo-do-veu',\n    name: 'Teurgo do Vu',\n    description: 'Mago que tocou os vus do arcano',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'guardiao-dos-arcanos',\n    name: 'Guardio dos Arcanos',\n    description: 'Mago que resguarda segredos antigos',\n    rarity: 'epico',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'olho-de-falcao',\n    name: 'Olho de Falco',\n    description: 'Arqueiro de mira impecvel',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'cacador-das-sombras',\n    name: 'Caador das Sombras',\n    description: 'Arqueiro que caa sem ser visto',\n    rarity: 'epico',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'mao-da-luz',\n    name: 'Mo da Luz',\n    description: 'Clrigo de devoo e cura',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'protetor-das-almas',\n    name: 'Protetor das Almas',\n    description: 'Clrigo que guarda o bem-estar espiritual',\n    rarity: 'epico',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n\n  // === Ttulos de Conquista ===\n  {\n    id: 'explorador-do-desconhecido',\n    name: 'Explorador do Desconhecido',\n    description: 'Aventurou-se por territrios inexplorados',\n    rarity: 'raro',\n    category: 'exploration',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'vencedor-das-profundezas',\n    name: 'Vencedor das Profundezas',\n    description: 'Concluiu uma masmorra completa',\n    rarity: 'epico',\n    category: 'exploration',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'domador-da-fortuna',\n    name: 'Domador da Fortuna',\n    description: 'Encontrou vrios tesouros raros',\n    rarity: 'raro',\n    category: 'exploration',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'sombra-invicta',\n    name: 'Sombra Invicta',\n    description: 'Venceu batalhas consecutivas com maestria',\n    rarity: 'epico',\n    category: 'combat',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'o-persistente',\n    name: 'O Persistente',\n    description: 'No desiste diante de falhas',\n    rarity: 'comum',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'o-iluminado',\n    name: 'O Iluminado',\n    description: 'Atingiu grandes patamares de sabedoria',\n    rarity: 'lendario',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  },\n\n  // === Progresso / Reputao ===\n  {\n    id: 'aventureiro-iniciante',\n    name: 'Aventureiro Iniciante',\n    description: 'Primeiros passos na aventura',\n    rarity: 'comum',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'veterano-das-estradas',\n    name: 'Veterano das Estradas',\n    description: 'Longa jornada pelos caminhos do reino',\n    rarity: 'raro',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'heroi-local',\n    name: 'Heri Local',\n    description: 'Respeitado pelas pessoas da regio',\n    rarity: 'raro',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'guardiao-do-reino',\n    name: 'Guardio do Reino',\n    description: 'Defensor da paz e da ordem',\n    rarity: 'epico',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  // Lenda Viva j existe como 'legend'\n\n  // === Raros / picos ===\n  {\n    id: 'escolhido-pelo-destino',\n    name: 'O Escolhido pelo Destino',\n    description: 'Marcado por eventos nicos',\n    rarity: 'lendario',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'andarilho-eterno',\n    name: 'Andarilho Eterno',\n    description: 'Explorou incontveis lugares',\n    rarity: 'epico',\n    category: 'exploration',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'coracao-de-dragao',\n    name: 'Corao de Drago',\n    description: 'Provou coragem frente ao fogo dracnico',\n    rarity: 'lendario',\n    category: 'combat',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'mente-da-eternidade',\n    name: 'Mente da Eternidade',\n    description: 'Alcanou sabedoria transcendente',\n    rarity: 'epico',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'o-insone',\n    name: 'O Insone',\n    description: 'Sempre presente nas viglias noturnas',\n    rarity: 'raro',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  },\n\n  // === Sociais e Cosmticos ===\n  {\n    id: 'o-generoso',\n    name: 'O Generoso',\n    description: 'Conhecido por ajudar outros heris',\n    rarity: 'comum',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'forjador-original',\n    name: 'O Forjador Original',\n    description: 'Fundador honrado do projeto',\n    rarity: 'epico',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'lenda-do-povo',\n    name: 'A Lenda do Povo',\n    description: 'Amado e celebrado nas tavernas',\n    rarity: 'raro',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'colecionador-de-reliquias',\n    name: 'Colecionador de Relquias',\n    description: 'Reuniu um acervo lendrio',\n    rarity: 'epico',\n    category: 'achievement',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'mestre-dos-herois',\n    name: 'Mestre dos Heris',\n    description: 'Criou heris memorveis',\n    rarity: 'epico',\n    category: 'social',\n    badge: '',\n    unlockedAt: new Date()\n  }\n  ,\n  {\n    id: 'estrategista-das-cartas',\n    name: 'Estrategista das Cartas',\n    description: 'Venceu 10 partidas no Jogo das Cartas',\n    rarity: 'raro',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  },\n  {\n    id: 'mestre-do-rps',\n    name: 'Mestre do RPS',\n    description: 'Alcanou sequncia de 5 vitrias em PedraPapelTesoura',\n    rarity: 'raro',\n    category: 'special',\n    badge: '',\n    unlockedAt: new Date()\n  }\n];\n\n// === ACHIEVEMENTS PARA TTULOS ===\n\nexport const TITLE_ACHIEVEMENTS: Achievement[] = [\n  {\n    id: 'wolf-slayer-achievement',\n    name: 'Caador de Lobos',\n    description: 'Derrote 50 lobos em combate',\n    rarity: 'comum',\n    unlocked: false,\n    progress: 0,\n    maxProgress: 50,\n    rewards: {\n      xp: 500,\n      gold: 200,\n      title: 'wolf-slayer'\n    }\n  },\n  {\n    id: 'dragon-bane-achievement',\n    name: 'Perdio dos Drages',\n    description: 'Derrote um drago lendrio',\n    rarity: 'lendario',\n    unlocked: false,\n    progress: 0,\n    maxProgress: 1,\n    rewards: {\n      xp: 5000,\n      gold: 2000,\n      title: 'dragon-bane'\n    }\n  },\n  {\n    id: 'pathfinder-achievement',\n    name: 'Desbravador',\n    description: 'Complete 25 misses de explorao',\n    rarity: 'comum',\n    unlocked: false,\n    progress: 0,\n    maxProgress: 25,\n    rewards: {\n      xp: 750,\n      gold: 300,\n      title: 'pathfinder'\n    }\n  },\n  {\n    id: 'treasure-hunter-achievement',\n    name: 'Caador de Tesouros',\n    description: 'Encontre 50 itens raros ou superiores',\n    rarity: 'raro',\n    unlocked: false,\n    progress: 0,\n    maxProgress: 50,\n    rewards: {\n      xp: 1000,\n      gold: 500,\n      title: 'treasure-hunter'\n    }\n  },\n  {\n    id: 'wealthy-achievement',\n    name: 'Magnata',\n    description: 'Acumule 10.000 moedas de ouro',\n    rarity: 'raro',\n    unlocked: false,\n    progress: 0,\n    maxProgress: 10000,\n    rewards: {\n      xp: 2000,\n      title: 'wealthy'\n    }\n  }\n  ,\n  {\n    id: 'cards-champion-achievement',\n    name: 'Campeo das Cartas',\n    description: 'Vena 10 partidas no Jogo das Cartas',\n    rarity: 'raro',\n    unlocked: false,\n    progress: 0,\n    maxProgress: 10,\n    rewards: {\n      xp: 500,\n      gold: 250,\n      title: 'estrategista-das-cartas'\n    }\n  },\n  {\n    id: 'rps-master-achievement',\n    name: 'Mestre do RPS',\n    description: 'Alcance sequncia de 5 vitrias em RPS',\n    rarity: 'raro',\n    unlocked: false,\n    progress: 0,\n    maxProgress: 5,\n    rewards: {\n      xp: 400,\n      gold: 200,\n      title: 'mestre-do-rps'\n    }\n  }\n];\n\n// === FACES DE REPUTAO ===\n\nexport const DEFAULT_FACTIONS: ReputationFaction[] = [\n  { id: 'ordem', name: 'Ordem', reputation: 0, level: 'neutral' },\n  { id: 'sombra', name: 'Sombra', reputation: 0, level: 'neutral' },\n  { id: 'livre', name: 'Livre', reputation: 0, level: 'neutral' }\n];\n\n// === FUNES UTILITRIAS ===\n\nexport function getReputationLevel(reputation: number): ReputationFaction['level'] {\n  if (reputation <= -500) return 'hostile';\n  if (reputation <= -200) return 'unfriendly';\n  if (reputation <= 200) return 'neutral';\n  if (reputation <= 500) return 'friendly';\n  if (reputation <= 800) return 'honored';\n  return 'revered';\n}\n\nexport function updateFactionReputation(\n  factions: ReputationFaction[],\n  factionId: string,\n  change: number\n): ReputationFaction[] {\n  return factions.map(faction => {\n    if (faction.id === factionId) {\n      const newReputation = Math.max(-1000, Math.min(1000, faction.reputation + change));\n      return {\n        ...faction,\n        reputation: newReputation,\n        level: getReputationLevel(newReputation)\n      };\n    }\n    return faction;\n  });\n}\n\nexport function checkTitleUnlock(hero: Hero, achievementId: string): Title | null {\n  const achievement = (hero.achievements || []).find(a => a.id === achievementId);\n  if (!achievement || !achievement.unlocked || !achievement.rewards.title) {\n    return null;\n  }\n\n  const titleId = achievement.rewards.title;\n  const title = AVAILABLE_TITLES.find(t => t.id === titleId);\n  \n  if (title && !hero.titles.some(t => t.id === titleId)) {\n    return {\n      ...title,\n      unlockedAt: new Date()\n    };\n  }\n\n  return null;\n}\n\nexport function getTitlesByCategory(titles: Title[], category: Title['category']): Title[] {\n  return titles.filter(title => title.category === category);\n}\n\nexport function getTitlesByRarity(titles: Title[], rarity: Title['rarity']): Title[] {\n  return titles.filter(title => title.rarity === rarity);\n}\n\nexport function getActiveTitle(hero: Hero): Title | null {\n  if (!hero.activeTitle) return null;\n  return hero.titles.find(title => title.id === hero.activeTitle) || null;\n}\n\nexport function formatTitleDisplay(hero: Hero): string {\n  const activeTitle = getActiveTitle(hero);\n  if (!activeTitle) return hero.name;\n  \n  return `${activeTitle.badge} ${hero.name}, ${activeTitle.name}`;\n}\n\n// === SISTEMA DE CONQUISTAS BASEADAS EM ESTATSTICAS ===\n\nexport function updateAchievementProgress(hero: Hero): Achievement[] {\n  return (hero.achievements || []).map(achievement => {\n    if (achievement.unlocked) return achievement;\n\n    let newProgress = achievement.progress;\n\n    switch (achievement.id) {\n      case 'wolf-slayer-achievement':\n        // Assumindo que temos uma estatstica especfica para lobos mortos\n        newProgress = hero.stats.enemiesDefeated; // Simplificado\n        break;\n      \n      case 'pathfinder-achievement':\n        // Contar misses de explorao completadas\n        newProgress = hero.completedQuests.filter(q => q.type === 'exploration').length;\n        break;\n      \n      case 'treasure-hunter-achievement':\n        newProgress = hero.stats.itemsFound;\n        break;\n      \n      case 'wealthy-achievement':\n        newProgress = hero.progression.gold;\n        break;\n      case 'cards-champion-achievement':\n        newProgress = Number((hero.stats as any)?.miniCardsWins || 0);\n        break;\n      case 'rps-master-achievement':\n        newProgress = Number((hero.stats as any)?.miniRpsBestStreak || 0);\n        break;\n    }\n\n    const unlocked = newProgress >= achievement.maxProgress;\n\n    return {\n      ...achievement,\n      progress: Math.min(newProgress, achievement.maxProgress),\n      unlocked,\n      unlockedAt: unlocked && !achievement.unlocked ? new Date() : achievement.unlockedAt\n    };\n  });\n}\n\n// === BNUS PASSIVOS DE TTULOS ===\n// Bnus simples baseados em atributos para cada ttulo.\n// So somados aos atributos totais (aps equipamentos) e impactam os derivados.\nexport const TITLE_PASSIVE_ATTRIBUTE_BONUSES: Record<string, Partial<HeroAttributes>> = {\n  // Ttulo inicial\n  'novato': {},\n  // Level-based simples\n  'aprendiz': { inteligencia: 1 },\n  'veterano': { constituicao: 1 },\n  'campeao': { carisma: 1 },\n\n  // Combate\n  'wolf-slayer': { forca: 1 },\n  'dragon-bane': { forca: 2, constituicao: 2 },\n  'undead-hunter': { forca: 1, sabedoria: 1 },\n  'berserker': { forca: 2 },\n\n  // Explorao\n  'pathfinder': { destreza: 2 },\n  'treasure-hunter': { destreza: 1, inteligencia: 1 },\n  'master-explorer': { destreza: 1, sabedoria: 1 },\n\n  // Social\n  'guild-founder': { sabedoria: 1, carisma: 1 },\n  'mentor': { carisma: 1 },\n  'legend': { forca: 1, destreza: 1, constituicao: 1, inteligencia: 1, sabedoria: 1, carisma: 1 },\n\n  // Achievement\n  'completionist': { inteligencia: 1, sabedoria: 1 },\n  'wealthy': { carisma: 1 },\n\n  // Especiais\n  'beta-tester': { inteligencia: 1 },\n  'first-hero': { constituicao: 1 }\n  ,\n  // === Propostas do usurio: bnus mapeados a atributos existentes ===\n  'campeao-de-ferro': { constituicao: 2 }, // aproxima +defesa\n  'portador-da-lamina-sagrada': { forca: 3 },\n  'teurgo-do-veu': { inteligencia: 2 }, // aproxima +MP\n  'guardiao-dos-arcanos': { inteligencia: 1, sabedoria: 1 },\n  'olho-de-falcao': { destreza: 2 },\n  'cacador-das-sombras': { destreza: 1, forca: 1 },\n  'mao-da-luz': { sabedoria: 2 },\n  'protetor-das-almas': { sabedoria: 1, constituicao: 1 },\n  'explorador-do-desconhecido': { inteligencia: 1 },\n  'vencedor-das-profundezas': { sabedoria: 1 },\n  'domador-da-fortuna': { carisma: 1 },\n  'sombra-invicta': { destreza: 1, forca: 1 },\n  'o-persistente': { constituicao: 1 },\n  'o-iluminado': { sabedoria: 2 },\n  'aventureiro-iniciante': {},\n  'veterano-das-estradas': { carisma: 1 },\n  'heroi-local': { carisma: 1 },\n  'guardiao-do-reino': { forca: 1, destreza: 1, constituicao: 1, inteligencia: 1, sabedoria: 1, carisma: 1 },\n  'escolhido-pelo-destino': { forca: 1, destreza: 1, constituicao: 1, inteligencia: 1, sabedoria: 1, carisma: 1 },\n  'andarilho-eterno': { inteligencia: 1 },\n  'coracao-de-dragao': { constituicao: 2 },\n  'mente-da-eternidade': { inteligencia: 2 },\n  'o-insone': {},\n  'o-generoso': { carisma: 1 },\n  'forjador-original': { carisma: 1 },\n  'lenda-do-povo': { carisma: 2 },\n  'colecionador-de-reliquias': { inteligencia: 1 },\n  'mestre-dos-herois': { carisma: 1 },\n  'mestre-dos-dados': { carisma: 2, sabedoria: 1 }\n  ,\n  'estrategista-das-cartas': { inteligencia: 1, carisma: 1 },\n  'mestre-do-rps': { destreza: 1, sabedoria: 1 }\n};\n\nexport function getTitleAttributeBonus(titleId?: string): Partial<HeroAttributes> {\n  if (!titleId) return {};\n  return TITLE_PASSIVE_ATTRIBUTE_BONUSES[titleId] || {};\n}\n\nexport function getRarityColor(rarity: Title['rarity']): string {\n  switch (rarity) {\n    case 'comum': return 'text-gray-400';\n    case 'raro': return 'text-blue-400';\n    case 'epico': return 'text-purple-400';\n    case 'lendario': return 'text-yellow-400';\n    case 'especial': return 'text-pink-400';\n    default: return 'text-gray-400';\n  }\n}\n\nexport function getRarityBg(rarity: Title['rarity']): string {\n  switch (rarity) {\n    case 'comum': return 'bg-gray-900/20';\n    case 'raro': return 'bg-blue-900/20';\n    case 'epico': return 'bg-purple-900/20';\n    case 'lendario': return 'bg-yellow-900/20';\n    case 'especial': return 'bg-pink-900/20';\n    default: return 'bg-gray-900/20';\n  }\n}\n\nexport function scoreTitleForHero(title: Title, hero: Hero): number {\n  const rarityRank: Record<Title['rarity'], number> = { comum: 1, raro: 2, epico: 3, lendario: 4, especial: 5 } as const;\n  const bonus = getTitleAttributeBonus(title.id);\n  const bonusSum = Object.values(bonus).reduce((acc, v) => acc + (typeof v === 'number' ? v : 0), 0);\n  const recentBoost = Date.now() - new Date(title.unlockedAt).getTime() < 24 * 60 * 60 * 1000 ? 1 : 0;\n  return (rarityRank[title.rarity] || 0) * 10 + bonusSum * 2 + recentBoost;\n}\n\nexport function getTopTitlesForHero(hero: Hero, topN: number): Title[] {\n  return [...(hero.titles || [])]\n    .map(t => ({ t, s: scoreTitleForHero(t, hero) }))\n    .sort((a, b) => b.s - a.s)\n    .slice(0, Math.max(0, topN))\n    .map(x => x.t);\n}\n\nexport function getRecommendedTitleByClass(hero: Hero): Title | undefined {\n  const weights: Record<string, Partial<HeroAttributes>> = {\n    guerreiro: { forca: 1, constituicao: 0.8 },\n    mago: { inteligencia: 1, sabedoria: 0.8 },\n    ladino: { destreza: 1, carisma: 0.6 },\n    clerigo: { sabedoria: 1, carisma: 0.6 },\n    patrulheiro: { destreza: 1, sabedoria: 0.6 },\n    paladino: { forca: 1, carisma: 0.8 },\n    arqueiro: { destreza: 1, inteligencia: 0.6 },\n    bardo: { carisma: 1, sabedoria: 0.6 },\n    monge: { destreza: 1, sabedoria: 0.6 },\n    assassino: { destreza: 1, forca: 0.6 },\n    barbaro: { forca: 1, constituicao: 0.8 },\n    lanceiro: { destreza: 1, forca: 0.8 },\n    druida: { sabedoria: 1, inteligencia: 0.6 },\n    feiticeiro: { inteligencia: 1, carisma: 0.6 },\n  };\n  const w = weights[String(hero.class)] || {};\n  let best: { t: Title; s: number } | null = null;\n  for (const t of hero.titles || []) {\n    const bonus = getTitleAttributeBonus(t.id);\n    const s = Object.entries(w).reduce((acc, [attr, weight]) => {\n      const val = (bonus as any)[attr] || 0;\n      return acc + (Number(weight) * Number(val));\n    }, 0);\n    if (!best || s > best.s) best = { t, s };\n  }\n  return best?.t;\n}\n","import { OnboardingFlow, OnboardingStep } from '../types/onboarding';\n\nexport const ONBOARDING_FLOWS: OnboardingFlow[] = [\n  {\n    id: 'first-steps',\n    name: 'Primeiros Passos',\n    description: 'Aprenda o bsico do HeroForge',\n    category: 'beginner',\n    steps: [\n      {\n        id: 'welcome',\n        title: 'Bem-vindo ao HeroForge! ',\n        description: 'Vamos comear sua jornada pica!',\n        content: 'O HeroForge  um sistema de gamificao que transforma suas tarefas dirias em aventuras picas. Voc criar heris, completar misses e evoluir suas habilidades!',\n        position: 'center',\n        skippable: true,\n        autoAdvance: false\n      },\n      {\n        id: 'create-hero',\n        title: 'Crie seu Primeiro Heri',\n        description: 'Todo aventureiro precisa de um heri!',\n        content: 'Clique no boto \"Criar Heri\" para comear. Escolha um nome pico e uma classe que combine com voc!',\n        targetElement: '[data-testid=\"create-hero-button\"]',\n        position: 'bottom',\n        action: {\n          type: 'navigate',\n          target: '/create'\n        },\n        validation: {\n          type: 'hero-created'\n        },\n        rewards: {\n          xp: 50,\n          gold: 100\n        }\n      },\n      {\n        id: 'view-gallery',\n        title: 'Ver Galeria',\n        description: 'Veja e edite seus heris',\n        content: 'Abra a Galeria para visualizar e personalizar seus heris e avatares.',\n        targetElement: '[data-testid=\"open-gallery-button\"]',\n        position: 'bottom',\n        action: { type: 'navigate', target: '/gallery' }\n      },\n      {\n        id: 'first-quest',\n        title: 'Sua Primeira Misso',\n        description: 'Hora de comear a aventura!',\n        content: 'Abra o Quadro de Misses e aceite sua primeira misso.',\n        targetElement: '[data-testid=\"open-quests-button\"]',\n        position: 'top',\n        action: { type: 'navigate', target: '/quests' }\n      },\n      {\n        id: 'accept-quest',\n        title: 'Aceite uma Misso',\n        description: 'Escolha uma misso adequada ao seu nvel',\n        content: 'Procure por misses elegveis e aceite uma para comear a jogar.',\n        position: 'left',\n        validation: { type: 'quest-accepted' },\n        rewards: { xp: 25 }\n      },\n      {\n        id: 'evolution-panel',\n        title: 'Evolua seu Heri',\n        description: 'Acompanhe nveis e ranks',\n        content: 'Acesse o painel de evoluo para ver seu progresso e conquistas.',\n        targetElement: '[data-testid=\"open-evolution-button\"]',\n        position: 'bottom',\n        action: { type: 'navigate', target: '/evolution' }\n      },\n      {\n        id: 'tutorial-complete',\n        title: 'Tutorial Concludo! ',\n        description: 'Voc est pronto para a aventura!',\n        content: 'Parabns! Voc aprendeu o bsico do HeroForge. Continue completando misses, evoluindo seu heri e desbloqueando novos recursos!',\n        position: 'center',\n        rewards: {\n          xp: 100,\n          gold: 200,\n          items: ['potion_health', 'scroll_wisdom']\n        }\n      }\n    ]\n  },\n  {\n    id: 'advanced-features',\n    name: 'Recursos Avanados',\n    description: 'Explore funcionalidades avanadas',\n    category: 'intermediate',\n    prerequisites: ['first-steps'],\n    steps: [\n      {\n        id: 'guild-system',\n        title: 'Guilda dos Aventureiros',\n        description: 'Una-se a outros heris!',\n        content: 'A Guilda dos Aventureiros  o hub para colaborar e competir em rankings especiais.',\n        position: 'top',\n        action: { type: 'navigate', target: '/guild-hub' }\n      },\n      {\n        id: 'equipment-system',\n        title: 'Sistema de Equipamentos',\n        description: 'Melhore suas estatsticas!',\n        content: 'Visite a loja para comprar armas, armaduras e acessrios. Equipamentos melhoram suas estatsticas e eficincia em misses.',\n        position: 'right',\n        action: { type: 'navigate', target: '/shop' }\n      },\n      {\n        id: 'achievements',\n        title: 'Sistema de Conquistas',\n        description: 'Desbloqueie ttulos especiais!',\n        content: 'Complete desafios especficos para ganhar conquistas e ttulos nicos. Alguns ttulos oferecem bnus permanentes!',\n        position: 'bottom',\n        action: { type: 'navigate', target: '/titles' }\n      },\n      {\n        id: 'leaderboards',\n        title: 'Rankings Globais',\n        description: 'Compete com outros heris!',\n        content: 'Veja como voc se compara a outros jogadores em diferentes categorias: XP, ouro, misses completadas e muito mais!',\n        position: 'top',\n        action: { type: 'navigate', target: '/leaderboards' }\n      }\n    ]\n  },\n  {\n    id: 'power-user',\n    name: 'Usurio Avanado',\n    description: 'Domine todas as funcionalidades',\n    category: 'advanced',\n    prerequisites: ['first-steps', 'advanced-features'],\n    steps: [\n      {\n        id: 'narrative-quests',\n        title: 'Misses Narrativas',\n        description: 'Experincias imersivas!',\n        content: 'As misses narrativas oferecem histrias envolventes com mltiplas escolhas e consequncias. Cada deciso afeta o resultado!',\n        targetElement: '[data-testid=\"narrative-quests-tab\"]',\n        position: 'bottom'\n      },\n      {\n        id: 'reputation-system',\n        title: 'Sistema de Reputao',\n        description: 'Construa relacionamentos!',\n        content: 'Sua reputao com diferentes faces afeta as misses disponveis e recompensas. Escolha suas alianas sabiamente!',\n        targetElement: '[data-testid=\"reputation-tab\"]',\n        position: 'right'\n      },\n      {\n        id: 'advanced-strategies',\n        title: 'Estratgias Avanadas',\n        description: 'Otimize sua progresso!',\n        content: 'Combine equipamentos, planeje suas misses dirias e use consumveis estrategicamente para maximizar seus ganhos!',\n        position: 'center'\n      }\n    ]\n  }\n  ,\n  {\n    id: 'unlock-hunting-basic',\n    name: 'Misses de Caa Bsicas',\n    description: 'Introduo s misses de caa',\n    category: 'beginner',\n    steps: [\n      { id: 'go-hunting', title: 'Nova funcionalidade desbloqueada!', description: 'Misses de caa bsicas disponveis', content: 'Abra o painel de Caa para aceitar sua primeira misso bsica.', action: { type: 'navigate', target: '/hunting' } }\n    ]\n  },\n  {\n    id: 'unlock-shop-basic',\n    name: 'Loja de Equipamentos Bsicos',\n    description: 'Aprenda a comprar e equipar itens',\n    category: 'beginner',\n    steps: [\n      { id: 'go-shop', title: 'Loja desbloqueada!', description: 'Acesse a loja bsica', content: 'Visite a loja para comprar equipamentos iniciais.', action: { type: 'navigate', target: '/shop' } }\n    ]\n  },\n  {\n    id: 'unlock-crafting-simple',\n    name: 'Craft Simples',\n    description: 'Como criar itens bsicos',\n    category: 'beginner',\n    steps: [\n      { id: 'go-forge', title: 'Craft desbloqueado!', description: 'Acesse a forja', content: 'Abra a forja para ver receitas simples e criar um item.', action: { type: 'navigate', target: '/hero-forge' } }\n    ]\n  }\n];\n\nexport class OnboardingManager {\n  private static instance: OnboardingManager;\n  private currentFlow?: OnboardingFlow;\n  private currentStepIndex: number = 0;\n  private completedFlows: Set<string> = new Set();\n  private completedSteps: Set<string> = new Set();\n  private isActive: boolean = false;\n  private callbacks: Map<string, Function[]> = new Map();\n  private validatedSteps: Set<string> = new Set();\n\n  static getInstance(): OnboardingManager {\n    if (!OnboardingManager.instance) {\n      OnboardingManager.instance = new OnboardingManager();\n    }\n    return OnboardingManager.instance;\n  }\n\n  startFlow(flowId: string): boolean {\n    const flow = ONBOARDING_FLOWS.find(f => f.id === flowId);\n    if (!flow) return false;\n\n    // Check prerequisites\n    if (flow.prerequisites) {\n      const hasPrerequisites = flow.prerequisites.every(prereq => \n        this.completedFlows.has(prereq)\n      );\n      if (!hasPrerequisites) return false;\n    }\n\n    this.currentFlow = flow;\n    this.currentStepIndex = 0;\n    this.isActive = true;\n    this.emit('flow-started', { flow });\n    this.emit('step-changed', { step: this.getCurrentStep() });\n    this.saveState();\n    return true;\n  }\n\n  getCurrentStep(): OnboardingStep | null {\n    if (!this.currentFlow || !this.isActive) return null;\n    return this.currentFlow.steps[this.currentStepIndex] || null;\n  }\n\n  nextStep(): boolean {\n    if (!this.currentFlow || !this.isActive) return false;\n\n    const currentStep = this.getCurrentStep();\n    if (currentStep) {\n      if (currentStep.validation) {\n        const ok = this.isStepValidated(currentStep.id);\n        if (!ok) {\n          this.emit('validation-required', { step: currentStep });\n          return false;\n        }\n      }\n      this.markStepCompleted(currentStep.id);\n      this.emit('step-completed', { step: currentStep });\n    }\n\n    this.currentStepIndex++;\n    \n    if (this.currentStepIndex >= this.currentFlow.steps.length) {\n      this.completeFlow();\n      return false;\n    }\n\n    this.emit('step-changed', { step: this.getCurrentStep() });\n    this.saveState();\n    return true;\n  }\n\n  previousStep(): boolean {\n    if (!this.currentFlow || !this.isActive || this.currentStepIndex <= 0) return false;\n    \n    this.currentStepIndex--;\n    this.emit('step-changed', { step: this.getCurrentStep() });\n    this.saveState();\n    return true;\n  }\n\n  skipStep(): boolean {\n    const currentStep = this.getCurrentStep();\n    if (!currentStep || !currentStep.skippable) return false;\n    \n    const moved = this.nextStep();\n    if (moved) this.saveState();\n    return moved;\n  }\n\n  completeFlow(): void {\n    if (!this.currentFlow) return;\n\n    this.completedFlows.add(this.currentFlow.id);\n    this.emit('flow-completed', { flow: this.currentFlow });\n    this.reset();\n    this.saveState();\n  }\n\n  reset(): void {\n    this.currentFlow = undefined;\n    this.currentStepIndex = 0;\n    this.isActive = false;\n    this.emit('onboarding-reset');\n    this.saveState();\n  }\n\n  markStepCompleted(stepId: string): void {\n    this.completedSteps.add(stepId);\n    this.saveState();\n  }\n\n  isStepCompleted(stepId: string): boolean {\n    return this.completedSteps.has(stepId);\n  }\n\n  markStepValidated(stepId: string): void {\n    this.validatedSteps.add(stepId);\n    this.emit('step-validated', { stepId });\n    this.saveState();\n  }\n\n  isStepValidated(stepId: string): boolean {\n    return this.validatedSteps.has(stepId);\n  }\n\n  isFlowCompleted(flowId: string): boolean {\n    return this.completedFlows.has(flowId);\n  }\n\n  getAvailableFlows(): OnboardingFlow[] {\n    return ONBOARDING_FLOWS.filter(flow => {\n      if (this.isFlowCompleted(flow.id)) return false;\n      \n      if (flow.prerequisites) {\n        return flow.prerequisites.every(prereq => this.isFlowCompleted(prereq));\n      }\n      \n      return true;\n    });\n  }\n\n  getProgress(): { completed: number; total: number; percentage: number } {\n    const totalSteps = ONBOARDING_FLOWS.reduce((sum, flow) => sum + flow.steps.length, 0);\n    const completedSteps = this.completedSteps.size;\n    \n    return {\n      completed: completedSteps,\n      total: totalSteps,\n      percentage: totalSteps > 0 ? Math.round((completedSteps / totalSteps) * 100) : 0\n    };\n  }\n\n  // Event system\n  on(event: string, callback: Function): void {\n    if (!this.callbacks.has(event)) {\n      this.callbacks.set(event, []);\n    }\n    this.callbacks.get(event)!.push(callback);\n  }\n\n  off(event: string, callback: Function): void {\n    const callbacks = this.callbacks.get(event);\n    if (callbacks) {\n      const index = callbacks.indexOf(callback);\n      if (index > -1) {\n        callbacks.splice(index, 1);\n      }\n    }\n  }\n\n  private emit(event: string, data?: any): void {\n    const callbacks = this.callbacks.get(event);\n    if (callbacks) {\n      callbacks.forEach(callback => callback(data));\n    }\n  }\n\n  // Persistence\n  saveState(): void {\n    const state = {\n      completedFlows: Array.from(this.completedFlows),\n      completedSteps: Array.from(this.completedSteps),\n      validatedSteps: Array.from(this.validatedSteps),\n      currentFlow: this.currentFlow?.id,\n      currentStepIndex: this.currentStepIndex,\n      isActive: this.isActive\n    };\n    localStorage.setItem('heroforge-onboarding', JSON.stringify(state));\n  }\n\n  loadState(): void {\n    const saved = localStorage.getItem('heroforge-onboarding');\n    if (saved) {\n      try {\n        const state = JSON.parse(saved);\n        this.completedFlows = new Set(state.completedFlows || []);\n        this.completedSteps = new Set(state.completedSteps || []);\n        this.validatedSteps = new Set(state.validatedSteps || []);\n        this.currentStepIndex = state.currentStepIndex || 0;\n        this.isActive = state.isActive || false;\n        \n        if (state.currentFlow && this.isActive) {\n          this.currentFlow = ONBOARDING_FLOWS.find(f => f.id === state.currentFlow);\n        }\n      } catch (error) {\n        console.error('Failed to load onboarding state:', error);\n      }\n    }\n  }\n}\n\nexport const onboardingManager = OnboardingManager.getInstance();\n","import { GameEvent, EventProgress, EventRotation, EventReward } from '../types/events';\n\n// Event templates for rotation\nconst DAILY_EVENT_TEMPLATES: Omit<GameEvent, 'id' | 'startDate' | 'endDate' | 'isActive' | 'currentProgress'>[] = [\n  {\n    name: 'Caador de XP',\n    description: 'Ganhe experincia completando tarefas',\n    type: 'daily',\n    objective: 'Ganhar {target} pontos de experincia',\n    targetValue: 500,\n    progressType: 'xp-gained',\n    rewards: [\n      { type: 'gold', amount: 100 },\n      { type: 'xp', amount: 50 }\n    ],\n    icon: '',\n    color: 'from-yellow-400 to-orange-500',\n    rarity: 'common'\n  },\n  {\n    name: 'Completador de Misses',\n    description: 'Complete misses para ganhar recompensas',\n    type: 'daily',\n    objective: 'Completar {target} misses',\n    targetValue: 3,\n    progressType: 'quests-completed',\n    rewards: [\n      { type: 'gold', amount: 150 },\n      { type: 'xp', amount: 100 }\n    ],\n    icon: '',\n    color: 'from-blue-400 to-blue-600',\n    rarity: 'common'\n  },\n  {\n    name: 'Coletor de Ouro',\n    description: 'Acumule ouro atravs de suas aventuras',\n    type: 'daily',\n    objective: 'Ganhar {target} moedas de ouro',\n    targetValue: 300,\n    progressType: 'gold-earned',\n    rewards: [\n      { type: 'xp', amount: 200 },\n      { type: 'gold', amount: 50 }\n    ],\n    icon: '',\n    color: 'from-yellow-500 to-yellow-600',\n    rarity: 'common'\n  },\n  {\n    name: 'Ascenso Heroica',\n    description: 'Evolua seu heri subindo de nvel',\n    type: 'daily',\n    objective: 'Subir {target} nvel(is)',\n    targetValue: 1,\n    progressType: 'levels-gained',\n    rewards: [\n      { type: 'gold', amount: 300 },\n      { type: 'xp', amount: 150 },\n      { type: 'title', titleId: 'level-master' }\n    ],\n    icon: '',\n    color: 'from-purple-400 to-purple-600',\n    rarity: 'rare'\n  }\n];\n\nconst WEEKLY_EVENT_TEMPLATES: Omit<GameEvent, 'id' | 'startDate' | 'endDate' | 'isActive' | 'currentProgress'>[] = [\n  {\n    name: 'Maratona Semanal',\n    description: 'Uma semana intensa de aventuras',\n    type: 'weekly',\n    objective: 'Ganhar {target} pontos de experincia',\n    targetValue: 2500,\n    progressType: 'xp-gained',\n    rewards: [\n      { type: 'gold', amount: 500 },\n      { type: 'xp', amount: 300 },\n      { type: 'title', titleId: 'weekly-champion' }\n    ],\n    icon: '',\n    color: 'from-green-400 to-green-600',\n    rarity: 'epic'\n  },\n  {\n    name: 'Mestre das Misses',\n    description: 'Domine a arte de completar misses',\n    type: 'weekly',\n    objective: 'Completar {target} misses',\n    targetValue: 15,\n    progressType: 'quests-completed',\n    rewards: [\n      { type: 'gold', amount: 750 },\n      { type: 'xp', amount: 400 },\n      { type: 'title', titleId: 'quest-master' }\n    ],\n    icon: '',\n    color: 'from-red-400 to-red-600',\n    rarity: 'epic'\n  },\n  {\n    name: 'Fortuna Dourada',\n    description: 'Acumule uma fortuna em ouro',\n    type: 'weekly',\n    objective: 'Ganhar {target} moedas de ouro',\n    targetValue: 1500,\n    progressType: 'gold-earned',\n    rewards: [\n      { type: 'gold', amount: 1000 },\n      { type: 'xp', amount: 500 },\n      { type: 'title', titleId: 'gold-collector' }\n    ],\n    icon: '',\n    color: 'from-yellow-400 to-yellow-600',\n    rarity: 'legendary'\n  }\n];\n\nexport class EventManager {\n  private static instance: EventManager;\n  private events: GameEvent[] = [];\n  private eventProgress: EventProgress[] = [];\n  private rotation: EventRotation;\n\n  private constructor() {\n    this.rotation = this.initializeRotation();\n    this.loadState();\n  }\n\n  static getInstance(): EventManager {\n    if (!EventManager.instance) {\n      EventManager.instance = new EventManager();\n    }\n    return EventManager.instance;\n  }\n\n  private initializeRotation(): EventRotation {\n    const now = new Date();\n    const nextDaily = new Date(now);\n    nextDaily.setDate(nextDaily.getDate() + 1);\n    nextDaily.setHours(0, 0, 0, 0);\n\n    const nextWeekly = new Date(now);\n    nextWeekly.setDate(nextWeekly.getDate() + (7 - nextWeekly.getDay()));\n    nextWeekly.setHours(0, 0, 0, 0);\n\n    return {\n      dailyEvents: [],\n      weeklyEvents: [],\n      specialEvents: [],\n      lastRotation: now,\n      nextRotation: nextDaily\n    };\n  }\n\n  generateDailyEvents(): GameEvent[] {\n    const now = new Date();\n    const endOfDay = new Date(now);\n    endOfDay.setHours(23, 59, 59, 999);\n\n    // Select 2-3 random daily events\n    const selectedTemplates = this.shuffleArray([...DAILY_EVENT_TEMPLATES]).slice(0, Math.floor(Math.random() * 2) + 2);\n\n    return selectedTemplates.map((template, index) => ({\n      ...template,\n      id: `daily-${now.getTime()}-${index}`,\n      startDate: now,\n      endDate: endOfDay,\n      isActive: true,\n      currentProgress: 0,\n      objective: template.objective.replace('{target}', template.targetValue.toString())\n    }));\n  }\n\n  generateWeeklyEvents(): GameEvent[] {\n    const now = new Date();\n    const endOfWeek = new Date(now);\n    endOfWeek.setDate(endOfWeek.getDate() + (7 - endOfWeek.getDay()));\n    endOfWeek.setHours(23, 59, 59, 999);\n\n    // Select 1-2 weekly events\n    const selectedTemplates = this.shuffleArray([...WEEKLY_EVENT_TEMPLATES]).slice(0, Math.floor(Math.random() * 2) + 1);\n\n    return selectedTemplates.map((template, index) => ({\n      ...template,\n      id: `weekly-${now.getTime()}-${index}`,\n      startDate: now,\n      endDate: endOfWeek,\n      isActive: true,\n      currentProgress: 0,\n      objective: template.objective.replace('{target}', template.targetValue.toString())\n    }));\n  }\n\n  private shuffleArray<T>(array: T[]): T[] {\n    const shuffled = [...array];\n    for (let i = shuffled.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n    }\n    return shuffled;\n  }\n\n  checkAndRotateEvents(): void {\n    const now = new Date();\n    \n    // Check if we need to rotate daily events\n    if (now >= this.rotation.nextRotation) {\n      this.rotateDailyEvents();\n    }\n\n    // Check if we need to rotate weekly events (every Sunday)\n    if (now.getDay() === 0 && this.rotation.weeklyEvents.length === 0) {\n      this.rotateWeeklyEvents();\n    }\n\n    // Remove expired events\n    this.events = this.events.filter(event => event.endDate > now);\n  }\n\n  private rotateDailyEvents(): void {\n    // Arquivo de eventos dirios no  utilizado; removido para evitar variveis no usadas\n    \n    // Generate new daily events\n    const newDailyEvents = this.generateDailyEvents();\n    \n    // Update events list\n    this.events = this.events.filter(e => e.type !== 'daily');\n    this.events.push(...newDailyEvents);\n\n    // Update rotation\n    const nextRotation = new Date();\n    nextRotation.setDate(nextRotation.getDate() + 1);\n    nextRotation.setHours(0, 0, 0, 0);\n    \n    this.rotation.dailyEvents = newDailyEvents;\n    this.rotation.lastRotation = new Date();\n    this.rotation.nextRotation = nextRotation;\n\n    this.saveState();\n  }\n\n  private rotateWeeklyEvents(): void {\n    // Generate new weekly events\n    const newWeeklyEvents = this.generateWeeklyEvents();\n    \n    // Update events list\n    this.events = this.events.filter(e => e.type !== 'weekly');\n    this.events.push(...newWeeklyEvents);\n\n    // Update rotation\n    this.rotation.weeklyEvents = newWeeklyEvents;\n    this.saveState();\n  }\n\n  getActiveEvents(): GameEvent[] {\n    this.checkAndRotateEvents();\n    return this.events.filter(event => event.isActive && event.endDate > new Date());\n  }\n\n  updateEventProgress(heroId: string, progressType: string, amount: number = 1): void {\n    const activeEvents = this.getActiveEvents().filter(event => event.progressType === progressType);\n\n    activeEvents.forEach(event => {\n      let progress = this.eventProgress.find(p => p.eventId === event.id && p.heroId === heroId);\n      \n      if (!progress) {\n        progress = {\n          eventId: event.id,\n          heroId: heroId,\n          progress: 0,\n          completed: false,\n          rewardsClaimed: false,\n          startedAt: new Date()\n        };\n        this.eventProgress.push(progress);\n      }\n\n      if (!progress.completed) {\n        progress.progress = Math.min(progress.progress + amount, event.targetValue);\n        \n        if (progress.progress >= event.targetValue) {\n          progress.completed = true;\n          progress.completedAt = new Date();\n        }\n      }\n    });\n\n    this.saveState();\n  }\n\n  claimEventRewards(heroId: string, eventId: string): EventReward[] | null {\n    const progress = this.eventProgress.find(p => p.eventId === eventId && p.heroId === heroId);\n    const event = this.events.find(e => e.id === eventId);\n\n    if (!progress || !event || !progress.completed || progress.rewardsClaimed) {\n      return null;\n    }\n\n    progress.rewardsClaimed = true;\n    this.saveState();\n\n    return event.rewards;\n  }\n\n  getEventProgress(heroId: string): EventProgress[] {\n    return this.eventProgress.filter(p => p.heroId === heroId);\n  }\n\n  getTimeUntilNextRotation(): { hours: number; minutes: number } {\n    const now = new Date();\n    const diff = this.rotation.nextRotation.getTime() - now.getTime();\n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n    \n    return { hours, minutes };\n  }\n\n  private saveState(): void {\n    const state = {\n      events: this.events,\n      eventProgress: this.eventProgress,\n      rotation: this.rotation\n    };\n    localStorage.setItem('heroforge-events', JSON.stringify(state));\n  }\n\n  private loadState(): void {\n    const saved = localStorage.getItem('heroforge-events');\n    if (saved) {\n      try {\n        const state = JSON.parse(saved);\n        this.events = state.events?.map((e: any) => ({\n          ...e,\n          startDate: new Date(e.startDate),\n          endDate: new Date(e.endDate)\n        })) || [];\n        this.eventProgress = state.eventProgress?.map((p: any) => ({\n          ...p,\n          startedAt: new Date(p.startedAt),\n          completedAt: p.completedAt ? new Date(p.completedAt) : undefined\n        })) || [];\n        this.rotation = state.rotation ? {\n          ...state.rotation,\n          lastRotation: new Date(state.rotation.lastRotation),\n          nextRotation: new Date(state.rotation.nextRotation)\n        } : this.initializeRotation();\n      } catch (error) {\n        console.error('Error loading event state:', error);\n        this.initializeEvents();\n      }\n    } else {\n      this.initializeEvents();\n    }\n  }\n\n  private initializeEvents(): void {\n    // Generate initial events if none exist\n    if (this.events.length === 0) {\n      const dailyEvents = this.generateDailyEvents();\n      const weeklyEvents = this.generateWeeklyEvents();\n      \n      this.events = [...dailyEvents, ...weeklyEvents];\n      this.rotation.dailyEvents = dailyEvents;\n      this.rotation.weeklyEvents = weeklyEvents;\n      \n      this.saveState();\n    }\n  }\n}\n\nexport const eventManager = EventManager.getInstance();\n","import { \n  GameplayMetric, \n  MetricEventType, \n  SessionMetrics, \n  EngagementMetrics, \n  GameplayAnalytics, \n  PerformanceMetrics,\n  KPIDashboard,\n  AlertRule,\n  MetricAlert\n} from '../types/metrics';\n\nexport class MetricsManager {\n  private static instance: MetricsManager;\n  private metrics: GameplayMetric[] = [];\n  private sessions: SessionMetrics[] = [];\n  private currentSession: SessionMetrics | null = null;\n  private alertRules: AlertRule[] = [];\n  private alerts: MetricAlert[] = [];\n  private maxMetrics = 10000; // Limite para performance\n\n  private constructor() {\n    this.loadMetrics();\n    this.initializeSession();\n    this.setupPerformanceMonitoring();\n  }\n\n  static getInstance(): MetricsManager {\n    if (!MetricsManager.instance) {\n      MetricsManager.instance = new MetricsManager();\n    }\n    return MetricsManager.instance;\n  }\n\n  // === COLETA DE MTRICAS ===\n\n  // Registrar evento de gameplay\n  trackEvent(\n    eventType: MetricEventType,\n    heroId: string,\n    data: Record<string, any> = {}\n  ): void {\n    const metric: GameplayMetric = {\n      id: `metric-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      timestamp: new Date(),\n      heroId,\n      eventType,\n      data,\n      sessionId: this.currentSession?.sessionId || 'unknown',\n      userId: this.getUserId()\n    };\n\n    this.metrics.unshift(metric);\n\n    // Manter apenas as mtricas mais recentes\n    if (this.metrics.length > this.maxMetrics) {\n      this.metrics = this.metrics.slice(0, this.maxMetrics);\n    }\n\n    // Atualizar sesso atual\n    if (this.currentSession) {\n      this.updateCurrentSession(eventType, data);\n    }\n\n    // Verificar alertas\n    this.checkAlerts(metric);\n\n    this.saveMetrics();\n\n    try {\n      const g = (window as any).gtag\n      if (g && import.meta.env.PROD) {\n        const map: Record<MetricEventType, string> = {\n          'purchase-initiated': 'begin_checkout',\n          'purchase-completed': 'purchase',\n          'ad-impression': 'ad_impression',\n          'ad-click': 'ad_click',\n          'rewarded-ad-completed': 'earn_virtual_currency',\n          'page-visited': 'page_view',\n          'hero-created': 'hero_created',\n          'level-up': 'level_up',\n          'xp-gained': 'xp_gained',\n          'gold-gained': 'gold_gained',\n          'attribute-increased': 'attribute_increased',\n          'quest-started': 'quest_started',\n          'quest-completed': 'quest_completed',\n          'quest-failed': 'quest_failed',\n          'epic-quest-completed': 'epic_quest_completed',\n          'combat-started': 'combat_started',\n          'combat-won': 'combat_won',\n          'combat-lost': 'combat_lost',\n          'enemy-defeated': 'enemy_defeated',\n          'achievement-unlocked': 'achievement_unlocked',\n          'title-earned': 'title_earned',\n          'daily-goal-completed': 'daily_goal_completed',\n          'event-completed': 'event_completed',\n          'item-acquired': 'item_acquired',\n          'item-used': 'item_used',\n          'session-started': 'session_started',\n          'session-ended': 'session_ended',\n          'feature-used': 'feature_used',\n          'tutorial-started': 'tutorial_started',\n          'tutorial-completed': 'tutorial_completed',\n          'onboarding-completed': 'onboarding_completed',\n          'activity-liked': 'activity_liked',\n          'activity-commented': 'activity_commented',\n          'activity-shared': 'activity_shared',\n          'guild-joined': 'guild_joined',\n          'guild-left': 'guild_left'\n        }\n        const name = map[eventType]\n        if (name) {\n          const params: Record<string, any> = { hero_id: heroId, session_id: metric.sessionId, user_id: metric.userId, ...data }\n          if (eventType === 'purchase-completed') {\n            params.transaction_id = data.receiptId || `txn-${Date.now()}`\n            params.items = [{ item_id: data.productId }]\n          }\n          g('event', name, params)\n        }\n      }\n    } catch {}\n  }\n\n  // Inicializar sesso\n  private initializeSession(): void {\n    this.currentSession = {\n      sessionId: `session-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      startTime: new Date(),\n      pagesVisited: [window.location.pathname],\n      actionsPerformed: 0,\n      questsCompleted: 0,\n      xpGained: 0,\n      goldGained: 0,\n      achievementsUnlocked: 0\n    };\n\n    this.trackEvent('session-started', 'system', {\n      userAgent: navigator.userAgent,\n      screenResolution: `${screen.width}x${screen.height}`,\n      language: navigator.language\n    });\n  }\n\n  // Finalizar sesso\n  endSession(): void {\n    if (!this.currentSession) return;\n\n    const endTime = new Date();\n    const duration = Math.floor((endTime.getTime() - this.currentSession.startTime.getTime()) / 1000);\n\n    this.currentSession.endTime = endTime;\n    this.currentSession.duration = duration;\n\n    this.sessions.unshift(this.currentSession);\n    \n    // Manter apenas as 1000 sesses mais recentes\n    if (this.sessions.length > 1000) {\n      this.sessions = this.sessions.slice(0, 1000);\n    }\n\n    this.trackEvent('session-ended', 'system', {\n      duration,\n      actionsPerformed: this.currentSession.actionsPerformed,\n      pagesVisited: this.currentSession.pagesVisited.length\n    });\n\n    this.saveSessions();\n    this.currentSession = null;\n  }\n\n  // Atualizar sesso atual\n  private updateCurrentSession(eventType: MetricEventType, data: Record<string, any>): void {\n    if (!this.currentSession) return;\n\n    this.currentSession.actionsPerformed++;\n\n    switch (eventType) {\n      case 'quest-completed':\n        this.currentSession.questsCompleted++;\n        break;\n      case 'xp-gained':\n        this.currentSession.xpGained += data.amount || 0;\n        break;\n      case 'gold-gained':\n        this.currentSession.goldGained += data.amount || 0;\n        break;\n      case 'achievement-unlocked':\n        this.currentSession.achievementsUnlocked++;\n        break;\n      case 'page-visited':\n        if (!this.currentSession.pagesVisited.includes(data.page)) {\n          this.currentSession.pagesVisited.push(data.page);\n        }\n        break;\n    }\n  }\n\n  // === ANALYTICS E RELATRIOS ===\n\n  // Obter mtricas de engajamento\n  getEngagementMetrics(days: number = 30): EngagementMetrics {\n    const now = new Date();\n    const cutoffDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n    \n    const recentSessions = this.sessions.filter(s => s.startTime >= cutoffDate);\n    \n    const dailyUsers = this.getUniqueUsersInPeriod(1);\n    const weeklyUsers = this.getUniqueUsersInPeriod(7);\n    const monthlyUsers = this.getUniqueUsersInPeriod(30);\n\n    const totalDuration = recentSessions.reduce((sum, s) => sum + (s.duration || 0), 0);\n    const averageSessionDuration = recentSessions.length > 0 ? totalDuration / recentSessions.length : 0;\n\n    const totalActions = recentSessions.reduce((sum, s) => sum + s.actionsPerformed, 0);\n    const averageActionsPerSession = recentSessions.length > 0 ? totalActions / recentSessions.length : 0;\n\n    return {\n      dailyActiveUsers: dailyUsers,\n      weeklyActiveUsers: weeklyUsers,\n      monthlyActiveUsers: monthlyUsers,\n      averageSessionDuration,\n      averageActionsPerSession,\n      retentionRate: this.calculateRetentionRates(),\n      churnRate: this.calculateChurnRate()\n    };\n  }\n\n  // Obter analytics de gameplay\n  getGameplayAnalytics(): GameplayAnalytics {\n    const heroCreationEvents = this.metrics.filter(m => m.eventType === 'hero-created');\n    const questEvents = this.metrics.filter(m => m.eventType === 'quest-completed');\n    const xpEvents = this.metrics.filter(m => m.eventType === 'xp-gained');\n    const goldEvents = this.metrics.filter(m => m.eventType === 'gold-gained');\n\n    // Calcular classe mais popular\n    const classCount: Record<string, number> = {};\n    heroCreationEvents.forEach(event => {\n      const heroClass = event.data.class;\n      classCount[heroClass] = (classCount[heroClass] || 0) + 1;\n    });\n    const mostPopularClass = Object.entries(classCount)\n      .sort(([,a], [,b]) => b - a)[0]?.[0] || 'Nenhuma';\n\n    // Calcular misso mais completada\n    const questCount: Record<string, number> = {};\n    questEvents.forEach(event => {\n      const questName = event.data.questName;\n      questCount[questName] = (questCount[questName] || 0) + 1;\n    });\n    const mostCompletedQuest = Object.entries(questCount)\n      .sort(([,a], [,b]) => b - a)[0]?.[0] || 'Nenhuma';\n\n    const totalXp = xpEvents.reduce((sum, e) => sum + (e.data.amount || 0), 0);\n    const totalGold = goldEvents.reduce((sum, e) => sum + (e.data.amount || 0), 0);\n\n    return {\n      totalHeroes: heroCreationEvents.length,\n      averageHeroLevel: this.calculateAverageHeroLevel(),\n      totalQuestsCompleted: questEvents.length,\n      totalXpGained: totalXp,\n      totalGoldEarned: totalGold,\n      mostPopularClass,\n      mostCompletedQuest,\n      averageSessionsPerUser: this.calculateAverageSessionsPerUser(),\n      conversionFunnels: this.calculateConversionFunnels()\n    };\n  }\n\n  // Obter mtricas de performance\n  getPerformanceMetrics(): PerformanceMetrics {\n    const performanceEntries = performance.getEntriesByType('navigation') as PerformanceNavigationTiming[];\n    const pageLoadTime = performanceEntries[0]?.loadEventEnd - performanceEntries[0]?.navigationStart || 0;\n\n    return {\n      pageLoadTime,\n      componentRenderTime: this.getAverageRenderTime(),\n      apiResponseTime: this.getAverageApiResponseTime(),\n      errorRate: this.calculateErrorRate(),\n      crashRate: this.calculateCrashRate(),\n      memoryUsage: this.getMemoryUsage()\n    };\n  }\n\n  // Obter dashboard completo de KPIs\n  getKPIDashboard(): KPIDashboard {\n    const engagement = this.getEngagementMetrics();\n    const gameplay = this.getGameplayAnalytics();\n    const performance = this.getPerformanceMetrics();\n\n    return {\n      overview: {\n        totalUsers: this.getTotalUsers(),\n        activeUsers: engagement.dailyActiveUsers,\n        totalSessions: this.sessions.length,\n        averageSessionDuration: engagement.averageSessionDuration\n      },\n      engagement,\n      gameplay,\n      performance,\n      trends: {\n        userGrowth: this.getUserGrowthTrend(),\n        engagementTrend: this.getEngagementTrend(),\n        gameplayTrend: this.getGameplayTrend()\n      }\n    };\n  }\n\n  // === FUNES AUXILIARES ===\n\n  private getUniqueUsersInPeriod(days: number): number {\n    const cutoffDate = new Date(Date.now() - days * 24 * 60 * 60 * 1000);\n    const recentSessions = this.sessions.filter(s => s.startTime >= cutoffDate);\n    return new Set(recentSessions.map(s => s.heroId).filter(Boolean)).size;\n  }\n\n  private calculateRetentionRates(): { day1: number; day7: number; day30: number } {\n    // Implementao simplificada - em produo seria mais complexa\n    const totalUsers = this.getTotalUsers();\n    if (totalUsers === 0) return { day1: 0, day7: 0, day30: 0 };\n\n    return {\n      day1: Math.min(this.getUniqueUsersInPeriod(1) / totalUsers, 1),\n      day7: Math.min(this.getUniqueUsersInPeriod(7) / totalUsers, 1),\n      day30: Math.min(this.getUniqueUsersInPeriod(30) / totalUsers, 1)\n    };\n  }\n\n  private calculateChurnRate(): number {\n    const activeUsers = this.getUniqueUsersInPeriod(30);\n    const totalUsers = this.getTotalUsers();\n    return totalUsers > 0 ? Math.max(0, (totalUsers - activeUsers) / totalUsers) : 0;\n  }\n\n  private calculateAverageHeroLevel(): number {\n    const levelUpEvents = this.metrics.filter(m => m.eventType === 'level-up');\n    if (levelUpEvents.length === 0) return 1;\n\n    const levels = levelUpEvents.map(e => e.data.newLevel || 1);\n    return levels.reduce((sum, level) => sum + level, 0) / levels.length;\n  }\n\n  private calculateAverageSessionsPerUser(): number {\n    const uniqueUsers = new Set(this.sessions.map(s => s.heroId).filter(Boolean));\n    return uniqueUsers.size > 0 ? this.sessions.length / uniqueUsers.size : 0;\n  }\n\n  private calculateConversionFunnels(): any {\n    const heroCreated = this.metrics.filter(m => m.eventType === 'hero-created').length;\n    const firstQuest = this.metrics.filter(m => m.eventType === 'quest-completed').length;\n    const firstLevelUp = this.metrics.filter(m => m.eventType === 'level-up').length;\n    const firstAchievement = this.metrics.filter(m => m.eventType === 'achievement-unlocked').length;\n\n    return {\n      heroCreation: heroCreated,\n      firstQuest: heroCreated > 0 ? firstQuest / heroCreated : 0,\n      firstLevelUp: heroCreated > 0 ? firstLevelUp / heroCreated : 0,\n      firstAchievement: heroCreated > 0 ? firstAchievement / heroCreated : 0,\n      retention7Days: this.getUniqueUsersInPeriod(7) / Math.max(heroCreated, 1)\n    };\n  }\n\n  private getTotalUsers(): number {\n    const allUsers = new Set(this.sessions.map(s => s.heroId).filter(Boolean));\n    return allUsers.size;\n  }\n\n  private getUserGrowthTrend(): Array<{ date: string; count: number }> {\n    const last30Days = Array.from({ length: 30 }, (_, i) => {\n      const date = new Date();\n      date.setDate(date.getDate() - (29 - i));\n      return date.toISOString().split('T')[0];\n    });\n\n    return last30Days.map(date => {\n      const dayStart = new Date(date);\n      const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);\n      \n      const newUsers = this.metrics.filter(m => \n        m.eventType === 'hero-created' &&\n        m.timestamp >= dayStart &&\n        m.timestamp < dayEnd\n      ).length;\n\n      return { date, count: newUsers };\n    });\n  }\n\n  private getEngagementTrend(): Array<{ date: string; sessions: number; duration: number }> {\n    const last30Days = Array.from({ length: 30 }, (_, i) => {\n      const date = new Date();\n      date.setDate(date.getDate() - (29 - i));\n      return date.toISOString().split('T')[0];\n    });\n\n    return last30Days.map(date => {\n      const dayStart = new Date(date);\n      const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);\n      \n      const daySessions = this.sessions.filter(s => \n        s.startTime >= dayStart && s.startTime < dayEnd\n      );\n\n      const totalDuration = daySessions.reduce((sum, s) => sum + (s.duration || 0), 0);\n      const avgDuration = daySessions.length > 0 ? totalDuration / daySessions.length : 0;\n\n      return { \n        date, \n        sessions: daySessions.length, \n        duration: avgDuration \n      };\n    });\n  }\n\n  private getGameplayTrend(): Array<{ date: string; quests: number; xp: number }> {\n    const last30Days = Array.from({ length: 30 }, (_, i) => {\n      const date = new Date();\n      date.setDate(date.getDate() - (29 - i));\n      return date.toISOString().split('T')[0];\n    });\n\n    return last30Days.map(date => {\n      const dayStart = new Date(date);\n      const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);\n      \n      const dayQuests = this.metrics.filter(m => \n        m.eventType === 'quest-completed' &&\n        m.timestamp >= dayStart &&\n        m.timestamp < dayEnd\n      ).length;\n\n      const dayXp = this.metrics.filter(m => \n        m.eventType === 'xp-gained' &&\n        m.timestamp >= dayStart &&\n        m.timestamp < dayEnd\n      ).reduce((sum, m) => sum + (m.data.amount || 0), 0);\n\n      return { date, quests: dayQuests, xp: dayXp };\n    });\n  }\n\n  // === PERFORMANCE MONITORING ===\n\n  private setupPerformanceMonitoring(): void {\n    // Monitor de erros\n    window.addEventListener('error', (event) => {\n      this.trackEvent('error-occurred', 'system', {\n        message: event.message,\n        filename: event.filename,\n        lineno: event.lineno,\n        colno: event.colno\n      });\n    });\n\n    // Monitor de promises rejeitadas\n    window.addEventListener('unhandledrejection', (event) => {\n      this.trackEvent('promise-rejection', 'system', {\n        reason: event.reason?.toString() || 'Unknown'\n      });\n    });\n\n    // Monitor de performance\n    if ('PerformanceObserver' in window) {\n      const observer = new PerformanceObserver((list) => {\n        list.getEntries().forEach((entry) => {\n          if (entry.entryType === 'measure') {\n            this.trackEvent('performance-measure', 'system', {\n              name: entry.name,\n              duration: entry.duration\n            });\n          }\n        });\n      });\n      observer.observe({ entryTypes: ['measure'] });\n    }\n  }\n\n  private getAverageRenderTime(): number {\n    const renderMetrics = this.metrics.filter(m => \n      m.eventType === 'performance-measure' && \n      m.data.name?.includes('render')\n    );\n    \n    if (renderMetrics.length === 0) return 0;\n    \n    const totalTime = renderMetrics.reduce((sum, m) => sum + (m.data.duration || 0), 0);\n    return totalTime / renderMetrics.length;\n  }\n\n  private getAverageApiResponseTime(): number {\n    // Implementao simplificada\n    return Math.random() * 200 + 50; // 50-250ms simulado\n  }\n\n  private calculateErrorRate(): number {\n    const totalEvents = this.metrics.length;\n    const errorEvents = this.metrics.filter(m => \n      m.eventType === 'error-occurred' || m.eventType === 'promise-rejection'\n    ).length;\n    \n    return totalEvents > 0 ? errorEvents / totalEvents : 0;\n  }\n\n  private calculateCrashRate(): number {\n    // Implementao simplificada\n    return 0.001; // 0.1% simulado\n  }\n\n  private getMemoryUsage(): number {\n    if ('memory' in performance) {\n      return (performance as any).memory.usedJSHeapSize / 1024 / 1024; // MB\n    }\n    return 0;\n  }\n\n  // === ALERTAS ===\n\n  private checkAlerts(metric: GameplayMetric): void {\n    this.alertRules.forEach(rule => {\n      if (!rule.enabled) return;\n\n      const value = this.extractMetricValue(metric, rule.metric);\n      if (value === null) return;\n\n      const shouldAlert = this.evaluateCondition(value, rule.condition, rule.threshold);\n      \n      if (shouldAlert) {\n        this.createAlert(rule, metric, value);\n      }\n    });\n  }\n\n  private extractMetricValue(metric: GameplayMetric, metricName: string): number | null {\n    switch (metricName) {\n      case 'session_duration':\n        return this.currentSession?.duration || 0;\n      case 'error_rate':\n        return this.calculateErrorRate();\n      case 'memory_usage':\n        return this.getMemoryUsage();\n      default:\n        return metric.data[metricName] || null;\n    }\n  }\n\n  private evaluateCondition(value: number, condition: string, threshold: number): boolean {\n    switch (condition) {\n      case 'greater_than': return value > threshold;\n      case 'less_than': return value < threshold;\n      case 'equals': return value === threshold;\n      case 'not_equals': return value !== threshold;\n      default: return false;\n    }\n  }\n\n  private createAlert(rule: AlertRule, metric: GameplayMetric, value: number): void {\n    const alert: MetricAlert = {\n      id: `alert-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      ruleId: rule.id,\n      timestamp: new Date(),\n      metric: rule.metric,\n      value,\n      threshold: rule.threshold,\n      message: `Alert: ${rule.name} - ${rule.metric} is ${value} (threshold: ${rule.threshold})`,\n      severity: this.calculateSeverity(value, rule.threshold),\n      acknowledged: false\n    };\n\n    this.alerts.unshift(alert);\n    console.warn('Metric Alert:', alert.message);\n  }\n\n  private calculateSeverity(value: number, threshold: number): 'low' | 'medium' | 'high' | 'critical' {\n    const ratio = Math.abs(value - threshold) / threshold;\n    if (ratio > 2) return 'critical';\n    if (ratio > 1) return 'high';\n    if (ratio > 0.5) return 'medium';\n    return 'low';\n  }\n\n  // Mtodos pblicos para regras e alertas\n  addAlertRule(rule: AlertRule): void {\n    const exists = this.alertRules.some(r => r.id === rule.id);\n    if (exists) {\n      this.alertRules = this.alertRules.map(r => (r.id === rule.id ? rule : r));\n    } else {\n      this.alertRules.unshift(rule);\n    }\n  }\n\n  removeAlertRule(ruleId: string): void {\n    this.alertRules = this.alertRules.filter(r => r.id !== ruleId);\n  }\n\n  getAlertRules(): AlertRule[] {\n    return [...this.alertRules];\n  }\n\n  getAlerts(): MetricAlert[] {\n    return [...this.alerts];\n  }\n\n  acknowledgeAlert(alertId: string): void {\n    this.alerts = this.alerts.map(a => (a.id === alertId ? { ...a, acknowledged: true } : a));\n  }\n\n  clearAlerts(): void {\n    this.alerts = [];\n  }\n\n  // Expor eventos/sesses para anlises avanadas\n  getEvents(): GameplayMetric[] {\n    return [...this.metrics];\n  }\n\n  getSessions(): SessionMetrics[] {\n    return [...this.sessions];\n  }\n\n  // === PERSISTNCIA ===\n\n  private getUserId(): string {\n    return localStorage.getItem('heroforge-user-id') || 'anonymous';\n  }\n\n  private saveMetrics(): void {\n    try {\n      const data = {\n        metrics: this.metrics.slice(0, 1000), // Salvar apenas as 1000 mais recentes\n        lastSaved: new Date().toISOString()\n      };\n      localStorage.setItem('heroforge-metrics', JSON.stringify(data));\n    } catch (error) {\n      console.error('Erro ao salvar mtricas:', error);\n    }\n  }\n\n  private loadMetrics(): void {\n    try {\n      const saved = localStorage.getItem('heroforge-metrics');\n      if (saved) {\n        const data = JSON.parse(saved);\n        this.metrics = (data.metrics || []).map((m: any) => ({\n          ...m,\n          timestamp: new Date(m.timestamp)\n        }));\n      }\n    } catch (error) {\n      console.error('Erro ao carregar mtricas:', error);\n      this.metrics = [];\n    }\n  }\n\n  private saveSessions(): void {\n    try {\n      const data = {\n        sessions: this.sessions.slice(0, 500), // Salvar apenas as 500 mais recentes\n        lastSaved: new Date().toISOString()\n      };\n      localStorage.setItem('heroforge-sessions', JSON.stringify(data));\n    } catch (error) {\n      console.error('Erro ao salvar sesses:', error);\n    }\n  }\n\n  private loadSessions(): void {\n    try {\n      const saved = localStorage.getItem('heroforge-sessions');\n      if (saved) {\n        const data = JSON.parse(saved);\n        this.sessions = (data.sessions || []).map((s: any) => ({\n          ...s,\n          startTime: new Date(s.startTime),\n          endTime: s.endTime ? new Date(s.endTime) : undefined\n        }));\n      }\n    } catch (error) {\n      console.error('Erro ao carregar sesses:', error);\n      this.sessions = [];\n    }\n  }\n\n  // === LIMPEZA ===\n\n  cleanupOldData(daysToKeep: number = 90): void {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);\n\n    this.metrics = this.metrics.filter(m => m.timestamp >= cutoffDate);\n    this.sessions = this.sessions.filter(s => s.startTime >= cutoffDate);\n    this.alerts = this.alerts.filter(a => a.timestamp >= cutoffDate);\n\n    this.saveMetrics();\n    this.saveSessions();\n  }\n}\n\n// Instncia global e funes de convenincia\nexport const metricsManager = MetricsManager.getInstance();\n\nexport const trackMetric = {\n  heroCreated: (heroId: string, data: any) => \n    metricsManager.trackEvent('hero-created', heroId, data),\n  \n  levelUp: (heroId: string, data: any) => \n    metricsManager.trackEvent('level-up', heroId, data),\n  \n  questCompleted: (heroId: string, data: any) => \n    metricsManager.trackEvent('quest-completed', heroId, data),\n  \n  xpGained: (heroId: string, amount: number) => \n    metricsManager.trackEvent('xp-gained', heroId, { amount }),\n  \n  goldGained: (heroId: string, amount: number) => \n    metricsManager.trackEvent('gold-gained', heroId, { amount }),\n  \n  achievementUnlocked: (heroId: string, data: any) => \n    metricsManager.trackEvent('achievement-unlocked', heroId, data),\n  \n  pageVisited: (heroId: string, page: string) => \n    metricsManager.trackEvent('page-visited', heroId, { page }),\n  \n  featureUsed: (heroId: string, feature: string) => \n    metricsManager.trackEvent('feature-used', heroId, { feature }),\n  featureUsedData: (heroId: string, feature: string, data: Record<string, any>) =>\n    metricsManager.trackEvent('feature-used', heroId, { feature, ...data }),\n\n  attributePointsAllocated: (heroId: string, data: { totalSpent: number; allocations: Record<string, number> }) =>\n    metricsManager.trackEvent('attribute-increased', heroId, data),\n\n  purchaseInitiated: (heroId: string, productId: string) =>\n    metricsManager.trackEvent('purchase-initiated', heroId, { productId }),\n  purchaseCompleted: (heroId: string, productId: string, receiptId?: string) =>\n    metricsManager.trackEvent('purchase-completed', heroId, { productId, receiptId }),\n  adImpression: (heroId: string, placement: string) =>\n    metricsManager.trackEvent('ad-impression', heroId, { placement }),\n  adClick: (heroId: string, placement: string) =>\n    metricsManager.trackEvent('ad-click', heroId, { placement }),\n  itemAcquired: (heroId: string, data: any) =>\n    metricsManager.trackEvent('item-acquired', heroId, data),\n  rewardedAdCompleted: (heroId: string, reward: string) =>\n    metricsManager.trackEvent('rewarded-ad-completed', heroId, { reward })\n};\n\n// Finalizar sesso quando a pgina  fechada\nwindow.addEventListener('beforeunload', () => {\n  metricsManager.endSession();\n  try {\n    const kpi = metricsManager.getKPIDashboard();\n    const events = metricsManager.getEvents();\n    const featureEvents = events.filter(e => e.eventType === 'feature-used');\n    const installs = featureEvents.filter(e => String(e.data?.feature) === 'pwa-installed').length;\n    const purchases = events.filter(e => e.eventType === 'purchase-completed').length;\n    const themeSwitches = featureEvents.filter(e => String(e.data?.feature) === 'theme-switch').length;\n    const frameSwitches = featureEvents.filter(e => String(e.data?.feature) === 'frame-switch').length;\n    const body = { kpi, installs, purchases };\n    (body as any).customizations = { themeSwitches, frameSwitches };\n    const isDev = Boolean((import.meta as any)?.env?.DEV);\n    if (isDev) return;\n    const url = `http://localhost:3001/api/metrics/ingest`;\n    try {\n      if (navigator && typeof navigator.sendBeacon === 'function') {\n        const blob = new Blob([JSON.stringify(body)], { type: 'application/json' });\n        navigator.sendBeacon(url, blob);\n      }\n    } catch {}\n  } catch {}\n});\n","import { createClient } from '@supabase/supabase-js';\n\n// Leitura obrigatria das variveis de ambiente do Vite.\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\nconst supabaseDisabled = String(import.meta.env.VITE_SUPABASE_DISABLE || '').toLowerCase() === 'true';\nexport const supabaseConfigured = Boolean(supabaseUrl && supabaseAnonKey) && !supabaseDisabled;\n\n// Pequeno fetch com retry/backoff para reduzir falhas de rede intermitentes\nasync function fetchWithRetry(input: RequestInfo | URL, init?: RequestInit, retries = 2, baseDelayMs = 300): Promise<Response> {\n  let attempt = 0;\n  while (true) {\n    try {\n      const res = await fetch(input, init);\n      // Em caso de 5xx, tentamos novamente at o limite\n      if (res.status >= 500 && attempt < retries) {\n        attempt++;\n        await new Promise((r) => setTimeout(r, baseDelayMs * attempt));\n        continue;\n      }\n      return res;\n    } catch (err: any) {\n      const isAbortOrNetwork = err?.name === 'AbortError' || err instanceof TypeError;\n      if (isAbortOrNetwork && attempt < retries) {\n        attempt++;\n        await new Promise((r) => setTimeout(r, baseDelayMs * attempt));\n        continue;\n      }\n      throw err;\n    }\n  }\n}\n\n// Stub seguro para quando o Supabase no est configurado: no quebra a app e retorna erro amigvel.\nlet warnedOnce = false;\nfunction createDisabledClient() {\n  const errorPayload = {\n    data: null,\n    error: { message: 'Supabase no configurado: defina VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY', code: 'ENV_MISSING' }\n  };\n  const thenable = {\n    then(resolve: (v: any) => void) {\n      resolve(errorPayload);\n      return Promise.resolve(errorPayload);\n    }\n  } as any;\n  const builder = {\n    select() { return builder; },\n    insert() { return builder; },\n    update() { return builder; },\n    upsert() { return builder; },\n    delete() { return builder; },\n    eq() { return builder; },\n    order() { return builder; },\n    limit() { return builder; },\n    // Faz o objeto ser awaitable\n    then: thenable.then\n  } as any;\n  const client = {\n    from() { return builder; },\n    auth: {\n      onAuthStateChange(_cb: any) {\n        return { data: { subscription: { unsubscribe() {/* noop */} } }, error: { message: 'Supabase no configurado', code: 'ENV_MISSING' } };\n      },\n      async getUser() { return { data: { user: null }, error: { message: 'Supabase no configurado', code: 'ENV_MISSING' } }; },\n      async getSession() { return { data: { session: null }, error: { message: 'Supabase no configurado', code: 'ENV_MISSING' } }; },\n      async signOut() { return { data: {}, error: { message: 'Supabase no configurado', code: 'ENV_MISSING' } }; },\n      async signInWithOAuth() { return { data: null, error: { message: 'Supabase no configurado', code: 'ENV_MISSING' } }; }\n    }\n  } as any;\n  try {\n    const shouldWarn = Boolean((import.meta as any)?.env?.PROD) && !supabaseDisabled;\n    if (shouldWarn && !warnedOnce) {\n      console.warn('[Supabase] Variveis de ambiente ausentes. Configure .env.local com VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY');\n      warnedOnce = true;\n    }\n  } catch {}\n  return client;\n}\n\nexport const supabase: any = (supabaseConfigured)\n  ? createClient(supabaseUrl as string, supabaseAnonKey as string, { global: { fetch: fetchWithRetry as any } })\n  : createDisabledClient();\n","import { supabase } from '../lib/supabaseClient';\nimport type { Hero } from '../types/hero';\n\n// Verso do schema de persistncia de heri no Supabase\nexport const HERO_SCHEMA_VERSION = 1;\n\nexport type StoredHero = {\n  id: string;\n  user_id: string;\n  name?: string;\n  class?: string;\n  data: any;\n  created_at?: string;\n  updated_at?: string;\n};\n\n// L a verso do schema a partir do json armazenado\nexport function getStoredHeroVersion(storedData: any): number {\n  const raw = storedData?.hero ? storedData.hero : storedData;\n  const v = raw?.__schema_version;\n  return typeof v === 'number' ? v : 0;\n}\n\n// Sanitiza os dados para importao no store (remove metadados e suporta forma encapsulada)\nexport function sanitizeStoredHeroData(storedData: any): Hero {\n  const candidate = storedData?.hero ? storedData.hero : storedData;\n  const { __schema_version, ...sanitized } = candidate || {};\n  return sanitized as Hero;\n}\n\nexport async function saveHero(userId: string, hero: Hero): Promise<StoredHero | null> {\n  if (!userId || !hero?.id) return null;\n  // Persistimos todos os campos do heri com uma flag de verso de schema\n  const nameValue = hero?.name || hero?.id || 'Unknown';\n  const classValue = (hero as any)?.class || 'Unknown';\n  const payload = { id: hero.id, user_id: userId, name: nameValue, class: classValue, data: { ...hero, __schema_version: HERO_SCHEMA_VERSION } };\n  const { data, error } = await supabase\n    .from('heroes')\n    .upsert(payload, { onConflict: 'id' })\n    .select('*')\n    .limit(1);\n  if (error) {\n    console.error('saveHero error', {\n      code: (error as any)?.code,\n      message: (error as any)?.message,\n      details: (error as any)?.details,\n      hint: (error as any)?.hint,\n      payload\n    });\n    return null;\n  }\n  return (data && data[0]) as StoredHero;\n}\n\nexport async function listHeroesByUser(userId: string): Promise<StoredHero[]> {\n  if (!userId) return [];\n  const { data, error } = await supabase\n    .from('heroes')\n    .select('*')\n    .eq('user_id', userId)\n    .order('updated_at', { ascending: false });\n  if (error) {\n    console.error('listHeroesByUser error', {\n      code: (error as any)?.code,\n      message: (error as any)?.message,\n      details: (error as any)?.details,\n      hint: (error as any)?.hint,\n      userId\n    });\n    return [];\n  }\n  return (Array.isArray(data) ? data : []) as StoredHero[];\n}\n\nexport async function getHeroStatus(heroId: string): Promise<{ id: string; stamina: number; maxStamina: number; lastRestAt: number; dayCounter: number; actionsAvailable: string[] }> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/status`, { method: 'GET' });\n  if (!res.ok) throw new Error('status_error');\n  return res.json();\n}\n\nexport async function canPerformAction(heroId: string, actionType: string): Promise<{ ok: boolean; reason?: string; cost: number; stamina: number }> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/can-perform`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ actionType }) });\n  if (!res.ok) throw new Error('can_perform_error');\n  return res.json();\n}\n\nexport async function performAction(heroId: string, actionType: string, payload: any = {}): Promise<{ ok: boolean; newStamina: number; actionId: string }> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/perform-action`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ actionType, payload }) });\n  if (!res.ok) throw new Error('perform_error');\n  return res.json();\n}\n\nexport async function restHero(heroId: string, restType: 'guild' | 'inn' = 'guild'): Promise<{ ok: boolean; stamina: number; dayCounter: number; summary: any }> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/rest`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ restType }) });\n  if (!res.ok) throw new Error('rest_error');\n  return res.json();\n}\n\nexport async function restItem(heroId: string, itemId: string): Promise<{ ok: boolean; stamina: number }> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/rest-item`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ itemId }) });\n  if (!res.ok) throw new Error('rest_item_error');\n  return res.json();\n}\n\nexport async function consumeInnXpBuff(heroId: string): Promise<{ percent: number; remaining: number }> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/consume-inn-xp-buff`, { method: 'POST' });\n  if (!res.ok) throw new Error('inn_buff_error');\n  return res.json();\n}\n\nexport async function performActionUnified(heroId: string, actionKey: string, payload: any = {}): Promise<{ ok: boolean; hero: any; actionId: string }> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/action`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ actionKey, payload }) });\n  if (!res.ok) throw new Error('perform_unified_error');\n  return res.json();\n}\n\nexport async function getDailySummary(heroId: string): Promise<any> {\n  const res = await fetch(`/api/hero/${encodeURIComponent(heroId)}/daily-summary`, { method: 'GET' });\n  if (!res.ok) throw new Error('daily_summary_error');\n  return res.json();\n}\n\nexport async function listGuildBoard(heroId: string): Promise<{ quests: any[] }> {\n  const res = await fetch(`/api/guild/board?heroId=${encodeURIComponent(heroId)}`, { method: 'GET' });\n  if (!res.ok) throw new Error('guild_board_error');\n  return res.json();\n}\n","import React, { useState, useEffect } from 'react';\n\nexport interface Notification {\n  id: string;\n  type: 'xp' | 'levelup' | 'gold' | 'item' | 'achievement' | 'quest' | 'stamina';\n  title: string;\n  message: string;\n  value?: number;\n  duration?: number;\n  icon?: string;\n}\n\ninterface NotificationSystemProps {\n  notifications: Notification[];\n  onRemove: (id: string) => void;\n}\n\nconst NotificationItem: React.FC<{ notification: Notification; onRemove: (id: string) => void }> = ({ \n  notification, \n  onRemove \n}) => {\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      onRemove(notification.id);\n    }, notification.duration || 4000);\n\n    return () => clearTimeout(timer);\n  }, [notification.id, notification.duration, onRemove]);\n\n  const getNotificationStyle = (type: string) => {\n    switch (type) {\n      case 'xp':\n        return 'bg-blue-600 border-blue-500';\n      case 'levelup':\n        return 'bg-purple-600 border-purple-500';\n      case 'gold':\n        return 'bg-yellow-600 border-yellow-500';\n      case 'item':\n        return 'bg-green-600 border-green-500';\n      case 'achievement':\n        return 'bg-amber-600 border-amber-500';\n      case 'quest':\n        return 'bg-indigo-600 border-indigo-500';\n      case 'stamina':\n        return 'bg-red-600 border-red-500';\n      default:\n        return 'bg-gray-600 border-gray-500';\n    }\n  };\n\n  const getIcon = (type: string, customIcon?: string) => {\n    if (customIcon) return customIcon;\n    \n    switch (type) {\n      case 'xp':\n        return '';\n      case 'levelup':\n        return '';\n      case 'gold':\n        return '';\n      case 'item':\n        return '';\n      case 'achievement':\n        return '';\n      case 'quest':\n        return '';\n      case 'stamina':\n        return '';\n      default:\n        return '';\n    }\n  };\n\n  return (\n    <div className={`${getNotificationStyle(notification.type)} border-l-4 p-4 rounded-r-lg shadow-lg transform transition-all duration-300 animate-slide-in-right mb-2`}>\n      <div className=\"flex items-center\">\n        <div className=\"text-2xl mr-3\">\n          {getIcon(notification.type, notification.icon)}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"text-white font-semibold text-sm\">\n            {notification.title}\n            {notification.value && (\n              <span className=\"ml-2 text-lg font-bold\">\n                +{notification.value}\n              </span>\n            )}\n          </div>\n          <div className=\"text-gray-200 text-xs mt-1\">\n            {notification.message}\n          </div>\n        </div>\n        <button\n          onClick={() => onRemove(notification.id)}\n          className=\"text-white hover:text-gray-300 ml-2 text-lg\"\n        >\n          \n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst NotificationSystem: React.FC<NotificationSystemProps> = ({ notifications, onRemove }) => {\n  return (\n    <div className=\"fixed top-20 right-4 z-40 max-w-sm space-y-2\">\n      {notifications.map((notification) => (\n        <NotificationItem\n          key={notification.id}\n          notification={notification}\n          onRemove={onRemove}\n        />\n      ))}\n    </div>\n  );\n};\n\n// Hook para gerenciar notificaes\nexport const useNotifications = () => {\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n\n  const addNotification = (notification: Omit<Notification, 'id'>) => {\n    const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);\n    setNotifications(prev => [...prev, { ...notification, id }]);\n  };\n\n  const removeNotification = (id: string) => {\n    setNotifications(prev => prev.filter(n => n.id !== id));\n  };\n\n  const clearAllNotifications = () => {\n    setNotifications([]);\n  };\n\n  // Funes de convenincia para tipos especficos\n  const notifyXPGain = (amount: number, source: string) => {\n    addNotification({\n      type: 'xp',\n      title: 'XP Ganho!',\n      message: `Voc ganhou experincia de ${source}`,\n      value: amount,\n      duration: 3000\n    });\n  };\n\n  const notifyLevelUp = (newLevel: number) => {\n    addNotification({\n      type: 'levelup',\n      title: 'Level Up!',\n      message: `Parabns! Voc alcanou o nvel ${newLevel}!`,\n      duration: 5000\n    });\n  };\n\n  const notifyGoldGain = (amount: number, source: string) => {\n    addNotification({\n      type: 'gold',\n      title: 'Ouro Ganho!',\n      message: `Voc ganhou ouro de ${source}`,\n      value: amount,\n      duration: 3000\n    });\n  };\n\n  const notifyItemReceived = (itemName: string) => {\n    addNotification({\n      type: 'item',\n      title: 'Item Recebido!',\n      message: `Voc recebeu: ${itemName}`,\n      duration: 4000\n    });\n  };\n\n  const notifyAchievement = (achievementName: string) => {\n    addNotification({\n      type: 'achievement',\n      title: 'Conquista Desbloqueada!',\n      message: achievementName,\n      duration: 5000\n    });\n  };\n\n  const notifyQuestComplete = (questName: string) => {\n    addNotification({\n      type: 'quest',\n      title: 'Misso Completa!',\n      message: `Voc completou: ${questName}`,\n      duration: 4000\n    });\n  };\n\n  const notifyStaminaLow = () => {\n    addNotification({\n      type: 'stamina',\n      title: 'Fadiga Alta!',\n      message: 'Descanse para reduzir sua fadiga',\n      duration: 3000\n    });\n  };\n\n  return {\n    notifications,\n    addNotification,\n    removeNotification,\n    clearAllNotifications,\n    notifyXPGain,\n    notifyLevelUp,\n    notifyGoldGain,\n    notifyItemReceived,\n    notifyAchievement,\n    notifyQuestComplete,\n    notifyStaminaLow\n  };\n};\n\nexport default NotificationSystem;\n\n// Barramento global de notificaes para disparo de toasts a partir de qualquer componente\nexport type NotificationPayload = Omit<Notification, 'id'>;\n\ntype NotificationListener = (n: NotificationPayload) => void;\n\nclass NotificationBus {\n  private listeners: Set<NotificationListener> = new Set();\n  private recent: Map<string, number> = new Map();\n  private minIntervalMs = 30000;\n  private recentByType: Map<string, number[]> = new Map();\n  private lastAnyTs: number = 0;\n  private globalMinSpacingMs = 6000;\n  private maxPerMinuteByType: Record<string, number> = { achievement: 3, quest: 3 };\n\n  subscribe(listener: NotificationListener): () => void {\n    this.listeners.add(listener);\n    return () => {\n      this.listeners.delete(listener);\n    };\n  }\n\n  emit(notification: NotificationPayload) {\n    const key = `${notification.type}|${notification.title}|${notification.message}`;\n    const now = Date.now();\n    const last = this.recent.get(key) || 0;\n    if (now - last < this.minIntervalMs) return;\n    this.recent.set(key, now);\n    if (this.recent.size > 200) {\n      const threshold = now - this.minIntervalMs * 2;\n      this.recent.forEach((ts, k) => { if (ts < threshold) this.recent.delete(k); });\n    }\n    if (now - this.lastAnyTs < this.globalMinSpacingMs) return;\n    const type = notification.type;\n    const cap = this.maxPerMinuteByType[type] || 9999;\n    const arr = (this.recentByType.get(type) || []).filter(ts => now - ts < 60000);\n    if (arr.length >= cap) return;\n    arr.push(now);\n    this.recentByType.set(type, arr);\n    this.lastAnyTs = now;\n    this.listeners.forEach((listener) => listener(notification));\n  }\n}\n\nexport const notificationBus = new NotificationBus();\n","import { HeroAttributes, HeroClass } from '../types/hero'\n\nexport interface ClassMeta {\n  id: HeroClass\n  name: string\n  icon: string\n  description: string\n  baseAttributes: HeroAttributes\n  advantages: string[]\n  disadvantages: string[]\n  requirements?: (input: { attributes: HeroAttributes; race: string }) => { ok: boolean; message?: string }\n  suggestedRaces?: string[]\n}\n\nexport const CLASS_METADATA: Record<HeroClass, ClassMeta> = {\n  guerreiro: {\n    id: 'guerreiro', name: 'Guerreiro', icon: '',\n    description: 'Combatente corpo a corpo verstil com alta durabilidade.',\n    baseAttributes: { forca: 4, destreza: 3, constituicao: 4, inteligencia: 2, sabedoria: 2, carisma: 2 },\n    advantages: ['Alta sobrevivncia', 'Dano consistente'],\n    disadvantages: ['Pouca mobilidade', 'Baixo dano mgico'],\n    suggestedRaces: ['humano', 'orc', 'anao']\n  },\n  mago: {\n    id: 'mago', name: 'Mago', icon: '',\n    description: 'Especialista em magias ofensivas e controle do campo.',\n    baseAttributes: { forca: 1, destreza: 2, constituicao: 2, inteligencia: 5, sabedoria: 4, carisma: 2 },\n    advantages: ['Alto dano mgico', 'Controle de rea'],\n    disadvantages: ['Frgil fisicamente', 'Dependente de energia'],\n    suggestedRaces: ['elfo', 'humano']\n  },\n  ladino: {\n    id: 'ladino', name: 'Ladino', icon: '',\n    description: 'gil e furtivo, focado em golpes crticos e evaso.',\n    baseAttributes: { forca: 2, destreza: 5, constituicao: 2, inteligencia: 3, sabedoria: 2, carisma: 2 },\n    advantages: ['Alta evaso', 'Crticos frequentes'],\n    disadvantages: ['Frgil contra dano em rea'],\n    suggestedRaces: ['humano', 'halfling']\n  },\n  clerigo: {\n    id: 'clerigo', name: 'Clrigo', icon: '',\n    description: 'Guardio da luz, forte em cura e suporte.',\n    baseAttributes: { forca: 2, destreza: 2, constituicao: 3, inteligencia: 3, sabedoria: 5, carisma: 3 },\n    advantages: ['Curas e purificaes', 'Suporte poderoso'],\n    disadvantages: ['Baixo dano fsico'],\n    suggestedRaces: ['humano', 'elfo']\n  },\n  patrulheiro: {\n    id: 'patrulheiro', name: 'Patrulheiro', icon: '',\n    description: 'Caador e explorador, equilibrado entre preciso e utilidade.',\n    baseAttributes: { forca: 3, destreza: 4, constituicao: 3, inteligencia: 2, sabedoria: 3, carisma: 2 },\n    advantages: ['Verstil', 'Bom em ambientes selvagens'],\n    disadvantages: ['Menos explosivo que classes especializadas'],\n    suggestedRaces: ['elfo', 'humano']\n  },\n  paladino: {\n    id: 'paladino', name: 'Paladino', icon: '',\n    description: 'Cavaleiro sagrado com defesa excepcional e suporte divino.',\n    baseAttributes: { forca: 4, destreza: 2, constituicao: 4, inteligencia: 2, sabedoria: 4, carisma: 3 },\n    advantages: ['Defesa e controle', 'Suporte luminoso'],\n    disadvantages: ['Menos flexvel ofensivamente'],\n    suggestedRaces: ['humano', 'anao']\n  },\n  arqueiro: {\n    id: 'arqueiro', name: 'Arqueiro', icon: '',\n    description: 'Atirador preciso com vantagem  distncia.',\n    baseAttributes: { forca: 2, destreza: 5, constituicao: 2, inteligencia: 2, sabedoria: 3, carisma: 2 },\n    advantages: ['Alto alcance', 'Crticos'],\n    disadvantages: ['Frgil em curta distncia'],\n    suggestedRaces: ['elfo', 'halfling']\n  },\n  bardo: {\n    id: 'bardo', name: 'Bardo', icon: '',\n    description: 'Artista do campo de batalha, mistura de suporte e controle.',\n    baseAttributes: { forca: 2, destreza: 3, constituicao: 2, inteligencia: 3, sabedoria: 3, carisma: 5 },\n    advantages: ['Buffs de grupo', 'Ferramentas de controle'],\n    disadvantages: ['Dano direto limitado'],\n    suggestedRaces: ['humano', 'elfo']\n  },\n  monge: {\n    id: 'monge', name: 'Monge', icon: '',\n    description: 'Marcial disciplinado, defesa e regenerao interna.',\n    baseAttributes: { forca: 3, destreza: 3, constituicao: 4, inteligencia: 2, sabedoria: 3, carisma: 2 },\n    advantages: ['Resistncia e mobilidade'],\n    disadvantages: ['Dependente de posicionamento'],\n    requirements: ({ attributes }) => {\n      if ((attributes.constituicao || 0) < 3) return { ok: false, message: 'Monge requer Constituio  3.' }\n      return { ok: true }\n    },\n    suggestedRaces: ['humano']\n  },\n  assassino: {\n    id: 'assassino', name: 'Assassino', icon: '',\n    description: 'Eliminador furtivo com foco em exploso e evaso.',\n    baseAttributes: { forca: 2, destreza: 5, constituicao: 2, inteligencia: 3, sabedoria: 2, carisma: 2 },\n    advantages: ['Exploso e furtividade'],\n    disadvantages: ['Frgil se revelado'],\n    requirements: ({ attributes }) => {\n      if ((attributes.destreza || 0) < 3) return { ok: false, message: 'Assassino requer Destreza  3.' }\n      return { ok: true }\n    },\n    suggestedRaces: ['humano', 'halfling']\n  },\n  barbaro: {\n    id: 'barbaro', name: 'Brbaro', icon: '',\n    description: 'Bruto indomvel com dano fsico massivo.',\n    baseAttributes: { forca: 5, destreza: 2, constituicao: 4, inteligencia: 1, sabedoria: 2, carisma: 2 },\n    advantages: ['Dano fsico alto'],\n    disadvantages: ['Baixa defesa mgica'],\n    suggestedRaces: ['orc', 'humano']\n  },\n  lanceiro: {\n    id: 'lanceiro', name: 'Lanceiro (Dragoon)', icon: '',\n    description: 'Especialista em alcance e controle areo.',\n    baseAttributes: { forca: 4, destreza: 4, constituicao: 3, inteligencia: 2, sabedoria: 2, carisma: 2 },\n    advantages: ['Perfurao e salto'],\n    disadvantages: ['Custo alto de energia'],\n    requirements: ({ attributes }) => {\n      if ((attributes.destreza || 0) < 3) return { ok: false, message: 'Lanceiro requer Destreza  3.' }\n      return { ok: true }\n    },\n    suggestedRaces: ['elfo', 'humano']\n  },\n  druida: {\n    id: 'druida', name: 'Druida', icon: '',\n    description: 'Guardio da natureza com curas e transformaes.',\n    baseAttributes: { forca: 2, destreza: 3, constituicao: 3, inteligencia: 3, sabedoria: 4, carisma: 2 },\n    advantages: ['Suporte flexvel', 'Controle ambiental'],\n    disadvantages: ['Dano direto menor'],\n    suggestedRaces: ['elfo', 'humano']\n  },\n  feiticeiro: {\n    id: 'feiticeiro', name: 'Feiticeiro das Trevas', icon: '',\n    description: 'Manipulador de trevas com debuffs potentes.',\n    baseAttributes: { forca: 1, destreza: 2, constituicao: 2, inteligencia: 5, sabedoria: 3, carisma: 3 },\n    advantages: ['Debuffs fortes', 'Invocaes'],\n    disadvantages: ['Frgil, dependente de mana'],\n    suggestedRaces: ['humano', 'orc']\n  }\n}\n\n","import { Hero } from '../types/hero'\nimport { CLASS_METADATA } from './classRegistry'\nimport { getRecommendedElements } from './elementSystem'\n\nexport function computeSynergyBonus(hero: Hero): number {\n  const meta = CLASS_METADATA[hero.class]\n  if (!meta) return 0\n  const raceGood = meta.suggestedRaces?.includes(hero.race) ? 1 : 0\n  const elRecs = getRecommendedElements(hero.class, hero.race)\n  const elemGood = elRecs.includes(hero.element) ? 1 : 0\n  const score = raceGood + elemGood\n  if (score === 2) return 0.1\n  if (score === 1) return 0.05\n  return 0\n}\n\n","/**\n * Sistema de Skills por Classe\n * Verso 3.0 - Forjador de Heris\n */\n\nimport { Skill, HeroClass } from '../types/hero';\n\nexport const CLASS_SKILLS: Record<HeroClass, Skill[]> = {\n  guerreiro: [\n    {\n      id: 'golpe-poderoso',\n      name: 'Golpe Poderoso',\n      description: 'Um ataque devastador que causa alto dano fsico',\n      type: 'attack',\n      cost: 5,\n      basePower: 18,\n      element: 'earth',\n      target: 'single',\n      cooldown: 2\n    },\n    {\n      id: 'postura-defensiva',\n      name: 'Postura Defensiva',\n      description: 'Aumenta a defesa por alguns turnos',\n      type: 'buff',\n      cost: 3,\n      duration: 2,\n      target: 'self',\n      effects: {\n        buff: {\n          attribute: 'constituicao',\n          percentage: 30\n        }\n      }\n    },\n    {\n      id: 'grito-guerra',\n      name: 'Grito de Guerra',\n      description: 'Inspira aliados prximos, aumentando seu ataque',\n      type: 'support',\n      cost: 4,\n      duration: 2,\n      target: 'ally',\n      effects: {\n        buff: {\n          attribute: 'forca',\n          percentage: 15\n        }\n      }\n    }\n    ,\n    {\n      id: 'investida-feroz',\n      name: 'Investida Feroz',\n      description: 'Avana rapidamente causando dano e empurrando o alvo',\n      type: 'attack',\n      cost: 4,\n      basePower: 14,\n      element: 'physical',\n      target: 'single',\n      effects: { special: 'knockback_small' }\n    }\n  ],\n  mago: [\n    {\n      id: 'bola-fogo',\n      name: 'Bola de Fogo',\n      description: 'Lana uma esfera flamejante que atinge mltiplos inimigos',\n      type: 'attack',\n      cost: 6,\n      basePower: 20,\n      element: 'fire',\n      target: 'aoe',\n      cooldown: 3\n    },\n    {\n      id: 'escudo-arcano',\n      name: 'Escudo Arcano',\n      description: 'Cria uma barreira mgica que reduz dano mgico',\n      type: 'buff',\n      cost: 4,\n      duration: 2,\n      target: 'self',\n      effects: {\n        special: 'magic_resistance_40'\n      }\n    },\n    {\n      id: 'sussurros-mente',\n      name: 'Sussurros da Mente',\n      description: 'Reduz o cooldown das habilidades dos aliados',\n      type: 'support',\n      cost: 5,\n      target: 'ally',\n      effects: {\n        special: 'reduce_cooldown_1'\n      }\n    }\n    ,\n    {\n      id: 'rajada-gelo',\n      name: 'Rajada de Gelo',\n      description: 'Ataque de gelo com chance de reduzir velocidade',\n      type: 'attack',\n      cost: 5,\n      basePower: 16,\n      element: 'ice',\n      target: 'single',\n      effects: { debuff: { special: 'slow' } }\n    }\n  ],\n  arqueiro: [\n    {\n      id: 'tiro-preciso',\n      name: 'Tiro Preciso',\n      description: 'Um tiro certeiro com alta chance de crtico',\n      type: 'attack',\n      cost: 4,\n      basePower: 15,\n      element: 'physical',\n      target: 'single',\n      effects: {\n        special: 'high_crit_chance'\n      }\n    },\n    {\n      id: 'passo-silencioso',\n      name: 'Passo Silencioso',\n      description: 'Aumenta a chance de esquiva por alguns turnos',\n      type: 'buff',\n      cost: 3,\n      duration: 2,\n      target: 'self',\n      effects: {\n        buff: {\n          attribute: 'destreza',\n          percentage: 25\n        }\n      }\n    },\n    {\n      id: 'chuva-flechas',\n      name: 'Chuva de Flechas',\n      description: 'Dispara mltiplas flechas atingindo vrios inimigos',\n      type: 'attack',\n      cost: 6,\n      basePower: 12,\n      element: 'physical',\n      target: 'aoe',\n      cooldown: 4\n    }\n    ,\n    {\n      id: 'disparo-penetrante',\n      name: 'Disparo Penetrante',\n      description: 'Ataque que ignora parte da armadura',\n      type: 'attack',\n      cost: 5,\n      basePower: 13,\n      element: 'physical',\n      target: 'single',\n      effects: { special: 'ignore_armor_small' }\n    }\n  ],\n  clerigo: [\n    {\n      id: 'luz-curativa',\n      name: 'Luz Curativa',\n      description: 'Canaliza energia divina para curar ferimentos',\n      type: 'support',\n      cost: 5,\n      target: 'ally',\n      effects: {\n        heal: 20\n      }\n    },\n    {\n      id: 'bencao',\n      name: 'Bno',\n      description: 'Abenoa um aliado, aumentando a cura recebida',\n      type: 'buff',\n      cost: 4,\n      duration: 3,\n      target: 'ally',\n      effects: {\n        special: 'healing_bonus_10'\n      }\n    },\n    {\n      id: 'exorcismo',\n      name: 'Exorcismo',\n      description: 'Ataque sagrado especialmente efetivo contra mortos-vivos',\n      type: 'attack',\n      cost: 6,\n      basePower: 14,\n      element: 'light',\n      target: 'single',\n      effects: {\n        special: 'extra_vs_undead'\n      }\n    }\n  ],\n  ladino: [\n    {\n      id: 'estocada',\n      name: 'Estocada',\n      description: 'Ataque furtivo que causa dano extra em alvos desprevenidos',\n      type: 'attack',\n      cost: 4,\n      basePower: 16,\n      element: 'physical',\n      target: 'single',\n      effects: {\n        special: 'sneak_attack_bonus'\n      }\n    },\n    {\n      id: 'fuga-sombria',\n      name: 'Fuga Sombria',\n      description: 'Teleporta para as sombras, ganhando invulnerabilidade temporria',\n      type: 'support',\n      cost: 3,\n      target: 'self',\n      effects: {\n        special: 'teleport_invulnerable_1_turn'\n      }\n    },\n    {\n      id: 'manobra-enganosa',\n      name: 'Manobra Enganosa',\n      description: 'Confunde inimigos, fazendo-os errar seus ataques',\n      type: 'buff',\n      cost: 4,\n      duration: 2,\n      target: 'single',\n      effects: {\n        debuff: {\n          special: 'confusion_miss_chance'\n        }\n      }\n    }\n  ],\n  patrulheiro: [\n    {\n      id: 'tiro-rastreador',\n      name: 'Tiro Rastreador',\n      description: 'Marca o alvo e causa dano contnuo',\n      type: 'attack',\n      cost: 4,\n      basePower: 14,\n      element: 'physical',\n      target: 'single',\n      effects: {\n        special: 'mark_target_dot'\n      }\n    },\n    {\n      id: 'camuflagem',\n      name: 'Camuflagem',\n      description: 'Torna-se invisvel por alguns turnos',\n      type: 'buff',\n      cost: 5,\n      duration: 2,\n      target: 'self',\n      effects: {\n        special: 'invisibility'\n      }\n    },\n    {\n      id: 'chamado-natureza',\n      name: 'Chamado da Natureza',\n      description: 'Invoca a ajuda de animais selvagens',\n      type: 'support',\n      cost: 6,\n      target: 'ally',\n      effects: {\n        special: 'summon_animal_companion'\n      }\n    }\n  ],\n  paladino: [\n    {\n      id: 'golpe-sagrado',\n      name: 'Golpe Sagrado',\n      description: 'Ataque imbudo com poder divino',\n      type: 'attack',\n      cost: 5,\n      basePower: 16,\n      element: 'light',\n      target: 'single',\n      cooldown: 2\n    },\n    {\n      id: 'aura-protecao',\n      name: 'Aura de Proteo',\n      description: 'Protege aliados prximos com energia sagrada',\n      type: 'buff',\n      cost: 6,\n      duration: 3,\n      target: 'ally',\n      effects: {\n        buff: {\n          attribute: 'constituicao',\n          percentage: 20\n        }\n      }\n    },\n    {\n      id: 'cura-divina',\n      name: 'Cura Divina',\n      description: 'Canaliza poder divino para curar ferimentos graves',\n      type: 'support',\n      cost: 7,\n      target: 'ally',\n      effects: {\n        heal: 25\n      }\n    }\n  ]\n  ,\n  bardo: [\n    { id: 'melodia-inspiradora', name: 'Melodia Inspiradora', description: 'Inspira o grupo, aumentando atributos por alguns turnos', type: 'buff', cost: 3, duration: 2, target: 'ally', effects: { buff: { attribute: 'carisma', percentage: 15 } } },\n    { id: 'nota-cortante', name: 'Nota Cortante', description: 'Ataque sonoro rpido contra um alvo', type: 'attack', cost: 4, basePower: 12, element: 'physical', target: 'single' },\n    { id: 'bencao-alaude', name: 'Bno do Alade', description: 'Suporte leve que melhora recuperao', type: 'support', cost: 5, target: 'ally', effects: { special: 'recovery_bonus_10' } }\n  ],\n  monge: [\n    { id: 'golpe-chi', name: 'Golpe Chi', description: 'Ataque concentrado de energia fsica', type: 'attack', cost: 4, basePower: 14, element: 'physical', target: 'single' },\n    { id: 'respiracao-interna', name: 'Respirao Interna', description: 'Aumenta defesa e regenera levemente', type: 'buff', cost: 3, duration: 2, target: 'self', effects: { special: 'minor_regen', buff: { attribute: 'constituicao', percentage: 15 } } },\n    { id: 'chute-giratorio', name: 'Chute Giratrio', description: 'Controla o inimigo e reduz sua ao', type: 'buff', cost: 5, duration: 1, target: 'single', effects: { debuff: { special: 'knockdown' } } }\n  ],\n  assassino: [\n    { id: 'ataque-sombrio', name: 'Ataque Sombrio', description: 'Golpe das sombras com dano de trevas', type: 'attack', cost: 4, basePower: 15, element: 'dark', target: 'single' },\n    { id: 'golpe-duplo', name: 'Golpe Duplo', description: 'Dois ataques rpidos em sequncia', type: 'attack', cost: 5, basePower: 10, element: 'physical', target: 'single', effects: { special: 'double_strike' } },\n    { id: 'fumaca-oculta', name: 'Fumaa Oculta', description: 'Evade e escapa de perigo por um turno', type: 'support', cost: 3, target: 'self', effects: { special: 'escape' } }\n  ],\n  barbaro: [\n    { id: 'corte-brutal', name: 'Corte Brutal', description: 'Ataque fsico poderoso', type: 'attack', cost: 5, basePower: 18, element: 'physical', target: 'single' },\n    { id: 'frenesi', name: 'Frenesi', description: 'Aumenta ataque por alguns turnos', type: 'buff', cost: 4, duration: 2, target: 'self', effects: { buff: { attribute: 'forca', percentage: 20 } } },\n    { id: 'rugido-selvagem', name: 'Rugido Selvagem', description: 'Debuff que reduz a defesa do inimigo', type: 'buff', cost: 3, duration: 2, target: 'single', effects: { debuff: { attribute: 'constituicao', percentage: 15 } } }\n  ],\n  lanceiro: [\n    { id: 'investida-perfurante', name: 'Investida Perfurante', description: 'Ataque fsico com perfurao', type: 'attack', cost: 5, basePower: 16, element: 'physical', target: 'single' },\n    { id: 'postura-longa', name: 'Postura Longa', description: 'Aumenta alcance e defesa', type: 'buff', cost: 3, duration: 2, target: 'self', effects: { buff: { attribute: 'constituicao', percentage: 15 } } },\n    { id: 'salto-dragao', name: 'Salto do Drago', description: 'Controle com salto que atrapalha o inimigo', type: 'buff', cost: 5, duration: 1, target: 'single', effects: { debuff: { special: 'airborne_control' } } }\n  ],\n  druida: [\n    { id: 'raiz-aprisionadora', name: 'Raiz Aprisionadora', description: 'Controla o inimigo com razes', type: 'buff', cost: 4, duration: 1, target: 'single', effects: { debuff: { special: 'root' } } },\n    { id: 'cura-natural', name: 'Cura Natural', description: 'Cura leve de energia da natureza', type: 'support', cost: 4, target: 'ally', effects: { heal: 15 } },\n    { id: 'chamado-fauna', name: 'Chamado da Fauna', description: 'Invoca um pet temporrio', type: 'support', cost: 5, target: 'ally', effects: { special: 'summon_pet' } }\n  ],\n  feiticeiro: [\n    { id: 'seta-sombria', name: 'Seta Sombria', description: 'Ataque de trevas contra um alvo', type: 'attack', cost: 5, basePower: 16, element: 'dark', target: 'single' },\n    { id: 'corrente-maldita', name: 'Corrente Maldita', description: 'Debuff que reduz atributos do inimigo', type: 'buff', cost: 4, duration: 2, target: 'single', effects: { debuff: { attribute: 'forca', percentage: 15 } } },\n    { id: 'drenar-vida', name: 'Drenar Vida', description: 'Rouba vida do inimigo e recupera o usurio', type: 'support', cost: 6, target: 'single', effects: { special: 'lifesteal_small' } }\n  ]\n};\n\n/**\n * Obtm as skills iniciais de uma classe\n */\nexport function getClassSkills(heroClass: HeroClass): Skill[] {\n  return CLASS_SKILLS[heroClass] || [];\n}\n\n/**\n * Verifica se um heri pode usar uma skill\n */\nexport function canUseSkill(heroLevel: number, heroMana: number, skill: Skill): boolean {\n  return heroMana >= skill.cost;\n}\n\n// Skills de progresso por classe\nexport const PROGRESSION_SKILLS: Record<HeroClass, Array<{ level: number; skills: Skill[] }>> = {\n  mago: [\n    { level: 3, skills: [{ id: 'tempestade-arcana', name: 'Tempestade Arcana', description: 'Dano em rea arcano', type: 'attack', cost: 6, basePower: 18, element: 'light', target: 'aoe', cooldown: 3 }] },\n    { level: 5, skills: [{ id: 'congelar', name: 'Congelar', description: 'Stun de gelo por 1 turno', type: 'buff', cost: 5, duration: 1, target: 'single', effects: { debuff: { special: 'freeze_stun' } } }] },\n    { level: 7, skills: [{ id: 'amplificar-magia', name: 'Amplificar Magia', description: 'Buff mgico avanado', type: 'buff', cost: 5, duration: 2, target: 'ally', effects: { buff: { attribute: 'inteligencia', percentage: 20 } } }] },\n    { level: 10, skills: [{ id: 'cometa-arcano', name: 'Cometa Arcano', description: 'Ultimate de alto dano arcano em rea', type: 'attack', cost: 8, basePower: 30, element: 'light', target: 'aoe', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'campo-anti-magia', name: 'Campo Anti-Magia', description: 'Reduz efeitos mgicos inimigos', type: 'support', cost: 6, target: 'aoe', effects: { special: 'anti_magic_field' } }] },\n    { level: 15, skills: [{ id: 'chama-eterea', name: 'Chama Etrea', description: 'Ataque contnuo de fogo', type: 'attack', cost: 7, basePower: 24, element: 'fire', target: 'single', effects: { debuff: { special: 'burn_dot' } } }] },\n    { level: 18, skills: [{ id: 'tempestade-gelo', name: 'Tempestade de Gelo', description: 'rea com slow forte', type: 'attack', cost: 8, basePower: 26, element: 'ice', target: 'aoe', cooldown: 4 }] },\n    { level: 20, skills: [{ id: 'apoteose-arcana', name: 'Apoteose Arcana', description: 'Ultimate final: grande poder arcano', type: 'attack', cost: 10, basePower: 38, element: 'light', target: 'aoe', cooldown: 5 }] }\n  ],\n  bardo: [\n    { level: 3, skills: [{ id: 'cancao-coragem', name: 'Cano da Coragem', description: 'Aumenta ataque do grupo', type: 'buff', cost: 4, duration: 2, target: 'ally', effects: { buff: { attribute: 'forca', percentage: 15 } } }] },\n    { level: 5, skills: [{ id: 'balada-cura', name: 'Balada da Cura', description: 'Cura leve por 3 turnos', type: 'support', cost: 5, duration: 3, target: 'ally', effects: { heal: 10 } }] },\n    { level: 7, skills: [{ id: 'grito-multidao', name: 'Grito da Multido', description: 'Debuff inimigos em rea', type: 'buff', cost: 5, duration: 2, target: 'aoe', effects: { debuff: { attribute: 'destreza', percentage: 10 } } }] },\n    { level: 10, skills: [{ id: 'sinfonia-final', name: 'Sinfonia Final', description: 'Ultimate: buff + dano em rea', type: 'attack', cost: 7, basePower: 20, element: 'physical', target: 'aoe', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'harmonia-guardia', name: 'Harmonia do Guardio', description: 'Reduz dano recebido', type: 'buff', cost: 4, duration: 2, target: 'ally', effects: { special: 'damage_reduction_10' } }] },\n    { level: 15, skills: [{ id: 'coro-heroico', name: 'Coro Heroico', description: 'Aumenta todos atributos por curto perodo', type: 'buff', cost: 6, duration: 2, target: 'ally', effects: { buff: { attribute: 'carisma', percentage: 20 } } }] },\n    { level: 18, skills: [{ id: 'ritmo-desorientador', name: 'Ritmo Desorientador', description: 'Debuff forte de preciso inimiga', type: 'buff', cost: 5, duration: 2, target: 'aoe', effects: { debuff: { special: 'accuracy_down' } } }] },\n    { level: 20, skills: [{ id: 'orquestra-epica', name: 'Orquestra pica', description: 'Ultimate final: grande suporte + dano', type: 'attack', cost: 9, basePower: 28, element: 'physical', target: 'aoe', cooldown: 5 }] }\n  ],\n  monge: [\n    { level: 3, skills: [{ id: 'punhos-elementais', name: 'Punhos Elementais', description: 'Ataques com fogo/terra', type: 'attack', cost: 5, basePower: 16, element: 'earth', target: 'single' }] },\n    { level: 5, skills: [{ id: 'passo-vento', name: 'Passo do Vento', description: 'Velocidade + esquiva', type: 'buff', cost: 4, duration: 2, target: 'self', effects: { special: 'evasion_up' } }] },\n    { level: 7, skills: [{ id: 'palma-sagrada', name: 'Palma Sagrada', description: 'Dano de luz', type: 'attack', cost: 5, basePower: 18, element: 'light', target: 'single' }] },\n    { level: 10, skills: [{ id: 'punho-dragao', name: 'Punho do Drago', description: 'Ultimate fsico poderoso', type: 'attack', cost: 8, basePower: 28, element: 'physical', target: 'single', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'muralha-chi', name: 'Muralha de Chi', description: 'Escudo que absorve dano', type: 'buff', cost: 5, duration: 2, target: 'self', effects: { special: 'shield_medium' } }] },\n    { level: 15, skills: [{ id: 'sequencia-lotus', name: 'Sequncia de Ltus', description: 'Combo multi-golpes', type: 'attack', cost: 7, basePower: 22, element: 'physical', target: 'single', effects: { special: 'multi_hit' } }] },\n    { level: 18, skills: [{ id: 'serenidade-plena', name: 'Serenidade Plena', description: 'Reduz cooldowns e regenera', type: 'support', cost: 6, target: 'self', effects: { special: 'reduce_cd_regen' } }] },\n    { level: 20, skills: [{ id: 'ascese', name: 'Ascese', description: 'Ultimate: grande buff pessoal', type: 'buff', cost: 9, duration: 3, target: 'self', effects: { buff: { attribute: 'constituicao', percentage: 30 } } }] }\n  ],\n  assassino: [\n    { level: 3, skills: [{ id: 'veneno-mortal', name: 'Veneno Mortal', description: 'Dano contnuo', type: 'buff', cost: 4, duration: 3, target: 'single', effects: { debuff: { special: 'poison_dot' } } }] },\n    { level: 5, skills: [{ id: 'surpresa-fatal', name: 'Surpresa Fatal', description: 'Crtico garantido prximo ataque', type: 'buff', cost: 4, duration: 1, target: 'self', effects: { special: 'guaranteed_crit' } }] },\n    { level: 7, skills: [{ id: 'sombra-replicante', name: 'Sombra Replicante', description: 'Cria clone que distrai', type: 'support', cost: 5, target: 'ally', effects: { special: 'decoy_clone' } }] },\n    { level: 10, skills: [{ id: 'execucao-perfeita', name: 'Execuo Perfeita', description: 'Ultimate: alto dano single', type: 'attack', cost: 8, basePower: 30, element: 'dark', target: 'single', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'lmina-silenciosa', name: 'Lmina Silenciosa', description: 'Ataque com bleed', type: 'attack', cost: 6, basePower: 20, element: 'physical', target: 'single', effects: { debuff: { special: 'bleed_dot' } } }] },\n    { level: 15, skills: [{ id: 'passo-sombra', name: 'Passo da Sombra', description: 'Teleporta e ganha dano bnus', type: 'support', cost: 5, target: 'self', effects: { special: 'shadow_step' } }] },\n    { level: 18, skills: [{ id: 'cadeia-golpes', name: 'Cadeia de Golpes', description: 'Combo com chance de reset', type: 'attack', cost: 7, basePower: 24, element: 'physical', target: 'single', effects: { special: 'combo_reset_chance' } }] },\n    { level: 20, skills: [{ id: 'matana-precisa', name: 'Matana Precisa', description: 'Ultimate final: crtico massivo', type: 'attack', cost: 9, basePower: 36, element: 'dark', target: 'single', cooldown: 5 }] }\n  ],\n  paladino: [\n    { level: 3, skills: [{ id: 'martelo-divino', name: 'Martelo Divino', description: 'Dano + stun', type: 'attack', cost: 6, basePower: 18, element: 'light', target: 'single', effects: { special: 'stun_1' } }] },\n    { level: 5, skills: [{ id: 'lagrima-luz', name: 'Lgrima da Luz', description: 'Cura mdia', type: 'support', cost: 5, target: 'ally', effects: { heal: 20 } }] },\n    { level: 7, skills: [{ id: 'protecao-guardiao', name: 'Proteo do Guardio', description: 'Escudo forte', type: 'buff', cost: 5, duration: 2, target: 'ally', effects: { special: 'strong_shield' } }] },\n    { level: 10, skills: [{ id: 'ascensao-divina', name: 'Ascenso Divina', description: 'Ultimate sagrado', type: 'attack', cost: 8, basePower: 28, element: 'light', target: 'aoe', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'beno-paladina', name: 'Beno Paladina', description: 'Buff de defesa forte', type: 'buff', cost: 6, duration: 2, target: 'ally', effects: { buff: { attribute: 'constituicao', percentage: 25 } } }] },\n    { level: 15, skills: [{ id: 'julgar', name: 'Julgar', description: 'Ataque que reduz dano inimigo', type: 'attack', cost: 6, basePower: 22, element: 'light', target: 'single', effects: { debuff: { special: 'damage_down' } } }] },\n    { level: 18, skills: [{ id: 'voto-guardio', name: 'Voto do Guardio', description: 'Protege aliado com escudo', type: 'support', cost: 6, target: 'ally', effects: { special: 'link_shield' } }] },\n    { level: 20, skills: [{ id: 'luz-redentora', name: 'Luz Redentora', description: 'Ultimate final: cura + dano sagrado', type: 'attack', cost: 10, basePower: 34, element: 'light', target: 'aoe', cooldown: 5 }] }\n  ],\n  clerigo: [\n    { level: 3, skills: [{ id: 'aura-fe', name: 'Aura de F', description: 'Buff de grupo', type: 'buff', cost: 4, duration: 2, target: 'ally', effects: { special: 'group_buff' } }] },\n    { level: 5, skills: [{ id: 'bencao-ancestrais', name: 'Beno dos Ancestrais', description: 'Aumenta XP ganho', type: 'support', cost: 4, target: 'ally', effects: { special: 'xp_bonus_10' } }] },\n    { level: 7, skills: [{ id: 'escudo-purificador', name: 'Escudo Purificador', description: 'Remove debuffs', type: 'support', cost: 4, target: 'ally', effects: { special: 'cleanse' } }] },\n    { level: 10, skills: [{ id: 'milagre-supremo', name: 'Milagre Supremo', description: 'Ultimate: grande cura', type: 'support', cost: 8, target: 'ally', effects: { heal: 40 } }] },\n    { level: 12, skills: [{ id: 'prece-salvao', name: 'Prece da Salvao', description: 'Ressuscita aliado cado (limitaes)', type: 'support', cost: 9, target: 'ally', effects: { special: 'revive_weak' } }] },\n    { level: 15, skills: [{ id: 'luz-serena', name: 'Luz Serena', description: 'Cura em rea moderada', type: 'support', cost: 6, target: 'aoe', effects: { heal: 18 } }] },\n    { level: 18, skills: [{ id: 'selo-purificao', name: 'Selo de Purificao', description: 'Remove debuffs em rea', type: 'support', cost: 6, target: 'aoe', effects: { special: 'mass_cleanse' } }] },\n    { level: 20, skills: [{ id: 'milagre-apoteose', name: 'Milagre da Apoteose', description: 'Ultimate final: grande cura + buff', type: 'support', cost: 10, target: 'aoe', effects: { heal: 45, buff: { attribute: 'sabedoria', percentage: 20 } } }] }\n  ],\n  barbaro: [\n    { level: 3, skills: [{ id: 'furia-totemica', name: 'Fria Totmica', description: 'Aumenta dano em rea', type: 'buff', cost: 5, duration: 2, target: 'self', effects: { special: 'aoe_damage_up' } }] },\n    { level: 5, skills: [{ id: 'sangue-berserker', name: 'Sangue do Berserker', description: 'Aumenta crit + dodge', type: 'buff', cost: 4, duration: 2, target: 'self', effects: { special: 'crit_dodge_up' } }] },\n    { level: 7, skills: [{ id: 'cortar-esmagar', name: 'Cortar e Esmagar', description: 'Ataque em rea', type: 'attack', cost: 6, basePower: 20, element: 'physical', target: 'aoe' }] },\n    { level: 10, skills: [{ id: 'ira-tita', name: 'Ira do Tit', description: 'Ultimate fsico', type: 'attack', cost: 8, basePower: 30, element: 'physical', target: 'aoe', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'rasgar-armadura', name: 'Rasgar Armadura', description: 'Reduz armadura inimiga', type: 'attack', cost: 6, basePower: 22, element: 'physical', target: 'single', effects: { debuff: { special: 'armor_break' } } }] },\n    { level: 15, skills: [{ id: 'grito-intimidador', name: 'Grito Intimidador', description: 'Debuff de dano em rea', type: 'buff', cost: 5, duration: 2, target: 'aoe', effects: { debuff: { special: 'damage_down' } } }] },\n    { level: 18, skills: [{ id: 'frenesi-sangrento', name: 'Frenesi Sangrento', description: 'Buff de dano com risco', type: 'buff', cost: 6, duration: 2, target: 'self', effects: { special: 'damage_up_taken_up' } }] },\n    { level: 20, skills: [{ id: 'terremoto-selvagem', name: 'Terremoto Selvagem', description: 'Ultimate final: rea muito forte', type: 'attack', cost: 10, basePower: 36, element: 'earth', target: 'aoe', cooldown: 5 }] }\n  ],\n  lanceiro: [\n    { level: 3, skills: [{ id: 'lanca-elemental', name: 'Lana Elemental', description: 'Ataque elemental', type: 'attack', cost: 5, basePower: 18, element: 'thunder', target: 'single' }] },\n    { level: 5, skills: [{ id: 'perfuracao-tripla', name: 'Perfurao Tripla', description: 'Trs golpes rpidos', type: 'attack', cost: 6, basePower: 8, element: 'physical', target: 'single', effects: { special: 'triple_strike' } }] },\n    { level: 7, skills: [{ id: 'posicionamento-perfeito', name: 'Posicionamento Perfeito', description: 'Buff de preciso', type: 'buff', cost: 4, duration: 2, target: 'self', effects: { special: 'precision_up' } }] },\n    { level: 10, skills: [{ id: 'impacto-celeste', name: 'Impacto Celeste', description: 'Ultimate de salto', type: 'attack', cost: 8, basePower: 28, element: 'physical', target: 'aoe', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'investida-raio', name: 'Investida do Raio', description: 'Ataque de trovo veloz', type: 'attack', cost: 6, basePower: 22, element: 'thunder', target: 'single' }] },\n    { level: 15, skills: [{ id: 'postura-fortificada', name: 'Postura Fortificada', description: 'Grande defesa temporria', type: 'buff', cost: 6, duration: 2, target: 'self', effects: { buff: { attribute: 'constituicao', percentage: 25 } } }] },\n    { level: 18, skills: [{ id: 'lana-eterna', name: 'Lana Etrea', description: 'Ataque que atravessa mltiplos', type: 'attack', cost: 7, basePower: 24, element: 'physical', target: 'aoe' }] },\n    { level: 20, skills: [{ id: 'juzo-do-cu', name: 'Juzo do Cu', description: 'Ultimate final: trovo em rea', type: 'attack', cost: 10, basePower: 35, element: 'thunder', target: 'aoe', cooldown: 5 }] }\n  ],\n  druida: [\n    { level: 3, skills: [{ id: 'transformacao-parcial', name: 'Transformao Parcial', description: 'Buff de fora', type: 'buff', cost: 4, duration: 2, target: 'self', effects: { buff: { attribute: 'forca', percentage: 20 } } }] },\n    { level: 5, skills: [{ id: 'erupcao-espinhos', name: 'Erupo de Espinhos', description: 'Ataque em rea de terra', type: 'attack', cost: 5, basePower: 18, element: 'earth', target: 'aoe' }] },\n    { level: 7, skills: [{ id: 'semente-vida', name: 'Semente de Vida', description: 'Cura contnua', type: 'support', cost: 5, duration: 3, target: 'ally', effects: { special: 'heal_over_time' } }] },\n    { level: 10, skills: [{ id: 'forma-primordial', name: 'Forma Primordial', description: 'Ultimate de transformao', type: 'buff', cost: 8, duration: 3, target: 'self', effects: { special: 'primal_form' } }] },\n    { level: 12, skills: [{ id: 'pele-casca', name: 'Pele de Casca', description: 'Buff de armadura natural', type: 'buff', cost: 5, duration: 2, target: 'self', effects: { special: 'natural_armor' } }] },\n    { level: 15, skills: [{ id: 'chamado-ancio', name: 'Chamado do Ancio', description: 'Invoca entidade poderosa', type: 'support', cost: 7, target: 'ally', effects: { special: 'summon_ancient' } }] },\n    { level: 18, skills: [{ id: 'tempestade-folhas', name: 'Tempestade de Folhas', description: 'Ataque em rea de natureza', type: 'attack', cost: 7, basePower: 24, element: 'earth', target: 'aoe' }] },\n    { level: 20, skills: [{ id: 'equilibrio-primordial', name: 'Equilbrio Primordial', description: 'Ultimate final: cura + controle', type: 'support', cost: 10, target: 'aoe', effects: { heal: 30, debuff: { special: 'root' } } }] }\n  ],\n  feiticeiro: [\n    { level: 3, skills: [{ id: 'explosao-abissal', name: 'Exploso Abissal', description: 'Ataque de trevas em rea', type: 'attack', cost: 6, basePower: 18, element: 'dark', target: 'aoe' }] },\n    { level: 5, skills: [{ id: 'servos-escuridao', name: 'Servos da Escurido', description: 'Invoca servos', type: 'support', cost: 6, target: 'ally', effects: { special: 'summon_servants' } }] },\n    { level: 7, skills: [{ id: 'marca-negra', name: 'Marca Negra', description: 'Debuff forte', type: 'buff', cost: 5, duration: 2, target: 'single', effects: { debuff: { special: 'strong_debuff' } } }] },\n    { level: 10, skills: [{ id: 'circulo-profano', name: 'Crculo Profano', description: 'Ultimate de trevas', type: 'attack', cost: 8, basePower: 30, element: 'dark', target: 'aoe', cooldown: 4 }] },\n    { level: 12, skills: [{ id: 'correntes-umbras', name: 'Correntes Umbras', description: 'Controle em rea', type: 'buff', cost: 6, duration: 1, target: 'aoe', effects: { debuff: { special: 'bind_area' } } }] },\n    { level: 15, skills: [{ id: 'pacto-sombra', name: 'Pacto da Sombra', description: 'Buff de poder com custo', type: 'buff', cost: 6, duration: 2, target: 'self', effects: { special: 'power_up_health_down' } }] },\n    { level: 18, skills: [{ id: 'colheita-almas', name: 'Colheita de Almas', description: 'Roubo de vida em rea', type: 'attack', cost: 8, basePower: 26, element: 'dark', target: 'aoe' }] },\n    { level: 20, skills: [{ id: 'apoteose-profana', name: 'Apoteose Profana', description: 'Ultimate final: trevas supremas', type: 'attack', cost: 10, basePower: 38, element: 'dark', target: 'aoe', cooldown: 5 }] }\n  ]\n};\n\nexport function getNewSkillsForLevel(heroClass: HeroClass, prevLevel: number, newLevel: number): Skill[] {\n  const defs = PROGRESSION_SKILLS[heroClass] || [];\n  const toUnlock = defs.filter(d => d.level > prevLevel && d.level <= newLevel).flatMap(d => d.skills);\n  return toUnlock;\n}\n\n/**\n * Calcula o dano de uma skill\n */\nexport function calculateSkillDamage(\n  userAttributes: any,\n  skill: Skill,\n  elementMultiplier: number = 1\n): number {\n  if (!skill.basePower) return 0;\n  \n  const attributeBonus = userAttributes.forca * 0.5; // Fora influencia dano fsico\n  const magicBonus = userAttributes.inteligencia * 0.4; // Inteligncia influencia dano mgico\n  \n  const baseBonus = skill.element === 'physical' ? attributeBonus : magicBonus;\n  const totalPower = skill.basePower + baseBonus;\n  \n  return Math.max(1, Math.floor(totalPower * elementMultiplier));\n}\n","import { supabase } from '../lib/supabaseClient';\n\nexport async function updateProgressDelta(delta: { missionsCompleted?: number; achievementsUnlocked?: number; playtimeMinutes?: number; lastLogin?: string | null }) {\n  try {\n    const { data } = await supabase.auth.getUser();\n    const userId = data?.user?.id || null;\n    if (!userId) return;\n    await fetch('/api/player-progress?action=delta', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ user_id: userId, missionsCompleted: delta.missionsCompleted || 0, achievementsUnlocked: delta.achievementsUnlocked || 0, playtimeMinutes: delta.playtimeMinutes || 0, lastLogin: delta.lastLogin || null })\n    });\n  } catch {}\n}\n\nlet heartbeatTimer: any = null;\nexport function startPlaytimeHeartbeat(intervalMinutes = 1) {\n  stopPlaytimeHeartbeat();\n  const ms = Math.max(1, intervalMinutes) * 60 * 1000;\n  heartbeatTimer = setInterval(() => {\n    updateProgressDelta({ playtimeMinutes: intervalMinutes });\n  }, ms);\n}\n\nexport function stopPlaytimeHeartbeat() {\n  if (heartbeatTimer) {\n    try { clearInterval(heartbeatTimer); } catch {}\n    heartbeatTimer = null;\n  }\n}","/**\n * Sistema de Estado de Mundo - WorldState\n * Gerencia decises, consequncias e persistncia narrativa\n */\n\nimport { WorldState, DecisionLogEntry, QuestChoiceEffect, Hero, Attribute } from '../types/hero';\nimport { getGameSettings } from '../store/gameSettingsStore';\n\nexport class WorldStateManager {\n  private static instance: WorldStateManager;\n\n  static getInstance(): WorldStateManager {\n    if (!WorldStateManager.instance) {\n      WorldStateManager.instance = new WorldStateManager();\n    }\n    return WorldStateManager.instance;\n  }\n\n  /**\n   * Inicializa um WorldState vazio para um novo heri\n   */\n  initializeWorldState(): WorldState {\n    return {\n      factions: {\n        guarda: { reputation: 0, alliances: ['clero', 'comerciantes'], enemies: ['ladroes', 'cultistas'], influence: 60 },\n        ladroes: { reputation: 0, alliances: ['cultistas'], enemies: ['guarda', 'comerciantes'], influence: 30 },\n        clero: { reputation: 0, alliances: ['guarda'], enemies: ['cultistas'], influence: 50 },\n        cultistas: { reputation: 0, alliances: ['ladroes'], enemies: ['clero', 'guarda'], influence: 25 },\n        comerciantes: { reputation: 0, alliances: ['guarda', 'exploradores'], enemies: ['ladroes'], influence: 45 },\n        exploradores: { reputation: 0, alliances: ['comerciantes'], enemies: [], influence: 40 }\n      },\n      activeEvents: [],\n      npcStatus: {\n        'Capito da Guarda': { alive: true, relationToPlayer: (Math.random() < 0.45 ? -5 - Math.floor(Math.random() * 10) : Math.floor(Math.random() * 6)), currentLocation: 'Quartel' },\n        'Mercador Aldric': { alive: true, relationToPlayer: (Math.random() < 0.35 ? -5 - Math.floor(Math.random() * 10) : 5), currentLocation: 'Mercado' },\n        'Sbia Elara': { alive: true, relationToPlayer: (Math.random() < 0.4 ? -5 - Math.floor(Math.random() * 10) : Math.floor(Math.random() * 4)), currentLocation: 'Biblioteca' },\n        'Ferreiro Gorin': { alive: true, relationToPlayer: (Math.random() < 0.3 ? -5 - Math.floor(Math.random() * 10) : Math.floor(Math.random() * 4)), currentLocation: 'Forja' }\n      },\n      decisionLog: [],\n      worldEvents: [],\n      locations: {\n        'Vila do Vale': { discovered: true, reputation: 0, questsCompleted: 0 },\n        'Bosque Sombrio': { discovered: false, reputation: 0, questsCompleted: 0 },\n        'Montanhas Geladas': { discovered: false, reputation: 0, questsCompleted: 0 }\n      }\n    };\n  }\n\n  /**\n   * Executa um roll de dados com modificadores\n   */\n  executeRoll(hero: Hero, rollModifiers?: {\n    attribute?: Attribute;\n    multiplier?: number;\n    bonus?: number;\n  }): { roll: number; modifiers: number; total: number } {\n    const baseRoll = Math.floor(Math.random() * 100) + 1;\n    let modifiers = 0;\n\n    if (rollModifiers) {\n      // Modificador por atributo\n      if (rollModifiers.attribute) {\n        const attributeValue = hero.attributes[rollModifiers.attribute];\n        modifiers += attributeValue * (rollModifiers.multiplier || 2);\n      }\n\n      // Bnus fixo\n      if (rollModifiers.bonus) {\n        modifiers += rollModifiers.bonus;\n      }\n\n      // Modificador por sorte (se existir)\n      const luck = (hero as any).luck || 0;\n      modifiers += luck;\n    }\n\n    return {\n      roll: baseRoll,\n      modifiers,\n      total: baseRoll + modifiers\n    };\n  }\n\n  /**\n   * Processa uma escolha de quest e suas consequncias\n   */\n  processChoice(\n    hero: Hero,\n    questId: string,\n    choiceId: string,\n    choiceText: string,\n    successEffects: QuestChoiceEffect[],\n    failureEffects: QuestChoiceEffect[] = [],\n    riskThreshold: number = 50,\n    rollModifiers?: any\n  ): {\n    success: boolean;\n    rollResult: any;\n    appliedEffects: QuestChoiceEffect[];\n    logEntry: DecisionLogEntry;\n  } {\n    // Executar roll\n    const rollResult = this.executeRoll(hero, rollModifiers);\n    const success = rollResult.total >= riskThreshold;\n    \n    // Determinar efeitos a aplicar\n    let effectsToApply = success ? successEffects : failureEffects;\n    try {\n      const reputationTargets: Record<string, number> = {};\n      effectsToApply.forEach(e => {\n        if (e.type === 'reputation' && e.target) {\n          reputationTargets[e.target] = (reputationTargets[e.target] || 0) + Math.abs(e.value || 0);\n        }\n      });\n      const topTargets = Object.entries(reputationTargets)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 2)\n        .map(([t]) => t);\n      effectsToApply = effectsToApply.filter(e => e.type !== 'reputation' || !e.target || topTargets.includes(e.target));\n    } catch {}\n    const appliedEffects: QuestChoiceEffect[] = [];\n\n    // Aplicar efeitos\n    const immediateImpact: any = {};\n    const longTermImpact: any = {};\n\n    const factionAlias: Record<string, string> = {\n      'Comerciantes': 'Livre',\n      'Guarda da Cidade': 'Ordem',\n      'Bandidos': 'Sombra',\n      'Diplomatas': 'Ordem',\n      'Aventureiros': 'Livre'\n    };\n\n    effectsToApply.forEach(effect => {\n      // Verificar probabilidade\n      if (effect.probability && Math.random() > effect.probability) {\n        return;\n      }\n\n      appliedEffects.push(effect);\n\n      switch (effect.type) {\n        case 'gold':\n          immediateImpact.gold = (immediateImpact.gold || 0) + (effect.value || 0);\n          break;\n        case 'xp':\n          immediateImpact.xp = (immediateImpact.xp || 0) + (effect.value || 0);\n          break;\n        case 'reputation':\n          if (effect.target) {\n            const targetName = factionAlias[effect.target] || effect.target;\n            if (!immediateImpact.reputation) immediateImpact.reputation = {};\n            immediateImpact.reputation[targetName] = (effect.value || 0);\n            \n            // Atualizar WorldState\n            if (hero.worldState?.factions[targetName]) {\n              hero.worldState.factions[targetName].reputation += (effect.value || 0);\n            }\n          }\n          break;\n        case 'item':\n          if (effect.target) {\n            if (!immediateImpact.items) immediateImpact.items = [];\n            immediateImpact.items.push(effect.target);\n          }\n          break;\n        case 'npc_relation':\n          if (effect.target && hero.worldState?.npcStatus[effect.target]) {\n            hero.worldState.npcStatus[effect.target].relationToPlayer += (effect.value || 0);\n            if (!longTermImpact.npcRelations) longTermImpact.npcRelations = {};\n            longTermImpact.npcRelations[effect.target] = effect.value || 0;\n          }\n          break;\n        case 'world_event':\n          if (effect.target) {\n            if (!longTermImpact.worldEvents) longTermImpact.worldEvents = [];\n            longTermImpact.worldEvents.push(effect.target);\n          }\n          break;\n        case 'spawn_enemy':\n          if (effect.target) {\n            if (!longTermImpact.worldEvents) longTermImpact.worldEvents = [];\n            longTermImpact.worldEvents.push(`spawn_enemy:${effect.target}`);\n            if (hero.worldState) {\n              hero.worldState.activeEvents.push(`spawn_enemy:${effect.target}`);\n            }\n          }\n          break;\n      }\n    });\n\n    // Evento aleatrio de sorte\n    if (Math.random() < 0.15) {\n      if (!longTermImpact.worldEvents) longTermImpact.worldEvents = [];\n      longTermImpact.worldEvents.push('luck_blessing');\n      if (hero.worldState) {\n        hero.worldState.activeEvents.push('luck_blessing');\n      }\n    }\n\n    // Criar entrada no log de decises\n    const logEntry: DecisionLogEntry = {\n      id: `decision_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      heroId: hero.id,\n      questId,\n      choiceId,\n      choiceText,\n      timestamp: new Date().toISOString(),\n      impact: {\n        immediate: immediateImpact,\n        longTerm: longTermImpact\n      },\n      rollResult: {\n        roll: rollResult.roll,\n        modifiers: rollResult.modifiers,\n        threshold: riskThreshold,\n        success\n      }\n    };\n\n    // Adicionar ao log do WorldState\n    if (hero.worldState) {\n      hero.worldState.decisionLog.push(logEntry);\n    }\n\n    return {\n      success,\n      rollResult: { ...rollResult, threshold: riskThreshold },\n      appliedEffects,\n      logEntry\n    };\n  }\n\n  /**\n   * Verifica se um heri atende aos requisitos de WorldState para uma quest\n   */\n  checkWorldStateRequirements(hero: Hero, requirements: any): boolean {\n    if (!hero.worldState || !requirements) return true;\n\n    // Verificar reputao com faces\n    if (requirements.factionReputation) {\n      const alias: Record<string, string> = {\n        'Aventureiros': 'Livre',\n        'Comerciantes': 'Livre',\n        'Guarda da Cidade': 'Ordem',\n        'Bandidos': 'Sombra',\n        'Diplomatas': 'Ordem'\n      };\n      for (const [faction, minRep] of Object.entries(requirements.factionReputation)) {\n        const key = alias[faction] || faction;\n        const currentRep = hero.worldState.factions[key]?.reputation || 0;\n        if (currentRep < (minRep as number)) {\n          return false;\n        }\n      }\n    }\n\n    // Verificar status de NPCs\n    if (requirements.npcStatus) {\n      for (const [npc, mustBeAlive] of Object.entries(requirements.npcStatus)) {\n        const npcData = hero.worldState.npcStatus[npc];\n        if (!npcData || npcData.alive !== mustBeAlive) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Gera story seeds baseado no estado atual do mundo\n   */\n  generateStorySeeds(hero: Hero): {\n    context: string;\n    tone: string;\n    previousDecisions: string[];\n  } {\n    const worldState = hero.worldState;\n    if (!worldState) {\n      return {\n        context: `Heri ${hero.name}, classe ${hero.class}, nvel ${hero.progression.level}`,\n        tone: 'heroic',\n        previousDecisions: []\n      };\n    }\n\n    // Analisar reputao para determinar tom\n    const avgReputation = Object.values(worldState.factions)\n      .reduce((sum, faction) => sum + faction.reputation, 0) / Object.keys(worldState.factions).length;\n    \n    let tone = 'neutral';\n    if (avgReputation > 20) tone = 'heroic';\n    else if (avgReputation < -20) tone = 'dark';\n    else if (avgReputation > 0) tone = 'hopeful';\n    else tone = 'melancholic';\n\n    // Coletar decises recentes\n    const recentDecisions = worldState.decisionLog\n      .slice(-5)\n      .map(entry => entry.choiceText);\n\n    // Construir contexto\n    const factionSummary = Object.entries(worldState.factions)\n      .filter(([_, data]) => Math.abs(data.reputation) > 10)\n      .map(([name, data]) => `${name}: ${data.reputation > 0 ? 'aliado' : 'inimigo'}`)\n      .join(', ');\n\n    const context = `Heri ${hero.name}, ${hero.class} nvel ${hero.progression.level}. ` +\n      `Reputao: ${factionSummary || 'neutro'}. ` +\n      `Decises recentes afetaram o mundo.`;\n\n    return {\n      context,\n      tone,\n      previousDecisions: recentDecisions\n    };\n  }\n\n  /**\n   * Atualiza stamina do heri\n   */\n  updateStamina(hero: Hero): void {\n    const now = new Date();\n    // Migrao/defesa: alguns heris antigos podem ter stamina como nmero simples\n    if (!hero.stamina || typeof (hero.stamina as any) === 'number') {\n      const currentValue = typeof (hero.stamina as any) === 'number' ? (hero.stamina as any as number) : 100;\n      hero.stamina = {\n        current: Math.max(0, Math.min(100, currentValue)),\n        max: 100,\n        lastRecovery: now.toISOString(),\n        recoveryRate: 0\n      };\n      return;\n    }\n    hero.stamina.lastRecovery = hero.stamina.lastRecovery || now.toISOString();\n  }\n\n  /**\n   * Regenerao automtica de HP e Mana\n   * Usa stats.lastActiveAt como referncia de tempo para evitar alterar tipos.\n   */\n  updateVitals(hero: Hero): void {\n    const now = new Date();\n    // Garantir campos atuais\n    if (!hero.derivedAttributes.currentHp) {\n      hero.derivedAttributes.currentHp = hero.derivedAttributes.hp;\n    }\n    if (!hero.derivedAttributes.currentMp) {\n      hero.derivedAttributes.currentMp = hero.derivedAttributes.mp;\n    }\n\n    // Basear no ltimo timestamp de atividade\n    const lastTs = hero.stats?.lastActiveAt ? new Date(hero.stats.lastActiveAt) : now;\n    const minutesElapsed = (now.getTime() - lastTs.getTime()) / (1000 * 60);\n\n    if (minutesElapsed >= 1) {\n      const wholeMinutes = Math.min(5, Math.floor(minutesElapsed));\n      const settings = getGameSettings();\n      let hpPerMin = settings?.regenHpPerMin ?? 5;\n      let mpPerMin = settings?.regenMpPerMin ?? 5;\n      const statsAny = (hero.stats as any) || {};\n      const restBuffUntil = statsAny.restBuffActiveUntil ? new Date(statsAny.restBuffActiveUntil).getTime() : 0;\n      const inDungeon = Boolean(statsAny.inDungeon);\n      const meditationUntil = statsAny.meditationBuffActiveUntil ? new Date(statsAny.meditationBuffActiveUntil).getTime() : 0;\n      if (restBuffUntil && Date.now() < restBuffUntil) {\n        hpPerMin = Math.round(hpPerMin * (settings?.restBuffHpMpMultiplier ?? 1.5));\n        mpPerMin = Math.round(mpPerMin * (settings?.restBuffHpMpMultiplier ?? 1.5));\n      }\n      if (inDungeon) {\n        hpPerMin = Math.max(1, Math.floor(hpPerMin * (settings?.dungeonRegenMultiplier ?? 0.5)));\n        mpPerMin = Math.max(1, Math.floor(mpPerMin * (settings?.dungeonRegenMultiplier ?? 0.5)));\n      }\n      if (meditationUntil && Date.now() < meditationUntil) {\n        mpPerMin = mpPerMin + (settings?.meditationMpBonusPerMin ?? 8);\n      }\n      const hpRegenAmount = Math.max(hpPerMin, wholeMinutes * hpPerMin);\n      const mpRegenAmount = Math.max(mpPerMin, wholeMinutes * mpPerMin);\n\n      // HP regen\n      if (hero.derivedAttributes.currentHp < hero.derivedAttributes.hp) {\n        hero.derivedAttributes.currentHp = Math.min(\n          hero.derivedAttributes.hp,\n          (hero.derivedAttributes.currentHp || 0) + hpRegenAmount\n        );\n      }\n\n      // Mana regen\n      if (hero.derivedAttributes.currentMp < hero.derivedAttributes.mp) {\n        hero.derivedAttributes.currentMp = Math.min(\n          hero.derivedAttributes.mp,\n          (hero.derivedAttributes.currentMp || 0) + mpRegenAmount\n        );\n      }\n\n      // Atualizar referncia de tempo para prxima contagem\n      if (hero.stats) {\n        hero.stats.lastActiveAt = now.toISOString() as any;\n      }\n    }\n  }\n\n  canAcceptQuest(hero: Hero, staminaCost: number): boolean {\n    const effective = this.computeEffectiveStaminaCost(hero, staminaCost);\n    const currentFatigue = Math.max(0, Number(hero.progression?.fatigue || 0));\n    return currentFatigue + effective <= 100;\n  }\n\n  consumeStamina(hero: Hero, amount: number): boolean {\n    const effective = this.computeEffectiveStaminaCost(hero, amount);\n    const currentFatigue = Math.max(0, Number(hero.progression?.fatigue || 0));\n    if (currentFatigue + effective > 100) {\n      return false;\n    }\n    hero.progression = { ...(hero.progression || {}), fatigue: currentFatigue + effective };\n    return true;\n  }\n \n  getMountStaminaReduction(hero: Hero): number {\n    try {\n      const m = (hero.mounts || []).find(mm => mm.id === hero.activeMountId);\n      if (!m) return 0;\n      const base = Math.max(0, m.speedBonus || 0);\n      const buff = (() => {\n        const mb = hero.mountBuff;\n        if (!mb?.speedBonus) return 0;\n        if (mb.expiresAt && Date.now() > new Date(mb.expiresAt).getTime()) return 0;\n        return Math.max(0, mb.speedBonus || 0);\n      })();\n      const refine = Math.max(0, m.refineLevel || 0);\n      const mastery = Math.max(0, m.mastery || 0);\n      const masteryStep = Math.floor(mastery / 10); // cada 10 nveis de maestria\n      const reduction = (base + buff) * 0.01 + refine * 0.005 + masteryStep * 0.02;\n      return Math.max(0, Math.min(0.4, reduction));\n    } catch {\n      return 0;\n    }\n  }\n\n  computeEffectiveStaminaCost(hero: Hero, baseCost: number): number {\n    const red = this.getMountStaminaReduction(hero);\n    const eff = Math.round(baseCost * (1 - red));\n    return Math.max(1, eff);\n  }\n\n  getQuestBaseStaminaCost(quest: any): number {\n    const d = String(quest?.difficulty || '').toLowerCase();\n    if (d === 'facil') return 20;\n    if (d === 'medio' || d === 'padrao') return 40;\n    if (d === 'dificil') return 60;\n    if (d === 'epica' || d === 'pica') return 80;\n    return 30;\n  }\n\n  rest(hero: Hero, type: 'guild' | 'inn' | 'item', amount?: number): void {\n    const now = new Date().toISOString();\n    const dayKey = new Date().toDateString();\n    if (type === 'item') {\n      const statsAny = (hero.stats as any) || {};\n      if (statsAny.energyPotionDay === dayKey) return;\n      statsAny.energyPotionDay = dayKey;\n      const currentFatigue = Math.max(0, Number(hero.progression?.fatigue || 0));\n      const recover = Math.max(1, amount || 50);\n      const nextFatigue = Math.max(0, currentFatigue - recover);\n      hero.progression = { ...(hero.progression || {}), fatigue: nextFatigue };\n      hero.stats = { ...(hero.stats || {}), ...statsAny } as any;\n    } else {\n      const statsAny = (hero.stats as any) || {};\n      hero.progression = { ...(hero.progression || {}), fatigue: 0 };\n      statsAny.lastRestAt = now;\n      statsAny.daysAdvanced = Math.max(0, Number(statsAny.daysAdvanced || 0)) + 1;\n      if (type === 'inn') {\n        statsAny.innBuffXpPercent = Math.max(0, Number(statsAny.innBuffXpPercent || 5));\n        statsAny.innBuffUsesRemaining = 1;\n      }\n      hero.stats = { ...(hero.stats || {}), ...statsAny } as any;\n      try {\n        this.rotateDailyWorld(hero);\n      } catch {}\n    }\n  }\n\n  rotateDailyWorld(hero: Hero): void {\n    const ws = hero.worldState || this.initializeWorldState();\n    ws.worldEvents = ws.worldEvents || [];\n    ws.worldEvents.push({ type: 'day_advanced', ts: new Date().toISOString() } as any);\n    hero.worldState = ws as any;\n  }\n}\n\nexport const worldStateManager = WorldStateManager.getInstance();\n","import { Hero } from '../types/hero';\nimport { getGameSettings } from '../store/gameSettingsStore';\nimport { notificationBus } from '../components/NotificationSystem';\nimport { computeTier } from './relationshipSystem';\n\nfunction nowIso() { return new Date().toISOString(); }\n\nexport function maybeTriggerSpecialEvents(npc: Hero, player: Hero) {\n  const s = getGameSettings();\n  if (s.randomEventsEnabled === false) return;\n  const relVal = (npc.socialRelations || {})[player.id] || 0;\n  const tier = computeTier(relVal);\n  const mem = npc.npcMemory || { interactions: [], preferences: {}, scoreByAction: {}, lastInteractionByType: {} };\n  const lastEv = mem.lastInteractionByType?.['special_event'];\n  const daysMin = Math.max(2, s.eventsCooldownDaysMin ?? 2);\n  const daysMax = Math.max(daysMin, s.eventsCooldownDaysMax ?? 4);\n  const elapsedDays = lastEv ? (Date.now() - new Date(lastEv).getTime()) / (24 * 60 * 60 * 1000) : 999;\n  if (elapsedDays < daysMin) return;\n  const freqPerDay = Math.max(1, Math.min(5, s.eventsCascadePerDay ?? 2));\n  const chance = Math.min(0.9, freqPerDay / 10); // 0.1..0.5\n  const rivalChance = Math.max(0.15, Math.min(0.3, s.rivalEncounterChance ?? 0.2));\n  const progressLevels = [3,5,7];\n  const tierIndex = tier === 'conhecido' ? 1 : tier === 'amigo' ? 3 : tier === 'melhor_amigo' ? 5 : tier === 'aliado' ? 7 : tier === 'rival' ? 0 : 0;\n  const shouldProgressEvent = progressLevels.includes(tierIndex);\n  if (!shouldProgressEvent && Math.random() >= chance) return;\n  const type = tier === 'rival' && Math.random() < rivalChance ? 'rival_encounter' : (shouldProgressEvent ? 'celebration' : 'welcome');\n  const msg = type === 'celebration' ? `${npc.name} celebra o novo nvel de relao (${tier}).` : type === 'welcome' ? `${npc.name} d boas-vindas ao novo vnculo (${tier}).` : `${npc.name} rival apareceu para testar seu vnculo!`;\n  notificationBus.emit({ type: 'quest', title: 'Evento Especial', message: msg, icon: type === 'celebration' ? '' : type === 'welcome' ? '' : '', duration: 3500 });\n  const li = { ...(mem.lastInteractionByType || {}) };\n  li['special_event'] = nowIso();\n  npc.npcMemory = { ...mem, lastInteractionByType: li };\n}","import { Hero, HeroAttributes } from '../types/hero';\nimport { notificationBus } from '../components/NotificationSystem';\nimport { getGameSettings } from '../store/gameSettingsStore';\nimport { updateOnSocial, cascadeGlobalReputation, randomNpcNpcEvent } from './relationshipSystem';\nimport { maybeTriggerSpecialEvents } from './relationshipEvents';\nimport { getNPCDialogue, getSimsDialogueTriplet } from '../services/npcDialogueService';\nimport { useHeroStore } from '../store/heroStore';\n\ntype RNG = () => number;\n\nconst rng: RNG = () => Math.random();\n\nfunction pick<T>(arr: T[]): T { return arr[Math.floor(rng() * arr.length)]; }\n\nexport function seedPersonality(hero: Hero) {\n  const archetypes: Hero['npcPersonality']['archetype'][] = ['competitivo','colaborativo','mercador','explorador','sabio','caotico'];\n  const chatStyles: Hero['npcPersonality']['chatStyle'][] = ['amigavel','sarcastico','formal','quieto'];\n  const traitsPool = ['impulsivo','estrategista','generoso','ambicioso','curioso','desconfiado','leal','astuto','honrado'];\n  const pers = {\n    archetype: pick(archetypes),\n    traits: Array.from({ length: 3 }, () => pick(traitsPool)),\n    riskAffinity: Math.floor(rng() * 100),\n    chatStyle: pick(chatStyles),\n    prefersParty: rng() < 0.6\n  } as Hero['npcPersonality'];\n  const routine = [\n    { start: '06:00', end: '09:00', activity: 'treino', location: 'sala_treino' },\n    { start: '09:00', end: '12:00', activity: 'missao', location: 'campo' },\n    { start: '12:00', end: '13:00', activity: 'taverna', location: 'taverna' },\n    { start: '13:00', end: '18:00', activity: 'exploracao', location: 'periferia' },\n    { start: '18:00', end: '22:00', activity: 'social', location: 'foja' }\n  ];\n  hero.npcPersonality = pers;\n  hero.npcRoutine = routine;\n  hero.npcMemory = hero.npcMemory || { interactions: [], preferences: {}, scoreByAction: {} };\n}\n\nfunction clamp(v: number, min: number, max: number) { return Math.max(min, Math.min(max, v)); }\n\nfunction adjustAffinity(npc: Hero, targetId: string, delta: number) {\n  const rel = { ...(npc.socialRelations || {}) };\n  rel[targetId] = clamp((rel[targetId] || 0) + delta, -100, 100);\n  npc.socialRelations = rel;\n}\n\nfunction improveAttributes(npc: Hero, mult: number) {\n  const attrs: HeroAttributes = { ...npc.attributes };\n  const keys: (keyof HeroAttributes)[] = ['forca','destreza','constituicao','inteligencia','sabedoria','carisma'];\n  const k = pick(keys);\n  attrs[k] = clamp(attrs[k] + Math.round(1 * mult), 0, 10);\n  return attrs;\n}\n\nexport function runTick(player: Hero | undefined, npcs: Hero[], emit: typeof notificationBus.emit) {\n  const now = new Date();\n  const hour = now.getHours();\n  const settings = getGameSettings();\n  const events: Array<{ type: string; title: string; message: string; icon?: string; duration?: number }> = [];\n  npcs.forEach(npc => {\n    // Mini-life needs drift\n    const needs = npc.npcNeeds || { fadiga: 20, fome: 20, social: 50, aventura: 40, tarefa: 40 };\n    needs.fadiga = Math.min(100, needs.fadiga + 1);\n    needs.fome = Math.min(100, needs.fome + (rng() < 0.5 ? 0 : 1));\n    needs.social = Math.max(0, needs.social - (rng() < 0.5 ? 0 : 1));\n    needs.aventura = Math.min(100, needs.aventura + (Math.random() < 0.3 ? 2 : 0));\n    needs.tarefa = Math.max(0, needs.tarefa - (Math.random() < 0.2 ? 1 : 0));\n    npc.npcNeeds = needs;\n\n    // Mood from needs and routine\n    const fatigueHigh = needs.fadiga > 70;\n    const hungerHigh = needs.fome > 70;\n    const socialLow = needs.social < 30;\n    const baseMood: Hero['npcMood'] = hungerHigh ? 'irritado' : fatigueHigh ? 'cansado' : socialLow ? 'triste' : 'neutro';\n    npc.npcMood = baseMood;\n    const routine = npc.npcRoutine || [];\n    const currentSlot = routine.find(r => {\n      const [sh, sm] = (r.start || '00:00').split(':').map(Number);\n      const [eh, em] = (r.end || '23:59').split(':').map(Number);\n      const h = hour;\n      return h >= sh && h < eh;\n    });\n    const bias = currentSlot?.activity || 'exploracao';\n    if (player) {\n      const relVal = (npc.socialRelations || {})[player.id] || 0;\n      if (relVal >= 40) npc.npcMood = 'feliz';\n      else if (relVal >= 20 && npc.npcMood !== 'irritado' && npc.npcMood !== 'cansado') npc.npcMood = 'tranquilo';\n    }\n    if (bias === 'taverna') {\n      needs.fome = Math.max(0, needs.fome - 15);\n      needs.fadiga = Math.max(0, needs.fadiga - 10);\n      needs.social = Math.min(100, needs.social + 10);\n    }\n    const pool = bias === 'treino' ? ['treino','treino','social','mercado']\n      : bias === 'missao' ? ['missao','missao','exploracao','social']\n      : bias === 'social' ? ['social','social','mercado','treino']\n      : ['exploracao','missao','treino','mercado'];\n    const pref = npc.npcPersonality?.prefersParty ? ['social', ...pool] : pool;\n    const action = pick(pref);\n    if (action === 'treino') {\n      const attrs = improveAttributes(npc, 1);\n      npc.attributes = attrs;\n      npc.stats.totalPlayTime = (npc.stats.totalPlayTime || 0) + 1;\n      npc.npcMemory?.interactions.push({ heroId: npc.id, ts: new Date().toISOString(), summary: 'treino', impact: 1 });\n      events.push({ type: 'xp', title: 'Treino de NPC', message: `${npc.name} aprimorou seus atributos`, icon: '', duration: 2500 });\n      needs.fome = Math.min(100, needs.fome + 2);\n    }\n    if (action === 'missao') {\n      const gainXp = Math.floor(10 + rng() * 40);\n      const gainGold = Math.floor(5 + rng() * 30);\n      npc.progression.xp += gainXp;\n      npc.progression.gold += gainGold;\n      npc.stats.questsCompleted += 1;\n      npc.completedQuests = [...npc.completedQuests, `npc-${Date.now()}`].slice(-50);\n      npc.npcMemory?.interactions.push({ heroId: npc.id, ts: new Date().toISOString(), summary: 'missao', impact: 2 });\n      const ra = Math.max(0, (npc.npcPersonality?.riskAffinity || 0));\n      const adjust = gainXp > 30 ? 2 : -1;\n      npc.npcPersonality = { ...(npc.npcPersonality || { archetype: 'explorador', traits: [], riskAffinity: 50, chatStyle: 'amigavel' }), riskAffinity: clamp(ra + adjust, 0, 100) };\n      events.push({ type: 'quest', title: 'Misso de NPC', message: `${npc.name} concluiu uma misso (+${gainXp} XP, +${gainGold} ouro)`, icon: '', duration: 2800 });\n    }\n    if (action === 'social' && player) {\n      const baseDelta = Math.floor(-1 + rng() * 5);\n      const repBoost = Math.floor(((player.reputationFactions || []).reduce((s, f) => s + Math.max(0, f.reputation), 0)) / 500);\n      const effective = clamp(baseDelta + repBoost, -5, 5);\n      const mood = effective >= 2 ? 'amigvel' : effective <= -2 ? 'hostil' : 'neutro';\n      const relRes = updateOnSocial(npc, player, mood);\n      npc.npcMemory?.interactions.push({ heroId: player.id, ts: new Date().toISOString(), summary: `social_${mood}`, impact: effective });\n      events.push({ type: 'achievement', title: 'Interao Social', message: `${npc.name} interagiu com voc (${mood})`, icon: '', duration: 2500 });\n      const notes = npc.npcMemory?.socialNotesByHeroId || {};\n      const arr = notes[player.id] || [];\n      notes[player.id] = [...arr, `${new Date().toLocaleString()}  ${mood}`].slice(-20);\n      npc.npcMemory = { ...(npc.npcMemory || {}), socialNotesByHeroId: notes };\n      try { maybeTriggerSpecialEvents(npc, player); } catch {}\n      // Atualizar contato\n      const mem = npc.npcMemory || { interactions: [], preferences: {}, scoreByAction: {} };\n      mem.lastContactByHeroId = { ...(mem.lastContactByHeroId || {}), [player.id]: new Date().toISOString() };\n      // Cooldown por tipo\n      const cdSec = settings.npcInteractionCooldownSeconds ?? 90;\n      const nowIso = new Date().toISOString();\n      const canEmitKey = (key: string) => {\n        const last = (mem.lastInteractionByType || {})[key];\n        if (!last) return true;\n        return (Date.now() - new Date(last).getTime()) / 1000 >= cdSec;\n      };\n      mem.lastInteractionByType = mem.lastInteractionByType || {};\n      if (canEmitKey('social')) { mem.lastInteractionByType['social'] = nowIso; } else { events.pop(); }\n      // Verificar amizade\n      const relVal = (npc.socialRelations || {})[player.id] || 0;\n      const positives = (mem.interactions || []).filter(i => i.heroId === player.id && (i.summary.includes('amigvel') || i.summary.includes('missao'))).length;\n      const lastTsStr = (mem.lastContactByHeroId || {})[player.id];\n      const lastMs = lastTsStr ? new Date(lastTsStr).getTime() : 0;\n      const sinceMin = lastMs ? Math.floor((Date.now() - lastMs) / 60000) : 999;\n      const k = settings.npcRelationKnownThreshold ?? 10;\n      const f = settings.npcRelationFriendThreshold ?? 40;\n      const b = settings.npcRelationBestFriendThreshold ?? 75;\n      let status: 'conhecido' | 'amigo' | 'melhor_amigo' | undefined;\n      if (relVal >= b && positives >= 3 && sinceMin <= 180) status = 'melhor_amigo';\n      else if (relVal >= f && positives >= 2 && sinceMin <= 360) status = 'amigo';\n      else if (relVal >= k) status = 'conhecido';\n      if (status) {\n        mem.friendStatusByHeroId = { ...(mem.friendStatusByHeroId || {}), [player.id]: status };\n        npc.npcMemory = mem;\n        const pFriends = Array.isArray(player.friends) ? player.friends : [];\n        const pBest = Array.isArray(player.bestFriends) ? player.bestFriends : [];\n        const updates: Partial<Hero> = {};\n        if (status === 'amigo' && !pFriends.includes(npc.id)) (updates as any).friends = [...pFriends, npc.id];\n        if (status === 'melhor_amigo' && !pBest.includes(npc.id)) (updates as any).bestFriends = [...pBest, npc.id];\n        if (Object.keys(updates).length) {\n          events.push({ type: 'achievement', title: 'Nova Relao', message: `${npc.name} agora  seu ${status.replace('_',' ')}`, icon: '', duration: 2600 });\n        }\n      }\n    }\n    if (action === 'mercado') {\n      const gainGold = Math.floor(3 + rng() * 20);\n      npc.progression.gold += gainGold;\n      const mem = npc.npcMemory || { interactions: [], preferences: {}, scoreByAction: {} };\n      const nowIso = new Date().toISOString();\n      const cdSec = settings.npcInteractionCooldownSeconds ?? 90;\n      const last = (mem.lastInteractionByType || {})['mercado'];\n      if (!last || (Date.now() - new Date(last).getTime()) / 1000 >= cdSec) {\n        events.push({ type: 'item', title: 'Trocas de NPC', message: `${npc.name} negociou no mercado (+${gainGold} ouro)`, icon: '', duration: 2200 });\n        mem.lastInteractionByType = { ...(mem.lastInteractionByType || {}), mercado: nowIso };\n      }\n      npc.npcMemory = mem;\n      needs.fome = Math.max(0, needs.fome - 2);\n    }\n    if (action === 'exploracao') {\n      const found = rng() < 0.3;\n      npc.stats.itemsFound += found ? 1 : 0;\n      const mem = npc.npcMemory || { interactions: [], preferences: {}, scoreByAction: {} };\n      const nowIso = new Date().toISOString();\n      const cdSec = settings.npcInteractionCooldownSeconds ?? 90;\n      const last = (mem.lastInteractionByType || {})['exploracao'];\n      if (!last || (Date.now() - new Date(last).getTime()) / 1000 >= cdSec) {\n        events.push({ type: 'quest', title: 'Explorao de NPC', message: found ? `${npc.name} encontrou um item raro` : `${npc.name} explorou reas prximas`, icon: found ? '' : '', duration: 2200 });\n        mem.lastInteractionByType = { ...(mem.lastInteractionByType || {}), exploracao: nowIso };\n      }\n      npc.npcMemory = mem;\n      needs.fome = Math.min(100, needs.fome + 1);\n    }\n    const mem = npc.npcMemory || { interactions: [], preferences: {}, scoreByAction: {} };\n    const s = mem.scoreByAction || {};\n    s[action] = (s[action] || 0) + 1;\n    mem.scoreByAction = s;\n    npc.npcMemory = mem;\n  });\n  if (npcs.length > 1) {\n    const r = randomNpcNpcEvent(npcs);\n    if (r) events.push({ type: 'quest', title: 'Interao entre NPCs', message: `${r.a.name} e ${r.b.name} interagiram (${r.delta >= 2 ? 'amizade' : r.delta <= -2 ? 'rivalidade' : 'neutro'})`, icon: r.delta >= 2 ? '' : r.delta <= -2 ? '' : '', duration: 2500 });\n  }\n\n  if (player && Math.random() < 0.2) cascadeGlobalReputation(player, npcs);\n\n  // Desafios de duelo (com base na rivalidade e diferena de nvel)\n  if (player) {\n    const mod = (settings.npcInteractionDifficulty === 'high' ? 0.5 : settings.npcInteractionDifficulty === 'low' ? 0.2 : 0.35);\n    const moderate = settings.npcDuelRivalryModerate ?? -30;\n    const high = settings.npcDuelRivalryHigh ?? -60;\n    const maxDiff = settings.npcDuelLevelDiffMax ?? 5;\n    const rivals = npcs.filter(n => {\n      const r = (n.socialRelations || {})[player.id] || 0;\n      const levelDiff = Math.abs((n.progression?.level || n.level || 1) - (player.progression?.level || player.level || 1));\n      return (r <= moderate && levelDiff <= maxDiff);\n    });\n    const friendlyTrainChance = 0.15;\n    const friendly = npcs.filter(n => {\n      const r = (n.socialRelations || {})[player.id] || 0;\n      const levelDiff = Math.abs((n.progression?.level || n.level || 1) - (player.progression?.level || player.level || 1));\n      return (r > moderate && levelDiff <= maxDiff);\n    });\n    const shouldTrain = friendly.length > 0 && Math.random() < friendlyTrainChance;\n    const pool = rivals.length ? rivals : (shouldTrain ? friendly : []);\n    if (pool.length && Math.random() < mod) {\n      const challenger = pick(pool);\n      const r = (challenger.socialRelations || {})[player.id] || 0;\n      const levelDiff = Math.abs((challenger.progression?.level || 1) - (player.progression?.level || 1));\n      const type: 'treino' | 'honra' | 'recompensas' = rivals.includes(challenger) ? (r <= high ? 'honra' : 'treino') : 'treino';\n      const invite = { npcId: challenger.id, type, expiresAt: new Date(Date.now() + 15 * 60 * 1000).toISOString(), levelDiff };\n      const invites = Array.isArray(player.duelInvites) ? player.duelInvites : [];\n      (player as any).duelInvites = [...invites, invite];\n      events.push({ type: 'quest', title: 'Desafio de Duelo', message: `${challenger.name} desafiou voc para um duelo (${type})`, icon: '', duration: 3000 });\n    }\n  }\n\n  // Emit compacted notifications\n  const allowedTitles = new Set(['Interao Social','Nova Relao']);\n  const filtered = events.filter(e => allowedTitles.has(e.title));\n  const maxPerTick = 1;\n  for (let i = 0; i < Math.min(maxPerTick, filtered.length); i++) {\n    const idx = Math.floor(Math.random() * filtered.length);\n    const e = filtered.splice(idx, 1)[0];\n    emit(e);\n  }\n\n  // Sims-like spontaneous interaction trigger\n  // Overlay de dilogo espontneo removido do tick global.\n}","import { Hero } from '../types/hero';\n\ntype DuelType = 'treino' | 'honra' | 'recompensas';\n\nexport interface DuelFrame { attacker: 'a' | 'b'; damage: number; crit: boolean; magic: boolean; aHp: number; bHp: number; aMp: number; bMp: number; }\nexport interface DuelResult {\n  winnerId: string;\n  loserId: string;\n  turns: number;\n  log: string[];\n  rewards: { xp: number; gold: number };\n  frames: DuelFrame[];\n  initial: { aHp: number; bHp: number; aMp: number; bMp: number };\n}\n\nfunction roll(min: number, max: number) { return Math.floor(Math.random() * (max - min + 1)) + min; }\n\nexport function simulateDuel(a: Hero, b: Hero, type: DuelType): DuelResult {\n  const log: string[] = [];\n  let aHp = (a.derivedAttributes.currentHp || a.derivedAttributes.hp);\n  let bHp = (b.derivedAttributes.currentHp || b.derivedAttributes.hp);\n  let aMp = (a.derivedAttributes.currentMp || a.derivedAttributes.mp);\n  let bMp = (b.derivedAttributes.currentMp || b.derivedAttributes.mp);\n  const frames: DuelFrame[] = [];\n  const aAtk = Math.max(1, Math.floor((a.attributes.forca + a.attributes.destreza) * 1.2));\n  const bAtk = Math.max(1, Math.floor((b.attributes.forca + b.attributes.destreza) * 1.2));\n  const aDef = Math.max(0, Math.floor(a.derivedAttributes.armorClass / 2));\n  const bDef = Math.max(0, Math.floor(b.derivedAttributes.armorClass / 2));\n  const aIni = Math.max(0, a.derivedAttributes.initiative);\n  const bIni = Math.max(0, b.derivedAttributes.initiative);\n  const aMag = Math.max(0, Math.floor((a.attributes.inteligencia) * 0.8));\n  const bMag = Math.max(0, Math.floor((b.attributes.inteligencia) * 0.8));\n  const aLuck = Math.max(0, a.derivedAttributes.luck || 0);\n  const bLuck = Math.max(0, b.derivedAttributes.luck || 0);\n\n  let attacker = aIni >= bIni ? 'a' : 'b';\n  let turns = 0;\n  while (aHp > 0 && bHp > 0 && turns < 20) {\n    turns++;\n    const isA = attacker === 'a';\n    const atk = isA ? aAtk : bAtk;\n    const mag = isA ? aMag : bMag;\n    const def = isA ? bDef : aDef;\n    const luck = isA ? aLuck : bLuck;\n    const crit = Math.random() < Math.min(0.25, luck / 100);\n    let useMagic = Math.random() < 0.35;\n    if (useMagic) {\n      if (isA && aMp < 5) useMagic = false;\n      if (!isA && bMp < 5) useMagic = false;\n    }\n    const raw = useMagic ? atk + mag + roll(0, 6) : atk + roll(0, 10);\n    let dmg = Math.max(1, raw - def);\n    if (crit) dmg = Math.floor(dmg * 1.5);\n    if (isA) {\n      bHp = Math.max(0, bHp - dmg);\n      if (useMagic) aMp = Math.max(0, aMp - 5);\n      log.push(`${a.name} ${useMagic ? 'lanou magia' : 'atacou'} e causou ${dmg} dano${crit ? ' (crtico)' : ''}.`);\n    } else {\n      aHp = Math.max(0, aHp - dmg);\n      if (useMagic) bMp = Math.max(0, bMp - 5);\n      log.push(`${b.name} ${useMagic ? 'lanou magia' : 'atacou'} e causou ${dmg} dano${crit ? ' (crtico)' : ''}.`);\n    }\n    frames.push({ attacker: isA ? 'a' : 'b', damage: dmg, crit, magic: useMagic, aHp, bHp, aMp, bMp });\n    attacker = attacker === 'a' ? 'b' : 'a';\n  }\n\n  const aWins = bHp <= 0 || (aHp > bHp);\n  const winner = aWins ? a : b;\n  const loser = aWins ? b : a;\n  const baseXp = 30 + Math.max(0, (loser.progression.level || 1) - (winner.progression.level || 1)) * 2;\n  const baseGold = 20 + Math.max(0, loser.derivedAttributes.power - winner.derivedAttributes.power) * 0.05;\n  let xp = Math.floor(baseXp);\n  let gold = Math.floor(baseGold);\n  if (type === 'honra') xp = Math.floor(xp * 1.2);\n  if (type === 'recompensas') gold = Math.floor(gold * 1.5);\n  log.push(`${winner.name} venceu o duelo aps ${turns} turnos.`);\n  return { winnerId: winner.id, loserId: loser.id, turns, log, rewards: { xp, gold }, frames, initial: { aHp: (a.derivedAttributes.currentHp || a.derivedAttributes.hp), bHp: (b.derivedAttributes.currentHp || b.derivedAttributes.hp), aMp: (a.derivedAttributes.currentMp || a.derivedAttributes.mp), bMp: (b.derivedAttributes.currentMp || b.derivedAttributes.mp) } };\n}","export function playAmbient(volume: number = 0.05) {\n  try {\n    const ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const osc = ctx.createOscillator();\n    const gain = ctx.createGain();\n    osc.type = 'sine';\n    osc.frequency.value = 220;\n    gain.gain.value = volume;\n    osc.connect(gain);\n    gain.connect(ctx.destination);\n    osc.start();\n    setTimeout(() => { osc.stop(); ctx.close(); }, 400);\n  } catch {}\n}\n\nexport function playVoiceCue(pitch: number = 440, durationMs: number = 250) {\n  try {\n    const ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const osc = ctx.createOscillator();\n    const gain = ctx.createGain();\n    osc.type = 'triangle';\n    osc.frequency.value = pitch;\n    gain.gain.value = 0.08;\n    osc.connect(gain);\n    gain.connect(ctx.destination);\n    osc.start();\n    setTimeout(() => { osc.stop(); ctx.close(); }, Math.max(50, durationMs));\n  } catch {}\n}","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface MonetizationState {\n  adsEnabled: boolean;\n  adsRemoved: boolean;\n  adSenseClientId?: string;\n  adSlotBannerTop?: string;\n  adSlotInterstitial?: string;\n  interstitialVisible: boolean;\n  lastInterstitialAt?: number;\n  interstitialMinIntervalMinutes: number;\n  interstitialOnChapterMilestones: boolean;\n  ownedProducts: Record<string, { purchasedAt: string }>;\n  receipts: Record<string, { id: string; purchasedAt: string; payload?: any }>; \n  ownedFrames: string[];\n  activeFrameId?: string;\n  ownedThemes: string[];\n  activeThemeId?: string;\n  activeSeasonalTheme?: 'natal' | 'pascoa' | 'ano_novo' | 'carnaval';\n  seasonalAutoEnabled: boolean;\n  ownedDLCs: string[];\n  seasonPassActive?: { active: boolean; expiresAt?: string };\n  tipJarLevel?: 'none' | 'bronze' | 'silver' | 'gold';\n  setConfig: (cfg: Partial<MonetizationState>) => void;\n  setAdSenseClient: (clientId?: string) => void;\n  triggerInterstitial: (reason: 'chapter' | 'manual') => void;\n  hideInterstitial: () => void;\n  markPurchase: (productId: string, receipt: { id: string; payload?: any }) => void;\n  removeAdsForever: () => void;\n  setActiveFrame: (frameId?: string) => void;\n  setActiveTheme: (themeId?: string) => void;\n  setActiveSeasonalTheme: (themeId?: 'natal' | 'pascoa' | 'ano_novo' | 'carnaval') => void;\n  autoApplySeasonal: () => void;\n}\n\nexport const useMonetizationStore = create<MonetizationState>()(\n  persist(\n    (set, get) => ({\n      adsEnabled: true,\n      adsRemoved: false,\n      adSenseClientId: undefined,\n      adSlotBannerTop: undefined,\n      adSlotInterstitial: undefined,\n      interstitialVisible: false,\n      lastInterstitialAt: undefined,\n      interstitialMinIntervalMinutes: 15,\n      interstitialOnChapterMilestones: true,\n      ownedProducts: {},\n      receipts: {},\n      ownedFrames: [],\n      activeFrameId: undefined,\n      ownedThemes: [],\n      activeThemeId: undefined,\n      ownedDLCs: [],\n      seasonPassActive: { active: false },\n      tipJarLevel: 'none',\n      seasonalAutoEnabled: true,\n      setConfig: (cfg) => set({ ...(get()), ...cfg }),\n      setAdSenseClient: (clientId) => set({ adSenseClientId: clientId }),\n      triggerInterstitial: (reason) => {\n        const s = get();\n        if (!s.adsEnabled || s.adsRemoved) return;\n        const now = Date.now();\n        const last = s.lastInterstitialAt || 0;\n        const minMs = Math.max(1, s.interstitialMinIntervalMinutes) * 60_000;\n        if (now - last < minMs) return;\n        set({ interstitialVisible: true, lastInterstitialAt: now });\n      },\n      hideInterstitial: () => set({ interstitialVisible: false }),\n      markPurchase: (productId, receipt) => {\n        const currentOwned = { ...(get().ownedProducts) };\n        const currentReceipts = { ...(get().receipts) };\n        currentOwned[productId] = { purchasedAt: new Date().toISOString() };\n        currentReceipts[productId] = { id: receipt.id, purchasedAt: new Date().toISOString(), payload: receipt.payload };\n        const next: Partial<MonetizationState> = { ownedProducts: currentOwned, receipts: currentReceipts };\n        if (productId.startsWith('frame-')) {\n          const frameId = productId.replace('frame-', '');\n          const frames = new Set([...(get().ownedFrames || [])]);\n          frames.add(frameId);\n          next.ownedFrames = Array.from(frames);\n        } else if (productId.startsWith('theme-')) {\n          const themeId = productId.replace('theme-', '');\n          const themes = new Set([...(get().ownedThemes || [])]);\n          themes.add(themeId);\n          next.ownedThemes = Array.from(themes);\n        } else if (productId === 'remove-ads') {\n          next.adsRemoved = true; next.adsEnabled = false; next.interstitialVisible = false;\n        } else if (productId === 'season-pass') {\n          next.seasonPassActive = { active: true };\n        }\n        set(next as any);\n      },\n      removeAdsForever: () => set({ adsRemoved: true, adsEnabled: false, interstitialVisible: false }),\n      setActiveFrame: (frameId) => set({ activeFrameId: frameId })\n      ,setActiveTheme: (themeId) => set({ activeThemeId: themeId })\n      ,setActiveSeasonalTheme: (themeId) => set({ activeSeasonalTheme: themeId })\n      ,autoApplySeasonal: () => {\n        const now = new Date();\n        const m = now.getMonth();\n        const d = now.getDate();\n        let theme: 'natal' | 'pascoa' | 'ano_novo' | 'carnaval' | undefined;\n        if (m === 11 && d >= 1) theme = 'natal';\n        else if ((m === 3 && d >= 1) || (m === 4 && d <= 30)) theme = 'pascoa';\n        else if (m === 0 && d <= 7) theme = 'ano_novo';\n        else if (m === 1 && d >= 10 && d <= 28) theme = 'carnaval';\n        if (theme) set({ activeSeasonalTheme: theme });\n      }\n    }),\n    {\n      name: 'heroforge-monetization',\n      version: 1,\n      partialize: (state) => ({\n        adsEnabled: state.adsEnabled,\n        adsRemoved: state.adsRemoved,\n        adSenseClientId: state.adSenseClientId,\n        adSlotBannerTop: state.adSlotBannerTop,\n        adSlotInterstitial: state.adSlotInterstitial,\n        interstitialMinIntervalMinutes: state.interstitialMinIntervalMinutes,\n        interstitialOnChapterMilestones: state.interstitialOnChapterMilestones,\n        ownedProducts: state.ownedProducts,\n        receipts: state.receipts,\n        ownedFrames: state.ownedFrames,\n        activeFrameId: state.activeFrameId,\n        ownedThemes: state.ownedThemes,\n        activeThemeId: state.activeThemeId,\n        ownedDLCs: state.ownedDLCs,\n        seasonPassActive: state.seasonPassActive,\n        tipJarLevel: state.tipJarLevel,\n        activeSeasonalTheme: state.activeSeasonalTheme,\n        seasonalAutoEnabled: state.seasonalAutoEnabled\n      })\n    }\n  )\n);\n\nexport const getMonetization = () => useMonetizationStore.getState();","import { create } from 'zustand'\nimport { persist } from 'zustand/middleware'\nimport { Hero } from '../types/hero'\nimport { rankSystem } from '../utils/rankSystem'\nimport { notificationBus } from '../components/NotificationSystem'\nimport { onboardingManager } from '../utils/onboardingSystem'\n\ntype FeatureKey = 'training_basic' | 'hunting_basic' | 'shop_basic' | 'crafting_simple' | 'stable_basic'\n\ninterface UnlockLogEntry {\n  id: string\n  feature: FeatureKey\n  heroId?: string\n  details?: string\n  ts: number\n}\n\ninterface GateStatus {\n  enabled: boolean\n  reason?: string\n  nextHint?: string\n}\n\ninterface ProgressionState {\n  featuresUnlocked: Record<FeatureKey, boolean>\n  basicTrainingOnly: boolean\n  unlockLog: UnlockLogEntry[]\n  requirements: {\n    hunting_basic: { minLevel: number; minCompletedQuests?: number }\n    shop_basic: { minRank: 'E' | 'D' | 'C' | 'B' | 'A' | 'S' | 'SS' | 'SSS'; minColetaQuests?: number }\n    crafting_simple: { minRank: 'E' | 'D' | 'C' | 'B' | 'A' | 'S' | 'SS' | 'SSS'; minCompletedQuests?: number }\n    stable_basic: { minLevel: number; requiresGuildQuestId?: string }\n  }\n  isFeatureEnabled: (feature: FeatureKey, hero?: Hero) => boolean\n  getGateStatus: (feature: FeatureKey, hero?: Hero) => GateStatus\n  setFeatureUnlocked: (feature: FeatureKey, hero?: Hero, details?: string) => void\n  evaluateUnlocks: (hero: Hero, prev?: Hero) => void\n  setBasicTrainingOnly: (value: boolean) => void\n}\n\nconst initialFlags: Record<FeatureKey, boolean> = {\n  training_basic: true,\n  hunting_basic: false,\n  shop_basic: false,\n  crafting_simple: false,\n  stable_basic: false\n}\n\nexport const useProgressionStore = create<ProgressionState>()(\n  persist(\n    (set, get) => ({\n      featuresUnlocked: initialFlags,\n      basicTrainingOnly: true,\n      unlockLog: [],\n      requirements: {\n        hunting_basic: { minLevel: 2, minCompletedQuests: 0 },\n        shop_basic: { minRank: 'E', minColetaQuests: 5 },\n        crafting_simple: { minRank: 'E', minCompletedQuests: 1 },\n        stable_basic: { minLevel: 5, requiresGuildQuestId: 'guild-ovo-basico' }\n      },\n      \n      \n      isFeatureEnabled: (feature, hero) => {\n        const flags = get().featuresUnlocked\n        if (feature === 'training_basic') return true\n        const enabled = !!flags[feature]\n        if (!enabled) return false\n        if (feature === 'hunting_basic') return true\n        if (feature === 'shop_basic') return true\n        if (feature === 'crafting_simple') return true\n        if (feature === 'stable_basic') return true\n        return enabled\n      },\n      getGateStatus: (feature, hero) => {\n        const enabled = get().isFeatureEnabled(feature, hero)\n        if (enabled) return { enabled }\n        if (!hero) return { enabled: false }\n        if (feature === 'hunting_basic') {\n          const req = get().requirements.hunting_basic\n          const lvl = hero.progression.level\n          const qc = hero.stats.questsCompleted || 0\n          const needLevel = lvl < req.minLevel\n          const needQuests = (req.minCompletedQuests || 0) > 0 && qc < (req.minCompletedQuests || 0)\n          const reason = needLevel ? `Requer nvel ${req.minLevel}` : needQuests ? `Requer ${req.minCompletedQuests} misses concludas` : 'Progresso insuficiente'\n          const nextHint = needLevel ? `Nvel atual ${lvl}` : needQuests ? `Misses concludas ${qc}` : `Nvel ${lvl}, Rank ${rankSystem.calculateRank(hero)}`\n          return { enabled: false, reason, nextHint }\n        }\n        if (feature === 'shop_basic' || feature === 'crafting_simple') {\n          const req = feature === 'shop_basic' ? get().requirements.shop_basic : get().requirements.crafting_simple\n          const rank = rankSystem.calculateRank(hero)\n          const order = ['F','E','D','C','B','A','S','SS','SSS']\n          const okRank = order.indexOf(rank) >= order.indexOf(req.minRank)\n          const coleta = (hero.stats as any).collectionQuestsCompleted || 0\n          const qc = hero.stats.questsCompleted || 0\n          const okQuests = feature === 'shop_basic' ? coleta >= (req.minColetaQuests || 0) : qc >= (req.minCompletedQuests || 0)\n          const reason = !okRank ? `Requer rank ${req.minRank}` : !okQuests ? (feature === 'shop_basic' ? `Requer ${req.minColetaQuests} misses de coleta concludas` : `Requer ${req.minCompletedQuests} misses concludas`) : 'Progresso insuficiente'\n          const nextHint = !okRank ? `Rank atual ${rank}` : !okQuests ? (feature === 'shop_basic' ? `Coletas concludas ${coleta}` : `Misses concludas ${qc}`) : `Rank ${rank}, Nvel ${hero.progression.level}`\n          return { enabled: false, reason, nextHint }\n        }\n        if (feature === 'stable_basic') {\n          const req = get().requirements.stable_basic\n          const lvl = hero.progression.level\n          const okLevel = lvl >= req.minLevel\n          const doneQuest = (hero.stats as any).stableUnlockQuestCompleted === true\n          const reason = !okLevel ? `Requer nvel ${req.minLevel}` : !doneQuest ? `Concluir misso da guilda para liberar o Estbulo` : 'Progresso insuficiente'\n          const nextHint = !okLevel ? `Nvel atual ${lvl}` : !doneQuest ? `Misso pendente: ${req.requiresGuildQuestId}` : `Nvel ${lvl}`\n          return { enabled: false, reason, nextHint }\n        }\n        return { enabled: false }\n      },\n      setFeatureUnlocked: (feature, hero, details) => {\n        const now = Date.now()\n        const flags = { ...get().featuresUnlocked, [feature]: true }\n        const entry: UnlockLogEntry = {\n          id: `${feature}-${now}`,\n          feature,\n          heroId: hero?.id,\n          details,\n          ts: now\n        }\n        set({ featuresUnlocked: flags, unlockLog: [...get().unlockLog, entry] })\n        notificationBus.emit({ type: 'achievement', title: 'Nova funcionalidade desbloqueada!', message: feature.replace('_', ' ') })\n      },\n      evaluateUnlocks: (hero, prev) => {\n        const flags = get().featuresUnlocked\n        const prevLevel = prev?.progression.level ?? hero.progression.level\n        const prevRank = prev ? rankSystem.calculateRank(prev) : rankSystem.calculateRank(hero)\n        const newLevel = hero.progression.level\n        const newRank = rankSystem.calculateRank(hero)\n        if (!flags.hunting_basic) {\n          const req = get().requirements.hunting_basic\n          const qc = hero.stats.questsCompleted || 0\n          const unlocked = prevLevel < req.minLevel && newLevel >= req.minLevel && qc >= (req.minCompletedQuests || 0)\n          if (unlocked) {\n            get().setFeatureUnlocked('hunting_basic', hero, 'Alcanou requisitos de caa bsica')\n            try { onboardingManager.startFlow('unlock-hunting-basic') } catch {}\n            set({ basicTrainingOnly: false })\n          }\n        }\n        const rankOrder = ['F','E','D','C','B','A','S','SS','SSS']\n        const prevIdx = rankOrder.indexOf(prevRank)\n        const newIdx = rankOrder.indexOf(newRank)\n        if (prevIdx < 1 && newIdx >= 1) {\n          const qc = hero.stats.questsCompleted || 0\n          const reqShop = get().requirements.shop_basic\n          const reqForge = get().requirements.crafting_simple\n          const coleta = (hero.stats as any).collectionQuestsCompleted || 0\n          if (!flags.shop_basic && coleta >= (reqShop.minColetaQuests || 0)) {\n            get().setFeatureUnlocked('shop_basic', hero, 'Alcanou requisitos da loja bsica')\n            try { onboardingManager.startFlow('unlock-shop-basic') } catch {}\n          }\n          if (!flags.crafting_simple && qc >= (reqForge.minCompletedQuests || 0)) {\n            get().setFeatureUnlocked('crafting_simple', hero, 'Alcanou requisitos de craft simples')\n            try { onboardingManager.startFlow('unlock-crafting-simple') } catch {}\n          }\n        }\n        if (!flags.stable_basic) {\n          const reqSt = get().requirements.stable_basic\n          const okLevel = hero.progression.level >= reqSt.minLevel\n          const doneQuest = (hero.stats as any).stableUnlockQuestCompleted === true\n          if (okLevel && doneQuest) {\n            get().setFeatureUnlocked('stable_basic', hero, 'Misso da guilda concluda e nvel alcanado')\n          }\n        }\n      },\n      setBasicTrainingOnly: (value) => set({ basicTrainingOnly: value })\n    }),\n    { name: 'hfn-progression-store' }\n  )\n)","import { Egg, EggIdentifiedInfo, EggRarity, Pet, PetClass, PetElementType, PetMutationInfo, PetStage, HeroAttributes } from '../types/hero';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport const EGG_IDENTIFY_COST: Record<EggRarity, { min: number; max: number }> = {\n  comum: { min: 50, max: 80 },\n  incomum: { min: 80, max: 150 },\n  raro: { min: 150, max: 300 },\n  epico: { min: 300, max: 500 },\n  lendario: { min: 400, max: 800 },\n  mistico: { min: 600, max: 1200 }\n};\n\nexport const INCUBATION_MS: Record<EggRarity, number> = {\n  comum: 5 * 60 * 1000,\n  incomum: 15 * 60 * 1000,\n  raro: 60 * 60 * 1000,\n  epico: 3 * 60 * 60 * 1000,\n  lendario: 6 * 60 * 60 * 1000,\n  mistico: 12 * 60 * 60 * 1000\n};\n\nexport function generateMysteryEgg(rarity?: EggRarity): Egg {\n  const baseRarities: EggRarity[] = ['comum', 'incomum', 'raro', 'epico', 'lendario'];\n  const roll = Math.random();\n  const chosen: EggRarity = rarity || (roll > 0.98 ? 'lendario' : roll > 0.9 ? 'epico' : roll > 0.7 ? 'raro' : roll > 0.4 ? 'incomum' : 'comum');\n  const templates: Array<{ name: string; type: PetElementType; rarity: EggRarity }> = [\n    { name: 'Ovo Feral Lacrado', type: 'feral', rarity: 'raro' },\n    { name: 'Ovo Arcano Reluzente', type: 'arcano', rarity: 'epico' },\n    { name: 'Ovo Sagrado Ancestral', type: 'sagrado', rarity: 'lendario' },\n    { name: 'Ovo Sombrio Profano', type: 'sombrio', rarity: 'epico' },\n    { name: 'Ovo Mstico do Vu', type: 'arcano', rarity: 'mistico' }\n  ];\n  let name = 'Ovo Misterioso';\n  const candidatesForName: Record<string, string[]> = {\n    'Ovo Feral Lacrado': ['Lobinho Cinzento', 'Javali Espinhoso', 'Raposa de Cinzas'],\n    'Ovo Arcano Reluzente': ['Espectro de Mana', 'Fada Celeste', 'Arcandeo'],\n    'Ovo Sagrado Ancestral': ['Esprito Guardio', 'Grifo Jovem', 'Fenrir Branco'],\n    'Ovo Sombrio Profano': ['Corvo Sombrio', 'Shade Menor', 'Hiena Macabra'],\n    'Ovo Mstico do Vu': ['Silfo do Vu', 'Serafim Menor', 'Arconte Luminal']\n  };\n  if (chosen === 'raro' || chosen === 'epico' || chosen === 'lendario') {\n    const pool = templates.filter(t => t.rarity === chosen);\n    if (pool.length && Math.random() < 0.6) {\n      name = pool[Math.floor(Math.random() * pool.length)].name;\n    }\n  }\n  return {\n    id: uuidv4(),\n    name,\n    status: 'misterioso',\n    baseRarity: chosen,\n    description: 'Um ovo encontrado em locais perigosos. S a Guilda pode dizer o que h dentro.',\n    createdAt: new Date().toISOString()\n  };\n}\n\nconst TYPES: PetElementType[] = ['feral', 'arcano', 'sagrado', 'sombrio'];\nconst CLASSES: PetClass[] = ['coleta', 'combate', 'suporte'];\n\nexport function identifyEgg(egg: Egg): EggIdentifiedInfo {\n  let type = TYPES[Math.floor(Math.random() * TYPES.length)];\n  const petClass = CLASSES[Math.floor(Math.random() * CLASSES.length)];\n  const rarity = egg.baseRarity;\n  const skillChancePercent = rarity === 'comum' ? 5 : rarity === 'incomum' ? 8 : rarity === 'raro' ? 12 : rarity === 'epico' ? 16 : rarity === 'lendario' ? 22 : 28;\n  const bonus: Partial<HeroAttributes> = petClass === 'combate'\n    ? { forca: 2 }\n    : petClass === 'suporte'\n      ? { sabedoria: 2 }\n      : { destreza: 2 };\n  let candidates: string[] | undefined;\n  if (egg.name === 'Ovo Feral Lacrado') { type = 'feral'; candidates = ['Lobinho Cinzento', 'Javali Espinhoso', 'Raposa de Cinzas']; }\n  if (egg.name === 'Ovo Arcano Reluzente') { type = 'arcano'; candidates = ['Espectro de Mana', 'Fada Celeste', 'Arcandeo']; }\n  if (egg.name === 'Ovo Sagrado Ancestral') { type = 'sagrado'; candidates = ['Esprito Guardio', 'Grifo Jovem', 'Fenrir Branco']; }\n  if (egg.name === 'Ovo Sombrio Profano') { type = 'sombrio'; candidates = ['Corvo Sombrio', 'Shade Menor', 'Hiena Macabra']; }\n  if (egg.name === 'Ovo Mstico do Vu') { type = 'arcano'; candidates = ['Silfo do Vu', 'Serafim Menor', 'Arconte Luminal']; }\n  const revealedName = egg.name.startsWith('Ovo ') ? egg.name : `Ovo ${capitalize(type)} ${capitalize(rarity)}`;\n  return { type, petClass, rarity, initialBonus: bonus, skillChancePercent, revealedName, candidates };\n}\n\nexport function incubateEgg(egg: Egg): Egg {\n  const ms = INCUBATION_MS[egg.identified?.rarity || egg.baseRarity];\n  return { ...egg, status: 'incubando', incubationEndsAt: new Date(Date.now() + ms).toISOString() };\n}\n\nexport function canHatch(egg: Egg): boolean {\n  if (!egg.incubationEndsAt) return false;\n  return Date.now() >= new Date(egg.incubationEndsAt).getTime();\n}\n\nexport function markReadyToHatch(egg: Egg): Egg {\n  if (!egg.incubationEndsAt) return egg;\n  if (canHatch(egg)) return { ...egg, status: 'pronto_para_chocar' };\n  return egg;\n}\n\nexport function rollMutation(rarity: EggRarity): PetMutationInfo | undefined {\n  const chance = rarity === 'raro' ? 0.02 : rarity === 'epico' ? 0.04 : rarity === 'lendario' ? 0.07 : rarity === 'mistico' ? 0.10 : 0;\n  if (Math.random() > chance) return undefined;\n  const variants: PetMutationInfo['variant'][] = ['albino', 'sombrio_corrupto', 'arcano_puro', 'feral_brutal', 'sagrado'];\n  const variant = variants[Math.floor(Math.random() * variants.length)];\n  const badge = variant === 'albino' ? '' : variant === 'sombrio_corrupto' ? '' : variant === 'arcano_puro' ? '' : variant === 'feral_brutal' ? '' : '';\n  return { variant, visualBadge: badge };\n}\n\nconst PET_CANDIDATES: Record<PetElementType, string[]> = {\n  feral: ['Lobinho Cinzento', 'Javali Espinhoso', 'Raposa de Cinzas'],\n  arcano: ['Espectro de Mana', 'Fada Celeste', 'Fada Silvestre', 'Golem Pequeno', 'Arcandeo'],\n  sagrado: ['Esprito Guardio', 'Grifo Jovem', 'Fenrir Branco'],\n  sombrio: ['Corvo Sombrio', 'Shade Menor', 'Hiena Macabra']\n};\n\nexport function hatchPet(egg: Egg): Pet {\n  const info = egg.identified!;\n  const namePool = (info.candidates && info.candidates.length ? info.candidates : PET_CANDIDATES[info.type]) || ['Companheiro Misterioso'];\n  const name = namePool[Math.floor(Math.random() * namePool.length)];\n  const qualityRoll = Math.floor(Math.random() * 100);\n  const mutation = rollMutation(info.rarity);\n  let exclusiveSkill = undefined;\n  const attributes = { ...(info.initialBonus || {}) } as Partial<HeroAttributes>;\n  // Skill inicial pela chance\n  const skillMap: Record<PetElementType, string> = {\n    feral: 'Instinto Feral',\n    arcano: 'Pulso Arcano',\n    sagrado: 'Aura Sagrada',\n    sombrio: 'Sussurro Sombrio'\n  };\n  if (Math.random() * 100 < (info.skillChancePercent || 0)) {\n    exclusiveSkill = skillMap[info.type];\n  }\n  // Ajustes por mutao\n  if (mutation?.variant === 'albino') attributes.carisma = (attributes.carisma || 0) + 1;\n  if (mutation?.variant === 'sombrio_corrupto') attributes.inteligencia = (attributes.inteligencia || 0) + 1;\n  if (mutation?.variant === 'arcano_puro') {\n    attributes.inteligencia = (attributes.inteligencia || 0) + 1;\n    attributes.sabedoria = (attributes.sabedoria || 0) + 1;\n  }\n  if (mutation?.variant === 'feral_brutal') attributes.forca = (attributes.forca || 0) + 1;\n  if (mutation?.variant === 'sagrado') attributes.sabedoria = (attributes.sabedoria || 0) + 1;\n  return {\n    id: uuidv4(),\n    name,\n    type: info.type,\n    petClass: info.petClass,\n    rarity: info.rarity,\n    qualityRoll,\n    level: 1,\n    stage: 'bebe',\n    mutation,\n    attributes,\n    exclusiveSkill,\n    energy: 100,\n    createdAt: new Date().toISOString()\n  };\n}\n\nexport function getStageFromLevel(level: number): PetStage {\n  if (level >= 30) return 'forma_final';\n  if (level >= 20) return 'adulto';\n  if (level >= 10) return 'jovem';\n  return 'bebe';\n}\n\nexport function addPetXP(pet: Pet, xp: number): Pet {\n  const levelsGained = Math.max(0, Math.floor(xp / 100));\n  const newLevel = Math.min(30, pet.level + levelsGained);\n  const newStage = getStageFromLevel(newLevel);\n  let exclusiveSkill = pet.exclusiveSkill;\n  if (!exclusiveSkill && newStage === 'forma_final') {\n    const skillByName: Record<string, string> = {\n      'Lobinho Cinzento': 'Instinto Feral',\n      'Fada Silvestre': 'Aura Sagrada',\n      'Fada Celeste': 'Aura Sagrada',\n      'Golem Pequeno': 'Sussurro Sombrio',\n      'Espectro de Mana': 'Pulso Arcano'\n    };\n    exclusiveSkill = skillByName[pet.name] || `${capitalize(pet.type)} Ascendente`;\n  }\n  return { ...pet, level: newLevel, stage: newStage, exclusiveSkill };\n}\n\nexport function accelerateIncubation(egg: Egg, msReduction: number): Egg {\n  if (!egg.incubationEndsAt) return egg;\n  const endMs = new Date(egg.incubationEndsAt).getTime();\n  const newEnd = Math.max(Date.now(), endMs - msReduction);\n  const updated = { ...egg, incubationEndsAt: new Date(newEnd).toISOString() };\n  return markReadyToHatch(updated);\n}\n\nfunction capitalize(s: string) { return s.charAt(0).toUpperCase() + s.slice(1); }\n","import { Hero } from '../types/hero'\n\nconst KEY = 'hero_slots_state'\n\ntype SlotsState = {\n  baseSlots: number\n  purchasedSlots: number\n  purchases: Array<{ ts: number; price: number }>\n  basePrice: number\n  incrementPercent: number\n}\n\nfunction load(): SlotsState {\n  try {\n    const raw = localStorage.getItem(KEY)\n    if (raw) return JSON.parse(raw)\n  } catch {}\n  return { baseSlots: 3, purchasedSlots: 0, purchases: [], basePrice: 100, incrementPercent: 0.25 }\n}\n\nfunction save(s: SlotsState) {\n  try { localStorage.setItem(KEY, JSON.stringify(s)) } catch {}\n}\n\nexport function getBaseSlots() { return load().baseSlots }\n\nexport function setPricing(basePrice: number, incrementPercent: number) {\n  const s = load()\n  s.basePrice = Math.max(1, Math.floor(basePrice))\n  s.incrementPercent = Math.max(0, incrementPercent)\n  save(s)\n}\n\nexport function getPurchasedSlots() { return Math.min(5, load().purchasedSlots) }\n\nexport function getProgressionSlots(heroes: Hero[]): number {\n  const ranks = (heroes || []).map(h => (h as any)?.rankData?.currentRank || 'F')\n  const hasB = ranks.some(r => r >= 'B')\n  const hasS = ranks.some(r => r >= 'S')\n  let slots = 0\n  if (hasB) slots += 1\n  if (hasS) slots += 1\n  return slots\n}\n\nexport function getCapacity(heroes: Hero[]): number {\n  const s = load()\n  const cap = s.baseSlots + getProgressionSlots(heroes) + Math.min(5, s.purchasedSlots)\n  return Math.min(10, cap)\n}\n\nexport function getUsed(heroes: Hero[]): number {\n  return (heroes || []).filter(h => h.origin !== 'npc').length\n}\n\nexport function canCreateHero(heroes: Hero[]): boolean {\n  return getUsed(heroes) < getCapacity(heroes)\n}\n\nexport function getNextSlotPrice(): number {\n  const s = load()\n  const n = Math.min(5, s.purchasedSlots)\n  const price = Math.round(s.basePrice * Math.pow(1 + s.incrementPercent, n))\n  return price\n}\n\nexport function purchaseSlot(spendGold: (amount: number) => boolean): boolean {\n  const s = load()\n  if (s.purchasedSlots >= 5) return false\n  const price = getNextSlotPrice()\n  const ok = spendGold(price)\n  if (!ok) return false\n  s.purchasedSlots += 1\n  s.purchases.push({ ts: Date.now(), price })\n  save(s)\n  return true\n}","/**\n * Sistema de Validao de Atributos\n * Verso 3.0 - Forjador de Heris\n */\n\nimport { HeroAttributes } from '../types/hero';\nimport { RankLevel, RANK_ORDER } from '../types/ranks';\n\nexport const ATTRIBUTE_CONSTRAINTS = {\n  MIN_ATTRIBUTE: 1,\n  MAX_ATTRIBUTE: 10,\n  STARTING_POINTS_PER_ATTRIBUTE: 1\n};\n\nexport function getMaxAttributeForRank(rank: RankLevel): number {\n  const idx = Math.max(0, RANK_ORDER.indexOf(rank));\n  return ATTRIBUTE_CONSTRAINTS.MAX_ATTRIBUTE + idx * 10;\n}\n\nexport function getTotalAttributePointsCapForRank(rank: RankLevel): number {\n  const idx = Math.max(0, RANK_ORDER.indexOf(rank));\n  return (ATTRIBUTE_CONSTRAINTS.MAX_ATTRIBUTE + idx * 10) * 6;\n}\n\nexport const ATTRIBUTE_INFO = {\n  forca: {\n    name: 'Fora',\n    icon: '',\n    description: 'Determina o dano fsico e capacidade de carregar equipamentos pesados'\n  },\n  destreza: {\n    name: 'Destreza',\n    icon: '',\n    description: 'Afeta preciso, esquiva e velocidade de movimento'\n  },\n  constituicao: {\n    name: 'Constituio',\n    icon: '',\n    description: 'Determina pontos de vida e resistncia a doenas'\n  },\n  inteligencia: {\n    name: 'Inteligncia',\n    icon: '',\n    description: 'Afeta dano mgico, mana e habilidades de conhecimento'\n  },\n  sabedoria: {\n    name: 'Sabedoria',\n    icon: '',\n    description: 'Influencia percepo, intuio e resistncia mental'\n  },\n  carisma: {\n    name: 'Carisma',\n    icon: '',\n    description: 'Determina habilidades sociais e liderana'\n  }\n};\n\n/**\n * Cria atributos iniciais com valores mnimos\n */\nexport function createInitialAttributes(): HeroAttributes {\n  return {\n    forca: ATTRIBUTE_CONSTRAINTS.STARTING_POINTS_PER_ATTRIBUTE,\n    destreza: ATTRIBUTE_CONSTRAINTS.STARTING_POINTS_PER_ATTRIBUTE,\n    constituicao: ATTRIBUTE_CONSTRAINTS.STARTING_POINTS_PER_ATTRIBUTE,\n    inteligencia: ATTRIBUTE_CONSTRAINTS.STARTING_POINTS_PER_ATTRIBUTE,\n    sabedoria: ATTRIBUTE_CONSTRAINTS.STARTING_POINTS_PER_ATTRIBUTE,\n    carisma: ATTRIBUTE_CONSTRAINTS.STARTING_POINTS_PER_ATTRIBUTE\n  };\n}\n\n/**\n * Calcula pontos restantes para distribuir\n */\nexport function calculateRemainingPoints(_attributes: HeroAttributes): number {\n  return 0;\n}\n\n/**\n * Valida se os atributos esto dentro dos limites\n */\nexport function validateAttributes(attributes: HeroAttributes): {\n  valid: boolean;\n  errors: string[];\n  totalPoints: number;\n  remainingPoints: number;\n} {\n  const errors: string[] = [];\n  // Verifica valores mnimos/mximos por atributo\n  Object.entries(attributes).forEach(([attr, value]) => {\n    if (value < ATTRIBUTE_CONSTRAINTS.MIN_ATTRIBUTE) {\n      errors.push(`${ATTRIBUTE_INFO[attr as keyof HeroAttributes].name} deve ter pelo menos ${ATTRIBUTE_CONSTRAINTS.MIN_ATTRIBUTE} ponto`);\n    }\n    if (value > ATTRIBUTE_CONSTRAINTS.MAX_ATTRIBUTE) {\n      errors.push(`${ATTRIBUTE_INFO[attr as keyof HeroAttributes].name} no pode ter mais que ${ATTRIBUTE_CONSTRAINTS.MAX_ATTRIBUTE} pontos`);\n    }\n  });\n  const totalPoints = Object.values(attributes).reduce((sum, value) => sum + value, 0);\n  return {\n    valid: errors.length === 0,\n    errors,\n    totalPoints,\n    remainingPoints: 0\n  };\n}\n\n/**\n * Verifica se  possvel aumentar um atributo\n */\nexport function canIncreaseAttribute(\n  attributes: HeroAttributes,\n  attribute: keyof HeroAttributes\n): boolean {\n  const currentValue = attributes[attribute];\n  return currentValue < ATTRIBUTE_CONSTRAINTS.MAX_ATTRIBUTE;\n}\n\n/**\n * Verifica se  possvel diminuir um atributo\n */\nexport function canDecreaseAttribute(\n  attributes: HeroAttributes,\n  attribute: keyof HeroAttributes\n): boolean {\n  const currentValue = attributes[attribute];\n  return currentValue > ATTRIBUTE_CONSTRAINTS.MIN_ATTRIBUTE;\n}\n\n/**\n * Aumenta um atributo se possvel\n */\nexport function increaseAttribute(\n  attributes: HeroAttributes,\n  attribute: keyof HeroAttributes\n): HeroAttributes {\n  if (!canIncreaseAttribute(attributes, attribute)) {\n    return attributes;\n  }\n  \n  return {\n    ...attributes,\n    [attribute]: attributes[attribute] + 1\n  };\n}\n\n/**\n * Diminui um atributo se possvel\n */\nexport function decreaseAttribute(\n  attributes: HeroAttributes,\n  attribute: keyof HeroAttributes\n): HeroAttributes {\n  if (!canDecreaseAttribute(attributes, attribute)) {\n    return attributes;\n  }\n  \n  return {\n    ...attributes,\n    [attribute]: attributes[attribute] - 1\n  };\n}\n\n/**\n * Distribui pontos automaticamente de forma balanceada\n */\nexport function autoDistributePoints(baseAttributes?: Partial<HeroAttributes>): HeroAttributes {\n  const attributes = createInitialAttributes();\n  if (baseAttributes) {\n    Object.entries(baseAttributes).forEach(([attr, bonus]) => {\n      const key = attr as keyof HeroAttributes;\n      const inc = Math.min(bonus || 0, ATTRIBUTE_CONSTRAINTS.MAX_ATTRIBUTE - attributes[key]);\n      attributes[key] += inc;\n    });\n  }\n  return attributes;\n}","export const LEVEL_CAP = 20;\nexport const ATTRIBUTE_POINTS_PER_LEVEL = 3;\n\nexport function calculateXPForLevel(level: number): number {\n  if (level <= 1) return 0;\n  if (level === 2) return 150;\n  return level * 100 + (level - 1) * 50;\n}\n\nexport function checkLevelUp(currentXP: number, currentLevel: number): number {\n  let level = currentLevel;\n  while (level < LEVEL_CAP && currentXP >= calculateXPForLevel(level + 1)) {\n    level++;\n  }\n  return level;\n}\n\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Hero, HeroCreationData, HeroAttributes, DerivedAttributes, Quest, Achievement, Guild, CombatResult, Title } from '../types/hero';\nimport type { Party } from '../types/hero';\nimport type { HeroInventory } from '../types/hero';\nimport type { ReferralInvite } from '../types/hero';\nimport type { EnhancedQuestChoice } from '../types/hero';\nimport { generateQuestBoard, generateQuest, QUEST_ACHIEVEMENTS } from '../utils/quests';\nimport { resolveCombat, autoResolveCombat } from '../utils/combat';\nimport { purchaseItem, sellItem, equipItem, useConsumable, SHOP_ITEMS, ITEM_SETS, generateProceduralItem } from '../utils/shop';\nimport { Jewel } from '../types/jewel';\nimport type { JewelType } from '../types/jewel';\nimport { RECIPES } from '../utils/forging';\nimport { updateHeroReputation, generateReputationEvents, inferQuestFactionChanges } from '../utils/reputationSystem';\nimport { generateAllLeaderboards, getHeroRanking, calculateTotalScore } from '../utils/leaderboardSystem';\nimport { generateDailyGoals, updateDailyGoalProgress, checkPerfectDayGoal, removeExpiredGoals, getDailyGoalRewards } from '../utils/dailyGoalsSystem';\nimport { getTitleAttributeBonus, AVAILABLE_TITLES, TITLE_ACHIEVEMENTS, updateAchievementProgress as updateTitleAchievementProgress, checkTitleUnlock } from '../utils/titles';\nimport { onboardingManager } from '../utils/onboardingSystem';\nimport { eventManager } from '../utils/eventSystem';\nimport { logActivity } from '../utils/activitySystem';\nimport { trackMetric } from '../utils/metricsSystem';\nimport { supabase } from '../lib/supabaseClient';\nimport { saveHero, canPerformAction, performAction, consumeInnXpBuff } from '../services/heroesService';\nimport { notificationBus } from '../components/NotificationSystem';\nimport { rankSystem } from '../utils/rankSystem';\nimport { RANK_XP_BONUS_PERCENT } from '../types/ranks';\nimport { computeSynergyBonus } from '../utils/synergy';\nimport { getNewSkillsForLevel } from '../utils/skillSystem';\nimport { updateProgressDelta } from '../services/progressService';\nimport { worldStateManager } from '../utils/worldState';\nimport { runTick as runNPCTick, seedPersonality } from '../utils/npcAI';\nimport { updateOnSocial } from '../utils/relationshipSystem';\nimport { simulateDuel } from '../utils/duel';\nimport { playAmbient, playVoiceCue } from '../utils/audio';\nimport { getGameSettings, useGameSettingsStore } from './gameSettingsStore';\nimport { getMonetization } from './monetizationStore';\nimport { useProgressionStore } from './progressionStore';\nimport { generateMysteryEgg, identifyEgg as utilIdentifyEgg, incubateEgg, canHatch, markReadyToHatch, hatchPet, accelerateIncubation, EGG_IDENTIFY_COST, INCUBATION_MS, addPetXP } from '../utils/pets';\nimport { canCreateHero, purchaseSlot, getCapacity, getUsed, getNextSlotPrice } from '../services/heroSlots';\nimport { ATTRIBUTE_CONSTRAINTS, getMaxAttributeForRank, getTotalAttributePointsCapForRank } from '../utils/attributeSystem';\nimport { ATTRIBUTE_POINTS_PER_LEVEL, checkLevelUp } from '../utils/progression';\n\ninterface HeroState {\n  heroes: Hero[];\n  selectedHeroId: string | null;\n  availableQuests: Quest[];\n  questCatalog: Record<string, Quest>;\n  guilds: Guild[];\n  parties: Party[];\n  referralInvites: ReferralInvite[];\n  dmOverrideLine?: string;\n  duelOverlay?: any;\n  npcInteractionOverlay?: any;\n  activitiesLog: Array<{ ts: string; type: 'dialogue' | 'rumor' | 'tip' | 'event'; location?: 'tavern' | 'guild'; npcId?: string; text: string; importance?: 'low' | 'normal' | 'high' }>;\n  lastAutoInteractionAt?: string;\n  dedupeNPCs: () => { checked: number; removed: number };\n  staminaModal?: { required: number; actionType: string; message?: string };\n  setStaminaModal: (modal?: { required: number; actionType: string; message?: string }) => void;\n  // Mascotes e Ovos\n  generateEggForSelected: (rarity?: import('../types/hero').EggRarity) => boolean;\n  identifyEggForSelected: (eggId: string) => boolean;\n  startIncubationForSelected: (eggId: string, slotIndex?: number) => boolean;\n  accelerateIncubationForSelected: (eggId: string, method: 'essencia' | 'brasas' | 'ouro', value?: number) => boolean;\n  updateIncubationTick: () => void;\n  hatchEggForSelected: (eggId: string) => boolean;\n  consumeInventoryItem: (heroId: string, itemId: string, qty?: number) => boolean;\n  addPetXPForSelected: (petId: string, xp: number) => boolean;\n  sellPetForSelected: (petId: string) => boolean;\n  \n  // === AES BSICAS ===\n  createHero: (heroData: HeroCreationData) => Hero;\n  purchaseHeroSlotForSelected: () => boolean;\n  updateHero: (id: string, heroData: Partial<Hero>) => void;\n  deleteHero: (id: string) => void;\n  selectHero: (id: string | null) => void;\n  exportHeroJson: (id: string) => string;\n  importHero: (hero: Hero, selectAfter?: boolean) => boolean;\n  \n  // === SISTEMA DE MISSES ===\n  refreshQuests: (heroLevel?: number) => void;\n  acceptQuest: (heroId: string, questId: string) => Promise<boolean>;\n  completeQuest: (heroId: string, questId: string, autoResolve?: boolean) => CombatResult | null;\n  abandonQuest: (heroId: string, questId: string) => boolean;\n  clearActiveQuests: (heroId: string) => boolean;\n  \n  // === SISTEMA DE PROGRESSO ===\n  gainXP: (heroId: string, xp: number) => void;\n  gainGold: (heroId: string, gold: number) => void;\n  gainGlory: (heroId: string, glory: number) => void;\n  gainArcaneEssence: (heroId: string, essence: number) => void;\n  addItemToInventory: (heroId: string, itemId: string, quantity?: number) => void;\n  checkAchievements: (heroId: string) => Achievement[];\n  // Pontos de atributo\n  allocateAttributePoints: (heroId: string, allocations: Partial<HeroAttributes>) => boolean;\n\n  // === SISTEMA DE COMPANHEIROS ===\n  setActivePet: (petId?: string) => void;\n  setActiveMount: (mountId?: string) => void;\n  setFavoriteMount: (mountId?: string) => void;\n  toggleFavoriteMount: (mountId: string) => void;\n\n  // Joias\n  addJewel: (heroId: string, tipo: JewelType, nivel: number, qty?: number) => boolean;\n  socketJewel: (heroId: string, itemId: string, jewelKey: string) => boolean;\n  removeJewel: (heroId: string, itemId: string, socketIndex: number) => boolean;\n  fuseJewels: (heroId: string, jewelKey: string) => boolean;\n  toggleLockMount: (mountId: string) => boolean;\n  generateMountForSelected: (type?: import('../types/hero').Mount['type'], rarity?: import('../types/hero').MountRarity) => boolean;\n  renameMountForSelected: (mountId: string, newName: string) => boolean;\n  setMountNoteForSelected: (mountId: string, note: string) => boolean;\n  buyMountOffer: (heroId: string, type: import('../types/hero').Mount['type'], rarity: import('../types/hero').MountRarity, price: number) => boolean;\n  trainMountForSelected: (costGold?: number, bonusSpeed?: number, minutes?: number) => Promise<boolean>;\n  importMountsForSelected: (json: string) => boolean;\n  releaseCommonMounts: () => boolean;\n  addMountToSelected: (mount: import('../types/hero').Mount) => boolean;\n  evolveMountForSelected: (mountId: string) => boolean;\n  refineCompanion: (heroId: string, kind: 'pet' | 'mount', id: string) => boolean;\n  refinePetForSelected: (petId: string) => boolean;\n  refineMountForSelected: (mountId: string) => boolean;\n  suggestCompanionQuestForSelected: () => boolean;\n  \n  // === SISTEMA DE LOJA ===\n  buyItem: (heroId: string, itemId: string) => boolean;\n  sellItem: (heroId: string, itemId: string, quantity?: number) => boolean;\n  equipItem: (heroId: string, itemId: string) => boolean;\n  useItem: (heroId: string, itemId: string) => boolean;\n  upgradeItem: (heroId: string, itemId: string) => boolean;\n  craftItem: (heroId: string, recipeId: string) => boolean;\n  // Servios de Forja\n  refineEquippedItem: (heroId: string, slot: 'weapon' | 'armor' | 'accessory') => boolean;\n  fuseItems: (heroId: string, itemAId: string, itemBId: string) => boolean;\n  enchantEquippedItem: (heroId: string, slot: 'weapon' | 'armor' | 'accessory', enchant: 'lifesteal') => boolean;\n  \n  // Taverna / Descanso\n      restAtTavern: (heroId: string, costGold: number, fatigueRecovery: number, restType?: string) => boolean;\n  \n  // === SISTEMA DE GUILDAS ===\n  createGuild: (heroId: string, guildName: string, description: string) => Guild | null;\n  joinGuild: (heroId: string, guildId: string) => boolean;\n  leaveGuild: (heroId: string) => boolean;\n  depositGoldToGuild: (heroId: string, amount: number) => boolean;\n  withdrawGoldFromGuild: (heroId: string, amount: number) => boolean;\n  contributeXPToGuild: (heroId: string, amount: number) => boolean;\n  setGuildRole: (guildId: string, actorId: string, targetId: string, role: 'lider' | 'oficial' | 'membro') => boolean;\n  transferGuildLeadership: (guildId: string, actorId: string, newLeaderId: string) => boolean;\n  ensureDefaultGuildExists: () => void;\n  \n  // === SISTEMA DE TTULOS E REPUTAO ===\n  setActiveTitle: (titleId?: string) => void;\n  addTitleToSelectedHero: (title: Title, setActive?: boolean) => void;\n  toggleFavoriteTitle: (titleId: string, favored?: boolean) => void;\n  updateAchievementProgress: () => void;\n  updateReputation: (factionName: string, change: number) => void;\n  processReputationEvents: () => void;\n  \n  // === SISTEMA DE METAS DIRIAS ===\n  generateDailyGoalsForHero: (heroId: string) => void;\n  updateDailyGoalProgress: (heroId: string, goalType: string, amount?: number) => void;\n  completeDailyGoal: (heroId: string, goalId: string) => void;\n  cleanupExpiredGoals: (heroId: string) => void;\n  \n  // Onboarding\n  shouldShowOnboarding: () => boolean;\n  markOnboardingShown: () => void;\n  triggerOnboardingForNewUser: () => void;\n  \n  // Leaderboard functions\n  getLeaderboards: () => any;\n  getHeroRanking: (heroId: string) => any;\n  calculateHeroScore: (heroId: string) => number;\n  \n  // === SISTEMA DE RANKS v2.2 ===\n  promoteHero: (heroId: string) => boolean;\n  getHeroRankProgress: (heroId: string) => any;\n  getRankLeaderboard: () => any[];\n  markCelebrationViewed: (heroId: string, celebrationIndex: number) => void;\n  \n  // === GETTERS ===\n  getSelectedHero: () => Hero | undefined;\n  getHeroQuests: (heroId: string) => Quest[];\n  getHeroGuild: (heroId: string) => Guild | undefined;\n  getQuestById: (id: string) => Quest | undefined;\n\n\n  // === SISTEMA DE CONVITES ===\n  createReferralInvite: (inviterHeroId: string) => ReferralInvite | null;\n  getReferralInvitesForHero: (heroId: string) => ReferralInvite[];\n  acceptReferralInvite: (code: string, newHeroId: string) => boolean;\n  revokeReferralInvite: (inviteId: string) => boolean;\n  expireOldInvites: () => void;\n  getReferralStatsForHero: (heroId: string) => { total: number; pending: number; accepted: number; expired: number; rewardsGranted: number };\n  logReferralActivity: (inviteId: string, action: 'shared' | 'revoked' | 'expired' | 'accepted', details?: string) => void;\n  updateReferralInvite: (inviteId: string, updates: Partial<Pick<ReferralInvite, 'inviterTag' | 'personalizedSlug' | 'expiresAt'>>) => boolean;\n  renewReferralInvite: (inviteId: string, extraDays?: number) => boolean;\n  getReferralInviteByCode: (code: string) => ReferralInvite | undefined;\n\n  // === NARRATIVA ===\n  setDMOverrideLine: (line?: string) => void;\n  appendJourneyNarrativeForSelected: (summary: string, title?: string) => boolean;\n\n  createNPCAdventurer: (overrides?: Partial<HeroCreationData & { name: string }>) => Hero;\n  ensureNPCAdventurersSeedExists: (targetCount?: number) => void;\n  startNPCSimulation: () => void;\n  stopNPCSimulation: () => void;\n  seedRandomHatred: (count?: number) => void;\n  getDuelInvitesForHero: (heroId: string) => { npcId: string; type: 'treino' | 'honra' | 'recompensas'; expiresAt: string; levelDiff: number }[];\n  acceptDuelInvite: (heroId: string, npcId: string) => boolean;\n  declineDuelInvite: (heroId: string, npcId: string) => boolean;\n  setDuelOverlay: (overlay?: any) => void;\n  setNPCInteractionOverlay: (overlay?: any) => void;\n  respondToNPCInteraction: (choice: 'accept' | 'decline' | 'later') => Promise<void>;\n  setPartyInviteTerms: (partyId: string, targetHeroId: string, terms: { duration: 'one_mission' | 'days'; days?: number; rewardShare?: number; leaderPref?: 'inviter' | 'invitee' | 'none' }) => void;\n  recordActivity: (entry: { type: 'dialogue' | 'rumor' | 'tip' | 'event'; location?: 'tavern' | 'guild'; npcId?: string; text: string; importance?: 'low' | 'normal' | 'high' }) => void;\n  triggerAutoInteraction: (location: 'tavern' | 'guild') => void;\n}\n\n// === VALIDAO E CLCULOS ===\n\nexport const validateAttributes = (attributes: HeroAttributes): { isValid: boolean; errors: string[] } => {\n  const errors: string[] = [];\n  const total = Object.values(attributes).reduce((sum, value) => sum + value, 0);\n  \n  if (total > 18) {\n    errors.push(`Total de pontos (${total}) excede o mximo de 18`);\n  }\n  \n  Object.entries(attributes).forEach(([attr, value]) => {\n    if (value < 0) {\n      errors.push(`${attr} no pode ser negativo`);\n    }\n    if (value > 10) {\n      errors.push(`${attr} no pode exceder 10 pontos`);\n    }\n  });\n  \n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n};\n\nconst calculateTotalAttributes = (\n  baseAttributes: HeroAttributes,\n  inventory: HeroInventory\n): HeroAttributes => {\n  const totalAttributes = { ...baseAttributes };\n  \n  // Aplicar bnus dos equipamentos\n  const equippedItems = [\n    inventory.equippedMainHand,\n    inventory.equippedOffHand,\n    inventory.equippedHelm,\n    inventory.equippedChest,\n    inventory.equippedBelt,\n    inventory.equippedGloves,\n    inventory.equippedBoots,\n    inventory.equippedCape,\n    inventory.equippedRingLeft,\n    inventory.equippedRingRight,\n    inventory.equippedNecklace,\n    inventory.equippedEarringLeft,\n    inventory.equippedEarringRight,\n    ...(Array.isArray(inventory.equippedWeapons) ? inventory.equippedWeapons : [inventory.equippedWeapon].filter(Boolean) as string[]),\n    ...(Array.isArray(inventory.equippedArmorSlots) ? inventory.equippedArmorSlots : [inventory.equippedArmor].filter(Boolean) as string[]),\n    ...(Array.isArray(inventory.equippedAccessories) ? inventory.equippedAccessories : [inventory.equippedAccessory].filter(Boolean) as string[])\n  ].filter(Boolean);\n  \n  equippedItems.forEach(itemId => {\n    const item = SHOP_ITEMS.find(i => i.id === itemId) || (inventory.customItems ? inventory.customItems[itemId!] : undefined);\n    const upgradeLevel = inventory.upgrades?.[itemId!] ?? 0;\n    if (item?.bonus) {\n      Object.entries(item.bonus).forEach(([attr, bonus]) => {\n        if (!bonus) return;\n        const multiplier = 1 + Math.max(0, upgradeLevel) * 0.1;\n        const adjusted = Math.round((bonus as number) * multiplier);\n        const key = (attr === 'sabedoria') ? 'inteligencia' : (attr === 'carisma') ? 'destreza' : attr;\n        if ((key as keyof HeroAttributes) in totalAttributes) {\n          totalAttributes[key as keyof HeroAttributes] += adjusted;\n        }\n      });\n    }\n    const jewels = (inventory.equippedJewelsByItemId || {})[itemId!];\n    if (Array.isArray(jewels) && jewels.length > 0) {\n      const cap = item?.type === 'weapon' ? 10 : item?.type === 'armor' ? 15 : item?.type === 'accessory' ? 8 : 0;\n      let attrAdds: Partial<HeroAttributes> = {};\n      let sum = 0;\n      jewels.forEach(jk => {\n        const parts = jk.split(':');\n        if (parts.length === 3) {\n          const tipo = parts[1] as import('../types/jewel').JewelType;\n          const nivel = Number(parts[2]);\n          const j = new Jewel(crypto.randomUUID(), tipo, nivel);\n          const b = j.getBonus();\n          if (b.forca) { attrAdds.forca = (attrAdds.forca || 0) + b.forca; sum += b.forca; }\n          if (b.inteligencia) { attrAdds.inteligencia = (attrAdds.inteligencia || 0) + b.inteligencia; sum += b.inteligencia; }\n          if (b.destreza) { attrAdds.destreza = (attrAdds.destreza || 0) + b.destreza; sum += b.destreza; }\n          if (b.constituicao) { attrAdds.constituicao = (attrAdds.constituicao || 0) + b.constituicao; sum += b.constituicao; }\n        }\n      });\n      const scale = cap > 0 && sum > cap ? (cap / sum) : 1;\n      Object.entries(attrAdds).forEach(([attr, val]) => {\n        if (!val) return;\n        const key = (attr === 'sabedoria') ? 'inteligencia' : (attr === 'carisma') ? 'destreza' : attr;\n        if ((key as keyof HeroAttributes) in totalAttributes) {\n          const add = Math.max(0, Math.floor((val as number) * scale));\n          totalAttributes[key as keyof HeroAttributes] += add;\n        }\n      });\n    }\n  });\n\n  // Aplicar bnus de conjunto (arma + armadura + acessrio do mesmo conjunto)\n  const weaponSetIds = ([inventory.equippedMainHand, inventory.equippedOffHand] as (string | undefined)[])\n    .filter(Boolean)\n    .map((id) => {\n      const base = id ? SHOP_ITEMS.find(i => i.id === id) : undefined;\n      const custom = id && inventory.customItems ? inventory.customItems[id] : undefined;\n      return (base || custom)?.setId;\n    })\n    .filter((sid): sid is string => !!sid);\n  const armorSetIds = ([inventory.equippedHelm, inventory.equippedChest, inventory.equippedBelt, inventory.equippedGloves, inventory.equippedBoots, inventory.equippedCape] as (string | undefined)[])\n    .filter(Boolean)\n    .map((id) => {\n      const base = id ? SHOP_ITEMS.find(i => i.id === id) : undefined;\n      const custom = id && inventory.customItems ? inventory.customItems[id] : undefined;\n      return (base || custom)?.setId;\n    })\n    .filter((sid): sid is string => !!sid);\n  const accessorySetIds = ([inventory.equippedRingLeft, inventory.equippedRingRight, inventory.equippedNecklace, inventory.equippedEarringLeft, inventory.equippedEarringRight] as (string | undefined)[])\n    .filter(Boolean)\n    .map((id) => {\n      const base = id ? SHOP_ITEMS.find(i => i.id === id) : undefined;\n      const custom = id && inventory.customItems ? inventory.customItems[id] : undefined;\n      return (base || custom)?.setId;\n    })\n    .filter((sid): sid is string => !!sid);\n\n  for (const w of weaponSetIds) {\n    if (armorSetIds.includes(w) && accessorySetIds.includes(w)) {\n      const activeSet = ITEM_SETS[w];\n      if (activeSet?.bonus) {\n        Object.entries(activeSet.bonus).forEach(([attr, bonus]) => {\n          if (!bonus) return;\n          const key = (attr === 'sabedoria') ? 'inteligencia' : (attr === 'carisma') ? 'destreza' : attr;\n          if ((key as keyof HeroAttributes) in totalAttributes) {\n            totalAttributes[key as keyof HeroAttributes] += bonus as number;\n          }\n        });\n      }\n      break;\n    }\n  }\n  \n  return totalAttributes;\n};\n\nexport const calculateDerivedAttributes = (\n  attributes: HeroAttributes,\n  heroClass: string,\n  level: number,\n  inventory?: HeroInventory,\n  activeTitleId?: string,\n  companionBonus?: Partial<HeroAttributes>\n): DerivedAttributes => {\n  const keyParts = [\n    heroClass,\n    String(level),\n    JSON.stringify(attributes),\n    inventory ? JSON.stringify({\n      ew: [inventory.equippedMainHand, inventory.equippedOffHand, ...(Array.isArray(inventory.equippedWeapons) ? inventory.equippedWeapons : [])].filter(Boolean).join(','),\n      ea: [inventory.equippedHelm, inventory.equippedChest, inventory.equippedBelt, inventory.equippedGloves, inventory.equippedBoots, inventory.equippedCape, ...(Array.isArray(inventory.equippedArmorSlots) ? inventory.equippedArmorSlots : [])].filter(Boolean).join(','),\n      ex: [inventory.equippedRingLeft, inventory.equippedRingRight, inventory.equippedNecklace, inventory.equippedEarringLeft, inventory.equippedEarringRight, ...(Array.isArray(inventory.equippedAccessories) ? inventory.equippedAccessories : [])].filter(Boolean).join(','),\n      ic: Object.keys(inventory.items || {}).length\n    }) : 'noinv',\n    activeTitleId || '',\n    companionBonus ? JSON.stringify(companionBonus) : 'nocomp'\n  ];\n  const cacheKey = keyParts.join('|');\n  const selfAny = calculateDerivedAttributes as unknown as { _cache?: Map<string, DerivedAttributes> };\n  if (!selfAny._cache) selfAny._cache = new Map<string, DerivedAttributes>();\n  const cached = selfAny._cache.get(cacheKey);\n  if (cached) return cached;\n  // Calcular atributos totais incluindo bnus de equipamentos\n  const baseTotal = inventory ? calculateTotalAttributes(attributes, inventory) : attributes;\n  const titleBonus = getTitleAttributeBonus(activeTitleId);\n  const totalAttributes: HeroAttributes = { ...baseTotal } as HeroAttributes;\n  Object.entries(titleBonus).forEach(([attr, bonus]) => {\n    if (!bonus) return;\n    const key = (attr === 'sabedoria') ? 'inteligencia' : (attr === 'carisma') ? 'destreza' : attr;\n    if ((key as keyof HeroAttributes) in totalAttributes) {\n      totalAttributes[key as keyof HeroAttributes] += bonus as number;\n    }\n  });\n  if (companionBonus) {\n    Object.entries(companionBonus).forEach(([attr, bonus]) => {\n      if (!bonus) return;\n      const key = (attr === 'sabedoria') ? 'inteligencia' : (attr === 'carisma') ? 'destreza' : attr;\n      if ((key as keyof HeroAttributes) in totalAttributes) {\n        totalAttributes[key as keyof HeroAttributes] += bonus as number;\n      }\n    });\n  }\n  \n  let hpBase = 0;\n  let mpBase = 0;\n  \n  switch (heroClass) {\n    case 'guerreiro':\n      hpBase = 10;\n      mpBase = 3;\n      break;\n    case 'mago':\n      hpBase = 6;\n      mpBase = 10;\n      break;\n    case 'ladino':\n      hpBase = 8;\n      mpBase = 6;\n      break;\n    case 'clerigo':\n      hpBase = 8;\n      mpBase = 8;\n      break;\n    case 'patrulheiro':\n      hpBase = 8;\n      mpBase = 6;\n      break;\n    case 'paladino':\n      hpBase = 10;\n      mpBase = 5;\n      break;\n    default:\n      hpBase = 8;\n      mpBase = 6;\n  }\n  \n  const hp = hpBase + Math.floor(totalAttributes.constituicao / 2) * level;\n  const mp = mpBase + Math.floor(totalAttributes.inteligencia / 2) * level;\n  const initiative = Math.floor(totalAttributes.destreza / 2);\n  let armorClass = 10 + Math.floor(totalAttributes.destreza / 4);\n  if (inventory) {\n    const eq = inventory.equippedJewelsByItemId || {};\n    let acBonus = 0;\n    Object.entries(eq).forEach(([itemId, list]) => {\n      const item = SHOP_ITEMS.find(i => i.id === itemId) || (inventory.customItems ? inventory.customItems[itemId] : undefined);\n      const cap = item?.type === 'armor' ? 6 : item?.type === 'weapon' ? 2 : item?.type === 'accessory' ? 2 : 0;\n      let acc = 0;\n      list.forEach(jk => {\n        const parts = jk.split(':');\n        if (parts.length === 3) {\n          const tipo = parts[1] as import('../types/jewel').JewelType;\n          const nivel = Number(parts[2]);\n          const j = new Jewel(crypto.randomUUID(), tipo, nivel);\n          const b = j.getBonus();\n          if (b.armorClass) acc += b.armorClass;\n        }\n      });\n      acBonus += Math.min(cap, acc);\n    });\n    armorClass += Math.max(0, Math.floor(acBonus));\n  }\n  const luck = Math.max(0, Math.floor((totalAttributes.destreza + totalAttributes.inteligencia) / 2));\n  const mountSpeed = (() => {\n    try {\n      const hero = get().getSelectedHero();\n      if (hero?.activeMountId && Array.isArray(hero.mounts)) {\n        const m = hero.mounts.find(mm => mm.id === hero.activeMountId);\n        const base = Math.max(0, m?.speedBonus || 0);\n        const buff = (() => {\n          const mb = hero.mountBuff;\n          if (!mb?.speedBonus) return 0;\n          if (mb.expiresAt && Date.now() > new Date(mb.expiresAt).getTime()) return 0;\n          return Math.max(0, mb.speedBonus || 0);\n        })();\n        return base + buff;\n      }\n    } catch {}\n    return 0;\n  })();\n  const finalInitiative = initiative + mountSpeed;\n  const attackBase = Math.max(0, (totalAttributes.forca || 0) + (totalAttributes.destreza || 0));\n  const magicBase = Math.max(0, (totalAttributes.inteligencia || 0));\n  const defenseBase = Math.max(0, (totalAttributes.constituicao || 0) + Math.floor(armorClass / 2));\n  let wa = 1, wm = 1, wd = 1;\n  switch (heroClass) {\n    case 'guerreiro':\n    case 'barbaro':\n    case 'lanceiro':\n    case 'paladino':\n      wa = 1.4; wm = 0.8; wd = 1.2; break;\n    case 'mago':\n    case 'feiticeiro':\n    case 'druida':\n      wa = 0.8; wm = 1.5; wd = 1.0; break;\n    case 'ladino':\n    case 'assassino':\n    case 'arqueiro':\n    case 'patrulheiro':\n    case 'monge':\n      wa = 1.3; wm = 0.9; wd = 1.0; break;\n    case 'clerigo':\n    case 'bardo':\n      wa = 1.0; wm = 1.2; wd = 1.1; break;\n    default:\n      wa = 1.1; wm = 1.1; wd = 1.0; break;\n  }\n  const power = Math.max(0, Math.round(\n    wa * attackBase +\n    wm * magicBase +\n    wd * defenseBase +\n    hp * 0.2 +\n    mp * 0.2 +\n    finalInitiative * 0.5 +\n    armorClass * 0.5 +\n    (luck || 0) * 0.3 +\n    level * 2\n  ));\n  \n  const result: DerivedAttributes = {\n    hp,\n    mp,\n    initiative: finalInitiative,\n    armorClass,\n    currentHp: hp,\n    currentMp: mp,\n    luck,\n    power\n  };\n  selfAny._cache.set(cacheKey, result);\n  if (selfAny._cache.size > 200) {\n    const first = selfAny._cache.keys().next().value as string | undefined;\n    if (first) selfAny._cache.delete(first);\n  }\n  return result;\n};\n\nconst computeCompanionBonus = (hero: Hero): Partial<HeroAttributes> => {\n  const bonus: Partial<HeroAttributes> = {};\n  if (hero.activePetId && Array.isArray(hero.pets)) {\n    const pet = hero.pets.find(p => p.id === hero.activePetId);\n    if (pet && pet.attributes) {\n      const mult = 1 + Math.max(0, pet.refineLevel || 0) * 0.01;\n      Object.entries(pet.attributes).forEach(([k, v]) => {\n        if (typeof v === 'number') {\n          const val = Math.round(v * mult);\n          bonus[k as keyof HeroAttributes] = (bonus[k as keyof HeroAttributes] || 0) + val;\n        }\n      });\n    }\n  }\n  if (hero.activeMountId && Array.isArray(hero.mounts)) {\n    const m = hero.mounts.find(mm => mm.id === hero.activeMountId);\n    if (m && m.attributes) {\n      const mult = 1 + Math.max(0, m.refineLevel || 0) * 0.01;\n      Object.entries(m.attributes).forEach(([k, v]) => {\n        if (typeof v === 'number') {\n          const val = Math.round(v * mult);\n          bonus[k as keyof HeroAttributes] = (bonus[k as keyof HeroAttributes] || 0) + val;\n        }\n      });\n      const mastery = Math.max(0, m.mastery || 0);\n      const masteryBonus = Math.floor(mastery / 10);\n      if (masteryBonus > 0) {\n        const agileTypes = ['grifo','hipogrifo','felino','wyvern','cavalo','lagarto','cervo','alce'];\n        const strongTypes = ['lobo','urso','rinoceronte','javali'];\n        if (agileTypes.includes(m.type)) {\n          bonus['destreza'] = (bonus['destreza'] || 0) + masteryBonus;\n        } else if (strongTypes.includes(m.type)) {\n          bonus['forca'] = (bonus['forca'] || 0) + masteryBonus;\n        } else if (m.type === 'draconiano') {\n          bonus['inteligencia'] = (bonus['inteligencia'] || 0) + masteryBonus;\n        }\n      }\n    }\n  }\n  return bonus;\n};\n\n// Progresso centralizada em utils/progression.ts\n\n// === STORE PRINCIPAL ===\n\nexport const useHeroStore = create<HeroState>()(\n  persist(\n    (set, get) => ({\n      heroes: [],\n      selectedHeroId: null,\n      availableQuests: [],\n      questCatalog: {},\n      guilds: [],\n      parties: [],\n      referralInvites: [],\n      staminaModal: undefined,\n      \n      dmOverrideLine: undefined,\n      \n      // === AES BSICAS ===\n      \n      createHero: (heroData: HeroCreationData) => {\n        const timestamp = new Date().toISOString();\n        const heroesNow = get().heroes.filter(h => h.origin !== 'npc');\n        if (!canCreateHero(heroesNow)) {\n          try { notificationBus.emit({ type: 'quest', title: 'Limite de heris', message: `Slots usados ${getUsed(heroesNow)}/${getCapacity(heroesNow)}. Compre ou desbloqueie mais slots.`, icon: '', duration: 3500 }); } catch {}\n          throw new Error('Limite de criao atingido');\n        }\n        \n        const validation = validateAttributes(heroData.attributes);\n        if (!validation.isValid) {\n          throw new Error(`Atributos invlidos: ${validation.errors.join(', ')}`);\n        }\n        \n        const initialInventory = {\n          items: {\n            'pocao-pequena': 2,\n            'espada-aprendiz': 1,\n            'armadura-novato': 1,\n            'capacete-ferro': 1,\n            'cinto-couro': 1,\n            'luvas-couro': 1,\n            'botas-caminhante': 1,\n            'capa-iniciante': 1,\n            'anel-bronze': 1,\n            'anel-vitalidade': 1,\n            'colar-madeira': 1\n          },\n          equippedMainHand: 'espada-aprendiz',\n          equippedOffHand: undefined,\n          equippedHelm: 'capacete-ferro',\n          equippedChest: 'armadura-novato',\n          equippedBelt: 'cinto-couro',\n          equippedGloves: 'luvas-couro',\n          equippedBoots: 'botas-caminhante',\n          equippedCape: 'capa-iniciante',\n          equippedRingLeft: 'anel-bronze',\n          equippedRingRight: 'anel-vitalidade',\n          equippedNecklace: 'colar-madeira',\n          equippedEarringLeft: undefined,\n          equippedEarringRight: undefined,\n          upgrades: {}\n          ,jewels: {\n            'jewel:vermelha:1': 2,\n            'jewel:azul:1': 2,\n            'jewel:verde:1': 2,\n            'jewel:amarela:1': 2,\n            'jewel:roxa:1': 2\n          }\n          ,equippedJewelsByItemId: {}\n        };\n        \n        const newHero: Hero = {\n          id: uuidv4(),\n          ...heroData,\n          level: 1,\n          attributePoints: 0,\n          derivedAttributes: calculateDerivedAttributes(heroData.attributes, heroData.class, 1, initialInventory, 'novato'),\n          element: heroData.element,\n          skills: heroData.skills,\n          image: heroData.image,\n          battleQuote: heroData.battleQuote,\n          progression: {\n            xp: 0,\n            level: 1,\n            gold: 100, // Ouro inicial\n            glory: 0,\n            arcaneEssence: 0,\n            fatigue: 0,\n            reputation: 0,\n            titles: [],\n            achievements: [],\n            stars: 0\n          },\n          journeyChapters: [],\n          // Ttulo inicial para novos heris\n          titles: [{\n            id: 'novato',\n            name: 'Novato',\n            description: 'Primeiro passo na jornada pica',\n            badge: '',\n            category: 'achievement' as const,\n            rarity: 'comum' as const,\n            unlockedAt: timestamp\n          }],\n          activeTitle: 'novato',\n          inventory: initialInventory,\n          activeQuests: [],\n          completedQuests: [],\n          reputationFactions: [\n            { id: 'guarda', name: 'Guarda da Cidade', reputation: 0, level: 'neutral' },\n            { id: 'ladroes', name: 'Ladres', reputation: 0, level: 'neutral' },\n            { id: 'clero', name: 'Clero', reputation: 0, level: 'neutral' },\n            { id: 'cultistas', name: 'Cultistas', reputation: 0, level: 'neutral' },\n            { id: 'comerciantes', name: 'Comerciantes', reputation: 0, level: 'neutral' },\n            { id: 'exploradores', name: 'Exploradores', reputation: 0, level: 'neutral' }\n          ],\n          dailyGoals: [],\n          achievements: TITLE_ACHIEVEMENTS.map(a => ({ ...a })),\n          stats: {\n            questsCompleted: 0,\n            totalCombats: 0,\n            totalPlayTime: 0,\n            lastActiveAt: timestamp,\n            trainingsToday: 0,\n            lastTrainingDate: timestamp,\n            trainingDailyLimit: 10,\n            trainingAttemptsByStatus: {}\n          },\n          createdAt: timestamp,\n          updatedAt: timestamp\n        };\n        \n        // Inicializar dados de rank\n        newHero.rankData = rankSystem.initializeRankData(newHero);\n        \n        // Inicializar WorldState\n        newHero.worldState = worldStateManager.initializeWorldState();\n        \n        // Inicializar stamina\n        newHero.stamina = {\n          current: 100,\n          max: 100,\n          lastRecovery: timestamp,\n          recoveryRate: 5\n        };\n        newHero.dungeon = {\n          stamina: { current: 50, max: 50, lastRecovery: timestamp, recoveryRate: 5 },\n          maxFloor: 0,\n          eternalBuffs: [],\n          rareItemBonusPercent: 0,\n          specialSkills: [],\n          permanentBonusAttributes: {}\n        };\n        \n        set(state => ({\n          heroes: [...state.heroes, newHero],\n          selectedHeroId: newHero.id\n        }));\n        \n        // Tracking de mtricas\n        trackMetric.heroCreated(newHero.id, {\n          class: newHero.class,\n          attributes: newHero.attributes,\n          timestamp: timestamp\n        });\n        \n        // Garantir guilda padro\n        get().ensureDefaultGuildExists();\n        // Gerar misses iniciais\n        get().refreshQuests(1);\n        try { onboardingManager.markStepValidated('create-hero'); } catch {}\n        try { onboardingManager.saveState(); } catch {}\n        \n        return newHero;\n      },\n\n      purchaseHeroSlotForSelected: () => {\n        const sel = get().getSelectedHero();\n        if (!sel) return false;\n        const spend = (amount: number) => {\n          const prog = { ...(sel.progression || {}) } as any;\n          const cur = Math.max(0, prog.gold || 0);\n          if (cur < amount) return false;\n          prog.gold = cur - amount;\n          get().updateHero(sel.id, { progression: prog } as any);\n          return true;\n        };\n        const ok = purchaseSlot(spend);\n        if (ok) {\n          try { notificationBus.emit({ type: 'achievement', title: 'Slot comprado', message: `Novo slot de heri desbloqueado. Agora: ${getUsed(get().heroes.filter(h=>h.origin!=='npc'))}/${getCapacity(get().heroes.filter(h=>h.origin!=='npc'))}.`, icon: '', duration: 3500 }); } catch {}\n        } else {\n          try { notificationBus.emit({ type: 'item', title: 'Compra falhou', message: `Preo atual: ${getNextSlotPrice()} ouro`, icon: '', duration: 3000 }); } catch {}\n        }\n        return ok;\n      },\n\n      createNPCAdventurer: (overrides) => {\n        const races: import('../types/hero').HeroRace[] = ['humano','elfo','anao','orc','halfling'];\n        const classes: import('../types/hero').HeroClass[] = ['guerreiro','mago','ladino','clerigo','patrulheiro','paladino','arqueiro','bardo','monge','assassino','barbaro','lanceiro','druida','feiticeiro'];\n        const elements: import('../types/hero').Element[] = ['fire','water','earth','air','thunder','light','dark','physical'];\n        const names = ['Alenna','Borin','Calyra','Darius','Eldric','Fiora','Garruk','Hellan','Ilyon','Jorvik','Kaelis','Lyra','Morth','Nerion','Orla','Peren','Quen','Ragna','Sylas','Thorin'];\n        const pick = <T,>(arr: T[]) => arr[Math.floor(Math.random()*arr.length)];\n        let attrs: HeroAttributes = { forca: 3, destreza: 3, constituicao: 3, inteligencia: 3, sabedoria: 3, carisma: 3 };\n        if (overrides?.attributes) {\n          attrs = { ...attrs, ...overrides.attributes } as HeroAttributes;\n        }\n        const heroData: HeroCreationData = {\n          name: overrides?.name || pick(names),\n          race: overrides?.race || pick(races),\n          class: overrides?.class || pick(classes),\n          attributes: attrs,\n          element: overrides?.element || pick(elements),\n          skills: overrides?.skills || []\n        } as HeroCreationData;\n        const h = get().createHero(heroData);\n        seedPersonality(h);\n        const player = get().getSelectedHero();\n        const pers = h.npcPersonality || { archetype: 'explorador', traits: [], chatStyle: 'amigavel' };\n        let baseRel = Math.floor(-20 + Math.random() * 40);\n        if ((pers.traits || []).includes('generoso') || pers.chatStyle === 'amigavel') baseRel += 8;\n        if ((pers.traits || []).includes('desconfiado') || pers.archetype === 'competitivo') baseRel -= 12;\n        baseRel = Math.max(-60, Math.min(25, baseRel));\n        const initialRelations = player && player.origin !== 'npc' ? { [player.id]: baseRel } : {};\n        get().updateHero(h.id, { origin: 'npc', controlledByAI: true, npcPersonality: h.npcPersonality, npcRoutine: h.npcRoutine, npcMemory: h.npcMemory, socialRelations: initialRelations });\n        return get().heroes.find(x => x.id === h.id)!;\n      },\n\n      ensureNPCAdventurersSeedExists: (targetCount = 5) => {\n        const current = get().heroes.filter(h => h.origin === 'npc').length;\n        const needed = Math.max(0, targetCount - current);\n        for (let i = 0; i < needed; i++) { get().createNPCAdventurer({}); }\n        try { get().dedupeNPCs(); } catch {}\n      },\n      seedRandomHatred: (count = 3) => {\n        const player = get().getSelectedHero();\n        if (!player) return;\n        get().ensureNPCAdventurersSeedExists(Math.max(count, 5));\n        const npcs = get().heroes.filter(h => h.origin === 'npc');\n        if (npcs.length === 0) return;\n        const pickCount = Math.min(count, npcs.length);\n        const pool = npcs.slice();\n        const chosen: typeof npcs = [];\n        for (let i = 0; i < pickCount; i++) {\n          const idx = Math.floor(Math.random() * pool.length);\n          chosen.push(pool.splice(idx, 1)[0]);\n        }\n        const ws = player.worldState || require('../utils/worldState').worldStateManager.initializeWorldState();\n        ws.npcStatus = ws.npcStatus || {} as any;\n        chosen.forEach(npc => {\n          const relMap = { ...(npc.socialRelations || {}) } as Record<string, number>;\n          const val = Math.max(-100, Math.min(-60, -60 - Math.floor(Math.random() * 40))); // -60 .. -100\n          relMap[player.id] = val;\n          npc.socialRelations = relMap;\n          try { get().updateHero(npc.id, { socialRelations: relMap, npcMood: 'irritado' } as any); } catch {}\n          (ws.npcStatus as any)[npc.id] = {\n            alive: true,\n            relationToPlayer: val,\n            lastInteraction: new Date().toISOString(),\n            currentLocation: 'taverna'\n          };\n        });\n        try { get().updateHero(player.id, { worldState: ws } as any); } catch {}\n        try { notificationBus.emit({ type: 'quest', title: 'Rivalidades', message: `${chosen.length} NPC(s) agora te odeiam`, icon: '', duration: 2500 }); } catch {}\n      },\n      startNPCSimulation: () => {\n        const anySelf = useHeroStore as unknown as { _npcTimer?: any };\n        if (anySelf._npcTimer) return;\n        const tick = () => {\n          const player = get().getSelectedHero();\n          const npcs = get().heroes.filter(h => h.origin === 'npc');\n          runNPCTick(player, npcs, (n) => notificationBus.emit(n));\n          playAmbient(0.02);\n          if (Math.random() < 0.4) playVoiceCue(420 + Math.floor(Math.random()*80), 180);\n          npcs.forEach(n => {\n            const compBonus = computeCompanionBonus(n);\n            const derived = calculateDerivedAttributes(n.attributes, n.class, n.progression.level, n.inventory, n.activeTitle, compBonus);\n            get().updateHero(n.id, { attributes: n.attributes, progression: n.progression, stats: n.stats, completedQuests: n.completedQuests, derivedAttributes: derived, socialRelations: n.socialRelations, npcMemory: n.npcMemory });\n          });\n          if (player) {\n          }\n          const heroes = get().heroes;\n          const lbs = generateAllLeaderboards(heroes);\n          trackMetric.custom?.('npc_tick', { npcs: npcs.length, ts: Date.now() });\n        };\n        anySelf._npcTimer = setInterval(tick, 30000);\n      },\n      stopNPCSimulation: () => {\n        const anySelf = useHeroStore as unknown as { _npcTimer?: any };\n        if (anySelf._npcTimer) {\n          clearInterval(anySelf._npcTimer);\n          anySelf._npcTimer = undefined;\n        }\n      },\n\n      setDuelOverlay: (overlay) => {\n        set({ duelOverlay: overlay });\n      },\n      setNPCInteractionOverlay: (overlay) => {\n        set({ npcInteractionOverlay: overlay });\n      },\n      setStaminaModal: (modal) => {\n        set({ staminaModal: modal });\n      },\n      respondToNPCInteraction: async (choice) => {\n        const overlay = get().npcInteractionOverlay;\n        if (!overlay) return;\n        const player = get().getSelectedHero();\n        const npc = get().heroes.find(h => h.id === overlay.npcId);\n        if (!player || !npc) { set({ npcInteractionOverlay: undefined }); return; }\n        if (choice === 'accept') {\n          try {\n            const check = await canPerformAction(player.id, 'SOCIAL_DEEP');\n            if (!check.ok) {\n            try { notificationBus.emit({ type: 'stamina', title: 'Fadiga alta', message: `Interao profunda requer ${check.cost} . Descanse para reduzir fadiga.`, duration: 2500, icon: '' }); } catch {}\n              set({ npcInteractionOverlay: undefined });\n              set({ staminaModal: { required: check.cost, actionType: 'SOCIAL_DEEP' } });\n              return;\n            }\n            const perf = await performAction(player.id, 'SOCIAL_DEEP', { npcId: npc.id });\n            const st = player.stamina || { current: 100, max: 100 } as any;\n            get().updateHero(player.id, { stamina: { ...st, current: perf.newStamina } });\n          } catch {}\n        }\n        let mood: 'amigvel' | 'neutro' | 'hostil' = 'neutro';\n        if (choice === 'accept') mood = 'amigvel';\n        else if (choice === 'decline') mood = 'hostil';\n        const res = updateOnSocial(npc, player, mood);\n        notificationBus.emit({ type: choice === 'accept' ? 'achievement' : 'stamina', title: 'Interao com NPC', message: `${npc.name}: ${choice === 'accept' ? 'Agradeo!' : choice === 'decline' ? 'Talvez outra hora...' : 'Certo, conversamos depois.'}`, icon: '', duration: 2500 });\n        set({ npcInteractionOverlay: undefined });\n      },\n      recordActivity: (entry) => {\n        const s = get();\n        const now = new Date().toISOString();\n        const newLog = [{ ts: now, ...entry }, ...s.activitiesLog].slice(0, 500);\n        set({ activitiesLog: newLog });\n        try {\n          const gs = require('../store/gameSettingsStore').getGameSettings();\n          const mode = gs.notifPriorityMode || 'important_first';\n          const freq = gs.notifFrequency || 'normal';\n          const shouldShow = entry.importance === 'high' || mode === 'normal';\n          if (shouldShow) {\n            const icon = entry.type === 'dialogue' ? '' : entry.type === 'rumor' ? '' : entry.type === 'tip' ? '' : '';\n            notificationBus.emit({ type: 'quest', title: 'Atividade', message: entry.text, icon, duration: freq === 'low' ? 2000 : freq === 'high' ? 4000 : 3000 });\n            const gsSound = gs.notifSoundEnabled ?? true;\n            if (gsSound) {\n              const audio = require('../utils/audio');\n              audio.playVoiceCue(430 + Math.floor(Math.random()*60), 180);\n            }\n          }\n        } catch {}\n      },\n      triggerAutoInteraction: (location) => {\n        try {\n          const gs = require('../store/gameSettingsStore').getGameSettings();\n          if (!gs.autoInteractionEnabled) return;\n          const min = Math.max(0, gs.autoChanceMinPercent ?? 30);\n          const max = Math.max(min, gs.autoChanceMaxPercent ?? 70);\n          const chance = (min + Math.random() * (max - min)) / 100;\n          const lastIso = get().lastAutoInteractionAt;\n          const cooldownMin = gs.interactionsCooldownMinutes ?? Math.round((gs.npcInteractionCooldownSeconds ?? 900)/60);\n          const okCooldown = !lastIso || ((Date.now() - new Date(lastIso).getTime()) / 60000) >= cooldownMin;\n          if (!okCooldown) return;\n          if (Math.random() < chance) {\n            const player = get().getSelectedHero();\n            const npc = get().heroes.find(h => h.origin === 'npc');\n            if (!player || !npc) return;\n            const dlg = require('../utils/dialogueEngine');\n            const lines = dlg.generateMixed(npc, player, 2);\n            set({ npcInteractionOverlay: { npcId: npc.id, npcName: npc.name, lines }, lastAutoInteractionAt: new Date().toISOString() });\n            get().recordActivity({ type: 'dialogue', location, npcId: npc.id, text: `${npc.name}: ${lines[0]}`, importance: 'normal' });\n          }\n        } catch {}\n      },\n      dedupeNPCs: () => {\n        const state = get();\n        const npcs = state.heroes.filter(h => h.origin === 'npc');\n        const keyOf = (h: Hero) => `${(h.name || '').toLowerCase()}::${(h.class || '')}`;\n        const groups = new Map<string, Hero[]>();\n        npcs.forEach(h => {\n          const k = keyOf(h);\n          const arr = groups.get(k) || [];\n          arr.push(h);\n          groups.set(k, arr);\n        });\n        let removed = 0;\n        const toRemoveIds: string[] = [];\n        const replacements: Record<string, Hero> = {};\n        groups.forEach((arr, k) => {\n          if (arr.length <= 1) return;\n          // Choose primary by highest level/xp\n          const primary = arr.slice().sort((a,b) => (b.progression?.level||0)-(a.progression?.level||0) || (b.progression?.xp||0)-(a.progression?.xp||0))[0];\n          const others = arr.filter(h => h.id !== primary.id);\n          const merged: Hero = { ...primary } as Hero;\n          others.forEach(o => {\n            merged.progression = {\n              ...merged.progression,\n              xp: Math.max(merged.progression?.xp || 0, o.progression?.xp || 0),\n              gold: Math.max(merged.progression?.gold || 0, o.progression?.gold || 0),\n              level: Math.max(merged.progression?.level || 1, o.progression?.level || 1)\n            };\n            merged.stats = {\n              ...merged.stats,\n              questsCompleted: (merged.stats?.questsCompleted || 0) + (o.stats?.questsCompleted || 0),\n              enemiesDefeated: (merged.stats?.enemiesDefeated || 0) + (o.stats?.enemiesDefeated || 0),\n              itemsFound: (merged.stats?.itemsFound || 0) + (o.stats?.itemsFound || 0),\n              totalCombats: (merged.stats?.totalCombats || 0) + (o.stats?.totalCombats || 0),\n              totalPlayTime: (merged.stats?.totalPlayTime || 0) + (o.stats?.totalPlayTime || 0)\n            } as any;\n            const memA = merged.npcMemory || { interactions: [], preferences: {}, scoreByAction: {}, socialNotesByHeroId: {} };\n            const memB = o.npcMemory || { interactions: [], preferences: {}, scoreByAction: {}, socialNotesByHeroId: {} };\n            merged.npcMemory = {\n              interactions: [...memA.interactions, ...memB.interactions].slice(-50),\n              preferences: { ...(memA.preferences || {}), ...(memB.preferences || {}) },\n              scoreByAction: { ...(memA.scoreByAction || {}), ...(memB.scoreByAction || {}) },\n              friendStatusByHeroId: { ...(memA.friendStatusByHeroId || {}), ...(memB.friendStatusByHeroId || {}) },\n              lastContactByHeroId: { ...(memA.lastContactByHeroId || {}), ...(memB.lastContactByHeroId || {}) },\n              lastInteractionByType: { ...(memA.lastInteractionByType || {}), ...(memB.lastInteractionByType || {}) },\n              socialNotesByHeroId: { ...(memA.socialNotesByHeroId || {}), ...(memB.socialNotesByHeroId || {}) }\n            } as any;\n            removed++;\n            toRemoveIds.push(o.id);\n          });\n          replacements[primary.id] = merged;\n        });\n        if (removed > 0) {\n          const newHeroes = state.heroes\n            .filter(h => !toRemoveIds.includes(h.id))\n            .map(h => (replacements[h.id] ? replacements[h.id] : h));\n          set({ heroes: newHeroes });\n          try { notificationBus.emit({ type: 'item', title: 'NPCs Deduplicados', message: `Atualizados ${removed} duplicados`, icon: '', duration: 2500 }); } catch {}\n        }\n        return { checked: npcs.length, removed };\n      },\n      setPartyInviteTerms: (partyId, targetHeroId, terms) => {\n        const party = get().parties.find(p => p.id === partyId);\n        if (!party) return;\n        const order = ['F','E','D','C','B','A','S'];\n        const idx = (r: string) => Math.max(0, order.indexOf((r || 'F').toUpperCase()));\n        const inviter = get().heroes.find(h => h.id === party.leaderId);\n        const target = get().heroes.find(h => h.id === targetHeroId);\n        let adjusted = { ...terms };\n        if (inviter && target) {\n          const diff = Math.abs(idx(inviter.rankData?.currentRank || 'F') - idx(target.rankData?.currentRank || 'F'));\n          if (diff === 2) {\n            adjusted.rewardShare = Math.max(5, Math.floor((adjusted.rewardShare || 10) * 0.5));\n            try { notificationBus.emit({ type: 'item', title: 'Ajuste de contrato', message: 'Diferena de 2 ranks: recompensa reduzida em 50%.', icon: '', duration: 2500 }); } catch {}\n          }\n        }\n        const inviteTerms = { ...(party.inviteTerms || {}) };\n        inviteTerms[targetHeroId] = adjusted;\n        const updated = { ...party, inviteTerms };\n        set(state => ({ parties: state.parties.map(p => p.id === partyId ? updated : p) }));\n      },\n\n      // === DUEL SYSTEM ===\n      getDuelInvitesForHero: (heroId) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        return Array.isArray(hero?.duelInvites) ? hero!.duelInvites! : [];\n      },\n      acceptDuelInvite: (heroId, npcId) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const invites = Array.isArray(hero.duelInvites) ? hero.duelInvites : [];\n        const inviteIdx = invites.findIndex(i => i.npcId === npcId);\n        if (inviteIdx === -1) return false;\n        const invite = invites[inviteIdx];\n        const nowInvites = invites.filter(i => i.npcId !== npcId);\n        const npc = get().heroes.find(h => h.id === npcId);\n        const duelRes = npc ? simulateDuel(hero, npc, invite.type) : null;\n        const updates: Partial<Hero> = { duelInvites: nowInvites } as any;\n        const stats = { ...hero.stats };\n        stats.duelsPlayed = (stats.duelsPlayed || 0) + 1;\n        if (duelRes && duelRes.winnerId === hero.id) stats.duelsWon = (stats.duelsWon || 0) + 1;\n        (updates as any).stats = stats;\n        const prog = { ...hero.progression };\n        if (duelRes) {\n          prog.xp = (prog.xp || 0) + duelRes.rewards.xp;\n          prog.gold = (prog.gold || 0) + duelRes.rewards.gold;\n        }\n        (updates as any).progression = prog;\n        if (npc && duelRes) {\n          const rel = { ...(npc.socialRelations || {}) };\n          rel[heroId] = (rel[heroId] || 0) + (invite.type === 'honra' ? (duelRes.winnerId === hero.id ? 10 : 5) : 2);\n          get().updateHero(npc.id, { socialRelations: rel });\n        }\n        get().updateHero(heroId, updates);\n        try {\n          const won = duelRes ? duelRes.winnerId === hero.id : false;\n          notificationBus.emit({ type: won ? 'achievement' : 'stamina', title: 'Duelo', message: `${npc?.name || 'NPC'} ${won ? 'foi derrotado' : 'venceu'} no duelo (${invite.type}).`, icon: '', duration: 3000 });\n          set({ duelOverlay: duelRes ? { ...duelRes, aName: hero.name, bName: npc?.name || 'NPC', aClass: hero.class, bClass: npc?.class || 'guerreiro', aWeaponId: hero.inventory?.equippedMainHand, bWeaponId: npc?.inventory?.equippedMainHand } : undefined });\n        } catch {}\n        return true;\n      },\n      declineDuelInvite: (heroId, npcId) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const invites = Array.isArray(hero.duelInvites) ? hero.duelInvites : [];\n        if (!invites.some(i => i.npcId === npcId)) return false;\n        const nowInvites = invites.filter(i => i.npcId !== npcId);\n        get().updateHero(heroId, { duelInvites: nowInvites });\n        try { notificationBus.emit({ type: 'item', title: 'Duelo recusado', message: 'Convite removido.', icon: '', duration: 2000 }); } catch {}\n        return true;\n      },\n      acceptPartyInvite: (heroId, partyId) => {\n        const party = get().parties.find(p => p.id === partyId);\n        if (!party) return false;\n        if (!(party.invites || []).includes(heroId)) return false;\n        const members = [...party.members, heroId];\n        const invites = (party.invites || []).filter(id => id !== heroId);\n        const inviteTerms = { ...(party.inviteTerms || {}) };\n        const acceptedTerms = inviteTerms[heroId];\n        const contractByHeroId = { ...(party.contractByHeroId || {}) };\n        if (acceptedTerms) {\n          contractByHeroId[heroId] = {\n            duration: acceptedTerms.duration || 'one_mission',\n            days: acceptedTerms.days,\n            rewardShare: Math.max(5, Math.min(50, acceptedTerms.rewardShare || 10)),\n            leaderPref: acceptedTerms.leaderPref\n          };\n        }\n        delete inviteTerms[heroId];\n        const updated = { ...party, members, invites, inviteTerms, contractByHeroId };\n        set(state => ({ parties: state.parties.map(p => p.id === partyId ? updated : p) }));\n        // Recompensa imediata simblica por aceitar ajudar\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (hero && acceptedTerms) {\n          const xpBonus = Math.round(10 + (acceptedTerms.rewardShare || 10));\n          const goldBonus = Math.round((acceptedTerms.rewardShare || 10) * 2);\n          const prog = { ...hero.progression, xp: (hero.progression.xp || 0) + xpBonus, gold: (hero.progression.gold || 0) + goldBonus };\n          get().updateHero(heroId, { progression: prog });\n          try { notificationBus.emit({ type: 'achievement', title: 'Apoio  Party', message: `Voc recebeu +${xpBonus} XP e +${goldBonus} ouro pelo acordo`, icon: '', duration: 3500 }); } catch {}\n        } else {\n          try { notificationBus.emit({ type: 'achievement', title: 'Convite aceito', message: 'Voc agora faz parte da party.', icon: '', duration: 3500 }); } catch {}\n        }\n        return true;\n      },\n      declinePartyInvite: (heroId, partyId) => {\n        const party = get().parties.find(p => p.id === partyId);\n        if (!party) return false;\n        if (!(party.invites || []).includes(heroId)) return false;\n        const invites = (party.invites || [])?.filter(id => id !== heroId);\n        const inviteTerms = { ...(party.inviteTerms || {}) };\n        delete inviteTerms[heroId];\n        const updated = { ...party, invites, inviteTerms };\n        set(state => ({ parties: state.parties.map(p => p.id === partyId ? updated : p) }));\n        try { notificationBus.emit({ type: 'stamina', title: 'Convite recusado', message: 'Convite removido.', icon: '', duration: 2500 }); } catch {}\n        return true;\n      },\n\n      // === PARTY: implementao bsica ===\n      getHeroParty: (heroId: string) => {\n        const state = get();\n        const parties = Array.isArray((state as any).parties) ? (state as any).parties as Party[] : [];\n        return parties.find(p => Array.isArray(p.members) && p.members.includes(heroId));\n      },\n\n      createParty: (heroId: string, name: string) => {\n        const state = get();\n        const existing = state.parties.find(p => Array.isArray(p.members) && p.members.includes(heroId));\n        if (existing) return existing;\n        const party = {\n          id: `party-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,\n          name: String(name).slice(0, 40),\n          leaderId: heroId,\n          members: [heroId],\n          invites: [],\n          createdAt: new Date().toISOString(),\n          sharedLoot: true,\n          sharedXP: true\n        } as Party;\n        set(s => ({ parties: [...(Array.isArray((s as any).parties) ? (s as any).parties : []), party] }));\n        return party;\n      },\n\n      inviteHeroToParty: (partyId: string, inviterId: string, targetHeroId: string) => {\n        const state = get();\n        const party = (Array.isArray(state.parties) ? state.parties : []).find(p => p.id === partyId);\n        if (!party) return false;\n        if (party.leaderId !== inviterId && !party.members.includes(inviterId)) return false;\n        const inviter = get().heroes.find(h => h.id === inviterId);\n        const target = get().heroes.find(h => h.id === targetHeroId);\n        if (inviter && target) {\n          const inviterRank = inviter.rankData?.currentRank || 'F';\n          const targetRank = target.rankData?.currentRank || 'F';\n          if (inviterRank !== targetRank) {\n            return false;\n          }\n        }\n        party.invites = Array.isArray(party.invites) ? party.invites : [];\n        if (!party.invites.includes(targetHeroId) && !party.members.includes(targetHeroId)) {\n          party.invites.push(targetHeroId);\n          set(s => ({ parties: s.parties.map(p => p.id === partyId ? party : p) }));\n          return true;\n        }\n        return false;\n      },\n\n      \n\n      \n\n      leaveParty: (heroId: string) => {\n        const state = get();\n        const party = (Array.isArray(state.parties) ? state.parties : []).find(p => Array.isArray(p.members) && p.members.includes(heroId));\n        if (!party) return false;\n        party.members = party.members.filter(id => id !== heroId);\n        if (party.leaderId === heroId) party.leaderId = party.members[0] || party.leaderId;\n        const parties = party.members.length ? state.parties.map(p => p.id === party.id ? party : p) : state.parties.filter(p => p.id !== party.id);\n        set({ parties });\n        return true;\n      },\n\n      // === SISTEMA DE OVOS E MASCOTES ===\n\n      generateEggForSelected: (rarity) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const MAX_EGGS = 30;\n        if ((hero.eggs || []).length >= MAX_EGGS) {\n          try { notificationBus.emit({ type: 'item', title: 'Inventrio de Ovos Cheio', message: 'Libere espao antes de obter novos ovos.', duration: 5000 }); } catch {}\n          return false;\n        }\n        const egg = generateMysteryEgg(rarity);\n        const eggs = [...(hero.eggs || []), egg];\n        get().updateHero(hero.id, { eggs });\n        try {\n          \n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      identifyEggForSelected: (eggId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const idx = (hero.eggs || []).findIndex(e => e.id === eggId);\n        if (idx === -1) return false;\n        const egg = hero.eggs![idx];\n        if (egg.status !== 'misterioso') return false;\n        const costRange = EGG_IDENTIFY_COST[egg.baseRarity];\n        const cost = Math.floor(costRange.min + Math.random() * (costRange.max - costRange.min));\n        if ((hero.progression.gold || 0) < cost) return false;\n        const info = utilIdentifyEgg(egg);\n        const updatedEgg: import('../types/hero').Egg = { ...egg, status: 'identificado', identified: info, name: info.revealedName || egg.name };\n        const nextEggs = [...hero.eggs!];\n        nextEggs[idx] = updatedEgg;\n        get().updateHero(hero.id, { \n          eggs: nextEggs,\n          progression: { ...hero.progression, gold: Math.max(0, (hero.progression.gold || 0) - cost) }\n        });\n        try {\n          \n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      startIncubationForSelected: (eggId, slotIndex = 0) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const eggs = hero.eggs || [];\n        const idx = eggs.findIndex(e => e.id === eggId);\n        if (idx === -1) return false;\n        const usedSlots = eggs.filter(e => e.status === 'incubando' && typeof e.incubatingSlot === 'number').map(e => e.incubatingSlot as number);\n        if (usedSlots.length >= 3) return false;\n        let targetSlot = slotIndex;\n        for (let s = 0; s < 3; s++) { if (!usedSlots.includes(s)) { targetSlot = s; break; } }\n        const egg = eggs[idx];\n        if (egg.status !== 'identificado') return false;\n        const inc = incubateEgg(egg);\n        const updatedEgg = { ...inc, incubatingSlot: targetSlot };\n        const nextEggs = [...eggs];\n        nextEggs[idx] = updatedEgg;\n        get().updateHero(hero.id, { eggs: nextEggs });\n        try {\n          \n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      accelerateIncubationForSelected: (eggId, method, value) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const eggs = hero.eggs || [];\n        const idx = eggs.findIndex(e => e.id === eggId);\n        if (idx === -1) return false;\n        const egg = eggs[idx];\n        if (egg.status !== 'incubando') return false;\n        let ms = 0;\n        if (method === 'essencia') ms = 15 * 60 * 1000;\n        if (method === 'brasas') ms = 60 * 60 * 1000;\n        if (method === 'ouro') {\n          const invest = Math.max(0, value || 0);\n          if ((hero.progression.gold || 0) < invest) return false;\n          ms = Math.min(INCUBATION_MS[egg.identified?.rarity || egg.baseRarity], invest * 60 * 1000 / 10); // 10 ouro = 1 min\n          get().updateHero(hero.id, { progression: { ...hero.progression, gold: Math.max(0, (hero.progression.gold || 0) - invest) } });\n        }\n        const updated = accelerateIncubation(egg, ms);\n        const nextEggs = [...eggs];\n        nextEggs[idx] = updated;\n        get().updateHero(hero.id, { eggs: nextEggs });\n        try {\n          \n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      updateIncubationTick: () => {\n        const hero = get().getSelectedHero();\n        if (!hero) return;\n        const eggs = hero.eggs || [];\n        const next = eggs.map(e => markReadyToHatch(e));\n        get().updateHero(hero.id, { eggs: next });\n      },\n\n      hatchEggForSelected: (eggId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const MAX_PETS = 50;\n        if ((hero.pets || []).length >= MAX_PETS) {\n          try { notificationBus.emit({ type: 'item', title: 'Limite de Mascotes', message: 'Voc atingiu o limite de mascotes. Libere espao antes de chocar.', duration: 5000 }); } catch {}\n          return false;\n        }\n        if (hero.hatchCooldownEndsAt) {\n          const ends = new Date(hero.hatchCooldownEndsAt).getTime();\n          if (Date.now() < ends) {\n            try { notificationBus.emit({ type: 'item', title: 'Cooldown de Chocagem', message: 'Aguarde o fim do cooldown para chocar outro ovo.', duration: 4000 }); } catch {}\n            return false;\n          }\n        }\n        const eggs = hero.eggs || [];\n        const idx = eggs.findIndex(e => e.id === eggId);\n        if (idx === -1) return false;\n        const egg = eggs[idx];\n        if (!(egg.status === 'pronto_para_chocar' || (egg.status === 'incubando' && canHatch(egg)))) return false;\n        const hatchCostByRarity: Record<import('../types/hero').EggRarity, number> = { comum: 5, incomum: 10, raro: 20, epico: 50, lendario: 100, mistico: 200 };\n        const hatchCost = hatchCostByRarity[egg.identified?.rarity || egg.baseRarity];\n        if ((hero.progression.gold || 0) < hatchCost) {\n          try { notificationBus.emit({ type: 'gold', title: 'Ouro insuficiente', message: `Chocar este ovo requer ${hatchCost} ouro.`, duration: 4000 }); } catch {}\n          return false;\n        }\n        const pet = hatchPet(egg);\n        const nextEggs = eggs.filter(e => e.id !== eggId);\n        const pets = [...(hero.pets || []), pet];\n        const hatchHistory = [...(hero.hatchHistory || []), { eggId: egg.id, petId: pet.id, timestamp: new Date().toISOString(), rarity: egg.identified?.rarity || egg.baseRarity, hatchCost }];\n        const cooldownMs = 30 * 1000;\n        const progression = { ...hero.progression, gold: Math.max(0, (hero.progression.gold || 0) - hatchCost) };\n        get().updateHero(hero.id, { eggs: nextEggs, pets, hatchHistory, hatchCooldownEndsAt: new Date(Date.now() + cooldownMs).toISOString(), progression });\n        try { notificationBus.emit({ type: 'item', title: 'Mascote Obtido', message: `Voc obteve ${pet.name}!`, duration: 4000, icon: '' }); } catch {}\n        try { notificationBus.emit({ type: 'item', title: 'Ovo Chocado', message: 'O ovo foi consumido e removido do inventrio.', duration: 3000, icon: '' }); } catch {}\n        try {\n          logActivity.petHatched({\n            heroId: hero.id,\n            heroName: hero.name,\n            heroClass: hero.class,\n            heroLevel: hero.progression.level,\n            petName: pet.name,\n            petType: pet.type,\n            eggRarity: egg.identified?.rarity || egg.baseRarity,\n            costGold: hatchCost\n          });\n        } catch {}\n        try {\n          \n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        try { get().updateDailyGoalProgress(hero.id, 'pet-hatched', 1); } catch {}\n        return true;\n      },\n\n      accelerateHatchCooldownForSelected: (goldAmount: number) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        if (!hero.hatchCooldownEndsAt) return false;\n        const invest = Math.max(0, goldAmount || 0);\n        if ((hero.progression.gold || 0) < invest) return false;\n        const endMs = new Date(hero.hatchCooldownEndsAt).getTime();\n        const reduceMs = Math.floor((invest / 10) * 60 * 1000);\n        const newEnd = Math.max(Date.now(), endMs - reduceMs);\n        const progression = { ...hero.progression, gold: Math.max(0, (hero.progression.gold || 0) - invest) };\n        get().updateHero(hero.id, { hatchCooldownEndsAt: new Date(newEnd).toISOString(), progression });\n        try {\n          const mins = Math.floor(reduceMs / 60000);\n          notificationBus.emit({ type: 'item', title: 'Cooldown reduzido', message: `- ${mins} min no cooldown de chocagem`, duration: 3000, icon: '' });\n        } catch {}\n        try {\n          \n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      consumeInventoryItem: (heroId, itemId, qty = 1) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const current = hero.inventory.items[itemId] || 0;\n        if (current < qty) return false;\n        const newItems = { ...hero.inventory.items, [itemId]: Math.max(0, current - qty) };\n        if (newItems[itemId] <= 0) delete newItems[itemId];\n        get().updateHero(heroId, { inventory: { ...hero.inventory, items: newItems } });\n        return true;\n      },\n\n      addPetXPForSelected: (petId, xp) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const pets = hero.pets || [];\n        const idx = pets.findIndex(p => p.id === petId);\n        if (idx === -1) return false;\n        const updated = addPetXP(pets[idx], xp);\n        const nextPets = [...pets];\n        nextPets[idx] = updated;\n        get().updateHero(hero.id, { pets: nextPets });\n        try { get().updateDailyGoalProgress(hero.id, 'pet-trained', 1); } catch {}\n        return true;\n      },\n\n      sellPetForSelected: (petId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const pets = hero.pets || [];\n        const idx = pets.findIndex(p => p.id === petId);\n        if (idx === -1) return false;\n        const pet = pets[idx];\n        const baseByRarity: Record<import('../types/hero').EggRarity, number> = { comum: 100, incomum: 200, raro: 400, epico: 800, lendario: 1600, mistico: 3000 };\n        const base = baseByRarity[pet.rarity] || 100;\n        const levelBonus = Math.max(0, pet.level || 1) * 20;\n        const refineBonus = Math.max(0, pet.refineLevel || 0) * 50;\n        const mutationBonus = pet.mutation?.variant ? 200 : 0;\n        const sellPrice = base + levelBonus + refineBonus + mutationBonus;\n        const nextPets = pets.filter(p => p.id !== petId);\n        const updates: Partial<Hero> = { pets: nextPets, progression: { ...hero.progression, gold: (hero.progression.gold || 0) + sellPrice } } as any;\n        if (hero.activePetId === petId) (updates as any).activePetId = undefined;\n        const compBonus = computeCompanionBonus({ ...hero, pets: nextPets, activePetId: (updates as any).activePetId } as Hero);\n        const derived = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus);\n        (updates as any).derivedAttributes = derived;\n        get().updateHero(hero.id, updates);\n        try { notificationBus.emit({ type: 'gold', title: 'Mascote vendido', message: `Recebido ${sellPrice} ouro por ${pet.name}.`, duration: 3500, icon: '' }); } catch {}\n        try {\n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      \n\n      setActivePet: (petId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return;\n        const exists = (hero.pets || []).some(p => p.id === petId);\n        const nextId = exists ? petId : undefined;\n        const compBonus = computeCompanionBonus({ ...hero, activePetId: nextId } as Hero);\n        const derived = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus);\n        get().updateHero(hero.id, { activePetId: nextId, derivedAttributes: derived });\n      },\n\n      setActiveMount: (mountId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return;\n        const exists = (hero.mounts || []).some(m => m.id === mountId);\n        const nextId = exists ? mountId : undefined;\n        if (exists) {\n          const mounts = hero.mounts || [];\n          const idx = mounts.findIndex(m => m.id === mountId);\n          if (idx >= 0) {\n            const mm = mounts[idx];\n            const hist = [{ ts: new Date().toISOString(), action: 'activate', details: '' }, ...((mm.history)||[])].slice(0,50);\n            const nextMounts = [...mounts];\n            nextMounts[idx] = { ...mm, history: hist };\n            hero.mounts = nextMounts;\n          }\n        }\n        const compBonus = computeCompanionBonus({ ...hero, activeMountId: nextId } as Hero);\n        const derived = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus);\n        get().updateHero(hero.id, { activeMountId: nextId, derivedAttributes: derived });\n        try { notificationBus.emit({ type: 'item', title: nextId ? 'Montaria Ativada' : 'Montaria Desativada', message: nextId ? 'Sua montaria est ativa e concedendo bnus.' : 'Voc desativou sua montaria.', duration: 3000, icon: nextId ? '' : '' }); } catch {}\n        try { trackMetric.custom?.('mount_activated', { heroId: hero.id, mountId: nextId }); } catch {}\n      },\n\n      setFavoriteMount: (mountId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return;\n        const exists = (hero.mounts || []).some(m => m.id === mountId);\n        const nextId = exists ? mountId : undefined;\n        if (exists) {\n          const mounts = hero.mounts || [];\n          const idx = mounts.findIndex(m => m.id === mountId);\n          if (idx >= 0) {\n            const mm = mounts[idx];\n            const hist = [{ ts: new Date().toISOString(), action: nextId ? 'favorite_set' : 'favorite_removed', details: '' }, ...((mm.history)||[])].slice(0,50);\n            const nextMounts = [...mounts];\n            nextMounts[idx] = { ...mm, history: hist };\n            hero.mounts = nextMounts;\n          }\n        }\n        get().updateHero(hero.id, { favoriteMountId: nextId });\n        try { notificationBus.emit({ type: 'item', title: nextId ? 'Favorita definida' : 'Favorita removida', message: nextId ? 'Sua montaria favorita foi definida.' : 'Voc removeu a favorita.', duration: 3000, icon: '' }); } catch {}\n        try { trackMetric.custom?.('mount_favorite_set', { heroId: hero.id, mountId: nextId }); } catch {}\n      },\n\n      setMountNoteForSelected: (mountId, note) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const mounts = hero.mounts || [];\n        const idx = mounts.findIndex(m => m.id === mountId);\n        if (idx === -1) return false;\n        const next = [...mounts];\n        next[idx] = { ...next[idx], note };\n        get().updateHero(hero.id, { mounts: next });\n        try { notificationBus.emit({ type: 'item', title: 'Nota salva', message: 'Sua nota foi atualizada.', duration: 2500, icon: '' }); } catch {}\n        return true;\n      },\n\n      toggleFavoriteMount: (mountId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return;\n        const exists = (hero.mounts || []).some(m => m.id === mountId);\n        if (!exists) return;\n        const current = hero.favoriteMountIds || [];\n        let nextFavs = [...current];\n        if (nextFavs.includes(mountId)) nextFavs = nextFavs.filter(id => id !== mountId);\n        else if (nextFavs.length < 3) nextFavs.push(mountId);\n        const mounts = hero.mounts || [];\n        const idx = mounts.findIndex(m => m.id === mountId);\n        if (idx >= 0) {\n          const mm = mounts[idx];\n          const hist = [{ ts: new Date().toISOString(), action: nextFavs.includes(mountId) ? 'favorite_set' : 'favorite_removed', details: 'multi' }, ...((mm.history)||[])].slice(0,50);\n          const nextMounts = [...mounts];\n          nextMounts[idx] = { ...mm, history: hist };\n          get().updateHero(hero.id, { favoriteMountIds: nextFavs, mounts: nextMounts });\n        } else {\n          get().updateHero(hero.id, { favoriteMountIds: nextFavs });\n        }\n        try { notificationBus.emit({ type: 'item', title: nextFavs.includes(mountId) ? 'Favorito adicionado' : 'Favorito removido', message: `Slots: ${nextFavs.length}/3`, duration: 3000, icon: '' }); } catch {}\n        try { trackMetric.custom?.('mount_favorite_toggle', { heroId: hero.id, mountId, count: nextFavs.length }); } catch {}\n      },\n\n      toggleLockMount: (mountId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const mounts = hero.mounts || [];\n        const idx = mounts.findIndex(m => m.id === mountId);\n        if (idx === -1) return false;\n        const cur = mounts[idx];\n        const next = [...mounts];\n        next[idx] = { ...cur, locked: !cur.locked };\n        get().updateHero(hero.id, { mounts: next });\n        try { notificationBus.emit({ type: 'item', title: cur.locked ? 'Montaria Destravada' : 'Montaria Travada', message: cur.locked ? 'Agora pode ser liberada.' : 'Protegida contra liberao em lote.', duration: 3000, icon: cur.locked ? '' : '' }); } catch {}\n        return true;\n      },\n\n      generateMountForSelected: (type, rarity) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const MAX_MOUNTS = hero.stableCapacity || 50;\n        if ((hero.mounts || []).length >= MAX_MOUNTS) {\n          try { notificationBus.emit({ type: 'item', title: 'Limite de Montarias', message: 'Voc atingiu o limite de montarias. Libere espao antes de recrutar.', duration: 5000 }); } catch {}\n          return false;\n        }\n        const now = new Date().toISOString();\n        const types: import('../types/hero').Mount['type'][] = ['cavalo','lobo','grifo','javali','lagarto','draconiano','urso','felino','cervo','alce','hipogrifo','rinoceronte','wyvern'];\n        const pickType = type && types.includes(type) ? type : types[Math.floor(Math.random() * types.length)];\n        const rarities: import('../types/hero').MountRarity[] = ['comum','incomum','raro','epico','lendario','mistico'];\n        const pickRarity = rarity && rarities.includes(rarity) ? rarity : (Math.random() > 0.97 ? 'epico' : Math.random() > 0.9 ? 'raro' : 'comum');\n        const namePool: Record<string, string[]> = {\n          cavalo: ['Corcel gil','Corcel da Brisa','Cavalo de Estepes'],\n          lobo: ['Alcateiro','Lobo da Neve','Lobo das Sombras'],\n          grifo: ['Grifo Nobre','Asa Solar','Sentinela Alada'],\n          javali: ['Javali Robusto','Dente de Ferro','Batedor da Mata'],\n          lagarto: ['Lagarto Rpido','Corre-Folhas','Cauda Veloz'],\n          draconiano: ['Draconiano Jovem','Escama Rubra','Enguia Arcana'],\n          urso: ['Urso Montanhs','Urso das Rochas','Urso das Neves'],\n          felino: ['Felino gil','Garra de Vento','Sombra Silenciosa'],\n          cervo: ['Cervo Celeste','Cervo das Auroras','Cervo Etreo'],\n          alce: ['Alce Majestoso','Alce do Vale','Chifre Antigo'],\n          hipogrifo: ['Hipogrifo Jovem','Hipogrifo do Crepsculo','Asa de Prata'],\n          rinoceronte: ['Rinoceronte de Guerra','Casco de Pedra','Chifre Tirano'],\n          wyvern: ['Wyvern Veloz','Wyvern do Trovo','Rasga-Cus']\n        };\n        const speedBase: Record<string, number> = {\n          cavalo: 1, lobo: 0, grifo: 1, javali: 0, lagarto: 0, draconiano: 1, urso: 0, felino: 1, cervo: 1, alce: 1, hipogrifo: 1, rinoceronte: 0, wyvern: 1\n        };\n        const attrBase: Record<string, Partial<import('../types/hero').HeroAttributes>> = {\n          cavalo: { destreza: 1 }, lobo: { forca: 2 }, grifo: { destreza: 1 }, javali: { constituicao: 2 }, lagarto: { destreza: 1 }, draconiano: { inteligencia: 1 }, urso: { forca: 2 }, felino: { destreza: 2 }, cervo: { destreza: 1 }, alce: { constituicao: 2 }, hipogrifo: { destreza: 2 }, rinoceronte: { forca: 3, constituicao: 1 }, wyvern: { destreza: 2 }\n        };\n        const confNameList = namePool[pickType] || [pickType];\n        const confName = confNameList[Math.floor(Math.random() * confNameList.length)];\n        const speedBaseVal = speedBase[pickType] || 0;\n        const attrs = attrBase[pickType] || {};\n        const speedBonus = conf.speed + (pickRarity === 'raro' ? 1 : pickRarity === 'epico' ? 2 : pickRarity === 'lendario' ? 2 : 0);\n        const mount: import('../types/hero').Mount = {\n          id: uuidv4(),\n          name: confName,\n          type: pickType,\n          rarity: pickRarity,\n          stage: 'comum',\n          speedBonus: speedBaseVal + (pickRarity === 'raro' ? 1 : pickRarity === 'epico' ? 2 : pickRarity === 'lendario' ? 2 : 0),\n          attributes: { ...attrs },\n          createdAt: now\n        };\n        const mounts = [...(hero.mounts || []), mount];\n        get().updateHero(hero.id, { mounts });\n        try {\n          const flag = localStorage.getItem('auto_activate_recommended_mount') === '1';\n          if (flag) {\n            const stageOrder: Record<string, number> = { comum: 0, encantada: 1, lendaria: 2 };\n            const rarityOrder: Record<string, number> = { comum: 0, incomum: 1, raro: 2, epico: 3, lendario: 4, mistico: 5 };\n            const score = (mm: import('../types/hero').Mount) => {\n              const attrSum = Object.values(mm.attributes || {}).reduce((s, v) => s + (typeof v === 'number' ? v : 0), 0);\n              return (mm.speedBonus || 0) * 3 + attrSum + (stageOrder[mm.stage] || 0) * 2 + (rarityOrder[mm.rarity] || 0);\n            };\n            const best = mounts.slice().sort((a,b)=>score(b)-score(a))[0]?.id;\n            if (best) {\n              const compBonus2 = computeCompanionBonus({ ...hero, activeMountId: best, mounts } as Hero);\n              const derived2 = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus2);\n              get().updateHero(hero.id, { activeMountId: best, derivedAttributes: derived2 });\n              notificationBus.emit({ type: 'item', title: 'Recomendada ativada', message: 'Auto ativao da melhor montaria.', duration: 3000, icon: '' });\n            }\n          }\n        } catch {}\n        try { notificationBus.emit({ type: 'item', title: 'Montaria Obtida', message: `Voc obteve ${mount.name}!`, duration: 4000, icon: '' }); } catch {}\n        try { trackMetric.custom?.('mount_generated', { heroId: hero.id, type: pickType, rarity: pickRarity }); } catch {}\n        return true;\n      },\n\n      renameMountForSelected: (mountId, newName) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const mounts = hero.mounts || [];\n        const idx = mounts.findIndex(m => m.id === mountId);\n        if (idx === -1) return false;\n        const nextMounts = [...mounts];\n        nextMounts[idx] = { ...nextMounts[idx], name: newName };\n        get().updateHero(hero.id, { mounts: nextMounts });\n        try { notificationBus.emit({ type: 'item', title: 'Montaria Renomeada', message: `Agora: ${newName}`, duration: 3000, icon: '' }); } catch {}\n        return true;\n      },\n\n      buyMountOffer: (heroId, type, rarity, price) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        let gold = hero.progression.gold || 0;\n        let finalPrice = price;\n        try {\n          const m = getMonetization();\n          if (m.seasonPassActive?.active) finalPrice = Math.ceil(price * 0.9);\n        } catch {}\n        if (gold < finalPrice) return false;\n        const ok = get().generateMountForSelected(type, rarity);\n        if (!ok) return false;\n        get().updateHero(heroId, { progression: { ...hero.progression, gold: Math.max(0, gold - finalPrice) } });\n        try { notificationBus.emit({ type: 'item', title: 'Compra de Montaria', message: `Oferta adquirida (${type}, ${rarity}).`, duration: 3500, icon: '' }); } catch {}\n        try { trackMetric.custom?.('mount_offer_bought', { heroId, type, rarity, price: finalPrice }); } catch {}\n        return true;\n      },\n\n      importMountsForSelected: (json) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        let arr: any[] = [];\n        try { const parsed = JSON.parse(json); if (Array.isArray(parsed)) arr = parsed; else return false; } catch { return false; }\n        const MAX_MOUNTS = hero.stableCapacity || 50;\n        const remain = Math.max(0, MAX_MOUNTS - (hero.mounts?.length || 0));\n        if (remain <= 0) return false;\n        const take = arr.slice(0, remain);\n        const validTypes: string[] = ['cavalo','lobo','grifo','javali','lagarto','draconiano','urso','felino','cervo','alce','hipogrifo','rinoceronte','wyvern'];\n        const validRarities: string[] = ['comum','incomum','raro','epico','lendario','mistico'];\n        const now = new Date().toISOString();\n        const mountsToAdd = take.map(m => ({\n          id: uuidv4(),\n          name: String(m.name || 'Montaria'),\n          type: validTypes.includes(String(m.type)) ? m.type : 'cavalo',\n          rarity: validRarities.includes(String(m.rarity)) ? m.rarity : 'comum',\n          stage: ['comum','encantada','lendaria'].includes(String(m.stage)) ? m.stage : 'comum',\n          speedBonus: Math.max(0, Number(m.speedBonus || 0)),\n          attributes: typeof m.attributes === 'object' ? m.attributes : {},\n          refineLevel: Math.max(0, Number(m.refineLevel || 0)),\n          mastery: Math.max(0, Number(m.mastery || 0)),\n          history: [{ ts: now, action: 'obtain', details: 'import' }],\n          createdAt: now\n        }));\n        const next = [ ...(hero.mounts || []), ...mountsToAdd ];\n        get().updateHero(hero.id, { mounts: next });\n        try { notificationBus.emit({ type: 'item', title: 'Montarias Importadas', message: `Importadas ${mountsToAdd.length} montarias.`, duration: 3500, icon: '' }); } catch {}\n        return true;\n      },\n\n      releaseCommonMounts: () => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const favs = new Set(hero.favoriteMountIds || []);\n        const next = (hero.mounts || []).filter(m => !(m.rarity === 'comum' && m.id !== hero.activeMountId && !favs.has(m.id) && !m.locked));\n        if (next.length === (hero.mounts || []).length) return false;\n        const updates: Partial<Hero> = { mounts: next } as any;\n        if (hero.activeMountId && !next.some(m => m.id === hero.activeMountId)) (updates as any).activeMountId = undefined;\n        get().updateHero(hero.id, updates);\n        try { notificationBus.emit({ type: 'item', title: 'Montarias Comuns Liberadas', message: 'Liberadas montarias comuns no favoritas.', duration: 3500, icon: '' }); } catch {}\n        return true;\n      },\n\n      upgradeStableForSelected: (costGold: number = 500, increment: number = 10, maxCap: number = 100) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const cap = hero.stableCapacity || 50;\n        if (cap >= maxCap) return false;\n        let gold = hero.progression.gold || 0;\n        let inc = increment;\n        let price = costGold;\n        try {\n          const m = getMonetization();\n          if (m.seasonPassActive?.active) {\n            price = Math.ceil(costGold * 0.8);\n            inc = increment + 5;\n          }\n        } catch {}\n        if (gold < price) return false;\n        const nextCap = Math.min(maxCap, cap + inc);\n        get().updateHero(hero.id, { stableCapacity: nextCap, progression: { ...hero.progression, gold: Math.max(0, gold - price) } });\n        try { notificationBus.emit({ type: 'item', title: 'Estbulo Expandido', message: `Capacidade aumentada para ${nextCap}.`, duration: 3500, icon: '' }); } catch {}\n        try { trackMetric.custom?.('stable_upgraded', { heroId: hero.id, newCapacity: nextCap }); } catch {}\n        return true;\n      },\n\n      trainMountForSelected: async (costGold = 150, bonusSpeed = 1, minutes = 30) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const stCost = 10;\n        try {\n          const check = await canPerformAction(hero.id, 'TRAIN');\n          if (!check.ok) {\n            try { notificationBus.emit({ type: 'stamina', title: 'Fadiga alta', message: `Treino requer ${check.cost} . Descanse para reduzir fadiga.`, duration: 2500, icon: '' }); } catch {}\n            set({ staminaModal: { required: check.cost, actionType: 'TRAIN' } });\n            return false;\n          }\n          const perf = await performAction(hero.id, 'TRAIN', {});\n          const st = hero.stamina || { current: 100, max: 100 } as any;\n          get().updateHero(hero.id, { stamina: { ...st, current: perf.newStamina } });\n        } catch {}\n        let gold = hero.progression.gold || 0;\n        let durMin = minutes;\n        let cost = costGold;\n        try {\n          const m = getMonetization();\n          if (m.seasonPassActive?.active) {\n            cost = Math.ceil(costGold * 0.7);\n            durMin = Math.ceil(minutes * 1.5);\n          }\n        } catch {}\n        if (gold < cost) return false;\n        const expiresAt = new Date(Date.now() + durMin * 60 * 1000).toISOString();\n        const mountBuff = { speedBonus: Math.max(0, bonusSpeed), expiresAt };\n        let nextMounts = hero.mounts || [];\n        const idx = nextMounts.findIndex(mm => mm.id === hero.activeMountId);\n        if (idx >= 0) {\n          const cur = nextMounts[idx];\n          const mastery = Math.max(0, (cur.mastery || 0) + 1);\n          const tier = mastery >= 30 ? 3 : mastery >= 20 ? 2 : mastery >= 10 ? 1 : 0;\n          const prevTier = Math.max(0, cur.rewardTier || 0);\n          let items = { ...hero.inventory.items } as Record<string, number>;\n          if (tier > prevTier) {\n            if (tier === 1) items['pergaminho-montaria'] = (items['pergaminho-montaria'] || 0) + 1;\n            if (tier === 2) items['pedra-magica'] = (items['pedra-magica'] || 0) + 1;\n            if (tier === 3) items['essencia-bestial'] = (items['essencia-bestial'] || 0) + 1;\n            hero.inventory = { ...hero.inventory, items } as any;\n            try { notificationBus.emit({ type: 'item', title: 'Marco de Maestria', message: `Recompensa recebida: ${tier===1?' Pergaminho':tier===2?' Pedra Mgica':' Essncia Bestial'}.`, duration: 4000, icon: '' }); } catch {}\n          }\n          nextMounts = [...nextMounts];\n          nextMounts[idx] = { ...cur, mastery, rewardTier: Math.max(prevTier, tier) };\n        }\n        const compBonus = computeCompanionBonus({ ...hero, mounts: nextMounts } as Hero);\n        const derived = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus);\n        get().updateHero(hero.id, { mountBuff, mounts: nextMounts, derivedAttributes: derived, progression: { ...hero.progression, gold: Math.max(0, gold - cost) } });\n        try { notificationBus.emit({ type: 'item', title: 'Treino de Montaria', message: `Velocidade +${bonusSpeed} por ${durMin} min. Maestria +1.`, duration: 3500, icon: '' }); } catch {}\n        try { get().updateDailyGoalProgress(hero.id, 'mount-trained', 1); } catch {}\n        return true;\n      },\n\n      removeMountForSelected: (mountId: string) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const mounts = hero.mounts || [];\n        if (!mounts.some(m => m.id === mountId)) return false;\n        const target = mounts.find(m => m.id === mountId);\n        if (target?.locked) { try { notificationBus.emit({ type: 'item', title: 'Montaria Travada', message: 'Destrave para poder liberar.', duration: 3000, icon: '' }); } catch {} ; return false; }\n        try {\n          const idx = mounts.findIndex(m => m.id === mountId);\n          if (idx >= 0) {\n            const mm = mounts[idx];\n            const hist = [{ ts: new Date().toISOString(), action: 'release', details: '' }, ...((mm.history)||[])].slice(0,50);\n            const nextMounts = [...mounts];\n            nextMounts[idx] = { ...mm, history: hist };\n            hero.mounts = nextMounts;\n          }\n        } catch {}\n        const next = mounts.filter(m => m.id !== mountId);\n        const updates: Partial<Hero> = { mounts: next } as any;\n        if (hero.activeMountId === mountId) (updates as any).activeMountId = undefined;\n        if (hero.favoriteMountId === mountId) (updates as any).favoriteMountId = undefined;\n        get().updateHero(hero.id, updates);\n        try { notificationBus.emit({ type: 'item', title: 'Montaria Liberada', message: 'A montaria foi removida do seu estbulo.', duration: 3000, icon: '' }); } catch {}\n        return true;\n      },\n\n      addMountToSelected: (mount) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const mounts = [...(hero.mounts || []), mount];\n        get().updateHero(hero.id, { mounts });\n        return true;\n      },\n\n      evolveMountForSelected: (mountId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const mounts = hero.mounts || [];\n        const idx = mounts.findIndex(m => m.id === mountId);\n        if (idx === -1) return false;\n        const m = mounts[idx];\n        let nextStage: import('../types/hero').MountStage | undefined;\n        if (m.stage === 'comum') nextStage = 'encantada'; else if (m.stage === 'encantada') nextStage = 'lendaria'; else { try { notificationBus.emit({ type: 'item', title: 'Estgio Mximo', message: 'Esta montaria j  Lendria.', duration: 3500, icon: '' }); } catch {} ; return false; }\n        const hasScroll = (hero.inventory.items['pergaminho-montaria'] || 0) > 0;\n        const needsEssence = nextStage === 'lendaria';\n        const hasEssence = (hero.inventory.items['essencia-bestial'] || 0) > 0;\n        const costGold = m.stage === 'comum' ? 200 : 700;\n        if (!hasScroll) { try { notificationBus.emit({ type: 'item', title: 'Pergaminho insuficiente', message: 'Falta  Pergaminho de Montaria para evoluir.', duration: 3500, icon: '' }); } catch {} ; return false; }\n        if ((hero.progression.gold || 0) < costGold) { try { notificationBus.emit({ type: 'gold', title: 'Ouro insuficiente', message: `Evoluo requer ${costGold} ouro.`, duration: 3500 }); } catch {} ; return false; }\n        if (needsEssence && !hasEssence) { try { notificationBus.emit({ type: 'item', title: 'Essncia necessria', message: 'Para Lendria, voc precisa de  Essncia Bestial.', duration: 4000, icon: '' }); } catch {} ; return false; }\n        const updatedSpeed = (m.speedBonus || 0) + (nextStage === 'encantada' ? 1 : 2);\n        const stageAttrBoost: Partial<HeroAttributes> = (() => {\n          const smallBoost = () => {\n            switch (m.type) {\n              case 'lobo':\n              case 'urso':\n              case 'rinoceronte':\n              case 'javali':\n                return { forca: 1 };\n              case 'grifo':\n              case 'hipogrifo':\n              case 'felino':\n              case 'cervo':\n              case 'alce':\n              case 'lagarto':\n              case 'wyvern':\n              case 'cavalo':\n                return { destreza: 1 };\n              case 'draconiano':\n                return { inteligencia: 1 };\n              default:\n                return { destreza: 1 };\n            }\n          };\n          const largeBoost = () => {\n            switch (m.type) {\n              case 'grifo':\n              case 'hipogrifo':\n              case 'felino':\n              case 'wyvern':\n              case 'cavalo':\n              case 'lagarto':\n              case 'cervo':\n              case 'alce':\n                return { destreza: 2 };\n              case 'lobo':\n              case 'urso':\n              case 'rinoceronte':\n              case 'javali':\n                return { forca: 2 };\n              case 'draconiano':\n                return { inteligencia: 2 };\n              default:\n                return { forca: 2 };\n            }\n          };\n          return nextStage === 'encantada' ? smallBoost() : largeBoost();\n        })();\n        const newAttrs = { ...(m.attributes || {}) };\n        Object.entries(stageAttrBoost).forEach(([k, v]) => { newAttrs[k as keyof HeroAttributes] = (newAttrs[k as keyof HeroAttributes] || 0) + (v as number); });\n        const hist = [{ ts: new Date().toISOString(), action: 'evolve', details: ` ${nextStage}` }, ...((m.history)||[])].slice(0,50);\n        const newMount = { ...m, stage: nextStage, speedBonus: updatedSpeed, attributes: newAttrs, history: hist };\n        const nextMounts = [...mounts];\n        nextMounts[idx] = newMount;\n        const newItems = { ...hero.inventory.items } as Record<string, number>;\n        newItems['pergaminho-montaria'] = (newItems['pergaminho-montaria'] || 1) - 1;\n        if (newItems['pergaminho-montaria'] <= 0) delete newItems['pergaminho-montaria'];\n        if (needsEssence) {\n          newItems['essencia-bestial'] = (newItems['essencia-bestial'] || 1) - 1;\n          if (newItems['essencia-bestial'] <= 0) delete newItems['essencia-bestial'];\n        }\n        const compBonus = computeCompanionBonus({ ...hero, mounts: nextMounts } as Hero);\n        const derived = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus);\n        get().updateHero(hero.id, { mounts: nextMounts, inventory: { ...hero.inventory, items: newItems }, progression: { ...hero.progression, gold: Math.max(0, (hero.progression.gold || 0) - costGold) }, derivedAttributes: derived });\n        try {\n          const flag = localStorage.getItem('auto_activate_recommended_mount') === '1';\n          if (flag) {\n            const stageOrder: Record<string, number> = { comum: 0, encantada: 1, lendaria: 2 };\n            const rarityOrder: Record<string, number> = { comum: 0, incomum: 1, raro: 2, epico: 3, lendario: 4, mistico: 5 };\n            const score = (mm: import('../types/hero').Mount) => {\n              const attrSum = Object.values(mm.attributes || {}).reduce((s, v) => s + (typeof v === 'number' ? v : 0), 0);\n              return (mm.speedBonus || 0) * 3 + attrSum + (stageOrder[mm.stage] || 0) * 2 + (rarityOrder[mm.rarity] || 0);\n            };\n            const best = nextMounts.slice().sort((a,b)=>score(b)-score(a))[0]?.id;\n            if (best) {\n              const compBonus2 = computeCompanionBonus({ ...hero, activeMountId: best, mounts: nextMounts } as Hero);\n              const derived2 = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus2);\n              get().updateHero(hero.id, { activeMountId: best, derivedAttributes: derived2 });\n              notificationBus.emit({ type: 'item', title: 'Recomendada ativada', message: 'Auto ativao da melhor montaria.', duration: 3000, icon: '' });\n            }\n          }\n        } catch {}\n        try { notificationBus.emit({ type: 'item', title: 'Montaria Evoluda', message: `${m.name} agora  ${nextStage}. Velocidade +${updatedSpeed - (m.speedBonus || 0)}.`, duration: 4000, icon: '' }); } catch {}\n        try { get().updateDailyGoalProgress(hero.id, 'mount-evolved', 1); } catch {}\n        try { trackMetric.custom?.('mount_evolved', { heroId: hero.id, mountId, stage: nextStage }); } catch {}\n        return true;\n      },\n\n      refineCompanion: (heroId, kind, id) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const stonesMagic = hero.inventory.items['pedra-magica'] || 0;\n        const stonesLink = hero.inventory.items['essencia-vinculo'] || 0;\n        const stones = stonesMagic + stonesLink;\n        if (stones <= 0) { try { notificationBus.emit({ type: 'item', title: 'Materiais insuficientes', message: 'Voc precisa de Pedra Mgica ou Essncia de Vnculo.', duration: 3500, icon: '' }); } catch {} ; return false; }\n        const updateRefine = (current: number) => {\n          const next = Math.min(10, current + 1);\n          const chance = next <= 3 ? 1 : next <= 6 ? 0.75 : 0.45;\n          return Math.random() <= chance ? next : current;\n        };\n        let changed = false;\n        if (kind === 'pet') {\n          const pets = hero.pets || [];\n          const idx = pets.findIndex(p => p.id === id);\n          if (idx === -1) return false;\n          const p = pets[idx];\n          const newLevel = updateRefine(p.refineLevel || 0);\n          if (newLevel !== (p.refineLevel || 0)) {\n            const nextPets = [...pets];\n            nextPets[idx] = { ...p, refineLevel: newLevel };\n            hero.pets = nextPets;\n            changed = true;\n          }\n        } else {\n          const mounts = hero.mounts || [];\n          const idx = mounts.findIndex(m => m.id === id);\n          if (idx === -1) return false;\n          const m = mounts[idx];\n          const newLevel = updateRefine(m.refineLevel || 0);\n          if (newLevel !== (m.refineLevel || 0)) {\n            const nextMounts = [...mounts];\n            const hist = [{ ts: new Date().toISOString(), action: 'refine', details: ` ${newLevel}` }, ...((m.history)||[])].slice(0,50);\n            nextMounts[idx] = { ...m, refineLevel: newLevel, history: hist };\n            hero.mounts = nextMounts;\n            changed = true;\n          }\n        }\n        if (!changed) { try { notificationBus.emit({ type: 'item', title: 'Refino falhou', message: 'A tentativa de refino no teve efeito desta vez.', duration: 3000, icon: '' }); } catch {} ; return false; }\n        const newItems = { ...hero.inventory.items } as Record<string, number>;\n        if (stonesMagic > 0) {\n          newItems['pedra-magica'] = stonesMagic - 1;\n          if (newItems['pedra-magica'] <= 0) delete newItems['pedra-magica'];\n        } else if (stonesLink > 0) {\n          newItems['essencia-vinculo'] = stonesLink - 1;\n          if (newItems['essencia-vinculo'] <= 0) delete newItems['essencia-vinculo'];\n        }\n        const compBonus = computeCompanionBonus(hero);\n        const derived = calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle, compBonus);\n        get().updateHero(hero.id, { inventory: { ...hero.inventory, items: newItems }, derivedAttributes: derived });\n        try { notificationBus.emit({ type: 'item', title: kind === 'mount' ? 'Montaria Refinada' : 'Mascote Refinado', message: 'Bnus do companheiro aumentados em +1% por nvel de refino.', duration: 3500, icon: kind === 'mount' ? '' : '' }); } catch {}\n        try { if (kind === 'mount') get().updateDailyGoalProgress(hero.id, 'mount-refined', 1); } catch {}\n        try { if (kind === 'mount') trackMetric.custom?.('mount_refined', { heroId: hero.id, mountId: id }); } catch {}\n        return true;\n      },\n\n      refinePetForSelected: (petId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        return get().refineCompanion(hero.id, 'pet', petId);\n      },\n      refineMountForSelected: (mountId) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        return get().refineCompanion(hero.id, 'mount', mountId);\n      },\n\n      suggestCompanionQuestForSelected: () => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const inv = hero.inventory.items || {} as Record<string, number>;\n        const missing: string[] = [];\n        const mount = (hero.mounts || []).find(m => m.id === hero.activeMountId);\n        if (mount) {\n          if (mount.stage === 'comum' && (inv['pergaminho-montaria'] || 0) < 1) missing.push('pergaminho-montaria');\n          if (mount.stage === 'encantada') {\n            if ((inv['pergaminho-montaria'] || 0) < 1) missing.push('pergaminho-montaria');\n            if ((inv['essencia-bestial'] || 0) < 1) missing.push('essencia-bestial');\n          }\n        }\n        const pet = (hero.pets || []).find(p => p.id === hero.activePetId);\n        if (pet && (pet.refineLevel || 0) < 10) {\n          if ((inv['pedra-magica'] || 0) < 1 && (inv['essencia-vinculo'] || 0) < 1) missing.push('pedra-magica');\n        }\n        if (missing.length === 0) return false;\n        const target = missing[0];\n        const q: Quest = {\n          id: `companion-${target}-${Date.now()}`,\n          title: target === 'essencia-bestial' ? 'Encontrar a Essncia Bestial' : target === 'pergaminho-montaria' ? 'Conseguir Pergaminho de Montaria' : 'Refinar Vnculo do Mascote',\n          description: target === 'essencia-bestial' ? 'Explore runas ou derrote um boss para coletar a Essncia Bestial.' : target === 'pergaminho-montaria' ? 'Complete tarefas da guilda para obter um Pergaminho de Montaria.' : 'Participe de treinos e rituais para fortalecer o vnculo com seu mascote.',\n          type: target === 'essencia-bestial' ? 'exploracao' : 'caca',\n          difficulty: 'padrao',\n          levelRequirement: Math.max(1, hero.progression.level),\n          rewards: { gold: 50, xp: 40, items: [{ id: target, qty: 1 }] },\n          repeatable: false,\n          isGuildQuest: true,\n          sticky: true\n        };\n        set((state) => ({ availableQuests: [q, ...state.availableQuests] }));\n        try {\n          const cur = hero.stats?.suggestedCompanionMissions || 0;\n          get().updateHero(hero.id, { stats: { ...hero.stats, suggestedCompanionMissions: cur + 1 } });\n        } catch {}\n        try {\n          const v = localStorage.getItem('auto_accept_companion_mission');\n          if (v === '1') {\n            get().acceptQuest(hero.id, q.id);\n          }\n        } catch {}\n        return true;\n      },\n\n      // === SISTEMA DE CONVITES / INDICAES ===\n      createReferralInvite: (inviterHeroId: string): ReferralInvite | null => {\n        const state = get();\n        const inviter = state.heroes.find(h => h.id === inviterHeroId);\n        if (!inviter) return null;\n        const code = uuidv4().slice(0, 8);\n        const validityDays = Math.max(1, getGameSettings().inviteLinkValidityDays || 7);\n        const expiresAt = new Date(Date.now() + validityDays * 24 * 3600 * 1000).toISOString();\n        const inviterTag = String(inviter.name || 'heroi');\n        const personalizedSlug = `${inviterTag.toLowerCase().replace(/[^a-z0-9]+/g,'-')}-${code}`;\n        const invite: ReferralInvite = {\n          id: uuidv4(),\n          code,\n          inviterHeroId,\n          createdAt: new Date().toISOString(),\n          status: 'pending',\n          rewardGranted: false,\n          expiresAt,\n          inviterTag,\n          personalizedSlug,\n          activity: [{ ts: new Date().toISOString(), action: 'created' }]\n        };\n        set(s => ({ referralInvites: [...(s.referralInvites || []), invite] }));\n        // Mtrica de criao de convite\n        trackMetric.custom?.('referral_created', { inviterHeroId, code });\n        return invite;\n      },\n\n      getReferralInvitesForHero: (heroId: string): ReferralInvite[] => {\n        const state = get();\n        return (state.referralInvites || []).filter(i => i.inviterHeroId === heroId);\n      },\n\n      acceptReferralInvite: (code: string, newHeroId: string): boolean => {\n        const state = get();\n        const inviteIndex = (state.referralInvites || []).findIndex(i => i.code === code && i.status === 'pending');\n        if (inviteIndex === -1) return false;\n        const invite = state.referralInvites[inviteIndex];\n        if (invite.expiresAt && new Date(invite.expiresAt).getTime() < Date.now()) {\n          const expiredInvite: ReferralInvite = { ...invite, status: 'expired', activity: [...(invite.activity||[]), { ts: new Date().toISOString(), action: 'expired' }] };\n          set(s => ({ referralInvites: s.referralInvites.map((i, idx) => idx === inviteIndex ? expiredInvite : i) }));\n          return false;\n        }\n        const inviter = state.heroes.find(h => h.id === invite.inviterHeroId);\n        const newHero = state.heroes.find(h => h.id === newHeroId);\n        if (!inviter || !newHero) return false;\n        // Marcar aceitao\n        const updatedInvite: ReferralInvite = {\n          ...invite,\n          status: 'accepted',\n          acceptedHeroId: newHeroId,\n          acceptedAt: new Date().toISOString()\n        };\n        set(s => ({\n          referralInvites: s.referralInvites.map((i, idx) => idx === inviteIndex ? { ...updatedInvite, activity: [...(updatedInvite.activity||invite.activity||[]), { ts: new Date().toISOString(), action: 'accepted', details: newHeroId }] } : i)\n        }));\n        // Conceder bnus ao convidador\n        const bonusGold = Math.max(0, getGameSettings().inviteRewardGold || 0);\n        const bonusXP = Math.max(0, getGameSettings().inviteRewardXP || 0);\n        get().gainGold(inviter.id, bonusGold);\n        get().gainXP(inviter.id, bonusXP);\n        try {\n          const acceptedCount = (get().getReferralInvitesForHero(inviter.id) || []).filter(i => i.status === 'accepted').length;\n          if (acceptedCount === 1 || acceptedCount === 5 || acceptedCount === 10) {\n            notificationBus.emit({ type: 'achievement', title: 'Convite bem-sucedido!', message: `Marcos atingidos: ${acceptedCount} aceites`, icon: '', duration: 4000 });\n            if (acceptedCount === 5) { get().gainGold(inviter.id, Math.floor(bonusGold * 2)); }\n            if (acceptedCount === 10) { get().gainXP(inviter.id, Math.floor(bonusXP * 2)); }\n          }\n        } catch {}\n        // Marcar recompensa concedida\n        set(s => ({\n          referralInvites: s.referralInvites.map(i => i.id === updatedInvite.id ? { ...i, rewardGranted: true } : i)\n        }));\n        // Mtrica de aceite de convite\n        trackMetric.custom?.('referral_accepted', { inviterHeroId: inviter.id, newHeroId, code, bonusGold, bonusXP });\n        return true;\n      },\n\n      revokeReferralInvite: (inviteId: string): boolean => {\n        const state = get();\n        const idx = (state.referralInvites || []).findIndex(i => i.id === inviteId && i.status === 'pending');\n        if (idx === -1) return false;\n        const cur = state.referralInvites[idx];\n        const next: ReferralInvite = { ...cur, status: 'expired', activity: [...(cur.activity||[]), { ts: new Date().toISOString(), action: 'revoked' }] };\n        set(s => ({ referralInvites: s.referralInvites.map((i, j) => j === idx ? next : i) }));\n        return true;\n      },\n\n      expireOldInvites: () => {\n        const state = get();\n        const now = Date.now();\n        const next = (state.referralInvites || []).map(i => {\n          if (i.status !== 'pending') return i;\n          if (i.expiresAt && new Date(i.expiresAt).getTime() < now) {\n            return { ...i, status: 'expired', activity: [...(i.activity||[]), { ts: new Date().toISOString(), action: 'expired' }] };\n          }\n          return i;\n        });\n        set({ referralInvites: next });\n      },\n\n      getReferralStatsForHero: (heroId: string) => {\n        const list = get().getReferralInvitesForHero(heroId);\n        const total = list.length;\n        const pending = list.filter(i => i.status === 'pending').length;\n        const accepted = list.filter(i => i.status === 'accepted').length;\n        const expired = list.filter(i => i.status === 'expired').length;\n        const rewardsGranted = list.filter(i => i.rewardGranted).length;\n        return { total, pending, accepted, expired, rewardsGranted };\n      },\n\n      logReferralActivity: (inviteId: string, action: 'shared' | 'revoked' | 'expired' | 'accepted', details?: string) => {\n        set(s => ({\n          referralInvites: (s.referralInvites || []).map(i => i.id === inviteId ? { ...i, activity: [...(i.activity||[]), { ts: new Date().toISOString(), action, details }] } : i)\n        }));\n      },\n\n      updateReferralInvite: (inviteId, updates) => {\n        let changed = false;\n        set(s => ({\n          referralInvites: (s.referralInvites || []).map(i => {\n            if (i.id !== inviteId) return i;\n            changed = true;\n            return { ...i, ...updates };\n          })\n        }));\n        return changed;\n      },\n\n      renewReferralInvite: (inviteId, extraDays = Math.max(1, getGameSettings().inviteLinkValidityDays || 7)) => {\n        const cur = get().referralInvites.find(i => i.id === inviteId);\n        if (!cur) return false;\n        const base = cur.expiresAt ? new Date(cur.expiresAt).getTime() : Date.now();\n        const expiresAt = new Date(base + extraDays * 24 * 3600 * 1000).toISOString();\n        set(s => ({\n          referralInvites: (s.referralInvites || []).map(i => i.id === inviteId ? { ...i, expiresAt, status: i.status === 'expired' ? 'pending' : i.status, activity: [...(i.activity||[]), { ts: new Date().toISOString(), action: 'renewed' }] } : i)\n        }));\n        return true;\n      },\n\n      getReferralInviteByCode: (code: string) => {\n        const state = get();\n        return (state.referralInvites || []).find(i => i.code === code);\n      },\n      \n      updateHero: (id, heroData) => {\n        set(state => ({\n          heroes: state.heroes.map(hero => {\n            if (hero.id !== id) return hero;\n            const nowIso = new Date().toISOString();\n            const updatedTop = { ...hero, ...heroData, updatedAt: nowIso } as Hero;\n            if (heroData.stats) {\n              updatedTop.stats = { ...hero.stats, ...heroData.stats } as any;\n            }\n            if (heroData.stamina) {\n              updatedTop.stamina = { ...(hero.stamina as any), ...(heroData.stamina as any) } as any;\n            }\n            if (heroData.progression) {\n              updatedTop.progression = { ...hero.progression, ...heroData.progression } as any;\n            }\n            if (heroData.attributes || heroData.class || heroData.level || heroData.inventory || heroData.activeTitle !== undefined || heroData.activePetId !== undefined || heroData.activeMountId !== undefined || heroData.pets || heroData.mounts) {\n              const finalAttributes = heroData.attributes \n                ? { ...hero.attributes, ...heroData.attributes }\n                : hero.attributes;\n              const finalClass = heroData.class || hero.class;\n              const finalLevel = heroData.level || hero.progression.level;\n              const finalInventory = heroData.inventory || hero.inventory;\n              const finalActiveTitle = heroData.activeTitle !== undefined ? heroData.activeTitle : hero.activeTitle;\n              const compBonus = computeCompanionBonus({ ...hero, ...heroData } as Hero);\n              updatedTop.derivedAttributes = calculateDerivedAttributes(\n                finalAttributes,\n                finalClass,\n                finalLevel,\n                finalInventory,\n                finalActiveTitle,\n                compBonus\n              );\n            }\n            const beforeCompleted = Array.isArray(hero.completedQuests) ? hero.completedQuests.length : 0;\n            const afterCompleted = Array.isArray((updatedTop as any).completedQuests) ? (updatedTop as any).completedQuests.length : beforeCompleted;\n            const beforeMissions = hero.stats?.questsCompleted || 0;\n            const afterMissions = (updatedTop.stats?.questsCompleted ?? beforeMissions);\n            if (afterCompleted < beforeCompleted || afterMissions < beforeMissions) {\n              try { trackMetric.featureUsed(id, `mission-reset-detected:${beforeMissions}->${afterMissions}`); } catch {}\n              try { console.warn('mission reset detected', { heroId: id, beforeMissions, afterMissions, beforeCompleted, afterCompleted, ts: nowIso }); } catch {}\n            }\n            return updatedTop;\n          })\n        }));\n      },\n\n      exportHeroJson: (id: string) => {\n        const hero = get().heroes.find(h => h.id === id);\n        if (!hero) return '';\n        try {\n          return JSON.stringify(hero, null, 2);\n        } catch {\n          return '';\n        }\n      },\n\n      importHero: (incomingHero: Hero, selectAfter = true) => {\n        if (!incomingHero?.id) return false;\n        const nowIso = new Date().toISOString();\n        const ensuredDerived = calculateDerivedAttributes(\n          incomingHero.attributes,\n          incomingHero.class,\n          incomingHero.progression?.level || incomingHero.level || 1,\n          incomingHero.inventory,\n          incomingHero.activeTitle,\n          computeCompanionBonus(incomingHero as Hero)\n        );\n        const normalized: Hero = {\n          ...incomingHero,\n          derivedAttributes: ensuredDerived,\n          updatedAt: nowIso,\n          createdAt: incomingHero.createdAt || nowIso,\n        } as Hero;\n        set((state) => {\n          const idx = state.heroes.findIndex(h => h.id === normalized.id);\n          const updatedHeroes = [...state.heroes];\n          if (idx >= 0) {\n            updatedHeroes[idx] = { ...updatedHeroes[idx], ...normalized };\n          } else {\n            updatedHeroes.push(normalized);\n          }\n          return {\n            heroes: updatedHeroes,\n            selectedHeroId: selectAfter ? normalized.id : state.selectedHeroId,\n          } as any;\n        });\n        return true;\n      },\n      \n      deleteHero: (id) => {\n        set(state => ({\n          heroes: state.heroes.filter(hero => hero.id !== id),\n          selectedHeroId: state.selectedHeroId === id ? null : state.selectedHeroId\n        }));\n      },\n      \n      selectHero: (id) => {\n        const hero = get().heroes.find(h => h.id === id);\n        if (!hero || hero.origin === 'npc') return;\n        set({ selectedHeroId: id });\n      },\n\n      // === NARRATIVA ===\n      setDMOverrideLine: (line) => {\n        set({ dmOverrideLine: line });\n      },\n      appendJourneyNarrativeForSelected: (summary, title) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return false;\n        const now = new Date().toISOString();\n        const existing = hero.journeyChapters || [];\n        const index = (existing.length || 0) + 1;\n        const chapter = {\n          id: `custom-${hero.id}-${index}-${Math.random().toString(36).slice(2)}`,\n          index,\n          title: title || `Crnica ${index}`,\n          summary,\n          createdAt: now,\n          levelMilestone: hero.progression?.level || 1,\n          locked: false,\n          relatedQuests: hero.completedQuests || []\n        } as any;\n        get().updateHero(hero.id, { journeyChapters: [...existing, chapter] });\n        return true;\n      },\n      \n      // === SISTEMA DE MISSES ===\n      \n      refreshQuests: (heroLevel = 1) => {\n        const state = get();\n        const selectedHero = state.getSelectedHero();\n        let guildLevel = 0;\n        \n        // Usar a Foja dos Herois como hub global para misses/ranking\n        const defaultGuild = state.guilds.find(g => g.name === 'Foja dos Herois');\n        if (defaultGuild) {\n          const calcLevel = (xp: number) => Math.max(1, Math.floor(xp / 250) + 1);\n          guildLevel = defaultGuild.level ?? calcLevel(defaultGuild.guildXP);\n          if (defaultGuild.level !== guildLevel) {\n            set(state => ({\n              guilds: state.guilds.map(g => g.id === defaultGuild.id ? { ...g, level: guildLevel } : g)\n            }));\n          }\n          console.log(' Hub da Guilda encontrado:', defaultGuild.name, 'Nvel:', guildLevel);\n        }\n        \n        console.log(' Gerando misses - Heri Level:', heroLevel, 'Guilda Level:', guildLevel);\n        const heroRank = selectedHero ? rankSystem.calculateRank(selectedHero) : 'F';\n        const newQuests = generateQuestBoard(heroLevel, guildLevel, heroRank as any);\n        const nextCatalog: Record<string, Quest> = { ...state.questCatalog };\n\n        // Manter misses sticky da lista anterior (evitar desaparecer em refresh)\n        const previousStickyLimited = state.availableQuests.filter(q => q.sticky).slice(0, 3);\n        const stickyIds = new Set(previousStickyLimited.map(q => q.id));\n\n        // Preservar misses ATIVAS dos heris durante o refresh\n        // Coleta todos os IDs de misses ativas para evitar que sumam da aba \"Ativas\"\n        const activeIds = new Set<string>(\n          state.heroes.flatMap(h => h.activeQuests || [])\n        );\n        const carryOverActive = state.availableQuests.filter(q => activeIds.has(q.id));\n\n        // Inserir Misso de Desafio da Guilda para Promoo de Rank, se elegvel\n        if (selectedHero) {\n          const progress = rankSystem.calculateProgress(selectedHero);\n          if (progress.canPromote && progress.nextRank) {\n            const promoQuestId = `guild-promotion-${Date.now()}`;\n            const rankInfo = (rankSystem as any).getRankInfo?.(progress.nextRank);\n            const title = rankInfo ? `Desafio de Promoo: ${rankInfo.name}` : `Desafio de Promoo de Rank ${progress.nextRank}`;\n            const description = rankInfo ? `A guilda convoca ${selectedHero.name} para provar seu valor e ascender ao rank ${progress.nextRank} - ${rankInfo.description}` : `Prove seu valor para ascender ao rank ${progress.nextRank}. Complete objetivos desafiadores sob avaliao da guilda.`;\n            const promo = {\n              id: promoQuestId,\n              title,\n              description,\n              type: 'historia',\n              difficulty: 'epica',\n              levelRequirement: Math.max(1, selectedHero.progression.level),\n              timeLimit: Math.floor(Math.random() * 61) + 120,\n              enemies: [{ type: 'Campeo da Guilda', count: 1, level: selectedHero.progression.level }],\n              rewards: { gold: 200, xp: 150, items: [{ id: 'pergaminho-xp', qty: 1 }] },\n              repeatable: false,\n              isGuildQuest: true,\n              sticky: true,\n              failurePenalty: { gold: 50, reputation: -10 }\n            } as Quest;\n            newQuests.push(promo);\n            nextCatalog[promo.id] = promo;\n            console.log(' Misso de promoo de rank inserida:', title);\n          }\n        }\n        // Reaplicar misses sticky anteriores que no conflitem por id\n        previousStickyLimited.forEach(stq => {\n          if (!stickyIds.has(stq.id)) {\n            newQuests.push(stq);\n            nextCatalog[stq.id] = stq;\n          }\n        });\n\n        // Reaplicar misses ativas anteriores (no-sticky) para manter detalhes visveis\n        const existingIds = new Set(newQuests.map(q => q.id));\n        carryOverActive.forEach(aq => {\n          if (!existingIds.has(aq.id)) {\n            newQuests.push(aq);\n            nextCatalog[aq.id] = aq;\n          }\n        });\n\n        console.log(' Misses geradas:', newQuests.length, 'total,', newQuests.filter(q => q.isGuildQuest).length, 'de guilda');\n        const hasCaca = newQuests.some(q => q.type === 'caca');\n        const hasExploracao = newQuests.some(q => q.type === 'exploracao');\n        if (!hasCaca) {\n          for (let i = 0; i < 5; i++) {\n            const qTry = generateQuest('padrao', heroLevel, false);\n            if (qTry.type === 'caca') { newQuests.push(qTry); nextCatalog[qTry.id] = qTry; break; }\n          }\n        }\n        if (!hasExploracao) {\n          for (let i = 0; i < 5; i++) {\n            const qTry = generateQuest('padrao', heroLevel, false);\n            if (qTry.type === 'exploracao') { newQuests.push(qTry); nextCatalog[qTry.id] = qTry; break; }\n          }\n        }\n        const completedSet = new Set<string>(selectedHero?.completedQuests || []);\n        newQuests.forEach(q => { nextCatalog[q.id] = q; });\n        const filtered = newQuests.filter(q => !completedSet.has(q.id));\n        set({ availableQuests: filtered, questCatalog: nextCatalog });\n      },\n\n      acceptQuest: async (heroId: string, questId: string) => {\n        console.log(' acceptQuest chamada:', { heroId, questId });\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        const quest = state.availableQuests.find(q => q.id === questId);\n        console.log(' Heri encontrado:', hero ? `${hero.name} (Level ${hero.progression.level})` : 'No encontrado');\n        console.log(' Misso encontrada:', quest ? `${quest.title} (Level ${quest.levelRequirement})` : 'No encontrada');\n        if (!hero || !quest) {\n          console.log(' Heri ou misso no encontrados');\n          try { notificationBus.emit({ type: 'quest', title: 'Misso indisponvel', message: 'No foi possvel localizar esta misso.', duration: 2500, icon: '' }); } catch {}\n          return false;\n        }\n        if (hero.progression.level < quest.levelRequirement) {\n          console.log(' Nvel insuficiente:', hero.progression.level, '<', quest.levelRequirement);\n          try { notificationBus.emit({ type: 'quest', title: 'Nvel insuficiente', message: `Requer nvel ${quest.levelRequirement}.`, duration: 2500, icon: '' }); } catch {}\n          return false;\n        }\n        if (hero.activeQuests.includes(questId)) {\n          console.log(' Misso j ativa:', questId);\n          try { notificationBus.emit({ type: 'quest', title: 'Misso j ativa', message: `${quest.title}`, duration: 2000, icon: '' }); } catch {}\n          return true;\n        }\n        if ((hero.completedQuests || []).includes(questId)) {\n          console.log(' Misso j concluda anteriormente:', questId);\n          try { notificationBus.emit({ type: 'quest', title: 'J concluda', message: `${quest.title}`, duration: 2000, icon: '' }); } catch {}\n          return false;\n        }\n        if (hero.activeQuests.length >= 3) {\n          console.log(' Mximo de misses ativas atingido:', hero.activeQuests.length);\n          try { notificationBus.emit({ type: 'quest', title: 'Limite de misses', message: 'Mximo de 3 misses ativas.', duration: 2500, icon: '' }); } catch {}\n          return false;\n        }\n        try {\n          const diff = String(quest.difficulty || '').toLowerCase();\n          const actionType = diff === 'facil' ? 'MISSION_SHORT' : (diff === 'medio' || diff === 'padrao') ? 'MISSION_MEDIUM' : (diff === 'dificil' ? 'MISSION_LONG' : 'MISSION_MEDIUM');\n          const check = await canPerformAction(heroId, actionType);\n          if (!check.ok) {\n            try { notificationBus.emit({ type: 'stamina', title: 'Fadiga alta', message: `Custo: ${check.cost}   descanse para reduzir fadiga.`, duration: 3000, icon: '' }); } catch {}\n            set({ staminaModal: { required: check.cost, actionType } });\n            return false;\n          }\n          const perf = await performAction(heroId, actionType, { questId });\n          const st = hero.stamina || { current: 100, max: 100 } as any;\n          get().updateHero(heroId, { stamina: { ...st, current: perf.newStamina } });\n        } catch {}\n        console.log(' Todos os requisitos atendidos, adicionando misso s ativas');\n        get().updateHero(heroId, { activeQuests: [...hero.activeQuests, questId] });\n        set((s) => ({ questCatalog: { ...s.questCatalog, [questId]: quest } }));\n        try { notificationBus.emit({ type: 'quest', title: 'Misso aceita', message: `${quest.title}`, duration: 2500, icon: '' }); } catch {}\n        console.log(' Misso aceita com sucesso!');\n        try { onboardingManager.markStepValidated('accept-quest'); onboardingManager.saveState(); } catch {}\n        return true;\n      },\n      \n      completeQuest: (heroId: string, questId: string, autoResolve = false) => {\n        console.log(' completeQuest chamada:', { heroId, questId, autoResolve });\n        \n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        const quest = state.availableQuests.find(q => q.id === questId);\n        \n        console.log(' Heri encontrado:', hero ? `${hero.name} (Level ${hero.progression.level})` : 'No encontrado');\n        console.log(' Misso encontrada:', quest ? `${quest.title} (Level ${quest.levelRequirement})` : 'No encontrada');\n        console.log(' Misso est ativa?', hero?.activeQuests.includes(questId));\n        \n        if (!hero || !quest) {\n          console.log(' Falha na validao inicial');\n          return null;\n        }\n        \n        let combatResult: CombatResult | null = null;\n\n        \n        \n        // Resolver combate se houver inimigos\n        if (quest.enemies && quest.enemies.length > 0) {\n          const isGuildQuest = quest.isGuildQuest || false;\n          combatResult = autoResolve \n            ? autoResolveCombat(hero, quest.enemies, isGuildQuest)\n            : resolveCombat(hero, quest.enemies);\n          \n          if (!combatResult.victory) {\n            if (quest.failurePenalty) {\n              if (quest.failurePenalty.gold) {\n                get().gainGold(heroId, -quest.failurePenalty.gold);\n              }\n              if (quest.failurePenalty.reputation) {\n                const factionFail = quest.isGuildQuest ? 'Guarda da Cidade' : (quest.type === 'exploracao' ? 'Exploradores' : 'Guarda da Cidade');\n                state.updateReputation(factionFail, quest.failurePenalty.reputation);\n              }\n            }\n            // Continua fluxo de concluso com recompensas reduzidas\n          }\n        }\n        \n        // Sucesso na misso - aplicar recompensas\n        console.log(' Misso completada com sucesso! Aplicando recompensas...');\n        console.log(' Recompensas:', quest.rewards);\n        console.log(' Resultado do combate:', combatResult);\n        try {\n          const curStats = hero.stats || ({} as any);\n          const isColeta = quest.categoryHint === 'coleta' || quest.type === 'exploracao';\n          const nextColeta = (curStats.collectionQuestsCompleted || 0) + (isColeta ? 1 : 0);\n          const stableQuestDone = quest.isGuildQuest && quest.templateId === 'guild-ovo-basico' ? true : (curStats.stableUnlockQuestCompleted === true);\n          get().updateHero(heroId, { stats: { ...hero.stats, collectionQuestsCompleted: nextColeta, stableUnlockQuestCompleted: stableQuestDone } });\n        } catch {}\n        \n        const prevHeroBeforeXP = { ...hero } as Hero;\n        get().gainXP(heroId, (quest.rewards?.xp || 0) + (combatResult?.xpGained || 0));\n        get().gainGold(heroId, (quest.rewards?.gold || 0) + (combatResult?.goldGained || 0));\n        if (quest.rewards?.glory) { get().gainGlory(heroId, quest.rewards.glory); }\n        if (quest.rewards?.arcaneEssence) { get().gainArcaneEssence(heroId, quest.rewards.arcaneEssence); }\n        \n        // Adicionar itens das recompensas\n        if (quest.rewards?.items) {\n          quest.rewards.items.forEach(item => {\n            // Suporta tanto formato objeto { id, qty } quanto string 'itemId'\n            if (typeof (item as any) === 'string') {\n              const id = item as unknown as string;\n              if (id === 'reward-egg-basico') {\n                const egg = generateMysteryEgg('comum' as any);\n                const heroAfter = get().heroes.find(h => h.id === heroId)!;\n                get().updateHero(heroId, { eggs: [...(heroAfter.eggs || []), egg] });\n                try { notificationBus.emit({ type: 'item', title: 'Ovo Obtido', message: 'Voc recebeu um Ovo Comum da Guilda.', duration: 3500, icon: '' }); } catch {}\n                return;\n              }\n              get().addItemToInventory(heroId, id, 1);\n              try {\n                const s = get().heroes.find(h => h.id === heroId)!.stats;\n                if (id === 'essencia-bestial') {\n                  get().updateHero(heroId, { stats: { ...s, beastEssenceCollected: (s.beastEssenceCollected || 0) + 1 } });\n                } else if (id === 'pergaminho-montaria') {\n                  get().updateHero(heroId, { stats: { ...s, mountScrollsFound: (s.mountScrollsFound || 0) + 1 } });\n                }\n              } catch {}\n            } else {\n              const it = item as { id: string; qty?: number };\n              if (it.id === 'reward-egg-basico') {\n                const qty = it.qty ?? 1;\n                for (let i = 0; i < qty; i++) {\n                  const egg = generateMysteryEgg('comum' as any);\n                  const heroAfter = get().heroes.find(h => h.id === heroId)!;\n                  get().updateHero(heroId, { eggs: [...(heroAfter.eggs || []), egg] });\n                }\n                try { notificationBus.emit({ type: 'item', title: 'Ovo Obtido', message: 'Voc recebeu um Ovo Comum da Guilda.', duration: 3500, icon: '' }); } catch {}\n                return;\n              }\n              get().addItemToInventory(heroId, it.id, it.qty ?? 1);\n              try {\n                const s = get().heroes.find(h => h.id === heroId)!.stats;\n                if (it.id === 'essencia-bestial') {\n                  get().updateHero(heroId, { stats: { ...s, beastEssenceCollected: (s.beastEssenceCollected || 0) + (it.qty ?? 1) } });\n                } else if (it.id === 'pergaminho-montaria') {\n                  get().updateHero(heroId, { stats: { ...s, mountScrollsFound: (s.mountScrollsFound || 0) + (it.qty ?? 1) } });\n                }\n              } catch {}\n            }\n          });\n        }\n        \n        // Adicionar itens do combate\n        if (combatResult?.itemsGained) {\n          combatResult.itemsGained.forEach(item => {\n            get().addItemToInventory(heroId, item.id, 1);\n          });\n        }\n\n        if (combatResult?.petEnergyUsed && combatResult.petEnergyUsed > 0) {\n          const h = get().heroes.find(x => x.id === heroId);\n          if (h && h.activePetId) {\n            const pets = h.pets || [];\n            const idx = pets.findIndex(p => p.id === h.activePetId);\n            if (idx >= 0) {\n              const p = pets[idx];\n              const next = { ...p, energy: Math.max(0, (p.energy || 0) - combatResult.petEnergyUsed!) };\n              const nextPets = [...pets];\n              nextPets[idx] = next;\n              get().updateHero(heroId, { pets: nextPets });\n            }\n          }\n        }\n\n        // Chance de obter um ovo misterioso ao completar misses de caa/explorao\n        if (quest.type === 'caca' || quest.type === 'exploracao') {\n          const eggChance = quest.difficulty === 'epica' ? 0.2 : quest.difficulty === 'dificil' ? 0.12 : 0.08;\n          if (Math.random() < eggChance) {\n            const egg = generateMysteryEgg();\n            const heroAfter = get().heroes.find(h => h.id === heroId)!;\n            get().updateHero(heroId, { eggs: [...(heroAfter.eggs || []), egg] });\n            console.log(' Ovo misterioso obtido como recompensa de misso!');\n          }\n        }\n\n        // Chance de dropar um Ovo\n        try {\n          const dropBase = quest.type === 'caca' ? 0.1 : quest.type === 'exploracao' ? 0.06 : quest.type === 'historia' ? 0.03 : 0.04;\n          const diffBonus = quest.difficulty === 'epica' ? 0.05 : quest.difficulty === 'dificil' ? 0.03 : quest.difficulty === 'medio' ? 0.01 : 0;\n          const chance = Math.max(0, Math.min(0.25, dropBase + diffBonus));\n          if (Math.random() < chance) {\n            const rarityRoll = Math.random();\n            const rarity = rarityRoll > 0.98 ? 'lendario' : rarityRoll > 0.9 ? 'epico' : rarityRoll > 0.6 ? 'raro' : rarityRoll > 0.35 ? 'incomum' : 'comum';\n            if ((hero.eggs || []).length < 30) {\n              const egg = generateMysteryEgg(rarity as any);\n              const eggs = [...(hero.eggs || []), egg];\n              get().updateHero(heroId, { eggs });\n              try { notificationBus.emit({ type: 'item', title: 'Ovo Encontrado', message: `${egg.name}`, duration: 3000, icon: '' }); } catch {}\n            } else {\n              try { notificationBus.emit({ type: 'item', title: 'Inventrio de Ovos Cheio', message: 'Voc no tem espao para novos ovos.', duration: 4000 }); } catch {}\n            }\n          }\n        } catch {}\n\n        if (quest.isGuildQuest) {\n          const repByDifficulty: Record<string, number> = { 'facil': 5, 'medio': 8, 'dificil': 12, 'epica': 20 };\n          const change = repByDifficulty[quest.difficulty] ?? 6;\n          state.updateReputation('Guarda da Cidade', change);\n          try {\n            const curStats = hero.stats || ({} as any);\n            const compDone = (curStats.companionQuestsCompleted || 0) + 1;\n            get().updateHero(heroId, { stats: { ...hero.stats, companionQuestsCompleted: compDone } });\n          } catch {}\n        } else {\n          const inferred = inferQuestFactionChanges(quest);\n          inferred.forEach(({ factionName, change }) => state.updateReputation(factionName, change));\n        }\n        \n        // Atualizar estatsticas e remover misso ativa (com limpeza de missionRunState)\n        const updatedHero = get().heroes.find(h => h.id === heroId)!;\n        const ms = { ...(updatedHero.stats as any) };\n        if (ms.missionRunState) {\n          try { delete ms.missionRunState[String(questId)]; } catch {}\n        }\n        get().updateHero(heroId, {\n          activeQuests: updatedHero.activeQuests.filter(id => id !== questId),\n          completedQuests: [...updatedHero.completedQuests, questId],\n          stats: {\n            ...updatedHero.stats,\n            questsCompleted: updatedHero.stats.questsCompleted + 1,\n            totalCombats: updatedHero.stats.totalCombats + (quest.enemies?.length || 0),\n            lastActiveAt: new Date().toISOString(),\n            missionRunState: ms.missionRunState\n          }\n        });\n\n        try { updateProgressDelta({ missionsCompleted: 1 }); } catch {}\n        try { logActivity({ type: 'mission_completed', heroId, questId }).catch(() => {}); } catch {}\n\n        set((state) => ({\n          availableQuests: state.availableQuests.filter(q => q.id !== questId)\n        }));\n        \n        // Verificar achievements\n        get().checkAchievements(heroId);\n        \n        // Atualizar dados de rank aps completar misso\n        const finalHero = get().heroes.find(h => h.id === heroId);\n        if (finalHero) {\n          // Verificao de migrao para rankData\n          if (!finalHero.rankData) {\n            const initializedRankData = rankSystem.initializeRankData(finalHero);\n            get().updateHero(heroId, { rankData: initializedRankData });\n            finalHero.rankData = initializedRankData;\n          }\n          const newRankData = rankSystem.updateRankData(finalHero, finalHero.rankData);\n          get().updateHero(heroId, { rankData: newRankData });\n          try { useProgressionStore.getState().evaluateUnlocks(finalHero, prevHeroBeforeXP); } catch {}\n        }\n        \n        // Update daily goals progress\n        get().updateDailyGoalProgress(heroId, 'quest-completed', 1);\n        if (quest.difficulty === 'pica') {\n          get().updateDailyGoalProgress(heroId, 'epic-quest-completed', 1);\n        }\n        if (quest.enemies && quest.enemies.length > 0) {\n          get().updateDailyGoalProgress(heroId, 'enemy-defeated', quest.enemies.length);\n        }\n\n        // XP para Mascotes por participao\n        try {\n          const pets = hero.pets || [];\n          if (pets.length > 0) {\n            const xp = quest.type === 'caca' ? 100 : quest.type === 'exploracao' ? 60 : 40;\n            const nextPets = pets.map(p => addPetXP(p, xp));\n            get().updateHero(heroId, { pets: nextPets });\n          }\n        } catch {}\n        \n        // Update event progress\n        eventManager.updateEventProgress(heroId, 'quests-completed', 1);\n        \n        // Log quest completion activity\n        if (quest.difficulty === 'epica') {\n          logActivity.epicQuestCompleted({\n            heroId,\n            heroName: hero.name,\n            heroClass: hero.class,\n            questName: quest.title,\n            questDifficulty: quest.difficulty,\n            questReward: quest.rewards\n          });\n        } else {\n          logActivity.questCompleted({\n            heroId,\n            heroName: hero.name,\n            heroClass: hero.class,\n            questName: quest.title,\n            questDifficulty: quest.difficulty,\n            questReward: quest.rewards\n          });\n        }\n        \n        // Track quest completion metrics\n        trackMetric.questCompleted(heroId, {\n          questName: quest.title,\n          questDifficulty: quest.difficulty,\n          questType: quest.type,\n          xpReward: quest.rewards?.xp || 0,\n          goldReward: quest.rewards?.gold || 0\n        });\n        \n        console.log(' completeQuest finalizada com sucesso!');\n        return combatResult;\n      },\n\n      abandonQuest: (heroId: string, questId: string) => {\n        try {\n          const state = get();\n          const hero = state.heroes.find(h => h.id === heroId);\n          if (!hero) return false;\n          if (!hero.activeQuests.includes(questId)) return false;\n          const nextActive = hero.activeQuests.filter(id => id !== questId);\n          get().updateHero(heroId, { activeQuests: nextActive });\n          try { notificationBus.emit({ type: 'quest', title: 'Misso abandonada', message: `${questId}`, duration: 2000, icon: '' }); } catch {}\n          return true;\n        } catch { return false; }\n      },\n\n      getQuestById: (id: string) => {\n        const q = get().questCatalog[id];\n        if (q) return q;\n        return get().availableQuests.find(q => q.id === id);\n      },\n\n      clearActiveQuests: (heroId: string) => {\n        try {\n          const state = get();\n          const hero = state.heroes.find(h => h.id === heroId);\n          if (!hero) return false;\n          if (!(hero.activeQuests || []).length) return true;\n          get().updateHero(heroId, { activeQuests: [] });\n          try { notificationBus.emit({ type: 'quest', title: 'Misses removidas', message: 'Limpeza de misses ativas concluda', duration: 2500, icon: '' }); } catch {}\n          return true;\n        } catch { return false; }\n      },\n      \n      // Fluxo de escolhas narrativas removido\n\n      // === SISTEMA DE PROGRESSO ===\n      \n      gainXP: (heroId: string, xp: number) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return;\n        // Aplicar buff global de XP da Guilda, se ativo\n        const gs = getGameSettings();\n        const buffPercent = Math.max(0, Math.min(100, gs.guildXpBuffPercent || 0));\n        const synergyPercent = computeSynergyBonus(hero) * 100;\n        const currentRank = rankSystem.calculateRank(hero);\n        const rankPercent = RANK_XP_BONUS_PERCENT[currentRank] || 0;\n        let extraPercent = 0;\n        const statsAny = (hero.stats as any) || {};\n        if ((statsAny.innBuffUsesRemaining || 0) > 0 && (statsAny.innBuffXpPercent || 0) > 0) {\n          extraPercent += Math.max(0, Number(statsAny.innBuffXpPercent || 0));\n          statsAny.innBuffUsesRemaining = Math.max(0, Number(statsAny.innBuffUsesRemaining || 1) - 1);\n          get().updateHero(heroId, { stats: { ...hero.stats, ...statsAny } });\n        }\n        const effectiveXP = Math.floor(xp * (1 + (buffPercent + synergyPercent + rankPercent + extraPercent) / 100));\n\n        const newXP = Math.max(0, hero.progression.xp + effectiveXP);\n        const newLevel = checkLevelUp(newXP, hero.progression.level);\n        const prevLevel = hero.progression.level;\n        const levelsGained = Math.max(0, newLevel - prevLevel);\n        const currentStars = hero.progression.stars || 0;\n        const thresholdTitles = [\n          { level: 2, id: 'aprendiz' },\n          { level: 5, id: 'veterano' },\n          { level: 10, id: 'campeao' }\n        ];\n        const crossed = thresholdTitles.filter(t => prevLevel < t.level && newLevel >= t.level);\n        const titleToAward = crossed.length > 0 ? crossed[crossed.length - 1].id : undefined;\n        \n        const progressionUpdated = {\n          ...hero.progression,\n          xp: newXP,\n          level: newLevel,\n          stars: currentStars + levelsGained,\n          titles: hero.progression.titles || []\n        };\n\n        let titlesUpdated = hero.titles ? [...hero.titles] : [];\n        if (titleToAward) {\n          const hasAlready = titlesUpdated.some(t => t.id === titleToAward);\n          if (!hasAlready) {\n            const base = AVAILABLE_TITLES.find(t => t.id === titleToAward);\n            const newTitle = base ? { ...base, unlockedAt: new Date() } : {\n              id: titleToAward,\n              name: titleToAward === 'aprendiz' ? 'Aprendiz' : titleToAward === 'veterano' ? 'Veterano' : 'Campeo',\n              description: 'Recompensa por subir de nvel',\n              rarity: 'comum' as const,\n              category: 'achievement' as const,\n              badge: titleToAward === 'aprendiz' ? '' : titleToAward === 'veterano' ? '' : '',\n              unlockedAt: new Date()\n            };\n            titlesUpdated = [...titlesUpdated, newTitle];\n          }\n          if (!(progressionUpdated.titles || []).includes(titleToAward)) {\n            progressionUpdated.titles = [...(progressionUpdated.titles || []), titleToAward];\n          }\n        }\n\n        const updates: Partial<Hero> = {\n          progression: progressionUpdated,\n          titles: titlesUpdated\n        };\n        \n        // Se subiu de nvel, recalcular atributos derivados\n        if (newLevel > hero.progression.level) {\n          updates.level = newLevel;\n          if (titleToAward) {\n            updates.activeTitle = titleToAward;\n          }\n          // Conceder pontos de atributo por level-up\n          updates.attributePoints = (hero.attributePoints || 0) + levelsGained * ATTRIBUTE_POINTS_PER_LEVEL;\n          updates.derivedAttributes = calculateDerivedAttributes(\n            hero.attributes,\n            hero.class,\n            newLevel,\n            hero.inventory,\n            titleToAward || hero.activeTitle,\n            computeCompanionBonus(hero)\n          );\n\n          // Desbloquear novas skills por nvel\n          const unlocked = getNewSkillsForLevel(hero.class as any, hero.progression.level, newLevel);\n          if (unlocked.length) {\n            const existing = hero.skills || [];\n            const merged = [...existing];\n            unlocked.forEach(s => { if (!merged.find(m => m.id === s.id)) merged.push(s); });\n            updates.skills = merged;\n\n            // Atualizar progresso de talentos planejados\n            const planned = hero.plannedTalents || [];\n            if (planned.length) {\n              const unlockedIds = unlocked.map(s => s.id);\n              const nowUnlockedPlanned = planned.filter(id => merged.find(m => m.id === id)).length;\n              updates.stats = {\n                ...hero.stats,\n                talentsUnlockedPlanned: nowUnlockedPlanned\n              };\n            }\n          }\n\n          // Gerar Captulos da Jornada a cada 4 nveis (4, 8, 12, 16, 20)\n          const milestones = [4, 8, 12, 16, 20];\n          const crossedMilestones = milestones.filter(m => prevLevel < m && newLevel >= m);\n          if (crossedMilestones.length > 0) {\n            const now = new Date().toISOString();\n            const existing = hero.journeyChapters || [];\n            let chaptersToAdd = [] as any[];\n            crossedMilestones.forEach(m => {\n              const already = existing.some(c => c.levelMilestone === m);\n              if (!already) {\n                const index = (existing.length + chaptersToAdd.length) + 1;\n                const relatedQuestTitles = (hero.completedQuests || [])\n                  .map(qId => get().availableQuests.find(q => q.id === qId)?.title)\n                  .filter(Boolean) as string[];\n                const summary = `No marco de nvel ${m}, ${hero.name} consolidou sua jornada como ${hero.class}. Conquistas recentes incluem: ${(relatedQuestTitles.slice(-3).join('; ') || 'misses iniciais da guilda')}. Combates: ${hero.stats.totalCombats || 0}, inimigos derrotados: ${hero.stats.enemiesDefeated || 0}, itens obtidos: ${hero.stats.itemsFound || 0}.`;\n                chaptersToAdd.push({\n                  id: `chapter-${hero.id}-${m}`,\n                  index,\n                  title: `Captulo ${index}: Marco de Nvel ${m}`,\n                  summary,\n                  createdAt: now,\n                  levelMilestone: m,\n                  locked: true,\n                  relatedQuests: hero.completedQuests || []\n                });\n\n                // Misses narrativas associadas ao captulo removidas\n              }\n            });\n            if (chaptersToAdd.length > 0) {\n              updates.journeyChapters = [...existing, ...chaptersToAdd];\n              // Passe de temporada: adicionar captulo exclusivo\n              try {\n                const m = getMonetization();\n                if (m.seasonPassActive?.active) {\n                  const nowSeason = new Date().toISOString();\n                  const bonus = {\n                    id: `season-${hero.id}-${newLevel}`,\n                    index: (updates.journeyChapters.length || 0) + 1,\n                    title: 'Crnica da Temporada',\n                    summary: 'Um arco narrativo exclusivo da temporada foi revelado.',\n                    createdAt: nowSeason,\n                    levelMilestone: newLevel,\n                    locked: false,\n                    relatedQuests: hero.completedQuests || []\n                  } as any;\n                  updates.journeyChapters = [...updates.journeyChapters, bonus];\n                }\n              } catch {}\n              // Exibir anncio intersticial se permitido pela monetizao\n              try {\n                const m = getMonetization();\n                if (m.adsEnabled && !m.adsRemoved && m.interstitialOnChapterMilestones) {\n                  m.triggerInterstitial('chapter');\n                }\n              } catch {}\n            }\n          }\n        }\n        \n        get().updateHero(heroId, updates);\n        \n        // Atualizar dados de rank aps ganhar XP\n        const updatedHero = get().heroes.find(h => h.id === heroId);\n        if (updatedHero) {\n          // Verificao de migrao para rankData\n          if (!updatedHero.rankData) {\n            const initializedRankData = rankSystem.initializeRankData(updatedHero);\n            get().updateHero(heroId, { rankData: initializedRankData });\n            updatedHero.rankData = initializedRankData;\n          }\n          const prevRankData = updatedHero.rankData;\n          const prevRank = prevRankData.currentRank;\n          const prevUnlockedNames = new Set((prevRankData.unlockedRewards || []).map(r => r.name));\n          const newRankData = rankSystem.updateRankData(updatedHero, prevRankData);\n          get().updateHero(heroId, { rankData: newRankData });\n\n          // Aplicar recompensas materiais na promoo\n          if (newRankData.currentRank !== prevRank) {\n            const newlyUnlocked = (newRankData.unlockedRewards || []).filter(r => !prevUnlockedNames.has(r.name));\n            let inv = updatedHero.inventory || { items: {} } as any;\n            let stats = updatedHero.stats || {} as any;\n\n            const grantItem = (id: string, name: string, slot?: string, rarity: string = 'comum', description?: string, icon?: string) => {\n              const item = { id, name, description: description || name, type: 'cosmetic', rarity, icon: icon || '', slot } as any;\n              inv.customItems = { ...(inv.customItems || {}), [id]: item };\n              inv.items = { ...(inv.items || {}), [id]: Math.max(0, (inv.items?.[id] || 0)) + 1 };\n              if (slot === 'cape') inv.equippedCape = inv.equippedCape || id;\n              if (slot === 'chest') inv.equippedChest = inv.equippedChest || id;\n              if (slot === 'helm') inv.equippedHelm = inv.equippedHelm || id;\n            };\n\n            newlyUnlocked.forEach(r => {\n              const n = r.name.toLowerCase();\n              if (n === 'capa verde') grantItem('capa-verde', 'Capa Verde', 'cape', 'comum', 'Capa do rank E', '');\n              if (n === 'armadura roxa') grantItem('armadura-roxa', 'Armadura Roxa', 'chest', 'raro', 'Armadura do rank C', '');\n              if (n === 'capa de campeo') grantItem('capa-campeao', 'Capa de Campeo', 'cape', 'raro', 'Capa do rank A', '');\n              if (n === 'traje cone imortal' || n === 'traje icone imortal') grantItem('traje-icone-imortal', 'Traje cone Imortal', 'chest', 'pico', 'Traje do rank SS', '');\n              if (n === 'coroa do mito absoluto') grantItem('coroa-mito-absoluto', 'Coroa do Mito Absoluto', 'helm', 'lendrio', 'Coroa do rank SSS', '');\n\n              if (n.includes('xp bonus')) {\n                const rankPercent = RANK_XP_BONUS_PERCENT[newRankData.currentRank] || 0;\n                stats.rankXpBonusPercent = rankPercent;\n              }\n              if (n.includes('gold bonus')) {\n                const goldPercent = Number(n.match(/\\+?(\\d+)%/)?.[1] || 10);\n                stats.rankGoldBonusPercent = Math.max(Number(stats.rankGoldBonusPercent || 0), goldPercent);\n              }\n              if (n === 'ttulo de guardio' || n === 'titulo de guardiao') {\n                const titles = updatedHero.progression.titles || [];\n                const id = 'guardiao';\n                if (!titles.includes(id)) {\n                  get().updateHero(heroId, { progression: { ...updatedHero.progression, titles: [...titles, id] } });\n                }\n              }\n              if (n === 'efeito lendrio') {\n                const auras = Array.isArray(stats.rankVisualAuras) ? stats.rankVisualAuras : [];\n                stats.rankVisualAuras = Array.from(new Set([...auras, 'legendary']));\n              }\n              if (n === 'aura dourada') {\n                const auras = Array.isArray(stats.rankVisualAuras) ? stats.rankVisualAuras : [];\n                stats.rankVisualAuras = Array.from(new Set([...auras, 'gold']));\n              }\n              if (n === 'aura mtica') {\n                const auras = Array.isArray(stats.rankVisualAuras) ? stats.rankVisualAuras : [];\n                stats.rankVisualAuras = Array.from(new Set([...auras, 'mythic']));\n              }\n              if (n === 'misses especiais' || n === 'missoes especiais') {\n                stats.rankAccessSpecialMissions = true;\n              }\n              if (n === 'acesso total') {\n                stats.rankAccessTotal = true;\n              }\n              if (n === 'convite para misses mticas' || n === 'convite para missoes miticas') {\n                stats.rankAccessMythicMissions = true;\n              }\n              if (n === 'histria pica ia' || n === 'historia epica ia' || n === 'lenda personalizada') {\n                stats.rankLegendUnlocked = true;\n              }\n            });\n            get().updateHero(heroId, { inventory: inv, stats });\n            try { notificationBus.emit({ type: 'achievement', title: 'Recompensas de Rank aplicadas', message: `Itens e bnus liberados para rank ${newRankData.currentRank}`, duration: 3000, icon: '' }); } catch {}\n          }\n          try { useProgressionStore.getState().evaluateUnlocks(updatedHero, hero); } catch {}\n        }\n        \n        // Update daily goals progress\n        get().updateDailyGoalProgress(heroId, 'xp-gained', effectiveXP);\n        if (newLevel > hero.progression.level) {\n          get().updateDailyGoalProgress(heroId, 'level-up', 1);\n        }\n        \n        // Update event progress\n        eventManager.updateEventProgress(heroId, 'xp-gained', effectiveXP);\n        if (newLevel > hero.progression.level) {\n          eventManager.updateEventProgress(heroId, 'levels-gained', newLevel - hero.progression.level);\n          \n          // Log level up activity\n          logActivity.levelUp({\n            heroId,\n            heroName: hero.name,\n            heroClass: hero.class,\n            heroLevel: newLevel,\n            previousLevel: hero.progression.level\n          });\n          \n          // Track level up metrics\n          trackMetric.levelUp(heroId, {\n            newLevel,\n            previousLevel: hero.progression.level,\n            heroClass: hero.class\n          });\n        }\n        \n      // Track XP gained metrics\n      trackMetric.xpGained(heroId, effectiveXP);\n      },\n      \n      gainGold: (heroId: string, gold: number) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return;\n        const bonusPercent = Number((hero.stats as any)?.rankGoldBonusPercent || 0);\n        const effectiveGold = Math.floor(gold * (1 + bonusPercent / 100));\n        get().updateHero(heroId, {\n          progression: {\n            ...hero.progression,\n            gold: Math.max(0, hero.progression.gold + effectiveGold)\n          }\n        });\n        \n        // Atualizar dados de rank aps mudanas no heri\n        const updatedHero = get().heroes.find(h => h.id === heroId);\n        if (updatedHero) {\n          // Verificao de migrao para rankData\n          if (!updatedHero.rankData) {\n            const initializedRankData = rankSystem.initializeRankData(updatedHero);\n            get().updateHero(heroId, { rankData: initializedRankData });\n            updatedHero.rankData = initializedRankData;\n          }\n          const newRankData = rankSystem.updateRankData(updatedHero, updatedHero.rankData);\n          get().updateHero(heroId, { rankData: newRankData });\n        }\n        \n        // Update daily goals progress\n        if (effectiveGold > 0) {\n          get().updateDailyGoalProgress(heroId, 'gold-earned', effectiveGold);\n        }\n        \n        // Update event progress\n        if (effectiveGold > 0) {\n          eventManager.updateEventProgress(heroId, 'gold-earned', effectiveGold);\n        }\n        \n        // Track gold gained metrics\n        if (effectiveGold > 0) {\n          trackMetric.goldGained(heroId, effectiveGold);\n        }\n      },\n      \n      gainGlory: (heroId: string, glory: number) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return;\n        \n        get().updateHero(heroId, {\n          progression: {\n            ...hero.progression,\n            glory: Math.max(0, (hero.progression.glory || 0) + glory)\n          }\n        });\n        \n        if (glory > 0) {\n          try { eventManager.updateEventProgress(heroId, 'glory-earned', glory); } catch {}\n        }\n      },\n      \n      gainArcaneEssence: (heroId: string, essence: number) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return;\n        \n        get().updateHero(heroId, {\n          progression: {\n            ...hero.progression,\n            arcaneEssence: Math.max(0, (hero.progression.arcaneEssence || 0) + essence)\n          }\n        });\n        \n        if (essence > 0) {\n          try { eventManager.updateEventProgress(heroId, 'arcane-essence-earned', essence); } catch {}\n        }\n      },\n      \n      addItemToInventory: (heroId: string, itemId: string, quantity = 1) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return;\n        \n        const currentQuantity = hero.inventory.items[itemId] || 0;\n        \n        get().updateHero(heroId, {\n          inventory: {\n            ...hero.inventory,\n            items: {\n              ...hero.inventory.items,\n              [itemId]: currentQuantity + quantity\n            }\n          }\n        });\n\n        try {\n          if (itemId === 'pergaminho-montaria') {\n            const s = hero.stats || ({} as any);\n            const next = (s.mountScrollsFound || 0) + quantity;\n            get().updateHero(heroId, { stats: { ...hero.stats, mountScrollsFound: next } });\n            notificationBus.emit({ type: 'item', title: 'Pergaminho de Montaria', message: `Voc obteve  x${quantity}.`, duration: 3500, icon: '' });\n          }\n          if (itemId === 'essencia-bestial') {\n            const s = hero.stats || ({} as any);\n            const next = (s.beastEssenceCollected || 0) + quantity;\n            get().updateHero(heroId, { stats: { ...hero.stats, beastEssenceCollected: next } });\n            notificationBus.emit({ type: 'item', title: 'Essncia Bestial', message: `Voc obteve  x${quantity}.`, duration: 3500, icon: '' });\n          }\n        } catch {}\n      },\n      \n      checkAchievements: (heroId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return [];\n        \n        const newAchievements: Achievement[] = [];\n        \n        QUEST_ACHIEVEMENTS.forEach(template => {\n          const hasAchievement = hero.progression.achievements.some(a => a.id === template.id);\n          if (hasAchievement) return;\n          \n          let progress = 0;\n          \n          switch (template.id) {\n            case 'primeira-missao':\n              progress = hero.stats.questsCompleted >= 1 ? 1 : 0;\n              break;\n            case 'heroi-da-vila':\n              progress = hero.stats.questsCompleted;\n              break;\n            case 'cacador-experiente':\n              // Contar misses de caa completadas (simplificado)\n              progress = Math.min(template.maxProgress!, Math.floor(hero.stats.questsCompleted * 0.4));\n              break;\n            case 'explorador-corajoso':\n              progress = Math.min(template.maxProgress!, Math.floor(hero.stats.questsCompleted * 0.3));\n              break;\n            case 'lenda-epica':\n              progress = Math.min(template.maxProgress!, Math.floor(hero.stats.questsCompleted * 0.1));\n              break;\n            case 'amigo-dos-animais':\n              progress = Math.min(template.maxProgress!, (hero.stats.companionQuestsCompleted || 0));\n              break;\n            case 'domador-de-feras':\n              progress = Math.min(template.maxProgress!, (hero.stats.beastEssenceCollected || 0));\n              break;\n            case 'cavaleiro-mitico':\n              progress = Math.min(template.maxProgress!, (hero.stats.mountScrollsFound || 0));\n              break;\n          }\n          \n          if (progress >= template.maxProgress!) {\n            const achievement: Achievement = {\n              ...template,\n              unlockedAt: new Date().toISOString(),\n              progress: template.maxProgress\n            };\n            newAchievements.push(achievement);\n          }\n        });\n        \n        if (newAchievements.length > 0) {\n          get().updateHero(heroId, {\n            progression: {\n              ...hero.progression,\n              achievements: [...hero.progression.achievements, ...newAchievements]\n            }\n          });\n          try { updateProgressDelta({ achievementsUnlocked: newAchievements.length }); } catch {}\n          try { logActivity({ type: 'achievement_unlocked', heroId, count: newAchievements.length }).catch(() => {}); } catch {}\n        }\n        \n        return newAchievements;\n      },\n      \n      // === SISTEMA DE LOJA ===\n      \n      buyItem: (heroId: string, itemId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        \n        const result = purchaseItem(hero, itemId);\n        if (result.success && result.item) {\n          // Atualizar saldo conforme moeda\n          if (result.currency && result.newBalance !== undefined) {\n            const updatedProgression = { ...hero.progression };\n            if (result.currency === 'gold') updatedProgression.gold = result.newBalance;\n            if (result.currency === 'glory') updatedProgression.glory = result.newBalance;\n            if (result.currency === 'arcaneEssence') updatedProgression.arcaneEssence = result.newBalance;\n            get().updateHero(heroId, { progression: updatedProgression });\n          } else if (result.newGold !== undefined) {\n            get().updateHero(heroId, {\n              progression: {\n                ...hero.progression,\n                gold: result.newGold!\n              }\n            });\n          }\n          get().addItemToInventory(heroId, itemId, 1);\n        }\n        \n        return result.success;\n      },\n      \n      sellItem: (heroId: string, itemId: string, quantity = 1) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        \n        const result = sellItem(hero, itemId, quantity);\n        if (result.success) {\n          get().updateHero(heroId, {\n            progression: {\n              ...hero.progression,\n              gold: result.newGold!\n            }\n          });\n          \n          const currentQuantity = hero.inventory.items[itemId] || 0;\n          get().updateHero(heroId, {\n            inventory: {\n              ...hero.inventory,\n              items: {\n                ...hero.inventory.items,\n                [itemId]: Math.max(0, currentQuantity - quantity)\n              }\n            }\n          });\n        }\n        \n        return result.success;\n      },\n      \n      equipItem: (heroId: string, itemId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        \n        const result = equipItem(hero, itemId);\n        if (result.success) {\n          const item = SHOP_ITEMS.find(i => i.id === itemId);\n          if (!item) return false;\n          \n          const updatedInventory = { ...hero.inventory } as HeroInventory;\n          if (item.type === 'weapon') {\n            const prefer = item.slot === 'offHand' ? 'offHand' : 'mainHand';\n            if (prefer === 'mainHand') {\n              if (!updatedInventory.equippedMainHand) updatedInventory.equippedMainHand = itemId;\n              else if (!updatedInventory.equippedOffHand) updatedInventory.equippedOffHand = itemId;\n              else return false;\n            } else {\n              if (!updatedInventory.equippedOffHand) updatedInventory.equippedOffHand = itemId;\n              else if (!updatedInventory.equippedMainHand) updatedInventory.equippedMainHand = itemId;\n              else return false;\n            }\n            updatedInventory.equippedWeapon = undefined;\n            updatedInventory.equippedWeapons = [];\n          } else if (item.type === 'armor') {\n            const s = item.slot;\n            if (!s) {\n              if (!updatedInventory.equippedChest) updatedInventory.equippedChest = itemId; else return false;\n            } else if (s === 'helm') { if (!updatedInventory.equippedHelm) updatedInventory.equippedHelm = itemId; else return false; }\n            else if (s === 'chest') { if (!updatedInventory.equippedChest) updatedInventory.equippedChest = itemId; else return false; }\n            else if (s === 'belt') { if (!updatedInventory.equippedBelt) updatedInventory.equippedBelt = itemId; else return false; }\n            else if (s === 'gloves') { if (!updatedInventory.equippedGloves) updatedInventory.equippedGloves = itemId; else return false; }\n            else if (s === 'boots') { if (!updatedInventory.equippedBoots) updatedInventory.equippedBoots = itemId; else return false; }\n            else if (s === 'cape') { if (!updatedInventory.equippedCape) updatedInventory.equippedCape = itemId; else return false; }\n            updatedInventory.equippedArmor = undefined;\n            updatedInventory.equippedArmorSlots = [];\n          } else if (item.type === 'accessory') {\n            const s = item.slot;\n            if (!s) {\n              if (!updatedInventory.equippedRingLeft) updatedInventory.equippedRingLeft = itemId;\n              else if (!updatedInventory.equippedRingRight) updatedInventory.equippedRingRight = itemId;\n              else if (!updatedInventory.equippedNecklace) updatedInventory.equippedNecklace = itemId;\n              else if (!updatedInventory.equippedEarringLeft) updatedInventory.equippedEarringLeft = itemId;\n              else if (!updatedInventory.equippedEarringRight) updatedInventory.equippedEarringRight = itemId;\n              else return false;\n            } else if (s === 'necklace') { if (!updatedInventory.equippedNecklace) updatedInventory.equippedNecklace = itemId; else return false; }\n            else if (s === 'ring') {\n              if (!updatedInventory.equippedRingLeft) updatedInventory.equippedRingLeft = itemId;\n              else if (!updatedInventory.equippedRingRight) updatedInventory.equippedRingRight = itemId;\n              else return false;\n            } else if (s === 'earring') {\n              if (!updatedInventory.equippedEarringLeft) updatedInventory.equippedEarringLeft = itemId;\n              else if (!updatedInventory.equippedEarringRight) updatedInventory.equippedEarringRight = itemId;\n              else return false;\n            }\n            updatedInventory.equippedAccessory = undefined;\n            updatedInventory.equippedAccessories = [];\n          }\n          \n          // Atualizar inventrio e forar reclculo dos atributos derivados\n          const derived = calculateDerivedAttributes(\n            hero.attributes,\n            hero.class,\n            hero.progression.level,\n            updatedInventory,\n            hero.activeTitle,\n            computeCompanionBonus(hero)\n          );\n          get().updateHero(heroId, { inventory: updatedInventory, derivedAttributes: derived });\n          try {\n            supabase.auth.getUser().then(({ data }: any) => {\n              const userId = data?.user?.id;\n              if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n            });\n          } catch {}\n          try {\n            const snapshot = {\n              weapons: (updatedInventory.equippedWeapons || []),\n              armor: (updatedInventory.equippedArmorSlots || []),\n              accessories: (updatedInventory.equippedAccessories || []),\n              updatedAt: new Date().toISOString()\n            };\n            localStorage.setItem(`hfn:equipmentBackup:${hero.id}`, JSON.stringify(snapshot));\n          } catch {}\n        }\n        \n        return result.success;\n      },\n\n      upgradeItem: (heroId: string, itemId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const item = SHOP_ITEMS.find(i => i.id === itemId);\n        if (!item) return false;\n        // Apenas equipamentos podem ser aprimorados\n        if (!(item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory')) return false;\n\n        const currentLevel = hero.inventory.upgrades?.[itemId] ?? 0;\n        const rarityFactor: Record<'comum' | 'raro' | 'epico' | 'lendario', number> = {\n          comum: 0.25,\n          raro: 0.4,\n          epico: 0.6,\n          lendario: 0.8\n        };\n        const baseCost = Math.ceil(item.price * rarityFactor[item.rarity] * (currentLevel + 1));\n        const rank = hero.rankData?.currentRank ?? 'F';\n        const rankDiscount: Record<'F' | 'E' | 'D' | 'C' | 'B' | 'A' | 'S', number> = {\n          F: 0,\n          E: 0.03,\n          D: 0.05,\n          C: 0.07,\n          B: 0.1,\n          A: 0.12,\n          S: 0.15\n        };\n        const finalCost = Math.max(1, Math.ceil(baseCost * (1 - rankDiscount[rank])));\n\n        // Verificar ouro\n        if ((hero.progression.gold || 0) < finalCost) return false;\n\n        // Atualizar ouro e nvel de upgrade\n        const updatedInventory = { ...hero.inventory, upgrades: { ...(hero.inventory.upgrades || {}) } };\n        updatedInventory.upgrades![itemId] = currentLevel + 1;\n\n        const derived = calculateDerivedAttributes(\n          hero.attributes,\n          hero.class,\n          hero.progression.level,\n          updatedInventory,\n          hero.activeTitle,\n          computeCompanionBonus(hero)\n        );\n\n        get().updateHero(heroId, {\n          progression: { ...hero.progression, gold: Math.max(0, (hero.progression.gold || 0) - finalCost) },\n          inventory: updatedInventory,\n          derivedAttributes: derived\n        });\n\n        return true;\n      },\n\n      craftItem: (heroId: string, recipeId: string) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const recipe = RECIPES.find(r => r.id === recipeId);\n        if (!recipe) return false;\n        const rankOrder = ['F','E','D','C','B','A','S'] as const;\n        const heroRank = (hero.rankData?.currentRank || 'F') as typeof rankOrder[number];\n        const heroRankIdx = rankOrder.indexOf(heroRank);\n        const reqIdx = rankOrder.indexOf((recipe.rankRequired || 'F') as any);\n        if (heroRankIdx < reqIdx) return false;\n        for (const inp of recipe.inputs) {\n          if ((hero.inventory.items[inp.id] || 0) < inp.qty) return false;\n        }\n        const newItems = { ...hero.inventory.items };\n        recipe.inputs.forEach(inp => {\n          newItems[inp.id] = Math.max(0, (newItems[inp.id] || 0) - inp.qty);\n        });\n        newItems[recipe.output.id] = (newItems[recipe.output.id] || 0) + recipe.output.qty;\n        get().updateHero(heroId, { inventory: { ...hero.inventory, items: newItems } });\n        return true;\n      },\n\n      // === FORJA: Refino de raridade do item equipado ===\n      refineEquippedItem: (heroId: string, slot: 'weapon' | 'armor' | 'accessory') => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const inv = hero.inventory;\n        const equippedId = (() => {\n          if (slot === 'weapon') return inv.equippedMainHand || inv.equippedOffHand || inv.equippedWeapon || (inv.equippedWeapons || [])[0];\n          if (slot === 'armor') return inv.equippedChest || inv.equippedArmor || (inv.equippedArmorSlots || [])[0];\n          return inv.equippedNecklace || inv.equippedRingLeft || inv.equippedRingRight || inv.equippedAccessory || (inv.equippedAccessories || [])[0];\n        })();\n        if (!equippedId) return false;\n\n        const baseItem = SHOP_ITEMS.find(i => i.id === equippedId) || (inv.customItems ? inv.customItems[equippedId] : undefined);\n        if (!baseItem) return false;\n\n        const currentRarity = inv.refined?.[equippedId] || baseItem.rarity;\n        const order: ('comum'|'incomum'|'raro'|'epico'|'lendario')[] = ['comum','incomum','raro','epico','lendario'];\n        const idx = order.indexOf(currentRarity);\n        if (idx < 0 || idx === order.length - 1) return false; // j lendrio\n        const next = order[idx + 1];\n\n        const costTable: Record<string, { gold: number; essence: number; chance: number }> = {\n          'comum->incomum': { gold: 100, essence: 10, chance: 0.7 },\n          'incomum->raro': { gold: 200, essence: 20, chance: 0.5 },\n          'raro->epico': { gold: 400, essence: 40, chance: 0.3 },\n          'epico->lendario': { gold: 1000, essence: 100, chance: 0.1 }\n        };\n        const key = `${currentRarity}->${next}`;\n        const cfg = costTable[key];\n        if (!cfg) return false;\n\n        const gold = hero.progression.gold || 0;\n        const essence = hero.progression.arcaneEssence || 0;\n        if (gold < cfg.gold || essence < cfg.essence) return false;\n\n        // Consumir custo\n        hero.progression.gold = gold - cfg.gold;\n        hero.progression.arcaneEssence = essence - cfg.essence;\n\n        // Chance de sucesso; falha no remove/baixa raridade\n        const success = Math.random() <= cfg.chance;\n        if (success) {\n          const refined = { ...(inv.refined || {}) };\n          refined[equippedId] = next;\n          hero.inventory.refined = refined;\n        }\n\n        // Atualizar store\n        set({ heroes: state.heroes.map(h => h.id === heroId ? { ...hero, updatedAt: new Date().toISOString() } : h) });\n        return success;\n      },\n\n      // === FORJA: Fuso de dois itens em um novo procedural ===\n      fuseItems: (heroId: string, itemAId: string, itemBId: string) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const inv = hero.inventory;\n        const qtyA = inv.items[itemAId] || 0;\n        const qtyB = inv.items[itemBId] || 0;\n        if (qtyA < 1 || qtyB < 1) return false;\n\n        const itemA = SHOP_ITEMS.find(i => i.id === itemAId);\n        const itemB = SHOP_ITEMS.find(i => i.id === itemBId);\n        if (!itemA || !itemB) return false;\n        if (itemA.type !== itemB.type) return false;\n\n        // Consumir itens\n        inv.items[itemAId] = qtyA - 1;\n        inv.items[itemBId] = qtyB - 1;\n        if (inv.items[itemAId] <= 0) delete inv.items[itemAId];\n        if (inv.items[itemBId] <= 0) delete inv.items[itemBId];\n\n        const seed = (itemAId + itemBId).split('').reduce((s, ch) => s + ch.charCodeAt(0), 0);\n        const luck = hero.derivedAttributes.luck || 0;\n        const p = generateProceduralItem(seed, luck);\n\n        const iconMap: Record<string, string> = { espada: '', arco: '', cajado: '', machado: '' };\n        const newItemId = p.id;\n        const mapped: import('../types/hero').Item = {\n          id: newItemId,\n          name: p.name,\n          description: 'Item forjado por fuso, nico ao heri.',\n          type: itemA.type,\n          rarity: p.rarity,\n          level: hero.progression.level,\n          price: 100,\n          icon: iconMap[p.baseType] || '',\n          bonus: p.bonus\n        };\n\n        const customItems = { ...(inv.customItems || {}) };\n        customItems[newItemId] = mapped;\n        hero.inventory.customItems = customItems;\n        hero.inventory.items[newItemId] = (hero.inventory.items[newItemId] || 0) + 1;\n\n        set({ heroes: state.heroes.map(h => h.id === heroId ? { ...hero, updatedAt: new Date().toISOString() } : h) });\n        return true;\n      },\n\n      addJewel: (heroId: string, tipo: JewelType, nivel: number, qty: number = 1) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const key = `jewel:${tipo}:${Math.max(1, Math.min(10, nivel))}`;\n        const inv = hero.inventory;\n        const nextJewels = { ...(inv.jewels || {}) } as Record<string, number>;\n        nextJewels[key] = (nextJewels[key] || 0) + Math.max(1, qty);\n        hero.inventory.jewels = nextJewels;\n        set({ heroes: state.heroes.map(h => h.id === heroId ? { ...hero, updatedAt: new Date().toISOString() } : h) });\n        return true;\n      },\n\n      socketJewel: (heroId: string, itemId: string, jewelKey: string) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const inv = hero.inventory;\n        const qty = inv.jewels?.[jewelKey] || 0;\n        if (qty <= 0) return false;\n        const baseItem = SHOP_ITEMS.find(i => i.id === itemId) || (inv.customItems ? inv.customItems[itemId] : undefined);\n        if (!baseItem) return false;\n        const maxSlots = baseItem.type === 'weapon' ? 2 : baseItem.type === 'armor' ? 3 : baseItem.type === 'accessory' ? 1 : 0;\n        if (maxSlots <= 0) return false;\n        const parts = jewelKey.split(':');\n        if (parts.length !== 3) return false;\n        const tipo = parts[1] as JewelType;\n        const nivel = Number(parts[2]);\n        const reqLevel = Jewel.minHeroLevelToEquip(nivel);\n        const heroLevel = hero.progression.level || hero.level || 1;\n        if (heroLevel < reqLevel) return false;\n        const current = { ...(inv.equippedJewelsByItemId || {}) } as Record<string, string[]>;\n        const list = [...(current[itemId] || [])];\n        if (list.length >= maxSlots) return false;\n        list.push(jewelKey);\n        current[itemId] = list;\n        const nextJewels = { ...(inv.jewels || {}) } as Record<string, number>;\n        nextJewels[jewelKey] = Math.max(0, (nextJewels[jewelKey] || 0) - 1);\n        hero.inventory.equippedJewelsByItemId = current;\n        hero.inventory.jewels = nextJewels;\n        const derived = calculateDerivedAttributes(\n          hero.attributes,\n          hero.class,\n          hero.progression.level,\n          hero.inventory,\n          hero.activeTitle,\n          computeCompanionBonus(hero)\n        );\n        set({ heroes: state.heroes.map(h => h.id === heroId ? { ...hero, derivedAttributes: derived, updatedAt: new Date().toISOString() } : h) });\n        try {\n          const snapshot = {\n            jewels: hero.inventory.jewels,\n            equippedJewels: hero.inventory.equippedJewelsByItemId,\n            updatedAt: new Date().toISOString()\n          };\n          localStorage.setItem(`hfn:jewelState:${hero.id}`, JSON.stringify(snapshot));\n        } catch {}\n        try {\n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      removeJewel: (heroId: string, itemId: string, socketIndex: number) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const inv = hero.inventory;\n        const current = { ...(inv.equippedJewelsByItemId || {}) } as Record<string, string[]>;\n        const list = [...(current[itemId] || [])];\n        if (socketIndex < 0 || socketIndex >= list.length) return false;\n        const jewelKey = list[socketIndex];\n        list.splice(socketIndex, 1);\n        current[itemId] = list;\n        const nextJewels = { ...(inv.jewels || {}) } as Record<string, number>;\n        nextJewels[jewelKey] = (nextJewels[jewelKey] || 0) + 1;\n        hero.inventory.equippedJewelsByItemId = current;\n        hero.inventory.jewels = nextJewels;\n        const derived = calculateDerivedAttributes(\n          hero.attributes,\n          hero.class,\n          hero.progression.level,\n          hero.inventory,\n          hero.activeTitle,\n          computeCompanionBonus(hero)\n        );\n        set({ heroes: state.heroes.map(h => h.id === heroId ? { ...hero, derivedAttributes: derived, updatedAt: new Date().toISOString() } : h) });\n        try {\n          const snapshot = {\n            jewels: hero.inventory.jewels,\n            equippedJewels: hero.inventory.equippedJewelsByItemId,\n            updatedAt: new Date().toISOString()\n          };\n          localStorage.setItem(`hfn:jewelState:${hero.id}`, JSON.stringify(snapshot));\n        } catch {}\n        try {\n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      fuseJewels: (heroId: string, jewelKey: string) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const inv = hero.inventory;\n        const qty = inv.jewels?.[jewelKey] || 0;\n        if (qty < 2) return false;\n        const parts = jewelKey.split(':');\n        if (parts.length !== 3) return false;\n        const tipo = parts[1] as JewelType;\n        const nivel = Number(parts[2]);\n        if (nivel >= 10) return false;\n        const a = new Jewel(crypto.randomUUID(), tipo, nivel);\n        const b = new Jewel(crypto.randomUUID(), tipo, nivel);\n        const fused = Jewel.fuse(a, b);\n        if (!fused) return false;\n        const nextKey = `jewel:${tipo}:${nivel + 1}`;\n        const nextJewels = { ...(inv.jewels || {}) } as Record<string, number>;\n        nextJewels[jewelKey] = Math.max(0, qty - 2);\n        nextJewels[nextKey] = (nextJewels[nextKey] || 0) + 1;\n        hero.inventory.jewels = nextJewels;\n        set({ heroes: state.heroes.map(h => h.id === heroId ? { ...hero, updatedAt: new Date().toISOString() } : h) });\n        try {\n          const log = { ts: new Date().toISOString(), from: jewelKey, to: nextKey };\n          const snapshot = {\n            jewels: hero.inventory.jewels,\n            lastFusion: log,\n            updatedAt: new Date().toISOString()\n          };\n          localStorage.setItem(`hfn:jewelState:${hero.id}`, JSON.stringify(snapshot));\n        } catch {}\n        try {\n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        return true;\n      },\n\n      // === FORJA: Encantamento aplicado ao item equipado ===\n      enchantEquippedItem: (heroId: string, slot: 'weapon' | 'armor' | 'accessory', enchant: 'lifesteal') => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const inv = hero.inventory;\n        const equippedId = (() => {\n          if (slot === 'weapon') return inv.equippedMainHand || inv.equippedOffHand || inv.equippedWeapon || (inv.equippedWeapons || [])[0];\n          if (slot === 'armor') return inv.equippedChest || inv.equippedArmor || (inv.equippedArmorSlots || [])[0];\n          return inv.equippedNecklace || inv.equippedRingLeft || inv.equippedRingRight || inv.equippedAccessory || (inv.equippedAccessories || [])[0];\n        })();\n        if (!equippedId) return false;\n\n        const costEssence = 50;\n        const essence = hero.progression.arcaneEssence || 0;\n        if (essence < costEssence) return false;\n        hero.progression.arcaneEssence = essence - costEssence;\n\n        const ench = { ...(inv.enchantments || {}) };\n        ench[equippedId] = { special: enchant };\n        hero.inventory.enchantments = ench;\n\n        set({ heroes: state.heroes.map(h => h.id === heroId ? { ...hero, updatedAt: new Date().toISOString() } : h) });\n        return true;\n      },\n\n      unequipItem: (heroId: string, itemId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const item = SHOP_ITEMS.find(i => i.id === itemId);\n        if (!item) return false;\n\n        const updatedInventory = { ...hero.inventory } as HeroInventory;\n        let changed = false;\n        if (item.type === 'weapon') {\n          if (updatedInventory.equippedMainHand === itemId) { updatedInventory.equippedMainHand = undefined; changed = true; }\n          if (updatedInventory.equippedOffHand === itemId) { updatedInventory.equippedOffHand = undefined; changed = true; }\n          updatedInventory.equippedWeapon = undefined;\n          updatedInventory.equippedWeapons = [];\n        } else if (item.type === 'armor') {\n          if (updatedInventory.equippedHelm === itemId) { updatedInventory.equippedHelm = undefined; changed = true; }\n          if (updatedInventory.equippedChest === itemId) { updatedInventory.equippedChest = undefined; changed = true; }\n          if (updatedInventory.equippedBelt === itemId) { updatedInventory.equippedBelt = undefined; changed = true; }\n          if (updatedInventory.equippedGloves === itemId) { updatedInventory.equippedGloves = undefined; changed = true; }\n          if (updatedInventory.equippedBoots === itemId) { updatedInventory.equippedBoots = undefined; changed = true; }\n          if (updatedInventory.equippedCape === itemId) { updatedInventory.equippedCape = undefined; changed = true; }\n          updatedInventory.equippedArmor = undefined;\n          updatedInventory.equippedArmorSlots = [];\n        } else if (item.type === 'accessory') {\n          if (updatedInventory.equippedRingLeft === itemId) { updatedInventory.equippedRingLeft = undefined; changed = true; }\n          if (updatedInventory.equippedRingRight === itemId) { updatedInventory.equippedRingRight = undefined; changed = true; }\n          if (updatedInventory.equippedNecklace === itemId) { updatedInventory.equippedNecklace = undefined; changed = true; }\n          if (updatedInventory.equippedEarringLeft === itemId) { updatedInventory.equippedEarringLeft = undefined; changed = true; }\n          if (updatedInventory.equippedEarringRight === itemId) { updatedInventory.equippedEarringRight = undefined; changed = true; }\n          updatedInventory.equippedAccessory = undefined;\n          updatedInventory.equippedAccessories = [];\n        } else {\n          return false;\n        }\n\n        if (!changed) return false;\n        const derived = calculateDerivedAttributes(\n          hero.attributes,\n          hero.class,\n          hero.progression.level,\n          updatedInventory,\n          hero.activeTitle,\n          computeCompanionBonus(hero)\n        );\n        get().updateHero(heroId, { inventory: updatedInventory, derivedAttributes: derived });\n        try {\n          supabase.auth.getUser().then(({ data }: any) => {\n            const userId = data?.user?.id;\n            if (userId) saveHero(userId, useHeroStore.getState().heroes.find(h => h.id === hero.id));\n          });\n        } catch {}\n        try {\n          const snapshot = {\n            weapons: (updatedInventory.equippedWeapons || []),\n            armor: (updatedInventory.equippedArmorSlots || []),\n            accessories: (updatedInventory.equippedAccessories || []),\n            updatedAt: new Date().toISOString()\n          };\n          localStorage.setItem(`hfn:equipmentBackup:${hero.id}`, JSON.stringify(snapshot));\n        } catch {}\n        return true;\n      },\n      \n      useItem: (heroId: string, itemId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        \n        // Capturar estados antes para deltas\n        const beforeHp = hero.derivedAttributes.currentHp ?? hero.derivedAttributes.hp;\n        const beforeMp = hero.derivedAttributes.currentMp ?? hero.derivedAttributes.mp;\n        const beforeFatigue = hero.progression.fatigue ?? 0;\n\n        if (itemId === 'contrato-montaria') {\n          const ok = get().generateMountForSelected();\n          if (!ok) return false;\n          // Remover o item do inventrio\n          const currentQuantity = hero.inventory.items[itemId] || 0;\n          get().updateHero(heroId, {\n            inventory: {\n              ...hero.inventory,\n              items: {\n                ...hero.inventory.items,\n                [itemId]: Math.max(0, currentQuantity - 1)\n              }\n            }\n          });\n          return true;\n        }\n\n        if (itemId === 'kit-montaria') {\n          const items = hero.inventory.items || {} as Record<string, number>;\n          const nextItems = { ...items };\n          nextItems['contrato-montaria'] = (nextItems['contrato-montaria'] || 0) + 1;\n          nextItems['pergaminho-montaria'] = (nextItems['pergaminho-montaria'] || 0) + 1;\n          nextItems['essencia-bestial'] = (nextItems['essencia-bestial'] || 0) + 1;\n          nextItems['pedra-magica'] = (nextItems['pedra-magica'] || 0) + 1;\n          const currentQuantity = hero.inventory.items[itemId] || 0;\n          get().updateHero(heroId, { inventory: { ...hero.inventory, items: { ...nextItems, [itemId]: Math.max(0, currentQuantity - 1) } } });\n          try { notificationBus.emit({ type: 'item', title: 'Kit de Montaria', message: 'Itens adicionados: , ,  e Contrato.', duration: 3500, icon: '' }); } catch {}\n          return true;\n        }\n\n        const result = useConsumable(hero, itemId);\n        if (result.success) {\n          // Remover item do inventrio\n          const currentQuantity = hero.inventory.items[itemId] || 0;\n          get().updateHero(heroId, {\n            inventory: {\n              ...hero.inventory,\n              items: {\n                ...hero.inventory.items,\n                [itemId]: Math.max(0, currentQuantity - 1)\n              }\n            }\n          });\n          \n          // Aplicar efeitos\n          if (result.effects) {\n            const updates: any = {};\n            \n            if (result.effects.hp !== undefined) {\n              updates.derivedAttributes = {\n                ...hero.derivedAttributes,\n                currentHp: result.effects.hp\n              };\n            }\n            \n            if (result.effects.mp !== undefined) {\n              updates.derivedAttributes = {\n                ...updates.derivedAttributes || hero.derivedAttributes,\n                currentMp: result.effects.mp\n              };\n            }\n            \n            if (result.effects.fatigue !== undefined) {\n              updates.progression = {\n                ...hero.progression,\n                fatigue: result.effects.fatigue\n              };\n            }\n            \n            if (result.effects.xp !== undefined) {\n              get().gainXP(heroId, result.effects.xp);\n            }\n            \n            if (Object.keys(updates).length > 0) {\n              get().updateHero(heroId, updates);\n            }\n            \n            // Log de atividade de uso de item\n            try {\n              const itemInfo = SHOP_ITEMS.find(i => i.id === itemId);\n              const afterHero = get().heroes.find(h => h.id === heroId)!;\n              const afterHp = afterHero.derivedAttributes.currentHp ?? afterHero.derivedAttributes.hp;\n              const afterMp = afterHero.derivedAttributes.currentMp ?? afterHero.derivedAttributes.mp;\n              const afterFatigue = afterHero.progression.fatigue ?? 0;\n\n              const hpRecovered = Math.max(0, (afterHp ?? 0) - (beforeHp ?? 0));\n              const mpRecovered = Math.max(0, (afterMp ?? 0) - (beforeMp ?? 0));\n              const fatigueRecovered = Math.max(0, (beforeFatigue ?? 0) - (afterFatigue ?? 0));\n\n              logActivity.itemUsed({\n                heroId: hero.id,\n                heroName: hero.name,\n                heroClass: hero.class,\n                heroLevel: hero.progression.level,\n                itemId: itemId,\n                itemName: itemInfo?.name,\n                itemType: itemInfo?.type,\n                hpRecovered,\n                mpRecovered,\n                fatigueRecovered,\n                xpGained: result.effects.xp ?? 0\n              });\n            } catch {}\n          }\n        }\n        \n        return result.success;\n      },\n\n      // === TAVERNA: DESCANSO PAGO ===\n      restAtTavern: (heroId: string, costGold: number, fatigueRecovery: number, restType?: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        const currentGold = hero.progression.gold ?? 0;\n        const currentFatigue = hero.progression.fatigue ?? 0;\n        if (currentGold < costGold) return false;\n        if (currentFatigue <= 0) return false;\n        const recovered = Math.min(fatigueRecovery, currentFatigue);\n        const updatedProgression = {\n          ...hero.progression,\n          gold: currentGold - costGold,\n          fatigue: currentFatigue - recovered\n        };\n        get().updateHero(heroId, { progression: updatedProgression });\n\n        try {\n          logActivity.tavernRest({\n            heroId: hero.id,\n            heroName: hero.name,\n            heroClass: hero.class,\n            heroLevel: hero.progression.level,\n            restType: restType,\n            goldSpent: costGold,\n            fatigueBefore: currentFatigue,\n            fatigueRecovered: recovered,\n            fatigueAfter: updatedProgression.fatigue\n          });\n        } catch {}\n        return true;\n      },\n      \n      // === SISTEMA DE GUILDAS ===\n      \n      createGuild: (heroId: string, guildName: string, description: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero || hero.progression.guildId) return null;\n        \n        const newGuild: Guild = {\n          id: uuidv4(),\n          name: guildName,\n          description,\n          members: [heroId],\n          guildXP: 0,\n          bankGold: 0,\n          createdAt: new Date().toISOString(),\n          quests: [],\n          level: 1,\n          roles: { [heroId]: 'lider' },\n          councilMembers: [],\n          policies: {},\n          pendingAlliances: []\n        };\n        \n        set(state => ({\n          guilds: [...state.guilds, newGuild]\n        }));\n        \n        get().updateHero(heroId, {\n          progression: {\n            ...hero.progression,\n            guildId: newGuild.id\n          }\n        });\n        \n        return newGuild;\n      },\n      \n      joinGuild: (heroId: string, guildId: string) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        const guild = state.guilds.find(g => g.id === guildId);\n        \n        if (!hero || !guild || hero.progression.guildId) return false;\n        \n        set(state => ({\n          guilds: state.guilds.map(g => {\n            if (g.id !== guildId) return g;\n            const isRankS = (hero.rankData?.currentRank === 'S');\n            const councilMembers = g.councilMembers || [];\n            const nextCouncil = isRankS && !councilMembers.includes(heroId)\n              ? [...councilMembers, heroId]\n              : councilMembers;\n            return {\n              ...g,\n              members: [...g.members, heroId],\n              roles: { ...(g.roles || {}), [heroId]: 'membro' },\n              councilMembers: nextCouncil\n            };\n          })\n        }));\n        \n        get().updateHero(heroId, {\n          progression: {\n            ...hero.progression,\n            guildId: guildId\n          }\n        });\n        \n        return true;\n      },\n      \n      leaveGuild: (heroId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero || !hero.progression.guildId) return false;\n        \n        set(state => ({\n          guilds: state.guilds.map(g => \n            g.id === hero.progression.guildId\n              ? { \n                  ...g, \n                  members: g.members.filter(id => id !== heroId),\n                  roles: (() => {\n                    const roles = { ...(g.roles || {}) } as Record<string, 'lider'|'oficial'|'membro'>;\n                    delete roles[heroId];\n                    // Se o lder saiu, promover primeiro oficial ou primeiro membro\n                    if (Object.values(roles).includes('lider') === false && g.members.length > 0) {\n                      const candidate = g.members.find(id => id !== heroId);\n                      if (candidate) roles[candidate] = 'lider';\n                    }\n                    return roles;\n                  })()\n                }\n              : g\n          )\n        }));\n        \n        get().updateHero(heroId, {\n          progression: {\n            ...hero.progression,\n            guildId: undefined\n          }\n        });\n        \n        return true;\n      },\n\n      depositGoldToGuild: (heroId: string, amount: number) => {\n        if (amount <= 0) return false;\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero || !hero.progression.guildId) return false;\n        if (hero.progression.gold < amount) return false;\n        const guildId = hero.progression.guildId;\n        set(state => ({\n          guilds: state.guilds.map(g => g.id === guildId ? { ...g, bankGold: g.bankGold + amount } : g)\n        }));\n        get().updateHero(heroId, {\n          progression: { ...hero.progression, gold: hero.progression.gold - amount }\n        });\n        return true;\n      },\n\n      withdrawGoldFromGuild: (heroId: string, amount: number) => {\n        if (amount <= 0) return false;\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero || !hero.progression.guildId) return false;\n        const guild = state.guilds.find(g => g.id === hero.progression.guildId);\n        if (!guild) return false;\n        const role = guild.roles?.[heroId] || 'membro';\n        if (role === 'membro') return false; // Apenas lder/oficial podem sacar\n        if (guild.bankGold < amount) return false;\n        set(state => ({\n          guilds: state.guilds.map(g => g.id === guild.id ? { ...g, bankGold: g.bankGold - amount } : g)\n        }));\n        get().updateHero(heroId, {\n          progression: { ...hero.progression, gold: hero.progression.gold + amount }\n        });\n        return true;\n      },\n\n      contributeXPToGuild: (heroId: string, amount: number) => {\n        if (amount <= 0) return false;\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero || !hero.progression.guildId) return false;\n        const guildId = hero.progression.guildId;\n        const calcLevel = (xp: number) => Math.max(1, Math.floor(xp / 250) + 1);\n        let newLevel = 0;\n        set(state => ({\n          guilds: state.guilds.map(g => {\n            if (g.id !== guildId) return g;\n            const newXP = g.guildXP + amount;\n            newLevel = calcLevel(newXP);\n            return { ...g, guildXP: newXP, level: newLevel };\n          })\n        }));\n        // Pequeno bnus de reputao de guilda como efeito colateral (se existir no futuro)\n        return true;\n      },\n\n      setGuildRole: (guildId, actorId, targetId, role) => {\n        const state = get();\n        const guild = state.guilds.find(g => g.id === guildId);\n        if (!guild) return false;\n        const actorRole = guild.roles?.[actorId] || 'membro';\n        if (actorRole !== 'lider') return false; // s lder pode alterar papis\n        set(state => ({\n          guilds: state.guilds.map(g => g.id === guildId ? { ...g, roles: { ...(g.roles || {}), [targetId]: role } } : g)\n        }));\n        return true;\n      },\n\n      transferGuildLeadership: (guildId, actorId, newLeaderId) => {\n        const state = get();\n        const guild = state.guilds.find(g => g.id === guildId);\n        if (!guild) return false;\n        const actorRole = guild.roles?.[actorId] || 'membro';\n        if (actorRole !== 'lider') return false;\n        if (!guild.members.includes(newLeaderId)) return false;\n        set(state => ({\n          guilds: state.guilds.map(g => {\n            if (g.id !== guildId) return g;\n            const newRoles = { ...(g.roles || {}) } as Record<string, 'lider'|'oficial'|'membro'>;\n            // Demote current leader, promote new leader\n            Object.entries(newRoles).forEach(([hid, r]) => {\n              if (r === 'lider') newRoles[hid] = 'oficial';\n            });\n            newRoles[newLeaderId] = 'lider';\n            return { ...g, roles: newRoles };\n          })\n        }));\n        return true;\n      },\n\n      ensureDefaultGuildExists: () => {\n        const state = get();\n        if (state.guilds.some(g => g.name === 'Foja dos Herois')) return;\n        const defaultGuild: Guild = {\n          id: uuidv4(),\n          name: 'Foja dos Herois',\n          description: 'A casa acolhedora de todos os heris iniciantes. Cooperativa, social e focada em aprender e evoluir juntos.',\n          members: [],\n          guildXP: 0,\n          bankGold: 0,\n          createdAt: new Date().toISOString(),\n          quests: [],\n          level: 1,\n          roles: {},\n          councilMembers: [],\n          policies: {},\n          pendingAlliances: []\n        };\n        set(state => ({ guilds: [...state.guilds, defaultGuild] }));\n      },\n\n      // === Conselho da Guilda e Polticas ===\n      activateGuildEvent: (guildId: string, actorId: string, params: { xpBuffPercent?: number; trainingDiscountPercent?: number; eventName?: string; durationHours?: number; costGold?: number }) => {\n        const state = get();\n        const guild = state.guilds.find(g => g.id === guildId);\n        const actor = state.heroes.find(h => h.id === actorId);\n        if (!guild || !actor) return false;\n        const isCouncil = (guild.councilMembers || []).includes(actorId) || (guild.roles?.[actorId] === 'lider');\n        const isRankS = actor.rankData?.currentRank === 'S';\n        if (!isCouncil || !isRankS) return false;\n\n        const durationMs = (params.durationHours ?? 24) * 60 * 60 * 1000;\n        const expiresAt = new Date(Date.now() + durationMs).toISOString();\n        const eventName = params.eventName || 'Evento da Guilda';\n        // Limites de balanceamento: XP at 30%, Treino at 25%\n        const xpBuffPercent = Math.max(0, Math.min(30, params.xpBuffPercent ?? 0));\n        const trainingDiscountPercent = Math.max(0, Math.min(25, params.trainingDiscountPercent ?? 0));\n        const baseCost = params.costGold ?? 100;\n        const totalCost = baseCost + xpBuffPercent * 10 + trainingDiscountPercent * 5; // custo simples\n        if (guild.bankGold < totalCost) return false;\n\n        // Cooldown: impedir ativao se evento recente em menos de 12h\n        const lastActivatedIso = guild.policies?.lastEventActivatedAt;\n        const nowMs = Date.now();\n        const cooldownMs = 12 * 60 * 60 * 1000; // 12 horas\n        if (lastActivatedIso) {\n          const lastMs = new Date(lastActivatedIso).getTime();\n          if (nowMs - lastMs < cooldownMs) return false;\n        }\n\n        // Deduzir do cofre\n        set(state => ({\n          guilds: state.guilds.map(g => g.id === guildId ? {\n            ...g,\n            bankGold: g.bankGold - totalCost,\n            policies: {\n              ...(g.policies || {}),\n              xpBuffPercent,\n              trainingDiscountPercent,\n              activeEventName: eventName,\n              eventExpiresAt: expiresAt,\n              lastEventActivatedAt: new Date().toISOString()\n            }\n          } : g)\n        }));\n\n        // Aplicar buffs globais\n        getGameSettings();\n        useGameSettingsStore.getState().applyGuildBuffs({\n          xpBuffPercent,\n          trainingDiscountPercent,\n          eventName,\n          expiresAt,\n          sourceGuildId: guildId,\n        });\n\n        // Auditoria: registrar evento de guilda\n        logActivity.guildEventActivated({\n          heroId: actor.id,\n          heroName: actor.name,\n          heroClass: actor.class,\n          heroLevel: actor.level,\n          guildName: guild.name,\n          eventName,\n          xpBuffPercent,\n          trainingDiscountPercent,\n          eventExpiresAt: expiresAt,\n          costGold: totalCost\n        });\n\n        return true;\n      },\n\n      clearGuildEvent: (guildId: string, actorId: string) => {\n        const state = get();\n        const guild = state.guilds.find(g => g.id === guildId);\n        const actor = state.heroes.find(h => h.id === actorId);\n        if (!guild || !actor) return false;\n        const isCouncil = (guild.councilMembers || []).includes(actorId) || (guild.roles?.[actorId] === 'lider');\n        if (!isCouncil) return false;\n        set(state => ({\n          guilds: state.guilds.map(g => g.id === guildId ? {\n            ...g,\n            policies: { ...(g.policies || {}), xpBuffPercent: 0, trainingDiscountPercent: 0, activeEventName: undefined, eventExpiresAt: undefined }\n          } : g)\n        }));\n        useGameSettingsStore.getState().clearGuildBuffs();\n        return true;\n      },\n\n\n      approvePartyAlliance: (guildId: string, actorId: string, requestId: string) => {\n        const state = get();\n        const guild = state.guilds.find(g => g.id === guildId);\n        const actor = state.heroes.find(h => h.id === actorId);\n        if (!guild || !actor) return false;\n        const isCouncil = (guild.councilMembers || []).includes(actorId) || (guild.roles?.[actorId] === 'lider');\n        if (!isCouncil) return false;\n        set(state => ({\n          guilds: state.guilds.map(g => {\n            if (g.id !== guildId) return g;\n            const nextPending = (g.pendingAlliances || []).map(r => r.id === requestId ? { ...r, status: 'approved', decidedAt: new Date().toISOString(), decidedBy: actorId } : r);\n            return { ...g, pendingAlliances: nextPending };\n          })\n        }));\n        return true;\n      },\n\n      rejectPartyAlliance: (guildId: string, actorId: string, requestId: string) => {\n        const state = get();\n        const guild = state.guilds.find(g => g.id === guildId);\n        const actor = state.heroes.find(h => h.id === actorId);\n        if (!guild || !actor) return false;\n        const isCouncil = (guild.councilMembers || []).includes(actorId) || (guild.roles?.[actorId] === 'lider');\n        if (!isCouncil) return false;\n        set(state => ({\n          guilds: state.guilds.map(g => {\n            if (g.id !== guildId) return g;\n            const nextPending = (g.pendingAlliances || []).map(r => r.id === requestId ? { ...r, status: 'rejected', decidedAt: new Date().toISOString(), decidedBy: actorId } : r);\n            return { ...g, pendingAlliances: nextPending };\n          })\n        }));\n        return true;\n      },\n\n       \n       // === SISTEMA DE TTULOS E REPUTAO ===\n       \n       setActiveTitle: (titleId?: string) => {\n         const hero = get().getSelectedHero();\n         if (!hero) return;\n \n         // Verificar se o ttulo existe nos ttulos do heri\n         if (titleId && !hero.titles.find(t => t.id === titleId)) {\n           console.warn('Ttulo no encontrado nos ttulos do heri');\n           return;\n         }\n \n         get().updateHero(hero.id, {\n           activeTitle: titleId\n         });\n       },\n\n       addTitleToSelectedHero: (title: Title, setActive: boolean = false) => {\n         const hero = get().getSelectedHero();\n         if (!hero) return;\n\n         // Evitar duplicados pelo id\n         const has = hero.titles.some(t => t.id === title.id);\n         const updatedTitles = has ? hero.titles : [...hero.titles, title];\n\n         const updates: Partial<Hero> = { titles: updatedTitles } as any;\n         if (setActive) {\n           (updates as any).activeTitle = title.id;\n         }\n\n       get().updateHero(hero.id, updates);\n\n        // Registrar atividade de ttulo conquistado (se for novo)\n        if (!has) {\n          logActivity.titleEarned({\n            heroId: hero.id,\n            heroName: hero.name,\n            heroClass: hero.class,\n            heroLevel: hero.progression.level,\n            titleEarned: title.name\n          });\n        }\n      },\n\n      toggleFavoriteTitle: (titleId: string, favored?: boolean) => {\n        const hero = get().getSelectedHero();\n        if (!hero) return;\n        const updated = hero.titles.map(t => t.id === titleId ? { ...t, favorite: favored ?? !t.favorite } : t);\n        get().updateHero(hero.id, { titles: updated } as any);\n      },\n \n       updateAchievementProgress: () => {\n         const hero = get().getSelectedHero();\n         if (!hero) return;\n\n         // Atualiza progresso dos achievements de ttulos com base nas estatsticas atuais\n         const prevAchievements = hero.achievements || [];\n         const updatedAchievements = updateTitleAchievementProgress(hero);\n\n         // Coletar novos desbloqueios para recompensas de ttulo\n         const newlyUnlocked = updatedAchievements.filter(a => {\n           const prev = prevAchievements.find(p => p.id === a.id);\n           return a.unlocked && (!prev || !prev.unlocked);\n         });\n\n         let updatedTitles = [...hero.titles];\n        newlyUnlocked.forEach(a => {\n          const rewardTitleId = a.rewards?.title;\n          if (!rewardTitleId) return;\n          const tpl = AVAILABLE_TITLES.find(t => t.id === rewardTitleId);\n          if (!tpl) return;\n          const already = updatedTitles.some(t => t.id === rewardTitleId);\n          if (!already) {\n            updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             logActivity.titleEarned({\n               heroId: hero.id,\n               heroName: hero.name,\n               heroClass: hero.class,\n               heroLevel: hero.progression.level,\n               titleEarned: tpl.name\n             });\n          }\n        });\n\n        const rewardTotals = newlyUnlocked.reduce((acc, a) => {\n          acc.xp += Number(a.rewards?.xp || 0);\n          acc.gold += Number(a.rewards?.gold || 0);\n          return acc;\n        }, { xp: 0, gold: 0 });\n\n         // Desbloqueios adicionais com base em classe/nvel/estatsticas\n         const lvl = hero.progression.level;\n         switch (hero.class) {\n           case 'guerreiro':\n             if (lvl >= 5 && !updatedTitles.some(t => t.id === 'campeao-de-ferro')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'campeao-de-ferro');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             if (lvl >= 10 && !updatedTitles.some(t => t.id === 'portador-da-lamina-sagrada')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'portador-da-lamina-sagrada');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             break;\n           case 'mago':\n             if (lvl >= 5 && !updatedTitles.some(t => t.id === 'teurgo-do-veu')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'teurgo-do-veu');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             if (lvl >= 10 && !updatedTitles.some(t => t.id === 'guardiao-dos-arcanos')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'guardiao-dos-arcanos');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             break;\n           case 'arqueiro':\n             if (lvl >= 5 && !updatedTitles.some(t => t.id === 'olho-de-falcao')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'olho-de-falcao');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             if (lvl >= 10 && !updatedTitles.some(t => t.id === 'cacador-das-sombras')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'cacador-das-sombras');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             break;\n           case 'clerigo':\n             if (lvl >= 5 && !updatedTitles.some(t => t.id === 'mao-da-luz')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'mao-da-luz');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             if (lvl >= 10 && !updatedTitles.some(t => t.id === 'protetor-das-almas')) {\n               const tpl = AVAILABLE_TITLES.find(t => t.id === 'protetor-das-almas');\n               if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n             }\n             break;\n           default:\n             break;\n         }\n\n         // Estatsticas gerais: itens encontrados, combates, explorao\n         if (hero.stats.itemsFound >= 50 && !updatedTitles.some(t => t.id === 'domador-da-fortuna')) {\n           const tpl = AVAILABLE_TITLES.find(t => t.id === 'domador-da-fortuna');\n           if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n         }\n         if (hero.stats.totalCombats >= 50 && !updatedTitles.some(t => t.id === 'sombra-invicta')) {\n           const tpl = AVAILABLE_TITLES.find(t => t.id === 'sombra-invicta');\n           if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n         }\n         if (hero.stats.questsCompleted >= 25 && !updatedTitles.some(t => t.id === 'explorador-do-desconhecido')) {\n           const tpl = AVAILABLE_TITLES.find(t => t.id === 'explorador-do-desconhecido');\n           if (tpl) updatedTitles.push({ ...tpl, unlockedAt: new Date() });\n         }\n\n        const progression = {\n          ...hero.progression,\n          xp: (hero.progression.xp || 0) + rewardTotals.xp,\n          gold: (hero.progression.gold || 0) + rewardTotals.gold\n        } as any;\n        get().updateHero(hero.id, {\n          achievements: updatedAchievements,\n          titles: updatedTitles,\n          progression\n        });\n       },\n\n       updateReputation: (factionName: string, change: number) => {\n         const hero = get().getSelectedHero();\n         if (!hero) return;\n\n         const updated = updateHeroReputation(hero, factionName, change);\n         // Usar o estado mais recente do heri ao mesclar progresso para evitar sobrescrever ouro/XP\n         const latest = get().heroes.find(h => h.id === hero.id) || hero;\n         get().updateHero(hero.id, {\n           reputationFactions: updated.reputationFactions,\n           progression: {\n             ...latest.progression,\n             reputation: (latest.progression?.reputation || 0) + change\n           }\n         });\n       },\n\n       processReputationEvents: () => {\n         const hero = get().getSelectedHero();\n         if (!hero) return;\n\n         const events = generateReputationEvents(hero);\n         // Processar eventos de reputao\n         events.forEach(event => {\n           console.log('Evento de reputao:', event);\n         });\n\n         // Desbloqueios de ttulos baseados em reputao\n         const factions = hero.reputationFactions || [];\n         const allRevered = factions.length > 0 && factions.every(f => f.level === 'revered');\n         const anyHonored = factions.some(f => f.level === 'honored' || f.level === 'revered');\n         const allHonoredOrBetter = factions.length > 0 && factions.every(f => f.level === 'honored' || f.level === 'revered');\n\n         const toAdd: string[] = [];\n         if (anyHonored && !hero.titles.some(t => t.id === 'heroi-local')) toAdd.push('heroi-local');\n         if (allHonoredOrBetter && !hero.titles.some(t => t.id === 'guardiao-do-reino')) toAdd.push('guardiao-do-reino');\n         if (allRevered && !hero.titles.some(t => t.id === 'legend')) toAdd.push('legend');\n\n         if (toAdd.length) {\n           const newTitles = toAdd\n             .map(id => AVAILABLE_TITLES.find(t => t.id === id))\n             .filter(Boolean)\n             .map(tpl => ({ ...(tpl as any), unlockedAt: new Date() }));\n           get().updateHero(hero.id, {\n             titles: [...hero.titles, ...newTitles]\n           });\n\n            newTitles.forEach(tpl => {\n              logActivity.titleEarned({\n                heroId: hero.id,\n                heroName: hero.name,\n                heroClass: hero.class,\n                heroLevel: hero.progression.level,\n                titleEarned: (tpl as any).name\n              });\n            });\n         }\n       },\n\n      // Leaderboard functions\n      getLeaderboards: () => {\n        const heroes = get().heroes;\n        return generateAllLeaderboards(heroes);\n      },\n\n      getHeroRanking: (heroId: string) => {\n        const heroes = get().heroes;\n        const hero = heroes.find(h => h.id === heroId);\n        if (!hero) return null;\n        \n        return getHeroRanking(hero, heroes);\n      },\n\n      calculateHeroScore: (heroId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return 0;\n        \n        return calculateTotalScore(hero);\n      },\n      \n      // === GETTERS ===\n      \n      getSelectedHero: () => {\n        const { heroes, selectedHeroId } = get();\n        const selected = heroes.find(h => h.id === selectedHeroId && h.origin !== 'npc');\n        if (selected) return selected;\n        const firstPlayer = heroes.find(h => h.origin !== 'npc');\n        return firstPlayer || heroes[0];\n      },\n      \n      getHeroQuests: (heroId: string) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero) return [];\n        \n        return state.availableQuests.filter(quest => \n          hero.activeQuests.includes(quest.id)\n        );\n      },\n      \n      getHeroGuild: (heroId: string) => {\n        const state = get();\n        const hero = state.heroes.find(h => h.id === heroId);\n        if (!hero || !hero.progression.guildId) return undefined;\n        \n        return state.guilds.find(g => g.id === hero.progression.guildId);\n      },\n\n      // === SISTEMA DE METAS DIRIAS ===\n      \n      generateDailyGoalsForHero: (heroId: string) => {\n        set((state) => {\n          const heroIndex = state.heroes.findIndex(h => h.id === heroId);\n          if (heroIndex === -1) return state;\n\n          const hero = state.heroes[heroIndex];\n          const newGoals = generateDailyGoals(hero);\n\n          const updatedHeroes = [...state.heroes];\n          updatedHeroes[heroIndex] = {\n            ...hero,\n            dailyGoals: newGoals\n          };\n\n          return { ...state, heroes: updatedHeroes };\n        });\n      },\n\n      updateDailyGoalProgress: (heroId: string, goalType: string, amount = 1) => {\n        set((state) => {\n          const heroIndex = state.heroes.findIndex(h => h.id === heroId);\n          if (heroIndex === -1) return state;\n\n          const hero = state.heroes[heroIndex];\n          let goalsSource = hero.dailyGoals && hero.dailyGoals.length > 0 ? hero.dailyGoals : generateDailyGoals(hero);\n\n          const activeGoals = removeExpiredGoals(goalsSource);\n\n          // Contagem antes da atualizao para detectar novas concluses\n          const previouslyCompletedCount = activeGoals.filter(g => g.completed).length;\n\n          // Update progress\n          let updatedGoals = updateDailyGoalProgress(activeGoals, goalType, amount);\n\n          // Check perfect day goal\n          updatedGoals = checkPerfectDayGoal(updatedGoals);\n\n          // Contagem aps atualizao\n          const nowCompletedCount = updatedGoals.filter(g => g.completed).length;\n\n          // Lgica de streak: se houve nova concluso hoje e ainda no marcada hoje\n          let updatedStats = { ...hero.stats };\n          if (nowCompletedCount > previouslyCompletedCount) {\n            const today = new Date();\n            const todayStart = new Date(today);\n            todayStart.setHours(0, 0, 0, 0);\n            const lastCompletionRaw = hero.stats?.lastDailyCompletion;\n            const lastCompletion = lastCompletionRaw ? new Date(lastCompletionRaw as any) : undefined;\n            const isSameDay = lastCompletion &&\n              lastCompletion.getFullYear() === today.getFullYear() &&\n              lastCompletion.getMonth() === today.getMonth() &&\n              lastCompletion.getDate() === today.getDate();\n\n            if (!isSameDay) {\n              // Verifica se foi ontem para incrementar, caso contrrio reinicia em 1\n              const yesterday = new Date(today);\n              yesterday.setDate(yesterday.getDate() - 1);\n              const wasYesterday = lastCompletion &&\n                lastCompletion.getFullYear() === yesterday.getFullYear() &&\n                lastCompletion.getMonth() === yesterday.getMonth() &&\n                lastCompletion.getDate() === yesterday.getDate();\n\n              const currentStreak = updatedStats.dailyCompletionStreak || 0;\n              updatedStats.dailyCompletionStreak = wasYesterday ? currentStreak + 1 : 1;\n              updatedStats.lastDailyCompletion = today.toISOString();\n            }\n          }\n\n          const updatedHeroes = [...state.heroes];\n          updatedHeroes[heroIndex] = {\n            ...hero,\n            dailyGoals: updatedGoals,\n            stats: updatedStats\n          };\n\n          return { ...state, heroes: updatedHeroes };\n        });\n      },\n\n      // Alocar pontos de atributo ganhos por level-up\n      allocateAttributePoints: (heroId: string, allocations: Partial<HeroAttributes>) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n\n        const availablePoints = hero.attributePoints || 0;\n        const increments = Object.entries(allocations)\n          .filter(([_, inc]) => typeof inc === 'number' && (inc as number) > 0)\n          .map(([key, inc]) => ({ key: key as keyof HeroAttributes, inc: inc as number }));\n\n        const pointsToSpend = increments.reduce((sum, item) => sum + item.inc, 0);\n\n        if (pointsToSpend <= 0) return false;\n        if (pointsToSpend > availablePoints) return false;\n\n        const currentRank = hero.rankData?.currentRank || rankSystem.calculateRank(hero);\n        const maxAttr = getMaxAttributeForRank(currentRank);\n        const totalCap = getTotalAttributePointsCapForRank(currentRank);\n        \n        // Validar limites mximos por atributo\n        const newAttributes = { ...hero.attributes };\n        for (const { key, inc } of increments) {\n          const current = newAttributes[key];\n          const proposed = current + inc;\n          if (proposed > maxAttr) {\n            return false;\n          }\n          newAttributes[key] = proposed;\n        }\n\n        const totalAfter = Object.values(newAttributes).reduce((s, v) => s + v, 0);\n\n        // Atualizar heri: atributos, pontos restantes e derivados\n        const remainingPoints = Math.max(0, availablePoints - pointsToSpend);\n        const derived = calculateDerivedAttributes(\n          newAttributes,\n          hero.class,\n          hero.progression.level,\n          hero.inventory,\n          hero.activeTitle,\n          computeCompanionBonus(hero)\n        );\n\n        get().updateHero(heroId, {\n          attributes: newAttributes,\n          attributePoints: remainingPoints,\n          derivedAttributes: derived\n        });\n\n        // Mtrica de uso de feature\n        trackMetric.featureUsed(heroId, 'attribute-allocation');\n        // Mtrica especfica de alocao\n        const allocationsSummary = increments.reduce((acc, { key, inc }) => {\n          acc[key as string] = inc;\n          return acc;\n        }, {} as Record<string, number>);\n        trackMetric.attributePointsAllocated(heroId, {\n          totalSpent: pointsToSpend,\n          allocations: allocationsSummary\n        });\n\n        return true;\n      },\n\n      completeDailyGoal: (heroId: string, goalId: string) => {\n        set((state) => {\n          const heroIndex = state.heroes.findIndex(h => h.id === heroId);\n          if (heroIndex === -1) return state;\n\n          const hero = state.heroes[heroIndex];\n          if (!hero.dailyGoals) return state;\n\n          const goalIndex = hero.dailyGoals.findIndex(g => g.id === goalId);\n          if (goalIndex === -1) return state;\n          const goal = hero.dailyGoals[goalIndex];\n          if (!goal || !goal.completed || goal.claimed) return state;\n\n          // Give rewards\n          const rewards = getDailyGoalRewards(goal);\n          const updatedHero: Hero = {\n            ...hero,\n            progression: {\n              ...hero.progression,\n              xp: hero.progression.xp + rewards.xp,\n              gold: hero.progression.gold + rewards.gold,\n              glory: (hero.progression.glory || 0) + (rewards as any).glory || (hero.progression.glory || 0),\n              arcaneEssence: (hero.progression.arcaneEssence || 0) + (rewards as any).arcaneEssence || (hero.progression.arcaneEssence || 0)\n            },\n            dailyGoals: hero.dailyGoals.map((g, idx) => idx === goalIndex ? { ...g, claimed: true } : g)\n          } as Hero;\n\n          // Check for level up\n          const newLevel = checkLevelUp(updatedHero.progression.xp, updatedHero.progression.level);\n          if (newLevel > updatedHero.progression.level) {\n            updatedHero.level = newLevel;\n            updatedHero.progression.level = newLevel;\n            updatedHero.derivedAttributes = calculateDerivedAttributes(\n              updatedHero.attributes, \n              updatedHero.class, \n              newLevel,\n              updatedHero.inventory,\n              updatedHero.activeTitle,\n              computeCompanionBonus(updatedHero)\n            );\n          }\n\n          // Add items to inventory if any\n          if (rewards.items) {\n            rewards.items.forEach(item => {\n              const currentQuantity = updatedHero.inventory.items[item.id] || 0;\n              updatedHero.inventory.items[item.id] = currentQuantity + 1;\n            });\n          }\n\n          // Atualizar streak de concluso diria se todas metas ativas foram concludas e coletadas\n          const now = new Date();\n          const activeGoals = removeExpiredGoals(updatedHero.dailyGoals || []);\n          const allClaimed = activeGoals.length > 0 && activeGoals.every(g => g.completed && g.claimed);\n          if (allClaimed) {\n            const last = updatedHero.stats.lastDailyCompletion ? new Date(updatedHero.stats.lastDailyCompletion as any) : null;\n            const todayStr = now.toDateString();\n            const lastStr = last ? last.toDateString() : '';\n            const currentStreak = updatedHero.stats.dailyCompletionStreak || 0;\n            const newStreak = lastStr === todayStr ? currentStreak : currentStreak + 1;\n            updatedHero.stats = {\n              ...updatedHero.stats,\n              dailyCompletionStreak: newStreak,\n              lastDailyCompletion: now.toISOString()\n            };\n          }\n\n          const updatedHeroes = [...state.heroes];\n          updatedHeroes[heroIndex] = updatedHero;\n\n          return { ...state, heroes: updatedHeroes };\n        });\n      },\n\n      cleanupExpiredGoals: (heroId: string) => {\n        set((state) => {\n          const heroIndex = state.heroes.findIndex(h => h.id === heroId);\n          if (heroIndex === -1) return state;\n\n          const hero = state.heroes[heroIndex];\n          if (!hero.dailyGoals) return state;\n\n          const activeGoals = removeExpiredGoals(hero.dailyGoals);\n\n          const updatedHeroes = [...state.heroes];\n          updatedHeroes[heroIndex] = {\n            ...hero,\n            dailyGoals: activeGoals\n          };\n\n          return { ...state, heroes: updatedHeroes };\n        });\n      },\n\n      // Onboarding functions\n      shouldShowOnboarding: () => {\n        const state = get();\n        const hasShownOnboarding = localStorage.getItem('heroforge-onboarding-shown');\n        return !hasShownOnboarding && state.heroes.length === 0;\n      },\n\n      markOnboardingShown: () => {\n        localStorage.setItem('heroforge-onboarding-shown', 'true');\n      },\n\n      triggerOnboardingForNewUser: () => {\n        const state = get();\n        if (state.shouldShowOnboarding()) {\n          // Load onboarding state and start first flow if not already started\n          onboardingManager.loadState();\n          const availableFlows = onboardingManager.getAvailableFlows();\n          if (availableFlows.length > 0 && !onboardingManager.getCurrentStep()) {\n            onboardingManager.startFlow('first-steps');\n          }\n          state.markOnboardingShown();\n        }\n      },\n\n      // === SISTEMA DE RANKS v2.2 ===\n      \n      promoteHero: (heroId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return false;\n        \n        // Verificar e inicializar rankData se no existir (migrao)\n        if (!hero.rankData) {\n          const initializedRankData = rankSystem.initializeRankData(hero);\n          get().updateHero(heroId, { rankData: initializedRankData });\n          hero.rankData = initializedRankData;\n        }\n        \n        const progress = rankSystem.calculateProgress(hero);\n        if (!progress.canPromote) return false;\n        \n        const promotion = rankSystem.promoteHero(hero, hero.rankData);\n        if (promotion.promoted && promotion.newRank && promotion.celebration) {\n          // Atualizar dados de rank com a promoo\n          const newRankData = rankSystem.updateRankData(hero, hero.rankData);\n          get().updateHero(heroId, { rankData: newRankData });\n          \n          // Log da promoo\n          logActivity.rankPromotion({\n            heroId,\n            heroName: hero.name,\n            heroClass: hero.class,\n            newRank: promotion.newRank,\n            previousRank: progress.currentRank\n          });\n          \n          return true;\n        }\n        \n        return false;\n      },\n      \n      getHeroRankProgress: (heroId: string) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero) return null;\n        \n        // Verificar e inicializar rankData se no existir (migrao)\n        if (!hero.rankData) {\n          const initializedRankData = rankSystem.initializeRankData(hero);\n          get().updateHero(heroId, { rankData: initializedRankData });\n          hero.rankData = initializedRankData;\n        }\n        \n        return {\n          progress: rankSystem.calculateProgress(hero),\n          rankData: hero.rankData,\n          estimate: rankSystem.estimateTimeToNextRank(hero)\n        };\n      },\n      \n      getRankLeaderboard: () => {\n        const heroes = get().heroes;\n        return heroes\n          .map(hero => rankSystem.createComparison(hero, 0))\n          .sort((a, b) => {\n            // Ordenar por rank primeiro, depois por pontos\n            const rankOrder = ['SSS', 'SS', 'S', 'A', 'B', 'C', 'D', 'E', 'F'];\n            const aRankIndex = rankOrder.indexOf(a.rank);\n            const bRankIndex = rankOrder.indexOf(b.rank);\n            \n            if (aRankIndex !== bRankIndex) {\n              return aRankIndex - bRankIndex;\n            }\n            \n            return b.rankPoints - a.rankPoints;\n          })\n          .map((comparison, index) => ({ ...comparison, position: index + 1 }));\n      },\n      \n      markCelebrationViewed: (heroId: string, celebrationIndex: number) => {\n        const hero = get().heroes.find(h => h.id === heroId);\n        if (!hero || !hero.rankData?.pendingCelebrations?.[celebrationIndex]) return;\n        \n        const updatedCelebrations = [...(hero.rankData?.pendingCelebrations || [])];\n        updatedCelebrations.splice(celebrationIndex, 1);\n        \n        get().updateHero(heroId, {\n          rankData: {\n            ...hero.rankData,\n            pendingCelebrations: updatedCelebrations\n          }\n        });\n      },\n    }),\n    {\n      name: 'hero-forge-epic-storage',\n      partialize: (state) => ({ \n        heroes: state.heroes,\n        selectedHeroId: state.selectedHeroId,\n        availableQuests: state.availableQuests,\n        guilds: state.guilds,\n        referralInvites: state.referralInvites\n      }),\n      migrate: (persistedState: any, _version: number) => {\n        // Migrao para garantir que heris tenham as propriedades necessrias\n        if (persistedState?.heroes) {\n          persistedState.heroes = persistedState.heroes.map((hero: any) => {\n            const migratedHero = {\n              ...hero,\n              reputationFactions: hero.reputationFactions || [\n                { id: 'guarda', name: 'Guarda da Cidade', reputation: 0, level: 'neutral' },\n                { id: 'ladroes', name: 'Ladres', reputation: 0, level: 'neutral' },\n                { id: 'clero', name: 'Clero', reputation: 0, level: 'neutral' },\n                { id: 'cultistas', name: 'Cultistas', reputation: 0, level: 'neutral' },\n                { id: 'comerciantes', name: 'Comerciantes', reputation: 0, level: 'neutral' },\n                { id: 'exploradores', name: 'Exploradores', reputation: 0, level: 'neutral' }\n              ],\n              dailyGoals: hero.dailyGoals || [],\n              achievements: hero.achievements || [],\n              stats: hero.stats || {\n                questsCompleted: 0,\n                totalCombats: 0,\n                totalPlayTime: 0,\n                lastActiveAt: new Date().toISOString(),\n                enemiesDefeated: 0,\n                goldEarned: 0,\n                itemsFound: 0,\n                achievementsUnlocked: 0,\n                loginStreak: 0,\n                lastLogin: new Date(),\n                dailyCompletionStreak: 0\n              }\n            };\n            \n            // Inicializar rankData se no existir\n            if (!hero.rankData) {\n              migratedHero.rankData = rankSystem.initializeRankData(migratedHero);\n            }\n\n            // Garantir novos campos de progresso\n            migratedHero.progression = {\n              ...migratedHero.progression,\n              glory: migratedHero.progression?.glory ?? 0,\n              arcaneEssence: migratedHero.progression?.arcaneEssence ?? 0,\n              fatigue: migratedHero.progression?.fatigue ?? 0\n            };\n            \n            return migratedHero;\n          });\n        }\n        // Garantir array de convites\n        if (!persistedState?.referralInvites) {\n          persistedState.referralInvites = [];\n        }\n        return persistedState;\n      }\n    }\n  )\n);\n","// Tema Medieval Moderno - HeroForge v2.2\n// Sistema de cores, gradientes e estilos temticos\n\nexport const medievalTheme = {\n  // Paleta de cores principal\n  colors: {\n    // Tons de ouro e mbar (nobreza, conquistas)\n    gold: {\n      50: '#fffbeb',\n      100: '#fef3c7',\n      200: '#fde68a',\n      300: '#fcd34d',\n      400: '#fbbf24',\n      500: '#f59e0b',\n      600: '#d97706',\n      700: '#b45309',\n      800: '#92400e',\n      900: '#78350f'\n    },\n    \n    // Tons de bronze e cobre (veteranos, experincia)\n    bronze: {\n      50: '#fdf8f6',\n      100: '#f2e8e5',\n      200: '#eaddd7',\n      300: '#e0cfc5',\n      400: '#d2bab0',\n      500: '#bfa094',\n      600: '#a18072',\n      700: '#8b6f47',\n      800: '#734a2e',\n      900: '#5c3317'\n    },\n    \n    // Tons de prata (elite, pureza)\n    silver: {\n      50: '#f8fafc',\n      100: '#f1f5f9',\n      200: '#e2e8f0',\n      300: '#cbd5e1',\n      400: '#94a3b8',\n      500: '#64748b',\n      600: '#475569',\n      700: '#334155',\n      800: '#1e293b',\n      900: '#0f172a'\n    },\n    \n    // Tons de prpura real (mestres, magia)\n    royal: {\n      50: '#faf5ff',\n      100: '#f3e8ff',\n      200: '#e9d5ff',\n      300: '#d8b4fe',\n      400: '#c084fc',\n      500: '#a855f7',\n      600: '#9333ea',\n      700: '#7c3aed',\n      800: '#6b21a8',\n      900: '#581c87'\n    },\n    \n    // Tons de vermelho carmesim (poder, fora)\n    crimson: {\n      50: '#fef2f2',\n      100: '#fee2e2',\n      200: '#fecaca',\n      300: '#fca5a5',\n      400: '#f87171',\n      500: '#ef4444',\n      600: '#dc2626',\n      700: '#b91c1c',\n      800: '#991b1b',\n      900: '#7f1d1d'\n    },\n    \n    // Tons de esmeralda (natureza, crescimento)\n    emerald: {\n      50: '#ecfdf5',\n      100: '#d1fae5',\n      200: '#a7f3d0',\n      300: '#6ee7b7',\n      400: '#34d399',\n      500: '#10b981',\n      600: '#059669',\n      700: '#047857',\n      800: '#065f46',\n      900: '#064e3b'\n    }\n    ,\n    // Cores utilitrias esperadas pelos componentes (texto, fundo, acentos)\n    background: {\n      primary: '#0f172a', // slate-900\n      secondary: '#1e293b' // slate-800\n    },\n    text: {\n      primary: '#f8fafc', // slate-50\n      secondary: '#cbd5e1' // slate-300\n    },\n    accent: {\n      gold: '#f59e0b',    // gold-500\n      silver: '#64748b',  // silver-500\n      crimson: '#ef4444'  // crimson-500\n    }\n  },\n\n  // Gradientes temticos\n  gradients: {\n    ranks: {\n      'F': 'from-gray-400 to-gray-600',\n      'E': 'from-emerald-400 to-emerald-600',\n      'D': 'from-blue-400 to-blue-600',\n      'C': 'from-purple-400 to-purple-600',\n      'B': 'from-amber-400 to-amber-600',\n      'A': 'from-red-400 to-red-600',\n      'S': 'from-yellow-300 via-yellow-400 to-amber-500'\n    },\n    \n    backgrounds: {\n      primary: 'from-slate-900 via-slate-800 to-slate-900',\n      secondary: 'from-slate-800 via-slate-700 to-slate-800',\n      accent: 'from-gold-900/20 via-gold-800/10 to-transparent',\n      hero: 'from-royal-900/30 via-royal-800/20 to-transparent',\n      quest: 'from-emerald-900/30 via-emerald-800/20 to-transparent',\n      combat: 'from-crimson-900/30 via-crimson-800/20 to-transparent'\n    },\n    \n    buttons: {\n      primary: 'from-gold-500 via-gold-600 to-gold-700',\n      secondary: 'from-silver-500 via-silver-600 to-silver-700',\n      success: 'from-emerald-500 via-emerald-600 to-emerald-700',\n      danger: 'from-crimson-500 via-crimson-600 to-crimson-700',\n      royal: 'from-royal-500 via-royal-600 to-royal-700'\n    }\n  },\n\n  // cones temticos\n  icons: {\n    ranks: {\n      'F': '',\n      'E': '',\n      'D': '',\n      'C': '',\n      'B': '',\n      'A': '',\n      'S': ''\n    },\n    \n    classes: {\n      'Guerreiro': '',\n      'Mago': '',\n      'Arqueiro': '',\n      'Ladino': '',\n      'Paladino': '',\n      'Brbaro': '',\n      'Druida': '',\n      'Feiticeiro': '',\n      'Bardo': '',\n      'Monge': '',\n      'Assassino': '',\n      'Lanceiro': ''\n    },\n    \n    activities: {\n      'quest-completed': '',\n      'epic-quest-completed': '',\n      'level-up': '',\n      'achievement-unlocked': '',\n      'title-earned': '',\n      'event-completed': '',\n      'daily-goal-completed': '',\n      'combat-victory': '',\n      'rank-promotion': ''\n    },\n    \n    ui: {\n      close: '',\n      menu: '',\n      settings: '',\n      profile: '',\n      stats: '',\n      inventory: '',\n      guild: '',\n      leaderboard: '',\n      calendar: '',\n      notification: ''\n    }\n  },\n\n  // Efeitos visuais\n  effects: {\n    shadows: {\n      small: 'shadow-lg shadow-black/25',\n      medium: 'shadow-xl shadow-black/30',\n      large: 'shadow-2xl shadow-black/40',\n      glow: 'shadow-2xl shadow-gold-500/20',\n      royal: 'shadow-2xl shadow-royal-500/20',\n      crimson: 'shadow-2xl shadow-crimson-500/20'\n    },\n    \n    borders: {\n      gold: 'border border-gold-500/30',\n      silver: 'border border-silver-500/30',\n      royal: 'border border-royal-500/30',\n      crimson: 'border border-crimson-500/30',\n      emerald: 'border border-emerald-500/30'\n    },\n    \n    animations: {\n      float: 'animate-bounce',\n      pulse: 'animate-pulse',\n      spin: 'animate-spin',\n      ping: 'animate-ping'\n    }\n  },\n\n  // Tipografia temtica\n  typography: {\n    fonts: {\n      heading: 'font-bold tracking-wide',\n      body: 'font-medium',\n      accent: 'font-semibold tracking-wider uppercase'\n    },\n    \n    sizes: {\n      xs: 'text-xs',\n      sm: 'text-sm',\n      base: 'text-base',\n      lg: 'text-lg',\n      xl: 'text-xl',\n      '2xl': 'text-2xl',\n      '3xl': 'text-3xl',\n      '4xl': 'text-4xl'\n    }\n  },\n\n  // Layouts e espaamentos\n  layout: {\n    spacing: {\n      xs: 'p-2',\n      sm: 'p-4',\n      md: 'p-6',\n      lg: 'p-8',\n      xl: 'p-12'\n    },\n    \n    rounded: {\n      sm: 'rounded-md',\n      md: 'rounded-lg',\n      lg: 'rounded-xl',\n      full: 'rounded-full'\n    },\n    \n    containers: {\n      card: 'bg-slate-800 rounded-lg border border-slate-700 shadow-xl',\n      panel: 'bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-600 shadow-2xl',\n      modal: 'bg-gradient-to-br from-slate-900 to-black rounded-2xl border border-slate-600 shadow-2xl'\n    }\n  }\n};\n\n// Funes utilitrias para o tema\nexport const getThemeColor = (category: keyof typeof medievalTheme.colors, shade: number = 500) => {\n  return medievalTheme.colors[category]?.[shade as keyof typeof medievalTheme.colors[typeof category]] || '#64748b';\n};\n\nexport const getRankGradient = (rank: string) => {\n  return medievalTheme.gradients.ranks[rank as keyof typeof medievalTheme.gradients.ranks] || 'from-gray-400 to-gray-600';\n};\n\nexport const getRankIcon = (rank: string) => {\n  return medievalTheme.icons.ranks[rank as keyof typeof medievalTheme.icons.ranks] || '';\n};\n\nexport const getClassIcon = (heroClass: string) => {\n  return medievalTheme.icons.classes[heroClass as keyof typeof medievalTheme.icons.classes] || '';\n};\n\nexport const getActivityIcon = (activityType: string) => {\n  return medievalTheme.icons.activities[activityType as keyof typeof medievalTheme.icons.activities] || '';\n};\nexport const seasonalThemes = {\n  natal: {\n    banner: 'from-emerald-900/40 via-emerald-700/30 to-transparent',\n    accents: ['','',''],\n    border: 'border-emerald-500/40',\n    buttonGradient: 'from-emerald-600 to-emerald-700',\n    messages: [\n      'As velas do inverno iluminam as tavernas do reino.',\n      'Guirlandas de azevinho adornam os sales do castelo.',\n      'Presentes embrulhados em couro aguardam sob o pinheiro encantado.'\n    ]\n  },\n  pascoa: {\n    banner: 'from-purple-900/30 via-purple-700/20 to-transparent',\n    accents: ['','',''],\n    border: 'border-purple-500/40',\n    buttonGradient: 'from-purple-600 to-purple-700',\n    messages: [\n      'Ovos gravados com runas reaparecem nos bosques antigos.',\n      'Coelhos mgicos guiam heris por trilhas de renascimento.',\n      'Os bardos cantam lendas de retorno e esperana.'\n    ]\n  },\n  ano_novo: {\n    banner: 'from-amber-900/30 via-amber-700/20 to-transparent',\n    accents: ['','',''],\n    border: 'border-amber-500/40',\n    buttonGradient: 'from-amber-600 to-yellow-600',\n    messages: [\n      'Fogos encantados riscam o cu sobre muralhas antigas.',\n      'Banquetes reais celebram pactos e bons pressgios.',\n      'Profetas desenham novas rotas nos mapas do destino.'\n    ]\n  },\n  carnaval: {\n    banner: 'from-rose-900/30 via-violet-800/20 to-transparent',\n    accents: ['','',''],\n    border: 'border-rose-500/40',\n    buttonGradient: 'from-rose-600 to-violet-600',\n    messages: [\n      'Mscaras de criaturas msticas enfeitam as praas.',\n      'Festivais de bardos ecoam pelos becos da capital.',\n      'Torneios de disfarces premiam astcia e coragem.'\n    ]\n  }\n};\n\nexport const getSeasonalButtonGradient = (season?: 'natal'|'pascoa'|'ano_novo'|'carnaval') => {\n  const s = season ? (seasonalThemes as any)[season] : undefined;\n  const g: string | undefined = s?.buttonGradient;\n  return g || 'from-amber-600 to-yellow-600';\n};\n\nexport const getSeasonalButtonColors = (season?: 'natal'|'pascoa'|'ano_novo'|'carnaval') => {\n  switch (season) {\n    case 'natal': return { from: '#10b981', to: '#059669' }; // emerald\n    case 'pascoa': return { from: '#9333ea', to: '#7e22ce' }; // purple\n    case 'ano_novo': return { from: '#f59e0b', to: '#d97706' }; // amber\n    case 'carnaval': return { from: '#e11d48', to: '#7c3aed' }; // rose->violet\n    default: return { from: '#f59e0b', to: '#d97706' };\n  }\n};\n","import React, { useEffect, useMemo, useState } from 'react'\nimport { onboardingManager } from '../utils/onboardingSystem'\nimport { useNavigate } from 'react-router-dom'\nimport { getSeasonalButtonGradient, seasonalThemes } from '../styles/medievalTheme'\nimport { useMonetizationStore } from '../store/monetizationStore'\n\ntype Pos = 'top'|'bottom'|'left'|'right'|'center'\n\nconst OnboardingOverlay: React.FC = () => {\n  const [visible, setVisible] = useState(false)\n  const [rect, setRect] = useState<DOMRect | null>(null)\n  const [position, setPosition] = useState<Pos>('center')\n  const [title, setTitle] = useState('')\n  const [description, setDescription] = useState('')\n  const [skippable, setSkippable] = useState(false)\n  const navigate = useNavigate()\n  const { activeSeasonalTheme } = useMonetizationStore()\n  const g = getSeasonalButtonGradient(activeSeasonalTheme as any)\n  const accents: string[] = ((seasonalThemes as any)[activeSeasonalTheme || '']?.accents) || []\n\n  const updateFromStep = () => {\n    const step = onboardingManager.getCurrentStep()\n    if (!step) { setVisible(false); setRect(null); return }\n    setTitle(step.title || '')\n    setDescription(step.description || '')\n    setSkippable(!!step.skippable)\n    const pos = (step.position as Pos) || 'center'\n    setPosition(pos)\n    if (step.targetElement) {\n      try {\n        const el = document.querySelector(step.targetElement) as HTMLElement | null\n        if (el) {\n          try { el.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' }) } catch {}\n          const r = el.getBoundingClientRect()\n          setRect(r)\n          setVisible(true)\n        } else {\n          setRect(null)\n          setVisible(true)\n        }\n      } catch { setRect(null); setVisible(true) }\n    } else {\n      setRect(null)\n      setVisible(true)\n    }\n  }\n\n  useEffect(() => {\n    updateFromStep()\n    const onStep = () => updateFromStep()\n    onboardingManager.on('step-changed', onStep)\n    onboardingManager.on('step-completed', onStep)\n    onboardingManager.on('flow-completed', () => setVisible(false))\n    const onResize = () => updateFromStep()\n    window.addEventListener('resize', onResize)\n    window.addEventListener('scroll', onResize, true)\n    return () => {\n      onboardingManager.off('step-changed', onStep)\n      onboardingManager.off('step-completed', onStep)\n      window.removeEventListener('resize', onResize)\n      window.removeEventListener('scroll', onResize, true)\n    }\n  }, [])\n\n  const boxStyle = useMemo(() => {\n    if (!rect) return { left: '50%', top: '20%', width: 0, height: 0 }\n    return { left: `${rect.left + window.scrollX}px`, top: `${rect.top + window.scrollY}px`, width: `${rect.width}px`, height: `${rect.height}px` }\n  }, [rect])\n\n  const glowStyle = useMemo(() => {\n    if (!rect) return { left: 0, top: 0, width: 0, height: 0 }\n    const pad = 12\n    return { left: `${rect.left + window.scrollX - pad}px`, top: `${rect.top + window.scrollY - pad}px`, width: `${rect.width + pad * 2}px`, height: `${rect.height + pad * 2}px` }\n  }, [rect])\n\n  const arrowStyle = useMemo(() => {\n    if (!rect) return { left: '50%', top: '50%' }\n    const cx = rect.left + window.scrollX + rect.width / 2\n    const cy = rect.top + window.scrollY + rect.height / 2\n    if (position === 'top') return { left: `${cx}px`, top: `${rect.top + window.scrollY - 12}px` }\n    if (position === 'bottom') return { left: `${cx}px`, top: `${rect.bottom + window.scrollY + 4}px` }\n    if (position === 'left') return { left: `${rect.left + window.scrollX - 12}px`, top: `${cy}px` }\n    if (position === 'right') return { left: `${rect.right + window.scrollX + 4}px`, top: `${cy}px` }\n    return { left: `${cx}px`, top: `${rect.bottom + window.scrollY + 4}px` }\n  }, [rect, position])\n\n  if (!visible) return null\n\n  return (\n    <div className=\"fixed inset-0 z-[1000] pointer-events-none\">\n      <div className=\"absolute inset-0 bg-black/50\" />\n      {rect && (\n        <>\n          <div className=\"absolute rounded-xl bg-amber-400/10 blur-sm animate-pulse\" style={glowStyle} />\n          <div className=\"absolute border-2 border-amber-400 rounded-lg shadow-lg animate-pulse\" style={boxStyle} />\n        </>\n      )}\n      {rect && (\n        <div className=\"absolute -translate-x-1/2 -translate-y-1/2\" style={arrowStyle}>\n          {position === 'top' && (<div className=\"w-0 h-0 border-l-8 border-r-8 border-b-8 border-l-transparent border-r-transparent border-b-amber-400\" />)}\n          {position === 'bottom' && (<div className=\"w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-amber-400\" />)}\n          {position === 'left' && (<div className=\"w-0 h-0 border-t-8 border-b-8 border-r-8 border-t-transparent border-b-transparent border-r-amber-400\" />)}\n          {position === 'right' && (<div className=\"w-0 h-0 border-t-8 border-b-8 border-l-8 border-t-transparent border-b-transparent border-l-amber-400\" />)}\n        </div>\n      )}\n      <div className=\"absolute left-1/2 -translate-x-1/2\" style={{ top: position==='top' ? (rect ? rect.top + window.scrollY - 80 : 80) : position==='bottom' ? (rect ? rect.bottom + window.scrollY + 20 : 140) : position==='left' ? (rect ? rect.top + window.scrollY : 160) : position==='right' ? (rect ? rect.top + window.scrollY : 160) : 140 }}>\n        <div className=\"pointer-events-auto max-w-[90vw] sm:max-w-lg px-4 py-3 rounded-xl bg-slate-800 border border-white/20 shadow-xl\">\n          <div className=\"text-white font-semibold text-sm mb-1\">{title}</div>\n          <div className=\"text-xs text-gray-300 mb-3\">{description}</div>\n          <div className=\"flex items-center gap-2\">\n            <button onClick={() => { const s = onboardingManager.getCurrentStep(); if (s?.action?.type==='navigate' && s.action.target) navigate(s.action.target) }} className={`px-3 py-1 rounded bg-gradient-to-r ${g} text-white text-xs`}>{accents[0] || ''} Ir</button>\n            <button onClick={() => { onboardingManager.nextStep() }} className=\"px-3 py-1 rounded bg-gray-800 text-white text-xs\">Avanar</button>\n            {skippable && (\n              <button onClick={() => { onboardingManager.skipStep() }} className=\"px-3 py-1 rounded bg-gray-700 text-white text-xs\">Pular</button>\n            )}\n            <button onClick={() => { onboardingManager.reset() }} className=\"ml-auto px-3 py-1 rounded bg-gray-700 text-white text-xs\">Fechar</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default OnboardingOverlay","import { create } from 'zustand';\n\ntype User = {\n  sub: string;\n  email: string;\n  name?: string;\n  picture?: string;\n};\n\ntype AuthState = {\n  user: User | null;\n  token: string | null;\n  isAuthenticated: boolean;\n  login: (user: User, token: string) => void;\n  logout: () => void;\n};\n\nexport const useAuthStore = create<AuthState>((set) => ({\n  user: null,\n  token: null,\n  isAuthenticated: false,\n  login: (user, token) => {\n    try {\n      sessionStorage.setItem('hf_user', JSON.stringify({ user }));\n    } catch {}\n    set({ user, token: null, isAuthenticated: true });\n  },\n  logout: () => {\n    try { sessionStorage.removeItem('hf_user'); } catch {}\n    set({ user: null, token: null, isAuthenticated: false });\n  }\n}));\n\ntry {\n  const raw = sessionStorage.getItem('hf_user');\n  if (raw) {\n    const { user } = JSON.parse(raw);\n    useAuthStore.setState({ user, token: null, isAuthenticated: true });\n  }\n} catch {}\n\n","export async function loginWithGoogleCredential(credential: string) {\n  const res = await fetch('/api/login-google', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ credential })\n  });\n  const data = await res.json();\n  if (!res.ok) {\n    throw new Error(data?.error || 'Falha no login com Google');\n  }\n  return data.user;\n}\n\n","import React, { useEffect, useRef, useState } from 'react';\nimport { useAuthStore } from '../store/authStore';\nimport { loginWithGoogleCredential } from '../services/authService';\nimport { supabase, supabaseConfigured } from '../lib/supabaseClient';\nimport { notificationBus } from './NotificationSystem';\n\ndeclare global {\n  interface Window { google: any; }\n}\n\nconst FALLBACK_AVATAR_DATA_URL = \"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'><rect width='64' height='64' rx='8' fill='%23e5e7eb'/><circle cx='32' cy='24' r='12' fill='%239ca3af'/><rect x='14' y='40' width='36' height='18' rx='9' fill='%239ca3af'/></svg>\";\nconst GoogleLoginButton: React.FC = () => {\n  const btnRef = useRef<HTMLDivElement>(null);\n  const gsiInitDoneRef = useRef(false);\n  const gsiScriptAddedRef = useRef(false);\n  const gsiButtonRenderedRef = useRef(false);\n  const login = useAuthStore((s) => s.login);\n  const isAuthenticated = useAuthStore((s) => s.isAuthenticated);\n  const user = useAuthStore((s) => s.user);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    const clientId = import.meta.env.VITE_GOOGLE_CLIENT_ID;\n    const validClientId = clientId && clientId.includes('.apps.googleusercontent.com');\n    if (!validClientId || isAuthenticated) return;\n    const init = () => {\n      if (!window.google || !btnRef.current) return;\n      try {\n        if (!gsiInitDoneRef.current) {\n          window.google.accounts.id.initialize({\n            client_id: clientId,\n            callback: async (resp: any) => {\n              try {\n                setLoading(true);\n                const u = await loginWithGoogleCredential(resp.credential);\n                login(u, resp.credential);\n                try { notificationBus.emit({ type: 'achievement', title: 'Login Google', message: 'Autenticado com sucesso', icon: '', duration: 2500 }); } catch {}\n              } catch (err) {\n                console.error('Login Google falhou', err);\n                try { notificationBus.emit({ type: 'error', title: 'Falha no Login Google', message: 'Verifique configurao e tente novamente', duration: 3500 }); } catch {}\n              } finally { setLoading(false); }\n            }\n          });\n          gsiInitDoneRef.current = true;\n        }\n        if (!gsiButtonRenderedRef.current && btnRef.current.childElementCount === 0) {\n          window.google.accounts.id.renderButton(btnRef.current, { theme: 'outline', size: 'large' });\n          gsiButtonRenderedRef.current = true;\n        }\n      } catch (err) {\n        console.error('Erro inicializando Google Identity', err);\n      }\n    };\n    if (window.google) {\n      init();\n    } else {\n      if (!gsiScriptAddedRef.current && !document.querySelector('script[src=\"https://accounts.google.com/gsi/client\"]')) {\n        const s = document.createElement('script');\n        s.src = 'https://accounts.google.com/gsi/client';\n        s.async = true;\n        s.defer = true;\n        s.onload = init;\n        s.onerror = () => {};\n        document.head.appendChild(s);\n        gsiScriptAddedRef.current = true;\n      }\n    }\n  }, [isAuthenticated]);\n\n  if (isAuthenticated) {\n    return (\n      <div className=\"flex items-center space-x-2\">\n        {user?.picture && (\n      <img src={`/api/proxy-image?url=${encodeURIComponent(user.picture || '')}`} alt=\"avatar\" className=\"w-8 h-8 rounded-full\" onError={(e) => { (e.currentTarget as HTMLImageElement).src = FALLBACK_AVATAR_DATA_URL; }} />\n        )}\n        <span className=\"text-sm\">Ol, {user?.name || user?.email}</span>\n      </div>\n    );\n  }\n\n  const clientId = import.meta.env.VITE_GOOGLE_CLIENT_ID;\n  const validClientId = clientId && clientId.includes('.apps.googleusercontent.com');\n  const supabaseOAuthGoogleEnabled = String(import.meta.env.VITE_SUPABASE_OAUTH_GOOGLE_ENABLED || '').toLowerCase() === 'true';\n  if (!validClientId) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      <div ref={btnRef} />\n      {supabaseConfigured && supabaseOAuthGoogleEnabled && (\n        <button\n          onClick={async () => {\n            try {\n              setLoading(true);\n              await supabase.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.origin } });\n            } catch {\n              try { notificationBus.emit({ type: 'error', title: 'OAuth Google (Supabase)', message: 'Falha ao redirecionar', duration: 3000 }); } catch {}\n            } finally { setLoading(false); }\n          }}\n          className={`px-2 py-1 rounded ${loading ? 'bg-gray-600 opacity-60' : 'bg-gray-700 hover:bg-gray-600'} text-white text-xs`}\n          disabled={loading}\n        >Supabase</button>\n      )}\n    </div>\n  );\n};\n\nexport default GoogleLoginButton;\n\n","// import removido: Location no  utilizado\n\nexport type FlowStep = { label: string; path: string };\n\nexport const FLOW_STEPS: FlowStep[] = [\n  { label: 'Incio', path: '/journey' },\n  { label: 'Criar Heri', path: '/create' },\n  { label: 'Ver Galeria', path: '/gallery' },\n  { label: 'Misses', path: '/quests' },\n  { label: 'Evoluo', path: '/evolution' },\n];\n\nexport const getStepIndex = (pathname: string): number => {\n  const idx = FLOW_STEPS.findIndex((s) => pathname.startsWith(s.path));\n  return idx >= 0 ? idx : 0;\n};\n\nexport const getPrevPath = (pathname: string): string | null => {\n  const idx = getStepIndex(pathname);\n  if (idx <= 0) return null;\n  return FLOW_STEPS[idx - 1].path;\n};\n\nexport const getNextPath = (pathname: string): string | null => {\n  const idx = getStepIndex(pathname);\n  if (idx >= FLOW_STEPS.length - 1) return null;\n  return FLOW_STEPS[idx + 1].path;\n};\n","import { supabase } from '../lib/supabaseClient';\n\nexport type PlayerProfile = {\n  id: string;\n  username?: string | null;\n  created_at?: string;\n};\n\n// Verifica se um nome de usurio j est em uso na tabela `players`\nexport async function isUsernameAvailable(username: string): Promise<boolean> {\n  const clean = (username || '').trim().toLowerCase();\n  if (!clean) return false;\n  const { data, error } = await supabase\n    .from('players')\n    .select('id')\n    .eq('username', clean)\n    .limit(1);\n  if (error) {\n    return false;\n  }\n  return !(Array.isArray(data) && data.length > 0);\n}\n\n// Garante um perfil na tabela `players` para o usurio autenticado\nexport async function ensurePlayerProfile(userId: string, username?: string | null): Promise<PlayerProfile | null> {\n  if (!userId) return null;\n  const safeUsername = (username || null) as string | null;\n  // tenta buscar o perfil\n  const { data: existing, error: fetchError } = await supabase\n    .from('players')\n    .select('*')\n    .eq('id', userId)\n    .limit(1);\n  if (fetchError) {\n    // se RLS bloquear, apenas retorne null\n    return null;\n  }\n  if (existing && existing.length > 0) {\n    // atualiza username se mudou\n    const { data: updated, error: updateError } = await supabase\n      .from('players')\n      .update({ username: safeUsername })\n      .eq('id', userId)\n      .select('*')\n      .limit(1);\n    if (updateError) return existing[0] as PlayerProfile;\n    return (updated && updated[0]) as PlayerProfile;\n  }\n  // cria novo perfil\n  const { data: inserted, error: insertError } = await supabase\n    .from('players')\n    .insert({ id: userId, username: safeUsername })\n    .select('*')\n    .limit(1);\n  if (insertError) return null;\n  return (inserted && inserted[0]) as PlayerProfile;\n}\n\n","export type MonetizationConfig = {\n  stripeEnabled: boolean;\n  stripePublicKey: string;\n  storeEnabled: boolean;\n  adsenseClientId?: string;\n  adSlotBannerTop?: string;\n  adSlotInterstitial?: string;\n};\n\nexport async function getMonetizationConfig(): Promise<MonetizationConfig> {\n  const res = await fetch('/api/monetization/config');\n  const data = await res.json();\n  return data as MonetizationConfig;\n}\n\n","import { supabase } from '../lib/supabaseClient';\nimport type { Quest } from '../types/hero';\n\nexport type StoredQuest = {\n  id: string;\n  user_id: string;\n  hero_id: string;\n  data: any;\n  status?: 'active' | 'completed' | 'failed';\n  created_at?: string;\n  updated_at?: string;\n};\n\nexport async function saveQuest(userId: string, heroId: string, quest: Quest, status: StoredQuest['status'] = 'active'): Promise<StoredQuest | null> {\n  if (!userId || !heroId || !quest?.id) return null;\n  const payload = { id: quest.id, user_id: userId, hero_id: heroId, data: quest, status };\n  const { data, error } = await supabase\n    .from('quests')\n    .upsert(payload, { onConflict: 'id' })\n    .select('*')\n    .limit(1);\n  if (error) {\n    console.error('saveQuest error', {\n      code: (error as any)?.code,\n      message: (error as any)?.message,\n      details: (error as any)?.details,\n      hint: (error as any)?.hint,\n      payload\n    });\n    return null;\n  }\n  return (data && data[0]) as StoredQuest;\n}\n\nexport async function listQuestsByHero(userId: string, heroId: string): Promise<StoredQuest[]> {\n  if (!userId || !heroId) return [];\n  const { data, error } = await supabase\n    .from('quests')\n    .select('*')\n    .eq('user_id', userId)\n    .eq('hero_id', heroId)\n    .order('updated_at', { ascending: false });\n  if (error) {\n    console.error('listQuestsByHero error', {\n      code: (error as any)?.code,\n      message: (error as any)?.message,\n      details: (error as any)?.details,\n      hint: (error as any)?.hint,\n      userId,\n      heroId\n    });\n    return [];\n  }\n  return (Array.isArray(data) ? data : []) as StoredQuest[];\n}\n\nexport async function updateQuestStatus(questId: string, status: StoredQuest['status']): Promise<StoredQuest | null> {\n  if (!questId) return null;\n  const { data, error } = await supabase\n    .from('quests')\n    .update({ status })\n    .eq('id', questId)\n    .select('*')\n    .limit(1);\n  if (error) {\n    console.error('updateQuestStatus error', error);\n    return null;\n  }\n  return (data && data[0]) as StoredQuest;\n}\n\nexport async function deleteQuest(questId: string): Promise<boolean> {\n  if (!questId) return false;\n  const { error } = await supabase\n    .from('quests')\n    .delete()\n    .eq('id', questId);\n  if (error) {\n    console.error('deleteQuest error', error);\n    return false;\n  }\n  return true;\n}\n","export async function listFriends(userId: string): Promise<string[]> {\n  const q = new URLSearchParams();\n  q.set('userId', userId);\n  const res = await fetch(`/api/users/friends?${q.toString()}`);\n  if (!res.ok) throw new Error(`Falha ao listar amigos: ${res.status}`);\n  const data = await res.json();\n  return Array.isArray(data?.friends) ? data.friends as string[] : [];\n}\n\nexport async function addFriend(userId: string, targetId: string): Promise<boolean> {\n  const res = await fetch('/api/users/friends/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId, targetId }) });\n  if (!res.ok) throw new Error(`Falha ao adicionar amigo: ${res.status}`);\n  const data = await res.json();\n  return !!data?.ok;\n}\n\nexport async function removeFriend(userId: string, targetId: string): Promise<boolean> {\n  const res = await fetch('/api/users/friends/remove', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId, targetId }) });\n  if (!res.ok) throw new Error(`Falha ao remover amigo: ${res.status}`);\n  const data = await res.json();\n  return !!data?.ok;\n}\n\nexport async function listNotifications(userId: string): Promise<any[]> {\n  try {\n    const envAny = (typeof import.meta !== 'undefined' ? (import.meta as any).env : undefined) || {};\n    const apiBase = envAny.VITE_API_BASE_URL || envAny.VITE_API_BASE || '';\n    if (!apiBase) return [];\n    const q = new URLSearchParams();\n    q.set('viewerId', userId);\n    const base = apiBase || (typeof window !== 'undefined' ? window.location.origin : '');\n    const url = new URL('/api/notifications/list', base);\n    url.search = q.toString();\n    const res = await fetch(url.toString());\n    if (!res.ok) return [];\n    const data = await res.json();\n    return Array.isArray(data?.notifications) ? data.notifications : [];\n  } catch {\n    return [];\n  }\n}\n\nexport async function listEventsHistory(userId: string): Promise<any[]> {\n  try {\n    const envAny = (typeof import.meta !== 'undefined' ? (import.meta as any).env : undefined) || {};\n    const apiBase = envAny.VITE_API_BASE_URL || envAny.VITE_API_BASE || '';\n    if (!apiBase) return [];\n    const q = new URLSearchParams();\n    q.set('viewerId', userId);\n    const base = apiBase || (typeof window !== 'undefined' ? window.location.origin : '');\n    const url = new URL('/api/events/history', base);\n    url.search = q.toString();\n    const res = await fetch(url.toString());\n    if (!res.ok) return [];\n    const data = await res.json();\n    return Array.isArray(data?.events) ? data.events : [];\n  } catch {\n    return [];\n  }\n}\n\nexport type UserProfile = {\n  userId: string;\n  displayName?: string;\n  avatarUrl?: string;\n  bio?: string;\n  settings?: any;\n};\n\nexport async function getProfile(userId: string): Promise<UserProfile | null> {\n  const q = new URLSearchParams();\n  q.set('userId', userId);\n  try {\n    const res = await fetch(`/api/users/profile?${q.toString()}`);\n    if (res.status === 404) return null;\n    if (!res.ok) throw new Error(`Falha ao obter perfil: ${res.status}`);\n    const data = await res.json();\n    const profile = (data?.profile || data) as any;\n    if (!profile || typeof profile !== 'object') return null;\n    return {\n      userId: String(profile.userId || userId),\n      displayName: profile.displayName,\n      avatarUrl: profile.avatarUrl,\n      bio: profile.bio,\n      settings: profile.settings,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport type UserProgress = {\n  missionsCompleted: number;\n  achievementsUnlocked: number;\n  playtimeMinutes: number;\n};\n\nexport async function getUserProgress(userId: string): Promise<UserProgress> {\n  try {\n    const { loadLocalQuests, loadLocalHeroes } = await import('./localStore');\n    const quests = loadLocalQuests(userId);\n    const heroes = loadLocalHeroes(userId);\n    const localCompleted = Array.isArray(quests) ? quests.filter((q: any) => q?.status === 'completed').length : 0;\n    const storeHeroes = Array.isArray(heroes) ? heroes : [];\n    let completedFromHeroes = 0;\n    let achievementsFromHeroes = 0;\n    let playtimeFromHeroes = 0;\n    for (const h of storeHeroes) {\n      try {\n        completedFromHeroes += Array.isArray(h?.completedQuests) ? h.completedQuests.length : (h?.stats?.questsCompleted || 0);\n        achievementsFromHeroes += Array.isArray(h?.achievements) ? h.achievements.filter((a: any) => a?.unlocked).length : (h?.stats?.achievementsUnlocked || 0);\n        playtimeFromHeroes += Number(h?.stats?.totalPlayTime || 0);\n      } catch {}\n    }\n    return {\n      missionsCompleted: localCompleted + completedFromHeroes,\n      achievementsUnlocked: achievementsFromHeroes,\n      playtimeMinutes: playtimeFromHeroes,\n    };\n  } catch {\n    return { missionsCompleted: 0, achievementsUnlocked: 0, playtimeMinutes: 0 };\n  }\n}\n\n","import { supabase, supabaseConfigured } from '../lib/supabaseClient';\n\nexport type SocialEvent = {\n  id: string;\n  name: string;\n  description: string;\n  dateTime: string;\n  locationText?: string;\n  lat?: number;\n  lng?: number;\n  capacity: number;\n  tags: string[];\n  privacy: 'public' | 'private' | 'invite';\n  ownerId: string;\n  createdAt: string;\n  attendees?: Record<string, 'yes' | 'no' | 'maybe'>;\n  invitedIds?: string[];\n  deleted?: boolean;\n};\n\nexport type EventMessage = { id: string; userId: string; text: string; ts: number };\nexport type EventMedia = { id: string; userId: string; url: string; caption?: string; ts: number };\nexport type Pagination = { total: number; offset: number; limit: number; hasMore: boolean };\nexport type Paged<T> = { items: T[]; pagination: Pagination };\nexport type PageLinks = { prev?: string; next?: string };\n\nconst API_BASE = (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.VITE_API_BASE_URL) || (() => {\n  try {\n    const p = typeof window !== 'undefined' ? window.location.port : '';\n    if (p === '4174') return 'http://localhost:3001';\n  } catch {}\n  return '';\n})();\n\nfunction makeUrl(path: string, qs?: URLSearchParams): string {\n  try {\n    const base = API_BASE || (typeof window !== 'undefined' ? window.location.origin : '');\n    const url = new URL(path, base);\n    if (qs) url.search = qs.toString();\n    return url.toString();\n  } catch {\n    if (qs) return `${path}?${qs.toString()}`;\n    return path;\n  }\n}\n\nasync function authHeaders(userId?: string): Promise<Record<string, string>> {\n  const headers: Record<string, string> = {};\n  try {\n    const { data } = await supabase.auth.getSession();\n    const token = data?.session?.access_token;\n    if (token) headers['Authorization'] = `Bearer ${token}`;\n  } catch {}\n  if (!headers['Authorization'] && userId && !supabaseConfigured) headers['X-User-Id'] = userId;\n  return headers;\n}\n\nfunction parseLinkHeader(link?: string | null): PageLinks {\n  const out: PageLinks = {};\n  if (!link) return out;\n  const parts = String(link).split(',');\n  for (const p of parts) {\n    const m = /<([^>]+)>;\\s*rel=\"(prev|next)\"/i.exec(p.trim());\n    if (m) {\n      const url = m[1];\n      const rel = m[2].toLowerCase();\n      if (rel === 'prev') out.prev = url; else if (rel === 'next') out.next = url;\n    }\n  }\n  return out;\n}\n\nasync function handleError(res: Response): Promise<never> {\n  if (res.status === 409) {\n    throw new Error('Limite de participantes atingido');\n  }\n  try {\n    const j = await res.json();\n    const code = j?.code || `HTTP_${res.status}`;\n    const msg = j?.message || j?.error || (res.status === 409 ? 'Limite de participantes atingido' : `Falha HTTP ${res.status}`);\n    const err = new Error(msg);\n    (err as any).code = code;\n    (err as any).details = j?.details;\n    throw err;\n  } catch {\n    throw new Error(`Falha HTTP ${res.status}`);\n  }\n}\n\nexport async function listEvents(viewerId: string, opts: { tag?: string; ownerId?: string; limit?: number; offset?: number } = {}): Promise<SocialEvent[]> {\n  try {\n    if (!API_BASE) return [];\n    const q = new URLSearchParams();\n    if (viewerId) q.set('viewerId', viewerId);\n    if (opts.tag) q.set('tag', opts.tag);\n    if (opts.ownerId) q.set('ownerId', opts.ownerId);\n    if (typeof opts.limit === 'number') q.set('limit', String(opts.limit));\n    if (typeof opts.offset === 'number') q.set('offset', String(opts.offset));\n    const headers = await authHeaders(viewerId);\n    const res = await fetch(makeUrl('/api/events/list', q), { headers });\n    if (!res.ok) return [];\n    const data = await res.json();\n    return Array.isArray(data?.events) ? data.events as SocialEvent[] : [];\n  } catch {\n    return [];\n  }\n}\n\nexport async function listEventsPaged(viewerId: string, opts: { tag?: string; ownerId?: string; limit?: number; offset?: number } = {}): Promise<Paged<SocialEvent>> {\n  try {\n    if (!API_BASE) return { items: [], pagination: { total: 0, offset: Number(opts.offset||0), limit: Number(opts.limit||0), hasMore: false } };\n    const q = new URLSearchParams();\n    if (viewerId) q.set('viewerId', viewerId);\n    if (opts.tag) q.set('tag', opts.tag);\n    if (opts.ownerId) q.set('ownerId', opts.ownerId);\n    if (typeof opts.limit === 'number') q.set('limit', String(opts.limit));\n    if (typeof opts.offset === 'number') q.set('offset', String(opts.offset));\n    const headers = await authHeaders(viewerId);\n    const res = await fetch(makeUrl('/api/events/list', q), { headers });\n    if (!res.ok) return { items: [], pagination: { total: 0, offset: Number(opts.offset||0), limit: Number(opts.limit||0), hasMore: false } };\n    const data = await res.json();\n    const items = Array.isArray(data?.events) ? data.events as SocialEvent[] : [];\n    const pagination: Pagination = data?.pagination || { total: items.length, offset: Number(opts.offset||0), limit: Number(opts.limit||items.length||0), hasMore: false };\n    return { items, pagination };\n  } catch {\n    return { items: [], pagination: { total: 0, offset: Number(opts.offset||0), limit: Number(opts.limit||0), hasMore: false } };\n  }\n}\n\nexport async function createEvent(payload: {\n  name: string;\n  dateTime: string;\n  locationText?: string;\n  lat?: number;\n  lng?: number;\n  description?: string;\n  capacity?: number;\n  tags?: string[];\n  privacy?: 'public' | 'private' | 'invite';\n  ownerId: string;\n  invitedIds?: string[];\n}): Promise<SocialEvent> {\n  const headers = { 'Content-Type': 'application/json', ...(await authHeaders(payload.ownerId)) };\n  const res = await fetch(makeUrl('/api/events/create'), { method: 'POST', headers, body: JSON.stringify(payload) });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return data?.event as SocialEvent;\n}\n\nexport async function getEvent(id: string, viewerId?: string): Promise<SocialEvent | null> {\n  const q = new URLSearchParams();\n  if (viewerId) q.set('viewerId', viewerId);\n  const headers = await authHeaders(viewerId);\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}`, q), { headers });\n  if (res.status === 404) return null;\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return data?.event as SocialEvent;\n}\n\nexport async function updateEvent(id: string, actorId: string, updates: Partial<Omit<SocialEvent, 'id' | 'ownerId' | 'createdAt'>>): Promise<SocialEvent> {\n  const headers = { 'Content-Type': 'application/json', ...(await authHeaders(actorId)) };\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/update`), { method: 'POST', headers, body: JSON.stringify({ actorId, updates }) });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return data?.event as SocialEvent;\n}\n\nexport async function deleteEvent(id: string, actorId: string): Promise<boolean> {\n  const headers = { 'Content-Type': 'application/json', ...(await authHeaders(actorId)) };\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/delete`), { method: 'POST', headers, body: JSON.stringify({ actorId }) });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return !!data?.ok;\n}\n\nexport async function attendEvent(id: string, viewerId: string, status: 'yes' | 'no' | 'maybe'): Promise<SocialEvent> {\n  const headers = { 'Content-Type': 'application/json', ...(await authHeaders(viewerId)) };\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/attend`), { method: 'POST', headers, body: JSON.stringify({ viewerId, status }) });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return data?.event as SocialEvent;\n}\n\nexport async function fetchEventChat(id: string, signal?: AbortSignal): Promise<EventMessage[]> {\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/chat`), { signal });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return Array.isArray(data?.messages) ? data.messages as EventMessage[] : [];\n}\n\nexport async function sendEventChat(id: string, viewerId: string, text: string): Promise<EventMessage> {\n  const headers = { 'Content-Type': 'application/json', ...(await authHeaders(viewerId)) };\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/chat`), { method: 'POST', headers, body: JSON.stringify({ viewerId, text }) });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return data?.message as EventMessage;\n}\n\nexport async function addEventMedia(id: string, viewerId: string, url: string, caption?: string): Promise<EventMedia> {\n  const headers = { 'Content-Type': 'application/json', ...(await authHeaders(viewerId)) };\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/media`), { method: 'POST', headers, body: JSON.stringify({ viewerId, url, caption }) });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return data?.media as EventMedia;\n}\n\nexport async function listEventMedia(id: string, signal?: AbortSignal): Promise<EventMedia[]> {\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/media`), { signal });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return Array.isArray(data?.media) ? data.media as EventMedia[] : [];\n}\n\nexport async function rateEvent(id: string, viewerId: string, stars: number, comment?: string): Promise<boolean> {\n  const headers = { 'Content-Type': 'application/json', ...(await authHeaders(viewerId)) };\n  const res = await fetch(makeUrl(`/api/events/${encodeURIComponent(id)}/rate`), { method: 'POST', headers, body: JSON.stringify({ viewerId, stars, comment }) });\n  if (!res.ok) return handleError(res);\n  const data = await res.json();\n  return !!data?.ok;\n}\n\nexport async function recommendEvents(viewerId: string, interestsCsv?: string, opts: { limit?: number; offset?: number } = {}): Promise<SocialEvent[]> {\n  try {\n    const q = new URLSearchParams();\n    if (viewerId) q.set('viewerId', viewerId);\n    if (interestsCsv) q.set('interests', interestsCsv);\n    if (typeof opts.limit === 'number') q.set('limit', String(opts.limit));\n    if (typeof opts.offset === 'number') q.set('offset', String(opts.offset));\n    const headers = await authHeaders(viewerId);\n    const res = await fetch(makeUrl('/api/events/recommendations', q), { headers });\n    if (!res.ok) return [];\n    const data = await res.json();\n    return Array.isArray(data?.events) ? data.events as SocialEvent[] : [];\n  } catch {\n    return [];\n  }\n}\n\nexport async function recommendEventsPaged(viewerId: string, interestsCsv?: string, opts: { limit?: number; offset?: number } = {}): Promise<Paged<SocialEvent>> {\n  try {\n    const q = new URLSearchParams();\n    if (viewerId) q.set('viewerId', viewerId);\n    if (interestsCsv) q.set('interests', interestsCsv);\n    if (typeof opts.limit === 'number') q.set('limit', String(opts.limit));\n    if (typeof opts.offset === 'number') q.set('offset', String(opts.offset));\n    const headers = await authHeaders(viewerId);\n    const res = await fetch(makeUrl('/api/events/recommendations', q), { headers });\n    if (!res.ok) return { items: [], pagination: { total: 0, offset: Number(opts.offset||0), limit: Number(opts.limit||0), hasMore: false } };\n    const data = await res.json();\n    const items = Array.isArray(data?.events) ? data.events as SocialEvent[] : [];\n    const pagination: Pagination = data?.pagination || { total: items.length, offset: Number(opts.offset||0), limit: Number(opts.limit||items.length||0), hasMore: false };\n    return { items, pagination };\n  } catch {\n    return { items: [], pagination: { total: 0, offset: Number(opts.offset||0), limit: Number(opts.limit||0), hasMore: false } };\n  }\n}","export function getYesCount(attendees?: Record<string, string>): number {\n  return Object.values(attendees || {}).filter(v => v === 'yes').length;\n}\n\nexport function computeOccupancyPercent(capacity?: number, attendees?: Record<string, string>): number {\n  const cap = Math.max(1, Number(capacity || 1));\n  const yes = getYesCount(attendees);\n  return Math.min(100, Math.round((yes / cap) * 100));\n}\n\nexport function isNearFull(capacity?: number, attendees?: Record<string, string>, threshold: number = 0.9): boolean {\n  const cap = Math.max(1, Number(capacity || 1));\n  const yes = getYesCount(attendees);\n  return (yes / cap) >= threshold;\n}","import React, { useState, useEffect } from 'react';\nimport { Outlet, Link, useLocation } from 'react-router-dom';\nimport { useHeroStore } from '../store/heroStore';\nconst EnhancedHUDLazy = React.lazy(() => import('./EnhancedHUD'));\nimport NotificationSystem, { useNotifications, notificationBus } from './NotificationSystem';\nimport OnboardingOverlay from './OnboardingOverlay';\nconst QuickNavigationLazy = React.lazy(() => import('./QuickNavigation'));\nimport { medievalTheme, getClassIcon, seasonalThemes, getSeasonalButtonGradient } from '../styles/medievalTheme';\nimport { rankSystem } from '../utils/rankSystem';\nimport { useProgressionStore } from '../store/progressionStore';\nimport GoogleLoginButton from './GoogleLoginButton';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { FlowProgress } from './FlowProgress';\nimport { FlowControls } from './FlowControls';\nconst AdBannerLazy = React.lazy(() => import('./AdBanner'));\nconst InterstitialAdLazy = React.lazy(() => import('./InterstitialAd'));\nconst SeasonalDecorLazy = React.lazy(() => import('./SeasonalDecor'));\nimport { FLOW_STEPS, getStepIndex } from '../utils/flow';\nimport { trackMetric } from '../utils/metricsSystem';\nimport { worldStateManager } from '../utils/worldState';\nimport { supabase, supabaseConfigured } from '../lib/supabaseClient';\nimport { ensurePlayerProfile } from '../services/playersService';\nimport { getMonetizationConfig } from '../services/monetizationService';\nimport { listHeroesByUser, saveHero, sanitizeStoredHeroData } from '../services/heroesService';\nimport { listQuestsByHero, saveQuest } from '../services/questsService';\nimport { listNotifications } from '../services/userService';\nimport { listEventsPaged } from '../services/socialEventsService';\nimport { isNearFull } from '../utils/eventsHelpers';\n\nconst Layout = () => {\n  const location = useLocation();\n  const [hudVisible, setHudVisible] = useState(true);\n  const { getSelectedHero, heroes, updateHero, importHero, getHeroQuests, availableQuests } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const { notifications, removeNotification, addNotification } = useNotifications();\n  const currentIdx = getStepIndex(location.pathname);\n  const [sbEmail, setSbEmail] = useState<string | null>(null);\n  const [sbUserId, setSbUserId] = useState<string | null>(null);\n  const [syncing, setSyncing] = useState(false);\n  const [lastSyncedFor, setLastSyncedFor] = useState<string | null>(null);\n  const { setConfig, activeThemeId } = useMonetizationStore();\n  const [notifCount, setNotifCount] = useState<number>(0);\n  const [organizerNearCount, setOrganizerNearCount] = useState<number>(0);\n  const [installPrompt, setInstallPrompt] = useState<any>(null);\n  const [installAvailable, setInstallAvailable] = useState<boolean>(false);\n  const [iosTipOpen, setIosTipOpen] = useState<boolean>(false);\n  const [openGroup, setOpenGroup] = useState<string | null>(null);\n  const [partyInvitesCount, setPartyInvitesCount] = useState<number>(0);\n  \n\n  useEffect(() => {\n    let mounted = true;\n    async function loadUser() {\n      const { data } = await supabase.auth.getUser();\n      if (!mounted) return;\n      setSbEmail(data?.user?.email || null);\n      setSbUserId(data?.user?.id || null);\n      try {\n        const id = data?.user?.id;\n        if (id) {\n          await fetch(`/api/users?action=touch-login&id=${encodeURIComponent(id)}`);\n        }\n      } catch {}\n    }\n    loadUser();\n    const { data: sub } = supabase.auth.onAuthStateChange((_event, session) => {\n      setSbEmail(session?.user?.email || null);\n      setSbUserId(session?.user?.id || null);\n    });\n    return () => { mounted = false; sub?.subscription.unsubscribe(); };\n  }, []);\n\n  useEffect(() => {\n    if (!('serviceWorker' in navigator)) return;\n    const handler = () => {\n      try {\n        addNotification({ id: `upd-${Date.now()}`, type: 'info', title: 'App atualizado', message: 'Uma nova verso foi instalada.', timeoutMs: 5000 });\n        trackMetric.featureUsed('system', 'app-updated');\n      } catch {}\n    };\n    navigator.serviceWorker.addEventListener('controllerchange', handler);\n    return () => { navigator.serviceWorker.removeEventListener('controllerchange', handler); };\n  }, [addNotification]);\n\n  useEffect(() => {\n    let timer: any = null;\n    const load = async () => {\n      try {\n        const me = getSelectedHero();\n        const id = me?.id || '';\n        if (!id) { setNotifCount(0); return; }\n        const items = await listNotifications(id);\n        setNotifCount(Array.isArray(items) ? items.length : 0);\n      } catch {}\n    };\n    load();\n    timer = setInterval(load, 60000);\n    return () => { if (timer) clearInterval(timer); };\n  }, [heroes.length, selectedHero?.id]);\n\n  useEffect(() => {\n    let timer: any = null;\n    const loadOrganizer = async () => {\n      try {\n        const me = getSelectedHero();\n        const id = me?.id || '';\n        if (!id) { setOrganizerNearCount(0); return; }\n        const paged = await listEventsPaged(id, { ownerId: id, limit: 50, offset: 0 });\n        const near = paged.items.filter((e: any) => isNearFull(e.capacity, e.attendees)).length;\n        setOrganizerNearCount(near);\n      } catch {}\n    };\n    loadOrganizer();\n    timer = setInterval(loadOrganizer, 60000);\n    return () => { if (timer) clearInterval(timer); };\n  }, [selectedHero?.id]);\n\n  useEffect(() => {\n    const calc = () => {\n      try {\n        const me = getSelectedHero();\n        const id = me?.id || '';\n        if (!id) { setPartyInvitesCount(0); return; }\n        const parties = (useHeroStore.getState() as any).parties as any[] || [];\n        const count = parties.filter(p => Array.isArray(p?.invites) && p.invites.includes(id)).length;\n        setPartyInvitesCount(count);\n      } catch { setPartyInvitesCount(0); }\n    };\n    calc();\n    const t = setInterval(calc, 30000);\n    return () => clearInterval(t);\n  }, [selectedHero?.id]);\n\n  // Carregar configurao de monetizao (AdSense/Stripe) no boot\n  useEffect(() => {\n    (async () => {\n      try {\n        const cfg = await getMonetizationConfig();\n        setConfig({\n          adSenseClientId: cfg.adsenseClientId,\n          adSlotBannerTop: cfg.adSlotBannerTop,\n          adSlotInterstitial: cfg.adSlotInterstitial\n        });\n      } catch {}\n    })();\n  }, []);\n\n  // Auto-aplicar tema sazonal por data\n  useEffect(() => {\n    try {\n      const s = useMonetizationStore.getState();\n      if (s.seasonalAutoEnabled && !s.activeSeasonalTheme) {\n        s.autoApplySeasonal();\n      }\n    } catch {}\n  }, []);\n\n  // Auto-sync de heris: visitante joga offline, ao logar sincroniza tudo com o Supabase\n  useEffect(() => {\n    async function runSync(userId: string) {\n      try {\n        setSyncing(true);\n        // Garante perfil\n        await ensurePlayerProfile(userId, sbEmail || null);\n        // Carrega remotos\n        const remote = await listHeroesByUser(userId);\n        // Importa remotos no jogo (merge)\n        remote.forEach(h => {\n          try {\n            const sanitized = sanitizeStoredHeroData(h.data);\n            importHero(sanitized, false);\n          } catch {}\n        });\n        // Envia locais para Supabase\n        for (const localHero of heroes) {\n          await saveHero(userId, localHero);\n        }\n\n        // --- Sincronizao automtica de misses (remoto vence em conflitos) ---\n        const injectedRemoteQuestObjs: any[] = [];\n        for (const hero of heroes) {\n          try {\n            const remoteQuests = await listQuestsByHero(userId, hero.id);\n            const remoteActiveIds = remoteQuests\n              .filter((q) => (q.status || '').toLowerCase() === 'active' && q?.data?.id)\n              .map((q) => String(q.data.id));\n\n            // Coletar objetos de misses remotas ativas para injeo no availableQuests\n            remoteQuests\n              .filter((q) => (q.status || '').toLowerCase() === 'active' && q?.data?.id)\n              .forEach((q) => {\n                const obj = { ...q.data, sticky: true };\n                injectedRemoteQuestObjs.push(obj);\n              });\n\n            const localActiveQuests = getHeroQuests(hero.id);\n            const localActiveIds = localActiveQuests.map((q) => q.id);\n\n            // Remoto vence em conflitos: manter IDs remotos e adicionar locais inexistentes\n            const safeRemote = Array.isArray(remoteActiveIds) ? remoteActiveIds : [];\n            const safeLocal = Array.isArray(localActiveIds) ? localActiveIds : [];\n            const mergedActiveIds = Array.from(new Set([...safeRemote, ...safeLocal]));\n            if (mergedActiveIds.join(',') !== (hero.activeQuests || []).join(',')) {\n              updateHero(hero.id, { activeQuests: mergedActiveIds });\n            }\n\n            // Subir misses locais que no existem remotamente\n            const localOnlyIds = localActiveIds.filter((id) => !remoteActiveIds.includes(id));\n            if (localOnlyIds.length > 0) {\n              const byId = new Map(localActiveQuests.map((q) => [q.id, q]));\n              for (const id of localOnlyIds) {\n                const questObj = byId.get(id);\n                if (questObj) {\n                  await saveQuest(userId, hero.id, questObj, 'active');\n                }\n              }\n            }\n          } catch {}\n        }\n\n        // Injetar misses remotas ativas no availableQuests (para renderizao do board)\n        try {\n          const currentAvail = useHeroStore.getState().availableQuests || [];\n          const byId = new Map<string, any>();\n          // manter atuais\n          for (const q of currentAvail) byId.set(String(q.id), q);\n          // injetar remotas (sticky para persistir)\n          for (const rq of injectedRemoteQuestObjs) {\n            const id = String(rq.id);\n            if (!byId.has(id)) byId.set(id, rq);\n          }\n          const mergedAvail = Array.from(byId.values());\n          useHeroStore.setState({ availableQuests: mergedAvail });\n        } catch {}\n\n        setLastSyncedFor(userId);\n        addNotification({\n          id: `sync-${Date.now()}`,\n          type: 'info',\n          title: 'Sincronizao concluda',\n          message: 'Heris e misses ativos foram sincronizados com sua conta Supabase.',\n          timeoutMs: 4000\n        });\n      } catch (err: any) {\n        addNotification({\n          id: `sync-error-${Date.now()}`,\n          type: 'error',\n          title: 'Falha ao sincronizar',\n          message: err?.message || 'Verifique sua conexo e tente novamente.',\n          timeoutMs: 5000\n        });\n      } finally {\n        setSyncing(false);\n      }\n    }\n    if (sbUserId && !syncing && lastSyncedFor !== sbUserId) {\n      runSync(sbUserId);\n    }\n  }, [sbUserId]);\n\n  useEffect(() => {\n    const onBeforeInstallPrompt = (e: any) => {\n      e.preventDefault();\n      setInstallPrompt(e);\n      setInstallAvailable(true);\n      try { trackMetric.featureUsedData('system', 'pwa-install-available', { device: navigator.userAgent }); } catch {}\n    };\n    const onInstalled = () => {\n      try { trackMetric.featureUsedData('system', 'pwa-installed', { device: navigator.userAgent }); } catch {}\n      setInstallAvailable(false);\n      setInstallPrompt(null);\n    };\n    window.addEventListener('beforeinstallprompt', onBeforeInstallPrompt);\n    window.addEventListener('appinstalled', onInstalled);\n    return () => {\n      window.removeEventListener('beforeinstallprompt', onBeforeInstallPrompt);\n      window.removeEventListener('appinstalled', onInstalled);\n    };\n  }, []);\n\n  \n\n  // Assinar barramento global de notificaes para exibir toasts\n  useEffect(() => {\n    const unsubscribe = notificationBus.subscribe((n) => {\n      addNotification(n);\n    });\n    return unsubscribe;\n  }, [addNotification]);\n\n  // Tick global de regenerao: mantm HP e Mana atualizando mesmo com HUD oculto\n  useEffect(() => {\n    if (!selectedHero) return;\n    const interval = setInterval(() => {\n      try {\n        const h = {\n          ...selectedHero,\n          derivedAttributes: { ...selectedHero.derivedAttributes },\n          stats: { ...selectedHero.stats }\n        } as any;\n        try { (worldStateManager as any).updateVitals?.(h); } catch {}\n        \n        try {\n          if (h.activePetId && Array.isArray(h.pets)) {\n            const idx = h.pets.findIndex((p: any) => p.id === h.activePetId);\n            if (idx >= 0) {\n              const p = { ...h.pets[idx] };\n              const nextEnergy = Math.min(100, Math.max(0, (p.energy || 0) + 5));\n              if (nextEnergy !== (p.energy || 0)) {\n                p.energy = nextEnergy;\n                const nextPets = [...h.pets];\n                nextPets[idx] = p;\n                updateHero(h.id, { pets: nextPets });\n              }\n            }\n          }\n        } catch {}\n        const prev = (useHeroStore.getState().heroes || []).find(x => x.id === h.id);\n        const mergedStats = { ...(prev?.stats || {}), lastActiveAt: h.stats.lastActiveAt } as any;\n        updateHero(h.id, { derivedAttributes: h.derivedAttributes, stats: mergedStats });\n      } catch {}\n    }, 60_000);\n    return () => clearInterval(interval);\n  }, [selectedHero?.id]);\n\n  const isActive = (path: string) => {\n    return location.pathname === path;\n  };\n\n  const navLinkClass = (path: string) => {\n    const active = isActive(path);\n    const g = getSeasonalButtonGradient(useMonetizationStore.getState().activeSeasonalTheme as any);\n    return active\n      ? `px-2 py-1 rounded bg-gradient-to-r ${g} text-white font-semibold hover:brightness-110 transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`\n      : `hover:text-amber-400 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 rounded`;\n  };\n\n  const GatedLink: React.FC<{ to: string; label: string; feature?: 'hunting_basic' | 'shop_basic' | 'crafting_simple' | 'stable_basic'; testId?: string }>= ({ to, label, feature, testId }) => {\n    const { getSelectedHero } = useHeroStore();\n    const hero = getSelectedHero();\n    if (!feature) return <Link to={to} className={navLinkClass(to)} data-testid={testId}>{label}</Link>;\n    const status = useProgressionStore.getState().getGateStatus(feature, hero);\n    if (status.enabled) return <Link to={to} className={navLinkClass(to)} data-testid={testId}>{label}</Link>;\n    return (\n      <span title={`${status.reason || 'Bloqueado'}  ${status.nextHint || ''}`} className=\"opacity-60 cursor-not-allowed px-2 py-1 rounded\">\n         {label}\n      </span>\n    );\n  };\n\n  const DungeonNavLink: React.FC = () => {\n    const { getSelectedHero } = useHeroStore();\n    const hero = getSelectedHero();\n    if (!hero) return <Link to=\"/dungeon-infinita\" className={navLinkClass('/dungeon-infinita')}> Dungeon Infinita</Link>;\n    const rank = (hero.rankData?.currentRank) || rankSystem.calculateRank(hero);\n    const allowed = ['C','B','A','S','SS','SSS'].includes(rank);\n    if (!allowed) {\n      return <span title={`Requer rank C  Rank atual ${rank}`} className=\"opacity-60 cursor-not-allowed px-2 py-1 rounded\">  Dungeon Infinita</span>;\n    }\n    return <Link to=\"/dungeon-infinita\" className={navLinkClass('/dungeon-infinita')}> Dungeon Infinita</Link>;\n  }\n\n  const groupButtonClass = (active: boolean) => {\n    const g = getSeasonalButtonGradient(useMonetizationStore.getState().activeSeasonalTheme as any);\n    return active\n      ? `px-2 py-1 rounded bg-gradient-to-r ${g} text-white font-semibold hover:brightness-110 transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`\n      : `px-2 py-1 rounded hover:text-amber-400 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`;\n  };\n\n  const isAnyActive = (paths: string[]) => paths.some(p => isActive(p));\n\n  const themeBg = activeThemeId === 'futurista'\n    ? 'bg-gradient-to-br from-gray-900 via-cyan-900 to-black'\n    : activeThemeId === 'noir'\n      ? 'bg-gradient-to-br from-black via-slate-900 to-black'\n      : 'bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900';\n  return (\n    <div className={`min-h-screen ${themeBg} text-white`}>\n      <header className=\"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 shadow-2xl shadow-amber-500/20\">\n        <div className=\"container mx-auto px-3 md:px-4 py-3 md:py-4\">\n          <div className=\"flex justify-between items-center\">\n            <Link to=\"/journey\" className=\"text-xl md:text-2xl font-bold text-amber-400 font-serif focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 rounded\">\n              {medievalTheme.icons.ui.guild} Forjador de Heris\n            </Link>\n            <div className=\"flex items-center space-x-2 md:space-x-4\">\n              <GoogleLoginButton />\n              {installAvailable && (\n                <button\n                  onClick={async () => {\n                    try { trackMetric.featureUsedData('system', 'pwa-install-click', { device: navigator.userAgent }); } catch {}\n                    if (!installPrompt) return;\n                    const r = await installPrompt.prompt();\n                    const outcome = r?.outcome || 'dismissed';\n                    try { trackMetric.featureUsedData('system', outcome === 'accepted' ? 'pwa-install-accepted' : 'pwa-install-dismissed', { device: navigator.userAgent }); } catch {}\n                    setInstallAvailable(false);\n                    setInstallPrompt(null);\n                  }}\n                  className={`px-2 py-1 rounded text-xs bg-gradient-to-r ${getSeasonalButtonGradient(useMonetizationStore.getState().activeSeasonalTheme as any)} text-white hover:brightness-110`}\n                  title=\"Instalar o app\"\n                >\n                   Instalar\n                </button>\n              )}\n              {!installAvailable && (() => {\n                const ua = navigator.userAgent || ''\n                const isIOS = /iPhone|iPad|iPod/i.test(ua)\n                const isStandalone = (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || (window.navigator as any).standalone\n                if (isIOS && !isStandalone) {\n                  return (\n                    <div className=\"relative ml-2\">\n                      <button\n                        onClick={() => { setIosTipOpen(v => !v); try { trackMetric.featureUsedData('system', 'pwa-ios-tip-toggle', { open: !iosTipOpen }); } catch {} }}\n                        className={`px-2 py-1 rounded text-xs bg-gradient-to-r ${getSeasonalButtonGradient(useMonetizationStore.getState().activeSeasonalTheme as any)} text-white hover:brightness-110`}\n                        title=\"Como instalar no iOS\"\n                      >\n                         Instalar no iOS\n                      </button>\n                      {iosTipOpen && (\n                        <div className=\"absolute right-0 mt-2 w-64 bg-slate-800 border border-slate-600 rounded p-3 text-xs text-gray-200\">\n                          <div className=\"font-semibold mb-1\">Adicionar  Tela de Incio</div>\n                          <div className=\"space-y-1\">\n                            <div>1) Toque em Compartilhar</div>\n                            <div>2) Selecione Adicionar  Tela de Incio</div>\n                            <div>3) Confirme Adicionar</div>\n                          </div>\n                          <button onClick={() => { setIosTipOpen(false); try { trackMetric.featureUsed('system', 'pwa-ios-tip-close'); } catch {} }} className=\"mt-2 px-2 py-1 bg-gray-700 rounded\">Fechar</button>\n                        </div>\n                      )}\n                    </div>\n                  )\n                }\n                return null\n              })()}\n              <div className=\"hidden md:flex items-center gap-2 ml-2\">\n                <GatedLink to=\"/journey\" label=\"Jornada\" />\n                <GatedLink to=\"/shop\" label=\"Loja\" feature=\"shop_basic\" />\n                <GatedLink to=\"/premium\" label=\"Premium\" />\n              </div>\n              \n            </div>\n            \n            {/* Heri Selecionado */}\n            {selectedHero && (\n              <div className=\"hidden md:flex items-center space-x-3 bg-slate-800 border border-amber-400 px-4 py-2 rounded-lg\">\n                <span className=\"text-2xl\">{selectedHero.avatar}</span>\n                <div>\n                  <div className=\"text-sm font-medium flex items-center space-x-2\">\n                    <span>{selectedHero.name}</span>\n                    {(() => {\n                      const medal = (selectedHero.stats as any)?.profileMedal;\n                      const valid = medal?.expiresAt ? Date.now() < new Date(medal.expiresAt).getTime() : false;\n                      return valid ? (\n                        <span className=\"text-amber-400 text-xs flex items-center gap-1\">\n                          {medal.icon} {medal.name}\n                        </span>\n                      ) : null;\n                    })()}\n                    {selectedHero.activeTitle && selectedHero.titles.find(t => t.id === selectedHero.activeTitle) && (\n                      <span className=\"text-amber-400 text-xs\">\n                        {selectedHero.titles.find(t => t.id === selectedHero.activeTitle)?.badge} \n                        {selectedHero.titles.find(t => t.id === selectedHero.activeTitle)?.name}\n                      </span>\n                    )}\n                  </div>\n                  <div className=\"text-xs text-amber-600\">\n                    {getClassIcon(selectedHero.class)} {selectedHero.class}  Nvel {selectedHero.progression.level}\n                  </div>\n                </div>\n              </div>\n            )}\n            </div>\n          \n          {/* Banner de status do Supabase */}\n          {!supabaseConfigured && (\n            <div className=\"mt-3 bg-amber-900/30 border border-amber-500/40 text-amber-200 text-xs md:text-sm px-3 py-2 rounded\">\n              Modo offline: configure `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY` para sincronizar.\n            </div>\n          )}\n\n          <nav className=\"mt-3 md:mt-4 overflow-visible\">\n            <div className=\"flex w-full justify-between items-center\">\n              <div className=\"flex gap-2 sm:gap-3 md:gap-6 items-center flex-wrap overflow-visible\">\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setOpenGroup(openGroup === 'aventura' ? null : 'aventura')}\n                    className={`${groupButtonClass(isAnyActive(['/journey','/create','/gallery','/dungeon-infinita']))} text-sm md:text-base`}\n                  >\n                     Aventura\n                  </button>\n                  {openGroup === 'aventura' && (\n                    <div className=\"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2\">\n                      <ul className=\"space-y-1 text-sm\">\n                        <li><GatedLink to=\"/journey\" label=\" Incio\" /></li>\n                        <li><Link to={(() => { const p = new URLSearchParams(location.search); const ref = p.get('ref'); const by = p.get('by'); return ref ? `/create?ref=${ref}${by?`&by=${by}`:''}` : \"/create\"; })()} className={navLinkClass('/create')}>{medievalTheme.icons.ui.profile} Criar Heri</Link></li>\n                        <li><Link to=\"/gallery\" className={navLinkClass('/gallery')}>{medievalTheme.icons.ui.inventory} Ver Galeria</Link></li>\n                        <li><DungeonNavLink /></li>\n                        {/* Arena de Duelos removida */}\n                      </ul>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setOpenGroup(openGroup === 'gestao' ? null : 'gestao')}\n                    className={`${groupButtonClass(isAnyActive(['/inventory','/stable','/hero-forge']))} text-sm md:text-base`}\n                  >\n                     Gesto\n                  </button>\n                  {openGroup === 'gestao' && (\n                    <div className=\"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2\">\n                      <ul className=\"space-y-1 text-sm\">\n                        <li><GatedLink to=\"/inventory\" label=\" Inventrio\" feature=\"hunting_basic\" /></li>\n                        <li><GatedLink to=\"/stable\" label=\" Estbulo\" feature=\"stable_basic\" /></li>\n                        <li><GatedLink to=\"/hero-forge\" label=\" Forja\" feature=\"crafting_simple\" /></li>\n                      </ul>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setOpenGroup(openGroup === 'comunidade' ? null : 'comunidade')}\n                    className={`${groupButtonClass(isAnyActive(['/guild-hub','/tavern']))} text-sm md:text-base`}\n                  >\n                     Comunidade\n                  </button>\n                  {openGroup === 'comunidade' && (\n                    <div className=\"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2\">\n                      <ul className=\"space-y-1 text-sm\">\n                        <li><Link to=\"/guild-hub\" className={navLinkClass('/guild-hub')}> Guilda dos Aventureiros</Link></li>\n                        <li><Link to=\"/tavern\" className={navLinkClass('/tavern')}> Taverna</Link></li>\n                      </ul>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setOpenGroup(openGroup === 'conta' ? null : 'conta')}\n                    className={`${groupButtonClass(isAnyActive(['/metrics']))} text-sm md:text-base`}\n                  >\n                     Conta\n                  </button>\n                  {openGroup === 'conta' && (\n                    <div className=\"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2\">\n                      <ul className=\"space-y-1 text-sm\">\n                        <li><Link to=\"/metrics\" className={navLinkClass('/metrics')}> Mtricas</Link></li>\n                        {import.meta.env.DEV && (<li><Link to=\"/admin\" className={navLinkClass('/admin')}> Admin</Link></li>)}\n                      </ul>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {currentIdx >= FLOW_STEPS.length - 1 && (\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setOpenGroup(openGroup === 'extras' ? null : 'extras')}\n                    className={`${groupButtonClass(isAnyActive(['/leaderboards','/shop','/premium','/organizer','/events-history']))} text-sm md:text-base`}\n                  >\n                     Extras\n                  </button>\n                  {openGroup === 'extras' && (\n                    <div className=\"absolute right-0 z-40 mt-2 w-64 bg-slate-800 border border-slate-600 rounded shadow-lg p-2\">\n                      <ul className=\"space-y-1 text-sm\">\n                        <li><GatedLink to=\"/leaderboards\" label={`${medievalTheme.icons.ui.leaderboard} Ranking`} /></li>\n                        <li><GatedLink to=\"/shop\" label=\" Loja\" feature=\"shop_basic\" /></li>\n                        <li><Link to=\"/premium\" className={navLinkClass('/premium')}> Premium</Link></li>\n                        <li><Link to={organizerNearCount > 0 ? \"/organizer?nearFull=1\" : \"/organizer\"} title=\"Eventos quase lotados no seu painel\" className={navLinkClass('/organizer')}> Organizador {organizerNearCount > 0 && (<span className=\"ml-1 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] rounded bg-red-600 text-white\">{organizerNearCount}</span>)}</Link></li>\n                        <li><Link to=\"/events-history\" className={navLinkClass('/events-history')}> Histrico</Link></li>\n                      </ul>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </nav>\n          <React.Suspense fallback={null}>\n            <SeasonalDecorLazy />\n          </React.Suspense>\n          {/* Minibarra de progresso e controles do fluxo removidos quando no h heri criado */}\n        </div>\n      </header>\n      \n      <main className=\"container mx-auto py-6 md:py-8 px-3 md:px-4\">\n        {/* Banner Ad Top */}\n        <div className=\"mb-4\">\n          <React.Suspense fallback={null}>\n            <AdBannerLazy style={{ display: 'block', minHeight: 60 }} />\n          </React.Suspense>\n        </div>\n        {/* Banner de convite removido */}\n        <Outlet />\n      </main>\n\n      <OnboardingOverlay />\n      \n      {/* Enhanced HUD - show/hide with toggle */}\n      {selectedHero && hudVisible && (\n        <React.Suspense fallback={null}>\n          <EnhancedHUDLazy hero={selectedHero} />\n        </React.Suspense>\n      )}\n\n      {/* HUD Toggle Button */}\n      {selectedHero && (\n        <button\n          aria-label={hudVisible ? 'Ocultar HUD' : 'Mostrar HUD'}\n          title={hudVisible ? 'Ocultar HUD' : 'Mostrar HUD'}\n          onClick={() => setHudVisible(v => !v)}\n          className={`fixed bottom-[calc(1rem+var(--safe-bottom))] right-4 z-50 px-3 py-2 rounded-full shadow-lg transition-colors text-xs sm:text-sm md:text-base max-w-[80vw]\n            ${hudVisible ? 'bg-gray-800 text-gray-200 hover:bg-gray-700' : 'bg-amber-600 text-white hover:bg-amber-700'} focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`}\n        >\n          {hudVisible ? 'Ocultar Painel' : 'Mostrar Painel'}\n        </button>\n      )}\n      \n      {/* Notification System */}\n      <NotificationSystem \n        notifications={notifications} \n        onRemove={removeNotification} \n      />\n      \n      {/* Quick Navigation */}\n      <React.Suspense fallback={null}>\n        <QuickNavigationLazy />\n      </React.Suspense>\n      \n      <footer className=\"bg-gray-800 py-6 mt-10 md:mt-12\">\n        <div className=\"container mx-auto px-3 md:px-4 text-center text-gray-400 text-sm md:text-base\">\n          <p>&copy; {new Date().getFullYear()} Forjador de Heris - Criado com React, TypeScript e Zustand</p>\n        </div>\n      </footer>\n      {/* Interstitial Ad mount */}\n      <React.Suspense fallback={null}>\n        <InterstitialAdLazy />\n      </React.Suspense>\n    </div>\n  );\n};\n\nexport default Layout;\n","// Simple persistent image cache using localStorage\n// Stores entries keyed by prompt. Each entry has url, expiresAt, and source.\n\ntype ImageCacheEntry = {\n  url: string;\n  expiresAt: number;\n  source?: 'lexica' | 'pollinations' | 'hf' | 'other';\n};\n\nconst STORAGE_KEY = 'hero-forge-image-cache-v2';\n\nfunction loadStore(): Record<string, ImageCacheEntry> {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) return {};\n    const obj = JSON.parse(raw);\n    if (obj && typeof obj === 'object') return obj as Record<string, ImageCacheEntry>;\n    return {};\n  } catch {\n    return {};\n  }\n}\n\nfunction saveStore(store: Record<string, ImageCacheEntry>) {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(store));\n  } catch {\n    // ignore quota errors\n  }\n}\n\nexport function getCachedImage(prompt: string): string | null {\n  const store = loadStore();\n  const entry = store[prompt];\n  if (!entry) return null;\n  if (Date.now() > entry.expiresAt) {\n    delete store[prompt];\n    saveStore(store);\n    return null;\n  }\n  const url = entry.url || '';\n  if (typeof url === 'string' && url.includes('pollinations.ai')) {\n    return `/api/pollinations-image?prompt=${encodeURIComponent(prompt)}&width=512&height=512`;\n  }\n  return url;\n}\n\nexport function setCachedImage(prompt: string, url: string, ttlMs: number, source?: ImageCacheEntry['source']) {\n  if (typeof url !== 'string') return;\n  if (url.startsWith('data:')) return;\n  const store = loadStore();\n  store[prompt] = {\n    url,\n    expiresAt: Date.now() + Math.max(ttlMs, 60_000),\n    source: source || 'other'\n  };\n  saveStore(store);\n}\n\nexport function purgeExpiredCache() {\n  const store = loadStore();\n  let changed = false;\n  for (const key of Object.keys(store)) {\n    if (Date.now() > store[key].expiresAt) {\n      delete store[key];\n      changed = true;\n    }\n  }\n  if (changed) saveStore(store);\n}\n","import React, { useMemo, useState, useEffect } from 'react';\nimport type { Hero, HeroClass, Element } from '../types/hero';\nimport { getRankIcon } from '../styles/medievalTheme';\nimport { useHeroStore } from '../store/heroStore';\nimport { useGameSettingsStore } from '../store/gameSettingsStore';\nimport { Eye, Star, Sword, Wand2, Target, Heart, UserX, Crown, Edit, Camera } from 'lucide-react';\nimport { getElementInfoSafe } from '../utils/elementSystem';\nimport { getCachedImage, setCachedImage } from '../utils/imageCache';\n\ninterface HeroGalleryCardProps {\n  hero: Hero;\n  onClick?: () => void;\n  showDetails?: boolean;\n  size?: 'small' | 'medium' | 'large';\n  onEdit?: (hero: Hero) => void;\n  onImageChange?: (hero: Hero) => void;\n  onDelete?: () => void;\n  index?: number;\n}\n\n// Mapeamento de classes para cones (parcial  fallback aplicado no uso)\nconst CLASS_ICONS: Partial<Record<HeroClass, React.ReactNode>> = {\n  guerreiro: <Sword className=\"w-4 h-4\" />,\n  mago: <Wand2 className=\"w-4 h-4\" />,\n  ladino: <UserX className=\"w-4 h-4\" />,\n  clerigo: <Heart className=\"w-4 h-4\" />,\n  patrulheiro: <Target className=\"w-4 h-4\" />,\n  paladino: <Crown className=\"w-4 h-4\" />,\n  arqueiro: <Target className=\"w-4 h-4\" />,\n  bardo: <Star className=\"w-4 h-4\" />,\n  monge: <Heart className=\"w-4 h-4\" />,\n  assassino: <UserX className=\"w-4 h-4\" />,\n  barbaro: <Sword className=\"w-4 h-4\" />,\n  lanceiro: <Sword className=\"w-4 h-4\" />,\n  druida: <Heart className=\"w-4 h-4\" />,\n  feiticeiro: <Wand2 className=\"w-4 h-4\" />\n};\n\n// Gradientes baseados nos elementos\nconst ELEMENT_GRADIENTS: Record<Element, string> = {\n  fire: 'from-red-900/20 via-orange-800/30 to-yellow-700/20',\n  water: 'from-blue-900/20 via-cyan-800/30 to-blue-700/20',\n  earth: 'from-green-900/20 via-stone-800/30 to-green-700/20',\n  air: 'from-slate-900/20 via-sky-800/30 to-slate-700/20',\n  thunder: 'from-purple-900/20 via-yellow-800/30 to-blue-700/20',\n  light: 'from-yellow-900/20 via-white/30 to-yellow-700/20',\n  dark: 'from-purple-900/20 via-gray-800/30 to-black/20',\n  physical: 'from-gray-900/20 via-slate-800/30 to-gray-700/20'\n};\n\n// Cores dos elementos para bordas e acentos\nconst ELEMENT_COLORS: Record<Element, string> = {\n  fire: 'border-red-500/50 shadow-red-500/20',\n  water: 'border-blue-500/50 shadow-blue-500/20',\n  earth: 'border-green-500/50 shadow-green-500/20',\n  air: 'border-sky-500/50 shadow-sky-500/20',\n  thunder: 'border-yellow-500/50 shadow-yellow-500/20',\n  light: 'border-yellow-400/50 shadow-yellow-400/20',\n  dark: 'border-purple-500/50 shadow-purple-500/20',\n  physical: 'border-gray-500/50 shadow-gray-500/20'\n};\n\nexport const HeroGalleryCard: React.FC<HeroGalleryCardProps> = ({\n  hero,\n  onClick,\n  showDetails = true,\n  size = 'medium',\n  onEdit,\n  onImageChange,\n  onDelete,\n  index\n}) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [imageError, setImageError] = useState(false);\n  const { selectHero, getSelectedHero, updateHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const isNPC = hero.origin === 'npc';\n  const perf = useGameSettingsStore(s => ({ rm: s.reducedMotionEnabled, sd: s.saveDataEnabled, net: s.networkEffectiveType }));\n  const allowAnimations = !perf.rm && !perf.sd && (perf.net === '4g' || perf.net === 'unknown');\n\n  // Define variveis usadas no JSX\n  const isSelected = selectedHero?.id === hero.id;\n  const elementInfo = getElementInfoSafe(hero.element);\n  // Tamanhos baseados na prop size\n  const sizeClasses = {\n    small: 'w-full max-w-[12rem] sm:max-w-[12rem] md:max-w-[14rem] aspect-[4/5]',\n    medium: 'w-full max-w-[14rem] md:max-w-[16rem] aspect-[4/5]',\n    large: 'w-full max-w-[16rem] lg:max-w-[18rem] aspect-[4/5]'\n  };\n\n  const handleCardClick = () => {\n    if (isNPC) return;\n    selectHero(hero.id);\n    onClick?.();\n  };\n\n  const imageSrc = useMemo(() => {\n    const raw = hero.image || '';\n    const isPoll = raw.includes('image.pollinations.ai/prompt/') || raw.includes('/api/pollinations-image?prompt=');\n    if (!isPoll) return raw;\n    const prompt = (() => {\n      try {\n        if (raw.includes('image.pollinations.ai/prompt/')) {\n          const p = raw.split('image.pollinations.ai/prompt/')[1];\n          return decodeURIComponent(p.split('?')[0] || '');\n        }\n        if (raw.includes('/api/pollinations-image?prompt=')) {\n          const q = new URL(raw, window.location.origin);\n          return decodeURIComponent(q.searchParams.get('prompt') || '');\n        }\n      } catch {}\n      return '';\n    })();\n    if (prompt) {\n      const cached = getCachedImage(prompt);\n      if (cached) return cached;\n      return `/api/pollinations-image?prompt=${encodeURIComponent(prompt)}&width=512&height=512`;\n    }\n    return raw;\n  }, [hero.image]);\n\n  const onImgLoad = () => {\n    try {\n      const raw = hero.image || '';\n      const isPoll = raw.includes('image.pollinations.ai/prompt/') || raw.includes('/api/pollinations-image?prompt=');\n      if (!isPoll) return;\n      const prompt = (() => {\n        try {\n          if (raw.includes('image.pollinations.ai/prompt/')) {\n            const p = raw.split('image.pollinations.ai/prompt/')[1];\n            return decodeURIComponent(p.split('?')[0] || '');\n          }\n          if (raw.includes('/api/pollinations-image?prompt=')) {\n            const q = new URL(raw, window.location.origin);\n            return decodeURIComponent(q.searchParams.get('prompt') || '');\n          }\n        } catch {}\n        return '';\n      })();\n      if (prompt) setCachedImage(prompt, imageSrc, 86_400_000, 'pollinations');\n    } catch {}\n  };\n\n  // Fallback: se a imagem do Pollinations falhar, tenta gerar via /api/gerar-imagem com o mesmo prompt\n  useEffect(() => {\n    if (!imageError) return;\n    (async () => {\n      try {\n        const raw = hero.image || '';\n        let prompt = '';\n        if (raw.includes('image.pollinations.ai/prompt/')) {\n          try { prompt = decodeURIComponent(raw.split('image.pollinations.ai/prompt/')[1].split('?')[0] || ''); } catch {}\n        } else if (raw.includes('/api/pollinations-image?prompt=')) {\n          try { const q = new URL(raw, window.location.origin); prompt = decodeURIComponent(q.searchParams.get('prompt') || ''); } catch {}\n        }\n        if (!prompt) {\n          const genderTag = (hero as any).gender === 'feminino' ? 'female' : 'male';\n          prompt = `${hero.name || 'Hero'}, ${genderTag} ${hero.race} ${hero.class}, epic fantasy portrait, detailed, studio lighting`;\n        }\n        const resp = await fetch('/api/gerar-imagem', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt }) });\n        if (resp.ok) {\n          const data = await resp.json();\n          const img = data?.imagem || '';\n          if (img) updateHero(hero.id, { image: img });\n        }\n      } catch {}\n    })();\n  }, [imageError]);\n\n  \n\n  const imageSrcSet = useMemo(() => {\n    try {\n      const raw = hero.image || '';\n      const isPoll = raw.includes('image.pollinations.ai/prompt/') || raw.includes('/api/pollinations-image?prompt=');\n      if (!isPoll) return undefined as any;\n      const prompt = (() => {\n        try {\n          if (raw.includes('image.pollinations.ai/prompt/')) {\n            const p = raw.split('image.pollinations.ai/prompt/')[1];\n            return decodeURIComponent(p.split('?')[0] || '');\n          }\n          if (raw.includes('/api/pollinations-image?prompt=')) {\n            const q = new URL(raw, window.location.origin);\n            return decodeURIComponent(q.searchParams.get('prompt') || '');\n          }\n        } catch {}\n        return '';\n      })();\n      if (!prompt) return undefined as any;\n      const w256 = `/api/pollinations-image?prompt=${encodeURIComponent(prompt)}&width=256&height=256`;\n      const w384 = `/api/pollinations-image?prompt=${encodeURIComponent(prompt)}&width=384&height=384`;\n      const w512 = `/api/pollinations-image?prompt=${encodeURIComponent(prompt)}&width=512&height=512`;\n      return `${w256} 256w, ${w384} 384w, ${w512} 512w`;\n    } catch { return undefined as any; }\n  }, [hero.image]);\n\n  \n\n  return (\n    <div\n      className={`\n        ${sizeClasses[size]}\n        relative group cursor-pointer\n        transform transition-all duration-300 ease-out\n        ${isHovered && allowAnimations ? 'scale-105 -translate-y-2' : ''}\n        ${isSelected ? 'ring-2 ring-yellow-400 ring-opacity-60' : ''}\n        ${(() => { const mount = (hero.mounts||[]).find(m=>m.id===hero.activeMountId); return mount?.stage==='lendaria' ? 'shadow-[0_0_15px_#F59E0B] ring-2 ring-amber-400' : mount?.stage==='encantada' ? 'shadow-[0_0_10px_#8B5CF6] ring-2 ring-purple-400/60' : '' })()}\n      `}\n      style={{ contentVisibility: 'auto', containIntrinsicSize: '320px 400px', willChange: 'transform' } as any}\n      onMouseEnter={() => { setIsHovered(true); try { import('./HeroDetail'); } catch {} }}\n      onFocus={() => { setIsHovered(true); try { import('./HeroDetail'); } catch {} }}\n      onMouseLeave={() => setIsHovered(false)}\n      onBlur={() => setIsHovered(false)}\n      onClick={handleCardClick}\n      role=\"button\"\n      aria-roledescription=\"Carto de heri\"\n      aria-label={`Abrir detalhes de ${hero.name}`}\n      aria-selected={isSelected}\n      tabIndex={0}\n      data-hero-card=\"1\"\n      data-hero-id={hero.id}\n      data-index={typeof index==='number'?index:undefined}\n      onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleCardClick(); } }}\n    >\n      {/* Moldura Externa com Runas */}\n      <div className={`\n        absolute inset-0 rounded-lg\n        bg-gradient-to-br from-yellow-600/20 via-amber-700/30 to-yellow-800/20\n        border-2 ${ELEMENT_COLORS[hero.element]}\n        shadow-lg ${isHovered ? 'shadow-xl shadow-yellow-500/30' : ''}\n        transition-all duration-300\n      `}>\n        {/* Runas nos Cantos */}\n        <div className=\"absolute top-2 left-2 text-yellow-400/60 text-xs\"></div>\n        <div className=\"absolute top-2 right-2 text-yellow-400/60 text-xs\"></div>\n        <div className=\"absolute bottom-2 left-2 text-yellow-400/60 text-xs\"></div>\n        <div className=\"absolute bottom-2 right-2 text-yellow-400/60 text-xs\"></div>\n      </div>\n\n      {/* Fundo de Pergaminho com Efeito Elemental */}\n      <div className={`\n        absolute inset-1 rounded-md\n        bg-gradient-to-br ${ELEMENT_GRADIENTS[hero.element]}\n        backdrop-blur-sm\n      `}>\n        {/* Textura de Pergaminho */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-amber-50/10 via-yellow-100/5 to-amber-200/10 rounded-md\" />\n        \n        {/* Partculas Mgicas */}\n        {isHovered && allowAnimations && (\n          <div className=\"absolute inset-0 overflow-hidden rounded-md\">\n            <div className=\"absolute top-1/4 left-1/4 w-1 h-1 bg-yellow-400 rounded-full animate-pulse opacity-60\" />\n            <div className=\"absolute top-1/3 right-1/3 w-1 h-1 bg-yellow-400 rounded-full animate-pulse opacity-40 animation-delay-300\" />\n            <div className=\"absolute bottom-1/4 left-1/3 w-1 h-1 bg-yellow-400 rounded-full animate-pulse opacity-50 animation-delay-600\" />\n          </div>\n        )}\n      </div>\n\n      {/* rea do Retrato */}\n      <div className=\"relative h-3/4 p-3\">\n        <div className=\"relative h-full rounded-md overflow-hidden\">\n          {/* Placeholder ou Imagem do Heri */}\n          {hero.image && !imageError ? (\n            <img\n              src={imageSrc}\n              srcSet={imageSrcSet}\n              alt={`${hero.name}  ${hero.class}  ${hero.race}`}\n              className=\"w-full h-full object-cover\"\n              loading=\"lazy\"\n              decoding=\"async\"\n              width={640}\n              height={800}\n              sizes=\"(min-width: 1280px) 18rem, (min-width: 768px) 16rem, 14rem\"\n              onLoad={onImgLoad}\n              onError={() => setImageError(true)}\n            />\n          ) : (\n            <div className={`\n              w-full h-full flex items-center justify-center\n              bg-gradient-to-br ${ELEMENT_GRADIENTS[hero.element]}\n              text-4xl sm:text-6xl\n            `}>\n              {CLASS_ICONS[hero.class] || ''}\n            </div>\n          )}\n\n          {/* Brilho Mgico ao Redor do Personagem */}\n          <div className={`\n            absolute inset-0 \n            bg-gradient-to-t from-transparent via-transparent to-yellow-400/10\n            ${isHovered && allowAnimations ? 'opacity-100' : 'opacity-0'}\n            transition-opacity duration-300\n          `} />\n\n          {/* Rank Badge no Canto Superior Direito */}\n          <div className=\"absolute top-2 right-2\">\n            <div className=\"bg-black/50 backdrop-blur-sm rounded-full px-2 py-1 text-xs text-yellow-400 font-bold\">\n              {getRankIcon((hero as any)?.rankData?.currentRank || 'F')} {(hero as any)?.rankData?.currentRank || 'F'}\n            </div>\n          </div>\n\n          {/* Nvel no Canto Superior Esquerdo */}\n          <div className=\"absolute top-2 left-2\">\n            <div className=\"bg-black/50 backdrop-blur-sm rounded-full px-2 py-1 text-xs text-white font-bold\">\n              Nv. {hero.progression?.level || 1}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Painel de Informaes Inferior */}\n      <div className=\"absolute bottom-2 left-2 right-2 h-1/3 z-40\">\n        <div className=\"h-full bg-black/80 backdrop-blur-md rounded-md border border-yellow-500/30 p-3 flex flex-col justify-between shadow-lg\">\n          {/* Nome do Heri - rea Superior */}\n          <div className=\"flex-shrink-0\">\n            <h3 className=\"text-white font-bold text-lg truncate font-serif leading-tight drop-shadow-lg\" style={{ textShadow: '2px 2px 4px rgba(0,0,0,1)' }}>\n              {hero.name || 'Nome no definido'}\n            </h3>\n          </div>\n\n          {/* Informaes Inferiores */}\n          <div className=\"flex flex-col space-y-1 flex-shrink-0\">\n            {/* Classe e Elemento */}\n            <div className=\"flex items-center justify-between text-sm text-gray-300\">\n              <div className=\"flex items-center space-x-1 min-w-0 flex-1\">\n                {CLASS_ICONS[hero.class] ?? <Sword className=\"w-4 h-4\" />}\n                <span className=\"capitalize truncate\">{hero.class}</span>\n              </div>\n              <div className=\"flex items-center space-x-1 ml-2\">\n                <span className=\"text-base\">{elementInfo?.icon || ''}</span>\n              </div>\n            </div>\n\n            {/* Companheiros Ativos */}\n            {(hero.activePetId || hero.activeMountId) && (\n              <div className=\"flex items-center justify-between text-xs text-gray-300\">\n                <div className=\"flex items-center gap-2\">\n                  {hero.activePetId && (\n                    <span className=\"px-2 py-0.5 rounded bg-emerald-700/40 border border-emerald-600/50 text-emerald-200\"> {(hero.pets||[]).find(p=>p.id===hero.activePetId)?.name || 'Mascote'}</span>\n                  )}\n                  {hero.activeMountId && (\n                    <span className=\"px-2 py-0.5 rounded bg-purple-700/40 border border-purple-600/50 text-purple-200\"> {(hero.mounts||[]).find(m=>m.id===hero.activeMountId)?.stage || 'Montaria'} {(() => { const mount=(hero.mounts||[]).find(m=>m.id===hero.activeMountId); const r=mount?.rarity; return r==='lendario'?'':r==='epico'?'':r==='raro'?'':r==='incomum'?'':r==='comum'?'':''; })()}</span>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Raa e XP */}\n            <div className=\"flex items-center justify-between text-sm text-gray-400\">\n              <span className=\"capitalize truncate\">{hero.race}</span>\n              <span className=\"text-sm whitespace-nowrap\">{hero.progression?.xp || 0} XP</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Barra de Aes (aparece no hover) */}\n      {showDetails && isHovered && !isNPC && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-black/30 rounded-lg z-50\">\n          <div className=\"flex flex-col space-y-2\">\n            <button \n              onClick={(e) => {\n                e.stopPropagation();\n                onClick?.();\n              }}\n              className=\"bg-yellow-600 hover:bg-yellow-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-yellow-300\"\n              aria-label=\"Ver detalhes\"\n            >\n              <Eye className=\"w-3 h-3\" />\n              <span>Ver Detalhes</span>\n            </button>\n            \n            {onEdit && (\n              <button \n                onClick={(e) => {\n                  e.stopPropagation();\n                  onEdit(hero);\n                }}\n                className=\"bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300\"\n                aria-label=\"Editar heri\"\n              >\n                <Edit className=\"w-3 h-3\" />\n                <span>Editar</span>\n              </button>\n            )}\n            \n            {onImageChange && (\n              <button \n                onClick={(e) => {\n                  e.stopPropagation();\n                  onImageChange(hero);\n                }}\n                className=\"bg-purple-600 hover:bg-purple-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-300\"\n                aria-label=\"Trocar foto\"\n              >\n                <Camera className=\"w-3 h-3\" />\n                <span>Trocar Foto</span>\n              </button>\n            )}\n            {onDelete && (\n              <button\n                onClick={(e) => {\n                  e.stopPropagation();\n                  onDelete();\n                }}\n                className=\"bg-red-600 hover:bg-red-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-300\"\n                aria-label=\"Remover heri\"\n              >\n                <span>Remover</span>\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Indicador de Seleo */}\n      {isSelected && (\n        <div className=\"absolute -top-2 -right-2\">\n          <div className=\"bg-yellow-500 text-white rounded-full p-1\">\n            <Star className=\"w-4 h-4 fill-current\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default HeroGalleryCard;\n","import React, { useState, useMemo, useRef, useEffect, useCallback } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { Hero, HeroClass, Element } from '../types/hero';\nimport { HeroGalleryCard } from './HeroGalleryCard';\nimport { useHeroStore } from '../store/heroStore';\nimport { Search, Filter, Grid, List, Plus, ArrowUpDown, Trash2 } from 'lucide-react';\nconst GalleryLightbox = React.lazy(() => import('./GalleryLightbox'));\nimport { getUsed as getSlotsUsed, getCapacity as getSlotsCapacity, getNextSlotPrice } from '../services/heroSlots';\n\ninterface HeroGalleryProps {\n  onCreateHero?: () => void;\n  onHeroSelect?: (hero: Hero) => void;\n  onHeroEdit?: (hero: Hero) => void;\n  onHeroImageChange?: (hero: Hero) => void;\n  showCreateButton?: boolean;\n  cardSize?: 'small' | 'medium' | 'large';\n  viewMode?: 'grid' | 'list';\n}\n\nexport const HeroGallery: React.FC<HeroGalleryProps> = ({\n  onCreateHero,\n  onHeroSelect,\n  onHeroEdit,\n  onHeroImageChange,\n  showCreateButton = true,\n  cardSize = 'medium',\n  viewMode: initialViewMode = 'grid'\n}) => {\n  const heroes = useHeroStore(s => s.heroes);\n  const createHero = useHeroStore(s => s.createHero);\n  const deleteHero = useHeroStore(s => s.deleteHero);\n  const getSelectedHero = useHeroStore(s => s.getSelectedHero);\n  const purchaseHeroSlotForSelected = useHeroStore(s => s.purchaseHeroSlotForSelected);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [debouncedSearch, setDebouncedSearch] = useState('');\n  const [selectedClass, setSelectedClass] = useState<HeroClass | 'all'>('all');\n  const [selectedElement, setSelectedElement] = useState<Element | 'all'>('all');\n  const [selectedRace, setSelectedRace] = useState<string | 'all'>('all');\n  const [viewMode, setViewMode] = useState(initialViewMode);\n  const [showFilters, setShowFilters] = useState(false);\n  const [sortBy, setSortBy] = useState<'name' | 'level' | 'rank' | 'createdAt' | 'xp' | 'gold'>('name');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');\n  const [lightboxIndex, setLightboxIndex] = useState<number | null>(null);\n  const [promptHero, setPromptHero] = useState<Hero | null>(null);\n  const [promptText, setPromptText] = useState('');\n  const [generatingImg, setGeneratingImg] = useState(false);\n  \n  const prefetchRef = useRef<number>(0);\n  const listContainerRef = useRef<HTMLDivElement | null>(null);\n  \n  const [searchParams, setSearchParams] = useSearchParams();\n  const [confirmDeleteId, setConfirmDeleteId] = useState<string | null>(null);\n  const [isDeleting, setIsDeleting] = useState<boolean>(false);\n  const nonNpcHeroes = useMemo(() => heroes.filter((h: any) => h.origin !== 'npc'), [heroes]);\n  const slotsUsed = useMemo(() => getSlotsUsed(nonNpcHeroes), [nonNpcHeroes]);\n  const slotsCap = useMemo(() => getSlotsCapacity(nonNpcHeroes), [nonNpcHeroes]);\n  const canCreate = slotsUsed < slotsCap;\n  const nextPrice = useMemo(() => getNextSlotPrice(), [heroes]);\n  const uniqueRaces = useMemo(() => Array.from(new Set(heroes.map(h => h.race))).sort(), [heroes]);\n\n  // Filtrar heris baseado nos critrios\n  const filteredHeroes = useMemo(() => {\n    return heroes.filter(hero => {\n      if (hero.origin === 'npc') return false;\n      const q = debouncedSearch.toLowerCase();\n      const matchesSearch = hero.name.toLowerCase().includes(q) ||\n                           hero.class.toLowerCase().includes(q) ||\n                           hero.race.toLowerCase().includes(q);\n      \n      const matchesClass = selectedClass === 'all' || hero.class === selectedClass;\n      const matchesElement = selectedElement === 'all' || hero.element === selectedElement;\n      const matchesRace = selectedRace === 'all' || hero.race === selectedRace;\n\n      return matchesSearch && matchesClass && matchesElement && matchesRace;\n    });\n  }, [heroes, debouncedSearch, selectedClass, selectedElement, selectedRace]);\n\n  const sortedHeroes = useMemo(() => {\n    const list = [...filteredHeroes];\n    list.sort((a, b) => {\n      let cmp = 0;\n      switch (sortBy) {\n        case 'name':\n          cmp = a.name.localeCompare(b.name);\n          break;\n        case 'level':\n          cmp = (a.progression?.level || 0) - (b.progression?.level || 0);\n          break;\n        case 'rank':\n          cmp = (a.progression?.rank || 'F').localeCompare(b.progression?.rank || 'F');\n          break;\n        case 'createdAt':\n          cmp = new Date(a.createdAt || 0).getTime() - new Date(b.createdAt || 0).getTime();\n          break;\n        case 'xp':\n          cmp = (a.progression?.xp || 0) - (b.progression?.xp || 0);\n          break;\n        case 'gold':\n          cmp = (a.progression?.gold || 0) - (b.progression?.gold || 0);\n          break;\n        default:\n          cmp = 0;\n      }\n      return sortOrder === 'asc' ? cmp : -cmp;\n    });\n    return list;\n  }, [filteredHeroes, sortBy, sortOrder]);\n\n  \n\n  \n  useEffect(() => {\n    const id = setTimeout(() => setDebouncedSearch(searchTerm), 200);\n    return () => clearTimeout(id);\n  }, [searchTerm]);\n\n  useEffect(() => {\n    try {\n      const qs = Object.fromEntries(searchParams);\n      const getStr = (k: string) => (typeof qs[k] === 'string' ? qs[k] : undefined);\n      const vm = getStr('vm'); if (vm) setViewMode(vm as any);\n      const sb = getStr('sb'); if (sb) setSortBy(sb as any);\n      const so = getStr('so'); if (so) setSortOrder(so as any);\n      const sc = getStr('sc'); if (sc) setSelectedClass(sc as any);\n      const se = getStr('se'); if (se) setSelectedElement(se as any);\n      const sr = getStr('sr'); if (sr) setSelectedRace(sr as any);\n      const q = getStr('q'); if (q) setSearchTerm(q);\n      if (!vm && !sb && !so && !sc && !se && !sr && !q) {\n        const raw = localStorage.getItem('gallery_prefs');\n        if (raw) {\n          const p = JSON.parse(raw);\n          if (p && typeof p === 'object') {\n            if (typeof p.viewMode === 'string') setViewMode(p.viewMode);\n            if (typeof p.sortBy === 'string') setSortBy(p.sortBy);\n            if (typeof p.sortOrder === 'string') setSortOrder(p.sortOrder);\n            if (typeof p.selectedClass === 'string') setSelectedClass(p.selectedClass);\n            if (typeof p.selectedElement === 'string') setSelectedElement(p.selectedElement);\n            if (typeof p.selectedRace === 'string') setSelectedRace(p.selectedRace);\n            if (typeof p.searchTerm === 'string') setSearchTerm(p.searchTerm);\n          }\n        }\n      }\n    } catch {}\n  }, []);\n\n  useEffect(() => {\n    try {\n      const p = { viewMode, sortBy, sortOrder, selectedClass, selectedElement, selectedRace, searchTerm };\n      localStorage.setItem('gallery_prefs', JSON.stringify(p));\n    } catch {}\n  }, [viewMode, sortBy, sortOrder, selectedClass, selectedElement, selectedRace, searchTerm]);\n\n  useEffect(() => {\n    try {\n      const params: Record<string, string> = {};\n      params.vm = String(viewMode);\n      params.sb = String(sortBy);\n      params.so = String(sortOrder);\n      if (selectedClass !== 'all') params.sc = String(selectedClass);\n      if (selectedElement !== 'all') params.se = String(selectedElement);\n      if (selectedRace !== 'all') params.sr = String(selectedRace);\n      if (searchTerm) params.q = String(searchTerm);\n      setSearchParams(params, { replace: true });\n    } catch {}\n  }, [viewMode, sortBy, sortOrder, selectedClass, selectedElement, selectedRace, searchTerm]);\n\n  useEffect(() => {\n    const start = prefetchRef.current;\n    const end = Math.min(sortedHeroes.length, start + 24);\n    for (let i = start; i < end; i++) {\n      const h = sortedHeroes[i];\n      if (!h?.image) continue;\n      try {\n        const raw = h.image;\n        const url = raw.includes('image.pollinations.ai/prompt/')\n          ? raw.replace('https://image.pollinations.ai/prompt/', '/api/pollinations-image?prompt=').replace('?n=1&','&')\n          : raw;\n        const img = new Image();\n        img.loading = 'lazy';\n        img.decoding = 'async';\n        img.src = url;\n      } catch {}\n    }\n    prefetchRef.current = end;\n  }, [sortedHeroes]);\n\n  const handleHeroClick = useCallback((hero: Hero) => {\n    const idx = sortedHeroes.findIndex(h => h.id === hero.id);\n    setLightboxIndex(idx >= 0 ? idx : null);\n    onHeroSelect?.(hero);\n  }, [sortedHeroes, onHeroSelect]);\n\n  const openPromptEditor = useCallback((hero: Hero) => {\n    try {\n      const genderTags = (hero as any).gender === 'feminino'\n        ? 'female, woman, heroine, feminine features, soft face, long hair, no beard'\n        : 'male, man, masculine features';\n      const base = `${genderTags}, ${hero.race} ${hero.class}, ${hero.name}, epic fantasy portrait, highly detailed, studio lighting`;\n      const story = (hero.backstory || '').slice(0, 140);\n      const withStory = story ? `${base}, theme: ${story}` : base;\n      setPromptHero(hero);\n      setPromptText(withStory);\n    } catch {\n      setPromptHero(hero);\n      setPromptText(`${hero.name}, ${hero.race} ${hero.class}, epic fantasy portrait`);\n    }\n  }, []);\n\n  const generateFromPrompt = useCallback(async () => {\n    if (!promptHero) return;\n    setGeneratingImg(true);\n    try {\n      const resp = await fetch('/api/gerar-imagem', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt: promptText }) });\n      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n      const data = await resp.json();\n      const img = data?.imagem || '';\n      if (img) {\n        useHeroStore.getState().updateHero(promptHero.id, { image: img });\n        (window as any).notificationBus?.emit?.({ type: 'item', title: 'Avatar atualizado', message: 'Imagem gerada com novo prompt.', icon: '', duration: 2500 });\n        setPromptHero(null);\n      }\n    } catch (err) {\n      (window as any).notificationBus?.emit?.({ type: 'quest', title: 'Falha ao gerar imagem', message: String((err as any)?.message || err || 'Erro'), icon: '', duration: 3500 });\n    } finally {\n      setGeneratingImg(false);\n    }\n  }, [promptHero, promptText]);\n\n  \n\n  const handleRemoveSelected = useCallback(() => {\n    const sel = getSelectedHero?.();\n    if (sel) deleteHero(sel.id);\n  }, [getSelectedHero, deleteHero]);\n\n  const gridClasses = {\n    small: 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5',\n    medium: 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5',\n    large: 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4'\n  };\n\n  const moveFocus = (delta: number) => {\n    try {\n      const nodes = Array.from(document.querySelectorAll('[data-hero-card=\"1\"]')) as HTMLElement[];\n      if (!nodes.length) return;\n      const active = document.activeElement as HTMLElement | null;\n      let idx = nodes.findIndex(n => n === active);\n      if (idx === -1) idx = 0;\n      const next = Math.max(0, Math.min(nodes.length - 1, idx + delta));\n      nodes[next]?.focus();\n    } catch {}\n  };\n\n    const onGridKeyDown: React.KeyboardEventHandler<HTMLDivElement> = (e) => {\n    if (e.key === 'ArrowRight') { e.preventDefault(); moveFocus(1); }\n    else if (e.key === 'ArrowLeft') { e.preventDefault(); moveFocus(-1); }\n    else if (e.key === 'Enter') { const el = document.activeElement as HTMLElement | null; el?.click(); }\n    else if (e.key === 'Escape') { setLightboxIndex(null); }\n    else if (e.key.toLowerCase() === 'f') { setShowFilters(s => !s); }\n    else if (e.key.toLowerCase() === 'v') { setViewMode(m => m === 'grid' ? 'list' : 'grid'); }\n    else if (e.key === 'Home') { e.preventDefault(); moveFocus(-9999); }\n    else if (e.key === 'End') { e.preventDefault(); moveFocus(9999); }\n    else if (e.key === 'PageDown') { window.scrollBy?.({ top: window.innerHeight, behavior: 'smooth' } as any); }\n    else if (e.key === 'PageUp') { window.scrollBy?.({ top: -window.innerHeight, behavior: 'smooth' } as any); }\n  };\n\n  return (\n    <div className=\"w-full space-y-6\">\n      {/* Cabealho com Controles */}\n      <div className=\"bg-gradient-to-r from-amber-900/20 to-yellow-800/20 backdrop-blur-sm rounded-lg border border-yellow-500/30 p-4\">\n        <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0\">\n          {/* Ttulo e Contador */}\n          <div className=\"flex items-center space-x-4\">\n            <h2 className=\"text-2xl font-bold text-yellow-400 font-serif\">\n              Galeria de Heris\n            </h2>\n            <span className=\"bg-yellow-600/20 text-yellow-300 px-3 py-1 rounded-full text-sm\" role=\"status\" aria-live=\"polite\" aria-atomic=\"true\">\n              {sortedHeroes.length} {sortedHeroes.length === 1 ? 'heri' : 'heris'}\n            </span>\n          </div>\n\n          {/* Controles */}\n          <div className=\"flex flex-wrap items-center gap-2\">\n            {/* Busca */}\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n              <input\n                type=\"text\"\n                placeholder=\"Buscar heris...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 pr-4 py-2 bg-black/30 border border-yellow-500/30 rounded-md text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400 w-40 sm:w-64\"\n              />\n            </div>\n\n            {/* Ordenao */}\n            <div className=\"flex items-center gap-2\">\n              <div className=\"relative\">\n                <ArrowUpDown className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                <select\n                  aria-label=\"Ordenar por\"\n                  value={sortBy}\n                  onChange={(e) => setSortBy(e.target.value as any)}\n                  className=\"pl-10 pr-8 py-2 bg-black/30 border border-yellow-500/30 rounded-md text-white focus:outline-none focus:border-yellow-400\"\n                >\n                  <option value=\"name\">Nome</option>\n                  <option value=\"level\">Nvel</option>\n                  <option value=\"rank\">Rank</option>\n                  <option value=\"createdAt\">Criado</option>\n                  <option value=\"xp\">XP</option>\n                  <option value=\"gold\">Ouro</option>\n                </select>\n              </div>\n              <button\n                aria-label=\"Alternar ordem\"\n                onClick={() => setSortOrder(o => o === 'asc' ? 'desc' : 'asc')}\n                className={`p-2 rounded-md border transition-colors ${sortOrder==='asc'?'bg-black/30 text-yellow-400 hover:bg-yellow-600/20':'bg-yellow-600 text-white'}`}\n              >\n                <ArrowUpDown className=\"w-4 h-4\" />\n              </button>\n            </div>\n\n            {/* Boto de Filtros */}\n            <button\n              onClick={() => setShowFilters(!showFilters)}\n              className={`p-2 rounded-md border transition-colors ${\n                showFilters \n                  ? 'bg-yellow-600 border-yellow-500 text-white' \n                  : 'bg-black/30 border-yellow-500/30 text-yellow-400 hover:bg-yellow-600/20'\n              }`}\n            >\n              <Filter className=\"w-4 h-4\" />\n            </button>\n\n            {/* Modo de Visualizao */}\n            <div className=\"flex border border-yellow-500/30 rounded-md overflow-hidden\">\n              <button\n                onClick={() => setViewMode('grid')}\n                className={`p-2 transition-colors ${\n                  viewMode === 'grid' \n                    ? 'bg-yellow-600 text-white' \n                    : 'bg-black/30 text-yellow-400 hover:bg-yellow-600/20'\n                }`}\n              >\n                <Grid className=\"w-4 h-4\" />\n              </button>\n              <button\n                onClick={() => setViewMode('list')}\n                className={`p-2 transition-colors ${\n                  viewMode === 'list' \n                    ? 'bg-yellow-600 text-white' \n                    : 'bg-black/30 text-yellow-400 hover:bg-yellow-600/20'\n                }`}\n              >\n                <List className=\"w-4 h-4\" />\n              </button>\n            </div>\n\n            {/* Boto Criar Heri e Slots */}\n            {showCreateButton && (\n              <button\n                onClick={onCreateHero}\n                disabled={!canCreate}\n                className={`${canCreate?'bg-yellow-600 hover:bg-yellow-500 text-white':'bg-gray-700 text-gray-300 cursor-not-allowed'} px-3 sm:px-4 py-2 rounded-md font-bold transition-colors flex items-center gap-2 text-sm sm:text-base w-full sm:w-auto`}\n              >\n                <Plus className=\"w-4 h-4\" />\n                <span>{canCreate?'Criar Heri':`Slots ${slotsUsed}/${slotsCap}`}</span>\n              </button>\n            )}\n            <div className=\"flex items-center gap-2\">\n            <span className=\"px-2 py-1 rounded bg-black/30 border border-yellow-500/30 text-yellow-300 text-xs\">Slots {slotsUsed}/{slotsCap}</span>\n            <button onClick={() => purchaseHeroSlotForSelected()} className=\"px-3 py-2 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm\">Comprar slot ({nextPrice})</button>\n          </div>\n\n            \n\n            \n            <button\n              onClick={handleRemoveSelected}\n              className=\"bg-red-600 hover:bg-red-500 text-white px-3 py-2 rounded-md font-bold transition-colors text-sm flex items-center gap-2\"\n            >\n              <Trash2 className=\"w-4 h-4\" />\n              Remover Selecionado\n            </button>\n          </div>\n        </div>\n\n        <div className=\"mt-3 flex flex-wrap items-center gap-2\">\n          {searchTerm && (\n            <button onClick={() => setSearchTerm('')} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\">Busca: \"{searchTerm}\" </button>\n          )}\n          {selectedClass !== 'all' && (\n            <button onClick={() => setSelectedClass('all')} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\">Classe: {selectedClass} </button>\n          )}\n          {selectedElement !== 'all' && (\n            <button onClick={() => setSelectedElement('all')} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\">Elemento: {selectedElement} </button>\n          )}\n          {selectedRace !== 'all' && (\n            <button onClick={() => setSelectedRace('all')} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\">Raa: {selectedRace} </button>\n          )}\n        </div>\n\n        {/* Filtros Expandidos */}\n        {showFilters && (\n          <div className=\"mt-4 pt-4 border-t border-yellow-500/30\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {/* Filtro por Classe */}\n              <div>\n                <label className=\"block text-sm font-medium text-yellow-300 mb-2\">\n                  Classe\n                </label>\n                <select\n                  value={selectedClass}\n                  onChange={(e) => setSelectedClass(e.target.value as HeroClass | 'all')}\n                  className=\"w-full bg-black/30 border border-yellow-500/30 rounded-md text-white p-2 focus:outline-none focus:border-yellow-400\"\n                >\n                  <option value=\"all\">Todas as Classes</option>\n                  <option value=\"guerreiro\">Guerreiro</option>\n                  <option value=\"mago\">Mago</option>\n                  <option value=\"ladino\">Ladino</option>\n                  <option value=\"clerigo\">Clrigo</option>\n                  <option value=\"patrulheiro\">Patrulheiro</option>\n                  <option value=\"paladino\">Paladino</option>\n                  <option value=\"arqueiro\">Arqueiro</option>\n                </select>\n              </div>\n\n              {/* Filtro por Elemento */}\n              <div>\n                <label className=\"block text-sm font-medium text-yellow-300 mb-2\">\n                  Elemento\n                </label>\n                <select\n                  value={selectedElement}\n                  onChange={(e) => setSelectedElement(e.target.value as Element | 'all')}\n                  className=\"w-full bg-black/30 border border-yellow-500/30 rounded-md text-white p-2 focus:outline-none focus:border-yellow-400\"\n                >\n                  <option value=\"all\">Todos os Elementos</option>\n                  <option value=\"fire\"> Fogo</option>\n                  <option value=\"ice\"> Gelo</option>\n                  <option value=\"thunder\"> Raio</option>\n                  <option value=\"earth\"> Terra</option>\n                  <option value=\"light\"> Luz</option>\n                  <option value=\"dark\"> Sombra</option>\n                  <option value=\"physical\"> Fsico</option>\n                </select>\n              </div>\n\n              {/* Filtro por Raa */}\n              <div>\n                <label className=\"block text-sm font-medium text-yellow-300 mb-2\">\n                  Raa\n                </label>\n                <select\n                  value={selectedRace}\n                  onChange={(e) => setSelectedRace(e.target.value as any)}\n                  className=\"w-full bg-black/30 border border-yellow-500/30 rounded-md text-white p-2 focus:outline-none focus:border-yellow-400\"\n                >\n                  <option value=\"all\">Todas as Raas</option>\n                  {uniqueRaces.map(r => (\n                    <option key={r} value={r}>{r}</option>\n                  ))}\n                </select>\n              </div>\n            </div>\n            <div className=\"mt-4 flex items-center gap-2\">\n              <button\n                onClick={() => { setSearchTerm(''); setSelectedClass('all'); setSelectedElement('all'); setSelectedRace('all'); }}\n                className=\"px-3 py-2 rounded bg-gray-700 text-white text-xs\"\n                aria-label=\"Resetar filtros\"\n              >Resetar filtros</button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Grid de Heris */}\n      {sortedHeroes.length > 0 ? (\n        <div ref={listContainerRef} className={`${viewMode === 'grid' ? `grid ${gridClasses[cardSize]} gap-4 sm:gap-6` : 'flex flex-col space-y-4'}`}\n          role=\"list\"\n          aria-label=\"Galeria de Heris\"\n          onKeyDown={onGridKeyDown}\n        >\n          {sortedHeroes.map((hero, idx) => (\n            <HeroGalleryCard\n              key={hero.id}\n              hero={hero}\n              onClick={() => handleHeroClick(hero)}\n              size={viewMode === 'list' ? 'small' : cardSize}\n              showDetails={true}\n              onEdit={onHeroEdit}\n              onImageChange={openPromptEditor}\n              onDelete={() => setConfirmDeleteId(hero.id)}\n              index={idx}\n            />\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <div className=\"text-4xl sm:text-6xl mb-4\"></div>\n          <h3 className=\"text-xl font-bold text-yellow-400 mb-2\">\n            Nenhum heri encontrado\n          </h3>\n          <p className=\"text-gray-400 mb-6\">\n            {searchTerm || selectedClass !== 'all' || selectedElement !== 'all'\n              ? 'Tente ajustar os filtros de busca.'\n              : 'Voc ainda no criou nenhum heri.'}\n          </p>\n          {showCreateButton && (\n            <button\n              onClick={onCreateHero}\n              className=\"bg-yellow-600 hover:bg-yellow-500 text-white px-6 py-3 rounded-md font-bold transition-colors flex items-center space-x-2 mx-auto\"\n            >\n              <Plus className=\"w-5 h-5\" />\n              <span>Criar Primeiro Heri</span>\n            </button>\n          )}\n        </div>\n      )}\n\n      \n      \n\n      {lightboxIndex !== null && (\n        <React.Suspense fallback={null}>\n          <GalleryLightbox\n            items={sortedHeroes}\n            index={lightboxIndex}\n            onClose={() => setLightboxIndex(null)}\n            onNavigate={(newIdx) => setLightboxIndex(Math.max(0, Math.min(newIdx, sortedHeroes.length - 1)))}\n          />\n        </React.Suspense>\n      )}\n      \n      {confirmDeleteId && (\n        <div className=\"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center\" role=\"dialog\" aria-modal=\"true\">\n          <div className=\"w-full max-w-md rounded-xl border border-yellow-500/30 bg-black/80 p-5 text-white\">\n            <div className=\"text-lg font-semibold mb-2\">Confirmar Excluso</div>\n            <div className=\"text-sm text-gray-300\">Tem certeza que deseja remover este heri da galeria?</div>\n            <div className=\"mt-4 flex gap-2\">\n              <button aria-busy={isDeleting} onClick={() => {\n                setIsDeleting(true);\n                setTimeout(() => {\n                  try { deleteHero(confirmDeleteId!); (window as any).notificationBus?.emit?.({ type: 'item', title: 'Heri removido', message: 'Personagem excludo da galeria.', icon: '', duration: 2500 }); } catch {}\n                  setIsDeleting(false);\n                  setConfirmDeleteId(null);\n                }, 600);\n              }} className={`px-3 py-2 rounded ${isDeleting ? 'bg-gray-700 cursor-wait' : 'bg-red-600 hover:bg-red-500'} text-white`}>{isDeleting ? 'Excluindo' : 'Confirmar'}</button>\n              <button onClick={() => setConfirmDeleteId(null)} className=\"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white\">Cancelar</button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {promptHero && (\n        <div className=\"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center\" role=\"dialog\" aria-modal=\"true\">\n          <div className=\"w-full max-w-lg rounded-xl border border-yellow-500/30 bg-black/80 p-5 text-white\">\n            <div className=\"text-lg font-semibold mb-2\">Editar Prompt de Imagem</div>\n            <div className=\"text-sm text-gray-300 mb-3\">Heri: {promptHero.name}  {promptHero.race} {promptHero.class}</div>\n            <textarea value={promptText} onChange={(e)=>setPromptText(e.target.value)} rows={4} className=\"w-full rounded-md bg-gray-700 border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500\" placeholder=\"Escreva o prompt para gerar o avatar\" />\n            <div className=\"mt-4 flex gap-2\">\n              <button onClick={generateFromPrompt} disabled={generatingImg || !promptText.trim()} className={`px-3 py-2 rounded ${generatingImg ? 'bg-gray-700 cursor-wait' : 'bg-purple-600 hover:bg-purple-500'} text-white`}>{generatingImg ? 'Gerando' : 'Gerar'}</button>\n              <button onClick={()=>setPromptHero(null)} className=\"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white\">Cancelar</button>\n              <label className=\"px-3 py-2 rounded bg-green-600 hover:bg-green-500 text-white cursor-pointer\">\n                Upload Foto\n                <input type=\"file\" accept=\"image/*\" className=\"hidden\" onChange={async (e)=>{\n                  try {\n                    const f = e.target.files?.[0]; if (!f) return;\n                    const reader = new FileReader();\n                    reader.onload = () => {\n                      const dataUrl = String(reader.result || '');\n                      useHeroStore.getState().updateHero(promptHero.id, { image: dataUrl });\n                      (window as any).notificationBus?.emit?.({ type: 'item', title: 'Foto carregada', message: 'Imagem do heri atualizada.', icon: '', duration: 2500 });\n                    };\n                    reader.readAsDataURL(f);\n                  } catch {}\n                }} />\n              </label>\n              <button onClick={()=>{\n                const tpl = 'epic medieval fantasy hero-smith, male character, standing in a mystical forge, glowing magic hammer, runic leather armor, long dark cloak with gold details, blue particles around, cinematic lighting, ultra-detailed, high fantasy, dramatic atmosphere, sharp textures';\n                const nameCtx = `${promptHero?.name || ''}, ${promptHero?.race || ''} ${promptHero?.class || ''}`.trim();\n                setPromptText(`${nameCtx ? nameCtx + ', ' : ''}${tpl}`);\n              }} className=\"px-3 py-2 rounded bg-amber-600 hover:bg-amber-500 text-white\">Template Lexica (Masculino)</button>\n              <button onClick={()=>{\n                const tpl = 'epic medieval fantasy hero-smith, female character, in an ancient enchanted forge, glowing magical hammer or staff, runic armor with silver details, flowing cloak, mystical particles, soft ethereal light, ultra-detailed, high fantasy, elegant and powerful';\n                const nameCtx = `${promptHero?.name || ''}, ${promptHero?.race || ''} ${promptHero?.class || ''}`.trim();\n                setPromptText(`${nameCtx ? nameCtx + ', ' : ''}${tpl}`);\n              }} className=\"px-3 py-2 rounded bg-pink-600 hover:bg-pink-500 text-white\">Template Lexica (Feminino)</button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default HeroGallery;\n","import React from 'react'\n\ntype State = { hasError: boolean; error?: any }\n\nexport default class ErrorBoundary extends React.Component<{ fallback?: React.ReactNode }, State> {\n  constructor(props: any) {\n    super(props)\n    this.state = { hasError: false }\n  }\n  static getDerivedStateFromError(error: any): State { return { hasError: true, error } }\n  componentDidCatch(error: any, info: any) { console.warn('[ErrorBoundary]', error, info) }\n  render() {\n    if (this.state.hasError) {\n      return this.props.fallback || (\n        <div className=\"p-4 rounded bg-red-900/40 border border-red-700 text-red-200\">\n          <div className=\"font-semibold\">Ocorreu um erro ao renderizar.</div>\n          <div className=\"text-sm\">Tente voltar e abrir a criao novamente.</div>\n        </div>\n      )\n    }\n    return this.props.children as any\n  }\n}","import {\n  AIConfig,\n  AIProvider,\n  AITextRequest,\n  AITextResponse,\n  AIImageRequest,\n  AIImageResponse,\n  AIError as AIErrorInterface,\n  AICache,\n  AIUsageStats\n} from '../types/ai';\nimport { getCachedImage, setCachedImage } from '../utils/imageCache';\n\nclass AIError extends Error implements AIErrorInterface {\n  code: string;\n  provider: AIProvider;\n  retryable: boolean;\n\n  constructor(error: AIErrorInterface) {\n    super(error.message);\n    this.name = 'AIError';\n    this.code = error.code;\n    this.provider = error.provider;\n    this.retryable = error.retryable;\n  }\n}\n\nclass AIService {\n  private config: AIConfig;\n  private cache: Map<string, AICache> = new Map();\n  private usageStats: AIUsageStats = {\n    totalRequests: 0,\n    totalTokens: 0,\n    totalCost: 0,\n    requestsByType: {},\n    averageResponseTime: 0,\n    errorRate: 0\n  };\n\n  constructor() {\n    this.config = this.loadConfig();\n  }\n\n  private fetchWithTimeout(input: RequestInfo | URL, init?: RequestInit, timeoutMs = 8000): Promise<Response> {\n    const controller = new AbortController();\n    const id = setTimeout(() => controller.abort(), Math.max(1000, timeoutMs));\n    return fetch(input, { ...(init || {}), signal: controller.signal })\n      .finally(() => clearTimeout(id));\n  }\n\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, Math.max(0, ms)));\n  }\n\n  private parseRetrySeconds(messageOrHeader?: string | null): number | undefined {\n    if (!messageOrHeader) return undefined;\n    // Try standard Retry-After header (seconds)\n    const asNumber = Number(messageOrHeader);\n    if (!isNaN(asNumber) && asNumber > 0) return asNumber;\n    // Try to parse \"Please try again in Xs\" pattern\n    const match = messageOrHeader.match(/try again in\\s*([\\d.]+)s/i);\n    if (match) {\n      const secs = parseFloat(match[1]);\n      if (!isNaN(secs) && secs > 0) return secs;\n    }\n    return undefined;\n  }\n\n  private loadConfig(): AIConfig {\n    const envAny = (typeof import.meta !== 'undefined' ? (import.meta as any).env : undefined) || {};\n    const providerName = String(envAny.VITE_AI_SERVICE_PROVIDER || '').toLowerCase();\n    const provider: AIProvider = (providerName === 'huggingface' || providerName === 'hf') ? 'huggingface' : (providerName === 'anthropic' ? 'anthropic' : (providerName === 'openai' ? 'openai' : 'groq'));\n    const model = String(envAny.VITE_AI_MODEL || 'llama-3.1-8b-instant');\n    const imageModel = String(envAny.VITE_AI_IMAGE_MODEL || 'stabilityai/sd-turbo');\n    const baseURL = provider === 'huggingface' ? '/api/hf-text' : '/api/groq-openai';\n    return {\n      provider,\n      apiKey: '',\n      model,\n      imageModel,\n      baseURL,\n      maxTokens: 2000,\n      temperature: 0.7\n    };\n  }\n\n  private generateCacheKey(request: AITextRequest | AIImageRequest): string {\n    // Usa hash simples para evitar problemas de Unicode com btoa\n    const str = JSON.stringify(request);\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const chr = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + chr;\n      hash |= 0; // converte para inteiro 32-bit\n    }\n    return `k${Math.abs(hash).toString(36)}`;\n  }\n\n  private isValidCache(cache: AICache): boolean {\n    return Date.now() < cache.expiresAt;\n  }\n\n  private async makeOpenAITextRequest(request: AITextRequest, override?: { baseURL?: string; model?: string }): Promise<AITextResponse> {\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json'\n    };\n    // Somente inclui Authorization se houver chave no cliente\n    if (this.config.apiKey) {\n      headers['Authorization'] = `Bearer ${this.config.apiKey}`;\n    }\n\n    const base = (override?.baseURL ?? this.config.baseURL) || '';\n    let endpoint = `${base}/chat/completions`;\n    if (typeof base === 'string' && base.startsWith('/api/')) {\n      // Suporte a dois proxies: /api/groq-chat (POST direto) e /api/groq-openai (OpenAI path)\n      endpoint = base.includes('groq-chat') ? base : `${base}/chat/completions`;\n    }\n    const maxRetries = 3;\n    let attempt = 0;\n    let lastErrorMsg = '';\n\n    while (attempt <= maxRetries) {\n      const maxTokensForAttempt = Math.max(200, (request.maxTokens || this.config.maxTokens || 2000) - (attempt * 200));\n      console.debug('[AI][OpenAIText] Request', {\n        endpoint,\n        provider: this.config.provider,\n        model: this.config.model,\n        maxTokens: maxTokensForAttempt,\n        temperature: request.temperature || this.config.temperature,\n        promptLen: request.prompt?.length || 0,\n        hasContext: !!request.context,\n        attempt\n      });\n\n      const response = await this.fetchWithTimeout(endpoint, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify({\n          model: override?.model || this.config.model,\n          messages: [\n            ...(request.systemMessage ? [{ role: 'system', content: request.systemMessage }] : []),\n            ...(request.context ? [{ role: 'user', content: request.context }] : []),\n            { role: 'user', content: request.prompt }\n          ],\n          max_tokens: maxTokensForAttempt,\n          temperature: request.temperature || this.config.temperature\n        })\n      }, 12000);\n\n      if (response.ok) {\n        const data = await response.json();\n        console.debug('[AI][OpenAIText] Success', {\n          status: response.status,\n          model: data.model,\n          textLen: data?.choices?.[0]?.message?.content?.length || 0\n        });\n        return {\n          text: data.choices[0].message.content,\n          usage: data.usage,\n          model: data.model,\n          provider: 'openai'\n        };\n      }\n\n      // Fallback para endpoint alternativo em 404/405\n      if ((response.status === 404 || response.status === 405) && base.includes('groq-openai')) {\n        endpoint = '/api/groq-chat';\n        attempt++;\n        await this.sleep(200);\n        continue;\n      }\n\n      const raw = await response.text();\n      let error: any = {};\n      try { error = JSON.parse(raw); } catch { error = { error: { message: raw } }; }\n      lastErrorMsg = error.error?.message || raw || 'Unknown error occurred';\n      const envAny = (typeof import.meta !== 'undefined' ? (import.meta as any).env : undefined) || {};\n      const silent = (envAny.VITE_AI_SILENT === 'true') || !!envAny.DEV;\n      (!silent ? console.error : console.debug)('[AI][OpenAIText] Error', {\n        status: response.status,\n        statusText: response.statusText,\n        endpoint,\n        message: lastErrorMsg,\n        rawSnippet: typeof raw === 'string' ? raw.slice(0, 300) : '',\n        retryAfter: response.headers.get('retry-after') || undefined\n      });\n\n      if (response.status === 429) {\n        // Rate limit: aplicar backoff exponencial com jitter e respeitar Retry-After se presente\n        const retryAfterHeader = response.headers.get('retry-after');\n        const retryAfterFromHeader = this.parseRetrySeconds(retryAfterHeader);\n        const retryAfterFromMsg = this.parseRetrySeconds(lastErrorMsg);\n        const baseWaitMs = Math.round((retryAfterFromHeader ?? retryAfterFromMsg ?? 3) * 1000);\n        const exponentialMs = baseWaitMs * Math.pow(2, attempt);\n        const jitterMs = Math.floor(Math.random() * 300);\n        await this.sleep(Math.max(1000, exponentialMs + jitterMs));\n        attempt++;\n        continue;\n      }\n\n      // Outros erros: lanar imediatamente\n      throw new AIError({\n        code: error.error?.code || 'unknown_error',\n        message: lastErrorMsg,\n        provider: 'openai',\n        retryable: response.status >= 500\n      });\n    }\n\n    // Se exceder retries por rate limit, propaga erro amigvel e marcando como retryable\n    throw new AIError({\n      code: 'rate_limit',\n      message: lastErrorMsg || 'Rate limit reached. Please try again later.',\n      provider: 'openai',\n      retryable: true\n    });\n  }\n\n  private async makeHuggingFaceTextRequest(request: AITextRequest): Promise<AITextResponse> {\n    const endpoint = '/api/hf-text';\n    console.debug('[AI][HFText] Request', {\n      endpoint,\n      model: this.config.model,\n      maxTokens: request.maxTokens || this.config.maxTokens,\n      temperature: request.temperature || this.config.temperature,\n      promptLen: request.prompt?.length || 0,\n      hasContext: !!request.systemMessage\n    });\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        prompt: request.prompt,\n        systemMessage: request.systemMessage,\n        maxTokens: request.maxTokens || this.config.maxTokens,\n        temperature: request.temperature || this.config.temperature\n      })\n    });\n\n    const textRaw = await response.text();\n    let data: any = { text: '' };\n    try { data = JSON.parse(textRaw); } catch { data = { text: textRaw }; }\n    if (!response.ok) {\n      const errObj = data?.error ?? data;\n      const errMsg = typeof errObj === 'string' ? errObj : (errObj?.message || 'Erro ao gerar com Hugging Face');\n      console.error('[AI][HFText] Error', {\n        status: response.status,\n        statusText: response.statusText,\n        endpoint,\n        message: errMsg,\n        rawSnippet: typeof textRaw === 'string' ? textRaw.slice(0, 300) : ''\n      });\n      if (response.status === 404 || response.status === 405) {\n        try {\n          const alt = await this.makeOpenAITextRequest(request, { baseURL: '/api/groq-openai', model: 'llama-3.1-8b-instant' });\n          return alt;\n        } catch {}\n      }\n      throw new AIError({\n        code: 'hf_error',\n        message: errMsg,\n        provider: 'huggingface',\n        retryable: response.status >= 500\n      });\n    }\n\n    console.debug('[AI][HFText] Success', {\n      status: response.status,\n      textLen: (data.text || '').length\n    });\n    return {\n      text: data.text || '',\n      usage: undefined,\n      model: this.config.model,\n      provider: 'huggingface'\n    } as any;\n  }\n\n  private async makeAnthropicTextRequest(request: AITextRequest): Promise<AITextResponse> {\n    const response = await fetch(`${this.config.baseURL}/messages`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-api-key': this.config.apiKey,\n        'anthropic-version': '2023-06-01'\n      },\n      body: JSON.stringify({\n        model: this.config.model,\n        max_tokens: request.maxTokens || this.config.maxTokens,\n        temperature: request.temperature || this.config.temperature,\n        system: request.systemMessage,\n        messages: [\n          ...(request.context ? [{ role: 'user', content: request.context }] : []),\n          { role: 'user', content: request.prompt }\n        ]\n      })\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new AIError({\n        code: error.error?.type || 'unknown_error',\n        message: error.error?.message || 'Unknown error occurred',\n        provider: 'anthropic',\n        retryable: response.status >= 500\n      });\n    }\n\n    const data = await response.json();\n    return {\n      text: data.content[0].text,\n      usage: data.usage,\n      model: data.model,\n      provider: 'anthropic'\n    };\n  }\n\n  private async makeOpenAIImageRequest(request: AIImageRequest): Promise<AIImageResponse> {\n    const response = await fetch(`${this.config.baseURL}/images/generations`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.config.apiKey}`\n      },\n      body: JSON.stringify({\n        model: this.config.imageModel,\n        prompt: request.prompt,\n        size: request.size || '1024x1024',\n        quality: request.quality || 'standard',\n        style: request.style || 'vivid',\n        n: request.n || 1\n      })\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new AIError({\n        code: error.error?.code || 'unknown_error',\n        message: error.error?.message || 'Unknown error occurred',\n        provider: 'openai',\n        retryable: response.status >= 500\n      });\n    }\n\n    const data = await response.json();\n    return {\n      url: data.data[0].url,\n      revisedPrompt: data.data[0].revised_prompt,\n      size: request.size || '1024x1024',\n      model: this.config.imageModel!,\n      provider: 'openai'\n    };\n  }\n\n  private async makeHuggingFaceImageRequest(request: AIImageRequest): Promise<AIImageResponse> {\n    // Persistent cache check by prompt (Lexica/Pollinations URLs)\n    const cacheEnabled = import.meta.env.VITE_AI_CACHE_ENABLED !== 'false';\n    if (cacheEnabled) {\n      const cachedUrl = getCachedImage(request.prompt);\n      if (cachedUrl) {\n        return {\n          url: cachedUrl,\n          revisedPrompt: request.prompt,\n          size: request.size || '512x512',\n          model: this.config.imageModel || 'stabilityai/sd-turbo',\n          provider: 'cache'\n        } as any;\n      }\n    }\n\n    const response = await this.fetchWithTimeout('/api/gerar-imagem', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ prompt: request.prompt })\n    }, 9000);\n\n    const data = await response.json().catch(() => ({ imagem: '' }));\n    if (!response.ok) {\n      throw new AIError({\n        code: 'hf_image_error',\n        message: data?.error || 'Erro ao gerar imagem no Hugging Face',\n        provider: 'huggingface',\n        retryable: response.status >= 500\n      });\n    }\n\n    let imageUrl = data.imagem || '';\n    // Se o backend retornou placeholder SVG ou vazio, tentar fallback gratuito Lexica\n    if (!imageUrl || (typeof imageUrl === 'string' && imageUrl.startsWith('data:image/svg+xml'))) {\n      try {\n        const res2 = await this.fetchWithTimeout(`/api/hero-image?prompt=${encodeURIComponent(request.prompt)}`, { method: 'GET' }, 7000);\n        const data2 = await res2.json().catch(() => ({ image: '' }));\n        if (res2.ok && typeof data2?.image === 'string' && data2.image.length > 0) {\n          imageUrl = data2.image;\n        }\n      } catch {\n        // Ignorar e manter placeholder\n      }\n      // Fallback gratuito adicional: Pollinations via proxy local para evitar ORB/CORS\n      if (!imageUrl || (typeof imageUrl === 'string' && imageUrl.startsWith('data:image/svg+xml'))) {\n        // Prefer width/height params for Pollinations for broader compatibility\n        const size = (request.size || '512x512').split('x');\n        const width = encodeURIComponent(size[0] || '512');\n        const height = encodeURIComponent(size[1] || '512');\n        imageUrl = `/api/pollinations-image?prompt=${encodeURIComponent(request.prompt)}&width=${width}&height=${height}`;\n      }\n    }\n\n    // Persist cache for http(s) URLs (avoid data URIs)\n    if (cacheEnabled && typeof imageUrl === 'string' && /^https?:\\/\\//.test(imageUrl)) {\n      const srcType = imageUrl.includes('lexica.art') ? 'lexica' : (imageUrl.includes('pollinations.ai') ? 'pollinations' : 'hf');\n      // Cache for 7 days by default\n      setCachedImage(request.prompt, imageUrl, 7 * 24 * 60 * 60 * 1000, srcType as any);\n    }\n\n    return {\n      url: imageUrl,\n      revisedPrompt: request.prompt,\n      size: request.size || '512x512',\n      model: this.config.imageModel || 'stabilityai/sd-turbo',\n      provider: 'huggingface'\n    } as any;\n  }\n\n  async generateText(request: AITextRequest): Promise<AITextResponse> {\n    // Verificar se o servio est configurado\n    if (!this.isConfigured()) {\n      return {\n        text: 'AI service is not configured. Please check your API keys.',\n        usage: { promptTokens: 0, completionTokens: 0, totalTokens: 0 },\n        model: this.config.model,\n        provider: this.config.provider,\n        finishReason: 'stop'\n      };\n    }\n\n    const startTime = Date.now();\n    const cacheKey = this.generateCacheKey(request);\n\n    // Check cache first\n    if (import.meta.env.VITE_AI_CACHE_ENABLED === 'true') {\n      const cached = this.cache.get(cacheKey);\n      if (cached && this.isValidCache(cached)) {\n        return cached.response as AITextResponse;\n      }\n    }\n\n    try {\n      console.debug('[AI][Text] Dispatch', {\n        provider: this.config.provider,\n        baseURL: this.config.baseURL,\n        model: this.config.model,\n        maxTokens: request.maxTokens || this.config.maxTokens,\n        temperature: request.temperature || this.config.temperature,\n        promptLen: request.prompt?.length || 0,\n        hasContext: !!request.context\n      });\n      let response: AITextResponse;\n\n      if (this.config.provider === 'openai') {\n        response = await this.makeOpenAITextRequest(request);\n      } else if (this.config.provider === 'groq') {\n        response = await this.makeOpenAITextRequest(request);\n      } else if (this.config.provider === 'anthropic') {\n        response = await this.makeAnthropicTextRequest(request);\n      } else {\n        response = await this.makeHuggingFaceTextRequest(request);\n      }\n\n      // Update usage stats\n      this.updateUsageStats(startTime, response.usage?.totalTokens || 0, 'text');\n\n      // Cache the response\n      if (import.meta.env.VITE_AI_CACHE_ENABLED === 'true') {\n        this.cache.set(cacheKey, {\n          key: cacheKey,\n          response,\n          timestamp: Date.now(),\n          expiresAt: Date.now() + (24 * 60 * 60 * 1000) // 24 hours\n        });\n      }\n      console.debug('[AI][Text] Completed', {\n        provider: response.provider,\n        model: response.model,\n        textLen: response.text?.length || 0,\n        totalTokens: response.usage?.totalTokens\n      });\n      return response;\n    } catch (error) {\n      this.usageStats.errorRate++;\n      const envAny = (typeof import.meta !== 'undefined' ? (import.meta as any).env : undefined) || {};\n      const silent = (envAny.VITE_AI_SILENT === 'true') || !!envAny.DEV;\n      (!silent ? console.error : console.debug)('[AI][Text] Failed', {\n        code: (error as any)?.code,\n        message: (error as any)?.message,\n        provider: (error as any)?.provider || this.config.provider,\n        retryable: (error as any)?.retryable\n      });\n      if (this.config.provider === 'groq') {\n        try {\n          const resp = await this.makeHuggingFaceTextRequest(request);\n          return resp;\n        } catch {}\n      }\n      throw error;\n    }\n  }\n\n  // Verso segura com fallback local quando houver falha do provider\n  async generateTextSafe(request: AITextRequest): Promise<AITextResponse> {\n    try {\n      return await this.generateText(request);\n    } catch (error: any) {\n      const envAny = (typeof import.meta !== 'undefined' ? (import.meta as any).env : undefined) || {};\n      const silent = (envAny.VITE_AI_SILENT === 'true') || !!envAny.DEV;\n      (!silent ? console.warn : console.debug)('[AI][TextSafe] Fallback engaged', {\n        code: error?.code,\n        message: error?.message?.slice?.(0, 200) || String(error?.message || error),\n        provider: error?.provider || this.config.provider\n      });\n      const text = this.buildFallbackText(request);\n      return {\n        text,\n        usage: { promptTokens: 0, completionTokens: 0, totalTokens: 0 },\n        model: this.config.model,\n        provider: this.config.provider\n      } as AITextResponse;\n    }\n  }\n\n  private buildFallbackText(request: AITextRequest): string {\n    const sys = (request.systemMessage || '').toLowerCase();\n    const prompt = request.prompt || '';\n    // Heursticas simples para diferentes consumidores de texto\n    if (sys.includes('narrador') || sys.includes('narrative') || prompt.toLowerCase().includes('narre')) {\n      return 'O vento sussurra entre runas antigas enquanto o heri avana com determinao. Obstculos surgem, mas cada passo revela novas oportunidades e perigos. Continue explorando: o destino se escreve com suas escolhas.';\n    }\n    if (sys.includes('misso') || prompt.toLowerCase().includes('misso')) {\n      return 'Misso: Investigar atividades estranhas em um vilarejo prximo. Objetivo: conversar com moradores e coletar pistas. Recompensa: experincia e ouro modestos. Dificuldade: normal.';\n    }\n    if (sys.includes('dilogo') || prompt.toLowerCase().includes('dilogo')) {\n      return 'NPC: \"Vi voc pela estrada. Cuidado, viajanteos bosques escondem mais do que sombras. Precisa de ajuda?\"';\n    }\n    // Fallback genrico\n    const trimmed = prompt.trim();\n    return trimmed.length > 0\n      ? `Resumo: ${trimmed.slice(0, 200)} ...`\n      : 'Texto no disponvel no momento. Continue a aventura; contedo ser carregado quando o servio retornar.';\n  }\n\n  async generateImage(request: AIImageRequest): Promise<AIImageResponse> {\n    // Verificar se o servio est configurado\n    if (!this.isConfigured()) {\n      return {\n        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OTk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkFJIE5vdCBDb25maWd1cmVkPC90ZXh0Pjwvc3ZnPg==',\n        revisedPrompt: request.prompt,\n        size: request.size || '1024x1024',\n        model: this.config.imageModel || 'stabilityai/sd-turbo',\n        provider: this.config.provider\n      };\n    }\n\n    const startTime = Date.now();\n    const cacheKey = this.generateCacheKey(request);\n\n    // Check cache first\n    const cacheEnabled = import.meta.env.VITE_AI_CACHE_ENABLED !== 'false';\n    if (cacheEnabled) {\n      const cached = this.cache.get(cacheKey);\n      if (cached && this.isValidCache(cached)) {\n        return cached.response as AIImageResponse;\n      }\n    }\n\n    try {\n      let response: AIImageResponse;\n\n      if (this.config.provider === 'openai') {\n        response = await this.makeOpenAIImageRequest(request);\n      } else {\n        // Para Groq (ou qualquer outro), use o backend Hugging Face para gerao de imagem\n        response = await this.makeHuggingFaceImageRequest(request);\n      }\n\n      // Update usage stats\n      this.updateUsageStats(startTime, 0, 'image');\n\n      // Cache the response\n      if (cacheEnabled) {\n        this.cache.set(cacheKey, {\n          key: cacheKey,\n          response,\n          timestamp: Date.now(),\n          expiresAt: Date.now() + (7 * 24 * 60 * 60 * 1000) // 7 days\n        });\n      }\n\n      return response;\n    } catch (error) {\n      this.usageStats.errorRate++;\n      throw error;\n    }\n  }\n\n  private updateUsageStats(startTime: number, tokens: number, type: string): void {\n    const responseTime = Date.now() - startTime;\n    \n    this.usageStats.totalRequests++;\n    this.usageStats.totalTokens += tokens;\n    this.usageStats.requestsByType[type] = (this.usageStats.requestsByType[type] || 0) + 1;\n    \n    // Update average response time\n    this.usageStats.averageResponseTime = \n      (this.usageStats.averageResponseTime * (this.usageStats.totalRequests - 1) + responseTime) / \n      this.usageStats.totalRequests;\n  }\n\n  getUsageStats(): AIUsageStats {\n    return { ...this.usageStats };\n  }\n\n  clearCache(): void {\n    this.cache.clear();\n  }\n\n  getCacheSize(): number {\n    return this.cache.size;\n  }\n\n  isConfigured(): boolean {\n    // Hugging Face usa exclusivamente rotas backend; no requer chave no cliente\n    if (this.config.provider === 'huggingface') return true;\n\n    // Groq via proxy serverless (baseURL relativo) tambm no requer chave no cliente\n    if (this.config.provider === 'groq') {\n      const isProxy = typeof this.config.baseURL === 'string' && this.config.baseURL.startsWith('/api/');\n      return isProxy || !!this.config.apiKey;\n    }\n\n    // OpenAI/Anthropic requerem chave no cliente\n    return !!this.config.apiKey;\n  }\n\n  getProvider(): AIProvider {\n    return this.config.provider;\n  }\n}\n\n// Singleton instance\nexport const aiService = new AIService();\n","import { HeroCreationData, HeroAttributes, Hero } from '../types/hero';\nimport { storyAIService } from '../services/storyAIService';\nimport { aiService } from '../services/aiService';\n\n// Fallback templates for when AI is not available\nconst classVariations: Record<string, string[]> = {\n  Warrior: [\n    '${name} treinou entre ao e fogo, moldando sua coragem nas batalhas de ${place}.',\n    'Chamado de \"Escudo de ${place}\", ${name} ergueu sua lmina para proteger os fracos.',\n    'Em ${place}, ${name} aprendeu que disciplina vale mais que fora bruta.',\n    'Quando os tambores ecoaram em ${place}, ${name} avanou sem hesitar.',\n    'Cada cicatriz de ${name} conta uma histria de honra e dever em ${place}.'\n  ],\n  Mage: [\n    '${name} estudou grimrios antigos em ${place}, dominando segredos arcanos.',\n    'Chamado de \"Sbio de ${place}\", ${name} manipula o vu entre mundos.',\n    'Em ${place}, ${name} aprendeu que conhecimento  a maior arma.',\n    'Quando as estrelas alinharam-se sobre ${place}, ${name} recitou um antigo encantamento.',\n    'As runas de ${place} sussurraram o destino de ${name} nas noites longas.'\n  ],\n  Rogue: [\n    'Nas sombras de ${place}, ${name} move-se como o vento.',\n    'Chamado de \"Eco de ${place}\", ${name} nunca est onde o inimigo espera.',\n    'Em ${place}, ${name} aprendeu que silncio pode ser mais poderoso que ao.',\n    'Quando a lua caiu sobre ${place}, ${name} roubou o segredo que virou a guerra.',\n    'Cada passo de ${name} em ${place} deixa apenas perguntas e nenhum rastro.'\n  ],\n  Cleric: [\n    'Sob as bnos em ${place}, ${name} cura feridas e expulsa trevas.',\n    'Chamado de \"Luz de ${place}\", ${name} mantm a f firme sob qualquer tormenta.',\n    'Em ${place}, ${name} aprendeu que compaixo  coragem de outro tipo.',\n    'Quando as campanas tocaram em ${place}, ${name} respondeu com orao e ao.',\n    'Cada milagre de ${name} em ${place} acende esperana onde antes havia medo.'\n  ],\n  Ranger: [\n    'Entre florestas de ${place}, ${name} conhece cada trilha e rastro.',\n    'Chamado de \"Guia de ${place}\", ${name} anda onde poucos sobrevivem.',\n    'Em ${place}, ${name} aprendeu que pacincia supera pressa.',\n    'Quando o vento mudou em ${place}, ${name} j sabia o caminho seguro.',\n    'Os animais de ${place} reconhecem ${name} como parte da prpria natureza.'\n  ],\n  Paladin: [\n    'Jurando votos em ${place}, ${name} combate o mal com retido.',\n    'Chamado de \"Voto de ${place}\", ${name} no recua diante da injustia.',\n    'Em ${place}, ${name} aprendeu que a verdade  lmina afiada.',\n    'Quando a escurido caiu sobre ${place}, ${name} ergueu o estandarte da luz.',\n    'Cada ato de ${name} em ${place} grava um exemplo de virtude.'\n  ]\n};\n\nconst places = ['Alto Vale', 'Muralha de Pedra', 'Costa mbar', 'Plancies de bano', 'Bosque das Runas'];\n\nfunction pick<T>(arr: T[]): T {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\nfunction dominantAttribute(attrs: HeroAttributes): { key: keyof HeroAttributes; label: string } {\n  const labels: Record<keyof HeroAttributes, string> = {\n    forca: 'fora',\n    destreza: 'destreza',\n    constituicao: 'constituio',\n    inteligencia: 'inteligncia',\n    sabedoria: 'sabedoria',\n    carisma: 'carisma'\n  };\n  const entries = Object.entries(attrs) as [keyof HeroAttributes, number][];\n  const [key] = entries.reduce((max, cur) => (cur[1] > max[1] ? cur : max), entries[0]);\n  return { key, label: labels[key] };\n}\n\n// Legacy function for backward compatibility\nexport function generateStory(hero: HeroCreationData): string {\n  return generateFallbackStory(hero);\n}\n\n// AI-powered story generation\nexport async function generateAIStory(hero: Hero, storyType: 'origin' | 'adventure' | 'legendary' | 'achievement' = 'origin', context?: string): Promise<string> {\n  // Check if AI is configured and available\n  if (!aiService.isConfigured()) {\n    console.warn('AI service not configured, using fallback story generation');\n    return generateFallbackStory(hero);\n  }\n\n  try {\n    return await storyAIService.generateStory({\n      hero,\n      storyType,\n      context\n    });\n  } catch (error) {\n    console.error('Failed to generate AI story, falling back to template:', error);\n    return generateFallbackStory(hero);\n  }\n}\n\n// Enhanced story generation with multiple types\nexport async function generateHeroStory(hero: Hero, options: {\n  type?: 'origin' | 'adventure' | 'legendary' | 'achievement';\n  context?: string;\n  useAI?: boolean;\n} = {}): Promise<string> {\n  const { type = 'origin', context, useAI = true } = options;\n\n  if (useAI && aiService.isConfigured()) {\n    try {\n      return await storyAIService.generateStory({\n        hero,\n        storyType: type,\n        context\n      });\n    } catch (error) {\n      console.error('AI story generation failed:', error);\n    }\n  }\n\n  return generateFallbackStory(hero);\n}\n\n// Generate hero description using AI\nexport async function generateHeroDescription(hero: Hero): Promise<string> {\n  if (!aiService.isConfigured()) {\n    return generateFallbackDescription(hero);\n  }\n\n  try {\n    return await storyAIService.generateHeroDescription(hero);\n  } catch (error) {\n    console.error('Failed to generate AI description:', error);\n    return generateFallbackDescription(hero);\n  }\n}\n\n// Fallback story generation using templates\nfunction generateFallbackStory(hero: HeroCreationData | Hero): string {\n  const base = pick(classVariations[hero.class] || classVariations['Warrior']);\n  const place = pick(places);\n  const dom = dominantAttribute(hero.attributes);\n  const template = base\n    .replaceAll('${name}', hero.name || 'Sem Nome')\n    .replaceAll('${place}', place);\n  // Garante meno a pelo menos um atributo\n  const attributeLine = `Sua maior virtude  a ${dom.label}.`;\n  return `${template} ${attributeLine}`;\n}\n\n// Fallback description generation\nfunction generateFallbackDescription(hero: Hero): string {\n  const classDescriptions = {\n    Warrior: 'Um guerreiro imponente com porte atltico e presena marcante.',\n    Mage: 'Uma figura sbia envolta em vestes msticas, com olhos que brilham com conhecimento.',\n    Rogue: 'gil e silencioso, move-se com graa e preciso calculada.',\n    Paladin: 'Nobre e radiante, sua presena inspira confiana e respeito.',\n    Ranger: 'Conectado com a natureza, possui olhos alertas e movimentos precisos.',\n    Cleric: 'Sereno e compassivo, irradia uma aura de paz e sabedoria.'\n  };\n\n  return classDescriptions[hero.class as keyof typeof classDescriptions] || \n         `${hero.name} possui a presena marcante de um verdadeiro ${hero.class}.`;\n}\n\nexport const ALTHARION_LORE_VERSIONS = {\n  short: {\n    id: 'short',\n    title: 'Verso Curta',\n    usage: ['menu', 'galeria', 'tela_inicial'],\n    lang: 'pt-BR',\n    paragraphs: [\n      'H muito tempo, as terras de Altharion foram marcadas por perigos antigos e masmorras mortais.',\n      'Para proteger os novos aventureiros, surgiu a Guilda dos Aventureiros, que criou um programa nico de treinamento: o Forjador de Heris.',\n      'Agora, cada novo heri  moldado com sabedoria, disciplina e escolhas que definiro o destino do mundo.'\n    ]\n  },\n  cinematic: {\n    id: 'cinematic',\n    title: 'Verso Cinematogrfica',\n    usage: ['trailer', 'vdeo_pico'],\n    lang: 'pt-BR',\n    script: [\n      'Em um mundo onde as sombras renascem',\n      'Onde masmorras devoram os despreparados',\n      'Corta para runas antigas e uma chama azul acendendo.',\n      'A Guilda dos Aventureiros de Altharion ergueu-se para trazer ordem ao caos.',\n      'Imagens de aventureiros sendo treinados, batalhando, caindo, levantando.',\n      'Mas tantas vidas foram perdidas nos abismos esquecidos',\n      'que a Guilda criou algo novo.',\n      'Aparece um smbolo brilhante: Forjador de Heris',\n      'Um programa forjado em suor, sabedoria e magia.',\n      'Um ritual capaz de moldar no apenas guerreiros',\n      'mas lendas.',\n      'Som de espada sendo desembainhada.',\n      'Agora,  sua vez.',\n      'Entre nas masmorras, tome decises que ecoaro para sempre',\n      'e torne-se aquilo que Altharion tanto precisa.',\n      'Fade-out:',\n      'O Forjador de Heris aguarda.'\n    ]\n  },\n  game_intro: {\n    id: 'game_intro',\n    title: 'Narrao Inicial do Jogo',\n    usage: ['intro'],\n    lang: 'pt-BR',\n    lines: [\n      'Bem-vindo a Altharion.',\n      'Estas terras outrora foram prsperas, mas com o despertar das antigas masmorras, o perigo retornou como nunca antes.',\n      'Durante anos, aventureiros inexperientes caram nos labirintos sombrios e muitos nunca voltaram.',\n      'Para conter tantas perdas, surgiu a Guilda dos Aventureiros de Altharion, uma ordem dedicada a treinar, orientar e organizar aqueles que ousam desafiar o desconhecido.',\n      'Depois de inmeras mortes, a Guilda criou sua maior obra:',\n      'o Forjador de Heris, um sistema de formao capaz de preparar qualquer aspirante para enfrentar os horrores das profundezas.',\n      'Agora, voc est aqui.',\n      'Seu nome ser registrado.',\n      'Suas escolhas moldaro seu destino e talvez o destino do mundo.',\n      'A forja est acesa.',\n      'Sua jornada comea agora.'\n    ]\n  },\n  topics: {\n    id: 'topics',\n    title: 'Verso em Tpicos',\n    usage: ['wiki', 'documentacao', 'historia_do_mundo'],\n    lang: 'pt-BR',\n    sections: [\n      {\n        id: 'origem_de_altharion',\n        title: 'Origem de Altharion',\n        bullets: [\n          'Mundo antigo com vastos reinos, runas esquecidas e masmorras vivas.',\n          'Portais arcanos abriram passagens para criaturas do alm.',\n          'A magia primal permeia tudo, moldando a realidade e corrompendo territrios.'\n        ]\n      },\n      {\n        id: 'problema_original',\n        title: 'Masmorras devorando aventureiros',\n        bullets: [\n          'As masmorras no so apenas lugares  so entidades vivas e mutveis.',\n          'A cada gerao, a taxa de mortes entre aventureiros crescia.',\n          'Jovens guerreiros entravam despreparados, confiando apenas na coragem.'\n        ]\n      },\n      {\n        id: 'criacao_da_guilda',\n        title: 'A criao da Guilda dos Aventureiros',\n        bullets: [\n          'Formada por veteranos que sobreviveram aos piores horrores.',\n          'Organizao responsvel por distribuir misses, registrar aventureiros, manter a ordem entre as faces, investigar as masmorras, coordenar times para expedies.'\n        ]\n      },\n      {\n        id: 'forjador_de_herois',\n        title: 'Nasce o Forjador de Heris',\n        bullets: [\n          'Criado aps inmeras mortes desnecessrias.',\n          'Objetivo: preparar novatos psicologicamente, fisicamente e espiritualmente.',\n          'Sistema que treina atributos, guia decises, oferece misses graduais, simula combate, registra reputao com faces, molda o carter do heri desde o comeo.',\n          'Por isso  chamado de Forjador: seu heri  literalmente moldado.'\n        ]\n      },\n      {\n        id: 'foco_do_mundo',\n        title: 'O foco do mundo',\n        bullets: [\n          'As decises moldam a narrativa.',\n          'Faces reagem s escolhas do jogador.',\n          'Ranks definem quo longe ele pode ir.',\n          'Masmorras profundas exigem preparo.',\n          'A Guilda observa e registra tudo.'\n        ]\n      }\n    ]\n  },\n  full: {\n    id: 'full',\n    title: 'Lore Definitiva',\n    usage: ['lore_completa'],\n    lang: 'pt-BR',\n    paragraphs: [\n      'Antes das grandes cidades, antes dos reinos erguerem seus brases, Altharion era apenas uma terra selvagem.',\n      'A magia primal corria como rios invisveis, despertando criaturas nas profundezas e moldando florestas inteiras.',\n      'Com o passar das eras, homens e mulheres ousaram explorar o desconhecido e descobriram as Masmorras Vivas: estruturas que se expandiam, consumiam energia e renasciam.',\n      'Muitos se voluntariavam para enfrentar tais lugares  jovens sonhadores, guerreiros orgulhosos, curiosos inconsequentes.',\n      'Mas as masmorras eram cruis, adaptativas, imprevisveis. E assim comeou o que ficou conhecido como A Era das Perdas.',\n      'Uma gerao inteira foi consumida pelos abismos.',\n      'Fundada pelos poucos veteranos sobreviventes, a Guilda assumiu para si a responsabilidade de treinar aventureiros, investigar as masmorras, manter a ordem entre as faces, impedir que o caos se espalhe pelas cidades, proteger Altharion de ameaas arcanas.',\n      'Mas mesmo com toda sua disciplina, as mortes continuavam. Foi ento que surgiu a ideia que mudaria tudo.',\n      'A Guilda concluiu que no bastava treinar aventureiros. Era preciso mold-los desde a base.',\n      'Assim nasceu o Forjador de Heris  um programa nico, criado para testar personalidade, coragem e esprito; equilibrar atributos; guiar decises morais; expor o heri a desafios graduais; desenvolver reputao com faces; simular situaes reais de combate; introduzir o heri ao mundo atravs de histrias interativas.',\n      'Cada aventureiro passa por um ritual simblico: a Forja, onde seu destino comea a ser escrito.',\n      'Voc  um dos aspirantes. Mas diferente dos outros suas escolhas realmente mudaro o mundo.',\n      'Alianas sero feitas e quebradas. Faces respondero s suas aes. Misses tero consequncias. As masmorras reagiro ao seu estilo de jogo.',\n      'E, acima de tudo, o Forjador de Heris testar se voc  digno de se tornar uma lenda de Altharion.'\n    ]\n  }\n} as const;\n\nexport function getAltharionLore<K extends keyof typeof ALTHARION_LORE_VERSIONS>(version: K) {\n  return ALTHARION_LORE_VERSIONS[version];\n}\n","import React, { useRef } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { HeroGallery } from './HeroGallery';\nimport ErrorBoundary from './ErrorBoundary';\nimport { useHeroStore } from '../store/heroStore';\nimport { Hero } from '../types/hero';\nimport { getAltharionLore } from '../utils/story';\n\nconst HeroList: React.FC = () => {\n  const navigate = useNavigate();\n  const { updateHero, createHero } = useHeroStore();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [selectedHeroForImage, setSelectedHeroForImage] = React.useState<Hero | null>(null);\n\n  const handleCreateHero = () => {\n    navigate('/create');\n  };\n\n\n  const handleHeroSelect = (hero: Hero) => {\n    navigate(`/hero/${hero.id}`);\n  };\n\n  const handleHeroEdit = (hero: Hero) => {\n    // Por enquanto, navega para a pgina de detalhes\n    // Futuramente pode ser uma modal de edio\n    navigate(`/hero/${hero.id}`);\n  };\n\n  const handleHeroImageChange = (hero: Hero) => {\n    setSelectedHeroForImage(hero);\n    fileInputRef.current?.click();\n  };\n\n  const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file && selectedHeroForImage) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const result = e.target?.result as string;\n        updateHero(selectedHeroForImage.id, { image: result });\n        setSelectedHeroForImage(null);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const shortLore = getAltharionLore('short');\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-gray-900 to-slate-800\">\n      <div className=\"container mx-auto p-4 sm:p-6\">\n        {/* Input oculto para upload de imagem */}\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/*\"\n          onChange={handleImageUpload}\n          className=\"hidden\"\n        />\n\n        {/* Header */}\n        <div className=\"text-center mb-6 sm:mb-8\">\n          <h1 className=\"text-2xl sm:text-4xl font-bold text-amber-400 mb-1 sm:mb-2\"> Hero Forge</h1>\n          <p className=\"text-gray-300 text-sm sm:text-base\">Gerencie seus heris picos</p>\n        </div>\n\n        {/* Seo de Navegao Rpida */}\n        <div className=\"mb-6 sm:mb-8\">\n          <div className=\"grid grid-cols-2 md:grid-cols-5 gap-3 sm:gap-4\">\n            <Link\n              to=\"/quests\"\n              className=\"bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-blue-500/30\"\n            >\n              <div className=\"text-xl sm:text-2xl mb-1 sm:mb-2\"></div>\n              <div className=\"font-medium text-sm sm:text-base\">Misses</div>\n            </Link>\n            <Link\n              to=\"/guild-hub\"\n              className=\"bg-gradient-to-br from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-purple-500/30\"\n            >\n              <div className=\"text-xl sm:text-2xl mb-1 sm:mb-2\"></div>\n              <div className=\"font-medium text-sm sm:text-base\">Guilda dos Aventureiros</div>\n            </Link>\n            <Link\n              to=\"/titles\"\n              className=\"bg-gradient-to-br from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-amber-500/30\"\n            >\n              <div className=\"text-xl sm:text-2xl mb-1 sm:mb-2\"></div>\n              <div className=\"font-medium text-sm sm:text-base\">Ttulos</div>\n            </Link>\n            <Link\n              to=\"/leaderboards\"\n              className=\"bg-gradient-to-br from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-yellow-500/30\"\n            >\n              <div className=\"text-xl sm:text-2xl mb-1 sm:mb-2\"></div>\n              <div className=\"font-medium text-sm sm:text-base\">Rankings</div>\n            </Link>\n          </div>\n        </div>\n\n        {/* Lore Curta */}\n        <div className=\"mb-6 sm:mb-8 rounded-lg p-4 border border-amber-500/30 bg-amber-900/10\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"text-sm text-amber-300 font-semibold\">Forjador de Heris  Introduo</div>\n            <div className=\"flex items-center gap-2\">\n              <Link to=\"/intro?version=game_intro\" className=\"px-3 py-1 rounded bg-amber-600 text-black text-xs\">Narrao</Link>\n              <Link to=\"/intro?version=cinematic\" className=\"px-3 py-1 rounded bg-indigo-600 text-white text-xs\">Trailer</Link>\n            </div>\n          </div>\n          <div className=\"space-y-2 text-xs sm:text-sm text-gray-200\">\n            {shortLore.paragraphs.map((p, i) => (<p key={i}>{p}</p>))}\n          </div>\n        </div>\n\n        {/* Galeria de Heris */}\n        <ErrorBoundary>\n          <HeroGallery\n            onCreateHero={handleCreateHero}\n            onHeroSelect={handleHeroSelect}\n            onHeroEdit={handleHeroEdit}\n            onHeroImageChange={handleHeroImageChange}\n            showCreateButton={true}\n            cardSize=\"medium\"\n            viewMode=\"grid\"\n          />\n        </ErrorBoundary>\n      </div>\n    </div>\n  );\n};\n\nexport default HeroList;\n","import { aiService } from './aiService';\n\nexport type TextoTipo = 'missao' | 'historia' | 'frase' | 'nome' | 'translate';\n\nfunction buildParams(tipo: TextoTipo, contexto = ''): {\n  systemMessage: string;\n  prompt: string;\n  maxTokens: number;\n  temperature: number;\n} {\n  switch (tipo) {\n    case 'nome':\n      return {\n        systemMessage:\n          'Gere NOME COMPLETO de heri medieval em PT-BR. Responda SOMENTE com duas palavras: primeiro nome e sobrenome, sem aspas, sem pontuao.',\n        prompt:\n          `Fornea apenas \"Nome Sobrenome\" pico medieval/fantasia, exatamente duas palavras. Sem eptetos, sem vrgulas, sem explicaes. Contexto: ${contexto || 'heri desconhecido'}.`,\n        maxTokens: 12,\n        temperature: 0.9\n      };\n    case 'frase':\n      return {\n        systemMessage:\n          'Voc cria uma frase de batalha pica em PT-BR, curta, forte e memorvel. Responda apenas com a frase.',\n        prompt:\n          `Crie uma nica frase de batalha pica para um heri. Contexto opcional: ${contexto || 'heri classe desconhecida'}. Evite aspas.`,\n        maxTokens: 40,\n        temperature: 0.8\n      };\n    case 'historia':\n      return {\n        systemMessage:\n          'Voc  um narrador mestre e gera uma histria pica medieval em PT-BR (100200 palavras).',\n        prompt:\n          `Escreva uma histria pica medieval sobre o heri. Contexto: ${contexto || 'heri desconhecido'}. Use o sexo quando fornecido para ajustar pronomes e detalhes. Foque em emoo, imagens vvidas e progresso do heri.`,\n        maxTokens: 350,\n        temperature: 0.8\n      };\n    case 'missao':\n    default:\n      return {\n        systemMessage:\n          'Voc  um mestre de RPG e cria uma misso breve em PT-BR, com objetivo claro e recompensa.',\n        prompt:\n          `Gere uma misso medieval fantasiosa de dificuldade moderada. Contexto: ${contexto || 'nenhum'}. Inclua ttulo, objetivo principal e recompensa curta.`,\n        maxTokens: 200,\n        temperature: 0.7\n      };\n    case 'translate':\n      return {\n        systemMessage: 'Translate the provided Portuguese text to natural English suitable for an AI image prompt. Return only the translated text.',\n        prompt: String(contexto || ''),\n        maxTokens: 300,\n        temperature: 0.3\n      };\n  }\n}\n\nexport async function gerarTexto(tipo: TextoTipo, contexto = ''): Promise<string> {\n  const { systemMessage, prompt, maxTokens, temperature } = buildParams(tipo, contexto);\n  try {\n    const resp = await aiService.generateTextSafe({\n      systemMessage,\n      prompt,\n      maxTokens,\n      temperature\n    });\n    let texto = (resp.text || '').trim();\n    if (tipo === 'nome') {\n      texto = texto.replace(/[\"'`\\.\\,;:]/g, '').trim();\n      const parts = texto.split(/\\s+/).filter(Boolean);\n      if (parts.length >= 2) texto = `${parts[0]} ${parts[1]}`;\n      else if (parts.length === 1) {\n        const surnames = ['da Rocha','do Vale','Silvar','Montclair','Valencius','Stormblade','Noctis','Dawnhart','Ironwood','Winterborn'];\n        const s = surnames[Math.floor(Math.random() * surnames.length)];\n        texto = `${parts[0]} ${s}`;\n      }\n    }\n    if (texto.length > 0) return texto;\n  } catch (e) {\n    // ignorado, usamos fallback abaixo\n  }\n  // Fallback por tipo\n  switch (tipo) {\n    case 'nome':\n      return 'Valen Ironwood';\n    case 'frase':\n      return 'Por honra e ao, avano sem medo!';\n    case 'historia':\n      return 'Sob o cu cinzento, um heri ergueu-se contra a mar de sombras, encontrando coragem nas cicatrizes do passado e esperana no brilho da lmina. A jornada recomea, e o destino chama.';\n    case 'missao':\n    default:\n      return 'Misso: Patrulhar os arredores e investigar pegadas suspeitas. Recompensa: 50 ouro e experincia. Dificuldade: normal.';\n  }\n}\n\nexport async function translateToEnglish(text: string): Promise<string> {\n  try {\n    const { systemMessage, prompt, maxTokens, temperature } = buildParams('translate', text);\n    const resp = await aiService.generateTextSafe({ systemMessage, prompt, maxTokens, temperature });\n    return (resp.text || '').trim();\n  } catch { return ''; }\n}\n","export interface HeroCreateResponse {\n  name: string;\n  story: string;\n  phrase: string;\n  image: string | null;\n}\n\nexport async function generateHeroWithAI(params: {\n  race: string;\n  klass: string;\n  attrs: Record<string, number>;\n  gender?: 'masculino' | 'feminino';\n}): Promise<HeroCreateResponse> {\n  const resp = await fetch('/api/hero-create', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(params)\n  });\n\n  if (!resp.ok) {\n    throw new Error(`Erro ao gerar heri: ${resp.status}`);\n  }\n\n  return resp.json();\n}\n\n","/**\n * Sistema de Gerao de Nomes por Raa\n * Verso 3.0 - Forjador de Heris\n */\n\nimport { HeroRace } from '../types/hero';\n\ninterface NamePool {\n  first: string[];\n  last: string[];\n  prefixes?: string[];\n  suffixes?: string[];\n}\n\nexport const NAME_POOLS: Record<HeroRace, NamePool> = {\n  humano: {\n    first: [\n      \"Erik\", \"Mira\", \"Roland\", \"Selene\", \"Alba\", \"Marcus\", \"Elena\", \"Gareth\", \n      \"Lyanna\", \"Cedric\", \"Aria\", \"Theron\", \"Vera\", \"Aldric\", \"Nora\", \"Darius\",\n      \"Celia\", \"Roderick\", \"Iris\", \"Magnus\", \"Luna\", \"Cassius\", \"Stella\"\n    ],\n    last: [\n      \"Vargas\", \"Dorn\", \"Marin\", \"Cavaleiro\", \"Ferreira\", \"Santos\", \"Silva\", \n      \"Monteiro\", \"Pereira\", \"Costa\", \"Almeida\", \"Rocha\", \"Cardoso\", \"Ribeiro\",\n      \"Machado\", \"Barbosa\", \"Correia\", \"Teixeira\", \"Moreira\", \"Carvalho\"\n    ]\n  },\n  elfo: {\n    first: [\n      \"Elarion\", \"Sylwen\", \"Althir\", \"Thalindra\", \"Aelindra\", \"Celeborn\", \n      \"Galadriel\", \"Legolas\", \"Arwen\", \"Elrond\", \"Nimrodel\", \"Thranduil\",\n      \"Elaria\", \"Silvyr\", \"Moonwhisper\", \"Starweaver\", \"Dawnbringer\", \"Nightsong\"\n    ],\n    last: [\n      \"Lunarwind\", \"Silvertree\", \"Aelaris\", \"Moonblade\", \"Starfall\", \"Dawnstrider\",\n      \"Nightwhisper\", \"Goldleaf\", \"Silverbrook\", \"Crystalwind\", \"Shadowmere\",\n      \"Brightbane\", \"Swiftarrow\", \"Lightbringer\", \"Forestwalker\", \"Stormwind\"\n    ]\n  },\n  anao: {\n    first: [\n      \"Durak\", \"Brom\", \"Thrain\", \"Hilda\", \"Thorin\", \"Dain\", \"Balin\", \"Dwalin\",\n      \"Gimli\", \"Gloin\", \"Oin\", \"Nori\", \"Dori\", \"Ori\", \"Bifur\", \"Bofur\",\n      \"Bombur\", \"Fili\", \"Kili\", \"Grenda\", \"Magna\", \"Vera\"\n    ],\n    last: [\n      \"Ferrobarba\", \"Pedramar\", \"Martelo-de-Ferro\", \"Barba-de-Ao\", \"Punho-de-Pedra\",\n      \"Escudo-de-Ferro\", \"Machado-Dourado\", \"Forja-Negra\", \"Barba-Branca\",\n      \"P-de-Ferro\", \"Corao-de-Pedra\", \"Mo-de-Ferro\", \"Barba-Vermelha\"\n    ]\n  },\n  orc: {\n    first: [\n      \"Gor\", \"Krag\", \"Thokk\", \"Urgar\", \"Grash\", \"Morg\", \"Skar\", \"Vrak\",\n      \"Grom\", \"Thrall\", \"Durotan\", \"Orgrim\", \"Blackhand\", \"Kilrogg\", \"Ner'zhul\",\n      \"Gul'dan\", \"Cho'gall\", \"Teron\", \"Kargath\", \"Dentarg\"\n    ],\n    last: [\n      \"Sangrent\", \"Ruptura\", \"Osso-Quebrado\", \"Garra-Negra\", \"Dente-Afiado\",\n      \"Punho-de-Ferro\", \"Olho-Vermelho\", \"Cicatriz-Profunda\", \"Lmina-Suja\",\n      \"Crnio-Rachado\", \"Pele-Dura\", \"Fora-Bruta\", \"Raiva-Eterna\"\n    ]\n  },\n  halfling: {\n    first: [\n      \"Bilbo\", \"Frodo\", \"Sam\", \"Merry\", \"Pippin\", \"Rosie\", \"Daisy\", \"Poppy\",\n      \"Lily\", \"Violet\", \"Peregrin\", \"Meriadoc\", \"Samwise\", \"Fredegar\", \"Folco\",\n      \"Odo\", \"Drogo\", \"Primula\", \"Belladonna\", \"Mirabella\", \"Donnamira\"\n    ],\n    last: [\n      \"Bolseiro\", \"Gamgee\", \"Tuk\", \"Brandebuque\", \"Sacola-Dourada\", \"P-Peludo\",\n      \"Colina-Verde\", \"Vale-Alegre\", \"Pedra-Branca\", \"gua-Clara\", \"Campo-Florido\",\n      \"Boa-Sorte\", \"Corao-Alegre\", \"Sorriso-Largo\", \"Barriga-Cheia\"\n    ]\n  }\n};\n\nexport const BATTLE_QUOTES: Record<string, string[]> = {\n  guerreiro: [\n    \"Pelas chamas da honra!\",\n    \"Mostrem seu valor!\",\n    \"Ao nunca falha!\",\n    \"Por glria e batalha!\",\n    \"Que o ferro encontre a carne!\",\n    \"Nenhum passo atrs!\",\n    \"A vitria ou a morte!\"\n  ],\n  mago: [\n    \"Que o cosmos exalte meu nome!\",\n    \"Pelas letras ancestrais!\",\n    \"Que o selo se quebre!\",\n    \"Magia flui atravs de mim!\",\n    \"Os elementos me obedecem!\",\n    \"Conhecimento  poder!\",\n    \"Que a realidade se curve!\"\n  ],\n  arqueiro: [\n    \"Minha mira nunca falha!\",\n    \"Silncio e preciso!\",\n    \"Uma flecha, um alvo!\",\n    \"Que o vento guie minha flecha!\",\n    \"Distncia  minha aliada!\",\n    \"Olhos de guia, mos firmes!\",\n    \"A caa comeou!\"\n  ],\n  clerigo: [\n    \"Pela luz divina!\",\n    \"Que a f me guie!\",\n    \"A cura vem dos cus!\",\n    \"Proteo aos justos!\",\n    \"Luz contra as trevas!\",\n    \"Bnos sobre ns!\",\n    \"O divino me fortalece!\"\n  ],\n  ladino: [\n    \"Sombras, me guiem!\",\n    \"Essa carteira no vai se esvaziar sozinha!\",\n    \"Sorria e corra!\",\n    \"Silncio  ouro!\",\n    \"Nas sombras eu prospero!\",\n    \"Rpido e mortal!\",\n    \"Voc no me viu chegando!\"\n  ],\n  default: [\n    \"Por glria e ouro!\",\n    \"Pelo rei!\",\n    \"Avante, heris!\",\n    \"A aventura nos chama!\",\n    \"Que a sorte nos favorea!\"\n  ]\n};\n\n/**\n * Gera um nome aleatrio baseado na raa\n */\nfunction isLikelyFemale(name: string): boolean {\n  const fSuffix = ['a', 'ia', 'ra', 'na', 'la', 'sa'];\n  const lower = name.toLowerCase();\n  return fSuffix.some(s => lower.endsWith(s));\n}\n\nexport function generateName(race: HeroRace, gender?: 'masculino' | 'feminino'): string {\n  const pool = NAME_POOLS[race] || NAME_POOLS.humano;\n  let firsts = pool.first.slice();\n  if (gender === 'feminino') firsts = firsts.filter(isLikelyFemale).length ? firsts.filter(isLikelyFemale) : firsts;\n  if (gender === 'masculino') firsts = firsts.filter(n => !isLikelyFemale(n)).length ? firsts.filter(n => !isLikelyFemale(n)) : firsts;\n  const first = firsts[Math.floor(Math.random() * firsts.length)];\n  const last = pool.last[Math.floor(Math.random() * pool.last.length)];\n  return `${first} ${last}`;\n}\n\n/**\n * Gera uma frase de batalha baseada na classe\n */\nexport function getBattleQuote(heroClass: string): string {\n  const pool = BATTLE_QUOTES[heroClass.toLowerCase()] || BATTLE_QUOTES.default;\n  return pool[Math.floor(Math.random() * pool.length)];\n}\n\n/**\n * Gera mltiplas opes de nome para o usurio escolher\n */\nexport function generateNameOptions(race: HeroRace, count: number = 3, gender?: 'masculino' | 'feminino'): string[] {\n  const options: string[] = [];\n  const pool = NAME_POOLS[race] || NAME_POOLS.humano;\n  let firsts = pool.first.slice();\n  if (gender === 'feminino') firsts = firsts.filter(isLikelyFemale).length ? firsts.filter(isLikelyFemale) : firsts;\n  if (gender === 'masculino') firsts = firsts.filter(n => !isLikelyFemale(n)).length ? firsts.filter(n => !isLikelyFemale(n)) : firsts;\n  \n  for (let i = 0; i < count; i++) {\n    let name: string;\n    do {\n      const first = firsts[Math.floor(Math.random() * firsts.length)];\n      const last = pool.last[Math.floor(Math.random() * pool.last.length)];\n      name = `${first} ${last}`;\n    } while (options.includes(name));\n    \n    options.push(name);\n  }\n  \n  return options;\n}\n\n/**\n * Valida se um nome personalizado  apropriado\n */\nexport function validateCustomName(name: string): { valid: boolean; message?: string } {\n  if (!name || name.trim().length === 0) {\n    return { valid: false, message: \"Nome no pode estar vazio\" };\n  }\n  \n  if (name.length < 2) {\n    return { valid: false, message: \"Nome deve ter pelo menos 2 caracteres\" };\n  }\n  \n  if (name.length > 50) {\n    return { valid: false, message: \"Nome deve ter no mximo 50 caracteres\" };\n  }\n  \n  // Verifica caracteres especiais invlidos\n  const invalidChars = /[<>{}[\\]\\\\/|`~!@#$%^&*()+=;:'\"?]/;\n  if (invalidChars.test(name)) {\n    return { valid: false, message: \"Nome contm caracteres invlidos\" };\n  }\n  \n  return { valid: true };\n}\n","import React, { useState } from 'react'\nimport { HeroClass, Skill } from '../types/hero'\nimport { PROGRESSION_SKILLS } from '../utils/skillSystem'\n\nexport default function TalentTreePreview({ heroClass, plannedTalents = [], onToggle, currentLevel = 1 }: { heroClass: HeroClass; plannedTalents?: string[]; onToggle?: (skillId: string) => void; currentLevel?: number }) {\n  const defs = PROGRESSION_SKILLS[heroClass] || []\n  const [selected, setSelected] = useState<{ level: number; skill: Skill } | null>(null)\n  return (\n    <div className=\"p-4 rounded bg-gray-700\">\n      <div className=\"text-white font-semibold\">Prximas Habilidades</div>\n      {defs.length === 0 && (\n        <div className=\"text-xs text-gray-300 mt-1\">Nenhuma habilidade definida para esta classe.</div>\n      )}\n      {defs.length > 0 && (\n        <div className=\"mt-2 grid grid-cols-1 md:grid-cols-2 gap-3\">\n          {defs.map(d => (\n            <div key={`${heroClass}-${d.level}`} className=\"p-3 rounded bg-gray-800 border border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-amber-300 text-sm\">Nvel {d.level}</div>\n              <div className={`text-xs ${currentLevel >= d.level ? 'text-emerald-300' : 'text-gray-400'}`}>{currentLevel >= d.level ? 'Disponvel' : `Disponvel no Nvel ${d.level}`}</div>\n              </div>\n              <div className=\"mt-1 h-2 bg-gray-700 rounded\">\n                <div\n                  className=\"h-2 bg-amber-500 rounded\"\n                  style={{ width: `${Math.min(100, Math.floor((currentLevel / d.level) * 100))}%` }}\n                />\n              </div>\n              <ul className=\"mt-1 text-xs text-gray-300\">\n                {d.skills.map((s: Skill) => (\n                  <li key={s.id}>\n                    <button\n                      type=\"button\"\n                      onClick={() => setSelected({ level: d.level, skill: s })}\n                      className={`w-full text-left px-2 py-1 rounded ${selected?.skill.id === s.id ? 'bg-gray-700 text-white' : 'hover:bg-gray-700'}`}\n                      aria-pressed={selected?.skill.id === s.id}\n                    >\n                      {s.name}  {s.type}{s.element ? `  ${s.element}` : ''}{s.cooldown ? `  CD ${s.cooldown}` : ''}\n                    </button>\n                  </li>\n                ))}\n              </ul>\n              {selected && selected.level === d.level && (\n                <div className=\"mt-2 p-2 rounded bg-gray-700 text-xs text-gray-200\">\n                  <div className=\"text-white font-semibold\">{selected.skill.name}</div>\n                  <div>Tipo: {selected.skill.type}{selected.skill.element ? `  ${selected.skill.element}` : ''}</div>\n                  {selected.skill.description && <div className=\"mt-1\">{selected.skill.description}</div>}\n                  {typeof selected.skill.cost === 'number' && <div>Custo: {selected.skill.cost}</div>}\n                  {typeof selected.skill.cooldown === 'number' && <div>Cooldown: {selected.skill.cooldown} turnos</div>}\n                  <div className=\"mt-1\">Pr-requisito: atingir nvel {d.level}</div>\n                  {onToggle && (\n                    <div className=\"mt-2 flex gap-2\">\n                      <button\n                        type=\"button\"\n                        onClick={() => onToggle(selected.skill.id)}\n                        className={`px-2 py-1 rounded ${plannedTalents.includes(selected.skill.id) ? 'bg-emerald-600 text-white' : 'bg-gray-600 text-gray-200 hover:bg-gray-500'}`}\n                      >\n                        {plannedTalents.includes(selected.skill.id) ? ' Planejada' : 'Planejar talento'}\n                      </button>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}","import { HeroClass, HeroRace, HeroAttributes } from '../types/hero'\nimport { CLASS_METADATA } from './classRegistry'\n\nexport function getRaceCompatibility(heroClass: HeroClass, race: HeroRace): { ok: boolean; message: string } {\n  const meta = CLASS_METADATA[heroClass]\n  if (!meta?.suggestedRaces || meta.suggestedRaces.length === 0) return { ok: true, message: 'Compatvel' }\n  const ok = meta.suggestedRaces.includes(race)\n  return {\n    ok,\n    message: ok ? 'Excelente sinergia de raa para esta classe.' : 'Funciona, mas no  a raa mais sinrgica para esta classe.'\n  }\n}\n\nexport function getRecommendedAttributePlan(heroClass: HeroClass): Array<{ attribute: keyof HeroAttributes; priority: 'alta'|'media'|'baixa'; hint: string }>{\n  const meta = CLASS_METADATA[heroClass]\n  if (!meta) return []\n  const b = meta.baseAttributes\n  const pick = (attr: keyof HeroAttributes, priority: 'alta'|'media'|'baixa'): { attribute: keyof HeroAttributes; priority: 'alta'|'media'|'baixa'; hint: string } => ({ attribute: attr, priority, hint: `Priorize ${attr} (${priority}). Base ${b[attr]}` })\n  switch (heroClass) {\n    case 'guerreiro': return [pick('forca','alta'), pick('constituicao','alta'), pick('destreza','media')]\n    case 'mago': return [pick('inteligencia','alta'), pick('sabedoria','alta'), pick('constituicao','media')]\n    case 'ladino': return [pick('destreza','alta'), pick('forca','media'), pick('carisma','media')]\n    case 'clerigo': return [pick('sabedoria','alta'), pick('inteligencia','media'), pick('constituicao','media')]\n    case 'patrulheiro': return [pick('destreza','alta'), pick('sabedoria','media'), pick('forca','media')]\n    case 'paladino': return [pick('constituicao','alta'), pick('forca','alta'), pick('sabedoria','media')]\n    case 'arqueiro': return [pick('destreza','alta'), pick('sabedoria','media'), pick('forca','media')]\n    case 'bardo': return [pick('carisma','alta'), pick('sabedoria','media'), pick('destreza','media')]\n    case 'monge': return [pick('constituicao','alta'), pick('destreza','alta'), pick('sabedoria','media')]\n    case 'assassino': return [pick('destreza','alta'), pick('forca','media'), pick('inteligencia','media')]\n    case 'barbaro': return [pick('forca','alta'), pick('constituicao','alta'), pick('destreza','media')]\n    case 'lanceiro': return [pick('destreza','alta'), pick('forca','alta'), pick('constituicao','media')]\n    case 'druida': return [pick('sabedoria','alta'), pick('inteligencia','media'), pick('constituicao','media')]\n    case 'feiticeiro': return [pick('inteligencia','alta'), pick('carisma','media'), pick('sabedoria','media')]\n    default: return []\n  }\n}","type Prefs = { autoSuggestDisabled?: boolean }\n\nexport function getPrefs(): Prefs {\n  try {\n    const raw = localStorage.getItem('hfn_prefs')\n    if (!raw) return {}\n    const obj = JSON.parse(raw)\n    return obj || {}\n  } catch { return {} }\n}\n\nexport function setPrefs(p: Prefs) {\n  try {\n    const existing = getPrefs()\n    const next = { ...existing, ...p }\n    localStorage.setItem('hfn_prefs', JSON.stringify(next))\n  } catch {}\n}","import { HeroClass } from '../types/hero'\nimport { PROGRESSION_SKILLS } from './skillSystem'\n\nconst CLASS_PREF: Record<HeroClass, ('attack'|'buff'|'support')[]> = {\n  guerreiro: ['attack','buff','support'],\n  mago: ['attack','buff','support'],\n  ladino: ['attack','buff','support'],\n  clerigo: ['support','buff','attack'],\n  patrulheiro: ['attack','buff','support'],\n  paladino: ['buff','attack','support'],\n  arqueiro: ['attack','buff','support'],\n  bardo: ['support','buff','attack'],\n  monge: ['buff','attack','support'],\n  assassino: ['attack','buff','support'],\n  barbaro: ['attack','buff','support'],\n  lanceiro: ['attack','buff','support'],\n  druida: ['support','buff','attack'],\n  feiticeiro: ['attack','buff','support']\n}\n\nexport function getRecommendedTalentPlan(heroClass: HeroClass): string[] {\n  const defs = PROGRESSION_SKILLS[heroClass] || []\n  const pref = CLASS_PREF[heroClass] || ['attack','buff','support']\n  const plan: string[] = []\n  for (const d of defs) {\n    const sorted = [...d.skills].sort((a,b) => pref.indexOf(a.type as any) - pref.indexOf(b.type as any))\n    const chosen = sorted[0]\n    if (chosen?.id) plan.push(chosen.id)\n  }\n  return plan\n}","import { HeroClass, HeroRace, HeroAttributes, Element } from '../types/hero'\nimport { CLASS_METADATA } from './classRegistry'\nimport { getRecommendedElements } from './elementSystem'\nimport { getRecommendedTalentPlan } from './talentRecommendations'\n\nexport function getClassPreset(heroClass: HeroClass, race: HeroRace): { attributes: HeroAttributes; element: Element; plannedTalents: string[] } {\n  const meta = CLASS_METADATA[heroClass]\n  const attributes = meta?.baseAttributes as HeroAttributes\n  const els = getRecommendedElements(heroClass, race)\n  const element = (els[0] as Element) || 'physical'\n  const plannedTalents = getRecommendedTalentPlan(heroClass)\n  return { attributes, element, plannedTalents }\n}","import { HeroClass, HeroRace, HeroCreationData } from '../types/hero'\nimport { createInitialAttributes } from './attributeSystem'\nimport { getClassPreset } from './buildPresets'\n\ntype Preset = { id: string; name: string; class: HeroClass; race: HeroRace }\n\nconst PRESETS: Preset[] = [\n  { id: 'guerreiro-humano-equilibrado', name: 'Guerreiro Humano  Equilibrado', class: 'guerreiro', race: 'humano' },\n  { id: 'guerreiro-anao-tanque', name: 'Guerreiro Ano  Tanque', class: 'guerreiro', race: 'anao' },\n\n  { id: 'mago-elfo-controle', name: 'Mago Elfo  Controle', class: 'mago', race: 'elfo' },\n  { id: 'mago-humano-raio', name: 'Mago Humano  Raio', class: 'mago', race: 'humano' },\n\n  { id: 'ladino-halfling-critico', name: 'Ladino Halfling  Crtico', class: 'ladino', race: 'halfling' },\n  { id: 'ladino-humano-evasao', name: 'Ladino Humano  Evaso', class: 'ladino', race: 'humano' },\n\n  { id: 'clerigo-humano-suporte', name: 'Clrigo Humano  Suporte', class: 'clerigo', race: 'humano' },\n  { id: 'clerigo-elfo-luz', name: 'Clrigo Elfo  Luz', class: 'clerigo', race: 'elfo' },\n\n  { id: 'patrulheiro-elfo-precisao', name: 'Patrulheiro Elfo  Preciso', class: 'patrulheiro', race: 'elfo' },\n  { id: 'patrulheiro-humano-versatil', name: 'Patrulheiro Humano  Verstil', class: 'patrulheiro', race: 'humano' },\n\n  { id: 'paladino-humano-defesa', name: 'Paladino Humano  Defesa', class: 'paladino', race: 'humano' },\n  { id: 'paladino-anao-resistencia', name: 'Paladino Ano  Resistncia', class: 'paladino', race: 'anao' },\n\n  { id: 'arqueiro-elfo-critico', name: 'Arqueiro Elfo  Crtico', class: 'arqueiro', race: 'elfo' },\n  { id: 'arqueiro-halfling-precisao', name: 'Arqueiro Halfling  Preciso', class: 'arqueiro', race: 'halfling' },\n\n  { id: 'bardo-humano-buffs', name: 'Bardo Humano  Buffs', class: 'bardo', race: 'humano' },\n  { id: 'bardo-elfo-controle', name: 'Bardo Elfo  Controle', class: 'bardo', race: 'elfo' },\n\n  { id: 'monge-humano-regeneracao', name: 'Monge Humano  Regenerao', class: 'monge', race: 'humano' },\n\n  { id: 'assassino-halfling-critico', name: 'Assassino Halfling  Crtico', class: 'assassino', race: 'halfling' },\n  { id: 'assassino-humano-furtividade', name: 'Assassino Humano  Furtividade', class: 'assassino', race: 'humano' },\n\n  { id: 'barbaro-orc-fogo', name: 'Brbaro Orc  Fogo', class: 'barbaro', race: 'orc' },\n  { id: 'barbaro-humano-terra', name: 'Brbaro Humano  Terra', class: 'barbaro', race: 'humano' },\n\n  { id: 'lanceiro-elfo-perfuracao', name: 'Lanceiro Elfo  Perfurao', class: 'lanceiro', race: 'elfo' },\n  { id: 'lanceiro-humano-salto', name: 'Lanceiro Humano  Salto', class: 'lanceiro', race: 'humano' },\n\n  { id: 'druida-elfo-equilibrado', name: 'Druida Elfo  Equilibrado', class: 'druida', race: 'elfo' },\n  { id: 'druida-humano-suporte', name: 'Druida Humano  Suporte', class: 'druida', race: 'humano' },\n\n  { id: 'feiticeiro-humano-debuffs', name: 'Feiticeiro Humano  Debuffs', class: 'feiticeiro', race: 'humano' },\n  { id: 'feiticeiro-orc-invocacoes', name: 'Feiticeiro Orc  Invocaes', class: 'feiticeiro', race: 'orc' }\n]\n\nexport function getPresetOptions(): Preset[] { return PRESETS }\n\nexport function buildFromPreset(p: Preset): Partial<HeroCreationData> {\n  const base = getClassPreset(p.class, p.race)\n  return {\n    name: '',\n    race: p.race,\n    class: p.class,\n    alignment: 'neutro-puro',\n    attributes: base.attributes || createInitialAttributes(),\n    element: base.element,\n    plannedTalents: base.plannedTalents\n  }\n}","import { HeroCreationData } from '../types/hero'\n\nconst KEY = 'hfn_creation_draft'\n\nexport function saveDraft(d: Partial<HeroCreationData>) {\n  try { localStorage.setItem(KEY, JSON.stringify(d)) } catch {}\n}\n\nexport function loadDraft(): Partial<HeroCreationData> | null {\n  try { const raw = localStorage.getItem(KEY); return raw ? JSON.parse(raw) : null } catch { return null }\n}\n\nexport function clearDraft() {\n  try { localStorage.removeItem(KEY) } catch {}\n}","import { HeroCreationData } from '../types/hero'\nimport { CLASS_METADATA } from './classRegistry'\nimport { calculateRemainingPoints } from './attributeSystem'\n\nexport function validateBuild(data: HeroCreationData): { ok: boolean; issues: string[] } {\n  const issues: string[] = []\n  const meta = CLASS_METADATA[data.class]\n  if (meta?.requirements) {\n    const check = meta.requirements({ attributes: data.attributes, race: data.race })\n    if (!check.ok) issues.push(check.message || 'Requisitos da classe no atendidos')\n  }\n  const remaining = calculateRemainingPoints(data.attributes)\n  if (remaining !== 0) issues.push(`Pontos de atributo restantes devem ser 0, atual: ${remaining}`)\n  if (!data.name || String(data.name).trim().length < 2) issues.push('Nome do heri no definido')\n  if (!data.race) issues.push('Raa no selecionada')\n  if (!data.class) issues.push('Classe no selecionada')\n  return { ok: issues.length === 0, issues }\n}","import { HeroCreationData } from '../types/hero'\nimport { CLASS_METADATA } from './classRegistry'\nimport { calculateRemainingPoints } from './attributeSystem'\nimport { getRecommendedElements } from './elementSystem'\n\nexport type ChecklistItem = { label: string; status: 'ok'|'warn'|'error'; detail?: string }\n\nexport function buildChecklist(data: HeroCreationData): ChecklistItem[] {\n  const items: ChecklistItem[] = []\n  const rem = calculateRemainingPoints(data.attributes)\n  items.push({ label: 'Atributos', status: rem === 0 ? 'ok' : rem > 0 ? 'warn' : 'error', detail: rem === 0 ? 'Distribuio completa' : `Restantes: ${rem}` })\n  const meta = CLASS_METADATA[data.class]\n  if (meta?.requirements) {\n    const check = meta.requirements({ attributes: data.attributes, race: data.race })\n    items.push({ label: 'Requisitos de Classe', status: check.ok ? 'ok' : 'error', detail: check.ok ? 'OK' : (check.message || 'Pendentes') })\n  } else {\n    items.push({ label: 'Requisitos de Classe', status: 'ok', detail: 'OK' })\n  }\n  const recEls = getRecommendedElements(data.class, data.race)\n  const hasElem = recEls.includes(data.element)\n  items.push({ label: 'Sinergia de Elemento', status: hasElem ? 'ok' : 'warn', detail: hasElem ? 'Ideal' : `Recomendados: ${recEls.join(', ')}` })\n  const basicsOk = !!data.name && !!data.race && !!data.class\n  items.push({ label: 'Campos Bsicos', status: basicsOk ? 'ok' : 'error', detail: basicsOk ? 'Nome/Raa/Classe OK' : 'Preencha todos os campos' })\n  return items\n}\n\nexport function buildReadiness(data: HeroCreationData): { status: 'ok'|'warn'|'error'; message: string } {\n  const items = buildChecklist(data)\n  if (items.some(i => i.status === 'error')) return { status: 'error', message: 'Pendncias crticas' }\n  if (items.some(i => i.status === 'warn')) return { status: 'warn', message: 'Ajustes recomendados' }\n  return { status: 'ok', message: 'Pronto para criar' }\n}","import { HeroClass } from '../types/hero'\n\nconst TIPS: Record<HeroClass, string[]> = {\n  guerreiro: ['Priorize fora e constituio', 'Elementos fsicos ou terra so estveis'],\n  mago: ['Inteligncia e sabedoria elevadas', 'Luz, gelo ou trevas trazem controle'],\n  ladino: ['Destreza alta para crticos', 'Evite elementos lentos'],\n  clerigo: ['Sabedoria e suporte', 'Luz favorece cura'],\n  patrulheiro: ['Destreza e viso ttica', 'Trovo e vento ajudam mobilidade'],\n  paladino: ['Constituio e fora', 'Luz para defesa e cura'],\n  arqueiro: ['Destreza e preciso', 'Trovo ou gelo para controle'],\n  bardo: ['Carisma e sabedoria', 'Suporte de grupo  essencial'],\n  monge: ['Constituio e destreza', 'Terra e vento aumentam sobrevivncia'],\n  assassino: ['Destreza e burst', 'Trevas para sinergia com crtico'],\n  barbaro: ['Fora e constituio', 'Fogo aumenta dano'],\n  lanceiro: ['Destreza e fora', 'Trovo aumenta alcance'],\n  druida: ['Sabedoria e inteligncia', 'Terra e vento combinam com controle'],\n  feiticeiro: ['Inteligncia e carisma', 'Trevas favorecem debuffs']\n}\n\nexport function getClassTips(heroClass: HeroClass): string[] { return TIPS[heroClass] || [] }","// CACHE BUSTER - TIMESTAMP: 2024-12-19-19:52\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { HeroCreationData, HeroRace, HeroClass, Alignment, Element, HeroAttributes } from '../types/hero';\nimport { useHeroStore, calculateDerivedAttributes } from '../store/heroStore';\nimport { generateStory } from '../utils/story';\nimport { gerarTexto } from '../services/groqTextService';\nimport { generateHeroWithAI } from '../services/heroCreateService';\nimport { notificationBus } from './NotificationSystem';\n\nimport { \n  generateName, \n  generateNameOptions, \n  getBattleQuote, \n  validateCustomName \n} from '../utils/nameGenerator';\nimport { \n  createInitialAttributes,\n  validateAttributes,\n  increaseAttribute,\n  decreaseAttribute,\n  canIncreaseAttribute,\n  canDecreaseAttribute,\n  calculateRemainingPoints,\n  autoDistributePoints,\n  ATTRIBUTE_INFO\n} from '../utils/attributeSystem';\nimport { \n  ELEMENT_INFO, \n  generateRandomElement, \n  getRecommendedElements,\n  getElementAdvantageInfo\n} from '../utils/elementSystem';\nimport { getClassSkills } from '../utils/skillSystem';\nimport { medievalTheme, seasonalThemes, getSeasonalButtonGradient, getSeasonalButtonColors } from '../styles/medievalTheme';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport TalentTreePreview from './TalentTreePreview';\nimport { CLASS_METADATA } from '../utils/classRegistry';\nimport { getRaceCompatibility, getRecommendedAttributePlan } from '../utils/compatibility';\nimport { getElementSuggestionReason } from '../utils/synergyExplain';\nimport { getPrefs, setPrefs } from '../utils/userPreferences';\nimport { getRecommendedTalentPlan } from '../utils/talentRecommendations';\nimport { getClassPreset } from '../utils/buildPresets';\nimport { getPresetOptions, buildFromPreset } from '../utils/presetLibrary';\nimport { saveDraft, loadDraft, clearDraft } from '../utils/creationDraft';\nimport ErrorBoundary from './ErrorBoundary';\nimport { validateBuild } from '../utils/buildValidate';\nimport { buildChecklist, buildReadiness } from '../utils/buildSummary';\nimport { getClassTips } from '../utils/classTips';\n\nconst HeroForm = () => {\n  const [formData, setFormData] = useState<HeroCreationData>({\n    name: '',\n    race: 'humano',\n    class: 'guerreiro',\n    alignment: 'neutro-puro',\n    attributes: createInitialAttributes(),\n    background: '',\n    backstory: '',\n    element: 'physical',\n    skills: [],\n    image: '',\n    battleQuote: ''\n  });\n  \n  const [loadingStory, setLoadingStory] = useState(false);\n  const [loadingName, setLoadingName] = useState(false);\n  const [loadingNameAI, setLoadingNameAI] = useState(false);\n  const [loadingQuoteAI, setLoadingQuoteAI] = useState(false);\n  const [loadingHFStory, setLoadingHFStory] = useState(false);\n  const [loadingHeroAI, setLoadingHeroAI] = useState(false);\n  const [loadingImageAI, setLoadingImageAI] = useState(false);\n  const [nameOptions, setNameOptions] = useState<string[]>([]);\n  const [showNameOptions, setShowNameOptions] = useState(false);\n  const [showSkillDetails, setShowSkillDetails] = useState<string | null>(null);\n  const [showElementTooltip, setShowElementTooltip] = useState(false);\n  const [limitWarning, setLimitWarning] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [confirmOpen, setConfirmOpen] = useState(false);\n  const [creationLog, setCreationLog] = useState<string[]>([]);\n  const [decisionHistory, setDecisionHistory] = useState<Array<{ field: 'class'|'race'|'element'; prev: string; next: string; timestamp: string }>>([]);\n  const [redoHistory, setRedoHistory] = useState<Array<{ field: 'class'|'race'|'element'; prev: string; next: string; timestamp: string }>>([]);\n  const { createHero, acceptReferralInvite } = useHeroStore();\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const searchParams = new URLSearchParams(location.search);\n  const referralCode = searchParams.get('ref') || undefined;\n  const inviterBy = searchParams.get('by') || undefined;\n  const [showAdvanced, setShowAdvanced] = useState(false);\n  const buttonPrimary = `px-3 py-2 rounded bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white hover:brightness-110 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1`;\n  const buttonSecondary = 'px-2 py-1 rounded bg-gray-600 text-white text-xs hover:bg-gray-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1';\n\n  const remainingPoints = calculateRemainingPoints(formData.attributes);\n  const classSkills = getClassSkills(formData.class);\n\n  const derivedPreview = React.useMemo(() => {\n    try {\n      return calculateDerivedAttributes(formData.attributes as HeroAttributes, formData.class, 1);\n    } catch {\n      return undefined;\n    }\n  }, [formData.attributes, formData.class]);\n\n  useEffect(() => {\n    const adv = getElementAdvantageInfo(formData.element);\n    console.log('[hero-form] element-adv', { element: formData.element, adv });\n    console.log('[hero-form] class-meta', CLASS_METADATA[formData.class]);\n    const prefs = getPrefs();\n    if (typeof prefs.autoSuggestDisabled === 'boolean') setDisableAutoSuggestion(prefs.autoSuggestDisabled);\n  }, [formData.element, formData.class]);\n\n  useEffect(() => {\n    const onKey = (e: KeyboardEvent) => {\n      if (e.altKey && (e.key.toLowerCase() === 'v')) {\n        const res = validateBuild(formData as any)\n        if (res.ok) setLimitWarning('Build vlido ')\n        else setLimitWarning(res.issues.join('  '))\n      } else if (e.altKey && (e.key.toLowerCase() === 'a')) {\n        const recEls = getRecommendedElements(formData.class, formData.race)\n        if (recEls.length) handleElementChange(recEls[0] as Element)\n        handleAutoDistributeRecommended()\n        setFormData(prev => ({ ...prev, plannedTalents: getRecommendedTalentPlan(prev.class) }))\n        setLimitWarning('Recomendaes aplicadas')\n      }\n    }\n    window.addEventListener('keydown', onKey)\n    return () => window.removeEventListener('keydown', onKey)\n  }, [formData])\n\n  const draftTimer = useRef<number | null>(null);\n  useEffect(() => {\n    if (draftTimer.current) window.clearTimeout(draftTimer.current)\n    draftTimer.current = window.setTimeout(() => { saveDraft(formData) }, 300)\n  }, [formData]);\n\n  useEffect(() => {\n    const handler = () => { try { saveDraft(formData) } catch {} };\n    window.addEventListener('beforeunload', handler);\n    return () => window.removeEventListener('beforeunload', handler);\n  }, [formData]);\n\n  const handleGenerateName = async () => {\n    setLoadingName(true);\n    try {\n      const options = generateNameOptions(formData.race, 5, (formData as any).gender);\n      setNameOptions(options);\n      setShowNameOptions(true);\n    } catch (error) {\n      console.error('Erro ao gerar nomes:', error);\n    } finally {\n      setLoadingName(false);\n    }\n  };\n\n  const handleSelectName = (name: string) => {\n    setFormData(prev => ({ ...prev, name }));\n    setShowNameOptions(false);\n  };\n\n  const handleGenerateNameAI = async () => {\n    setLoadingNameAI(true);\n    try {\n      const nome = await gerarTexto('nome', `sexo: ${(formData as any).gender}; raa: ${formData.race}; classe: ${formData.class}`);\n      if (nome) {\n        setFormData(prev => ({ ...prev, name: nome }));\n        setShowNameOptions(false);\n      }\n    } catch (error) {\n      console.error('Erro ao gerar nome via IA:', error);\n    } finally {\n      setLoadingNameAI(false);\n    }\n  };\n\n  const handleAttributeChange = (attribute: keyof HeroAttributes, increase: boolean) => {\n    let newAttributes = formData.attributes;\n    \n    if (increase && canIncreaseAttribute(formData.attributes, attribute)) {\n      newAttributes = increaseAttribute(formData.attributes, attribute);\n    } else if (!increase && canDecreaseAttribute(formData.attributes, attribute)) {\n      newAttributes = decreaseAttribute(formData.attributes, attribute);\n    }\n    \n    if (newAttributes !== formData.attributes) {\n      setFormData(prev => ({ ...prev, attributes: newAttributes }));\n    }\n  };\n\n  const handleAutoDistribute = () => {\n    const newAttributes = autoDistributePoints(formData.attributes);\n    setFormData(prev => ({ ...prev, attributes: newAttributes }));\n  };\n\n  const handleAutoDistributeRecommended = () => {\n    const plan = getRecommendedAttributePlan(formData.class);\n    const rc = getRaceCompatibility(formData.class, formData.race as any);\n    const weights: Record<string, number> = { alta: rc.ok ? 3 : 2, media: 1, baixa: 0.5 } as any;\n    const elemBonus: Record<string, number> = {\n      forca: formData.element === 'fire' ? 1 : 0,\n      destreza: formData.element === 'thunder' || formData.element === 'ice' ? 1 : 0,\n      constituicao: formData.element === 'earth' ? 1 : 0,\n      inteligencia: (formData.element === 'dark' || formData.element === 'ice' || formData.element === 'light') ? 1 : 0\n    } as any;\n    let remaining = calculateRemainingPoints(formData.attributes);\n    let attrs = { ...formData.attributes } as any;\n    const order = plan.sort((a,b) => (((weights[a.priority] + (elemBonus[a.attribute] || 0)) * (advWeights[a.attribute] || 1)) > ((weights[b.priority] + (elemBonus[b.attribute] || 0)) * (advWeights[b.attribute] || 1)) ? -1 : 1));\n    while (remaining > 0) {\n      let progressed = false;\n      for (const p of order) {\n        if (remaining <= 0) break;\n        const attrKey = p.attribute as any;\n        if (canIncreaseAttribute(attrs, attrKey)) {\n          attrs = increaseAttribute(attrs, attrKey);\n          remaining = calculateRemainingPoints(attrs);\n          progressed = true;\n        }\n      }\n      if (!progressed) break;\n    }\n    setFormData(prev => ({ ...prev, attributes: attrs }));\n  };\n\n  const [elementAutoSuggested, setElementAutoSuggested] = useState(false);\n  const [prevElement, setPrevElement] = useState<Element | null>(null);\n  const [disableAutoSuggestion, setDisableAutoSuggestion] = useState(false);\n  const [showSuggestionInfo, setShowSuggestionInfo] = useState(true);\n  const [advancedOpen, setAdvancedOpen] = useState(false);\n  const [advWeights, setAdvWeights] = useState<Record<string, number>>({ forca:1, destreza:1, constituicao:1, inteligencia:1, sabedoria:1, carisma:1 });\n  const [showSynergyDetails, setShowSynergyDetails] = useState(false);\n\n  const handleElementChange = (element: Element) => {\n    setFormData(prev => ({ \n      ...prev, \n      element,\n      skills: getClassSkills(prev.class)\n    }));\n    setElementAutoSuggested(false);\n    setPrevElement(null);\n    setCreationLog(prev => [...prev, `Elemento alterado para ${element}`]);\n    setDecisionHistory(prev => [...prev, { field: 'element', prev: String(formData.element), next: String(element), timestamp: new Date().toISOString() }]);\n    setRedoHistory([]);\n  };\n\n  const handleGenerateRandomElement = () => {\n    const randomElement = generateRandomElement();\n    handleElementChange(randomElement);\n  };\n\n  const handleClassChange = (newClass: HeroClass) => {\n    const meta = CLASS_METADATA[newClass];\n    if (meta?.requirements) {\n      const check = meta.requirements({ attributes: formData.attributes, race: formData.race });\n      if (!check.ok) { setLimitWarning(check.message || 'Requisitos da classe no atendidos.'); return; }\n    }\n    const newSkills = getClassSkills(newClass);\n    const newBattleQuote = getBattleQuote(newClass);\n    const recEls = getRecommendedElements(newClass, formData.race);\n    const nextElement = disableAutoSuggestion ? formData.element : ((formData.element === 'physical' || !recEls.includes(formData.element)) && recEls.length ? (recEls[0] as Element) : formData.element);\n    \n    setFormData(prev => ({ \n      ...prev, \n      class: newClass,\n      skills: newSkills,\n      battleQuote: newBattleQuote,\n      element: nextElement,\n      plannedTalents: []\n    }));\n    if (!disableAutoSuggestion && nextElement !== formData.element) { setPrevElement(formData.element); setElementAutoSuggested(true); setShowSuggestionInfo(true); }\n    setCreationLog(prev => [...prev, `Classe alterada para ${newClass}`]);\n    setDecisionHistory(prev => [...prev, { field: 'class', prev: String(formData.class), next: String(newClass), timestamp: new Date().toISOString() }]);\n    setRedoHistory([]);\n  };\n\n  \n\n  const handleRaceChange = (race: HeroRace) => {\n    const recEls = getRecommendedElements(formData.class, race);\n    const nextElement = disableAutoSuggestion ? formData.element : ((formData.element === 'physical' || !recEls.includes(formData.element)) && recEls.length ? (recEls[0] as Element) : formData.element);\n    setFormData(prev => ({ ...prev, race, element: nextElement }));\n    if (!disableAutoSuggestion && nextElement !== formData.element) { setPrevElement(formData.element); setElementAutoSuggested(true); setShowSuggestionInfo(true); }\n    setCreationLog(prev => [...prev, `Raa alterada para ${race}`]);\n    setDecisionHistory(prev => [...prev, { field: 'race', prev: String(formData.race), next: String(race), timestamp: new Date().toISOString() }]);\n    setRedoHistory([]);\n  };\n\n  const applyClassBaseAttributes = () => {\n    const meta = CLASS_METADATA[formData.class];\n    if (meta) {\n      setFormData(prev => ({ ...prev, attributes: { ...meta.baseAttributes } }));\n    }\n  };\n\n  const finalizeCreation = () => {\n    try {\n      const created = createHero(formData);\n      if (referralCode) {\n        acceptReferralInvite(referralCode, created.id);\n        try {\n          const inv = useHeroStore.getState().getReferralInviteByCode(referralCode);\n          if (inv?.id) {\n            useHeroStore.getState().logReferralActivity(inv.id, 'accepted', inviterBy ? `by:${inviterBy}` : `new:${created.id}`);\n          }\n        } catch {}\n      }\n      setConfirmOpen(false);\n      navigate('/');\n    } catch (error) {\n      console.error('Erro ao criar heri:', error);\n      setLimitWarning('Erro ao criar heri. Tente novamente.');\n    }\n  };\n\n  const handleGenerateBattleQuote = () => {\n    const quote = getBattleQuote(formData.class);\n    setFormData(prev => ({ ...prev, battleQuote: quote }));\n  };\n\n  const handleGenerateBattleQuoteAI = async () => {\n    setLoadingQuoteAI(true);\n    try {\n      const contexto = `${formData.name || 'Heri'}; classe ${formData.class}; sexo ${(formData as any).gender || 'masculino'}; resumo: ${(formData.backstory || '').slice(0, 180)}`;\n      const frase = await gerarTexto('frase', contexto);\n      if (frase) {\n        setFormData(prev => ({ ...prev, battleQuote: frase }));\n        notificationBus.emit({\n          type: 'achievement',\n          title: 'Frase gerada!',\n          message: 'A frase de batalha foi atualizada.',\n          icon: '',\n          duration: 3500\n        });\n      }\n    } catch (error) {\n      console.error('Erro ao gerar frase via IA:', error);\n      notificationBus.emit({\n        type: 'quest',\n        title: 'Falha ao gerar frase',\n        message: 'Verifique a chave de IA e a conexo.',\n        icon: '',\n        duration: 4500\n      });\n    } finally {\n      setLoadingQuoteAI(false);\n    }\n  };\n\n  const handleGenerateHeroAI = async () => {\n    setLoadingHeroAI(true);\n    try {\n      const result = await generateHeroWithAI({\n        race: formData.race,\n        klass: formData.class,\n        attrs: formData.attributes as Record<string, number>,\n        gender: formData.gender\n      });\n      setFormData(prev => ({\n        ...prev,\n        name: result.name || prev.name,\n        backstory: result.story || prev.backstory,\n        battleQuote: result.phrase || prev.battleQuote,\n        image: result.image || prev.image\n      }));\n      setShowNameOptions(false);\n      notificationBus.emit({\n        type: 'achievement',\n        title: 'Heri gerado!',\n        message: 'Nome, histria, frase e imagem atualizados.',\n        icon: '',\n        duration: 4500\n      });\n    } catch (error) {\n      console.error('Erro ao gerar heri via IA:', error);\n      setLimitWarning('Falha ao gerar heri com IA. Tente novamente.');\n      notificationBus.emit({\n        type: 'quest',\n        title: 'Falha ao gerar heri',\n        message: 'Tente novamente mais tarde.',\n        icon: '',\n        duration: 4500\n      });\n    } finally {\n      setLoadingHeroAI(false);\n    }\n  };\n\n  const handleGenerateImageAI = async () => {\n    setLoadingImageAI(true);\n    try {\n      const result = await generateHeroWithAI({\n        race: formData.race,\n        klass: formData.class,\n        attrs: formData.attributes as Record<string, number>,\n        gender: formData.gender\n      });\n      if (result.image) {\n        setFormData(prev => ({ ...prev, image: result.image }));\n        notificationBus.emit({\n          type: 'achievement',\n          title: 'Avatar gerado!',\n          message: 'Imagem criada com IA usando seus dados.',\n          icon: '',\n          duration: 4000\n        });\n      } else {\n        setLimitWarning('A IA no retornou uma imagem. Tente novamente.');\n      }\n    } catch (error) {\n      console.error('Erro ao gerar imagem via IA:', error);\n      setLimitWarning('Falha ao gerar imagem com IA. Tente novamente mais tarde.');\n      notificationBus.emit({\n        type: 'quest',\n        title: 'Falha na gerao de imagem',\n        message: 'Tente novamente mais tarde.',\n        icon: '',\n        duration: 4500\n      });\n    } finally {\n      setLoadingImageAI(false);\n    }\n  };\n\n  const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const result = e.target?.result as string;\n        setFormData(prev => ({ ...prev, image: result }));\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    const meta = CLASS_METADATA[formData.class];\n    if (meta?.requirements) {\n      const check = meta.requirements({ attributes: formData.attributes, race: formData.race });\n      if (!check.ok) {\n        setLimitWarning(check.message || 'Requisitos da classe no atendidos.');\n        return;\n      }\n    }\n    \n    const validation = validateAttributes(formData.attributes);\n    if (!validation.valid) {\n      setLimitWarning(validation.errors.join(', ') || 'Atributos invlidos');\n      return;\n    }\n    \n    if (!formData.name.trim()) {\n      setLimitWarning('Nome  obrigatrio');\n      return;\n    }\n\n    const nameValidation = validateCustomName(formData.name);\n    if (!nameValidation.valid) {\n      setLimitWarning(nameValidation.message || 'Nome invlido');\n      return;\n    }\n    \n    setConfirmOpen(true);\n  };\n  const handleUndoLastDecision = () => {\n    const last = decisionHistory.slice(-1)[0];\n    if (!last) return;\n    setDecisionHistory(prev => prev.slice(0, -1));\n    setRedoHistory(prev => [...prev, last]);\n    if (last.field === 'class') {\n      const prevClass = last.prev as HeroClass;\n      const newSkills = getClassSkills(prevClass);\n      const newQuote = getBattleQuote(prevClass);\n      setFormData(prev => ({ ...prev, class: prevClass, skills: newSkills, battleQuote: newQuote }));\n      setCreationLog(prev => [...prev, `Desfeito: classe voltou para ${prevClass}`]);\n    } else if (last.field === 'race') {\n      const prevRace = last.prev as HeroRace;\n      setFormData(prev => ({ ...prev, race: prevRace }));\n      setCreationLog(prev => [...prev, `Desfeito: raa voltou para ${prevRace}`]);\n    } else if (last.field === 'element') {\n      const prevEl = last.prev as Element;\n      setFormData(prev => ({ ...prev, element: prevEl, skills: getClassSkills(prev.class) }));\n      setCreationLog(prev => [...prev, `Desfeito: elemento voltou para ${prevEl}`]);\n    }\n  };\n\n  const handleRedoLastDecision = () => {\n    const last = redoHistory.slice(-1)[0];\n    if (!last) return;\n    setRedoHistory(prev => prev.slice(0, -1));\n    setDecisionHistory(prev => [...prev, last]);\n    if (last.field === 'class') {\n      const nextClass = last.next as HeroClass;\n      const newSkills = getClassSkills(nextClass);\n      const newQuote = getBattleQuote(nextClass);\n      setFormData(prev => ({ ...prev, class: nextClass, skills: newSkills, battleQuote: newQuote }));\n      setCreationLog(prev => [...prev, `Refeito: classe alterada para ${nextClass}`]);\n    } else if (last.field === 'race') {\n      const nextRace = last.next as HeroRace;\n      setFormData(prev => ({ ...prev, race: nextRace }));\n      setCreationLog(prev => [...prev, `Refeito: raa alterada para ${nextRace}`]);\n    } else if (last.field === 'element') {\n      const nextEl = last.next as Element;\n      setFormData(prev => ({ ...prev, element: nextEl, skills: getClassSkills(prev.class) }));\n      setCreationLog(prev => [...prev, `Refeito: elemento alterado para ${nextEl}`]);\n    }\n  };\n  \n  return (\n    <div className=\"max-w-4xl mx-auto p-6 bg-gray-800 rounded-lg shadow-lg\">\n      <h2 className=\"text-3xl font-bold text-amber-400 mb-2 text-center\">Forjar Novo Heri - Verso 3.0</h2>\n      {(() => { const r = buildReadiness(formData as any); return (\n        <div className={`mb-4 p-2 rounded text-sm text-center ${r.status === 'ok' ? 'bg-emerald-700/30 text-emerald-200' : r.status === 'warn' ? 'bg-amber-700/30 text-amber-200' : 'bg-red-700/30 text-red-200'}`}>Prontido do build: {r.message}</div>\n      ) })()}\n      <div className=\"mb-4 flex items-center justify-end gap-2\">\n        <select\n          onChange={(e) => {\n            const p = getPresetOptions().find(x => x.id === e.target.value)\n            if (p) setFormData(prev => ({ ...prev, ...(buildFromPreset(p) as any) }))\n          }}\n          defaultValue=\"\"\n          className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\"\n        >\n          <option value=\"\" disabled>Carregar preset...</option>\n          {getPresetOptions().map(o => (<option key={o.id} value={o.id}>{o.name}</option>))}\n        </select>\n        \n      </div>\n      \n      <ErrorBoundary>\n      <form onSubmit={handleSubmit} className=\"space-y-8\">\n        {/* Seo 1: Raa e Nome */}\n        <div className=\"bg-gray-700 p-4 rounded-lg\">\n          <h3 className=\"text-xl font-semibold text-amber-400 mb-4\">1. Raa e Nome</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300\">Raa</label>\n              <select\n                value={formData.race}\n                onChange={(e) => handleRaceChange(e.target.value as HeroRace)}\n                className=\"mt-1 block w-full rounded-md bg-gray-600 border-gray-500 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n              >\n                <option value=\"humano\">Humano</option>\n                <option value=\"elfo\">Elfo</option>\n                <option value=\"anao\">Ano</option>\n                <option value=\"orc\">Orc</option>\n                <option value=\"halfling\">Halfling</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300\">Nome</label>\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({...formData, name: e.target.value})}\n                  className=\"mt-1 block w-full rounded-md bg-gray-600 border-gray-500 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                  placeholder=\"Nome do heri\"\n                  required\n                />\n                <button\n                  type=\"button\"\n                  onClick={handleGenerateName}\n                  disabled={loadingName}\n                  className=\"mt-1 px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-md text-sm font-medium transition-colors disabled:opacity-60\"\n                >\n                  {loadingName ? '...' : ''}\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={handleGenerateNameAI}\n                  disabled={loadingNameAI}\n                  className=\"mt-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-sm font-medium transition-colors disabled:opacity-60\"\n                >\n                  {loadingNameAI ? '...' : ' IA'}\n                </button>\n                {/* Boto 'Gerar com IA' removido por no estar em uso */}\n              </div>\n              \n              {showNameOptions && (\n                <div className=\"mt-2 p-2 bg-gray-600 rounded-md\">\n                  <p className=\"text-xs text-gray-300 mb-2\">Sugestes para {formData.race}:</p>\n                  <div className=\"flex flex-wrap gap-1\">\n                    {nameOptions.map((name, index) => (\n                      <button\n                        key={index}\n                        type=\"button\"\n                        onClick={() => handleSelectName(name)}\n                        className=\"px-2 py-1 bg-purple-600 hover:bg-purple-700 rounded text-xs transition-colors\"\n                      >\n                        {name}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n              {getClassTips(formData.class).length > 0 && (\n                <div className=\"mt-2 p-2 rounded bg-gray-800 text-xs text-gray-200\">\n                  <div className=\"font-semibold\">Dicas de classe</div>\n                  <ul className=\"mt-1 list-disc pl-5\">\n                    {getClassTips(formData.class).map((t, i) => (<li key={`tip-${i}`}>{t}</li>))}\n                  </ul>\n                </div>\n              )}\n            </div>\n          </div>\n          <div className=\"mt-3\">\n            <label className=\"block text-sm font-medium text-gray-300\">Sexo</label>\n            <div className=\"mt-1 flex gap-2\">\n              <button type=\"button\" onClick={() => setFormData(prev => ({ ...prev, gender: 'masculino' as any }))} className={`px-3 py-2 rounded ${(((formData as any).gender) || 'masculino') === 'masculino' ? 'bg-indigo-600 text-white' : 'bg-gray-600 text-gray-200'}`}>Masculino</button>\n              <button type=\"button\" onClick={() => setFormData(prev => ({ ...prev, gender: 'feminino' as any }))} className={`px-3 py-2 rounded ${(((formData as any).gender)) === 'feminino' ? 'bg-pink-600 text-white' : 'bg-gray-600 text-gray-200'}`}>Feminino</button>\n            </div>\n          </div>\n        </div>\n\n        {/* Seo 2: Classe e Skills */}\n        <div className=\"bg-gray-700 p-4 rounded-lg\">\n          <h3 className=\"text-xl font-semibold text-amber-400 mb-4\">2. Classe e Habilidades</h3>\n          <div className=\"mb-4\">\n            <label className=\"block text-sm font-medium text-gray-300\">Classe</label>\n            <div role=\"radiogroup\" aria-label=\"Seleo de classe\" className=\"mt-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\n              {Object.values(CLASS_METADATA).map((meta, idx, arr) => (\n                <button\n                  key={meta.id}\n                  type=\"button\"\n                  role=\"radio\"\n                  aria-checked={formData.class === meta.id}\n                  onClick={() => handleClassChange(meta.id)}\n                  onKeyDown={(e) => {\n                    const ids = arr.map(m => m.id as HeroClass);\n                    const curIdx = ids.indexOf(formData.class);\n                    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {\n                      const next = ids[(curIdx + 1) % ids.length];\n                      handleClassChange(next);\n                    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {\n                      const prev = ids[(curIdx - 1 + ids.length) % ids.length];\n                      handleClassChange(prev);\n                    }\n                  }}\n                  className={`text-left p-3 rounded border transition-transform duration-200 active:scale-95 focus:scale-105 ${formData.class === meta.id ? 'border-amber-500 bg-amber-500/20' : 'border-gray-600 bg-gray-700'} hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                  tabIndex={0}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"text-white font-semibold\">{meta.icon} {meta.name}</div>\n                    {formData.class === meta.id && <span className=\"text-xs text-amber-300\">Selecionado</span>}\n                  </div>\n                  <p className=\"text-xs text-gray-300 mt-1\">{meta.description}</p>\n                  <div className=\"mt-2 text-xs text-gray-400\">Atributos base: {Object.entries(meta.baseAttributes).map(([k,v]) => `${k}:${v}`).join('  ')}</div>\n                  <div className=\"mt-2 text-xs text-emerald-300\">Vantagens: {meta.advantages.join(', ')}</div>\n                  {meta.disadvantages.length > 0 && <div className=\"mt-1 text-xs text-red-300\">Desvantagens: {meta.disadvantages.join(', ')}</div>}\n                  {meta.requirements && (() => { const c = meta.requirements({ attributes: formData.attributes, race: formData.race }); return <div className={`mt-1 text-xs ${c.ok ? 'text-emerald-300' : 'text-yellow-300'}`}>{c.ok ? 'Requisitos atendidos' : c.message || 'Requisitos pendentes'}</div>; })()}\n                </button>\n              ))}\n            </div>\n          <div className=\"mt-3 flex flex-wrap gap-2\">\n            <button type=\"button\" onClick={() => { const p = getClassPreset(formData.class, formData.race); setFormData(prev => ({ ...prev, attributes: p.attributes, element: p.element, plannedTalents: p.plannedTalents })); }} className={buttonPrimary}>Aplicar preset de classe</button>\n            <button type=\"button\" onClick={() => { const recEls = getRecommendedElements(formData.class, formData.race); if (recEls.length) handleElementChange(recEls[0] as Element); handleAutoDistributeRecommended(); setFormData(prev => ({ ...prev, plannedTalents: getRecommendedTalentPlan(prev.class) })); setLimitWarning('Recomendaes aplicadas'); }} className={buttonPrimary}>Aplicar recomendaes</button>\n          </div>\n          <div className=\"mt-3 p-3 rounded bg-gray-700\">\n            <div className=\"text-white font-semibold\">Sinergias</div>\n            <div className=\"mt-3 flex flex-wrap gap-2\">\n              <button type=\"button\" onClick={() => setShowSynergyDetails(v => !v)} className={buttonSecondary}>{showSynergyDetails ? 'Ocultar detalhes' : 'Mostrar detalhes'}</button>\n            </div>\n            <div className=\"mt-3 flex flex-wrap gap-2\">\n              {getRecommendedElements(formData.class, formData.race).map(el => (\n                <button key={el} type=\"button\" onClick={() => handleElementChange(el as Element)} className={`px-2 py-1 rounded text-xs ${formData.element === el ? 'bg-amber-600 text-white' : 'bg-gray-600 text-gray-200 hover:bg-gray-500'}`}>{el}</button>\n              ))}\n              {(CLASS_METADATA[formData.class]?.suggestedRaces || []).map(r => (\n                <button key={r} type=\"button\" onClick={() => handleRaceChange(r as HeroRace)} className={`px-2 py-1 rounded text-xs ${formData.race === r ? 'bg-amber-600 text-white' : 'bg-gray-600 text-gray-200 hover:bg-gray-500'}`}>{r}</button>\n              ))}\n            </div>\n            {showSynergyDetails && (\n              <div className=\"mt-3 space-y-2 text-xs\">\n                {(() => {\n                  const advObj: any = getElementAdvantageInfo(formData.element);\n                  const strong = Array.isArray(advObj?.strong) ? advObj.strong.join(', ') : String(advObj?.strong || '');\n                  const weak = Array.isArray(advObj?.weak) ? advObj.weak.join(', ') : String(advObj?.weak || '');\n                  const neutral = Array.isArray(advObj?.neutral) ? advObj.neutral.join(', ') : String(advObj?.neutral || '');\n                  return <div className=\"text-gray-400\">Forte {strong}  Fraco {weak}  Neutro {neutral}</div>;\n                })()}\n                <div className=\"p-2 rounded bg-gray-800 text-gray-200\">\n                  <div className=\"font-semibold\">Resumo</div>\n                  <div>Elemento: {getRecommendedElements(formData.class, formData.race)[0] || ''}</div>\n                  <div>Raas: {(CLASS_METADATA[formData.class]?.suggestedRaces || []).join(', ') || ''}</div>\n                  <div>Plano: {getRecommendedAttributePlan(formData.class).map(p => `${p.attribute}:${p.priority}`).join('  ')}</div>\n                </div>\n                {(() => { const rc = getRaceCompatibility(formData.class, formData.race as any); return <div className={`${rc.ok ? 'text-emerald-300' : 'text-yellow-300'}`}>Compatibilidade: {rc.message}</div>; })()}\n                <div className=\"flex flex-wrap gap-2\">\n                  {getRecommendedAttributePlan(formData.class).map(p => (\n                    <span key={p.attribute} className=\"px-2 py-1 rounded bg-gray-600 text-gray-200\">{p.attribute}:{p.priority}</span>\n                  ))}\n                </div>\n                <div className=\"flex flex-wrap gap-2\">\n                  <label className=\"flex items-center gap-1 text-gray-300\"><input type=\"checkbox\" checked={disableAutoSuggestion} onChange={(e) => { setDisableAutoSuggestion(e.target.checked); setPrefs({ autoSuggestDisabled: e.target.checked }); }} />No sugerir automaticamente</label>\n                  <button type=\"button\" onClick={handleUndoLastDecision} className={buttonSecondary}>Desfazer</button>\n                  <button type=\"button\" onClick={handleRedoLastDecision} className={buttonSecondary}>Refazer</button>\n                </div>\n              </div>\n            )}\n          </div>\n          <div className=\"mt-3 grid grid-cols-1 md:grid-cols-2 gap-2\">\n            {derivedPreview && (\n              <div className=\"p-3 rounded bg-gray-700\">\n                <div className=\"text-white font-semibold\">Pr-visualizao de atributos derivados</div>\n                <div className=\"mt-2 text-xs text-gray-300\">HP: {derivedPreview.hp}  MP: {derivedPreview.mp}  Iniciativa: {derivedPreview.initiative}  Classe de Armadura: {derivedPreview.armorClass}  Sorte: {derivedPreview.luck}</div>\n              </div>\n            )}\n          </div>\n          </div>\n\n          <div>\n            <h4 className=\"text-lg font-medium text-gray-300 mb-2\">Habilidades Iniciais:</h4>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n              {classSkills.map((skill) => (\n                <div key={skill.id} className=\"bg-gray-600 p-3 rounded-md\">\n                  <div className=\"flex justify-between items-start\">\n                    <div>\n                      <h5 className=\"font-medium text-white\">{skill.name}</h5>\n                      <p className=\"text-xs text-gray-300\">{skill.type}{skill.element ? `  ${skill.element}` : ''}</p>\n                      <p className=\"text-xs text-amber-300\">Custo: {skill.cost}</p>\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowSkillDetails(showSkillDetails === skill.id ? null : skill.id)}\n                      className=\"text-blue-400 hover:text-blue-300 text-sm\"\n                    >\n                      \n                    </button>\n                  </div>\n                  \n                  {showSkillDetails === skill.id && (\n                    <div className=\"mt-2 p-2 bg-gray-700 rounded text-xs\">\n                      <p className=\"text-gray-300\">{skill.description}</p>\n                      {skill.basePower && <p className=\"text-amber-300\">Poder: {skill.basePower}</p>}\n                      {skill.duration && <p className=\"text-green-300\">Durao: {skill.duration} turnos</p>}\n                      {skill.cooldown && <p className=\"text-red-300\">Cooldown: {skill.cooldown} turnos</p>}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"mt-4 p-4 rounded bg-gray-700\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"text-3xl\">{(medievalTheme.icons.classes as any)[formData.class?.[0].toUpperCase() + formData.class?.slice(1)] || ''}</div>\n              <div>\n                <div className=\"text-white font-semibold\">Prvia: {formData.name || ''}  {formData.class}</div>\n                <div className=\"text-xs text-gray-300\">Alinhamento: {formData.alignment}  Raa: {formData.race}</div>\n              </div>\n            </div>\n            <div className=\"mt-3 grid grid-cols-1 md:grid-cols-2 gap-2\">\n              {buildChecklist(formData as any).map((c, i) => (\n                <div key={`chk-${i}`} className={`p-2 rounded text-xs ${c.status === 'ok' ? 'bg-emerald-700/30 text-emerald-200' : c.status === 'warn' ? 'bg-amber-700/30 text-amber-200' : 'bg-red-700/30 text-red-200'}`}>\n                  <div className=\"font-semibold\">{c.label}</div>\n                  {c.detail && <div>{c.detail}</div>}\n                </div>\n              ))}\n            </div>\n          </div>\n          <div className=\"mt-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className=\"text-white font-semibold\">rvore de Talentos</div>\n              <div className=\"flex gap-2\">\n                \n                <button\n                  type=\"button\"\n                  onClick={() => setFormData(prev => ({ ...prev, plannedTalents: getRecommendedTalentPlan(prev.class) }))}\n                  className=\"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-700\"\n                >\n                  Aplicar plano sugerido\n                </button>\n              </div>\n            </div>\n            <TalentTreePreview heroClass={formData.class} plannedTalents={formData.plannedTalents || []} currentLevel={1} onToggle={(id) => setFormData(prev => ({ ...prev, plannedTalents: (prev.plannedTalents || []).includes(id) ? (prev.plannedTalents || []).filter(x => x !== id) : [...(prev.plannedTalents || []), id] }))} />\n          </div>\n        </div>\n\n        {/* Seo 3: Atributos */}\n        <div className=\"bg-gray-700 p-4 rounded-lg\">\n          <h3 className=\"text-xl font-semibold text-amber-400 mb-4\">3. Atributos</h3>\n          <div className=\"flex justify-between items-center mb-4\">\n            <p className=\"text-sm text-amber-300 font-semibold\">\n              Pontos restantes: {remainingPoints}\n            </p>\n            <button\n              type=\"button\"\n              onClick={handleAutoDistribute}\n              className=\"px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition-colors\"\n            >\n              Auto-Distribuir\n            </button>\n            <button\n              type=\"button\"\n              onClick={handleAutoDistributeRecommended}\n              className=\"px-3 py-1 bg-emerald-600 hover:bg-emerald-700 rounded text-sm transition-colors\"\n            >\n              Auto-distribuir recomendaes\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setAdvancedOpen(v => !v)}\n              className=\"px-3 py-1 bg-gray-600 hover:bg-gray-700 rounded text-sm transition-colors\"\n            >\n              {advancedOpen ? 'Ocultar avanado' : 'Personalizao avanada'}\n            </button>\n          </div>\n          \n          {limitWarning && (\n            <p className=\"text-sm text-red-400 mb-4\" role=\"status\" aria-live=\"polite\">{limitWarning}</p>\n          )}\n          \n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n            {Object.entries(formData.attributes).filter(([attr]) => (\n              ['forca','destreza','constituicao','inteligencia'].includes(attr)\n            )).map(([attr, value]) => (\n              <div key={attr} className=\"flex flex-col items-center\">\n                <label className=\"block text-sm font-medium text-gray-300 capitalize mb-1\">\n                  {attr}\n                </label>\n                <p className=\"text-xs text-gray-400 text-center mb-2\">\n                  {ATTRIBUTE_INFO[attr as keyof HeroAttributes].description}\n                </p>\n                <div className=\"flex items-center\">\n                  <button\n                    type=\"button\"\n                    onClick={() => handleAttributeChange(attr as keyof HeroAttributes, false)}\n                    className=\"px-2 py-1 bg-red-700 hover:bg-red-600 rounded-l-md disabled:opacity-50 transition-colors\"\n                    disabled={!canDecreaseAttribute(formData.attributes, attr as keyof HeroAttributes)}\n                  >\n                    -\n                  </button>\n                  <span className=\"px-4 py-1 bg-gray-600 min-w-[3rem] text-center\">{value}</span>\n                  <button\n                    type=\"button\"\n                    onClick={() => handleAttributeChange(attr as keyof HeroAttributes, true)}\n                    className=\"px-2 py-1 bg-green-700 hover:bg-green-600 rounded-r-md disabled:opacity-50 transition-colors\"\n                    disabled={!canIncreaseAttribute(formData.attributes, attr as keyof HeroAttributes)}\n                  >\n                    +\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n          {advancedOpen && (\n            <div className=\"mt-4 p-3 rounded bg-gray-800\">\n              <div className=\"text-white font-semibold mb-2\">Pesos avanados de atributos</div>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n                {Object.keys(advWeights).map((k) => (\n                  <div key={`w-${k}`} className=\"text-xs text-gray-300\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"capitalize\">{k}</span>\n                      <span className=\"text-amber-300\">{advWeights[k].toFixed(2)}</span>\n                    </div>\n                    <input\n                      type=\"range\"\n                      min={0.5}\n                      max={3}\n                      step={0.1}\n                      value={advWeights[k]}\n                      onChange={(e) => setAdvWeights(prev => ({ ...prev, [k]: Number(e.target.value) }))}\n                      className=\"w-full\"\n                    />\n                  </div>\n                ))}\n              </div>\n              <div className=\"mt-2 text-xs text-gray-400\">Os pesos influenciam a auto-distribuio recomendada, permitindo personalizao avanada.</div>\n            </div>\n          )}\n        </div>\n\n        {/* Seo 4: Elemento */}\n        <div className=\"bg-gray-700 p-4 rounded-lg\">\n          <h3 className=\"text-xl font-semibold text-amber-400 mb-4\">4. Elemento</h3>\n          <div className=\"flex gap-2 mb-4\">\n            <button\n              type=\"button\"\n              onClick={handleGenerateRandomElement}\n              className={`px-3 py-2 rounded-md text-sm font-medium transition-colors bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white hover:brightness-110 flex items-center gap-2`}\n            >\n              {(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}\n              <span> Gerar Aleatrio</span>\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setShowElementTooltip(!showElementTooltip)}\n              className={`px-3 py-2 rounded-md text-sm font-medium transition-colors bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white hover:brightness-110`}\n            >\n               Relaes\n            </button>\n          </div>\n\n          {showElementTooltip && (\n            <div className=\"mb-4 p-3 bg-gray-600 rounded-md text-sm\">\n              <h5 className=\"font-medium text-white mb-2\">Vantagens Elementais:</h5>\n              <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                <p>Fogo vence Gelo</p>\n                <p>Gelo vence Trovo</p>\n                <p>Trovo vence Terra</p>\n                <p>Terra vence Fogo</p>\n                <p>Luz contra Sombra</p>\n                <p>Fsico  neutro</p>\n              </div>\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-3 md:grid-cols-7 gap-2\">\n            {Object.entries(ELEMENT_INFO).map(([element, info]) => (\n              <button\n                key={element}\n                type=\"button\"\n                onClick={() => handleElementChange(element as Element)}\n                className={`p-3 rounded-md text-center transition-colors ${\n                  formData.element === element\n                    ? 'bg-amber-600 text-white'\n                    : 'bg-gray-600 hover:bg-gray-500 text-gray-300'\n                }`}\n              >\n                <div className=\"text-2xl mb-1\">{info.icon}</div>\n                <div className=\"text-xs\">{info.name}</div>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Seo 5: Histria */}\n        <div className=\"bg-gray-700 p-4 rounded-lg\">\n          <h3 className=\"text-xl font-semibold text-amber-400 mb-4\">5. Histria</h3>\n          <div className=\"flex gap-3 mb-2\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                setLoadingStory(true);\n                setTimeout(() => {\n                  const story = generateStory(formData);\n                  setFormData(prev => ({ ...prev, backstory: story }));\n                  setLoadingStory(false);\n                }, 600);\n              }}\n              className={`px-3 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-60 bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white hover:brightness-110 flex items-center gap-2`}\n              disabled={loadingStory || !formData.name.trim()}\n            >\n              {(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}\n              <span>{loadingStory ? 'Gerando...' : 'Gerar histria'}</span>\n            </button>\n            <button\n              type=\"button\"\n              onClick={async () => {\n                setLoadingHFStory(true);\n                try {\n                  const contexto = `${formData.name || 'Heri'}, sexo ${ (formData as any).gender || 'masculino' }, classe ${formData.class}, raa ${formData.race}, elemento ${formData.element}`;\n                  const historia = await gerarTexto('historia', contexto);\n                  setFormData(prev => ({ ...prev, backstory: historia }));\n                  notificationBus.emit({ type: 'achievement', title: 'Histria gerada!', message: 'A histria do heri foi atualizada.', icon: '', duration: 4000 });\n                } catch (error) {\n                  console.error('Erro ao gerar histria via IA:', error);\n                  notificationBus.emit({ type: 'quest', title: 'Falha ao gerar histria', message: 'Verifique a chave de IA e a conexo.', icon: '', duration: 4500 });\n                } finally {\n                  setLoadingHFStory(false);\n                }\n              }}\n              className=\"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-sm font-medium transition-colors disabled:opacity-60\"\n              disabled={loadingHFStory || !formData.name.trim()}\n            >\n              {loadingHFStory ? 'Gerando...' : ' Histria (IA)'}\n            </button>\n          </div>\n          <textarea\n            value={formData.backstory || ''}\n            onChange={(e) => setFormData({...formData, backstory: e.target.value})}\n            rows={4}\n            className=\"mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n            placeholder=\"Conte a histria do seu heri...\"\n          />\n        </div>\n\n        {/* Seo 6: Frase de Batalha (aps histria) */}\n        <div className=\"bg-gray-700 p-4 rounded-lg\">\n          <h3 className=\"text-xl font-semibold text-amber-400 mb-4\">6. Frase de Batalha</h3>\n          <div className=\"flex gap-2 mb-2\">\n            <button type=\"button\" onClick={handleGenerateBattleQuote} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white hover:brightness-110 flex items-center gap-2`}>\n              {(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}\n              <span> Gerar Aleatria</span>\n            </button>\n            <button type=\"button\" onClick={handleGenerateBattleQuoteAI} disabled={loadingQuoteAI} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-60 bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white hover:brightness-110 flex items-center gap-2`}>\n              {(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}\n              <span>{loadingQuoteAI ? 'Gerando...' : ' Gerar com IA'}</span>\n            </button>\n          </div>\n          <textarea value={formData.battleQuote || ''} onChange={(e) => setFormData({...formData, battleQuote: e.target.value})} rows={2} className=\"w-full rounded-md bg-gray-600 border-gray-500 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\" placeholder=\"Digite uma frase pica conectada  histria...\" />\n        </div>\n\n        {/* Seo 7: Imagem do Heri (aps histria) */}\n        <div className=\"bg-gray-700 p-4 rounded-lg\">\n          <h3 className=\"text-xl font-semibold text-amber-400 mb-4\">7. Imagem do Heri</h3>\n          <div className=\"flex gap-4 items-start\">\n            <div className=\"flex-1\">\n              <input ref={fileInputRef} type=\"file\" accept=\"image/*\" onChange={handleImageUpload} className=\"hidden\" />\n              <button type=\"button\" onClick={() => fileInputRef.current?.click()} className=\"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md font-medium transition-colors\"> Upload de Imagem</button>\n              <p className=\"text-xs text-gray-400 mt-1\">Formatos aceitos: JPG, PNG, GIF (mx. 5MB)</p>\n            </div>\n            <div className=\"flex-1\">\n              <button type=\"button\" onClick={handleGenerateImageAI} disabled={loadingImageAI} className={`w-full px-4 py-2 rounded-md font-medium transition-colors disabled:opacity-60 bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white hover:brightness-110 flex items-center gap-2`}>\n                {(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}\n                <span>{loadingImageAI ? 'Gerando...' : ' Gerar Avatar IA'}</span>\n              </button>\n              <p className=\"text-xs text-gray-400 mt-1\">Usa sexo, raa, classe e (opcional) resumo da histria para criar a imagem.</p>\n            </div>\n            {formData.image && (\n              <div className=\"w-24 h-24 bg-gray-600 rounded-md overflow-hidden\">\n                <img src={formData.image.includes('image.pollinations.ai/prompt/') ? formData.image.replace('https://image.pollinations.ai/prompt/', '/api/pollinations-image?prompt=').replace('?n=1&', '&') : formData.image} alt=\"Preview do heri\" className=\"w-full h-full object-cover\" />\n              </div>\n            )}\n          </div>\n        </div>\n\n        \n        \n        {/* Boto de envio */}\n        <div className=\"flex justify-center\">\n          <button\n            type=\"submit\"\n            className=\"px-8 py-4 bg-amber-600 hover:bg-amber-700 rounded-md font-bold text-lg transition-colors disabled:opacity-60\"\n            disabled={!validateAttributes(formData.attributes).valid || !formData.name.trim()}\n          >\n             Forjar Heri\n          </button>\n        </div>\n      </form>\n      </ErrorBoundary>\n\n      {confirmOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"confirm-create-title\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setConfirmOpen(false)}></div>\n          <div className=\"relative z-10 w-full max-w-lg rounded-lg border border-gray-700 bg-gray-800 p-4 shadow-xl\">\n            <h2 id=\"confirm-create-title\" className=\"text-lg font-bold text-white\">Confirmar Criao</h2>\n            <p className=\"text-sm text-gray-300 mt-1\">Voc est prestes a criar {formData.name || 'um heri'} da classe {formData.class}. Deseja concluir?</p>\n            <div className=\"mt-3 text-xs text-gray-400\">Atributos: {Object.entries(formData.attributes).map(([k,v]) => `${k}:${v}`).join('  ')}</div>\n            {formData.plannedTalents && formData.plannedTalents.length > 0 && (\n              <div className=\"mt-1 text-xs text-amber-300\">Talentos planejados: {formData.plannedTalents.length}</div>\n            )}\n            {creationLog.length > 0 && (\n              <div className=\"mt-2\">\n                <div className=\"text-xs text-gray-300\">Histrico de decises:</div>\n                <ul className=\"mt-1 text-xs text-gray-400 list-disc pl-5\">\n                  {creationLog.slice(-6).map((e, i) => (<li key={`log-${i}`}>{e}</li>))}\n                </ul>\n                <div className=\"mt-2 flex gap-2 justify-end\">\n                  <button type=\"button\" onClick={async () => { try { await navigator.clipboard.writeText(JSON.stringify(creationLog)); } catch {} }} className=\"px-2 py-1 rounded bg-gray-600 text-white text-xs\">Exportar histrico</button>\n                </div>\n              </div>\n            )}\n            {(() => { const r = buildReadiness(formData as any); return (\n              <div className={`mt-2 p-2 rounded text-xs text-center ${r.status === 'ok' ? 'bg-emerald-700/30 text-emerald-200' : r.status === 'warn' ? 'bg-amber-700/30 text-amber-200' : 'bg-red-700/30 text-red-200'}`}>Prontido: {r.message}</div>\n            ) })()}\n            <div className=\"mt-4 flex gap-2 justify-end\">\n              <button type=\"button\" onClick={() => setConfirmOpen(false)} className=\"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700\">Voltar</button>\n              {(() => { const r = buildReadiness(formData as any); const disabled = r.status === 'error'; return (\n                <button type=\"button\" onClick={finalizeCreation} disabled={disabled} className={`px-3 py-2 rounded ${disabled ? 'bg-gray-500 text-gray-300 cursor-not-allowed' : 'bg-emerald-600 text-white hover:bg-emerald-700'}`}>Confirmar</button>\n              ) })()}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default HeroForm;\n","import React from 'react';\nimport { Achievement as AchievementType } from '../types/hero';\nimport { medievalTheme } from '../styles/medievalTheme';\n\ninterface AchievementProps {\n  achievement: AchievementType;\n  isUnlocked?: boolean;\n  showProgress?: boolean;\n}\n\nconst Achievement: React.FC<AchievementProps> = ({ \n  achievement, \n  isUnlocked = false, \n  showProgress = false \n}) => {\n  const progressPercentage = achievement.maxProgress \n    ? Math.round((achievement.progress / achievement.maxProgress) * 100)\n    : 100;\n\n  const getRarityColor = (rarity: string) => {\n    switch (rarity) {\n      case 'comum': return 'text-slate-300 border-slate-600';\n      case 'raro': return 'text-blue-300 border-blue-500/40';\n      case 'pico': return 'text-violet-300 border-violet-500/40';\n      case 'lendrio': return 'text-amber-300 border-amber-500/40';\n      default: return 'text-slate-300 border-slate-600';\n    }\n  };\n\n  const getRarityTrack = (rarity: string) => {\n    switch (rarity) {\n      case 'comum': return 'bg-slate-500';\n      case 'raro': return 'bg-blue-500';\n      case 'pico': return 'bg-violet-500';\n      case 'lendrio': return 'bg-amber-500';\n      default: return 'bg-slate-500';\n    }\n  };\n\n  return (\n    <div \n      className={`\n        relative p-4 rounded-lg border-2 transition-all duration-200 bg-slate-800\n        ${isUnlocked \n          ? `${getRarityColor(achievement.rarity)} shadow-md` \n          : 'text-slate-400 border-slate-700 opacity-60'\n        }\n        ${isUnlocked ? 'hover:shadow-xl transform hover:-translate-y-1' : ''}\n      `}\n    >\n      {/* cone do Achievement */}\n      <div className=\"flex items-start space-x-3\">\n        <div \n          className={`\n            w-12 h-12 rounded-full flex items-center justify-center text-2xl\n            ${isUnlocked ? 'bg-slate-700' : 'bg-slate-600'}\n          `}\n        >\n          {achievement.icon}\n        </div>\n        \n        <div className=\"flex-1\">\n          {/* Ttulo e Raridade */}\n          <div className=\"flex items-center justify-between mb-1\">\n            <h3 className={`font-bold text-lg ${isUnlocked ? 'text-white' : 'text-slate-400'}`}>\n              {achievement.title}\n            </h3>\n            <span \n              className={`\n                px-2 py-1 rounded-full text-xs font-medium uppercase tracking-wide\n                ${isUnlocked ? 'bg-slate-700 text-slate-200 border border-slate-600' : 'bg-slate-700 text-slate-400 border border-slate-600'}\n              `}\n            >\n              {achievement.rarity}\n            </span>\n          </div>\n          \n          {/* Descrio */}\n          <p className={`text-sm mb-2 ${isUnlocked ? 'text-slate-300' : 'text-slate-400'}`}>\n            {achievement.description}\n          </p>\n          \n          {/* Progresso */}\n          {showProgress && achievement.maxProgress && achievement.maxProgress > 1 && (\n            <div className=\"mb-2\">\n              <div className=\"flex justify-between text-xs mb-1 text-slate-300\">\n                <span>Progresso</span>\n                <span>{achievement.progress}/{achievement.maxProgress}</span>\n              </div>\n              <div className=\"w-full bg-slate-700 rounded-full h-2\">\n                <div \n                  className={`h-2 rounded-full transition-all duration-300 ${getRarityTrack(achievement.rarity)}`}\n                  style={{ width: `${progressPercentage}%` }}\n                />\n              </div>\n            </div>\n          )}\n          \n          {/* Data de Desbloqueio */}\n          {isUnlocked && achievement.unlockedAt && (\n            <div className=\"text-xs text-slate-400 mt-2\">\n              Desbloqueado em {new Date(achievement.unlockedAt).toLocaleDateString('pt-BR')}\n            </div>\n          )}\n          \n          {/* Recompensas */}\n          {achievement.rewards && (\n            <div className=\"mt-2 flex flex-wrap gap-2\">\n              {achievement.rewards.xp && (\n                <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs bg-emerald-900/30 text-emerald-300 border border-emerald-700/40\">\n                  +{achievement.rewards.xp} XP\n                </span>\n              )}\n              {achievement.rewards.gold && (\n                <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs bg-amber-900/30 text-amber-300 border border-amber-700/40\">\n                  +{achievement.rewards.gold} \n                </span>\n              )}\n              {achievement.rewards.title && (\n                <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs bg-violet-900/30 text-violet-300 border border-violet-700/40\">\n                  Ttulo: {achievement.rewards.title}\n                </span>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n      \n      {/* Efeito de Brilho para Achievements Desbloqueados */}\n      {isUnlocked && (\n        <div className=\"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-amber-300/10 to-transparent opacity-0 hover:opacity-20 transition-opacity duration-300 pointer-events-none\" />\n      )}\n    </div>\n  );\n};\n\nexport default Achievement;","import React, { useState } from 'react';\nimport { Hero } from '../types/hero';\nimport { QUEST_ACHIEVEMENTS } from '../utils/quests';\nimport Achievement from './Achievement';\nimport { medievalTheme, seasonalThemes } from '../styles/medievalTheme';\nimport { useMonetizationStore } from '../store/monetizationStore';\n\ninterface AchievementsListProps {\n  hero: Hero;\n}\n\nconst AchievementsList: React.FC<AchievementsListProps> = ({ hero }) => {\n  const [filter, setFilter] = useState<'all' | 'unlocked' | 'locked'>('all');\n  const [rarityFilter, setRarityFilter] = useState<string>('all');\n\n  // Combinar achievements desbloqueados com templates para mostrar progresso\n  const allAchievements = QUEST_ACHIEVEMENTS.map(template => {\n    const unlockedAchievement = hero.progression.achievements.find(a => a.id === template.id);\n    \n    if (unlockedAchievement) {\n      return { ...unlockedAchievement, isUnlocked: true };\n    }\n    \n    // Calcular progresso atual para achievements no desbloqueados\n    let currentProgress = 0;\n    \n    switch (template.id) {\n      case 'primeira-missao':\n        currentProgress = hero.stats.questsCompleted >= 1 ? 1 : 0;\n        break;\n      case 'heroi-da-vila':\n        currentProgress = Math.min(template.maxProgress!, hero.stats.questsCompleted);\n        break;\n      case 'cacador-experiente':\n        currentProgress = Math.min(template.maxProgress!, Math.floor(hero.stats.questsCompleted * 0.4));\n        break;\n      case 'explorador-corajoso':\n        currentProgress = Math.min(template.maxProgress!, Math.floor(hero.stats.questsCompleted * 0.3));\n        break;\n      case 'lenda-epica':\n        currentProgress = Math.min(template.maxProgress!, Math.floor(hero.stats.questsCompleted * 0.1));\n        break;\n      case 'amigo-dos-animais':\n        currentProgress = Math.min(template.maxProgress!, (hero.stats.companionQuestsCompleted || 0));\n        break;\n      case 'domador-de-feras':\n        currentProgress = Math.min(template.maxProgress!, (hero.stats.beastEssenceCollected || 0));\n        break;\n      case 'cavaleiro-mitico':\n        currentProgress = Math.min(template.maxProgress!, (hero.stats.mountScrollsFound || 0));\n        break;\n    }\n    \n    return {\n      ...template,\n      progress: currentProgress,\n      isUnlocked: false\n    };\n  });\n\n  const cardsWins = Number((hero.stats as any)?.miniCardsWins || 0);\n  const rpsBest = Number((hero.stats as any)?.miniRpsBestStreak || 0);\n  const titleAchievements = [\n    {\n      id: 'cards-champion-achievement',\n      title: 'Campeo das Cartas',\n      description: 'Vena 10 partidas no Jogo das Cartas',\n      icon: '',\n      maxProgress: 10,\n      progress: cardsWins,\n      isUnlocked: !!(hero.achievements || []).find(a => a.id === 'cards-champion-achievement') || !!(hero.progression.achievements || []).find(a => a.id === 'cards-champion-achievement')\n    },\n    {\n      id: 'rps-master-achievement',\n      title: 'Mestre do RPS',\n      description: 'Alcance sequncia de 5 vitrias em RPS',\n      icon: '',\n      maxProgress: 5,\n      progress: rpsBest,\n      isUnlocked: !!(hero.achievements || []).find(a => a.id === 'rps-master-achievement') || !!(hero.progression.achievements || []).find(a => a.id === 'rps-master-achievement')\n    }\n  ];\n\n  const combinedAchievements = [...allAchievements, ...titleAchievements];\n\n  // Filtrar achievements\n  const filteredAchievements = combinedAchievements.filter(achievement => {\n    if (filter === 'unlocked' && !achievement.isUnlocked) return false;\n    if (filter === 'locked' && achievement.isUnlocked) return false;\n    if (rarityFilter !== 'all' && achievement.rarity !== rarityFilter) return false;\n    return true;\n  });\n\n  // Estatsticas\n  const unlockedCount = combinedAchievements.filter(a => a.isUnlocked).length;\n  const totalCount = combinedAchievements.length;\n  const completionPercentage = Math.round((unlockedCount / totalCount) * 100);\n\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-amber-600/30' : 'border-amber-600/30';\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header com Estatsticas */}\n      <div className={`bg-gradient-to-r ${medievalTheme.gradients.backgrounds.hero} text-white p-6 rounded-lg border border-slate-700`}>\n        <h2 className=\"text-2xl font-bold mb-2\"> Conquistas</h2>\n        <div className=\"flex items-center space-x-6\">\n          <div>\n            <div className=\"text-3xl font-bold\">{unlockedCount}/{totalCount}</div>\n            <div className=\"text-sm opacity-90\">Desbloqueadas</div>\n          </div>\n          <div className=\"flex-1\">\n            <div className=\"text-sm mb-1\">Progresso Geral</div>\n            <div className=\"w-full bg-gray-700 rounded-full h-3\">\n              <div \n                className={`h-3 rounded-full transition-all duration-500 bg-gradient-to-r ${medievalTheme.gradients.buttons.royal}`}\n                style={{ width: `${completionPercentage}%` }}\n              />\n            </div>\n            <div className=\"text-sm mt-1\">{completionPercentage}% completo</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Filtros */}\n      <div className={`flex flex-wrap gap-4 p-4 rounded-lg border ${seasonalBorder} bg-gray-800`}>\n        <div className=\"flex items-center space-x-2\">\n          <label className=\"text-sm font-medium text-gray-200\">Status:</label>\n          <select \n            value={filter} \n            onChange={(e) => setFilter(e.target.value as any)}\n            className=\"px-3 py-1 border border-gray-700 bg-gray-900 text-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n          >\n            <option value=\"all\">Todas</option>\n            <option value=\"unlocked\">Desbloqueadas</option>\n            <option value=\"locked\">Bloqueadas</option>\n          </select>\n        </div>\n        \n        <div className=\"flex items-center space-x-2\">\n          <label className=\"text-sm font-medium text-gray-200\">Raridade:</label>\n          <select \n            value={rarityFilter} \n            onChange={(e) => setRarityFilter(e.target.value)}\n            className=\"px-3 py-1 border border-gray-700 bg-gray-900 text-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n          >\n            <option value=\"all\">Todas</option>\n            <option value=\"comum\">Comum</option>\n            <option value=\"raro\">Raro</option>\n            <option value=\"pico\">pico</option>\n            <option value=\"lendrio\">Lendrio</option>\n          </select>\n        </div>\n      </div>\n\n      {/* Lista de Achievements */}\n      <div className=\"grid gap-4\">\n        {filteredAchievements.length > 0 ? (\n          filteredAchievements.map(achievement => (\n            <Achievement\n              key={achievement.id}\n              achievement={achievement}\n              isUnlocked={achievement.isUnlocked}\n              showProgress={!achievement.isUnlocked}\n            />\n          ))\n        ) : (\n          <div className=\"text-center py-8 text-gray-500\">\n            <div className=\"text-4xl mb-2\"></div>\n            <div>Nenhuma conquista encontrada com os filtros selecionados.</div>\n          </div>\n        )}\n      </div>\n\n      {/* Ttulos Desbloqueados */}\n      {hero.progression.titles && hero.progression.titles.length > 0 && (\n        <div className={`bg-gray-800 p-6 rounded-lg border border-gray-700`}>\n          <h3 className=\"text-xl font-bold mb-4 text-white\"> Ttulos Conquistados</h3>\n          <div className=\"flex flex-wrap gap-2\">\n            {hero.progression.titles.map((title, index) => (\n              <span \n                key={index}\n                className={`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium text-white bg-gradient-to-r ${medievalTheme.gradients.buttons.royal} border border-purple-700/40`}\n              >\n                {title}\n              </span>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dicas para Prximas Conquistas */}\n      <div className=\"bg-blue-900/20 p-4 rounded-lg border border-blue-600/30\">\n        <h4 className=\"font-semibold text-blue-300 mb-2\"> Prximas Conquistas</h4>\n        <div className=\"text-sm text-blue-200 space-y-1\">\n          {!hero.progression.achievements.some(a => a.id === 'primeira-missao') && (\n            <div> Complete sua primeira misso para desbloquear \"Primeira Aventura\"</div>\n          )}\n          {hero.stats.questsCompleted < 5 && (\n            <div> Complete {5 - hero.stats.questsCompleted} misses para \"Heri da Vila\"</div>\n          )}\n          {hero.stats.questsCompleted < 10 && (\n            <div> Continue completando misses para desbloquear mais conquistas!</div>\n          )}\n          {(hero.stats.companionQuestsCompleted || 0) < 5 && (\n            <div> Conclua {(5 - (hero.stats.companionQuestsCompleted || 0))} misses de Companheiros para \"Amigo dos Animais\"</div>\n          )}\n          {(hero.stats.beastEssenceCollected || 0) < 3 && (\n            <div> Colete {(3 - (hero.stats.beastEssenceCollected || 0))} Essncias Bestiais para \"Domador de Feras\"</div>\n          )}\n          {(hero.stats.mountScrollsFound || 0) < 2 && (\n            <div> Encontre {(2 - (hero.stats.mountScrollsFound || 0))} Pergaminhos de Montaria para \"Cavaleiro Mtico\"</div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AchievementsList;","import React from 'react';\nimport { Hero } from '../types/hero';\nimport { \n  getReputationLevel, \n  FACTION_DESCRIPTIONS,\n  calculateReputationModifiers \n} from '../utils/reputationSystem';\n\ninterface ReputationPanelProps {\n  hero: Hero;\n}\n\nconst ReputationPanel: React.FC<ReputationPanelProps> = ({ hero }) => {\n  const getProgressPercentage = (reputation: number) => {\n    const nextLevelIndex = Math.min(\n      6, // Mximo ndice\n      Math.max(0, \n        [...Array(7)].findIndex((_, i) => reputation < [\n          -1000, -500, -100, 0, 100, 500, 1000\n        ][i + 1] || i === 6)\n      )\n    );\n    \n    const currentThreshold = [-1000, -500, -100, 0, 100, 500, 1000][nextLevelIndex];\n    const nextThreshold = [-1000, -500, -100, 0, 100, 500, 1000][nextLevelIndex + 1] || 1000;\n    \n    if (reputation >= 1000) return 100;\n    if (reputation <= -1000) return 0;\n    \n    const progress = ((reputation - currentThreshold) / (nextThreshold - currentThreshold)) * 100;\n    return Math.max(0, Math.min(100, progress));\n  };\n\n  return (\n    <div className=\"bg-gray-800 rounded-lg p-6\">\n      <h3 className=\"text-xl font-bold text-amber-400 mb-4 flex items-center\">\n        <svg className=\"w-6 h-6 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n        </svg>\n        Reputao das Faces\n      </h3>\n      \n      <div className=\"space-y-4\">\n        {(hero.reputationFactions || []).map((faction) => {\n          const level = getReputationLevel(faction.reputation);\n          const modifiers = calculateReputationModifiers(hero, faction.name);\n          const factionInfo = FACTION_DESCRIPTIONS[faction.name as keyof typeof FACTION_DESCRIPTIONS];\n          const progress = getProgressPercentage(faction.reputation);\n          \n          return (\n            <div key={faction.name} className=\"bg-gray-700 rounded-lg p-4\" title={`${level.name}: ${level.description}`}>\n              <div className=\"flex justify-between items-start mb-2\">\n                <div>\n                  <h4 className=\"font-semibold text-white\">{faction.name}</h4>\n                  <p className=\"text-sm text-gray-400\">{factionInfo?.description}</p>\n                </div>\n                <div className=\"text-right\">\n                  <span className={`font-bold ${level.color}`}>\n                    {level.name}\n                  </span>\n                  <div className=\"text-sm text-gray-400\">\n                    {faction.reputation}/1000\n                  </div>\n                  {(modifiers.goldBonus !== 0 || modifiers.xpBonus !== 0) && (\n                    <div className=\"text-xs text-gray-300 mt-1\">\n                      {modifiers.goldBonus !== 0 && (\n                        <span className={modifiers.goldBonus > 0 ? 'text-yellow-300' : 'text-red-400'}>\n                          Ouro {modifiers.goldBonus > 0 ? '+' : ''}{Math.round(modifiers.goldBonus * 100)}%\n                        </span>\n                      )}\n                      {modifiers.xpBonus !== 0 && (\n                        <span className={`ml-2 ${modifiers.xpBonus > 0 ? 'text-blue-300' : 'text-red-400'}`}>\n                          XP {modifiers.xpBonus > 0 ? '+' : ''}{Math.round(modifiers.xpBonus * 100)}%\n                        </span>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              {/* Barra de Progresso */}\n              <div className=\"w-full bg-gray-600 rounded-full h-2 mb-3\">\n                <div \n                  className={`h-2 rounded-full transition-all duration-300 ${\n                    faction.reputation >= 0 \n                      ? 'bg-gradient-to-r from-green-500 to-blue-500' \n                      : 'bg-gradient-to-r from-red-500 to-orange-500'\n                  }`}\n                  style={{ width: `${progress}%` }}\n                />\n              </div>\n              \n              {/* Modificadores */}\n              {(modifiers.goldBonus !== 0 || modifiers.xpBonus !== 0) && (\n                <div className=\"flex space-x-4 text-sm\">\n                  {modifiers.goldBonus !== 0 && (\n                    <span className={modifiers.goldBonus > 0 ? 'text-yellow-400' : 'text-red-400'}>\n                      Gold: {modifiers.goldBonus > 0 ? '+' : ''}{Math.round(modifiers.goldBonus * 100)}%\n                    </span>\n                  )}\n                  {modifiers.xpBonus !== 0 && (\n                    <span className={modifiers.xpBonus > 0 ? 'text-blue-400' : 'text-red-400'}>\n                      XP: {modifiers.xpBonus > 0 ? '+' : ''}{Math.round(modifiers.xpBonus * 100)}%\n                    </span>\n                  )}\n                </div>\n              )}\n              \n              {/* Misses Especiais Desbloqueadas */}\n              {level.questModifiers.specialQuestsUnlocked.length > 0 && (\n                <div className=\"mt-2\">\n                  <p className=\"text-xs text-purple-400 font-medium\">Misses Especiais:</p>\n                  <div className=\"flex flex-wrap gap-1 mt-1\">\n                    {level.questModifiers.specialQuestsUnlocked.map((quest) => (\n                      <span \n                        key={quest}\n                        className=\"px-2 py-1 bg-purple-600/30 text-purple-300 text-xs rounded\"\n                      >\n                        {quest.replace('_', ' ')}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Faces Aliadas/Inimigas */}\n              {factionInfo && (\n                <div className=\"mt-3 text-xs\">\n                  {factionInfo.allyFactions.length > 0 && (\n                    <div className=\"mb-1\">\n                      <span className=\"text-green-400\">Aliados: </span>\n                      <span className=\"text-gray-400\">\n                        {factionInfo.allyFactions.join(', ')}\n                      </span>\n                    </div>\n                  )}\n                  {factionInfo.opposingFactions.length > 0 && (\n                    <div>\n                      <span className=\"text-red-400\">Inimigos: </span>\n                      <span className=\"text-gray-400\">\n                        {factionInfo.opposingFactions.join(', ')}\n                      </span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n      \n      {/* Dicas de Reputao */}\n      <div className=\"mt-6 p-4 bg-blue-900/30 rounded-lg border border-blue-500/30\">\n        <h4 className=\"text-sm font-semibold text-blue-400 mb-2\"> Dicas de Reputao</h4>\n        <ul className=\"text-xs text-gray-300 space-y-1\">\n          <li> Misses do hub da Guilda afetam sua reputao com faces</li>\n          <li> Maior reputao = melhores recompensas e misses especiais</li>\n          <li> Cuidado: algumas faces so inimigas entre si</li>\n          <li> Reputao negativa pode fechar certas oportunidades</li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default ReputationPanel;\n","import React, { useMemo, useState } from 'react';\nimport { Hero, HeroAttributes } from '../types/hero';\nimport { useHeroStore } from '../store/heroStore';\nimport { ATTRIBUTE_CONSTRAINTS, ATTRIBUTE_INFO, getMaxAttributeForRank } from '../utils/attributeSystem';\nimport { rankSystem } from '../utils/rankSystem';\nimport { medievalTheme } from '../styles/medievalTheme';\n\ninterface AttributeAllocationPanelProps {\n  hero: Hero;\n}\n\nconst AttributeAllocationPanel: React.FC<AttributeAllocationPanelProps> = ({ hero }) => {\n  const { allocateAttributePoints } = useHeroStore();\n\n  const [pending, setPending] = useState<Partial<HeroAttributes>>({});\n  const [message, setMessage] = useState<string>('');\n\n  const pointsAvailable = hero.attributePoints || 0;\n  const currentRank = hero.rankData?.currentRank || rankSystem.calculateRank(hero);\n  const maxAttr = useMemo(() => getMaxAttributeForRank(currentRank), [currentRank]);\n\n  const pointsToSpend = useMemo(() => {\n    return Object.values(pending).reduce((sum, v) => sum + (typeof v === 'number' ? Math.max(0, v) : 0), 0);\n  }, [pending]);\n\n  const pointsRemaining = Math.max(0, pointsAvailable - pointsToSpend);\n\n  const attributesList = useMemo(() => (\n    [\n      'forca',\n      'destreza',\n      'constituicao',\n      'inteligencia'\n    ] as (keyof HeroAttributes)[]\n  ), []);\n\n  const canIncrease = (key: keyof HeroAttributes) => {\n    const current = hero.attributes[key];\n    const inc = (pending[key] || 0) as number;\n    return pointsRemaining > 0 && current + inc < maxAttr;\n  };\n\n  const canDecrease = (key: keyof HeroAttributes) => {\n    const inc = (pending[key] || 0) as number;\n    return inc > 0;\n  };\n\n  const increment = (key: keyof HeroAttributes) => {\n    if (!canIncrease(key)) return;\n    setPending(prev => ({ ...prev, [key]: ((prev[key] as number) || 0) + 1 }));\n  };\n\n  const decrement = (key: keyof HeroAttributes) => {\n    if (!canDecrease(key)) return;\n    setPending(prev => ({ ...prev, [key]: Math.max(0, ((prev[key] as number) || 0) - 1) }));\n  };\n\n  const reset = () => {\n    setPending({});\n    setMessage('');\n  };\n\n  const apply = () => {\n    if (pointsToSpend <= 0) {\n      setMessage('Selecione pelo menos 1 ponto para aplicar.');\n      return;\n    }\n    const ok = allocateAttributePoints(hero.id, pending);\n    if (ok) {\n      setMessage('Pontos aplicados com sucesso!');\n      reset();\n    } else {\n      setMessage('No foi possvel aplicar. Verifique limites e pontos disponveis.');\n    }\n  };\n\n  if (pointsAvailable <= 0) {\n    return (\n      <div className=\"bg-gray-700 p-4 rounded border border-gray-600 text-sm text-gray-200\">\n        Nenhum ponto de atributo disponvel no momento.\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-gray-700 p-4 rounded border border-gray-600 space-y-4 text-gray-100\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"text-sm text-gray-300\">\n          Pontos disponveis: <span className=\"font-semibold\">{pointsAvailable}</span>\n        </div>\n        <div className=\"text-sm text-gray-300\">\n          A gastar: <span className=\"font-semibold\">{pointsToSpend}</span>  Restantes: <span className=\"font-semibold\">{pointsRemaining}</span>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n        {attributesList.map((key) => {\n          const info = ATTRIBUTE_INFO[key];\n          const current = hero.attributes[key];\n          const inc = (pending[key] || 0) as number;\n          const final = current + inc;\n          return (\n            <div key={key} className=\"bg-gray-800 border border-gray-700 rounded p-3 overflow-hidden\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-2\">\n                  <span>{info.icon}</span>\n                  <span className=\"font-medium text-white\">{info.name}</span>\n                </div>\n                <div className=\"text-sm text-gray-300\">\n                  {current}  <span className=\"font-semibold\">{final}</span>\n                </div>\n              </div>\n              <div className=\"mt-2 space-y-2\">\n                <div className=\"text-xs text-gray-400 leading-snug min-w-0 break-words\">{info.description}</div>\n                <div className=\"flex items-center justify-end space-x-2\">\n                  <button\n                    className={`px-2 py-1 text-sm rounded ${canDecrease(key) ? 'bg-gray-700 text-gray-200 hover:bg-gray-600' : 'bg-gray-800 text-gray-500 cursor-not-allowed'}`}\n                    onClick={() => decrement(key)}\n                    disabled={!canDecrease(key)}\n                  >-</button>\n                  <div className=\"w-8 text-center text-sm\">{inc || 0}</div>\n                  <button\n                    className={`px-2 py-1 text-sm rounded ${canIncrease(key) ? `bg-gradient-to-r ${medievalTheme.gradients.buttons.primary} text-white` : 'bg-gray-800 text-gray-500 cursor-not-allowed'}`}\n                    onClick={() => increment(key)}\n                    disabled={!canIncrease(key)}\n                  >+</button>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      <div className=\"flex items-center justify-end space-x-2\">\n        <button\n          className=\"px-3 py-2 text-sm rounded bg-gray-700 text-gray-200 hover:bg-gray-600\"\n          onClick={reset}\n        >Cancelar</button>\n        <button\n          className={`px-3 py-2 text-sm rounded ${pointsToSpend > 0 ? `bg-gradient-to-r ${medievalTheme.gradients.buttons.primary} text-white` : 'bg-gray-800 text-gray-500 cursor-not-allowed'}`}\n          onClick={apply}\n          disabled={pointsToSpend <= 0}\n        >Aplicar</button>\n      </div>\n\n      {message && (\n        <div className=\"text-xs text-gray-400\">\n          {message}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AttributeAllocationPanel;\n","export const tokens = {\n  surface: 'bg-gray-800',\n  surfaceText: 'text-gray-100',\n  cardBase: 'bg-gray-800 p-6 rounded-lg text-gray-100',\n  tabActive: 'bg-gray-700 text-white border-gray-600',\n  tabInactive: 'bg-gray-900 text-gray-200 border-gray-700 hover:bg-gray-800',\n  breadcrumbText: 'text-gray-400'\n};","import React, { useEffect, useMemo, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { Hero } from '../types/hero';\nimport { useHeroStore, calculateDerivedAttributes } from '../store/heroStore';\nimport { SHOP_ITEMS } from '../utils/shop';\nimport AchievementsList from './AchievementsList';\nimport ReputationPanel from './ReputationPanel';\nimport AttributeAllocationPanel from './AttributeAllocationPanel';\nimport { tokens } from '../styles/designTokens';\nimport { calculateXPForLevel, LEVEL_CAP } from '../utils/progression';\nimport { medievalTheme, seasonalThemes } from '../styles/medievalTheme';\nimport { useMonetizationStore } from '../store/monetizationStore';\n\ninterface HeroProgressionProps {\n  hero: Hero;\n}\n\nconst HeroProgression: React.FC<HeroProgressionProps> = ({ hero }) => {\n  const location = useLocation();\n  const [activeTab, setActiveTab] = useState<'overview' | 'equipment' | 'achievements' | 'reputation'>('overview');\n  const { useItem, equipItem, sellItem, unequipItem } = useHeroStore();\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-amber-600/30' : 'border-amber-600/30';\n\n  // Calcular XP necessrio para o prximo nvel\n  const isMaxLevel = hero.progression.level >= LEVEL_CAP;\n  const currentLevelXP = calculateXPForLevel(hero.progression.level);\n  const nextLevelXP = isMaxLevel ? currentLevelXP : calculateXPForLevel(hero.progression.level + 1);\n  const xpProgressRaw = hero.progression.xp - currentLevelXP;\n  const xpProgress = Math.max(0, xpProgressRaw);\n  const xpNeeded = Math.max(1, nextLevelXP - currentLevelXP);\n  const xpPercentage = isMaxLevel ? 100 : Math.max(0, Math.min(100, (xpProgress / xpNeeded) * 100));\n\n  // Obter informaes dos itens equipados\n  const equippedWeapons = [hero.inventory.equippedMainHand, hero.inventory.equippedOffHand].filter(Boolean).map(id => SHOP_ITEMS.find(i => i.id === id)).filter(Boolean) as typeof SHOP_ITEMS;\n  const equippedArmorSlots = [hero.inventory.equippedHelm, hero.inventory.equippedChest, hero.inventory.equippedBelt, hero.inventory.equippedGloves, hero.inventory.equippedBoots, hero.inventory.equippedCape].filter(Boolean).map(id => SHOP_ITEMS.find(i => i.id === id)).filter(Boolean) as typeof SHOP_ITEMS;\n  const equippedAccessories = [hero.inventory.equippedRingLeft, hero.inventory.equippedRingRight, hero.inventory.equippedNecklace, hero.inventory.equippedEarringLeft, hero.inventory.equippedEarringRight].filter(Boolean).map(id => SHOP_ITEMS.find(i => i.id === id)).filter(Boolean) as typeof SHOP_ITEMS;\n\n  // Calcular bnus totais dos equipamentos (efeitos diretos + bnus de atributos)\n  const getTotalBonuses = () => {\n    let bonuses = { attack: 0, defense: 0, hp: 0, mp: 0 };\n\n    [...equippedWeapons, ...equippedArmorSlots, ...equippedAccessories].forEach(item => {\n      if (!item) return;\n\n      // Efeitos diretos do item (se existirem)\n      if (item.effects) {\n        bonuses.attack += item.effects.attack || 0;\n        bonuses.defense += item.effects.defense || 0;\n        bonuses.hp += item.effects.hp || 0;\n        bonuses.mp += item.effects.mp || 0;\n      }\n\n      // Bnus de atributos do item (convertidos para mtricas exibidas)\n      if (item.bonus) {\n        const forcaBonus = item.bonus.forca || 0;\n        const destrezaBonus = item.bonus.destreza || 0;\n        const constituicaoBonus = item.bonus.constituicao || 0;\n        const inteligenciaBonus = item.bonus.inteligencia || 0;\n\n        // Ataque: refletir aumento direto de Fora\n        bonuses.attack += forcaBonus;\n\n        // Defesa (Classe de Armadura): depende de Destreza (regra: +1 AC a cada 4 DEX)\n        bonuses.defense += Math.floor(destrezaBonus / 4);\n\n        // HP/MP adicionais conforme frmula dos derivados\n        // hp = hpBase + floor(CON/2) * level ; mp = mpBase + floor(INT/2) * level\n        bonuses.hp += Math.floor(constituicaoBonus / 2) * hero.progression.level;\n        bonuses.mp += Math.floor(inteligenciaBonus / 2) * hero.progression.level;\n      }\n    });\n\n    return bonuses;\n  };\n\n  const totalBonuses = getTotalBonuses();\n\n  const tabs = [\n    { id: 'overview', label: 'Viso Geral', icon: '' },\n    { id: 'equipment', label: 'Equipamentos', icon: '' },\n    { id: 'achievements', label: 'Conquistas', icon: '' },\n    { id: 'reputation', label: 'Reputao', icon: '' }\n  ];\n\n  // Destaque quando atributos derivados mudarem\n  const derivedKey = useMemo(() => (\n    [\n      hero.derivedAttributes.hp,\n      hero.derivedAttributes.mp,\n      hero.derivedAttributes.armorClass,\n      hero.derivedAttributes.initiative,\n      hero.derivedAttributes.luck\n    ].join('-')\n  ), [hero.derivedAttributes.hp, hero.derivedAttributes.mp, hero.derivedAttributes.armorClass, hero.derivedAttributes.initiative, hero.derivedAttributes.luck]);\n  const [highlightDerived, setHighlightDerived] = useState(false);\n  useEffect(() => {\n    setHighlightDerived(true);\n    const t = setTimeout(() => setHighlightDerived(false), 1400);\n    return () => clearTimeout(t);\n  }, [derivedKey]);\n  const powerValue = typeof hero.derivedAttributes.power === 'number' ? hero.derivedAttributes.power : calculateDerivedAttributes(hero.attributes, hero.class, hero.progression.level, hero.inventory, hero.activeTitle).power;\n\n  // Se houver hash na URL, rolar suavemente para a seo correspondente\n  useEffect(() => {\n    if (location.hash) {\n      const id = location.hash.replace('#', '');\n      const el = document.getElementById(id);\n      if (el) {\n        el.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      }\n    }\n  }, [location.hash]);\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n      {/* Header do Heri */}\n      <div className={`bg-gradient-to-r ${medievalTheme.gradients.backgrounds.hero} text-white p-6 rounded-lg border border-slate-700 shadow-xl`}>\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"text-6xl\">{hero.avatar}</div>\n          <div className=\"flex-1\">\n            <h1 className=\"text-3xl font-bold\">{hero.name}</h1>\n            <p className=\"text-lg opacity-90\">{hero.class}  Nvel {hero.progression.level}</p>\n            <div className=\"flex items-center space-x-4 mt-2\">\n              <span className=\"flex items-center space-x-1\">\n                <span></span>\n                <span>{hero.progression.gold}</span>\n              </span>\n              <span className=\"flex items-center space-x-1\">\n                <span></span>\n                <span>{hero.progression.reputation}</span>\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Navegao por Abas */}\n      <div className=\"border-b border-slate-700\">\n        <nav className=\"flex gap-2 flex-wrap\">\n          {tabs.map(tab => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as any)}\n              className={`flex items-center gap-2 py-2 px-3 rounded border font-medium text-sm transition-colors ${activeTab === tab.id ? tokens.tabActive : tokens.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n            >\n              <span>{tab.icon}</span>\n              <span className=\"flex items-center gap-2\">\n                {tab.label}\n                {tab.id === 'overview' && typeof hero.attributePoints === 'number' && hero.attributePoints > 0 && (\n                  <span className=\"ml-1 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-amber-600 text-white animate-pulse\">\n                    {hero.attributePoints} pts\n                  </span>\n                )}\n              </span>\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* Contedo das Abas */}\n      {activeTab === 'overview' && (\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* Progresso de XP */}\n          <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n            <h3 className=\"text-xl font-bold mb-4 text-white\"> Progresso</h3>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span className=\"text-gray-300\">Experincia</span>\n                  <span className=\"text-gray-200\">{isMaxLevel ? 'MAX' : `${hero.progression.xp} XP`}</span>\n                </div>\n                <div className=\"w-full bg-gray-700 rounded-full h-3\">\n                  <div \n                    className={`bg-gradient-to-r ${medievalTheme.gradients.buttons.success} h-3 rounded-full transition-all duration-500`}\n                    style={{ width: `${xpPercentage}%` }}\n                  />\n                </div>\n                <div className=\"text-xs text-gray-400 mt-1\">\n                  {isMaxLevel ? 'Nvel Mximo' : `${xpProgress}/${xpNeeded} XP para o nvel ${hero.progression.level + 1}`}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-slate-700\">\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-blue-400\">{hero.stats.questsCompleted}</div>\n                  <div className=\"text-sm text-gray-300\">Misses Completas</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-red-400\">{hero.stats.totalCombats}</div>\n                  <div className=\"text-sm text-gray-300\">Combates</div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Atributos e Bnus */}\n          <div id=\"atributos\" className={`${tokens.cardBase} border border-slate-700`}>\n            <h3 className=\"text-xl font-bold mb-4 text-white\"> Atributos</h3>\n            {/* Painel de Alocao de Pontos */}\n            <div className=\"mb-4\">\n              <AttributeAllocationPanel hero={hero} />\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">Fora</span>\n                  <span className=\"font-medium text-white\">{hero.attributes.forca}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">Destreza</span>\n                  <span className=\"font-medium text-white\">{hero.attributes.destreza}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">Constituio</span>\n                  <span className=\"font-medium text-white\">{hero.attributes.constituicao}</span>\n                </div>\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">Inteligncia</span>\n                  <span className=\"font-medium text-white\">{hero.attributes.inteligencia}</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Atributos Derivados */}\n            <div className={`mt-6 pt-4 border-t border-slate-700 transition ${highlightDerived ? 'ring-2 ring-amber-500 rounded-md' : ''}`}>\n              <div className=\"flex items-center justify-between mb-3\">\n                <h4 className=\"font-semibold text-white\">Atributos Derivados</h4>\n                {highlightDerived && (\n                  <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs bg-amber-600/20 text-amber-400\">\n                    <span></span>\n                    <span>Atributos atualizados</span>\n                  </span>\n                )}\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">HP</span>\n                  <span className=\"font-medium text-white\">\n                    {hero.derivedAttributes.currentHp}/{hero.derivedAttributes.hp}\n                    {totalBonuses.hp > 0 && <span className=\"text-green-600\"> (+{totalBonuses.hp})</span>}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">MP</span>\n                  <span className=\"font-medium text-white\">\n                    {hero.derivedAttributes.currentMp}/{hero.derivedAttributes.mp}\n                    {totalBonuses.mp > 0 && <span className=\"text-blue-600\"> (+{totalBonuses.mp})</span>}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">Ataque</span>\n                  <span className=\"font-medium text-white\">\n                    {hero.attributes.forca}\n                    {totalBonuses.attack > 0 && <span className=\"text-red-600\"> (+{totalBonuses.attack})</span>}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">Defesa</span>\n                  <span className=\"font-medium text-white\">\n                    {hero.derivedAttributes.armorClass}\n                    {totalBonuses.defense > 0 && <span className=\"text-blue-600\"> (+{totalBonuses.defense})</span>}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-300\">Poder</span>\n                  <span className=\"font-medium text-white\">{powerValue}</span>\n                </div>\n              </div>\n          </div>\n          </div>\n\n          {/* Inventrio Rpido */}\n          <div className={`${tokens.cardBase} border ${seasonalBorder} lg:col-span-2`}>\n            <h3 className=\"text-xl font-bold mb-4 text-white\"> Inventrio</h3>\n            \n            {Object.keys(hero.inventory.items).length > 0 ? (\n              <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4\">\n                {Object.entries(hero.inventory.items).map(([itemId, quantity]) => {\n                  const item = SHOP_ITEMS.find(i => i.id === itemId);\n                  if (!item || quantity <= 0) return null;\n                  \n                  return (\n                    <div key={itemId} className=\"bg-gray-800 border border-gray-700 p-3 rounded-lg text-center\">\n                      <div className=\"text-2xl mb-1\">{item.icon}</div>\n                      <div className=\"text-sm font-medium text-white\">{item.name}</div>\n                      <div className=\"text-xs text-gray-300\">x{quantity}</div>\n                      {item.type === 'consumable' && (\n                        <button\n                          onClick={() => useItem(hero.id, itemId)}\n                          className=\"mt-2 px-2 py-1 bg-emerald-600 text-white text-xs rounded hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                        >\n                          Usar\n                        </button>\n                      )}\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-gray-400\">\n                <div className=\"text-4xl mb-2\"></div>\n                <div>Inventrio vazio</div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {activeTab === 'equipment' && (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n      {/* Slots de Equipamento (multi) */}\n      <div className=\"lg:col-span-2 space-y-6\">\n        <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n          <h3 className=\"text-lg font-bold mb-4 text-white\"> Armas</h3>\n          <div className=\"grid grid-cols-2 gap-3\">\n            {['mainHand','offHand'].map((slot, idx) => {\n              const id = slot === 'mainHand' ? hero.inventory.equippedMainHand : hero.inventory.equippedOffHand;\n              const item = id ? SHOP_ITEMS.find(i => i.id === id) : null;\n              return (\n                <div key={`w-${idx}`} className=\"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded\">\n                  {item ? (\n                    <>\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"text-2xl\">{item.icon}</div>\n                        <div>\n                          <div className=\"font-medium text-white\">{item.name}</div>\n                          <div className=\"text-xs text-gray-300\">{item.description}</div>\n                        </div>\n                      </div>\n                      <button onClick={() => unequipItem(hero.id, id!)} className=\"px-3 py-1 bg-gray-700 text-white text-sm rounded\">Desequipar</button>\n                    </>\n                  ) : (\n                    <div className=\"text-gray-400 text-center w-full\">Slot vazio</div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n        <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n          <h3 className=\"text-lg font-bold mb-4 text-white\"> Armaduras</h3>\n          <div className=\"grid grid-cols-2 gap-3\">\n            {(['helm','chest','belt','gloves','boots','cape'] as const).map((slot) => {\n              const id = (slot === 'helm' ? hero.inventory.equippedHelm : slot === 'chest' ? hero.inventory.equippedChest : slot === 'belt' ? hero.inventory.equippedBelt : slot === 'gloves' ? hero.inventory.equippedGloves : slot === 'boots' ? hero.inventory.equippedBoots : hero.inventory.equippedCape);\n              const item = id ? SHOP_ITEMS.find(i => i.id === id) : null;\n              return (\n                <div key={`a-${slot}`} className=\"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded\">\n                  {item ? (\n                    <>\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"text-2xl\">{item.icon}</div>\n                        <div>\n                          <div className=\"font-medium text-white\">{item.name}</div>\n                          <div className=\"text-xs text-gray-300\">{item.description}</div>\n                        </div>\n                      </div>\n                      <button onClick={() => unequipItem(hero.id, id!)} className=\"px-3 py-1 bg-gray-700 text-white text-sm rounded\">Desequipar</button>\n                    </>\n                  ) : (\n                    <div className=\"text-gray-400 text-center w-full\">Slot vazio</div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n        <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n          <h3 className=\"text-lg font-bold mb-4 text-white\"> Acessrios</h3>\n          <div className=\"grid grid-cols-3 gap-3\">\n            {(['ringLeft','ringRight','necklace','earringLeft','earringRight'] as const).map((slot) => {\n              const id = slot === 'ringLeft' ? hero.inventory.equippedRingLeft : slot === 'ringRight' ? hero.inventory.equippedRingRight : slot === 'necklace' ? hero.inventory.equippedNecklace : slot === 'earringLeft' ? hero.inventory.equippedEarringLeft : hero.inventory.equippedEarringRight;\n              const item = id ? SHOP_ITEMS.find(i => i.id === id) : null;\n              return (\n                <div key={`x-${slot}`} className=\"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded\">\n                  {item ? (\n                    <>\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"text-2xl\">{item.icon}</div>\n                        <div>\n                          <div className=\"font-medium text-white\">{item.name}</div>\n                          <div className=\"text-xs text-gray-300\">{item.description}</div>\n                        </div>\n                      </div>\n                      <button onClick={() => unequipItem(hero.id, id!)} className=\"px-3 py-1 bg-gray-700 text-white text-sm rounded\">Desequipar</button>\n                    </>\n                  ) : (\n                    <div className=\"text-gray-400 text-center w-full\">Slot vazio</div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n\n          {/* Resumo de Bnus */}\n          <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n            <h3 className=\"text-lg font-bold mb-4 text-white\"> Bnus Totais</h3>\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-300\">Ataque</span>\n                <span className={`font-medium ${totalBonuses.attack > 0 ? 'text-red-400' : 'text-gray-400'}`}>\n                  +{totalBonuses.attack}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-300\">Defesa</span>\n                <span className={`font-medium ${totalBonuses.defense > 0 ? 'text-blue-400' : 'text-gray-400'}`}>\n                  +{totalBonuses.defense}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-300\">HP</span>\n                <span className={`font-medium ${totalBonuses.hp > 0 ? 'text-green-400' : 'text-gray-400'}`}>\n                  +{totalBonuses.hp}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-300\">MP</span>\n                <span className={`font-medium ${totalBonuses.mp > 0 ? 'text-purple-400' : 'text-gray-400'}`}>\n                  +{totalBonuses.mp}\n                </span>\n              </div>\n            </div>\n\n            {/* Itens Equipveis no Inventrio */}\n            <div className=\"mt-6 pt-4 border-t\">\n              <h4 className=\"font-semibold mb-3 text-white\">Equipar</h4>\n              <div className=\"space-y-2\">\n                {Object.entries(hero.inventory.items).map(([itemId, quantity]) => {\n                  const item = SHOP_ITEMS.find(i => i.id === itemId);\n                  if (!item || quantity <= 0 || item.type === 'consumable' || item.type === 'cosmetic' || item.type === 'material') return null;\n                  \n                  const isEquipped = \n                    (hero.inventory.equippedWeapons || []).includes(itemId) ||\n                    (hero.inventory.equippedArmorSlots || []).includes(itemId) ||\n                    (hero.inventory.equippedAccessories || []).includes(itemId);\n                  \n                  if (isEquipped) return null;\n                  \n                  return (\n                    <button\n                      key={itemId}\n                      onClick={() => equipItem(hero.id, itemId)}\n                      className=\"w-full flex items-center space-x-2 p-2 bg-gray-800 border border-gray-700 rounded text-white hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                    >\n                      <span>{item.icon}</span>\n                      <span className=\"text-sm\">{item.name}</span>\n                    </button>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {activeTab === 'achievements' && (\n        <AchievementsList hero={hero} />\n      )}\n\n      {activeTab === 'reputation' && (\n        <ReputationPanel hero={hero} />\n      )}\n    </div>\n  );\n};\n\nexport default HeroProgression;\n","import React, { useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { seasonalThemes } from '../styles/medievalTheme';\n\nconst ActivitiesPanel: React.FC = () => {\n  const { activitiesLog } = useHeroStore() as any;\n  const [filter, setFilter] = useState<'all'|'dialogue'|'rumor'|'tip'|'event'>('all');\n  const [loc, setLoc] = useState<'all'|'tavern'|'guild'>('all');\n  const items = useMemo(() => {\n    const arr = Array.isArray(activitiesLog) ? activitiesLog : [];\n    return arr\n      .filter((e: any) => (filter==='all'|| e.type===filter) && (loc==='all' || e.location===loc))\n      .sort((a: any,b: any) => new Date(b.ts).getTime() - new Date(a.ts).getTime());\n  }, [activitiesLog, filter, loc]);\n  const seasonalBorder = (seasonalThemes as any)[useHeroStore.getState().useMonetizationStore?.activeSeasonalTheme || '']?.border || 'border-slate-700';\n  return (\n    <div className={`bg-gray-800 p-6 rounded-lg border ${seasonalBorder} text-slate-200`}>\n      <div className=\"flex items-center justify-between mb-3\">\n        <h2 className=\"text-2xl font-bold text-white\"> Atividades</h2>\n        <div className=\"flex items-center gap-2\">\n          <select value={filter} onChange={(e) => setFilter(e.target.value as any)} className=\"border rounded px-2 py-1 text-sm bg-slate-900 border-slate-600 text-slate-200\">\n            <option value=\"all\">Todas</option>\n            <option value=\"dialogue\">Dilogos</option>\n            <option value=\"rumor\">Rumores</option>\n            <option value=\"tip\">Dicas</option>\n            <option value=\"event\">Eventos</option>\n          </select>\n          <select value={loc} onChange={(e) => setLoc(e.target.value as any)} className=\"border rounded px-2 py-1 text-sm bg-slate-900 border-slate-600 text-slate-200\">\n            <option value=\"all\">Todos locais</option>\n            <option value=\"tavern\">Taverna</option>\n            <option value=\"guild\">Guilda</option>\n          </select>\n        </div>\n      </div>\n      <ul className=\"space-y-2\">\n        {items.map((e: any, idx: number) => (\n          <li key={`${e.ts}-${idx}`} className=\"p-3 rounded border bg-slate-800 border-slate-700 flex items-center justify-between\">\n            <div>\n              <div className=\"font-medium text-slate-100\">{e.text}</div>\n              <div className=\"text-xs text-slate-400\">{new Date(e.ts).toLocaleString()}  {e.location || ''}  {e.type}</div>\n            </div>\n            <div className=\"text-xs text-slate-400\">{e.importance === 'high' ? 'Importante' : e.importance === 'low' ? 'Leve' : 'Normal'}</div>\n          </li>\n        ))}\n        {items.length === 0 && (\n          <li className=\"p-3 rounded border bg-slate-800 border-slate-700 text-sm text-slate-400\">Sem atividades no filtro atual.</li>\n        )}\n      </ul>\n    </div>\n  );\n};\n\nexport default ActivitiesPanel;","import React, { useEffect, useState } from 'react';\nimport { Hero, Guild, Quest } from '../types/hero';\nimport { useHeroStore } from '../store/heroStore';\nimport ActivitiesPanel from './ActivitiesPanel';\n\ninterface GuildSystemProps {\n  hero: Hero;\n}\n\nconst GuildSystem: React.FC<GuildSystemProps> = ({ hero }) => {\n  const [activeTab, setActiveTab] = useState<'browse' | 'my-guild' | 'create'>('browse');\n  const [newGuildName, setNewGuildName] = useState('');\n  const [newGuildDescription, setNewGuildDescription] = useState('');\n  \n  const { \n    guilds, \n    availableQuests,\n    createGuild, \n    joinGuild, \n    leaveGuild,\n    acceptQuest,\n    completeQuest,\n    refreshQuests,\n    depositGoldToGuild,\n    withdrawGoldFromGuild,\n    contributeXPToGuild,\n    ensureDefaultGuildExists,\n    heroes,\n    selectHero\n  } = useHeroStore();\n\n  const [depositAmount, setDepositAmount] = useState('');\n  const [withdrawAmount, setWithdrawAmount] = useState('');\n  const [contributeXPAmount, setContributeXPAmount] = useState('');\n\n  const currentGuild = hero.progression.guildId ? \n    guilds.find(g => g.id === hero.progression.guildId) : null;\n\n  useEffect(() => {\n    try { useHeroStore.getState().triggerAutoInteraction('guild'); } catch {}\n  }, [hero.id]);\n\n  const handleCreateGuild = () => {\n    if (newGuildName.trim() && newGuildDescription.trim()) {\n      createGuild(hero.id, newGuildName.trim(), newGuildDescription.trim());\n      setNewGuildName('');\n      setNewGuildDescription('');\n      setActiveTab('my-guild');\n    }\n  };\n\n  const handleJoinGuild = (guildId: string) => {\n    joinGuild(hero.id, guildId);\n    setActiveTab('my-guild');\n  };\n\n  const handleLeaveGuild = () => {\n    if (currentGuild) {\n      leaveGuild(hero.id, currentGuild.id);\n      setActiveTab('browse');\n    }\n  };\n\n  const handleQuickJoinDefaultGuild = () => {\n    ensureDefaultGuildExists();\n    const defaultGuild = guilds.find(g => g.name === 'Foja dos Herois');\n    if (defaultGuild) {\n      joinGuild(hero.id, defaultGuild.id);\n      setActiveTab('my-guild');\n    }\n  };\n\n  const handleAcceptGuildQuest = (questId: string) => {\n    console.log(' Tentando aceitar misso de guilda:', {\n      questId,\n      heroId: hero.id,\n      heroLevel: hero.progression.level,\n      activeQuests: hero.activeQuests.length,\n      maxActiveQuests: 3\n    });\n    \n    const quest = availableQuests.find(q => q.id === questId);\n    console.log(' Misso encontrada:', quest);\n    \n    const result = acceptQuest(hero.id, questId);\n    console.log(' Resultado da aceitao:', result);\n    \n    if (result) {\n      console.log(' Misso aceita com sucesso!');\n    } else {\n      console.log(' Falha ao aceitar misso');\n    }\n  };\n\n  const handleCompleteGuildQuest = (questId: string) => {\n    console.log(' Tentando completar misso de guilda:', {\n      questId,\n      heroId: hero.id,\n      heroLevel: hero.progression.level,\n      activeQuests: hero.activeQuests\n    });\n    \n    const quest = availableQuests.find(q => q.id === questId);\n    console.log(' Misso encontrada:', quest);\n    \n    const result = completeQuest(hero.id, questId, true); // autoResolve=true para misses de guilda\n    console.log(' Resultado da concluso:', result);\n    \n    if (result !== null) {\n      // Mostrar narrativa do combate\n      if (result.log && result.log.length > 0) {\n        console.log(' Narrativa do Combate:');\n        result.log.forEach((line, index) => {\n          setTimeout(() => console.log(`   ${line}`), index * 500);\n        });\n      }\n      \n      if (result.victory) {\n        console.log(' VITRIA! Misso completada com sucesso!');\n        alert(` VITRIA!\\n\\n${result.log?.join('\\n') || 'Misso completada com sucesso!'}`);\n      } else {\n        console.log(' DERROTA! A misso falhou...');\n        alert(` DERROTA!\\n\\n${result.log?.join('\\n') || 'A misso falhou. Tente novamente quando estiver mais forte!'}`);\n      }\n    } else {\n      console.log(' Falha ao completar misso');\n      alert(' Erro ao processar a misso. Tente novamente.');\n    }\n  };\n\n  const getQuestDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case 'fcil': return 'text-green-600 bg-green-100';\n      case 'mdia': return 'text-yellow-600 bg-yellow-100';\n      case 'difcil': return 'text-red-600 bg-red-100';\n      default: return 'text-gray-600 bg-gray-100';\n    }\n  };\n\n  const getQuestTypeIcon = (type: string) => {\n    switch (type) {\n      case 'Contrato': return '';\n      case 'Caa': return '';\n      case 'Explorao': return '';\n      case 'Histria': return '';\n      default: return '';\n    }\n  };\n\n  const tabs = [\n    { id: 'browse', label: 'Explorar Partys', icon: '' },\n    { id: 'my-guild', label: currentGuild ? 'Minha Party' : 'Sem Party', icon: '' },\n    { id: 'create', label: 'Criar Party', icon: '' }\n  ];\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 rounded-lg\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\"> Sistema de Party</h1>\n            <p className=\"text-lg opacity-90\">\n              {currentGuild ? `Membro da ${currentGuild.name}` : 'Aventureiro Independente'}\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <label className=\"text-sm opacity-90\">Heri:</label>\n            <select\n              value={hero.id}\n              onChange={(e) => selectHero(e.target.value)}\n              className=\"bg-white text-indigo-800 px-2 py-1 rounded shadow-sm\"\n            >\n              {heroes.filter(h => h.origin !== 'npc').map(h => (\n                <option key={h.id} value={h.id}>{h.name}</option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      <ActivitiesPanel />\n\n      {/* Navegao */}\n      <div className=\"border-b border-gray-200\">\n        <nav className=\"flex space-x-8\">\n          {tabs.map(tab => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as any)}\n              className={`\n                flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm transition-colors\n                ${activeTab === tab.id\n                  ? 'border-purple-500 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }\n              `}\n            >\n              <span>{tab.icon}</span>\n              <span>{tab.label}</span>\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* Contedo das Abas */}\n      {activeTab === 'browse' && (\n        <div className=\"space-y-6\">\n          <h2 className=\"text-2xl font-bold text-gray-800\">Partys Disponveis</h2>\n          \n          {guilds.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {guilds.map(guild => (\n                <div key={guild.id} className=\"bg-white p-6 rounded-lg border border-gray-200 hover:shadow-lg transition-shadow\">\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div>\n                      <h3 className=\"text-xl font-bold text-gray-800\">{guild.name}</h3>\n                      <p className=\"text-sm text-gray-600 mt-1\">{guild.description}</p>\n                    </div>\n                    <div className=\"text-2xl\"></div>\n                  </div>\n                  \n                  <div className=\"space-y-2 mb-4\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-600\">Membros:</span>\n                      <span className=\"font-medium\">{guild.members.length}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-600\">XP da Party:</span>\n                      <span className=\"font-medium\">{guild.guildXP}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-600\">Tesouro:</span>\n                      <span className=\"font-medium\">{guild.bankGold} </span>\n                    </div>\n                  </div>\n\n                  {hero.progression.guildId === guild.id ? (\n                    <div className=\"bg-green-100 text-green-800 px-3 py-2 rounded text-center text-sm font-medium\">\n                       Membro desta party\n                    </div>\n                  ) : hero.progression.guildId ? (\n                    <div className=\"bg-gray-100 text-gray-600 px-3 py-2 rounded text-center text-sm\">\n                      J  membro de outra party\n                    </div>\n                  ) : (\n                    <button\n                      onClick={() => handleJoinGuild(guild.id)}\n                      className=\"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors\"\n                    >\n                      Entrar na Party\n                    </button>\n                  )}\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-12 text-gray-500\">\n              <div className=\"text-6xl mb-4\"></div>\n              <h3 className=\"text-xl font-medium mb-2\">Nenhuma party encontrada</h3>\n              <p>Crie a primeira party!</p>\n            </div>\n          )}\n        </div>\n      )}\n\n      {activeTab === 'my-guild' && (\n        <div className=\"space-y-6\">\n          {currentGuild ? (\n            <>\n              {/* Informaes da Guilda */}\n              <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n                <div className=\"flex items-start justify-between mb-6\">\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-gray-800\">{currentGuild.name}</h2>\n                    <p className=\"text-gray-600 mt-1\">{currentGuild.description}</p>\n                  </div>\n                  <button\n                    onClick={handleLeaveGuild}\n                    className=\"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors\"\n                  >\n                    Sair da Party\n                  </button>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <div className=\"text-center\">\n                    <div className=\"text-3xl font-bold text-purple-600\">{currentGuild.members.length}</div>\n                    <div className=\"text-sm text-gray-600\">Membros</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-3xl font-bold text-blue-600\">{currentGuild.guildXP}</div>\n                    <div className=\"text-sm text-gray-600\">XP da Party</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-3xl font-bold text-indigo-600\">{currentGuild.level ?? Math.max(1, Math.floor(currentGuild.guildXP / 250) + 1)}</div>\n                    <div className=\"text-sm text-gray-600\">Nvel da Party</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-3xl font-bold text-yellow-600\">{currentGuild.bankGold}</div>\n                    <div className=\"text-sm text-gray-600\">Tesouro</div>\n                  </div>\n                </div>\n\n                {/* Operaes de Tesouro/Contribuio */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6\">\n                  <div className=\"bg-gray-50 p-4 rounded border border-gray-200\">\n                    <div className=\"text-sm font-medium text-gray-800 mb-2\">Depositar Ouro</div>\n                    <div className=\"flex gap-2\">\n                      <input\n                        type=\"number\"\n                        min={1}\n                        value={depositAmount}\n                        onChange={e => setDepositAmount(e.target.value)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                        placeholder=\"Quantidade\"\n                      />\n                      <button\n                        onClick={() => {\n                          const amt = parseInt(depositAmount, 10);\n                          if (!isNaN(amt) && amt > 0) {\n                            const ok = depositGoldToGuild(hero.id, amt);\n                            if (ok) setDepositAmount('');\n                          }\n                        }}\n                        className=\"px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700\"\n                      >\n                        Depositar\n                      </button>\n                    </div>\n                    <div className=\"text-xs text-gray-500 mt-2\">Seu ouro: {hero.progression.gold}</div>\n                  </div>\n                  <div className=\"bg-gray-50 p-4 rounded border border-gray-200\">\n                    <div className=\"text-sm font-medium text-gray-800 mb-2\">Sacar Ouro</div>\n                    <div className=\"flex gap-2\">\n                      <input\n                        type=\"number\"\n                        min={1}\n                        value={withdrawAmount}\n                        onChange={e => setWithdrawAmount(e.target.value)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                        placeholder=\"Quantidade\"\n                      />\n                      <button\n                        onClick={() => {\n                          const amt = parseInt(withdrawAmount, 10);\n                          if (!isNaN(amt) && amt > 0) {\n                            const ok = withdrawGoldFromGuild(hero.id, amt);\n                            if (ok) setWithdrawAmount('');\n                          }\n                        }}\n                        className=\"px-3 py-2 bg-amber-600 text-white rounded hover:bg-amber-700\"\n                      >\n                        Sacar\n                      </button>\n                    </div>\n                    <div className=\"text-xs text-gray-500 mt-2\">Tesouro da party: {currentGuild.bankGold}</div>\n                    <div className=\"text-xs text-gray-500\">Necessita papel: lder/oficial</div>\n                  </div>\n                  <div className=\"bg-gray-50 p-4 rounded border border-gray-200\">\n                    <div className=\"text-sm font-medium text-gray-800 mb-2\">Contribuir XP</div>\n                    <div className=\"flex gap-2\">\n                      <input\n                        type=\"number\"\n                        min={1}\n                        value={contributeXPAmount}\n                        onChange={e => setContributeXPAmount(e.target.value)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                        placeholder=\"Quantidade\"\n                      />\n                      <button\n                        onClick={() => {\n                          const amt = parseInt(contributeXPAmount, 10);\n                          if (!isNaN(amt) && amt > 0) {\n                            const ok = contributeXPToGuild(hero.id, amt);\n                            if (ok) {\n                              refreshQuests(hero.progression.level);\n                              setContributeXPAmount('');\n                            }\n                          }\n                        }}\n                        className=\"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n                      >\n                        Contribuir\n                      </button>\n                    </div>\n                    <div className=\"text-xs text-gray-500 mt-2\">Aumenta o nvel da party</div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Membros da Guilda */}\n              <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n                <h3 className=\"text-xl font-bold mb-4 text-gray-800\"> Membros</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {currentGuild.members.map(memberId => {\n                    const isCurrentHero = memberId === hero.id;\n                    const ref = heroes.find(h => h.id === memberId);\n                    const isNPC = ref?.origin === 'npc';\n                    const displayName = isCurrentHero ? hero.name : (ref?.name || `Membro ${memberId.slice(-4)}`);\n                    const displayClass = isCurrentHero ? `${hero.class}  Nvel ${hero.progression.level}` : (ref ? `${ref.class}  Nvel ${ref.progression.level}` : 'Aventureiro');\n                    const avatar = isCurrentHero ? hero.avatar : (ref?.avatar || '');\n                    return (\n                      <div key={memberId} className={`p-3 rounded-lg border ${isCurrentHero ? 'bg-blue-50 border-blue-200' : 'bg-gray-50 border-gray-200'}`}>\n                        <div className=\"flex items-center space-x-3\">\n                          <div className=\"text-2xl\">{avatar}</div>\n                          <div>\n                            <div className=\"font-medium flex items-center gap-2\">\n                              <span>{displayName}</span>\n                              {isNPC && <span className=\"text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded\">NPC</span>}\n                            </div>\n                            <div className=\"text-sm text-gray-600\">{displayClass}</div>\n                          </div>\n                          {isCurrentHero && <span className=\"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded\">Voc</span>}\n                          {currentGuild.roles && currentGuild.roles[memberId] && (\n                            <span className=\"text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded\">\n                              {currentGuild.roles[memberId] === 'lider' ? 'Lder' : currentGuild.roles[memberId] === 'oficial' ? 'Oficial' : 'Membro'}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n\n              {/* Quadro de Misses da Guilda removido: misses agora so obtidas no hub da Guilda dos Aventureiros */}\n            </>\n          ) : (\n            <div className=\"text-center py-12 text-gray-500\">\n              <div className=\"text-6xl mb-4\"></div>\n              <h3 className=\"text-xl font-medium mb-2\">Voc no est em nenhuma guilda</h3>\n              <p className=\"mb-6\">Explore guildas existentes ou crie a sua prpria!</p>\n              <div className=\"space-x-4\">\n                <button\n                  onClick={() => setActiveTab('browse')}\n                  className=\"bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition-colors\"\n                >\n                  Explorar Guildas\n                </button>\n                <button\n                  onClick={() => setActiveTab('create')}\n                  className=\"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors\"\n                >\n                  Criar Guilda\n                </button>\n                <button\n                  onClick={handleQuickJoinDefaultGuild}\n                  className=\"bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition-colors\"\n                >\n                  Entrar na Foja dos Herois\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {activeTab === 'create' && (\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\n            <h2 className=\"text-2xl font-bold text-gray-800 mb-6\"> Criar Nova Party</h2>\n            \n            {hero.progression.guildId ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <div className=\"text-4xl mb-2\"></div>\n                <h3 className=\"text-lg font-medium mb-2\">Voc j est em uma party</h3>\n                <p>Saia da sua party atual para criar uma nova.</p>\n              </div>\n            ) : (\n              <div className=\"space-y-6\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Nome da Party\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={newGuildName}\n                    onChange={(e) => setNewGuildName(e.target.value)}\n                    placeholder=\"Digite o nome da sua party...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                    maxLength={50}\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Descrio\n                  </label>\n                  <textarea\n                    value={newGuildDescription}\n                    onChange={(e) => setNewGuildDescription(e.target.value)}\n                    placeholder=\"Descreva o propsito e valores da sua party...\"\n                    rows={4}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                    maxLength={200}\n                  />\n                </div>\n                \n                <div className=\"bg-blue-50 p-4 rounded-lg\">\n                  <h4 className=\"font-medium text-blue-800 mb-2\"> Dicas para criar uma party</h4>\n                  <ul className=\"text-sm text-blue-700 space-y-1\">\n                    <li> Escolha um nome nico e memorvel</li>\n                  <li> Descreva claramente o foco da party (PvE, social, etc.)</li>\n                    <li> Defina expectativas para os membros</li>\n                    <li> Seja acolhedor para atrair novos aventureiros</li>\n                  </ul>\n                </div>\n                \n                <button\n                  onClick={handleCreateGuild}\n                  disabled={!newGuildName.trim() || !newGuildDescription.trim()}\n                  className=\"w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors\"\n                >\n                  Criar Party\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default GuildSystem;\n","import { supabase, supabaseConfigured } from '../lib/supabaseClient';\nimport type { Hero } from '../types/hero';\n\nexport type DungeonRunPayload = {\n  user_id: string;\n  hero_id: string;\n  hero_name: string;\n  max_floor_reached: number;\n  victory: boolean;\n  total_xp: number;\n  total_gold: number;\n  logs: any;\n  started_at?: string;\n  finished_at?: string;\n};\n\nexport async function saveDungeonRun(hero: Hero, summary: Omit<DungeonRunPayload, 'user_id' | 'hero_id' | 'hero_name'>): Promise<{ ok: boolean; error?: string; offline?: boolean }>{\n  if (!supabaseConfigured) return { ok: true, offline: true };\n  try {\n    const { data: usr } = await supabase.auth.getUser();\n    const userId = usr?.user?.id;\n    if (!userId) return { ok: false, error: 'Faa login para registrar a run.' };\n    const payload: DungeonRunPayload = {\n      user_id: userId,\n      hero_id: hero.id,\n      hero_name: hero.name,\n      max_floor_reached: summary.max_floor_reached,\n      victory: summary.victory,\n      total_xp: summary.total_xp,\n      total_gold: summary.total_gold,\n      logs: summary.logs,\n      started_at: summary.started_at,\n      finished_at: summary.finished_at || new Date().toISOString()\n    };\n    const { error } = await supabase\n      .from('dungeon_runs')\n      .insert(payload);\n    if (error) return { ok: false, error: error.message };\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Falha ao salvar run.' };\n  }\n}\n\n// Inicia uma run com started_at e retorna o id do registro\nexport async function startDungeonRun(hero: Hero, startedAt?: string): Promise<{ ok: boolean; runId?: string; offline?: boolean; error?: string }>{\n  if (!supabaseConfigured) return { ok: true, offline: true };\n  try {\n    const { data: usr } = await supabase.auth.getUser();\n    const userId = usr?.user?.id;\n    if (!userId) return { ok: false, error: 'Faa login para iniciar a run.' };\n    const payload: Partial<DungeonRunPayload> = {\n      user_id: userId,\n      hero_id: hero.id,\n      hero_name: hero.name,\n      max_floor_reached: 0,\n      victory: false,\n      total_xp: 0,\n      total_gold: 0,\n      logs: [],\n      started_at: startedAt || new Date().toISOString()\n    };\n    const { data, error } = await supabase\n      .from('dungeon_runs')\n      .insert(payload)\n      .select('id')\n      .limit(1);\n    if (error) return { ok: false, error: error.message };\n    const runId = Array.isArray(data) && data.length ? (data[0] as any).id : undefined;\n    return { ok: true, runId };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Falha ao iniciar run.' };\n  }\n}\n\n// Atualiza snapshot da run (andares, totais e logs) de forma incremental\nexport async function updateDungeonRun(runId: string, snapshot: { max_floor_reached: number; total_xp: number; total_gold: number; logs: any[] }): Promise<{ ok: boolean; offline?: boolean; error?: string }>{\n  if (!supabaseConfigured) return { ok: true, offline: true };\n  try {\n    const { error } = await supabase\n      .from('dungeon_runs')\n      .update({\n        max_floor_reached: snapshot.max_floor_reached,\n        total_xp: snapshot.total_xp,\n        total_gold: snapshot.total_gold,\n        logs: snapshot.logs\n      })\n      .eq('id', runId);\n    if (error) return { ok: false, error: error.message };\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Falha ao atualizar run.' };\n  }\n}\n\n// Finaliza a run existente com vitria/derrota, totais e finished_at\nexport async function finishDungeonRun(runId: string, summary: { victory: boolean; max_floor_reached: number; total_xp: number; total_gold: number; logs: any[]; finished_at?: string }): Promise<{ ok: boolean; offline?: boolean; error?: string }>{\n  if (!supabaseConfigured) return { ok: true, offline: true };\n  try {\n    const { error } = await supabase\n      .from('dungeon_runs')\n      .update({\n        victory: summary.victory,\n        max_floor_reached: summary.max_floor_reached,\n        total_xp: summary.total_xp,\n        total_gold: summary.total_gold,\n        logs: summary.logs,\n        finished_at: summary.finished_at || new Date().toISOString()\n      })\n      .eq('id', runId);\n    if (error) return { ok: false, error: error.message };\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Falha ao finalizar run.' };\n  }\n}\n\nexport async function getLastRunForHeroToday(hero: Hero): Promise<{ exists: boolean; error?: string; offline?: boolean }>{\n  if (!supabaseConfigured) return { exists: false, offline: true };\n  try {\n    const { data: usr } = await supabase.auth.getUser();\n    const userId = usr?.user?.id;\n    if (!userId) return { exists: false };\n    const startOfDay = new Date();\n    startOfDay.setHours(0, 0, 0, 0);\n    const { data, error } = await supabase\n      .from('dungeon_runs')\n      .select('id, finished_at')\n      .eq('user_id', userId)\n      .eq('hero_id', hero.id)\n      .gte('finished_at', startOfDay.toISOString())\n      .limit(1);\n    if (error) return { exists: false, error: error.message };\n    return { exists: Array.isArray(data) && data.length > 0 };\n  } catch (err: any) {\n    return { exists: false, error: err?.message || 'Erro ao verificar tentativas.' };\n  }\n}\n\nexport type DungeonLeaderboardEntry = {\n  hero_name: string;\n  max_floor_reached: number;\n  total_xp: number;\n  total_gold: number;\n  finished_at: string;\n};\n\nexport async function getDungeonLeaderboard(limit = 10): Promise<{ data: DungeonLeaderboardEntry[]; offline?: boolean; error?: string }>{\n  if (!supabaseConfigured || import.meta.env.DEV) return { data: [], offline: true };\n  try {\n    const { data, error } = await supabase\n      .from('dungeon_leaderboard')\n      .select('*')\n      .limit(limit);\n    if (error) {\n      const msg = String(error.message || '');\n      const notFound = msg.includes('Could not find the table') || msg.includes('does not exist');\n      return notFound ? { data: [], offline: true } : { data: [], error: error.message };\n    }\n    return { data: (Array.isArray(data) ? data : []) as DungeonLeaderboardEntry[] };\n  } catch (err: any) {\n    return { data: [], error: err?.message || 'Falha ao carregar leaderboard da dungeon.' };\n  }\n}\n\nexport type WeeklyDungeonHighlights = {\n  bestRun?: {\n    hero_name: string;\n    max_floor_reached: number;\n    finished_at: string;\n  };\n  biggestLoot?: {\n    hero_name: string;\n    total_gold: number;\n    finished_at: string;\n  };\n};\n\nexport async function getWeeklyDungeonHighlights(): Promise<{ data: WeeklyDungeonHighlights; offline?: boolean; error?: string }>{\n  if (!supabaseConfigured || import.meta.env.DEV) return { data: {}, offline: true };\n  try {\n    const oneWeekAgo = new Date();\n    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n\n    const { data: bestRuns, error: errBest } = await supabase\n      .from('dungeon_runs')\n      .select('hero_name, max_floor_reached, finished_at')\n      .gte('finished_at', oneWeekAgo.toISOString())\n      .order('max_floor_reached', { ascending: false })\n      .order('finished_at', { ascending: true })\n      .limit(1);\n\n    const { data: lootRuns, error: errLoot } = await supabase\n      .from('dungeon_runs')\n      .select('hero_name, total_gold, finished_at')\n      .gte('finished_at', oneWeekAgo.toISOString())\n      .order('total_gold', { ascending: false })\n      .order('finished_at', { ascending: true })\n      .limit(1);\n\n    if (errBest || errLoot) {\n      const msg = String(errBest?.message || errLoot?.message || '');\n      const notFound = msg.includes('Could not find the table') || msg.includes('does not exist');\n      return notFound ? { data: {}, offline: true } : { data: {}, error: (errBest?.message || errLoot?.message) };\n    }\n\n    const bestRun = Array.isArray(bestRuns) && bestRuns.length ? bestRuns[0] : undefined;\n    const biggestLoot = Array.isArray(lootRuns) && lootRuns.length ? lootRuns[0] : undefined;\n\n    return { data: { bestRun, biggestLoot } };\n  } catch (err: any) {\n    return { data: {}, error: err?.message || 'Falha ao carregar destaques semanais da dungeon.' };\n  }\n}\n","import React, { useEffect, useState } from 'react';\nimport { tokens } from '../styles/designTokens';\nimport { Link } from 'react-router-dom';\nimport { useGameSettingsStore } from '../store/gameSettingsStore';\nimport { useHeroStore } from '../store/heroStore';\nimport { getMaxAttributeForRank } from '../utils/attributeSystem';\nimport { rankSystem } from '../utils/rankSystem';\nimport { onboardingManager } from '../utils/onboardingSystem';\n\ninterface TrainingOption {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  cost: number;\n  currency?: 'gold' | 'glory' | 'arcaneEssence';\n  duration: number; // em minutos\n  fatiguePenalty?: number; // penalidade de fadiga aplicada ao concluir\n  rewards: {\n    xp?: number;\n    gold?: number;\n    attributes?: Record<string, number>;\n  };\n  requirements?: {\n    level?: number;\n    gold?: number;\n  };\n}\n\nconst TRAINING_OPTIONS: TrainingOption[] = [\n  {\n    id: 'basic-combat',\n    name: 'Treinamento Bsico de Combate',\n    description: 'Aprenda os fundamentos do combate corpo a corpo',\n    icon: '',\n    cost: 30,\n    currency: 'gold',\n    duration: 3,\n    fatiguePenalty: 15,\n    rewards: {\n      xp: 25,\n      attributes: { forca: 1 }\n    }\n  },\n  {\n    id: 'agility-training',\n    name: 'Treinamento de Agilidade',\n    description: 'Melhore sua velocidade e reflexos',\n    icon: '',\n    cost: 30,\n    currency: 'gold',\n    duration: 3,\n    fatiguePenalty: 15,\n    rewards: {\n      xp: 30,\n      attributes: { destreza: 1 }\n    }\n  },\n  {\n    id: 'magic-studies',\n    name: 'Estudos Mgicos',\n    description: 'Aprofunde seus conhecimentos arcanos',\n    icon: '',\n    cost: 35,\n    currency: 'arcaneEssence',\n    duration: 3,\n    fatiguePenalty: 15,\n    rewards: {\n      xp: 40,\n      attributes: { inteligencia: 1 }\n    },\n    requirements: {\n      level: 3\n    }\n  },\n  {\n    id: 'meditation',\n    name: 'Meditao Espiritual',\n    description: 'Fortalea sua mente e esprito',\n    icon: '',\n    cost: 30,\n    currency: 'glory',\n    duration: 3,\n    fatiguePenalty: 10,\n    rewards: {\n      xp: 35,\n      attributes: { inteligencia: 1 }\n    }\n  },\n  {\n    id: 'endurance-training',\n    name: 'Treinamento de Resistncia',\n    description: 'Aumente sua resistncia fsica',\n    icon: '',\n    cost: 40,\n    currency: 'gold',\n    duration: 3,\n    fatiguePenalty: 25,\n    rewards: {\n      xp: 45,\n      attributes: { constituicao: 1 }\n    },\n    requirements: {\n      level: 2\n    }\n  },\n  {\n    id: 'charisma-workshop',\n    name: 'Workshop de Liderana',\n    description: 'Desenvolva suas habilidades sociais',\n    icon: '',\n    cost: 50,\n    currency: 'glory',\n    duration: 3,\n    fatiguePenalty: 10,\n    rewards: {\n      xp: 50,\n      attributes: { destreza: 1 }\n    },\n    requirements: {\n      level: 5\n    }\n  },\n  {\n    id: 'advanced-combat',\n    name: 'Combate Avanado',\n    description: 'Tcnicas avanadas de combate',\n    icon: '',\n    cost: 100,\n    currency: 'glory',\n    duration: 3,\n    fatiguePenalty: 30,\n    rewards: {\n      xp: 100,\n      attributes: { forca: 2, destreza: 1 }\n    },\n    requirements: {\n      level: 10\n    }\n  },\n  {\n    id: 'treasure-hunting',\n    name: 'Caa ao Tesouro',\n    description: 'Aprenda a encontrar tesouros escondidos',\n    icon: '',\n    cost: 75,\n    currency: 'gold',\n    duration: 3,\n    fatiguePenalty: 20,\n    rewards: {\n      xp: 60,\n      gold: 150\n    },\n    requirements: {\n      level: 7\n    }\n  }\n];\n\nconst Training: React.FC = () => {\n  const { getSelectedHero, updateHero, updateDailyGoalProgress } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const [activeTraining, setActiveTraining] = useState<string | null>(null);\n  const [trainingEndTime, setTrainingEndTime] = useState<number | null>(null);\n  const [tick, setTick] = useState(0); // fora re-render para atualizar contador\n  const currentRank = selectedHero?.rankData?.currentRank || (selectedHero ? rankSystem.calculateRank(selectedHero) : undefined);\n  const maxAttr = currentRank ? getMaxAttributeForRank(currentRank) : undefined;\n  const attemptsByStatus = { ...(selectedHero?.stats as any)?.trainingAttemptsByStatus || {} } as Record<string, number>;\n  \n\n  // Atualiza o contador em tempo real enquanto houver treinamento ativo\n  useEffect(() => {\n    if (!activeTraining || !trainingEndTime) return;\n    const id = setInterval(() => {\n      setTick((t) => t + 1);\n    }, 500);\n    return () => clearInterval(id);\n  }, [activeTraining, trainingEndTime]);\n\n  useEffect(() => {\n    if (!selectedHero) return;\n    const last = selectedHero.stats.lastTrainingDate ? new Date(selectedHero.stats.lastTrainingDate).toDateString() : '';\n    const today = new Date().toDateString();\n    if (last !== today) {\n      updateHero(selectedHero.id, { stats: { ...selectedHero.stats, trainingsToday: 0, trainingAttemptsByStatus: {}, lastTrainingDate: new Date().toISOString() } });\n    }\n  }, [selectedHero?.id]);\n\n  // Retomar/Concluir treino baseado em stats persistidos\n  useEffect(() => {\n    if (!selectedHero) return;\n    const activeUntilISO = selectedHero.stats.trainingActiveUntil;\n    const activeName = selectedHero.stats.trainingActiveName;\n    if (!activeUntilISO || !activeName) return;\n    const endTs = new Date(activeUntilISO).getTime();\n    const now = Date.now();\n    const option = TRAINING_OPTIONS.find(o => o.name === activeName) || null;\n    if (!option) {\n      // Limpar status invlido\n      updateHero(selectedHero.id, { stats: { ...selectedHero.stats, trainingActiveUntil: undefined, trainingActiveName: undefined } });\n      return;\n    }\n    if (now < endTs) {\n      // Reativar contador local\n      setActiveTraining(option.id);\n      setTrainingEndTime(endTs);\n    } else {\n      // Concluir imediatamente e aplicar decremento dirio\n      completeTraining(option);\n    }\n  }, [selectedHero?.id]);\n\n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Centro de Treinamento</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para comear o treinamento.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n\n  // Custo com desconto global (buff da Guilda)\n  const getDiscountedCost = (option: TrainingOption) => {\n    if (\n      selectedHero.progression.level <= 1 &&\n      (option.id === 'basic-combat' || option.id === 'agility-training')\n    ) {\n      return 0;\n    }\n    const discountPercent = useGameSettingsStore.getState().trainingCostReductionPercent || 0;\n    const capped = Math.max(0, Math.min(100, discountPercent));\n    const discounted = Math.ceil(option.cost * (1 - capped / 100));\n    return Math.max(0, discounted);\n  };\n\n  const canAffordTraining = (option: TrainingOption) => {\n    const currency = option.currency || 'gold';\n    const prog = selectedHero.progression;\n    const balance = currency === 'gold' ? (prog.gold || 0)\n                    : currency === 'glory' ? (prog.glory || 0)\n                    : (prog.arcaneEssence || 0);\n    return balance >= getDiscountedCost(option);\n  };\n\n  const meetsRequirements = (option: TrainingOption) => {\n    if (option.requirements?.level && selectedHero.progression.level < option.requirements.level) {\n      return false;\n    }\n    if (option.requirements?.gold && selectedHero.progression.gold < option.requirements.gold) {\n      return false;\n    }\n    return true;\n  };\n\n  const startTraining = (option: TrainingOption) => {\n    if (!canAffordTraining(option) || !meetsRequirements(option)) return;\n\n    // Bloquear se qualquer atributo-alvo j estiver no limite\n    if (option.rewards.attributes && maxAttr !== undefined) {\n      const atCap = Object.entries(option.rewards.attributes).some(([attr]) => {\n        const current = (selectedHero.attributes as any)[attr] || 0;\n        return current >= (maxAttr as number);\n      });\n      if (atCap) {\n        alert('Este treinamento no pode ser iniciado: atributo j est no limite.');\n        return;\n      }\n    }\n\n    // Verificar limite dirio por status e reset se mudou o dia\n    const now = new Date();\n    const nowISO = now.toISOString();\n    const lastDateStr = selectedHero.stats.lastTrainingDate ? new Date(selectedHero.stats.lastTrainingDate).toDateString() : '';\n    const todayStr = now.toDateString();\n    const attemptsByStatus = { ...(selectedHero.stats as any).trainingAttemptsByStatus || {} } as Record<string, number>;\n    const dailyLimitPerStatus = 10;\n\n    if (lastDateStr !== todayStr) {\n      // Reset dirio\n      for (const k of Object.keys(attemptsByStatus)) delete attemptsByStatus[k];\n      updateHero(selectedHero.id, {\n        stats: {\n          ...selectedHero.stats,\n          trainingsToday: 0,\n          lastTrainingDate: nowISO\n        }\n      });\n    }\n\n    if (option.rewards.attributes) {\n      const blocked = Object.keys(option.rewards.attributes).some(attr => (attemptsByStatus[attr] || 0) >= dailyLimitPerStatus);\n      if (blocked) {\n        alert('Limite dirio de treino por status atingido (10). Volte amanh.');\n        return;\n      }\n    }\n\n    // Deduzir custo conforme a moeda\n    const currency = option.currency || 'gold';\n    const prog = selectedHero.progression;\n    const newProgression = { ...prog } as any;\n    const effectiveCost = getDiscountedCost(option);\n    if (currency === 'gold') newProgression.gold = (prog.gold || 0) - effectiveCost;\n    else if (currency === 'glory') newProgression.glory = (prog.glory || 0) - effectiveCost;\n    else newProgression.arcaneEssence = (prog.arcaneEssence || 0) - effectiveCost;\n    updateHero(selectedHero.id, { progression: newProgression });\n\n    setActiveTraining(option.id);\n    const isFirstTrainingAtLv1 = (selectedHero.progression.level === 1) && ((selectedHero.stats.trainingsToday || 0) === 0);\n    const effectiveDuration = isFirstTrainingAtLv1 ? 0.5 : option.duration;\n    const endTime = Date.now() + (effectiveDuration * 60 * 1000);\n    setTrainingEndTime(endTime);\n\n    updateHero(selectedHero.id, {\n      stats: {\n        ...selectedHero.stats,\n        trainingActiveUntil: new Date(endTime).toISOString(),\n        trainingActiveName: option.name,\n        lastTrainingDate: nowISO\n      }\n    });\n\n    setTimeout(() => {\n      completeTraining(option);\n    }, effectiveDuration * 60 * 1000);\n  };\n\n  const completeTraining = (option: TrainingOption) => {\n    const updates: any = {};\n\n    // Escalonar recompensas conforme Fadiga\n    const fatigue = selectedHero.progression.fatigue || 0;\n    let effectiveness = 1;\n    if (fatigue >= 70) effectiveness = 0.5;\n    else if (fatigue >= 40) effectiveness = 0.75;\n\n    // Aplicar recompensas\n    if (option.rewards.xp) {\n      const isFirstTrainingAtLv1 = (selectedHero.progression.level === 1) && ((selectedHero.stats.trainingsToday || 0) === 0);\n      const baseXP = isFirstTrainingAtLv1 ? 150 : option.rewards.xp;\n      const gained = Math.floor(baseXP * effectiveness);\n      try { useHeroStore.getState().gainXP(selectedHero.id, gained); } catch {}\n    }\n\n    if (option.rewards.gold) {\n      const gained = Math.floor(option.rewards.gold * effectiveness);\n      updates.progression = { ...(updates.progression || {}), gold: (selectedHero.progression.gold || 0) + gained };\n    }\n\n    if (option.rewards.attributes && maxAttr !== undefined) {\n      updates.attributes = { ...selectedHero.attributes };\n      Object.entries(option.rewards.attributes).forEach(([attr, value]) => {\n        const current = (selectedHero.attributes as any)[attr] || 0;\n        const next = current + Math.max(1, Math.floor(value * effectiveness));\n        (updates.attributes as any)[attr] = Math.min(maxAttr as number, next);\n      });\n    }\n\n    // Incrementar contador dirio de treinos\n    const nowISO = new Date().toISOString();\n    const trainingsToday = (selectedHero.stats.trainingsToday || 0) + 1;\n    const attemptsByStatus = { ...(selectedHero.stats as any).trainingAttemptsByStatus || {} } as Record<string, number>;\n    if (option.rewards.attributes) {\n      Object.keys(option.rewards.attributes).forEach(attr => {\n        attemptsByStatus[attr] = (attemptsByStatus[attr] || 0) + 1;\n      });\n    }\n\n    updates.stats = {\n      ...selectedHero.stats,\n      trainingsToday,\n      lastTrainingDate: nowISO,\n      trainingDailyLimit: 10,\n      trainingAttemptsByStatus: attemptsByStatus,\n      // limpar status de treino ativo\n      trainingActiveUntil: undefined,\n      trainingActiveName: undefined\n    };\n\n    // Aplicar Fadiga ao concluir\n    const penalty = option.fatiguePenalty ?? 20;\n    const nextFatigue = Math.min(100, (selectedHero.progression.fatigue || 0) + penalty);\n    updates.progression = { ...(updates.progression || {}), fatigue: nextFatigue };\n\n    try { delete (updates.progression as any).xp; } catch {}\n    try { delete (updates.progression as any).level; } catch {}\n    try { delete (updates.progression as any).stars; } catch {}\n    try { delete (updates.progression as any).titles; } catch {}\n    updateHero(selectedHero.id, updates);\n    // Atualizar metas dirias relacionadas\n    updateDailyGoalProgress(selectedHero.id, 'attribute-trained', 1);\n    if (option.rewards.xp) {\n      const isFirstTrainingAtLv1 = (selectedHero.progression.level === 1) && ((selectedHero.stats.trainingsToday || 0) >= 1);\n      updateDailyGoalProgress(selectedHero.id, 'xp-gained', isFirstTrainingAtLv1 ? 150 : option.rewards.xp);\n    }\n    if (option.rewards.gold) {\n      updateDailyGoalProgress(selectedHero.id, 'gold-earned', option.rewards.gold);\n    }\n    setActiveTraining(null);\n    setTrainingEndTime(null);\n\n    alert(`Treinamento concludo! Efetividade ${Math.round(effectiveness*100)}%. Recompensas de ${option.name} aplicadas.`);\n    try { localStorage.setItem('hfn_training_basic_done', '1'); } catch {}\n    try { onboardingManager.markStepValidated('basic-training'); onboardingManager.saveState(); } catch {}\n  };\n\n  const getRemainingTime = () => {\n    if (!trainingEndTime) return 0;\n    return Math.max(0, trainingEndTime - Date.now());\n  };\n\n  const formatTime = (ms: number) => {\n    const minutes = Math.floor(ms / 60000);\n    const seconds = Math.floor((ms % 60000) / 1000);\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {/* Header */}\n      <div className=\"text-center mb-8\">\n        <h1 className=\"text-4xl font-bold text-gray-800 mb-2\">\n           Centro de Treinamento\n        </h1>\n        <p className=\"text-gray-600\">\n          Aprimore suas habilidades e atributos atravs de treinamentos especializados\n        </p>\n        <div className=\"mt-4 flex flex-wrap justify-center gap-2\">\n          <div className=\"bg-blue-100 border border-blue-400 rounded-lg px-3 py-2 inline-flex items-center\">\n            <span className=\"text-blue-800 font-medium\"> Ouro: {selectedHero.progression.gold || 0}g</span>\n          </div>\n          <div className=\"bg-purple-100 border border-purple-400 rounded-lg px-3 py-2 inline-flex items-center\">\n            <span className=\"text-purple-800 font-medium\"> Glria: {selectedHero.progression.glory || 0}</span>\n          </div>\n          <div className=\"bg-indigo-100 border border-indigo-400 rounded-lg px-3 py-2 inline-flex items-center\">\n            <span className=\"text-indigo-800 font-medium\"> Essncia Arcana: {selectedHero.progression.arcaneEssence || 0}</span>\n          </div>\n          <div className=\"bg-red-100 border border-red-400 rounded-lg px-3 py-2 inline-flex items-center\">\n            <span className=\"text-red-800 font-medium\"> Fadiga: {selectedHero.progression.fatigue || 0}/100</span>\n          </div>\n        </div>\n        <div className=\"mt-2 bg-green-100 border border-green-400 rounded-lg p-2 inline-block ml-2\">\n          <span className=\"text-green-800 font-medium\">\n             Limite por status: 10 tentativas por atributo\n          </span>\n        </div>\n        <div className=\"mt-2 flex flex-wrap justify-center gap-2\">\n          {(['forca','destreza','constituicao','inteligencia'] as const)\n            .slice()\n            .sort((a,b) => (attemptsByStatus[b]||0) - (attemptsByStatus[a]||0))\n            .map(attr => {\n              const used = attemptsByStatus[attr] || 0;\n              const blocked = used >= 10;\n              const boxCls = blocked ? 'bg-red-100 border border-red-400 text-red-800' : 'bg-gray-100 border border-gray-300 text-gray-800';\n              return (\n                <div key={attr} className={`${boxCls} rounded px-3 py-1 text-sm`}> \n                  <span className=\"font-medium capitalize\">{attr}</span>: {used}/10\n                </div>\n              );\n            })}\n        </div>\n      </div>\n\n      {/* Status do Treinamento Ativo */}\n      {activeTraining && (\n        <div className=\"bg-yellow-100 border border-yellow-400 rounded-lg p-4 mb-6\">\n          <div className=\"text-center\">\n            <h3 className=\"text-lg font-bold text-yellow-800 mb-2\">\n               Treinamento em Andamento\n            </h3>\n            <p className=\"text-yellow-700\">\n              {TRAINING_OPTIONS.find(t => t.id === activeTraining)?.name}\n            </p>\n            <p className=\"text-yellow-600 text-sm mt-1\">\n              Tempo restante: {formatTime(getRemainingTime())}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Opes de Treinamento */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {TRAINING_OPTIONS.map((option) => {\n          const canAfford = canAffordTraining(option);\n          const meetsReqs = meetsRequirements(option);\n          const attemptsByStatus = { ...(selectedHero.stats as any).trainingAttemptsByStatus || {} } as Record<string, number>;\n          const dailyLimitPerStatus = 10;\n          const attrCapBlocked = option.rewards.attributes && maxAttr !== undefined ? Object.entries(option.rewards.attributes).some(([attr]) => {\n            const current = (selectedHero.attributes as any)[attr] || 0;\n            return current >= (maxAttr as number);\n          }) : false;\n          const perStatusBlocked = option.rewards.attributes ? Object.keys(option.rewards.attributes).some(attr => (attemptsByStatus[attr] || 0) >= dailyLimitPerStatus) : false;\n          const isAvailable = canAfford && meetsReqs && !activeTraining && !attrCapBlocked && !perStatusBlocked;\n\n          return (\n            <div key={option.id} className={`${tokens.cardBase} border-2 shadow-sm ${isAvailable ? 'border-green-400 hover:shadow-md' : 'border-gray-700'} transition-shadow`}>\n              <div className=\"text-center mb-4\">\n                <div className=\"text-4xl mb-2\">{option.icon}</div>\n                <h3 className=\"text-lg font-bold\">{option.name}</h3>\n                <p className=\"text-sm text-gray-300 mt-1\">{option.description}</p>\n              </div>\n\n              {/* Informaes */}\n        <div className=\"space-y-2 mb-4\">\n          <div className=\"flex justify-between text-sm\">\n            <span className=\"text-gray-600\">Custo:</span>\n            <span className={`font-medium ${\n              (option.currency || 'gold') === 'gold' ? 'text-yellow-600' :\n              (option.currency || 'gold') === 'glory' ? 'text-purple-700' : 'text-indigo-700'\n            }`}>\n              {getDiscountedCost(option)} {(option.currency || 'gold') === 'gold' ? 'ouro' : (option.currency || 'gold') === 'glory' ? 'glria' : 'essncia'}\n            </span>\n          </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-gray-600\">Durao:</span>\n                  <span className=\"font-medium\">{(selectedHero.progression.level === 1 && ((selectedHero.stats.trainingsToday || 0) === 0)) ? '30s' : `${option.duration} min`}</span>\n                </div>\n              </div>\n\n              {/* Requisitos */}\n              {option.requirements && (\n                <div className=\"mb-4\">\n                  <h4 className=\"text-sm font-medium text-gray-700 mb-1\">Requisitos:</h4>\n                  {option.requirements.level && (\n                    <div className={`text-xs ${selectedHero.progression.level >= option.requirements.level ? 'text-green-600' : 'text-red-600'}`}>\n                      Nvel {option.requirements.level}+\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Recompensas */}\n              <div className=\"mb-4\">\n                <h4 className=\"text-sm font-medium text-gray-700 mb-1\">Recompensas:</h4>\n                <div className=\"space-y-1\">\n                  {option.rewards.xp && (\n                    <div className=\"text-xs text-blue-600\">+{(selectedHero.progression.level === 1 && ((selectedHero.stats.trainingsToday || 0) === 0)) ? 150 : option.rewards.xp} XP</div>\n                  )}\n                  {option.rewards.gold && (\n                    <div className=\"text-xs text-yellow-600\">+{option.rewards.gold} Ouro</div>\n                  )}\n                  {option.rewards.attributes && Object.entries(option.rewards.attributes).map(([attr, value]) => {\n                    const used = attemptsByStatus[attr] || 0;\n                    const blocked = used >= 10;\n                    const cls = blocked ? 'text-red-600' : 'text-green-600';\n                    return (\n                      <div key={attr} className={`text-xs ${cls}`}>\n                        +{value} {attr.charAt(0).toUpperCase() + attr.slice(1)}\n                        <span className={blocked ? 'ml-2 text-red-600' : 'ml-2 text-gray-500'}>({used}/10 hoje)</span>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n\n              {/* Boto */}\n              <button\n                onClick={() => startTraining(option)}\n                disabled={!isAvailable}\n                className={`w-full py-2 px-4 rounded font-medium transition-colors ${\n                  isAvailable\n                    ? 'bg-green-600 hover:bg-green-700 text-white'\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                }`}\n              >\n                {!canAfford ? ((option.currency || 'gold') === 'gold' ? 'Ouro Insuficiente' : (option.currency || 'gold') === 'glory' ? 'Glria Insuficiente' : 'Essncia Insuficiente') :\n                 !meetsReqs ? 'Requisitos no atendidos' :\n                 attrCapBlocked ? 'Atributo no limite' :\n                 activeTraining ? 'Treinamento em andamento' :\n                 perStatusBlocked ? 'Limite por status atingido' :\n                 'Iniciar Treinamento'}\n              </button>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default Training;\n","import { Hero, CombatResult, QuestEnemy } from '../types/hero';\nimport { autoResolveCombat } from '../utils/combat';\n\nexport interface DailyAutoMissionRun {\n  victory: boolean;\n  xpGained: number;\n  goldGained: number;\n  itemsGained: any[];\n  log: string[];\n  enemies: QuestEnemy[];\n}\n\nexport interface DailyAutoMissionResult {\n  heroId: string;\n  dateKey: string; // YYYY-MM-DD\n  runs: DailyAutoMissionRun[];\n  xpTotal: number;\n  goldTotal: number;\n  victories: number;\n}\n\nfunction dateKey(date = new Date()): string {\n  const y = date.getFullYear();\n  const m = String(date.getMonth() + 1).padStart(2, '0');\n  const d = String(date.getDate()).padStart(2, '0');\n  return `${y}-${m}-${d}`;\n}\n\nfunction pickEnemiesForLevel(level: number): QuestEnemy[] {\n  if (level <= 2) {\n    return [\n      { type: 'Goblin', count: 2, level: Math.max(1, level) },\n      { type: 'Lobo', count: 1, level }\n    ];\n  }\n  if (level <= 5) {\n    return [\n      { type: 'Bandido', count: 1, level },\n      { type: 'Esqueleto', count: 1, level }\n    ];\n  }\n  return [\n    { type: 'Troll', count: 1, level },\n    { type: 'Bandido', count: 2, level }\n  ];\n}\n\nfunction storageKey(heroId: string, dayKey: string) {\n  return `idle_daily_${heroId}_${dayKey}`;\n}\n\nexport function runDailyAutoMissions(hero: Hero, maxRuns?: number): DailyAutoMissionResult {\n  const level = Number(hero?.progression?.level || 1);\n  const runsCount = Math.max(1, Math.min(3, maxRuns || (level <= 2 ? 1 : level <= 5 ? 2 : 3)));\n  const dayKey = dateKey(new Date());\n  const heroId = hero.id || hero.name || 'anon';\n\n  const runs: DailyAutoMissionRun[] = [];\n  let xpTotal = 0;\n  let goldTotal = 0;\n  let victories = 0;\n\n  for (let i = 0; i < runsCount; i++) {\n    const enemies = pickEnemiesForLevel(level);\n    const result: CombatResult = autoResolveCombat(hero, enemies);\n    runs.push({\n      victory: result.victory,\n      xpGained: result.xpGained,\n      goldGained: result.goldGained,\n      itemsGained: result.itemsGained || [],\n      log: result.log || [],\n      enemies\n    });\n    xpTotal += result.xpGained;\n    goldTotal += result.goldGained;\n    victories += result.victory ? 1 : 0;\n  }\n\n  const payload: DailyAutoMissionResult = {\n    heroId,\n    dateKey: dayKey,\n    runs,\n    xpTotal,\n    goldTotal,\n    victories\n  };\n\n  try {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      window.localStorage.setItem(storageKey(heroId, dayKey), JSON.stringify(payload));\n    }\n  } catch {}\n\n  return payload;\n}\n\nexport function getDailyResult(hero: Hero): DailyAutoMissionResult | null {\n  const heroId = hero.id || hero.name || 'anon';\n  const dayKey = dateKey(new Date());\n  try {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      const raw = window.localStorage.getItem(storageKey(heroId, dayKey));\n      if (raw) return JSON.parse(raw);\n    }\n  } catch {}\n  return null;\n}\n\nexport function getOrRunDailyResult(hero: Hero, maxRuns?: number): DailyAutoMissionResult {\n  const existing = getDailyResult(hero);\n  if (existing) return existing;\n  return runDailyAutoMissions(hero, maxRuns);\n}\n\n","import React, { useState, useEffect } from 'react';\nimport { tokens } from '../styles/designTokens';\nimport { useHeroStore } from '../store/heroStore';\nimport { \n  LEADERBOARD_CONFIGS, \n  generateAllLeaderboards, \n  getHeroRanking,\n  getRankColor,\n  getRankIcon,\n  formatRankChange,\n  getTopHeroes,\n  getHeroesAroundRank,\n  generateMockLeaderboardData\n} from '../utils/leaderboardSystem';\nimport type { Leaderboard, LeaderboardEntry } from '../types/hero';\nimport { getOrRunDailyResult } from '../services/idleBattleService';\nimport { notificationBus } from './NotificationSystem';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes } from '../styles/medievalTheme';\n\ninterface DailyEntry {\n  heroId: string;\n  heroName: string;\n  heroLevel: number;\n  score: number;\n  xpToday: number;\n  goldToday: number;\n  victoriesToday: number;\n  timestamp: number;\n}\n\nconst Leaderboards: React.FC = () => {\n  const { getSelectedHero, heroes } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-amber-600/30' : 'border-amber-600/30';\n  const seasonalHeaderBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-amber-500/30' : 'border-amber-500/30';\n  const [localHeroId, setLocalHeroId] = useState<string | null>(selectedHero?.id ?? (heroes[0]?.id ?? null));\n  const viewHero = (localHeroId ? heroes.find(h => h.id === localHeroId) : undefined) || selectedHero;\n  const [selectedLeaderboard, setSelectedLeaderboard] = useState('xp');\n  const [leaderboards, setLeaderboards] = useState<Leaderboard[]>([]);\n  const [viewMode, setViewMode] = useState<'top' | 'around'>('top');\n  const [dailyEntries, setDailyEntries] = useState<DailyEntry[]>([]);\n  const [dailySubmitting, setDailySubmitting] = useState(false);\n  const [dailySummary, setDailySummary] = useState<any | null>(null);\n\n  useEffect(() => {\n    if (!viewHero) return;\n    const generatedLeaderboards = generateAllLeaderboards(heroes);\n    setLeaderboards(generatedLeaderboards);\n\n    let mounted = true;\n    (async () => {\n      try {\n        const res = await fetch('/api/daily/leaderboard');\n        if (!mounted) return;\n        const data = await res.json();\n        if (!mounted) return;\n        setDailyEntries(Array.isArray(data.entries) ? data.entries : []);\n      } catch {}\n      try {\n        const summary = await getOrRunDailyResult(viewHero);\n        if (!mounted) return;\n        setDailySummary(summary);\n      } catch {}\n    })();\n    return () => { mounted = false; };\n  }, [viewHero, heroes]);\n\n  if (!viewHero) {\n    return (\n      <div className=\"text-center p-8\">\n        <h2 className=\"text-2xl font-bold text-amber-400 mb-4\">Selecione um Heri</h2>\n        <p className=\"text-gray-300\">Voc precisa selecionar um heri para ver os rankings.</p>\n      </div>\n    );\n  }\n\n  const currentLeaderboard = leaderboards.find(lb => lb.id === selectedLeaderboard);\n  const heroRanking = getHeroRanking(viewHero, heroes);\n  const config = LEADERBOARD_CONFIGS.find(c => c.id === selectedLeaderboard);\n\n  const renderLeaderboardEntry = (entry: LeaderboardEntry, isCurrentHero: boolean = false) => (\n    <div \n      key={entry.heroId}\n      className={`flex items-center justify-between p-4 rounded-lg transition-all ${\n        isCurrentHero \n          ? 'bg-amber-600/20 border border-amber-500 shadow-lg' \n          : 'bg-gray-700 hover:bg-gray-600'\n      }`}\n    >\n      <div className=\"flex items-center space-x-4\">\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-2xl\">{getRankIcon(entry.rank)}</span>\n          <span className={`font-bold text-lg ${getRankColor(entry.rank)}`}>\n            #{entry.rank}\n          </span>\n        </div>\n        \n        <div>\n          <div className=\"flex items-center space-x-2\">\n            <h3 className={`font-semibold ${isCurrentHero ? 'text-amber-400' : 'text-white'}`}>\n              {entry.heroName}\n              {entry.isNPC && <span className=\"ml-2 text-xs bg-gray-600 px-2 py-1 rounded\">NPC</span>}\n              {isCurrentHero && <span className=\"ml-2 text-xs bg-amber-600 px-2 py-1 rounded\">VOC</span>}\n            </h3>\n          </div>\n          <p className=\"text-sm text-gray-400\">\n            {entry.heroRace} {entry.heroClass}\n          </p>\n        </div>\n      </div>\n      \n      <div className=\"text-right\">\n        <div className={`font-bold ${config?.color || 'text-white'}`}>\n          {config?.formatValue(entry.value) || entry.value}\n        </div>\n        {entry.change !== 0 && (\n          <div className=\"text-xs text-gray-400\">\n            {formatRankChange(entry.change)}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Ranking Dirio (MVP) */}\n      {viewHero && (\n        <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n          <div className=\"flex items-center justify-between mb-3 md:mb-4\">\n            <h3 className=\"text-lg md:text-xl font-bold text-white flex items-center\">\n              <span className=\"mr-2\"></span>\n              Ranking Dirio (MVP)\n            </h3>\n            <div className=\"flex items-center gap-2\">\n              <label className=\"text-xs text-gray-300\">Heri:</label>\n              <select\n                value={localHeroId ?? ''}\n                onChange={(e) => setLocalHeroId(e.target.value)}\n                className=\"bg-gray-700 text-white text-sm px-2 py-1 rounded border border-gray-600\"\n              >\n                {heroes.map(h => (\n                  <option key={h.id} value={h.id}>{h.name}</option>\n                ))}\n              </select>\n            <button\n              onClick={async () => {\n                if (dailySubmitting) return;\n                setDailySubmitting(true);\n                try {\n                  await fetch('/api/daily/submit', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ hero: viewHero })\n                  });\n                  const resLb = await fetch('/api/daily/leaderboard');\n                  const dataLb = await resLb.json();\n                  setDailyEntries(Array.isArray(dataLb.entries) ? dataLb.entries : []);\n                  notificationBus.emit({\n                    type: 'achievement',\n                    title: 'Ranking Dirio',\n                    message: 'Resultado enviado com sucesso! Confira o Top do dia.',\n                    icon: '',\n                    duration: 3500\n                  });\n                } catch {\n                  notificationBus.emit({\n                    type: 'quest',\n                    title: 'Falha no envio',\n                    message: 'No foi possvel enviar seu resultado dirio.',\n                    icon: '',\n                    duration: 4000\n                  });\n                } finally {\n                  setDailySubmitting(false);\n                }\n              }}\n              className={`px-3 md:px-4 py-2 rounded-lg font-medium transition-colors text-sm md:text-base ${\n                dailySubmitting ? 'bg-gray-700 text-gray-400' : 'bg-amber-600 text-white hover:bg-amber-700'\n              }`}\n            >\n              {dailySubmitting ? 'Enviando...' : 'Enviar Resultado de Hoje'}\n            </button>\n            </div>\n          </div>\n          {dailySummary && (\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-3 md:mb-4 text-center\">\n              <div className=\"bg-gray-700 rounded p-2 md:p-3\">\n                <div className=\"text-blue-400 text-base md:text-lg\"> XP Hoje</div>\n                <div className=\"text-white text-lg md:text-xl font-bold\">{dailySummary.xpTotal ?? 0}</div>\n              </div>\n              <div className=\"bg-gray-700 rounded p-2 md:p-3\">\n                <div className=\"text-yellow-400 text-base md:text-lg\"> Ouro Hoje</div>\n                <div className=\"text-white text-lg md:text-xl font-bold\">{dailySummary.goldTotal ?? 0}</div>\n              </div>\n              <div className=\"bg-gray-700 rounded p-2 md:p-3\">\n                <div className=\"text-green-400 text-base md:text-lg\"> Vitrias</div>\n                <div className=\"text-white text-lg md:text-xl font-bold\">{dailySummary.victories ?? 0}</div>\n              </div>\n              <div className=\"bg-gray-700 rounded p-2 md:p-3\">\n                <div className=\"text-purple-400 text-base md:text-lg\"> Execues</div>\n                <div className=\"text-white text-lg md:text-xl font-bold\">{Array.isArray(dailySummary.runs) ? dailySummary.runs.length : 0}</div>\n              </div>\n            </div>\n          )}\n          <div>\n            <h4 className=\"text-base md:text-lg font-semibold text-white mb-2\">Top de Hoje</h4>\n            {dailyEntries.length === 0 ? (\n              <div className=\"text-gray-400\">Nenhuma entrada enviada ainda.</div>\n            ) : (\n              <div className=\"space-y-2\">\n                {dailyEntries.slice(0, 10).map(entry => (\n                  <div key={entry.heroId} className={`flex items-center justify-between p-2 md:p-3 rounded ${entry.heroId === viewHero.id ? 'bg-amber-600/20 border border-amber-500' : 'bg-gray-700'}`}>\n                    <div className=\"flex items-center gap-3\">\n                      <span className=\"text-white text-sm md:text-base font-medium\">{entry.heroName}</span>\n                      <span className=\"text-gray-400 text-xs md:text-sm\">Nv {entry.heroLevel}</span>\n                      {entry.heroId === viewHero.id && (\n                        <span className=\"text-amber-400 bg-amber-600/20 px-2 py-0.5 rounded text-[11px] md:text-xs\">Voc</span>\n                      )}\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"text-white text-sm md:text-base font-bold\">{Math.round(entry.score)} pts</div>\n                      <div className=\"text-gray-400 text-[11px] md:text-xs\">{entry.victoriesToday} vitrias  {entry.xpToday} XP  {entry.goldToday} ouro</div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      {/* Header com Ranking do Heri */}\n      <div className={`bg-gradient-to-r from-amber-900/50 to-amber-800/30 rounded-lg p-4 md:p-6 border ${seasonalHeaderBorder}`}>\n        <h2 className=\"text-xl md:text-2xl font-bold text-amber-400 mb-3 md:mb-4 flex items-center\">\n          <span className=\"text-2xl md:text-3xl mr-2 md:mr-3\"></span>\n          Rankings & Leaderboards\n        </h2>\n        \n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4\">\n          <div className=\"text-center\">\n            <div className=\"text-xl md:text-2xl font-bold text-yellow-400\">#{heroRanking.globalRank}</div>\n            <div className=\"text-xs md:text-sm text-gray-400\">Ranking Global</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-xl md:text-2xl font-bold text-blue-400\">#{heroRanking.classRank}</div>\n            <div className=\"text-xs md:text-sm text-gray-400\">Ranking da Classe</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-xl md:text-2xl font-bold text-purple-400\">{heroRanking.achievements}</div>\n            <div className=\"text-xs md:text-sm text-gray-400\">Conquistas</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-xl md:text-2xl font-bold text-green-400\">{heroRanking.totalScore.toLocaleString()}</div>\n            <div className=\"text-xs md:text-sm text-gray-400\">Pontuao Total</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Seletor de Leaderboard */}\n      <div className={`${tokens.cardBase}`}>\n        <div className=\"flex flex-wrap gap-2 mb-4 md:mb-6\">\n          {LEADERBOARD_CONFIGS.map(config => (\n            <button\n              key={config.id}\n              onClick={() => setSelectedLeaderboard(config.id)}\n              className={`flex items-center space-x-2 px-3 md:px-4 py-2 rounded font-medium transition-colors text-sm md:text-base ${selectedLeaderboard === config.id ? tokens.tabActive : tokens.tabInactive}`}\n            >\n              <span>{config.icon}</span>\n              <span>{config.name}</span>\n            </button>\n          ))}\n        </div>\n\n        {/* Modo de Visualizao */}\n        <div className=\"flex gap-2 mb-3 md:mb-4\">\n          <button\n            onClick={() => setViewMode('top')}\n            className={`px-3 md:px-4 py-2 rounded font-medium transition-colors text-sm md:text-base ${viewMode === 'top' ? tokens.tabActive : tokens.tabInactive}`}\n          >\n            Top 10\n          </button>\n          <button\n            onClick={() => setViewMode('around')}\n            className={`px-3 md:px-4 py-2 rounded font-medium transition-colors text-sm md:text-base ${viewMode === 'around' ? tokens.tabActive : tokens.tabInactive}`}\n          >\n            Ao Redor de Voc\n          </button>\n        </div>\n\n        {/* Leaderboard Content */}\n        {currentLeaderboard && config && (\n          <div>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-xl font-bold text-white flex items-center\">\n                <span className=\"mr-2\">{config.icon}</span>\n                {config.name}\n              </h3>\n              <div className=\"text-sm text-gray-400\">\n                Atualizado: {currentLeaderboard.lastUpdated.toLocaleTimeString()}\n              </div>\n            </div>\n            \n            <p className=\"text-gray-400 mb-6\">{config.description}</p>\n\n            <div className=\"space-y-2\">\n              {viewMode === 'top' ? (\n                // Top 10\n                getTopHeroes(currentLeaderboard, 10).map(entry => \n                  renderLeaderboardEntry(entry, entry.heroId === viewHero.id)\n                )\n              ) : (\n                // Ao redor do heri\n                getHeroesAroundRank(currentLeaderboard, viewHero.id, 5).map(entry => \n                  renderLeaderboardEntry(entry, entry.heroId === viewHero.id)\n                )\n              )}\n            </div>\n\n            {currentLeaderboard.entries.length === 0 && (\n              <div className=\"text-center p-8 text-gray-400\">\n                <p>Nenhum heri encontrado neste ranking.</p>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Dicas de Ranking */}\n      <div className=\"bg-blue-900/30 rounded-lg p-6 border border-blue-500/30\">\n        <h4 className=\"text-lg font-semibold text-blue-400 mb-3 flex items-center\">\n          <span className=\"mr-2\"></span>\n          Como Melhorar seu Ranking\n        </h4>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300\">\n          <div>\n            <h5 className=\"font-medium text-white mb-2\"> Experincia & Nvel</h5>\n            <ul className=\"space-y-1\">\n              <li> Complete misses regularmente</li>\n              <li> Participe de combates</li>\n              <li> Explore novas reas</li>\n            </ul>\n          </div>\n          <div>\n            <h5 className=\"font-medium text-white mb-2\"> Riqueza</h5>\n            <ul className=\"space-y-1\">\n              <li> Venda itens desnecessrios</li>\n              <li> Complete misses com recompensas altas</li>\n              <li> Invista em equipamentos valiosos</li>\n            </ul>\n          </div>\n          <div>\n            <h5 className=\"font-medium text-white mb-2\"> Conquistas</h5>\n            <ul className=\"space-y-1\">\n              <li> Desbloqueie ttulos especiais</li>\n              <li> Complete desafios nicos</li>\n              <li> Mantenha streaks de login</li>\n            </ul>\n          </div>\n          <div>\n            <h5 className=\"font-medium text-white mb-2\"> Reputao</h5>\n            <ul className=\"space-y-1\">\n              <li> Faa escolhas narrativas positivas</li>\n              <li> Ajude diferentes faces</li>\n              <li> Mantenha boa reputao geral</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Leaderboards;\n","export const GUILD_HUB_VERSION = '1.0.0';\nexport const GUILD_HUB_LAST_UPDATED = '2025-11-17';","import React from 'react'\nimport { tokens } from '../../styles/designTokens'\n\ntype TabItem = { id: string; label: string; icon?: React.ReactNode }\n\nexport default function Tabs({ items, activeId, onChange, size = 'md', className = '' }: { items: TabItem[]; activeId: string; onChange: (id: string) => void; size?: 'sm'|'md'; className?: string }) {\n  const pad = size === 'sm' ? 'px-3 py-1' : 'px-3 py-2'\n  return (\n    <div className={`flex gap-2 ${className} xs:flex-nowrap xs:overflow-x-auto xs:-mx-3 xs:px-3 md:flex-wrap`}>\n      {items.map(it => (\n        <button\n          key={it.id}\n          onClick={() => onChange(it.id)}\n          className={`${pad} rounded border text-sm ${activeId === it.id ? tokens.tabActive : tokens.tabInactive}`}\n        >\n          {it.icon ? <span className=\"mr-2\">{it.icon}</span> : null}\n          {it.label}\n        </button>\n      ))}\n    </div>\n  )\n}","import React, { useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { tokens } from '../styles/designTokens';\n\nconst NPCPresenceLayer: React.FC = () => {\n  const { heroes, getSelectedHero } = useHeroStore();\n  const player = getSelectedHero();\n  const npcs = useMemo(() => heroes.filter(h => h.origin === 'npc'), [heroes]);\n  const visibleCap = 6;\n  const rotationSeconds = 60;\n  const [visibleIds, setVisibleIds] = useState<string[]>([]);\n  React.useEffect(() => {\n    function sample(ids: string[], k: number) {\n      const arr = [...ids];\n      for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; }\n      return arr.slice(0, Math.max(0, Math.min(k, arr.length)));\n    }\n    const ids = npcs.map(n => n.id);\n    setVisibleIds(sample(ids, visibleCap));\n    const iv = setInterval(() => setVisibleIds(sample(npcs.map(n => n.id), visibleCap)), Math.max(10, rotationSeconds) * 1000);\n    return () => clearInterval(iv);\n  }, [npcs, visibleCap, rotationSeconds]);\n  if (npcs.length === 0) return null;\n  return (\n    <div className={`${tokens.cardBase} border border-gray-700`}>\n      <div className=\"flex items-center justify-between mb-2\">\n        <h3 className=\"text-lg font-semibold\">Atividades de Aventureiros NPC</h3>\n        <div className=\"text-xs text-gray-400\">Simulao ativa</div>\n      </div>\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n        {npcs.filter(n => visibleIds.includes(n.id)).map(n => {\n          const last = (n.npcMemory?.interactions || []).slice(-1)[0];\n          const rel = (n.socialRelations || {})[player?.id || ''] || 0;\n          const mood = n.npcMood;\n          const moodEmoji = mood === 'feliz' ? '' : mood === 'tranquilo' ? '' : mood === 'neutro' ? '' : mood === 'estressado' ? '' : mood === 'irritado' ? '' : mood === 'triste' ? '' : mood === 'cansado' ? '' : '';\n          return (\n            <div key={n.id} className=\"bg-gray-900 border border-gray-700 p-3 rounded\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"font-semibold flex items-center gap-2\">\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-green-500 animate-pulse\" />\n                  {n.name}\n                </div>\n                <div className=\"text-xs text-gray-400\">Rel {rel}  {moodEmoji}</div>\n              </div>\n              <div className=\"text-sm text-gray-300 mt-1\">{last ? `${new Date(last.ts).toLocaleTimeString()}  ${last.summary}` : 'Sem atividades recentes'}</div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default NPCPresenceLayer;","import React, { useEffect, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\n\nconst SimsDialogueModal: React.FC = () => {\n  const { npcInteractionOverlay, setNPCInteractionOverlay, respondToNPCInteraction } = useHeroStore() as any;\n  const open = !!npcInteractionOverlay;\n  const [idx, setIdx] = useState(0);\n  useEffect(() => { setIdx(0); }, [open]);\n  if (!open) return null;\n  const ov = npcInteractionOverlay;\n  const lines: string[] = ov.lines || [];\n  const line = lines[idx] || '';\n  const player = useHeroStore.getState().getSelectedHero();\n  const npc = useHeroStore.getState().heroes.find(h => h.id === ov.npcId);\n  const relVal = npc ? ((npc.socialRelations || {})[player?.id || ''] || 0) : 0;\n  const mood = relVal >= 40 ? 'friendly' : relVal <= -30 ? 'hostile' : 'neutral';\n  const face = mood === 'friendly' ? '' : mood === 'hostile' ? '' : '';\n  const gesture = mood === 'friendly' ? '' : mood === 'hostile' ? '' : '';\n  const anim = mood === 'friendly' ? 'translate-y-0' : mood === 'hostile' ? 'scale-110' : 'opacity-90';\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={() => setNPCInteractionOverlay(undefined)} />\n      <div className=\"relative bg-white rounded-lg border border-gray-300 p-4 w-full max-w-md\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h2 className=\"text-lg font-bold text-gray-800\"> Interao</h2>\n          <button onClick={() => setNPCInteractionOverlay(undefined)} className=\"text-gray-600\"></button>\n        </div>\n        <div className=\"p-3 bg-gray-50 rounded border text-gray-800\">\n          <div className={`text-2xl transition-all ${anim}`}>{face} {gesture}</div>\n          <div className=\"text-sm mt-1\">{ov.npcName}: {line}</div>\n        </div>\n        <div className=\"mt-3 flex items-center justify-between\">\n          <button onClick={() => setIdx(i => Math.max(0, i - 1))} className=\"px-3 py-1 rounded bg-gray-600 text-white\">Anterior</button>\n          <div className=\"text-xs text-gray-500\">{idx + 1}/{lines.length}</div>\n          <button onClick={() => setIdx(i => Math.min(lines.length - 1, i + 1))} className=\"px-3 py-1 rounded bg-indigo-600 text-white\">Prximo</button>\n        </div>\n        <div className=\"mt-3 grid grid-cols-3 gap-2\">\n          <button onClick={() => respondToNPCInteraction('accept')} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700\">Aceitar</button>\n          <button onClick={() => respondToNPCInteraction('decline')} className=\"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700\">Recusar</button>\n          <button onClick={() => respondToNPCInteraction('later')} className=\"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700\">Depois</button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SimsDialogueModal;","import { aiService } from './aiService';\nimport { AIRecommendationRequest } from '../types/ai';\nimport { Hero } from '../types/hero';\n\nexport interface Recommendation {\n  id: string;\n  type: 'training' | 'quest' | 'equipment' | 'social' | 'progression' | 'strategy';\n  priority: 'low' | 'medium' | 'high' | 'critical';\n  title: string;\n  description: string;\n  reasoning: string;\n  actionSteps: string[];\n  estimatedBenefit: string;\n  estimatedTime: string;\n  prerequisites?: string[];\n  relatedAchievements?: string[];\n}\n\nexport interface RecommendationContext {\n  recentActivities: string[];\n  currentGoals: string[];\n  weaknesses: string[];\n  strengths: string[];\n  availableTime: 'short' | 'medium' | 'long';\n  preferredActivities: string[];\n}\n\nexport class RecommendationAI {\n  private parseJsonResponse(text: string): any {\n    const stripFences = (input: string) => {\n      let t = input.trim();\n      // Remove incio de bloco ```json ou ```\n      t = t.replace(/^```\\s*json\\s*/i, '').replace(/^```\\s*/i, '');\n      // Remove fechamento de bloco ``` no fim\n      t = t.replace(/```\\s*$/i, '').trim();\n      return t;\n    };\n\n    // Escapa quebras de linha e caracteres de controle dentro de strings JSON\n    const escapeNewlinesInStrings = (input: string) => {\n      let result = '';\n      let inString = false;\n      let quote: string | null = null;\n      let escaped = false;\n      for (let i = 0; i < input.length; i++) {\n        const ch = input[i];\n        if (!inString) {\n          if ((ch === '\"' || ch === '\\'') && !escaped) {\n            inString = true;\n            quote = ch;\n          }\n          result += ch;\n          escaped = ch === '\\\\' ? !escaped : false;\n          continue;\n        }\n\n        // Dentro de string\n        if (!escaped && ch === quote) {\n          inString = false;\n          quote = null;\n          result += ch;\n          escaped = false;\n          continue;\n        }\n\n        if (!escaped && (ch === '\\n' || ch === '\\r')) {\n          result += ch === '\\n' ? '\\\\n' : '\\\\r';\n          escaped = false;\n          continue;\n        }\n\n        // Mantm sequncia de escape correta\n        result += ch;\n        if (escaped) {\n          escaped = false;\n        } else {\n          escaped = ch === '\\\\';\n        }\n      }\n      return result;\n    };\n\n    const cleaned = escapeNewlinesInStrings(stripFences(text));\n    try {\n      return JSON.parse(cleaned);\n    } catch {\n      // Fallback: tentar extrair o primeiro objeto JSON entre chaves\n      const start = cleaned.indexOf('{');\n      const end = cleaned.lastIndexOf('}');\n      if (start !== -1 && end !== -1 && end > start) {\n        const slice = escapeNewlinesInStrings(cleaned.slice(start, end + 1));\n        return JSON.parse(slice);\n      }\n      // ltimo fallback: remover possveis comentrios e linhas soltas\n      const noLines = escapeNewlinesInStrings(cleaned)\n        .split('\\n')\n        .filter(l => !l.trim().startsWith('//'))\n        .join('\\n');\n      return JSON.parse(noLines);\n    }\n  }\n  private getSystemPrompt(): string {\n    return `Voc  um conselheiro especialista em RPG medieval fantstico, focado em ajudar heris a otimizar sua progresso e experincia de jogo.\n\nSuas recomendaes devem ser:\n- Personalizadas para o heri especfico\n- Baseadas em dados e anlise inteligente\n- Prticas e acionveis\n- Balanceadas entre eficincia e diverso\n- Escritas em portugus brasileiro\n\nConsidere sempre:\n- O nvel atual e objetivos do heri\n- Pontos fortes e fracos\n- Atividades recentes e padres\n- Tempo disponvel para jogar\n- Progresso natural e sustentvel`;\n  }\n\n  private buildRecommendationPrompt(request: AIRecommendationRequest): string {\n    const { hero, context, maxRecommendations } = request;\n\n    let prompt = `Analise o perfil do heri e fornea ${maxRecommendations || 3} recomendaes personalizadas.\n\nPERFIL DO HERI:\n- Nome: ${hero.name}\n- Classe: ${hero.class}\n- Nvel: ${hero.progression.level}\n- Rank: ${hero.rank || 'F'}\n- Atributos: ${Object.entries(hero.attributes)\n      .map(([attr, value]) => `${attr}: ${value}`)\n      .join(', ')}`;\n\n    if (hero.achievements && hero.achievements.length > 0) {\n      prompt += `\\n- Conquistas: ${hero.achievements.slice(-5).map(a => a.title).join(', ')}`;\n    }\n\n    if (context) {\n      prompt += `\\n\\nCONTEXTO ADICIONAL:`;\n      if (context.recentActivities?.length) {\n        prompt += `\\n- Atividades recentes: ${context.recentActivities.join(', ')}`;\n      }\n      if (context.currentGoals?.length) {\n        prompt += `\\n- Objetivos atuais: ${context.currentGoals.join(', ')}`;\n      }\n      if (context.weaknesses?.length) {\n        prompt += `\\n- Pontos fracos: ${context.weaknesses.join(', ')}`;\n      }\n      if (context.strengths?.length) {\n        prompt += `\\n- Pontos fortes: ${context.strengths.join(', ')}`;\n      }\n      if (context.availableTime) {\n        prompt += `\\n- Tempo disponvel: ${context.availableTime}`;\n      }\n      if (context.preferredActivities?.length) {\n        prompt += `\\n- Atividades preferidas: ${context.preferredActivities.join(', ')}`;\n      }\n    }\n\n    prompt += `\\n\\nFORNEA RECOMENDAES EM JSON:\n{\n  \"recommendations\": [\n    {\n      \"type\": \"training|quest|equipment|social|progression|strategy\",\n      \"priority\": \"low|medium|high|critical\",\n      \"title\": \"Ttulo da Recomendao\",\n      \"description\": \"Descrio clara (50-80 palavras)\",\n      \"reasoning\": \"Por que esta recomendao  importante (30-50 palavras)\",\n      \"actionSteps\": [\"Passo 1\", \"Passo 2\", \"Passo 3\"],\n      \"estimatedBenefit\": \"Benefcio esperado\",\n      \"estimatedTime\": \"Tempo necessrio\",\n      \"prerequisites\": [\"Pr-requisito 1\", \"Pr-requisito 2\"],\n      \"relatedAchievements\": [\"Conquista relacionada\"]\n    }\n  ]\n}\n\nTIPOS DE RECOMENDAO:\n- training: Treino de atributos ou habilidades\n- quest: Misses especficas para progresso\n- equipment: Melhorias de equipamentos\n- social: Interaes sociais e guildas\n- progression: Estratgias de progresso geral\n- strategy: Tticas e estratgias de combate`;\n\n    return prompt;\n  }\n\n  async generateRecommendations(request: AIRecommendationRequest): Promise<Recommendation[]> {\n    try {\n      // Se o servio de IA no estiver configurado, use fallback diretamente\n      if (!aiService.isConfigured()) {\n        return this.generateFallbackRecommendations(request);\n      }\n      const response = await aiService.generateTextSafe({\n        prompt: this.buildRecommendationPrompt(request),\n        systemMessage: this.getSystemPrompt(),\n        maxTokens: 1000,\n        temperature: 0.7\n      });\n\n      const data = this.parseJsonResponse(response.text);\n      \n      return data.recommendations.map((rec: any) => ({\n        id: this.generateRecommendationId(),\n        type: rec.type,\n        priority: rec.priority,\n        title: rec.title,\n        description: rec.description,\n        reasoning: rec.reasoning,\n        actionSteps: rec.actionSteps || [],\n        estimatedBenefit: rec.estimatedBenefit,\n        estimatedTime: rec.estimatedTime,\n        prerequisites: rec.prerequisites,\n        relatedAchievements: rec.relatedAchievements\n      }));\n    } catch (error) {\n      console.warn('Error generating recommendations, using fallback:', error);\n      return this.generateFallbackRecommendations(request);\n    }\n  }\n\n  async analyzeHeroWeaknesses(hero: Hero): Promise<string[]> {\n    try {\n      if (!aiService.isConfigured()) {\n        return this.getFallbackWeaknesses(hero);\n      }\n      const prompt = `Analise os atributos do heri ${hero.name} e identifique pontos fracos:\n\nAtributos:\n${Object.entries(hero.attributes)\n  .map(([attr, value]) => `- ${attr}: ${value}`)\n  .join('\\n')}\n\nClasse: ${hero.class}\nNvel: ${hero.progression.level}\n\nIdentifique 2-3 pontos fracos principais baseados nos atributos mais baixos e na classe do heri.\nResponda apenas com uma lista simples, uma fraqueza por linha.`;\n\n      const response = await aiService.generateTextSafe({\n        prompt,\n        systemMessage: 'Voc  um analista especializado em balanceamento de personagens de RPG.',\n        maxTokens: 150,\n        temperature: 0.5\n      });\n\n      return response.text.split('\\n')\n        .map(line => line.trim())\n        .filter(line => line.length > 0)\n        .slice(0, 3);\n    } catch (error) {\n      console.error('Error analyzing weaknesses:', error);\n      return this.getFallbackWeaknesses(hero);\n    }\n  }\n\n  async suggestOptimalBuild(hero: Hero): Promise<{\n    attributePriorities: string[];\n    skillRecommendations: string[];\n    equipmentSuggestions: string[];\n    playstyleAdvice: string;\n  }> {\n    try {\n      if (!aiService.isConfigured()) {\n        return this.getFallbackBuild(hero);\n      }\n      const prompt = `Sugira um build otimizado para ${hero.name} (${hero.class}, nvel ${hero.progression.level}):\n\nAtributos atuais:\n${Object.entries(hero.attributes)\n  .map(([attr, value]) => `- ${attr}: ${value}`)\n  .join('\\n')}\n\nFornea em JSON:\n{\n  \"attributePriorities\": [\"Atributo mais importante\", \"Segundo mais importante\", \"Terceiro\"],\n  \"skillRecommendations\": [\"Habilidade 1\", \"Habilidade 2\", \"Habilidade 3\"],\n  \"equipmentSuggestions\": [\"Equipamento 1\", \"Equipamento 2\", \"Equipamento 3\"],\n  \"playstyleAdvice\": \"Conselho sobre estilo de jogo (100-150 palavras)\"\n}`;\n\n      const response = await aiService.generateTextSafe({\n        prompt,\n        systemMessage: 'Voc  um especialista em builds otimizados para RPG medieval.',\n        maxTokens: 400,\n        temperature: 0.6\n      });\n\n      return this.parseJsonResponse(response.text);\n    } catch (error) {\n      console.warn('Error suggesting optimal build, using fallback:', error);\n      return this.getFallbackBuild(hero);\n    }\n  }\n\n  async generateDailyGoals(hero: Hero, context?: RecommendationContext): Promise<string[]> {\n    try {\n      if (!aiService.isConfigured()) {\n        return this.getFallbackDailyGoals(hero);\n      }\n      const prompt = `Gere 3-5 objetivos dirios personalizados para ${hero.name}:\n\nHeri: ${hero.name} (${hero.class}, nvel ${hero.progression.level}, rank ${hero.rank || 'F'})\n\n${context ? `\nContexto:\n- Tempo disponvel: ${context.availableTime}\n- Atividades preferidas: ${context.preferredActivities?.join(', ') || 'No especificado'}\n- Objetivos atuais: ${context.currentGoals?.join(', ') || 'No especificado'}\n` : ''}\n\nOs objetivos devem ser:\n- Especficos e mensurveis\n- Apropriados para o nvel do heri\n- Variados e interessantes\n- Realizveis no tempo disponvel\n\nResponda apenas com uma lista simples, um objetivo por linha.`;\n\n      const response = await aiService.generateTextSafe({\n        prompt,\n        systemMessage: 'Voc cria objetivos dirios motivadores para jogadores de RPG.',\n        maxTokens: 200,\n        temperature: 0.8\n      });\n\n      return response.text.split('\\n')\n        .map(line => line.trim())\n        .filter(line => line.length > 0)\n        .slice(0, 5);\n    } catch (error) {\n      console.warn('Error generating daily goals, using fallback:', error);\n      return this.getFallbackDailyGoals(hero);\n    }\n  }\n\n  private generateRecommendationId(): string {\n    return `rec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private generateFallbackRecommendations(request: AIRecommendationRequest): Recommendation[] {\n    const { hero } = request;\n    const recommendations: Recommendation[] = [];\n\n    // Training recommendation\n    const weakestAttribute = Object.entries(hero.attributes)\n      .sort(([,a], [,b]) => a - b)[0];\n\n    recommendations.push({\n      id: this.generateRecommendationId(),\n      type: 'training',\n      priority: 'medium',\n      title: `Treinar ${weakestAttribute[0]}`,\n      description: `Seu atributo ${weakestAttribute[0]} est abaixo da mdia. Focar no treinamento deste atributo melhorar significativamente sua performance geral.`,\n      reasoning: `${weakestAttribute[0]}  seu atributo mais fraco e limitante.`,\n      actionSteps: [\n        'Encontre um instrutor especializado',\n        'Complete exerccios de treinamento',\n        'Pratique regularmente'\n      ],\n      estimatedBenefit: 'Melhoria significativa na performance',\n      estimatedTime: '1-2 horas de jogo'\n    });\n\n    // Quest recommendation\n    recommendations.push({\n      id: this.generateRecommendationId(),\n      type: 'quest',\n      priority: 'high',\n      title: 'Misso de Progresso',\n      description: `Como ${hero.class} de nvel ${hero.progression.level}, voc deveria focar em misses que desafiem suas habilidades atuais e ofeream boa experincia.`,\n      reasoning: 'Progresso constante  essencial para o desenvolvimento.',\n      actionSteps: [\n        'Procure misses apropriadas para seu nvel',\n        'Prepare equipamentos adequados',\n        'Execute a misso com cuidado'\n      ],\n      estimatedBenefit: 'Experincia e recompensas valiosas',\n      estimatedTime: '30-45 minutos'\n    });\n\n    return recommendations;\n  }\n\n  private getFallbackWeaknesses(hero: Hero): string[] {\n    const sortedAttributes = Object.entries(hero.attributes)\n      .sort(([,a], [,b]) => a - b);\n\n    return sortedAttributes.slice(0, 2).map(([attr]) => \n      `${attr} baixo para a classe ${hero.class}`\n    );\n  }\n\n  private getFallbackBuild(hero: Hero): {\n    attributePriorities: string[];\n    skillRecommendations: string[];\n    equipmentSuggestions: string[];\n    playstyleAdvice: string;\n  } {\n    const classPriorities = {\n      Warrior: ['strength', 'constitution', 'agility'],\n      Mage: ['intelligence', 'wisdom', 'constitution'],\n      Rogue: ['agility', 'intelligence', 'strength'],\n      Paladin: ['strength', 'charisma', 'constitution'],\n      Ranger: ['agility', 'wisdom', 'strength'],\n      Cleric: ['wisdom', 'charisma', 'constitution']\n    };\n\n    return {\n      attributePriorities: classPriorities[hero.class as keyof typeof classPriorities] || \n                          ['strength', 'constitution', 'agility'],\n      skillRecommendations: ['Habilidade de classe principal', 'Habilidade de sobrevivncia', 'Habilidade social'],\n      equipmentSuggestions: ['Arma principal melhorada', 'Armadura defensiva', 'Acessrio de atributo'],\n      playstyleAdvice: `Como ${hero.class}, foque em suas habilidades naturais enquanto desenvolve reas complementares para um personagem bem equilibrado.`\n    };\n  }\n\n  private getFallbackDailyGoals(hero: Hero): string[] {\n\n\n    return [\n      `Completar 2 misses apropriadas para nvel ${hero.progression.level}`,\n      `Treinar atributo mais fraco por 30 minutos`,\n      `Interagir com 3 NPCs diferentes`,\n      `Coletar recursos para crafting`,\n      `Participar de uma atividade social`\n    ];\n  }\n}\n\nexport const recommendationAI = new RecommendationAI();\n","// Componente Visual de Rank - HeroForge v2.2\n\nimport React, { useState, useEffect } from 'react';\nimport { RankLevel, RankProgress, RANK_CONFIG } from '../types/ranks';\nimport { medievalTheme, getRankGradient, getRankIcon, seasonalThemes } from '../styles/medievalTheme';\nimport { useMonetizationStore } from '../store/monetizationStore';\n\ninterface RankCardProps {\n  rank: RankLevel;\n  progress?: RankProgress;\n  size?: 'small' | 'medium' | 'large';\n  showProgress?: boolean;\n  animated?: boolean;\n  onClick?: () => void;\n}\n\nexport const RankCard: React.FC<RankCardProps> = ({\n  rank,\n  progress,\n  size = 'medium',\n  showProgress = false,\n  animated = true,\n  onClick\n}) => {\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const [isGlowing, setIsGlowing] = useState(false);\n  const safeRank = (rank || (progress?.currentRank as any) || 'F') as RankLevel;\n  const rankInfo = RANK_CONFIG[safeRank] || { name: String(safeRank), color: '#9CA3AF' } as any;\n\n  useEffect(() => {\n    if (animated && progress?.canPromote) {\n      const interval = setInterval(() => {\n        setIsGlowing(prev => !prev);\n      }, 1000);\n      return () => clearInterval(interval);\n    }\n  }, [animated, progress?.canPromote]);\n\n  const getSizeClasses = () => {\n    switch (size) {\n      case 'small':\n        return 'w-16 h-16 text-xs';\n      case 'large':\n        return 'w-32 h-32 text-xl';\n      default:\n        return 'w-24 h-24 text-base';\n    }\n  };\n\n  const getRankStyles = () => {\n    const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || medievalTheme.effects.borders.gold : medievalTheme.effects.borders.gold;\n    const baseStyles = `\n      inline-flex items-center justify-center\n      border-2 rounded-lg font-bold transition-all duration-300\n      ${size === 'small' ? 'w-12 h-12 text-sm' : \n        size === 'medium' ? 'w-16 h-16 text-base' : \n        'w-20 h-20 text-lg'}\n      ${animated ? 'hover:scale-110 cursor-pointer' : ''}\n      bg-gradient-to-br ${getRankGradient(safeRank)} ${seasonalBorder} text-white ${medievalTheme.effects.shadows.glow}\n    `;\n    \n    return baseStyles;\n  };\n\n  const getGlowEffect = () => {\n    if (!isGlowing || !progress?.canPromote) return '';\n    return `${medievalTheme.effects.shadows.large} scale-110`;\n  };\n\n  return (\n    <div className=\"flex flex-col items-center space-y-2\">\n      {/* Rank Badge */}\n      <div\n        className={`\n          ${getSizeClasses()}\n          ${getRankStyles()}\n          ${getGlowEffect()}\n          ${animated ? 'hover:scale-110' : ''}\n          relative overflow-hidden focus:outline-none focus:ring-2 focus:ring-indigo-500\n        `}\n        tabIndex={onClick ? 0 : -1}\n        role={onClick ? 'button' : undefined}\n        onClick={onClick}\n      >\n        {/* Rank Letter */}\n        <span className=\"font-bold z-10\">{safeRank}</span>\n        \n        {/* Rank Icon */}\n        <span className=\"absolute top-1 right-1 text-xs opacity-80\">\n          {getRankIcon(safeRank)}\n        </span>\n        \n        {/* Legendary Sparkle Effect for S Rank */}\n        {safeRank === 'S' && animated && (\n          <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse\"></div>\n        )}\n        \n        {/* Promotion Ready Indicator */}\n        {progress?.canPromote && (\n          <div className=\"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-ping\"></div>\n        )}\n      </div>\n\n      {/* Rank Name */}\n      <div className=\"text-center\">\n        <div className=\"font-semibold text-sm\" style={{ color: rankInfo?.color || '#9CA3AF' }}>\n          {rankInfo?.name || String(rank)}\n        </div>\n        \n        {/* Progress Bar */}\n        {showProgress && progress && progress.nextRank && (\n          <div className=\"mt-2 w-24\">\n            <div className=\"flex justify-between text-xs text-gray-400 mb-1\">\n              <span>{safeRank}</span>\n              <span>{progress.nextRank}</span>\n            </div>\n            <div className=\"w-full bg-gray-700 rounded-full h-2\">\n              <div\n                className=\"h-2 rounded-full transition-all duration-500\"\n                style={{\n                  width: `${progress.progressPercentage}%`,\n                  backgroundColor: rankInfo?.color || '#9CA3AF'\n                }}\n              ></div>\n            </div>\n            <div className=\"text-xs text-gray-400 mt-1 text-center\">\n              {Math.round(progress.progressPercentage)}%\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\n// Componente para exibir mltiplos ranks (histrico)\ninterface RankHistoryProps {\n  ranks: RankLevel[];\n  currentRank: RankLevel;\n  size?: 'small' | 'medium';\n}\n\nexport const RankHistory: React.FC<RankHistoryProps> = ({\n  ranks,\n  currentRank,\n  size = 'small'\n}) => {\n  return (\n    <div className=\"flex items-center space-x-2 overflow-x-auto pb-2\">\n      {ranks.map((rank, index) => (\n        <div\n          key={index}\n          className=\"flex-shrink-0 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded\"\n          tabIndex={0}\n          aria-label={`Rank ${rank}`}\n        >\n          <RankCard\n            rank={rank}\n            size={size}\n            animated={rank === currentRank}\n            showProgress={false}\n          />\n          {index < ranks.length - 1 && (\n            <div className=\"mx-2 text-gray-400\"></div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\n// Componente de comparao de ranks\ninterface RankComparisonProps {\n  heroRank: RankLevel;\n  compareRank: RankLevel;\n  heroName: string;\n  compareName: string;\n}\n\nexport const RankComparison: React.FC<RankComparisonProps> = ({\n  heroRank,\n  compareRank,\n  heroName,\n  compareName\n}) => {\n  return (\n    <div className={`flex items-center justify-between p-4 ${medievalTheme.layout.containers.card} ${medievalTheme.effects.borders.gold}`}>\n      <div className=\"flex items-center space-x-3\">\n        <RankCard rank={heroRank} size=\"small\" animated={false} />\n        <div>\n          <div className=\"font-semibold text-white\">{heroName}</div>\n          <div className=\"text-sm text-amber-600\">{(RANK_CONFIG[heroRank]?.name) || String(heroRank)}</div>\n        </div>\n      </div>\n\n      <div className=\"text-amber-400 text-xl font-bold\"></div>\n\n      <div className=\"flex items-center space-x-3\">\n        <div className=\"text-right\">\n          <div className=\"font-semibold text-white\">{compareName}</div>\n          <div className=\"text-sm text-amber-600\">{(RANK_CONFIG[compareRank]?.name) || String(compareRank)}</div>\n        </div>\n        <RankCard rank={compareRank} size=\"small\" animated={false} />\n      </div>\n    </div>\n  );\n};\n\nexport default RankCard;\n","// Componente de Progresso de Rank - HeroForge v2.2\n\nimport React from 'react';\nimport { RankProgress as RankProgressType, RANK_CONFIG, RANK_THRESHOLDS } from '../types/ranks';\nimport { Hero } from '../types/hero';\nimport { rankSystem } from '../utils/rankSystem';\nimport RankCard from './RankCard';\n\ninterface RankProgressProps {\n  hero: Hero;\n  progress: RankProgressType;\n  showEstimate?: boolean;\n  compact?: boolean;\n}\n\nexport const RankProgress: React.FC<RankProgressProps> = ({\n  hero,\n  progress,\n  showEstimate = true,\n  compact = false\n}) => {\n  const currentRankInfo = RANK_CONFIG[progress.currentRank] || { name: String(progress.currentRank || ''), description: '' } as any;\n  const nextRankInfo = progress.nextRank ? (RANK_CONFIG[progress.nextRank] || { name: String(progress.nextRank || ''), description: '' } as any) : null;\n  const estimate = showEstimate ? rankSystem.estimateTimeToNextRank(hero) : null;\n\n  const getProgressColor = (percentage: number) => {\n    if (percentage >= 90) return 'bg-green-500';\n    if (percentage >= 70) return 'bg-yellow-500';\n    if (percentage >= 50) return 'bg-blue-500';\n    return 'bg-gray-500';\n  };\n\n  if (compact) {\n    return (\n      <div className=\"bg-gray-800 rounded-lg p-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <RankCard rank={progress.currentRank} size=\"small\" />\n          {progress.nextRank && (\n            <>\n              <div className=\"flex-1 mx-4\">\n                <div className=\"w-full bg-gray-700 rounded-full h-2\">\n                  <div\n                    className={`h-2 rounded-full transition-all duration-500 ${getProgressColor(progress.progressPercentage)}`}\n                    style={{ width: `${progress.progressPercentage}%` }}\n                  ></div>\n                </div>\n                <div className=\"text-xs text-gray-400 mt-1 text-center\">\n                  {Math.round(progress.progressPercentage)}%\n                </div>\n              </div>\n              <RankCard rank={progress.nextRank} size=\"small\" />\n            </>\n          )}\n        </div>\n        \n        {progress.nextRank && (\n          <div className=\"text-sm text-gray-400 text-center\">\n            {progress.canPromote ? ' Pronto para promoo!' : `Prximo: ${nextRankInfo?.name}`}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-gray-800 rounded-lg p-6 space-y-6\">\n      {/* Header com Ranks */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"text-center\">\n          <RankCard rank={progress.currentRank} size=\"medium\" />\n          <div className=\"mt-2\">\n            <div className=\"font-semibold text-lg\">{currentRankInfo?.name || 'Rank'}</div>\n            <div className=\"text-sm text-gray-400\">{currentRankInfo?.description || ''}</div>\n          </div>\n        </div>\n\n        {progress.nextRank && (\n          <>\n            <div className=\"flex-1 mx-8\">\n              <div className=\"text-center mb-2\">\n                <span className=\"text-2xl\"></span>\n              </div>\n              <div className=\"w-full bg-gray-700 rounded-full h-4 relative\">\n                <div\n                  className={`h-4 rounded-full transition-all duration-500 ${getProgressColor(progress.progressPercentage)}`}\n                  style={{ width: `${progress.progressPercentage}%` }}\n                ></div>\n                <div className=\"absolute inset-0 flex items-center justify-center text-xs font-semibold text-white\">\n                  {Math.round(progress.progressPercentage)}%\n                </div>\n              </div>\n              {estimate && (\n                <div className=\"text-xs text-gray-400 mt-2 text-center\">\n                  {estimate.description}\n                </div>\n              )}\n            </div>\n\n            <div className=\"text-center\">\n              <RankCard \n                rank={progress.nextRank} \n                size=\"medium\" \n                animated={progress.canPromote}\n              />\n              <div className=\"mt-2\">\n                <div className=\"font-semibold text-lg\">{nextRankInfo?.name || 'Prximo Rank'}</div>\n                <div className=\"text-sm text-gray-400\">{nextRankInfo?.description || ''}</div>\n              </div>\n            </div>\n          </>\n        )}\n\n        {!progress.nextRank && (\n          <div className=\"text-center\">\n            <div className=\"text-6xl mb-2\"></div>\n            <div className=\"font-semibold text-xl text-yellow-400\">Rank Mximo!</div>\n            <div className=\"text-sm text-gray-400\">Lenda Viva Alcanada</div>\n          </div>\n        )}\n      </div>\n\n      <div className=\"border-t border-gray-700 pt-4\">\n        {(() => {\n          const thresholds = progress.nextRank ? RANK_THRESHOLDS[progress.nextRank] : undefined;\n          const hasNext = !!progress.nextRank && !!thresholds;\n          if (!hasNext) {\n            return (\n              <div className=\"text-center text-sm text-gray-400\">Sem prximo rank  requisitos concludos.</div>\n            );\n          }\n          const missingXP = Math.max(0, (progress.requiredXP || 0) - (progress.currentXP || 0));\n          const missingMissions = Math.max(0, (progress.requiredMissions || 0) - (progress.currentMissions || 0));\n          const missingTitles = thresholds && typeof thresholds.titles === 'number' ? Math.max(0, thresholds.titles - (hero.titles?.length || 0)) : 0;\n          const specials = Array.isArray(thresholds?.specialRequirements) ? thresholds!.specialRequirements! : [];\n          return (\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3 text-center\">\n              <div className=\"text-sm text-gray-300\">\n                <div className=\"font-semibold\"> XP</div>\n                <div className={missingXP > 0 ? 'text-red-400' : 'text-green-400'}>{missingXP > 0 ? `${missingXP.toLocaleString()} restante` : ''}</div>\n              </div>\n              <div className=\"text-sm text-gray-300\">\n                <div className=\"font-semibold\"> Misses</div>\n                <div className={missingMissions > 0 ? 'text-red-400' : 'text-green-400'}>{missingMissions > 0 ? `${missingMissions} restantes` : ''}</div>\n              </div>\n              <div className=\"text-sm text-gray-300\">\n                <div className=\"font-semibold\"> Ttulos</div>\n                <div className={missingTitles > 0 ? 'text-red-400' : 'text-green-400'}>{missingTitles > 0 ? `${missingTitles} restantes` : ''}</div>\n              </div>\n              <div className=\"text-sm text-gray-300\">\n                <div className=\"font-semibold\"> Especiais</div>\n                {specials.length > 0 ? (\n                  <div className=\"text-red-400\">{specials.map((s) => (s === 'legendary_quest' ? 'Misso lendria' : s === 'epic_achievement' ? 'Feito pico' : String(s))).join('  ')}</div>\n                ) : (\n                  <div className=\"text-green-400\"></div>\n                )}\n              </div>\n            </div>\n          );\n        })()}\n      </div>\n\n      {/* Requisitos Detalhados */}\n      {progress.nextRank && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {/* XP Progress */}\n          <div className=\"bg-gray-700 rounded-lg p-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"font-semibold\"> Experincia</span>\n              <span className=\"text-sm text-gray-400\">\n                {progress.currentXP.toLocaleString()} / {progress.requiredXP.toLocaleString()}\n              </span>\n            </div>\n            <div className=\"w-full bg-gray-600 rounded-full h-3\">\n              <div\n                className=\"h-3 rounded-full bg-blue-500 transition-all duration-500\"\n                style={{ \n                  width: `${Math.min(100, (progress.currentXP / progress.requiredXP) * 100)}%` \n                }}\n              ></div>\n            </div>\n            <div className=\"text-xs text-gray-400 mt-1\">\n              {progress.requiredXP - progress.currentXP > 0 \n                ? `${(progress.requiredXP - progress.currentXP).toLocaleString()} XP restante`\n                : 'Requisito cumprido '\n              }\n            </div>\n          </div>\n\n          {/* Missions Progress */}\n          <div className=\"bg-gray-700 rounded-lg p-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"font-semibold\"> Misses</span>\n              <span className=\"text-sm text-gray-400\">\n                {progress.currentMissions} / {progress.requiredMissions}\n              </span>\n            </div>\n            <div className=\"w-full bg-gray-600 rounded-full h-3\">\n              <div\n                className=\"h-3 rounded-full bg-green-500 transition-all duration-500\"\n                style={{ \n                  width: `${Math.min(100, (progress.currentMissions / progress.requiredMissions) * 100)}%` \n                }}\n              ></div>\n            </div>\n            <div className=\"text-xs text-gray-400 mt-1\">\n              {progress.requiredMissions - progress.currentMissions > 0 \n                ? `${progress.requiredMissions - progress.currentMissions} misses restantes`\n                : 'Requisito cumprido '\n              }\n            </div>\n          </div>\n\n          {/* Additional Requirements */}\n          {(() => {\n            const thresholds = progress.nextRank ? RANK_THRESHOLDS[progress.nextRank] : undefined;\n            if (!thresholds || typeof thresholds.titles !== 'number') return null;\n            return (\n            <div className=\"bg-gray-700 rounded-lg p-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"font-semibold\"> Ttulos</span>\n                <span className=\"text-sm text-gray-400\">\n                  {hero.titles?.length || 0} / {thresholds.titles}\n                </span>\n              </div>\n              <div className=\"w-full bg-gray-600 rounded-full h-3\">\n                <div\n                  className=\"h-3 rounded-full bg-purple-500 transition-all duration-500\"\n                  style={{ \n                    width: `${Math.min(100, ((hero.titles?.length || 0) / (thresholds.titles || 1)) * 100)}%` \n                  }}\n                ></div>\n              </div>\n              <div className=\"text-xs text-gray-400 mt-1\">\n                {(thresholds.titles || 0) - (hero.titles?.length || 0) > 0 \n                  ? `${(thresholds.titles || 0) - (hero.titles?.length || 0)} ttulos restantes`\n                  : 'Requisito cumprido '\n                }\n              </div>\n            </div>\n            );\n          })()}\n\n          {/* Special Requirements */}\n          {(() => {\n            const thresholds = progress.nextRank ? RANK_THRESHOLDS[progress.nextRank] : undefined;\n            const reqs = thresholds?.specialRequirements;\n            if (!Array.isArray(reqs) || reqs.length === 0) return null;\n            return (\n            <div className=\"bg-gray-700 rounded-lg p-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"font-semibold\"> Requisitos Especiais</span>\n              </div>\n              <div className=\"space-y-1\">\n                {reqs.map((req, index) => (\n                  <div key={index} className=\"text-sm text-gray-400\">\n                    {req === 'legendary_quest' && ' Completar misso lendria'}\n                    {req === 'epic_achievement' && ' Conquistar feito pico'}\n                  </div>\n                ))}\n              </div>\n            </div>\n            );\n          })()}\n        </div>\n      )}\n\n      {/* Promotion Button */}\n      {progress.canPromote && (\n        <div className=\"text-center\">\n          <button className=\"bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-yellow-900 font-bold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\">\n             Promover para {nextRankInfo?.name}!\n          </button>\n        </div>\n      )}\n\n      {/* Current Stats Summary */}\n      <div className=\"border-t border-gray-700 pt-4\">\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-center\">\n          <div>\n            <div className=\"text-2xl font-bold text-blue-400\">{hero.progression.level}</div>\n            <div className=\"text-sm text-gray-400\">Nvel</div>\n          </div>\n          <div>\n            <div className=\"text-2xl font-bold text-green-400\">{hero.progression.xp.toLocaleString()}</div>\n            <div className=\"text-sm text-gray-400\">XP Total</div>\n          </div>\n          <div>\n            <div className=\"text-2xl font-bold text-purple-400\">{hero.stats.questsCompleted || 0}</div>\n            <div className=\"text-sm text-gray-400\">Misses</div>\n          </div>\n          <div>\n            <div className=\"text-2xl font-bold text-yellow-400\">{hero.titles?.length || 0}</div>\n            <div className=\"text-sm text-gray-400\">Ttulos</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default RankProgress;\n","import React, { useEffect, useState } from 'react'\nimport { useHeroStore } from '../store/heroStore'\nimport { tokens } from '../styles/designTokens'\nimport { recommendationAI } from '../services/recommendationAI'\nimport RankProgress from './RankProgress'\n\ntype BuildAdvice = {\n  attributePriorities: string[]\n  skillRecommendations: string[]\n  equipmentSuggestions: string[]\n  playstyleAdvice: string\n}\n\nexport default function GuildAdvicePanel() {\n  const { getSelectedHero, getHeroRankProgress } = useHeroStore() as any\n  const hero = getSelectedHero()\n  const [weaknesses, setWeaknesses] = useState<string[]>([])\n  const [build, setBuild] = useState<BuildAdvice | null>(null)\n  const rankProgress = hero ? getHeroRankProgress(hero.id) : null\n\n  useEffect(() => {\n    let cancelled = false\n    if (!hero) return\n    ;(async () => {\n      try {\n        const [w, b] = await Promise.all([\n          recommendationAI.analyzeHeroWeaknesses(hero),\n          recommendationAI.suggestOptimalBuild(hero)\n        ])\n        if (cancelled) return\n        setWeaknesses(w || [])\n        setBuild(b || null)\n      } catch {\n        if (!cancelled) {\n          setWeaknesses([])\n          setBuild(null)\n        }\n      }\n    })()\n    return () => { cancelled = true }\n  }, [hero?.id, hero?.progression?.level])\n\n  if (!hero) {\n    return (\n      <div className={`${tokens.cardBase} border border-gray-700`}>\n        <div className=\"text-center py-8 text-gray-400\">\n          <div className=\"text-5xl mb-2\"></div>\n          <p>Selecione um heri para receber conselhos personalizados.</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className={`${tokens.cardBase} border border-gray-700`}>\n      <h2 className=\"text-2xl font-bold mb-4\"> Conselhos do Mestre da Guilda</h2>\n      <div className=\"space-y-6\">\n        <div>\n          <h3 className=\"text-lg font-semibold mb-2\">Progresso de Rank</h3>\n          {hero && rankProgress ? (\n            <RankProgress hero={hero} progress={rankProgress.progress} showEstimate compact={false} />\n          ) : (\n            <div className=\"text-sm text-gray-400\">Selecione um heri para ver o progresso de rank.</div>\n          )}\n        </div>\n\n        <div>\n          <h3 className=\"text-lg font-semibold mb-2\">Sugesto de Build</h3>\n          {build ? (\n            <div className=\"space-y-2\">\n              <div className=\"text-sm text-gray-300\"><span className=\"font-semibold\">Prioridades:</span> {build.attributePriorities.join(', ')}</div>\n              <div className=\"text-sm text-gray-300\"><span className=\"font-semibold\">Habilidades:</span> {build.skillRecommendations.join(', ')}</div>\n              <div className=\"text-sm text-gray-300\"><span className=\"font-semibold\">Equipamentos:</span> {build.equipmentSuggestions.join(', ')}</div>\n              <div className=\"text-sm text-gray-300\"><span className=\"font-semibold\">Estilo de jogo:</span> {build.playstyleAdvice}</div>\n            </div>\n          ) : (\n            <div className=\"text-sm text-gray-400\">Construindo recomendaes</div>\n          )}\n        </div>\n\n        <div>\n          <h3 className=\"text-lg font-semibold mb-2\">Pontos Fracos</h3>\n          {weaknesses.length ? (\n            <ul className=\"space-y-2\">\n              {weaknesses.map((w, i) => (\n                <li key={`weak-${i}`} className=\"p-2 rounded border bg-gray-900 border-gray-700\">{w}</li>\n              ))}\n            </ul>\n          ) : (\n            <div className=\"text-sm text-gray-400\">Analisando atributos</div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}","import React, { useEffect, useMemo, useState, Suspense } from 'react';\nimport { useHeroStore } from '../../store/heroStore';\nimport { generateAllLeaderboards } from '../../utils/leaderboardSystem';\nimport { SHOP_ITEMS } from '../../utils/shop';\nimport { notificationBus } from '../../components/NotificationSystem';\nimport { getDungeonLeaderboard, getWeeklyDungeonHighlights } from '../../services/dungeonService';\nimport { activityManager } from '../../utils/activitySystem';\nimport { EnhancedQuestBoard } from '../../components/EnhancedQuestBoard';\nimport Training from '../../components/Training';\nimport Leaderboards from '../../components/Leaderboards';\nimport { EvolutionPanel } from '../../components/EvolutionPanel';\nimport ReputationPanel from '../../components/ReputationPanel';\nimport RankProgressComponent from '../../components/RankProgress';\nimport { useMonetizationStore } from '../../store/monetizationStore';\nimport { seasonalThemes } from '../../styles/medievalTheme';\nimport { useGameSettingsStore } from '../../store/gameSettingsStore';\nimport { GUILD_HUB_VERSION } from './version';\nimport { tokens } from '../../styles/designTokens';\nimport Tabs from '../../components/ui/Tabs';\nimport NPCPresenceLayer from '../../components/NPCPresenceLayer';\nimport DuelModal from '../../components/DuelModal';\nimport SimsDialogueModal from '../../components/SimsDialogueModal';\nimport TavernInteractions from '../../components/TavernInteractions';\nimport GuildAdvicePanel from '../../components/GuildAdvicePanel';\n\nconst EggIdentificationNPC = React.lazy(() => import('../../components/EggIdentificationNPC'));\n// Party HUD removido\n// DuelInvitesPanel removido\nconst RelationshipsPanel = React.lazy(() => import('../../components/RelationshipsPanel'));\n\nconst GuildHub: React.FC = () => {\n  const { guilds, ensureDefaultGuildExists, refreshQuests, availableQuests, heroes, getSelectedHero, sellItem, getHeroRankProgress, activateGuildEvent, clearGuildEvent, approvePartyAlliance, rejectPartyAlliance, ensureNPCAdventurersSeedExists, startNPCSimulation, stopNPCSimulation } = useHeroStore();\n  const npcSeedTarget = useGameSettingsStore(s => s.npcSeedTarget || 30);\n  const selectedHero = getSelectedHero();\n  const rankProgress = selectedHero ? getHeroRankProgress(selectedHero.id) : null;\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-gray-200' : 'border-gray-200';\n  const [qtyByItem, setQtyByItem] = useState<Record<string, number>>({});\n  const [selectedType, setSelectedType] = useState<'todos' | 'consumable' | 'weapon' | 'armor' | 'accessory' | 'material'>('todos');\n  const [selectedRarity, setSelectedRarity] = useState<'todas' | 'comum' | 'raro' | 'epico' | 'lendario'>('todas');\n  const [activeCategory, setActiveCategory] = useState<'missoes' | 'social' | 'gestao'>('missoes');\n  const [activeSection, setActiveSection] = useState<'salao' | 'treinamento' | 'sala-herois' | 'zoologo' | 'relacoes' | 'conselhos'>('salao');\n  const categories = [\n    { id: 'missoes', label: 'Misses', sections: [\n      { id: 'salao', label: 'Salo Principal', icon: '' },\n      { id: 'sala-herois', label: 'Salo dos Heris', icon: '' }\n    ]},\n    { id: 'social', label: 'Social', sections: [\n      { id: 'relacoes', label: 'Relaes', icon: '' },\n      { id: 'zoologo', label: 'Mestre Zologo Arkemis', icon: '' }\n    ]},\n    { id: 'gestao', label: 'Gesto', sections: [\n      { id: 'conselhos', label: 'Conselhos do Mestre da Guilda', icon: '' }\n    ]}\n  ] as const;\n  const currentCategory = categories.find(c => c.id === activeCategory) || categories[0];\n  const allSections = categories.flatMap(c => c.sections);\n  const getLabel = (id: string) => (allSections.find(s => s.id === id)?.label || '');\n  useEffect(() => {\n    if (!currentCategory.sections.find(s => s.id === activeSection)) {\n      setActiveSection(currentCategory.sections[0].id as any);\n    }\n  }, [activeCategory]);\n\n  useEffect(() => {\n    ensureDefaultGuildExists();\n    ensureNPCAdventurersSeedExists(npcSeedTarget);\n    startNPCSimulation();\n    try { useHeroStore.getState().triggerAutoInteraction('guild'); } catch {}\n    const autoIv = setInterval(() => {\n      try { useHeroStore.getState().triggerAutoInteraction('guild'); } catch {}\n    }, Math.max(60000, (useGameSettingsStore.getState().npcRotationSeconds || 60) * 1000));\n    return () => { clearInterval(autoIv); stopNPCSimulation(); };\n  }, [ensureDefaultGuildExists, npcSeedTarget]);\n\n  const defaultGuild = guilds.find(g => g.name === 'Foja dos Herois');\n  const guildLevel = defaultGuild ? (defaultGuild.level ?? Math.max(1, Math.floor(defaultGuild.guildXP / 250) + 1)) : 1;\n  const isCouncilMember = selectedHero && defaultGuild ? ((defaultGuild.councilMembers || []).includes(selectedHero.id) || (defaultGuild.roles?.[selectedHero.id] === 'lider')) : false;\n  const isRankS = selectedHero?.rankData?.currentRank === 'S';\n\n  const leaderboards = useMemo(() => generateAllLeaderboards(heroes), [heroes]);\n  const levelBoard = leaderboards.find(lb => lb.id === 'level');\n  const top5 = levelBoard ? levelBoard.entries.slice(0, 5) : [];\n\n  const [dungeonTop, setDungeonTop] = useState<Array<{ hero_name: string; max_floor_reached: number; total_xp: number; total_gold: number; finished_at: string }>>([]);\n  const [dungeonError, setDungeonError] = useState<string | null>(null);\n  const [dungeonOffline, setDungeonOffline] = useState(false);\n  const [hof, setHof] = useState<{ bestQuest?: { heroName: string; questName: string }; biggestLoot?: { heroName: string; totalGold: number }; promotions?: Array<{ heroName: string; newRank: string }>; weeklyEvent?: { guildName: string; eventName: string; xpBuffPercent?: number; trainingDiscountPercent?: number; expiresAt?: string } }>({});\n\n  useEffect(() => {\n    (async () => {\n      const res = await getDungeonLeaderboard(10);\n      if (res.offline) setDungeonOffline(true);\n      if (res.error) setDungeonError(res.error);\n      if (res.data) setDungeonTop(res.data);\n    })();\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      const now = new Date();\n      const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n      const feed = activityManager.getActivityFeed({\n        dateRange: { start: weekAgo, end: now },\n        showOnlyPublic: true\n      });\n      const epicOrBest = feed.activities\n        .filter(a => a.type === 'epic-quest-completed' || a.type === 'quest-completed')\n        .sort((a, b) => (Number(b.data?.questReward?.xp || 0) + Number(b.data?.questReward?.gold || 0)) - (Number(a.data?.questReward?.xp || 0) + Number(a.data?.questReward?.gold || 0)))[0];\n      const promotions = feed.activities\n        .filter(a => a.type === 'rank-promotion')\n        .slice(0, 5)\n        .map(a => ({ heroName: a.data.heroName, newRank: String(a.data.newRank || '') }));\n\n      const weeklyEventActivity = feed.activities\n        .filter(a => a.type === 'guild-event-activated')\n        .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())[0];\n\n      const { data: weekly, offline } = await getWeeklyDungeonHighlights();\n\n      setHof({\n        bestQuest: epicOrBest ? { heroName: epicOrBest.data.heroName, questName: String(epicOrBest.data.questName || 'Misso extraordinria') } : undefined,\n        biggestLoot: weekly?.biggestLoot ? { heroName: weekly.biggestLoot.hero_name, totalGold: weekly.biggestLoot.total_gold } : undefined,\n        promotions,\n        weeklyEvent: weeklyEventActivity ? {\n          guildName: String(weeklyEventActivity.data.guildName || 'Guilda'),\n          eventName: String(weeklyEventActivity.data.eventName || 'Evento da Guilda'),\n          xpBuffPercent: weeklyEventActivity.data.xpBuffPercent,\n          trainingDiscountPercent: weeklyEventActivity.data.trainingDiscountPercent,\n          expiresAt: typeof weeklyEventActivity.data.eventExpiresAt === 'string' ? weeklyEventActivity.data.eventExpiresAt : undefined\n        } : undefined\n      });\n    })();\n  }, []);\n\n  const handleRefreshMissions = () => {\n    refreshQuests();\n  };\n\n  const inventoryEntries = selectedHero\n    ? Object.entries(selectedHero.inventory.items).filter(([, qty]) => qty > 0)\n    : [];\n\n  const filteredInventoryEntries = inventoryEntries.filter(([itemId]) => {\n    const item = SHOP_ITEMS.find(i => i.id === itemId);\n    if (!item) return false;\n    if (selectedType !== 'todos' && item.type !== selectedType) return false;\n    if (selectedRarity !== 'todas' && item.rarity !== selectedRarity) return false;\n    return true;\n  });\n\n  const handleQtyChange = (itemId: string, value: number, max: number) => {\n    const safe = Math.max(1, Math.min(max, Math.floor(value || 1)));\n    setQtyByItem(prev => ({ ...prev, [itemId]: safe }));\n  };\n\n  const handleSell = (itemId: string) => {\n    if (!selectedHero) return;\n    const item = SHOP_ITEMS.find(i => i.id === itemId);\n    const currentQty = selectedHero.inventory.items[itemId] || 0;\n    const qty = Math.max(1, Math.min(currentQty, qtyByItem[itemId] || 1));\n    const isEquipped = item && (\n      (item.type === 'weapon' && selectedHero.inventory.equippedWeapon === itemId) ||\n      (item.type === 'armor' && selectedHero.inventory.equippedArmor === itemId) ||\n      (item.type === 'accessory' && (selectedHero.inventory.equippedAccessories || []).includes(itemId))\n    );\n    if (!item) {\n      notificationBus.emit({\n        title: 'Item desconhecido',\n        message: 'No foi possvel identificar o item para venda.',\n        type: 'error',\n        icon: ''\n      });\n      return;\n    }\n    if (isEquipped) {\n      notificationBus.emit({\n        title: 'Item equipado',\n        message: 'Desequipe o item antes de vend-lo (use o painel de Equipamentos).',\n        type: 'error',\n        icon: ''\n      });\n      return;\n    }\n    if (currentQty <= 0) {\n      notificationBus.emit({\n        title: 'Sem estoque',\n        message: 'Voc no possui este item no inventrio.',\n        type: 'error',\n        icon: ''\n      });\n      return;\n    }\n    const sellPrice = Math.floor(item.price * 0.6 * qty);\n    const ok = sellItem(selectedHero.id, itemId, qty);\n    if (ok) {\n      notificationBus.emit({\n        title: 'Venda concluda',\n        message: `${qty}x ${item.name} vendido por ${sellPrice} ouro!`,\n        type: 'success',\n        icon: ''\n      });\n      // Resetar quantidade para 1 aps venda\n      setQtyByItem(prev => ({ ...prev, [itemId]: 1 }));\n    } else {\n      notificationBus.emit({\n        title: 'Falha na venda',\n        message: `No foi possvel vender ${item.name}. Verifique a quantidade.`,\n        type: 'error',\n        icon: ''\n      });\n    }\n  };\n\n  const handleSellAllConsumables = () => {\n    if (!selectedHero) return;\n    const consumableEntries = inventoryEntries.filter(([itemId, qty]) => {\n      const item = SHOP_ITEMS.find(i => i.id === itemId);\n      return !!item && item.type === 'consumable' && qty > 0;\n    });\n    if (consumableEntries.length === 0) {\n      notificationBus.emit({\n        title: 'Nada para vender',\n        message: 'Nenhum consumvel disponvel no inventrio.',\n        type: 'error',\n        icon: ''\n      });\n      return;\n    }\n    let totalGold = 0;\n    let totalItems = 0;\n    consumableEntries.forEach(([itemId, qty]) => {\n      const item = SHOP_ITEMS.find(i => i.id === itemId)!;\n      const unitSell = Math.floor(item.price * 0.6);\n      totalGold += unitSell * qty;\n      totalItems += qty;\n      sellItem(selectedHero.id, itemId, qty);\n    });\n    notificationBus.emit({\n      title: 'Venda em massa concluda',\n      message: `${totalItems} consumveis vendidos por ${totalGold} ouro!`,\n      type: 'success',\n      icon: ''\n    });\n  };\n\n  const handleSellAll = (itemId: string) => {\n    if (!selectedHero) return;\n    const item = SHOP_ITEMS.find(i => i.id === itemId);\n    const currentQty = selectedHero.inventory.items[itemId] || 0;\n    if (!item) {\n      notificationBus.emit({\n        title: 'Item desconhecido',\n        message: 'No foi possvel identificar o item para venda.',\n        type: 'error',\n        icon: ''\n      });\n      return;\n    }\n    const isEquipped =\n      (item.type === 'weapon' && selectedHero.inventory.equippedWeapon === itemId) ||\n      (item.type === 'armor' && selectedHero.inventory.equippedArmor === itemId) ||\n      (item.type === 'accessory' && (selectedHero.inventory.equippedAccessories || []).includes(itemId));\n    if (isEquipped) {\n      notificationBus.emit({\n        title: 'Item equipado',\n        message: 'Desequipe o item antes de vend-lo (use o painel de Equipamentos).',\n        type: 'error',\n        icon: ''\n      });\n      return;\n    }\n    if (currentQty <= 0) {\n      notificationBus.emit({\n        title: 'Sem estoque',\n        message: 'Voc no possui este item no inventrio.',\n        type: 'error',\n        icon: ''\n      });\n      return;\n    }\n    const sellPrice = Math.floor(item.price * 0.6 * currentQty);\n    const ok = sellItem(selectedHero.id, itemId, currentQty);\n    if (ok) {\n      notificationBus.emit({\n        title: 'Venda concluda',\n        message: `${currentQty}x ${item.name} vendido por ${sellPrice} ouro!`,\n        type: 'success',\n        icon: ''\n      });\n      setQtyByItem(prev => ({ ...prev, [itemId]: 1 }));\n    } else {\n      notificationBus.emit({\n        title: 'Falha na venda',\n        message: `No foi possvel vender ${item.name}.`,\n        type: 'error',\n        icon: ''\n      });\n    }\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {/* Header e Navegao */}\n      <div className={`${tokens.surface} p-6 rounded-lg border ${seasonalBorder} mb-4 ${tokens.surfaceText} overflow-hidden`}>\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\"> Foja dos Herois</h1>\n            <p className=\"text-gray-300 mt-2\">Hub central: misses, recrutamento, ranks, treino e tesouro.</p>\n          </div>\n          <div className=\"text-4xl\"></div>\n        </div>\n        {/* Mtricas de guilda removidas */}\n        <div className=\"mt-3 text-xs text-gray-400\">Guild Hub v{GUILD_HUB_VERSION}</div>\n        <Tabs items={categories.map(c => ({ id: c.id, label: c.label }))} activeId={activeCategory} onChange={(id) => setActiveCategory(id as any)} size=\"sm\" className=\"mt-6\" />\n        <Tabs items={currentCategory.sections.map(s => ({ id: s.id, label: s.label, icon: s.icon }))} activeId={activeSection} onChange={(id) => setActiveSection(id as any)} className=\"mt-2\" />\n        <div className={`mt-2 text-xs ${tokens.breadcrumbText}`}>Guild Hub  {currentCategory.label}  {getLabel(activeSection)}</div>\n      </div>\n\n      {/* Contedo por seo */}\n      {activeSection === 'salao' && (\n        <div className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n            <NPCPresenceLayer />\n          </div>\n          <SimsDialogueModal />\n          <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-2xl font-bold\"> Quadro de Misses</h2>\n              <a href=\"/quests\" className=\"px-4 py-2 rounded bg-amber-600 text-black hover:bg-amber-500 focus:outline-none focus:ring-2 focus:ring-indigo-500\">Abrir</a>\n            </div>\n            <div className=\"text-sm text-gray-300\">Misses unificadas de caa e escolta com interface clara e progresso integrada da guilda.</div>\n          </div>\n\n          {/* Ranking rpido */}\n          <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-2xl font-bold\"> Ranking Rpido</h2>\n              <a href=\"/leaderboards\" className=\"px-4 py-2 rounded bg-amber-600 text-black hover:bg-amber-500 focus:outline-none focus:ring-2 focus:ring-indigo-500\">Ver Completo</a>\n            </div>\n            {top5.length > 0 ? (\n              <ul className=\"space-y-2\">\n                {top5.map((e, idx) => (\n                  <li key={e.heroId} className=\"flex items-center justify-between bg-gray-900 border border-gray-700 p-3 rounded\">\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"text-xl\">{idx + 1}.</span>\n                      <span className=\"font-semibold\">{e.heroName}</span>\n                      {heroes.find(h => h.id === e.heroId)?.origin === 'npc' && (\n                        <span className=\"text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded\">NPC</span>\n                      )}\n                    </div>\n                    <span className=\"text-sm text-gray-300\">Nvel {e.value}</span>\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <div className=\"text-center py-8 text-gray-400\">\n                <div className=\"text-5xl mb-2\"></div>\n                <p>Nenhum heri no ranking ainda.</p>\n              </div>\n            )}\n          </div>\n\n          \n\n          {/* Dungeon Infinita */}\n          <div className={`bg-gray-800 p-6 rounded-lg border ${seasonalBorder} text-gray-100`}>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-2xl font-bold\"> Dungeon Infinita</h2>\n              <div className=\"flex gap-2\">\n                <a href=\"/dungeon-infinita\" className=\"px-4 py-2 rounded bg-purple-600 text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-500\">Jogar</a>\n              </div>\n            </div>\n            {dungeonOffline && (\n              <div className=\"text-sm text-gray-400 mb-2\">Modo offline: conecte o Supabase para ver o ranking.</div>\n            )}\n            {dungeonError && (\n              <div className=\"text-sm text-red-600 mb-2\">{dungeonError}</div>\n            )}\n            {dungeonTop.length > 0 ? (\n              <ul className=\"space-y-2\">\n                {dungeonTop.map((e, idx) => (\n                  <li key={`${e.hero_name}-${e.finished_at}-${idx}`} className=\"flex items-center justify-between bg-gray-900 border border-gray-700 p-3 rounded\">\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"text-xl\">{idx + 1}.</span>\n                      <span className=\"font-semibold\">{e.hero_name}</span>\n                    </div>\n                    <div className=\"text-sm text-gray-300\">\n                      Andar {e.max_floor_reached}  {e.total_xp} XP  {e.total_gold} ouro\n                    </div>\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <div className=\"text-center py-8 text-gray-400\">\n                <div className=\"text-5xl mb-2\"></div>\n                <p>Nenhuma tentativa registrada ainda.</p>\n              </div>\n            )}\n          </div>\n          {/* Party removida */}\n\n          \n\n          {/* Mercado de Esplios */}\n          <div className={`bg-gray-800 p-6 rounded-lg border ${seasonalBorder} text-gray-100`}>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-2xl font-bold\"> Mercado de Esplios</h2>\n              <div className=\"flex items-center gap-2\">\n                {selectedHero && (\n                  <button\n                    onClick={handleSellAllConsumables}\n                    className=\"px-4 py-2 rounded bg-amber-600 text-black hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                    title=\"Vender todos os consumveis do inventrio\"\n                  >\n                    Vender todos consumveis\n                  </button>\n                )}\n                {!selectedHero && (\n                  <a href=\"/\" className=\"px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500\">Selecionar Heri</a>\n                )}\n              </div>\n            </div>\n\n            {/* Filtros */}\n            {selectedHero && (\n              <div className=\"flex flex-wrap items-center gap-3 mb-4\">\n                <div className=\"flex items-center gap-2\">\n                  <label className=\"text-sm text-gray-300\">Tipo</label>\n                  <select\n                    value={selectedType}\n                    onChange={(e) => setSelectedType(e.target.value as any)}\n                    className=\"px-2 py-1 border rounded text-sm bg-gray-900 text-gray-200 border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                  >\n                    <option value=\"todos\">Todos</option>\n                    <option value=\"consumable\">Consumvel</option>\n                    <option value=\"weapon\">Arma</option>\n                    <option value=\"armor\">Armadura</option>\n                    <option value=\"accessory\">Acessrio</option>\n                    <option value=\"material\">Material</option>\n                  </select>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <label className=\"text-sm text-gray-300\">Raridade</label>\n                  <select\n                    value={selectedRarity}\n                    onChange={(e) => setSelectedRarity(e.target.value as any)}\n                    className=\"px-2 py-1 border rounded text-sm bg-gray-900 text-gray-200 border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                  >\n                    <option value=\"todas\">Todas</option>\n                    <option value=\"comum\">Comum</option>\n                    <option value=\"raro\">Raro</option>\n                    <option value=\"epico\">pico</option>\n                    <option value=\"lendario\">Lendrio</option>\n                  </select>\n                </div>\n                <button\n                  onClick={() => { setSelectedType('todos'); setSelectedRarity('todas'); }}\n                  className=\"px-3 py-1 rounded bg-gray-900 text-gray-200 hover:bg-gray-800 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 border border-gray-700\"\n                >\n                  Limpar filtros\n                </button>\n              </div>\n            )}\n\n            {selectedHero ? (\n              filteredInventoryEntries.length > 0 ? (\n                <div className=\"space-y-3\">\n                  {filteredInventoryEntries.map(([itemId, qty]) => {\n                    const item = SHOP_ITEMS.find(i => i.id === itemId);\n                    if (!item) return null;\n                    const unitSell = Math.floor(item.price * 0.6);\n                    const sellQty = qtyByItem[itemId] ?? 1;\n                    const isEquipped =\n                      (item.type === 'weapon' && selectedHero.inventory.equippedWeapon === itemId) ||\n                      (item.type === 'armor' && selectedHero.inventory.equippedArmor === itemId) ||\n                      (item.type === 'accessory' && (selectedHero.inventory.equippedAccessories || []).includes(itemId));\n                    return (\n                      <div key={itemId} className=\"flex items-center justify-between bg-gray-900 border border-gray-700 p-3 rounded\">\n                        <div className=\"flex items-center space-x-4\">\n                          <div className=\"text-2xl\">{item.icon}</div>\n                          <div>\n                            <div className=\"font-semibold\">{item.name}</div>\n                            <div className=\"text-sm text-gray-300\">Qtd: {qty}  Preo venda: {unitSell} ouro/un</div>\n                            {isEquipped && (\n                              <div className=\"text-xs text-red-600\">Equipado  desequipe para vender.</div>\n                            )}\n                          </div>\n                        </div>\n                        <div className=\"flex items-center space-x-3\">\n                          <input\n                            type=\"number\"\n                            min={1}\n                            max={qty}\n                            value={sellQty}\n                            onChange={(e) => handleQtyChange(itemId, Number(e.target.value), qty)}\n                            className=\"w-20 px-2 py-1 border rounded bg-gray-900 text-gray-200 border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                            aria-label={`Quantidade para vender ${item.name}`}\n                          />\n                          <div className=\"text-sm text-gray-300\">Total: {unitSell * Math.max(1, Math.min(qty, sellQty))} ouro</div>\n                          <button\n                            onClick={() => handleSell(itemId)}\n                            disabled={isEquipped}\n                            className={`px-4 py-2 rounded text-white ${isEquipped ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700'} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                          >\n                            Vender\n                          </button>\n                          <button\n                            onClick={() => handleSellAll(itemId)}\n                            disabled={isEquipped || qty <= 0}\n                            className={`px-4 py-2 rounded text-white ${isEquipped || qty <= 0 ? 'bg-gray-400 cursor-not-allowed' : 'bg-amber-600 hover:bg-amber-700'} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                            title={isEquipped ? 'Item equipado  desequipe para vender' : 'Vender toda a quantidade disponvel'}\n                          >\n                            Vender Tudo\n                          </button>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-gray-400\">\n                  <div className=\"text-5xl mb-2\"></div>\n                  <p>Nenhum esplio para vender no momento.</p>\n                </div>\n              )\n            ) : (\n              <div className=\"text-center py-8 text-gray-400\">\n                <div className=\"text-5xl mb-2\"></div>\n                <p>Selecione um heri para acessar o mercado.</p>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Quadro de Misses removido por enquanto */}\n\n      \n\n      {activeSection === 'treinamento' && (\n        <div className={`${tokens.cardBase} border border-gray-200`}>\n          <h2 className=\"text-2xl font-bold mb-4\"> Sala de Treinamento</h2>\n          <Training />\n        </div>\n      )}\n\n      {activeSection === 'sala-herois' && (\n        <div className={`${tokens.cardBase} border border-gray-200`}>\n          <h2 className=\"text-2xl font-bold mb-4\"> Salo dos Heris</h2>\n          <Leaderboards />\n        </div>\n      )}\n\n      {/* Seo de Conselho removida */}\n\n      {/* Seo de Convites de Duelo removida */}\n\n      {activeSection === 'relacoes' && (\n        <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n          <Suspense fallback={<div className=\"text-xs text-gray-400\">Carregando Relaes</div>}>\n            <RelationshipsPanel />\n          </Suspense>\n        </div>\n      )}\n\n      {activeSection === 'conselhos' && (\n        <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n          <Suspense fallback={<div className=\"text-xs text-gray-400\">Gerando Conselhos</div>}>\n            <GuildAdvicePanel />\n          </Suspense>\n        </div>\n      )}\n\n      {/* Seo removida: Cofre da Guilda */}\n\n      {activeSection === 'zoologo' && (\n        <div className={`${tokens.cardBase} border border-gray-200`}>\n          <h2 className=\"text-2xl font-bold mb-4\"> Mestre Zologo Arkemis</h2>\n          <div className=\"text-sm text-gray-300 mb-4\">Identificao oficial de ovos misteriosos, com custos variveis por raridade.</div>\n          <div className=\"bg-gray-900 border border-gray-700 rounded p-4\">\n            {selectedHero ? (\n              <div className=\"space-y-4\">\n                <React.Suspense fallback={<div className=\"text-sm text-gray-300\">Carregando...</div>}>\n                  <EggIdentificationNPC />\n                </React.Suspense>\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-gray-500\">\n                <div className=\"text-5xl mb-2\"></div>\n                <p>Selecione um heri para consultar o Mestre Zologo.</p>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default GuildHub;\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { Quest, QuestDifficulty, Hero } from '../types/hero';\nimport { generateQuestBoard } from '../utils/quests';\nimport { SHOP_ITEMS } from '../utils/shop';\nimport { getClassIcon } from '../styles/medievalTheme';\nimport { ELEMENT_INFO } from '../utils/elementSystem';\nimport { getElementInfoSafe } from '../utils/elementSystem';\nimport { worldStateManager } from '../utils/worldState';\nimport { getMissionBuffPercent } from '../utils/relationBenefits';\nimport { computeRewardMultiplier } from '../utils/dungeonConfig';\n\n// Componente para seleo de heri\nconst HeroSelector: React.FC<{ \n  heroes: Hero[], \n  onHeroSelect: (heroId: string) => void \n}> = ({ heroes, onHeroSelect }) => {\n  const { getSelectedHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const playerHeroes = heroes.filter(h => h.origin !== 'npc');\n  const selectedHeroId = selectedHero?.id || null;\n\n  const handleClick = (heroId: string) => {\n    onHeroSelect(heroId);\n  };\n\n  if (heroes.length === 0) {\n    return (\n      <div className=\"text-center p-8 bg-slate-800/50 rounded-lg border border-amber-500/30\">\n        <div className=\"text-4xl mb-4\"></div>\n        <h3 className=\"text-xl font-bold text-amber-400 mb-2\">Nenhum Heri Criado</h3>\n        <p className=\"text-gray-300 mb-4\">Voc precisa criar um heri primeiro para acessar as misses.</p>\n        <a \n          href=\"/\" \n          className=\"inline-block px-6 py-3 bg-amber-600 hover:bg-amber-700 text-white font-medium rounded-lg transition-colors\"\n        >\n          Criar Primeiro Heri\n        </a>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-slate-800/50 rounded-lg border border-amber-500/30 p-6\">\n      <h3 className=\"text-xl font-bold text-amber-400 mb-4 text-center\">Escolha seu Heri</h3>\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {heroes.map(hero => {\n          // Antes: const elementInfo = ELEMENT_INFO[hero.element];\n          // Depois:\n          const elementInfo = getElementInfoSafe(hero.element);\n          return (\n            <div\n              key={hero.id}\n              onClick={() => handleClick(hero.id)}\n              className={`bg-slate-700/50 rounded-lg p-4 border transition-all cursor-pointer group ${\n                selectedHeroId === hero.id \n                  ? 'border-amber-500 bg-amber-900/20' \n                  : 'border-slate-600 hover:border-amber-500 hover:bg-slate-700/70'\n              }`}\n            >\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"text-3xl\">{hero.avatar}</div>\n                <div className=\"flex-1\">\n                  <h4 className=\"font-bold text-white group-hover:text-amber-400 transition-colors\">\n                    {hero.name}\n                  </h4>\n                  <div className=\"text-sm text-gray-300 flex items-center space-x-2\">\n                    <span>{getClassIcon(hero.class)} {hero.class}</span>\n                    <span style={{ color: elementInfo?.color || '#9CA3AF' }}>\n                        {elementInfo?.icon || ''} {hero.element}\n                    </span>\n                  </div>\n                  <div className=\"text-xs text-amber-600\">\n                    Nvel {hero.progression.level}  {hero.progression.experience} XP\n                  </div>\n                  {selectedHeroId === hero.id && (\n                    <div className=\"text-xs text-green-400 mt-1 font-medium\">\n                       Heri selecionado! Carregando misses...\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nconst QuestBoard: React.FC = () => {\n  const { \n    getSelectedHero, \n    availableQuests, \n    refreshQuests, \n    acceptQuest, \n    completeQuest,\n    abandonQuest,\n    clearActiveQuests,\n    gainXP,\n    gainGold,\n    addItemToInventory,\n    updateHero,\n    updateDailyGoalProgress,\n    selectHero,\n    heroes,\n    getQuestById\n  } = useHeroStore();\n  \n  const selectedHero = getSelectedHero();\n  const playerHeroes = useMemo(() => (heroes || []).filter(h => h.origin !== 'npc'), [heroes]);\n  const availableUniq = useMemo(() => {\n    try {\n      const seen = new Set<string>();\n      return (availableQuests || []).filter(q => {\n        const id = String(q.id);\n        if (seen.has(id)) return false;\n        seen.add(id);\n        return true;\n      });\n    } catch { return availableQuests; }\n  }, [availableQuests]);\n  const activeIdsUniq = useMemo(() => {\n    try { return Array.from(new Set(selectedHero.activeQuests || [])); } catch { return selectedHero.activeQuests; }\n  }, [selectedHero.activeQuests]);\n  const completedIdsUniq = useMemo(() => {\n    try { return Array.from(new Set(selectedHero.completedQuests || [])); } catch { return selectedHero.completedQuests; }\n  }, [selectedHero.completedQuests]);\n  \n  const [selectedTab, setSelectedTab] = useState<'available' | 'active' | 'completed'>('available');\n  const [companionsOnly, setCompanionsOnly] = useState<boolean>(() => {\n    try {\n      const q = new URLSearchParams(window.location.search);\n      if (q.get('companions') === '1') return true;\n      const ls = localStorage.getItem('questboard_companions_only');\n      return ls === '1';\n    } catch { return false; }\n  });\n  const [forceUpdate, setForceUpdate] = useState(0);\n  const [refreshCooldownEndsAt, setRefreshCooldownEndsAt] = useState<number | null>(null);\n  const [nowTs, setNowTs] = useState<number>(() => Date.now());\n\n  // Selecionar automaticamente o primeiro heri se no h nenhum selecionado\n  useEffect(() => {\n    if (!selectedHero && playerHeroes.length > 0) {\n      selectHero(playerHeroes[0].id);\n      refreshQuests(playerHeroes[0].progression.level);\n    }\n  }, [selectedHero?.id, playerHeroes.length]);\n\n  // Monitorar mudanas no heri selecionado\n  useEffect(() => {\n    console.log('Estado do heri selecionado mudou:', selectedHero?.name || 'Nenhum');\n  }, [selectedHero]);\n\n  // Rotao automtica de misses a cada 10 min\n  useEffect(() => {\n    const intervalId = setInterval(() => {\n      refreshQuests(selectedHero?.progression.level || 1);\n    }, 10 * 60 * 1000);\n    return () => clearInterval(intervalId);\n  }, [selectedHero?.id]);\n\n  const handleManualRefresh = () => {\n    if (!selectedHero) return;\n    const now = Date.now();\n    if (refreshCooldownEndsAt && now < refreshCooldownEndsAt) return;\n    refreshQuests(selectedHero.progression.level);\n    setRefreshCooldownEndsAt(now + 5 * 60 * 1000);\n  };\n\n  // Narrativas removidas: no geramos mais misses narrativas\n\n  const handleHeroSelect = (heroId: string) => {\n    console.log('Clique detectado! Selecionando heri:', heroId);\n    selectHero(heroId);\n    \n    // Atualizar misses para o heri selecionado\n    const selectedHeroData = playerHeroes.find(h => h.id === heroId);\n    if (selectedHeroData) {\n      console.log('Atualizando misses para heri:', selectedHeroData.name, 'Level:', selectedHeroData.progression.level);\n      refreshQuests(selectedHeroData.progression.level);\n    }\n    \n    console.log('Heri selecionado, forando atualizao...');\n    setForceUpdate(prev => prev + 1);\n    \n    // Verificar se a seleo funcionou\n    setTimeout(() => {\n      const currentSelected = heroes.find(h => h.id === heroId);\n      console.log('Heri encontrado:', currentSelected?.name);\n    }, 100);\n  };\n\n  // Removido: fluxo de concluso de misses narrativas\n\n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"text-center mb-8\">\n          <div className=\"text-6xl mb-4\"></div>\n          <h2 className=\"text-3xl font-bold text-amber-400 mb-4\">Quadro de Misses</h2>\n          <p className=\"text-gray-300 mb-6\">Selecione um heri para ver as misses disponveis</p>\n        </div>\n        \n        <HeroSelector heroes={playerHeroes} onHeroSelect={handleHeroSelect} />\n      </div>\n    );\n  }\n\n  const getDifficultyColor = (difficulty: QuestDifficulty) => {\n    switch (difficulty) {\n      case 'rapida': return 'text-green-400 bg-green-900/20';\n      case 'padrao': return 'text-yellow-400 bg-yellow-900/20';\n      case 'epica': return 'text-purple-400 bg-purple-900/20';\n      default: return 'text-gray-400 bg-gray-900/20';\n    }\n  };\n\n  const getDifficultyLabel = (difficulty: QuestDifficulty) => {\n    switch (difficulty) {\n      case 'rapida': return 'Rpida';\n      case 'padrao': return 'Padro';\n      case 'epica': return 'pica';\n      default: return 'Desconhecido';\n    }\n  };\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case 'contrato': return '';\n      case 'caca': return '';\n      case 'exploracao': return '';\n      case 'historia': return '';\n      default: return '';\n    }\n  };\n\n  useEffect(() => {\n    const t = setInterval(() => setNowTs(Date.now()), 1000);\n    return () => clearInterval(t);\n  }, []);\n\n  const cdMs = useMemo(() => {\n    const ends = selectedHero?.questing?.cooldownEndsAt ? new Date(selectedHero.questing.cooldownEndsAt).getTime() : 0;\n    return ends ? Math.max(0, ends - nowTs) : 0;\n  }, [selectedHero?.questing?.cooldownEndsAt, nowTs]);\n  const cdActive = cdMs > 0;\n\n  const formatRemaining = (ms: number) => {\n    const s = Math.max(0, Math.floor(ms / 1000));\n    const hh = Math.floor(s / 3600);\n    const mm = Math.floor((s % 3600) / 60);\n    const ss = s % 60;\n    const pad = (n: number) => String(n).padStart(2, '0');\n    return hh > 0 ? `${pad(hh)}:${pad(mm)}:${pad(ss)}` : `${pad(mm)}:${pad(ss)}`;\n  };\n\n  const canAcceptQuest = (quest: Quest) => {\n    return selectedHero.progression.level >= quest.levelRequirement &&\n           !selectedHero.activeQuests.includes(quest.id) &&\n           !cdActive;\n  };\n\n  const handleAcceptQuest = (quest: Quest) => {\n    if (canAcceptQuest(quest) && selectedHero) {\n      console.log(' Aceitando misso:', quest.title, 'para heri:', selectedHero.name);\n      acceptQuest(selectedHero.id, quest.id);\n    }\n  };\n\n  const handleCompleteQuest = (questId: string) => {\n    if (selectedHero) {\n      console.log(' Completando misso:', questId, 'para heri:', selectedHero.name);\n      completeQuest(selectedHero.id, questId);\n    }\n  };\n\n  const ActiveMissionRunner: React.FC<{ hero: Hero; quest: Quest }> = ({ hero, quest }) => {\n    const [running, setRunning] = useState(false);\n    const [finished, setFinished] = useState(false);\n    const [phaseIndex, setPhaseIndex] = useState(0);\n    const [log, setLog] = useState<Array<{ phase: number; success: boolean; xp: number; gold: number; narrative: string; itemsAwarded?: { id: string; name?: string }[] }>>([]);\n    const [autoRun, setAutoRun] = useState(false);\n    const [npcIntegrity, setNpcIntegrity] = useState<number | null>(quest.categoryHint === 'escolta' ? 100 : null);\n    const [anyLoot, setAnyLoot] = useState(false);\n    const [streak, setStreak] = useState(0);\n    const [error, setError] = useState<string | null>(null);\n\n    const phasesTotal = useMemo(() => {\n      const r = (hero.rankData?.currentRank || hero.rank || 'F');\n      const low = r === 'F' || r === 'E';\n      const mid = r === 'D';\n      const base = quest.phasesHint || (quest.difficulty === 'epica' ? 6 : (quest.difficulty === 'padrao' ? 4 : 3));\n      if (low && quest.difficulty === 'rapida') return 2;\n      if (mid && quest.difficulty === 'epica') return Math.max(5, base);\n      return Math.max(2, base);\n    }, [hero.rankData?.currentRank, hero.rank, quest.phasesHint, quest.difficulty]);\n    const staminaCostPerPhase = useMemo(() => (quest.difficulty === 'rapida' ? 2 : (quest.difficulty === 'epica' ? 4 : 3)), [quest.difficulty]);\n    const biome = quest.biomeHint || 'Floresta Nebulosa';\n    const category = quest.categoryHint || (quest.type === 'caca' ? 'controle' : 'controle');\n    const cdMsQ = useMemo(() => {\n      const ends = hero?.questing?.cooldownEndsAt ? new Date(hero.questing.cooldownEndsAt).getTime() : 0;\n      return ends ? Math.max(0, ends - Date.now()) : 0;\n    }, [hero?.questing?.cooldownEndsAt]);\n    const cdActiveQ = cdMsQ > 0;\n\n    useEffect(() => {\n      try {\n        const st = (hero.stats as any)?.missionRunState || {};\n        const s = st[String(quest.id)];\n        if (s) {\n          setPhaseIndex(Math.max(0, s.phase || 0));\n          setNpcIntegrity(typeof s.npcIntegrity === 'number' ? s.npcIntegrity : (quest.categoryHint === 'escolta' ? 100 : null));\n          setRunning(Boolean(s.running));\n          setFinished(Boolean(s.finished));\n          if (Array.isArray(s.logs) && s.logs.length > 0) {\n            setLog(s.logs.map(e => ({ phase: e.phase, success: true, xp: e.xp, gold: e.gold, narrative: e.narrative, itemsAwarded: [] })));\n          }\n        }\n      } catch {}\n    }, [hero.id, quest.id]);\n\n    const persistState = (pi: number, ni: number | null, run: boolean, fin: boolean, logsArr: Array<{ phase: number; xp: number; gold: number; narrative: string }>) => {\n      try {\n        const st = { ...((hero.stats as any)?.missionRunState || {}) } as Record<string, any>;\n        st[String(quest.id)] = { phase: pi, npcIntegrity: (ni ?? undefined) as any, running: run, finished: fin, logs: logsArr };\n        updateHero(hero.id, { stats: { ...hero.stats, missionRunState: st } });\n      } catch {}\n    };\n\n    const start = () => {\n      if (cdActiveQ) { setError('Cooldown ativo para misses. Aguarde o tempo de recarga.'); return; }\n      const currentFatigue = Math.max(0, Number(hero.progression?.fatigue || 0));\n      const needed = worldStateManager.computeEffectiveStaminaCost(hero, staminaCostPerPhase);\n      if (currentFatigue + needed > 100) { setError('Fadiga alta  descanse antes de iniciar.'); return; }\n      setRunning(true);\n      setFinished(false);\n      setPhaseIndex(0);\n      setLog([]);\n      setError(null);\n      setStreak(0);\n      setNpcIntegrity(category === 'escolta' ? 100 : null);\n      setAnyLoot(false);\n      persistState(0, category === 'escolta' ? 100 : null, true, false, []);\n    };\n\n    const resolvePhase = () => {\n      if (finished) return;\n      const extraPhaseCost = phaseIndex >= 2 ? 1 : 0;\n      const help = (hero.stats as any)?.helpStatus;\n      const staminaDiscount = help && help.staminaCostReduction ? Math.max(0, Math.min(2, help.staminaCostReduction)) : 0;\n      const totalCost = Math.max(1, (staminaCostPerPhase + extraPhaseCost) - staminaDiscount);\n      const needed = worldStateManager.computeEffectiveStaminaCost(hero, totalCost);\n      const currentFatigue = Math.max(0, Number(hero.progression?.fatigue || 0));\n      if (currentFatigue + needed > 100) { setError('Fadiga alta  pare e descanse.'); setRunning(false); return; }\n      worldStateManager.consumeStamina(hero, totalCost);\n      updateHero(hero.id, { progression: hero.progression });\n      const base = quest.difficulty === 'epica' ? 0.45 : quest.difficulty === 'dificil' ? 0.6 : quest.difficulty === 'medio' ? 0.7 : 0.8;\n      const riskStep = 0.06;\n      const attr = hero.attributes;\n      const classBonus = category === 'controle' ? (attr.destreza || 0) * 0.01 : category === 'coleta' ? (attr.inteligencia || 0) * 0.01 : category === 'escolta' ? (attr.constituicao || 0) * 0.008 : (attr.forca || 0) * 0.008;\n      const floor = 0.2;\n      const helpSuccessBoost = help && help.successBoostPercent ? Math.max(0, Math.min(0.2, help.successBoostPercent)) : 0;\n      const successChance = Math.max(floor, Math.min(0.95, (base - phaseIndex * riskStep) + classBonus + helpSuccessBoost));\n      const roll = Math.random();\n      const success = roll < successChance;\n      const mult = computeRewardMultiplier(streak);\n      const xpBaseRaw = (quest.baseRewardsHint?.xp || 25);\n      const goldBaseRaw = (quest.baseRewardsHint?.gold || 25);\n      const phaseScaling = 1 + Math.max(0, (phasesTotal - 3)) * 0.15;\n      const xpBase = Math.round(xpBaseRaw * phaseScaling);\n      const goldBase = Math.round(goldBaseRaw * phaseScaling);\n      const boss = category === 'especial' && phaseIndex + 1 === phasesTotal;\n      const bossMult = boss ? 1.5 : 1;\n      const buffPct = getMissionBuffPercent(hero);\n      const { getHeroParty, consumeOneMissionContract } = useHeroStore.getState();\n      const party = getHeroParty(hero.id);\n      const contractSharePct = party && party.contractByHeroId && party.contractByHeroId[hero.id] ? Math.max(0, Math.min(0.5, (party.contractByHeroId[hero.id].rewardShare || 0) / 100)) : 0;\n      const helpXpPct = help && help.boostXpPercent ? Math.max(0, Math.min(0.5, help.boostXpPercent)) : 0;\n      const helpGoldPct = help && help.goldBonusPercent ? Math.max(0, Math.min(0.5, help.goldBonusPercent)) : 0;\n      const xp = Math.round(((success ? xpBase : Math.round(xpBase * 0.5)) * (1 + contractSharePct)) * mult * bossMult * (1 + buffPct + helpXpPct));\n      const gold = Math.round(((success ? goldBase : Math.round(goldBase * 0.3)) * (1 + contractSharePct)) * mult * bossMult * (1 + Math.min(0.25, buffPct) + helpGoldPct));\n      gainXP(hero.id, xp);\n      gainGold(hero.id, gold);\n\n      const lootTier = boss ? 'epico' : phaseIndex >= 2 ? 'raro' : phaseIndex >= 1 ? 'incomum' : 'comum';\n      const itemsEquip = Math.random() < (success ? 0.5 : 0.25) ? [] : [];\n      itemsEquip.forEach(it => addItemToInventory(hero.id, (it as any).id || '', 1));\n\n      const categoryPools: Record<string, string[]> = {\n        controle: ['pele-lobo-sombrio','colmilho-vampirico','osso-antigo'],\n        coleta: ['erva-sangue','essencia-lunar','cristal-runico'],\n        escolta: ['pergaminho-protecao','pergaminho-velocidade'],\n        especial: boss ? ['lamina-alpha','armadura-pedra-rachada'] : []\n      };\n      const ids = categoryPools[category] || [];\n      const extraIds: string[] = [];\n      if (ids.length) {\n        const dropChanceBase = boss ? 1 : success ? 0.7 : 0.4;\n        const phaseDropBoost = Math.max(0, Math.min(0.25, (phasesTotal - 3) * 0.05));\n        const helpLootBonus = help && help.lootDropBonusPercent ? Math.max(0, Math.min(0.5, help.lootDropBonusPercent)) : 0;\n        const dropChance = Math.min(1, dropChanceBase + phaseDropBoost + helpLootBonus);\n      const hour = new Date().getHours();\n      const isNight = hour < 6 || hour >= 18;\n      const isDay = hour >= 8 && hour < 17;\n        const eligible = ids.filter(id => {\n          if (id === 'essencia-lunar') return isNight;\n          if (id === 'erva-sangue') return isDay;\n          if (id === 'cristal-runico') return biome === 'Caverna Antiga' || biome === 'Runas Antigas';\n          return true;\n        });\n        if (eligible.length && Math.random() < dropChance) {\n          const pickId = eligible[Math.floor(Math.random() * eligible.length)];\n          addItemToInventory(hero.id, pickId, 1);\n          extraIds.push(pickId);\n        }\n      }\n\n      const ENEMIES_BY_BIOME: Record<string, string[]> = {\n        'Colinas de Boravon': ['Lobo Sombrio','Bandido'],\n        'Rio Marfim': ['Slime cido','Serpente do Rio'],\n        'Floresta Nebulosa': ['Morcego Vampiro','Bruxa da Nvoa'],\n        'Runas Antigas': ['Golem Rachado','Esqueleto'],\n        'Floresta Umbral': ['Bruxa da Nvoa','Lobo Sombrio'],\n        'Caverna Antiga': ['Troll de Pedra','Slime cido']\n      };\n      const baseAmbush = category === 'escolta' ? 0.25 : 0.15;\n      const ambushShield = help && help.ambushReductionPercent ? Math.max(0, Math.min(0.9, help.ambushReductionPercent)) : 0;\n      const ambush = Math.random() < Math.max(0, (baseAmbush + (quest.difficulty === 'dificil' ? 0.05 : quest.difficulty === 'epica' ? 0.1 : 0)) * (1 - ambushShield));\n      let npcAfter = npcIntegrity;\n      let ambushText = '';\n      if (ambush) {\n        const enemies = ENEMIES_BY_BIOME[biome] || ['Inimigos'];\n        const foe = enemies[Math.floor(Math.random() * enemies.length)];\n        const ambushDamageBaseRaw = Math.round((hero.derivedAttributes.hp || 20) * 0.1);\n        const ambushDamageBase = Math.max(0, Math.round(ambushDamageBaseRaw * (1 - ambushShield)));\n        const curHp2 = hero.derivedAttributes.currentHp ?? (hero.derivedAttributes.hp || 0);\n        const newHp2 = Math.max(0, curHp2 - ambushDamageBase);\n        updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: newHp2 } });\n        ambushText = `  Emboscada: ${foe} causa dano.`;\n        if (npcAfter !== null) npcAfter = Math.max(0, (npcAfter ?? 0) - 10);\n        const maxHp2 = hero.derivedAttributes.hp || 1;\n        if ((newHp2 / maxHp2) < 0.2) { setAutoRun(false); setError('HP baixo, auto desativado.'); }\n      }\n\n      if (!success) {\n        const maxHp = hero.derivedAttributes.hp || 1;\n        const curHp = hero.derivedAttributes.currentHp ?? maxHp;\n        const damageBase = Math.round(maxHp * 0.1);\n        const newHp = Math.max(0, curHp - damageBase);\n        const newFatigue = Math.min(100, (hero.progression.fatigue || 0) + 6);\n        updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: newHp }, progression: { ...hero.progression, fatigue: newFatigue } });\n        if (npcAfter !== null) npcAfter = Math.max(0, (npcAfter ?? 0) - 15);\n        const maxHp2 = hero.derivedAttributes.hp || 1;\n        if ((newHp / maxHp2) < 0.2) { setAutoRun(false); setError('HP baixo, auto desativado.'); }\n      }\n      if (npcAfter !== undefined && npcAfter !== null) setNpcIntegrity(npcAfter);\n\n      const mapName = (id: string) => SHOP_ITEMS.find(i => i.id === id)?.name || id;\n      const result = { phase: phaseIndex + 1, success, xp, gold, narrative: (success ? `Progresso na fase ${phaseIndex + 1}.` : `Revs na fase ${phaseIndex + 1}.`) + ambushText + (buffPct > 0 ? `  Buff de relao +${Math.round(buffPct*100)}%` : '') + (contractSharePct > 0 ? `  Acordo da party +${Math.round(contractSharePct*100)}%` : ''), itemsAwarded: [...itemsEquip.map((i: any) => ({ id: i.id, name: i.name })), ...extraIds.map(id => ({ id, name: mapName(id) }))] };\n      const nextLogs = [...log, { phase: phaseIndex + 1, xp, gold, narrative: result.narrative }];\n      setLog(prev => [...prev, result]);\n      if ((itemsEquip.length > 0) || (extraIds.length > 0)) setAnyLoot(true);\n      setStreak(s => s + (success ? 1 : 0));\n      const nextPhase = phaseIndex + 1;\n      setPhaseIndex(p => p + 1);\n      const willFinish = (npcAfter !== null && npcAfter !== undefined && npcAfter <= 0) || (nextPhase >= phasesTotal);\n      if (willFinish) {\n        setFinished(true);\n        setRunning(false);\n        updateDailyGoalProgress(hero.id, 'quest-completed', 1);\n        const r = (hero.rankData?.currentRank || hero.rank || 'F');\n        const low = r === 'F' || r === 'E';\n        const mid = r === 'D';\n        const cdMin = (quest.difficulty === 'rapida' ? (low ? 3 : mid ? 6 : 10) : (quest.difficulty === 'padrao' ? (low ? 8 : mid ? 12 : 20) : (low ? 20 : mid ? 30 : 50)));\n        let endsMs = Date.now() + cdMin * 60 * 1000;\n        if (help && help.reduceCooldownMinutes) {\n          endsMs = Math.max(Date.now(), endsMs - (help.reduceCooldownMinutes * 60 * 1000));\n        }\n        const ends = new Date(endsMs).toISOString();\n        updateHero(hero.id, { questing: { ...(hero.questing || {}), cooldownEndsAt: ends, lastCompletedAt: new Date().toISOString() } });\n        if (help && help.missionsRemaining) {\n          const next = { ...help, missionsRemaining: Math.max(0, (help.missionsRemaining || 0) - 1) };\n          if (next.missionsRemaining <= 0) {\n            const stats = { ...(hero.stats || {}) } as any;\n            delete stats.helpStatus;\n            updateHero(hero.id, { stats });\n          } else {\n            const stats = { ...(hero.stats || {}) } as any;\n            stats.helpStatus = next;\n            updateHero(hero.id, { stats });\n          }\n        }\n        if ((quest.difficulty === 'rapida') && !anyLoot) {\n          const consolation = category === 'coleta' ? 'erva-sangue' : 'osso-antigo';\n          addItemToInventory(hero.id, consolation, 1);\n        }\n        // Ajuste de relao com lder NPC conforme resultado desta misso\n        if (party) {\n          const leader = useHeroStore.getState().heroes.find(h => h.id === party.leaderId);\n          if (leader && leader.origin === 'npc') {\n            const rel = { ...(leader.socialRelations || {}) };\n            const delta = success ? 3 : -2;\n            rel[hero.id] = Math.max(-100, Math.min(100, (rel[hero.id] || 0) + delta));\n            useHeroStore.getState().updateHero(leader.id, { socialRelations: rel });\n          }\n        }\n        if (party && party.contractByHeroId && party.contractByHeroId[hero.id]) {\n          consumeOneMissionContract(party.id, hero.id);\n        }\n      }\n      persistState(Math.min(nextPhase, phasesTotal), npcAfter, !willFinish, willFinish, nextLogs.map(e => ({ phase: e.phase, xp: (e as any).xp || 0, gold: (e as any).gold || 0, narrative: (e as any).narrative || '' })));\n    };\n\n    useEffect(() => {\n      if (running && autoRun && !finished) {\n        const t = setTimeout(() => { resolvePhase(); }, 500);\n        return () => clearTimeout(t);\n      }\n    }, [running, autoRun, finished, phaseIndex]);\n\n    return (\n      <div className=\"mt-4 p-4 border rounded bg-gray-800 border-gray-700\">\n        <div className=\"text-white font-semibold\">Execuo da Misso  {biome}</div>\n        <div className=\"text-gray-300 text-sm\">Fases: {phasesTotal}  Dificuldade: {quest.difficulty}</div>\n        {!running && !finished && (\n          <div className=\"mt-3\">\n            <button onClick={start} disabled={cdActiveQ} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50\">Iniciar</button>\n            <button onClick={() => setAutoRun(v => !v)} className={`ml-2 px-3 py-2 rounded ${autoRun ? 'bg-teal-600' : 'bg-teal-700'} text-white hover:bg-teal-500`}>{autoRun ? 'Auto: ON' : 'Auto: OFF'}</button>\n            {cdActiveQ && <div className=\"mt-2 text-sm text-amber-300\">Cooldown ativo: aguarde {formatRemaining(cdMsQ)}.</div>}\n            {error && <div className=\"mt-2 text-sm text-red-300\">{error}</div>}\n          </div>\n        )}\n        {running && (\n          <div className=\"mt-3\">\n            <div className=\"text-gray-200\">Fase {Math.min(phasesTotal, (log?.length || 0) + 1)} de {phasesTotal}</div>\n            {npcIntegrity !== null && <div className=\"text-gray-400 text-xs\">Integridade do NPC: {npcIntegrity}%</div>}\n            <div className=\"mt-2 flex gap-2\">\n              <button onClick={resolvePhase} className=\"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700\">Prosseguir</button>\n              <button onClick={() => setAutoRun(v => !v)} className={`px-3 py-2 rounded ${autoRun ? 'bg-teal-600' : 'bg-teal-700'} text-white hover:bg-teal-500`}>{autoRun ? 'Auto: ON' : 'Auto: OFF'}</button>\n            </div>\n            <div className=\"mt-2 text-sm text-gray-400\">Multiplicador atual: x{computeRewardMultiplier(streak).toFixed(2)}</div>\n          </div>\n        )}\n        {log.length > 0 && (\n          <div className=\"mt-4\">\n            <div className=\"text-white font-semibold\">Registro</div>\n            <ul className=\"mt-2 text-sm text-gray-300 list-disc pl-5\">\n              {log.map(r => (\n                <li key={r.phase}>Fase {r.phase}: {r.narrative}  +{r.xp} XP, +{r.gold} ouro{r.itemsAwarded && r.itemsAwarded.length ? `  Loot` : ''}</li>\n              ))}\n            </ul>\n          </div>\n        )}\n        {finished && (\n          <ConcludeButton heroId={hero.id} questId={quest.id} onConcluded={() => { setRunning(false); setFinished(true); }} />\n        )}\n      </div>\n    );\n  };\n\n  const renderQuestCard = (quest: Quest, isActive = false, isCompleted = false) => (\n    <div data-testid=\"quest-card\" className=\"bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-amber-500 transition-all\">\n      <div className=\"flex items-start justify-between mb-4\">\n        <div className=\"flex items-center space-x-3\">\n          <span className=\"text-2xl\">{getTypeIcon(quest.type)}</span>\n          <div>\n            <h3 className=\"text-xl font-bold text-white\">{quest.title}</h3>\n            <div className=\"flex items-center space-x-2 mt-1\">\n              <span className={`px-2 py-1 rounded-md text-xs font-medium ${getDifficultyColor(quest.difficulty)}`}>\n                {getDifficultyLabel(quest.difficulty)}\n              </span>\n              <span className=\"text-gray-400 text-sm\">Nvel {quest.levelRequirement}+</span>\n              {quest.isGuildQuest && (\n                <span className=\"px-2 py-1 rounded-md text-xs font-medium bg-purple-900/30 text-purple-300 border border-purple-600/30 flex items-center gap-1\">\n                   Guilda <span className=\"text-emerald-300\"></span>\n                </span>\n              )}\n              {(() => {\n                try {\n                  const ids = (quest.rewards?.items || []).map(i => (typeof (i as any) === 'string' ? (i as any) : (i as any).id));\n                  const set = new Set(['racao-basica','racao-deluxe','pedra-alma','pedra-magica','essencia-vinculo','essencia-bestial','pergaminho-montaria','essencia-calor','brasas-magicas']);\n                  const has = ids.some(id => set.has(id));\n                  return has ? (<span className=\"px-2 py-1 rounded-md text-xs font-medium bg-emerald-900/30 text-emerald-300 border border-emerald-600/30 flex items-center gap-1\"> Companheiros</span>) : null;\n                } catch { return null; }\n              })()}\n              {(() => {\n                try {\n                  const hero = getSelectedHero();\n                  if (!hero) return null;\n                  const inv = hero.inventory.items || {} as Record<string, number>;\n                  let pct = 0;\n                  if (String(quest.id).startsWith('companion-')) {\n                    const parts = String(quest.id).split('-');\n                    const target = parts[1];\n                    pct = (inv[target] || 0) > 0 ? 100 : 0;\n                  } else {\n                    const compSet = new Set(['racao-basica','racao-deluxe','pedra-alma','pedra-magica','essencia-vinculo','essencia-bestial','pergaminho-montaria','essencia-calor','brasas-magicas']);\n                    const rewardIds = (quest.rewards?.items || []).map(i => (typeof (i as any) === 'string' ? (i as any) : (i as any).id)).filter(id => compSet.has(id));\n                    const total = rewardIds.length;\n                    const have = rewardIds.filter(id => (inv[id] || 0) > 0).length;\n                    pct = total > 0 ? Math.round((have / total) * 100) : 0;\n                  }\n                  return (\n                    <span className=\"px-2 py-1 rounded-md text-xs font-medium bg-indigo-900/30 text-indigo-300 border border-indigo-600/30 flex items-center gap-1\">Progresso {pct}%</span>\n                  );\n                } catch { return null; }\n              })()}\n              {(() => {\n                const d = quest.difficulty;\n                const phases = quest.phasesHint ?? (d === 'epica' ? 6 : (d === 'padrao' ? 4 : 3));\n                const cls = d === 'epica'\n                  ? 'bg-purple-900/30 text-purple-300 border border-purple-600/30'\n                  : d === 'padrao'\n                    ? 'bg-amber-900/30 text-amber-300 border border-amber-600/30'\n                    : 'bg-green-900/30 text-green-300 border border-green-600/30';\n                const reason = quest.phasesHint\n                  ? 'definido pela misso'\n                  : (d === 'epica' ? 'dificuldade pica' : d === 'padrao' ? 'dificuldade padro' : 'dificuldade rpida');\n                return (\n                  <span className={`px-2 py-1 rounded-md text-xs font-medium ${cls}`} title={`Estimativa de ${phases} fases (${reason}).`}>\n                    Fases previstas: {phases}\n                  </span>\n                );\n              })()}\n            </div>\n          </div>\n        </div>\n        {typeof quest.timeLimit === 'number' && (\n          <div className=\"text-right\">\n            <span className=\"text-red-400 text-sm\">\n               {quest.timeLimit >= 60 ? `${Math.round(quest.timeLimit / 60)} h` : `${quest.timeLimit} min`}\n            </span>\n          </div>\n        )}\n      </div>\n\n      <p className=\"text-gray-300 mb-4\">{quest.description}</p>\n\n      {quest.objectives && quest.objectives.length > 0 && (\n        <div className=\"mb-4\">\n          <h4 className=\"text-amber-400 font-medium mb-2\">Objetivos:</h4>\n          <ul className=\"space-y-1\">\n            {quest.objectives.map((objective, index) => (\n              <li key={index} className=\"text-gray-300 text-sm flex items-center space-x-2\">\n                <span className=\"text-amber-400\"></span>\n                <span>{objective}</span>\n              </li>\n            ))}\n          </ul>\n        </div>\n      )}\n\n      <div className=\"border-t border-gray-700 pt-4\">\n        <h4 className=\"text-amber-400 font-medium mb-2\">Recompensas:</h4>\n        <div className=\"flex items-center space-x-4 text-sm\">\n          <span className=\"flex items-center space-x-1\">\n            <span></span>\n            <span>{quest.rewards?.gold || 0} ouro</span>\n          </span>\n          <span className=\"flex items-center space-x-1\">\n            <span></span>\n            <span>{quest.rewards?.xp || 0} XP</span>\n          </span>\n          {quest.rewards?.items && quest.rewards.items.length > 0 && (\n            <span className=\"flex items-center space-x-2\">\n              {quest.rewards.items.map(({ id, qty }, idx) => {\n                const it = SHOP_ITEMS.find(s => s.id === id);\n                const r = it?.rarity;\n                const c = r === 'lendario' ? 'text-amber-300' : r === 'epico' ? 'text-purple-300' : r === 'raro' ? 'text-blue-300' : r === 'incomum' ? 'text-green-300' : 'text-gray-300';\n                return (\n                  <span key={`${id}-${idx}`} className={`flex items-center gap-1 ${c}`}>\n                    <span>{it?.icon || ''}</span>\n                    <span>{id} x{qty || 1}</span>\n                  </span>\n                );\n              })}\n            </span>\n          )}\n        </div>\n      </div>\n\n      <div className=\"mt-4 flex justify-end\">\n        {(() => {\n          const alreadyCompleted = selectedHero.completedQuests.includes(quest.id);\n          if (!isActive && !isCompleted && !alreadyCompleted) return (\n          <button\n            onClick={() => handleAcceptQuest(quest)}\n            disabled={!canAcceptQuest(quest)}\n            className={`px-4 py-2 rounded-md font-medium transition-colors ${\n              canAcceptQuest(quest)\n                ? 'bg-green-600 hover:bg-green-700 text-white'\n                : 'bg-gray-600 text-gray-400 cursor-not-allowed'\n            }`}\n          >\n            {canAcceptQuest(quest) ? 'Aceitar Misso' : (cdActive ? `Aguarde recarga (${formatRemaining(cdMs)})` : 'Requisitos no atendidos')}\n          </button>\n          );\n          if (alreadyCompleted && !isActive) return (\n            <span className=\"px-4 py-2 bg-gray-700 rounded-md font-medium text-gray-300\"> J concluda</span>\n          );\n          return null;\n        })()}\n        {isActive && (quest.type === 'caca' || quest.categoryHint === 'escolta') && (\n          <span className=\"px-2 py-1 rounded-md text-xs font-medium bg-green-900/30 text-green-300 border border-green-600/30\">Execuo por fases</span>\n        )}\n        {/* Boto de completar misso removido conforme solicitado */}\n        {isCompleted && (\n          <span className=\"px-4 py-2 bg-gray-600 rounded-md font-medium text-gray-300\">\n             Concluda\n          </span>\n        )}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      {(() => {\n        try {\n          const currentRank = selectedHero.rankData?.currentRank || 'F';\n          const raw = localStorage.getItem('heroforge-onboarding');\n          const st = raw ? JSON.parse(raw) : {};\n          const steps: string[] = Array.isArray(st?.validatedSteps) ? st.validatedSteps : [];\n          const hasTraining = localStorage.getItem('hfn_training_basic_done') === '1';\n          const basicsMastered = steps.includes('create-hero') && steps.includes('accept-quest') && hasTraining;\n          if (currentRank === 'F' && !basicsMastered) {\n            return (\n              <div className=\"mb-6 p-3 rounded-lg bg-amber-900/20 border border-amber-600/40 text-amber-200 text-sm flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\"><span> Quadro de Misses bloqueado no Rank F.</span><span className=\"font-semibold\">Conclua o treinamento e aceite sua primeira misso.</span></div>\n                <a href=\"/training\" className=\"px-2 py-1 rounded bg-amber-600 hover:bg-amber-700 text-black text-xs\">Treinar</a>\n              </div>\n            );\n          }\n        } catch {}\n        return null;\n      })()}\n      {cdActive && (\n        <div className=\"mb-4 p-3 rounded-lg bg-amber-900/20 border border-amber-600/40 text-amber-200 text-sm\">\n           Cooldown de misses ativo: aguarde {formatRemaining(cdMs)} para aceitar ou iniciar uma nova misso.\n        </div>\n      )}\n      <div className=\"flex items-center justify-between mb-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold text-amber-400\">Quadro de Misses {companionsOnly && <span className=\"ml-2 text-sm px-2 py-1 rounded bg-emerald-800/40 text-emerald-200 border border-emerald-600/40\">Companheiros ({availableQuests.filter(q => q.isGuildQuest).length})</span>}</h2>\n          <div className=\"mt-1 text-sm text-gray-300\">Novas misses a cada 1h  Rpidas (510 min)  picas (2540 min)</div>\n        </div>\n      <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleManualRefresh}\n            disabled={refreshCooldownEndsAt ? Date.now() < refreshCooldownEndsAt : false}\n            className={`px-3 py-2 rounded-md font-medium transition-colors ${refreshCooldownEndsAt && Date.now() < refreshCooldownEndsAt ? 'bg-gray-700 text-gray-400 cursor-not-allowed' : 'bg-gray-600 text-white hover:bg-gray-500'}`}\n            title={refreshCooldownEndsAt && Date.now() < refreshCooldownEndsAt ? `Aguarde ${Math.max(0, Math.ceil(((refreshCooldownEndsAt - Date.now())/60000)))} min` : 'Atualizar lista de misses'}\n          >\n            Atualizar Misses\n          </button>\n          <button\n            onClick={() => setCompanionsOnly(v => { try { localStorage.setItem('questboard_companions_only', v ? '0' : '1'); } catch {}; return !v; })}\n            className={`px-3 py-2 rounded-md font-medium transition-colors ${companionsOnly ? 'bg-emerald-600 text-white' : 'bg-gray-700 text-gray-200 hover:bg-gray-600'}`}\n            title=\"Mostrar apenas misses de companheiros\"\n          >\n             Companheiros {companionsOnly ? '' : ''}\n          </button>\n          {selectedHero && (selectedHero.activeQuests.length > 0) && (\n            <button\n              onClick={() => { clearActiveQuests(selectedHero.id); refreshQuests(selectedHero.progression.level); }}\n              className=\"px-3 py-2 rounded-md font-medium transition-colors bg-red-600 text-white hover:bg-red-700\"\n              title=\"Remover todas as misses ativas\"\n            >\n              Abandonar Todas\n            </button>\n          )}\n        </div>\n      </div>\n\n      {(() => {\n        const bannerQuest = availableQuests.find(q => q.isGuildQuest && q.sticky && String(q.id).startsWith('companion-'));\n        if (!bannerQuest) return null;\n        return (\n          <div className=\"mb-6 p-3 rounded-lg bg-emerald-900/30 border border-emerald-600/30 text-emerald-200 text-sm flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\"><span> Nova Misso de Companheiros adicionada:</span><span className=\"font-semibold\">{bannerQuest.title}</span></div>\n            <div className=\"flex items-center gap-2\">\n              <a href=\"#\" className=\"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-xs\" onClick={(e) => { e.preventDefault(); setSelectedTab('available'); }}>Ver</a>\n              <button className=\"px-2 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-xs\" onClick={() => { handleAcceptQuest(bannerQuest); setSelectedTab('active'); }}>Aceitar agora</button>\n            </div>\n          </div>\n        );\n      })()}\n\n      {/* Tabs */}\n      <div className=\"flex space-x-1 mb-6 bg-gray-800 p-1 rounded-lg\">\n        <button\n          onClick={() => setSelectedTab('available')}\n          className={`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${\n            selectedTab === 'available'\n              ? 'bg-amber-600 text-white'\n              : 'text-gray-400 hover:text-white'\n          }`}\n        >\n          Disponveis ({availableQuests.length})\n        </button>\n        {/* Aba Narrativas removida */}\n        <button\n          onClick={() => setSelectedTab('active')}\n          className={`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${\n            selectedTab === 'active'\n              ? 'bg-amber-600 text-white'\n              : 'text-gray-400 hover:text-white'\n          }`}\n        >\n          Ativas ({selectedHero.activeQuests.length})\n        </button>\n        <button\n          onClick={() => setSelectedTab('completed')}\n          className={`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${\n            selectedTab === 'completed'\n              ? 'bg-amber-600 text-white'\n              : 'text-gray-400 hover:text-white'\n          }`}\n        >\n          Concludas ({selectedHero.completedQuests.length})\n        </button>\n      </div>\n\n      {/* Quest Content */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {selectedTab === 'available' && availableUniq\n          .filter(q => !selectedHero.activeQuests.includes(q.id))\n          .filter(q => !(selectedHero.completedQuests || []).includes(q.id))\n          .filter(q => (companionsOnly ? q.isGuildQuest : true))\n          .map(quest => (\n            <React.Fragment key={`available-${quest.id}`}>\n              {renderQuestCard(quest)}\n            </React.Fragment>\n          ))}\n        {/* Contedo Narrativas removido */}\n        {selectedTab === 'active' && activeIdsUniq\n          .map(id => getQuestById(id) || availableUniq.find(q => q.id === id))\n          .filter((q): q is Quest => !!q)\n          .map((q, idx) => (\n            <div key={`active-${q.id}-${idx}`}>\n              {renderQuestCard(q, true)}\n              {selectedHero && (\n                <ActiveMissionRunner key={`runner-${q.id}`} hero={selectedHero} quest={q} />\n              )}\n              {selectedHero && !(q.type === 'caca' || q.categoryHint === 'escolta') && (\n                <AutoCompleteMission key={`auto-${q.id}`} hero={selectedHero} quest={q} />\n              )}\n              <div className=\"mt-2 flex justify-end\">\n                <button onClick={() => abandonQuest(selectedHero!.id, q.id)} className=\"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700\">Abandonar</button>\n              </div>\n            </div>\n          ))}\n        {selectedTab === 'completed' && completedIdsUniq\n          .map(id => getQuestById(id) || availableUniq.find(q => q.id === id))\n          .filter((q): q is Quest => !!q)\n          .map((q, idx) => (\n            <React.Fragment key={`completed-${q.id}-${idx}`}>\n              {renderQuestCard(q, false, true)}\n            </React.Fragment>\n          ))}\n      </div>\n\n      {selectedTab === 'available' && availableQuests.length === 0 && (\n        <div className=\"text-center p-8\">\n          <p className=\"text-gray-400\">Nenhuma misso disponvel no momento.</p>\n          <button\n            onClick={() => {\n              console.log(' Gerando novas misses para heri:', selectedHero?.name, 'Level:', selectedHero?.progression.level);\n              refreshQuests(selectedHero?.progression.level || 1);\n            }}\n            className=\"mt-4 px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded-md font-medium transition-colors\"\n          >\n            Gerar Novas Misses\n          </button>\n        </div>\n      )}\n\n      {selectedTab === 'active' && selectedHero.activeQuests.length === 0 && (\n        <div className=\"text-center p-8\">\n          <p className=\"text-gray-400\">Voc no tem misses ativas.</p>\n        </div>\n      )}\n\n      {selectedTab === 'completed' && selectedHero.completedQuests.length === 0 && (\n        <div className=\"text-center p-8\">\n          <p className=\"text-gray-400\">Voc ainda no completou nenhuma misso.</p>\n        </div>\n      )}\n\n      {/* Mensagens de estado de narrativas removidas */}\n\n      {/* Modal narrativo removido */}\n    </div>\n  );\n};\n\nconst ConcludeButton: React.FC<{ heroId: string; questId: string; onConcluded?: () => void }> = ({ heroId, questId, onConcluded }) => {\n  const completeQuest = useHeroStore(s => s.completeQuest);\n  const updateHero = useHeroStore(s => s.updateHero);\n  const heroes = useHeroStore(s => s.heroes);\n  const [busy, setBusy] = React.useState(false);\n  const handle = async () => {\n    if (busy) return;\n    setBusy(true);\n    try {\n      completeQuest(heroId, questId, false);\n      const current = heroes.find(h => h.id === heroId);\n      if (current) {\n        const getQuestById = useHeroStore.getState().getQuestById;\n        const q = getQuestById(questId);\n        const r = (current.rankData?.currentRank || current.rank || 'F');\n        const low = r === 'F' || r === 'E';\n        const mid = r === 'D';\n        const cdMin = (q && q.difficulty === 'rapida' ? (low ? 3 : mid ? 6 : 10) : (q && q.difficulty === 'padrao' ? (low ? 8 : mid ? 12 : 20) : (low ? 20 : mid ? 30 : 50)));\n        const ends = new Date(Date.now() + cdMin * 60 * 1000).toISOString();\n        updateHero(heroId, { questing: { ...(current.questing || {}), cooldownEndsAt: ends, lastCompletedAt: new Date().toISOString() } });\n      }\n      onConcluded?.();\n    } finally {\n      setBusy(false);\n    }\n  };\n  return (\n    <div className=\"mt-3\">\n      <div className=\"text-sm text-gray-200\">Misso finalizada.</div>\n      <button onClick={handle} disabled={busy} className={`mt-2 px-3 py-2 rounded ${busy ? 'bg-gray-600 text-gray-300 cursor-not-allowed' : 'bg-blue-600 text-white hover:bg-blue-700'}`}>{busy ? 'Concluindo...' : 'Concluir Oficialmente'}</button>\n    </div>\n  );\n};\n\nexport default QuestBoard;\n\nconst AutoCompleteMission: React.FC<{ hero: Hero; quest: Quest }> = ({ hero, quest }) => {\n  const completeQuest = useHeroStore(s => s.completeQuest);\n  const updateHero = useHeroStore(s => s.updateHero);\n  const [started, setStarted] = React.useState(false);\n  React.useEffect(() => {\n    if (started) return;\n    try {\n      const stAll = { ...(((hero.stats as any)?.missionRunState) || {}) } as Record<string, any>;\n      const k = String(quest.id);\n      const st = stAll[k];\n      if (st?.finished || st?.running) return;\n      stAll[k] = { phase: 0, running: true, finished: false, logs: [] };\n      updateHero(hero.id, { stats: { ...hero.stats, missionRunState: stAll } });\n      setStarted(true);\n      setTimeout(() => {\n        completeQuest(hero.id, quest.id, false);\n        const r = (hero.rankData?.currentRank || hero.rank || 'F');\n        const low = r === 'F' || r === 'E';\n        const mid = r === 'D';\n        const cdMin = (quest.difficulty === 'rapida' ? (low ? 3 : mid ? 6 : 10) : (quest.difficulty === 'padrao' ? (low ? 8 : mid ? 12 : 20) : (low ? 20 : mid ? 30 : 50)));\n        const ends = new Date(Date.now() + cdMin * 60 * 1000).toISOString();\n        updateHero(hero.id, { questing: { ...(hero.questing || {}), cooldownEndsAt: ends, lastCompletedAt: new Date().toISOString() } });\n      }, 100);\n    } catch {}\n  }, [hero.id, quest.id, started]);\n  return (\n    <div className=\"mt-2 text-xs text-gray-400\">Finalizando misso...</div>\n  );\n};\n","import React, { useRef, useState, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { useHeroStore } from '../store/heroStore';\nimport { trackMetric } from '../utils/metricsSystem';\nimport { Title } from '../types/hero';\nimport { \n  getTitlesByCategory, \n  getTitlesByRarity, \n  getActiveTitle, \n  formatTitleDisplay,\n  getRarityColor,\n  getRarityBg\n} from '../utils/titles';\nimport { getTitleAttributeBonus, AVAILABLE_TITLES } from '../utils/titles';\nimport { generateDynamicTitleForHero } from '../services/titleAIService';\n\nconst TitlesManager: React.FC = () => {\n  const { getSelectedHero, setActiveTitle, addTitleToSelectedHero, toggleFavoriteTitle } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const [selectedCategory, setSelectedCategory] = useState<'all' | Title['category']>('all');\n  const [selectedRarity, setSelectedRarity] = useState<'all' | Title['rarity']>('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [generating, setGenerating] = useState(false);\n  const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);\n  const [showNewOnly, setShowNewOnly] = useState(false);\n  const [sortMode, setSortMode] = useState<'name' | 'rarity' | 'recent' | 'favoritesFirst'>('favoritesFirst');\n  const [suggestedTitleId, setSuggestedTitleId] = useState<string | null>(null);\n  const [toastMessage, setToastMessage] = useState<string | null>(null);\n  const toastTimerRef = useRef<number | null>(null);\n  const [celebration, setCelebration] = useState<string | null>(null);\n  const [celebrationTitle, setCelebrationTitle] = useState<Title | null>(null);\n  const prevTitlesRef = useRef<string[]>(selectedHero?.titles?.map(t => t.id) || []);\n  const location = useLocation();\n  useEffect(() => {\n    try {\n      const p = new URLSearchParams(location.search);\n      const q = p.get('q') || '';\n      const fav = p.get('fav');\n      const cat = p.get('category') as any;\n      const rar = p.get('rarity') as any;\n      const sort = p.get('sort') as any;\n      const nw = p.get('new');\n      if (q) setSearchTerm(q);\n      if (fav) setShowFavoritesOnly(fav === '1');\n      if (nw) setShowNewOnly(nw === '1');\n      if (cat) setSelectedCategory(cat);\n      if (rar) setSelectedRarity(rar);\n      if (sort) setSortMode(sort);\n    } catch {}\n  }, [location.search]);\n\n  if (!selectedHero) {\n    return (\n      <div className=\"text-center p-8\">\n        <h2 className=\"text-2xl font-bold text-amber-400 mb-4\">Selecione um Heri</h2>\n        <p className=\"text-gray-300\">Voc precisa selecionar um heri para gerenciar ttulos.</p>\n      </div>\n    );\n  }\n\n  const activeTitle = getActiveTitle(selectedHero);\n\n  // Filtrar ttulos\n  let filteredTitles = selectedHero.titles;\n\n  if (selectedCategory !== 'all') {\n    filteredTitles = getTitlesByCategory(filteredTitles, selectedCategory);\n  }\n\n  if (selectedRarity !== 'all') {\n    filteredTitles = getTitlesByRarity(filteredTitles, selectedRarity);\n  }\n\n  if (searchTerm) {\n    filteredTitles = filteredTitles.filter(title =>\n      title.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      title.description.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  }\n\n  if (showFavoritesOnly) {\n    filteredTitles = filteredTitles.filter(t => t.favorite);\n  }\n  if (showNewOnly) {\n    const cutoff = Date.now() - 24 * 60 * 60 * 1000;\n    filteredTitles = filteredTitles.filter(t => new Date(t.unlockedAt).getTime() >= cutoff);\n  }\n\n  const rarityRank: Record<Title['rarity'], number> = {\n    comum: 1,\n    raro: 2,\n    epico: 3,\n    lendario: 4,\n    especial: 5\n  } as const;\n\n  filteredTitles = [...filteredTitles].sort((a, b) => {\n    switch (sortMode) {\n      case 'name':\n        return a.name.localeCompare(b.name, 'pt-BR');\n      case 'rarity':\n        return (rarityRank[b.rarity] - rarityRank[a.rarity]) || a.name.localeCompare(b.name, 'pt-BR');\n      case 'recent':\n        return new Date(b.unlockedAt).getTime() - new Date(a.unlockedAt).getTime();\n      case 'favoritesFirst':\n      default:\n        return (Number(!!b.favorite) - Number(!!a.favorite))\n          || (rarityRank[b.rarity] - rarityRank[a.rarity])\n          || a.name.localeCompare(b.name, 'pt-BR');\n    }\n  });\n\n  \n\n  const suggestBestTitle = () => {\n    let bestId: string | null = null;\n    let bestScore = -Infinity;\n    selectedHero.titles.forEach(t => {\n      const bonus = getTitleAttributeBonus(t.id);\n      const bonusSum = Object.values(bonus).reduce((acc, v) => acc + (typeof v === 'number' ? v : 0), 0);\n      const recentBoost = Date.now() - new Date(t.unlockedAt).getTime() < 24 * 60 * 60 * 1000 ? 1 : 0;\n      const score = ((rarityRank as any)[t.rarity] || 0) * 10 + bonusSum * 2 + recentBoost;\n      if (score > bestScore) {\n        bestScore = score;\n        bestId = t.id;\n      }\n    });\n    if (bestId) {\n      setSuggestedTitleId(bestId);\n      if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n      const t = selectedHero.titles.find(x => x.id === bestId);\n      setToastMessage(t ? `Sugesto: ${t.name}` : 'Sugesto disponvel');\n      toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n      try { trackMetric.featureUsed(selectedHero.id, 'titles-suggest-best'); } catch {}\n    }\n  };\n\n  const equipSuggested = () => {\n    if (!suggestedTitleId) return;\n    setActiveTitle(suggestedTitleId);\n    const t = selectedHero.titles.find(x => x.id === suggestedTitleId);\n    if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n    setToastMessage(t ? `Equipado: ${t.name}` : 'Sugesto equipada');\n    toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n    try { trackMetric.featureUsed(selectedHero.id, 'titles-equip-suggestion'); } catch {}\n  };\n\n  React.useEffect(() => {\n    const currentIds = selectedHero.titles.map(t => t.id);\n    const prevIds = prevTitlesRef.current;\n    const added = currentIds.filter(id => !prevIds.includes(id));\n    if (added.length) {\n      const addedTitle = selectedHero.titles.find(t => t.id === added[0]);\n      if (addedTitle) {\n        if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n        setToastMessage(`Novo ttulo desbloqueado: ${addedTitle.name}`);\n        if (addedTitle.rarity === 'epico' || addedTitle.rarity === 'lendario') {\n          setCelebration('');\n          setCelebrationTitle(addedTitle);\n        }\n        toastTimerRef.current = window.setTimeout(() => {\n          setToastMessage(null);\n          setCelebration(null);\n          setCelebrationTitle(null);\n        }, 2500);\n      }\n    }\n    prevTitlesRef.current = currentIds;\n  }, [selectedHero.titles.length]);\n\n  const handleSetActiveTitle = (titleId: string) => {\n    setActiveTitle(titleId);\n    const t = selectedHero.titles.find(t => t.id === titleId);\n    const msg = t ? `Ttulo equipado: ${t.name}` : 'Ttulo equipado';\n    if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n    setToastMessage(msg);\n    toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n    try { trackMetric.featureUsed(selectedHero.id, 'titles-equip'); } catch {}\n  };\n\n  const handleRemoveActiveTitle = () => {\n    setActiveTitle(undefined);\n    if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n    setToastMessage('Ttulo removido');\n    toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n    try { trackMetric.featureUsed(selectedHero.id, 'titles-remove'); } catch {}\n  };\n\n  const handleGenerateAITitle = async () => {\n    if (!selectedHero || generating) return;\n    try {\n      setGenerating(true);\n      const newTitle = await generateDynamicTitleForHero(selectedHero);\n      addTitleToSelectedHero(newTitle, true);\n      if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n      setToastMessage(`Ttulo gerado: ${newTitle.name}`);\n      toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2500);\n      try { trackMetric.featureUsed(selectedHero.id, 'titles-generate-ai'); } catch {}\n    } catch (err) {\n      console.error('Falha ao gerar ttulo por IA:', err);\n      alert('No foi possvel gerar um ttulo por IA agora. Tente novamente em instantes.');\n    } finally {\n      setGenerating(false);\n    }\n  };\n\n  const getCategoryIcon = (category: Title['category']) => {\n    switch (category) {\n      case 'combat': return '';\n      case 'exploration': return '';\n      case 'social': return '';\n      case 'achievement': return '';\n      case 'special': return '';\n      default: return '';\n    }\n  };\n\n  const getCategoryName = (category: Title['category']) => {\n    switch (category) {\n      case 'combat': return 'Combate';\n      case 'exploration': return 'Explorao';\n      case 'social': return 'Social';\n      case 'achievement': return 'Conquistas';\n      case 'special': return 'Especial';\n      default: return 'Outros';\n    }\n  };\n\n  const getRarityName = (rarity: Title['rarity']) => {\n    switch (rarity) {\n      case 'comum': return 'Comum';\n      case 'raro': return 'Raro';\n      case 'epico': return 'pico';\n      case 'lendario': return 'Lendrio';\n      case 'especial': return 'Especial';\n      default: return 'Desconhecido';\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      {toastMessage && (\n        <div className=\"fixed right-6 top-6 z-50 bg-gray-900 border border-gray-700 text-white px-4 py-2 rounded-md shadow\">\n          {toastMessage}\n        </div>\n      )}\n      {celebration && celebrationTitle && (\n        <div className=\"fixed inset-0 z-40 flex items-center justify-center\">\n          <div className=\"pointer-events-auto bg-gray-900/90 border border-amber-600 text-white px-6 py-4 rounded-xl shadow-xl\">\n            <div className=\"text-5xl text-amber-400 text-center\">{celebration}</div>\n            <div className=\"mt-2 text-center text-xl\">\n              <span className=\"mr-2 text-3xl\">{celebrationTitle.badge}</span>\n              <span>{celebrationTitle.name}</span>\n            </div>\n            <div className=\"mt-3 text-center\">\n              <button\n                onClick={() => {\n                  const shareText = `${formatTitleDisplay(selectedHero)}  novo ttulo conquistado!`;\n                  const shareUrl = `${window.location.origin}/hero/${selectedHero.id}`;\n                  if ((navigator as any).share) {\n                    (navigator as any).share({ title: 'HeroForge', text: shareText, url: shareUrl }).catch(() => {\n                      try { navigator.clipboard?.writeText(shareUrl); } catch {}\n                    });\n                  } else {\n                    try { navigator.clipboard?.writeText(shareUrl); } catch {}\n                    if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n                    setToastMessage('Link copiado para compartilhar');\n                    toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n                  }\n                  try { trackMetric.featureUsed(selectedHero.id, 'titles-share-celebration'); } catch {}\n                }}\n                className=\"px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded-md font-medium\"\n              >\n                Compartilhar\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-3xl font-bold text-amber-400\">Gerenciar Ttulos</h2>\n          <div className=\"flex items-center space-x-2 ml-4\">\n            <button\n              onClick={suggestBestTitle}\n              className=\"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-sm\"\n              title=\"Sugerir melhor ttulo\"\n            >\n              Sugerir Melhor\n            </button>\n            <button\n              onClick={equipSuggested}\n              disabled={!suggestedTitleId}\n              className={`px-3 py-2 rounded-md text-sm ${suggestedTitleId ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-700 cursor-not-allowed'}`}\n              title=\"Equipar sugesto\"\n            >\n              Equipar Sugesto\n            </button>\n            <button\n              onClick={() => {\n                const entries = selectedHero.titles.map(t => ({ id: t.id, favorite: !!t.favorite }));\n                const json = JSON.stringify(entries);\n                try { navigator.clipboard?.writeText(json); } catch {}\n                if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n                setToastMessage('Ttulos (com favoritos) exportados');\n                toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n                try { trackMetric.featureUsed(selectedHero.id, 'titles-export-favorites'); } catch {}\n              }}\n              className=\"px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-sm\"\n              title=\"Exportar ttulos\"\n            >\n              Exportar\n            </button>\n            <button\n              onClick={() => {\n                const input = window.prompt('Cole o JSON com IDs de ttulos');\n                if (!input) return;\n                try {\n                  const ids = JSON.parse(input);\n                  if (Array.isArray(ids)) {\n                    ids.forEach((entry: any) => {\n                      const id = typeof entry === 'string' ? entry : entry?.id;\n                      const fav = typeof entry === 'object' ? !!entry?.favorite : false;\n                      if (!id) return;\n                      const tpl = AVAILABLE_TITLES.find(t => t.id === id);\n                      if (tpl) {\n                        addTitleToSelectedHero({ ...tpl, unlockedAt: new Date() }, false);\n                        if (fav) toggleFavoriteTitle(id, true);\n                      }\n                    });\n                    if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n                    setToastMessage('Ttulos importados');\n                    toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n                    try { trackMetric.featureUsed(selectedHero.id, 'titles-import-favorites'); } catch {}\n                  }\n                } catch {}\n              }}\n              className=\"px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-sm\"\n              title=\"Importar ttulos\"\n            >\n              Importar\n            </button>\n          </div>\n        </div>\n        \n        {/* Ttulo Ativo */}\n        <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6\">\n          <h3 className=\"text-xl font-bold text-white mb-4\">Ttulo Ativo</h3>\n          {activeTitle ? (\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-4\">\n                <span className=\"text-4xl\">{activeTitle.badge}</span>\n                <div>\n                  <h4 className={`text-lg font-bold ${getRarityColor(activeTitle.rarity)}`}>\n                    {activeTitle.name}\n                  </h4>\n                  <p className=\"text-gray-300 text-sm\">{activeTitle.description}</p>\n                  <p className=\"text-amber-400 text-sm mt-1\">\n                    Como ser exibido: {formatTitleDisplay(selectedHero)}\n                  </p>\n                  {(() => {\n                    const medal = (selectedHero.stats as any)?.profileMedal;\n                    const valid = medal?.expiresAt ? Date.now() < new Date(medal.expiresAt).getTime() : false;\n                    if (!valid) return null;\n                    return (\n                      <div className=\"mt-2 text-xs text-amber-300 flex items-center gap-2\">\n                        <span>Medalha ativa:</span>\n                        <span className=\"flex items-center gap-1\">{medal.icon} {medal.name}</span>\n                        <span className=\"text-gray-400\">expira {new Date(medal.expiresAt).toLocaleDateString()}</span>\n                      </div>\n                    );\n                  })()}\n                  {/* Bnus passivos */}\n                  {(() => {\n                    const bonus = getTitleAttributeBonus(activeTitle.id);\n                    const entries = Object.entries(bonus).filter(([, v]) => typeof v === 'number' && v !== 0);\n                    if (!entries.length) return null;\n                    return (\n                      <div className=\"mt-2 text-xs text-gray-300\">\n                        <span className=\"font-semibold\">Bnus passivo:</span>{' '}\n                        {entries.map(([attr, val], idx) => (\n                          <span key={attr}>\n                            {attr} +{val}{idx < entries.length - 1 ? ', ' : ''}\n                          </span>\n                        ))}\n                      </div>\n                    );\n                  })()}\n\n                  {activeTitle && suggestedTitleId && (() => {\n                    const suggested = selectedHero.titles.find(t => t.id === suggestedTitleId);\n                    if (!suggested) return null;\n                    const a = getTitleAttributeBonus(activeTitle.id);\n                    const b = getTitleAttributeBonus(suggested.id);\n                    const keys = Array.from(new Set([ ...Object.keys(a), ...Object.keys(b) ]));\n                    const rows = keys.map(k => ({ k, av: Number((a as any)[k]||0), bv: Number((b as any)[k]||0), dv: Number((b as any)[k]||0) - Number((a as any)[k]||0) }));\n                    return (\n                      <div className=\"mt-3 text-xs\">\n                        <div className=\"font-semibold text-white mb-1\">Comparao com Sugesto</div>\n                        <div className=\"grid grid-cols-3 gap-2 text-gray-300\">\n                          <div className=\"font-medium\">Atributo</div>\n                          <div className=\"font-medium\">Ativo</div>\n                          <div className=\"font-medium\">Sugesto</div>\n                          {rows.map(r => (\n                            <React.Fragment key={r.k}>\n                              <div>{r.k}</div>\n                              <div className=\"text-gray-200\">{r.av >= 0 ? `+${r.av}` : `${r.av}`}</div>\n                              <div className={r.dv > 0 ? 'text-green-400' : r.dv < 0 ? 'text-red-400' : 'text-gray-200'}>\n                                {r.bv >= 0 ? `+${r.bv}` : `${r.bv}`} {r.dv !== 0 && <span className=\"ml-1\">({r.dv>0?'+':''}{r.dv})</span>}\n                              </div>\n                            </React.Fragment>\n                          ))}\n                        </div>\n                      </div>\n                    );\n                  })()}\n                </div>\n              </div>\n              <button\n                onClick={handleRemoveActiveTitle}\n                className=\"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md font-medium transition-colors\"\n              >\n                Remover Ttulo\n              </button>\n              <button\n                onClick={() => {\n                  try {\n                    const text = formatTitleDisplay(selectedHero);\n                    navigator.clipboard?.writeText(text);\n                    alert('Exibio copiada para a rea de transferncia');\n                  } catch {\n                    alert('No foi possvel copiar automaticamente. Copie manualmente: ' + formatTitleDisplay(selectedHero));\n                  }\n                }}\n                className=\"ml-3 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md font-medium transition-colors\"\n                title=\"Copiar exibio\"\n              >\n                Copiar Exibio\n              </button>\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <p className=\"text-gray-400 mb-4\">Nenhum ttulo ativo</p>\n              <p className=\"text-sm text-gray-500\">\n                Selecione um ttulo abaixo para exibi-lo em seu perfil\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Filtros */}\n      <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6\">\n        <h3 className=\"text-lg font-bold text-white mb-4\">Filtros</h3>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {/* Busca */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Buscar Ttulo\n            </label>\n            <input\n              type=\"text\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              placeholder=\"Nome ou descrio...\"\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500\"\n            />\n          </div>\n\n          {/* Categoria */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Categoria\n            </label>\n            <select\n              value={selectedCategory}\n              onChange={(e) => setSelectedCategory(e.target.value as any)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-amber-500\"\n            >\n              <option value=\"all\">Todas as Categorias</option>\n              <option value=\"combat\"> Combate</option>\n              <option value=\"exploration\"> Explorao</option>\n              <option value=\"social\"> Social</option>\n              <option value=\"achievement\"> Conquistas</option>\n              <option value=\"special\"> Especial</option>\n            </select>\n          </div>\n\n          {/* Raridade */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Raridade\n            </label>\n            <select\n              value={selectedRarity}\n              onChange={(e) => setSelectedRarity(e.target.value as any)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-amber-500\"\n            >\n              <option value=\"all\">Todas as Raridades</option>\n              <option value=\"comum\">Comum</option>\n              <option value=\"raro\">Raro</option>\n              <option value=\"epico\">pico</option>\n              <option value=\"lendario\">Lendrio</option>\n              <option value=\"especial\">Especial</option>\n            </select>\n          </div>\n\n          {/* Ordenao */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Ordenar por\n            </label>\n            <select\n              value={sortMode}\n              onChange={(e) => setSortMode(e.target.value as any)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-amber-500\"\n            >\n              <option value=\"favoritesFirst\">Favoritos primeiro</option>\n              <option value=\"rarity\">Raridade</option>\n              <option value=\"recent\">Mais recentes</option>\n              <option value=\"name\">Nome (AZ)</option>\n            </select>\n          </div>\n        </div>\n\n        <div className=\"mt-4 flex items-center space-x-3\">\n          <input\n            id=\"favOnly\"\n            type=\"checkbox\"\n            checked={showFavoritesOnly}\n            onChange={(e) => setShowFavoritesOnly(e.target.checked)}\n            className=\"h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-600 rounded\"\n          />\n          <label htmlFor=\"favOnly\" className=\"text-sm text-gray-300\">Mostrar apenas favoritos</label>\n          <input\n            id=\"newOnly\"\n            type=\"checkbox\"\n            checked={showNewOnly}\n            onChange={(e) => setShowNewOnly(e.target.checked)}\n            className=\"ml-4 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-600 rounded\"\n          />\n          <label htmlFor=\"newOnly\" className=\"text-sm text-gray-300\">Apenas novos (24h)</label>\n          <button\n            onClick={() => {\n              setSelectedCategory('all');\n              setSelectedRarity('all');\n              setSearchTerm('');\n              setShowFavoritesOnly(false);\n              setShowNewOnly(false);\n              setSortMode('favoritesFirst');\n            }}\n            className=\"ml-4 px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-sm\"\n            title=\"Limpar filtros\"\n          >\n            Limpar filtros\n          </button>\n        </div>\n      </div>\n\n      {/* Top 3 Ttulos (ranking por pontuao) */}\n      {selectedHero.titles.length > 0 && (\n        <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h3 className=\"text-lg font-bold text-white\">Top 3 Ttulos</h3>\n            <button\n              onClick={() => {\n                const items = [...selectedHero.titles]\n                  .map(t => {\n                    const bonus = getTitleAttributeBonus(t.id);\n                    const bonusSum = Object.values(bonus).reduce((acc, v) => acc + (typeof v === 'number' ? v : 0), 0);\n                    const recentBoost = Date.now() - new Date(t.unlockedAt).getTime() < 24 * 60 * 60 * 1000 ? 1 : 0;\n                    const score = (rarityRank[t.rarity] || 0) * 10 + bonusSum * 2 + recentBoost;\n                    return { id: t.id, score };\n                  })\n                  .sort((a, b) => b.score - a.score)\n                  .slice(0, 3);\n                items.forEach(i => toggleFavoriteTitle(i.id, true));\n                if (toastTimerRef.current) window.clearTimeout(toastTimerRef.current);\n                setToastMessage('Favoritos atualizados com Top 3');\n                toastTimerRef.current = window.setTimeout(() => setToastMessage(null), 2000);\n                try { trackMetric.featureUsed(selectedHero.id, 'titles-favorite-top3'); } catch {}\n              }}\n              className=\"px-3 py-2 bg-amber-600 hover:bg-amber-700 rounded-md text-sm\"\n            >\n              Favoritar Top 3\n            </button>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            {[...selectedHero.titles]\n              .map(t => {\n                const bonus = getTitleAttributeBonus(t.id);\n                const bonusSum = Object.values(bonus).reduce((acc, v) => acc + (typeof v === 'number' ? v : 0), 0);\n                const recentBoost = Date.now() - new Date(t.unlockedAt).getTime() < 24 * 60 * 60 * 1000 ? 1 : 0;\n                const score = (rarityRank[t.rarity] || 0) * 10 + bonusSum * 2 + recentBoost;\n                return { t, score };\n              })\n              .sort((a, b) => b.score - a.score)\n              .slice(0, 3)\n              .map(({ t, score }) => (\n                <div key={t.id} className=\"bg-gray-900 rounded-lg p-4 border border-gray-700\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <div className={`text-sm font-bold ${getRarityColor(t.rarity)}`}>{t.name}</div>\n                      <div className=\"text-xs text-gray-400\">Pontuao: {score}</div>\n                    </div>\n                    <div className=\"text-2xl\">{t.badge}</div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n\n      {/* Lista de Ttulos */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {filteredTitles.map(title => (\n          <div \n            key={title.id} \n            className={`bg-gray-800 rounded-lg p-6 border transition-all hover:border-amber-500 ${\n              activeTitle?.id === title.id ? 'border-amber-500 bg-amber-900/10 animate-pulse' : 'border-gray-700'\n            }`}\n          >\n            <div className=\"flex items-start justify-between mb-4\">\n              <div className=\"flex items-center space-x-3\">\n                <span className=\"text-3xl\">{title.badge}</span>\n                <div>\n                  <h4 className={`text-lg font-bold ${getRarityColor(title.rarity)}`}>\n                    {title.name}\n                  </h4>\n                  <div className=\"flex items-center space-x-2 mt-1\">\n                    <span className={`px-2 py-1 rounded-md text-xs font-medium ${getRarityColor(title.rarity)} ${getRarityBg(title.rarity)}`}>\n                      {getRarityName(title.rarity)}\n                    </span>\n                    {suggestedTitleId === title.id && (\n                      <span className=\"px-2 py-1 rounded-md text-xs font-medium bg-green-900/20 text-green-400\">\n                        Sugesto\n                      </span>\n                    )}\n                    {Date.now() - new Date(title.unlockedAt).getTime() < 24 * 60 * 60 * 1000 && (\n                      <span className=\"px-2 py-1 rounded-md text-xs font-medium bg-amber-900/20 text-amber-400\">\n                        Novo\n                      </span>\n                    )}\n                    <span className=\"text-gray-400 text-xs flex items-center space-x-1\">\n                      <span>{getCategoryIcon(title.category)}</span>\n                      <span>{getCategoryName(title.category)}</span>\n                    </span>\n                    {(() => {\n                      const bonus = getTitleAttributeBonus(title.id);\n                      const entries = Object.entries(bonus).filter(([, v]) => typeof v === 'number' && v !== 0).slice(0, 3);\n                      if (!entries.length) return null;\n                      return (\n                        <span className=\"text-gray-300 text-xs\">\n                          {entries.map(([attr, val], idx) => (\n                            <span key={attr} className=\"ml-1 px-1.5 py-0.5 bg-gray-700 rounded\">\n                              {attr} +{val}\n                            </span>\n                          ))}\n                        </span>\n                      );\n                    })()}\n                  </div>\n                </div>\n              </div>\n              <button\n                onClick={() => toggleFavoriteTitle(title.id)}\n                className={`ml-2 px-2 py-1 rounded-md text-xs font-medium ${title.favorite ? 'bg-amber-600 hover:bg-amber-700 text-black' : 'bg-gray-700 hover:bg-gray-600 text-white'} transition-colors`}\n                title={title.favorite ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}\n              >\n                {title.favorite ? ' Favorito' : ' Favoritar'}\n              </button>\n            </div>\n\n            <p className=\"text-gray-300 text-sm mb-4\">{title.description}</p>\n\n            <div className=\"text-xs text-gray-400 mb-4\">\n              Desbloqueado em: {new Date(title.unlockedAt).toLocaleDateString('pt-BR')}\n            </div>\n\n            <div className=\"flex justify-end\">\n              {activeTitle?.id === title.id ? (\n                <span className=\"px-4 py-2 bg-amber-600 rounded-md font-medium text-sm\">\n                   Ativo\n                </span>\n              ) : (\n                <button\n                  onClick={() => handleSetActiveTitle(title.id)}\n                  className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md font-medium text-sm transition-colors\"\n                >\n                  Equipar Ttulo\n                </button>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {filteredTitles.length === 0 && (\n        <div className=\"text-center p-8\">\n          <p className=\"text-gray-400 mb-4\">\n            {selectedHero.titles.length === 0 \n              ? 'Voc ainda no possui ttulos desbloqueados.'\n              : 'Nenhum ttulo encontrado com os filtros aplicados.'\n            }\n          </p>\n          {selectedHero.titles.length === 0 && (\n            <p className=\"text-sm text-gray-500\">\n              Complete conquistas e misses para desbloquear ttulos!\n            </p>\n          )}\n        </div>\n      )}\n\n      {/* Estatsticas */}\n      <div className=\"mt-8 bg-gray-800 rounded-lg p-6 border border-gray-700\">\n        <h3 className=\"text-lg font-bold text-white mb-4\">Estatsticas de Ttulos</h3>\n        <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 text-center\">\n          <div>\n            <div className=\"text-2xl font-bold text-amber-400\">{selectedHero.titles.length}</div>\n            <div className=\"text-sm text-gray-400\">Total</div>\n          </div>\n          <div>\n            <div className=\"text-2xl font-bold text-gray-400\">\n              {getTitlesByRarity(selectedHero.titles, 'comum').length}\n            </div>\n            <div className=\"text-sm text-gray-400\">Comuns</div>\n          </div>\n          <div>\n            <div className=\"text-2xl font-bold text-blue-400\">\n              {getTitlesByRarity(selectedHero.titles, 'raro').length}\n            </div>\n            <div className=\"text-sm text-gray-400\">Raros</div>\n          </div>\n          <div>\n            <div className=\"text-2xl font-bold text-purple-400\">\n              {getTitlesByRarity(selectedHero.titles, 'epico').length}\n            </div>\n            <div className=\"text-sm text-gray-400\">picos</div>\n          </div>\n          <div>\n            <div className=\"text-2xl font-bold text-yellow-400\">\n              {getTitlesByRarity(selectedHero.titles, 'lendario').length}\n            </div>\n            <div className=\"text-sm text-gray-400\">Lendrios</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TitlesManager;\n","/**\n * Componente de Mini-Metas Dirias\n */\n\nimport React, { useEffect, useRef } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { DailyGoal } from '../types/hero';\nimport { \n  getDailyGoalCategoryIcon, \n  getDailyGoalDifficultyColor, \n  getDailyGoalRewards \n} from '../utils/dailyGoalsSystem';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes, getSeasonalButtonGradient } from '../styles/medievalTheme';\n\ninterface DailyGoalsProps {\n  heroId: string;\n}\n\nexport const DailyGoals: React.FC<DailyGoalsProps> = ({ heroId }) => {\n  const { \n    heroes, \n    generateDailyGoalsForHero, \n    completeDailyGoal, \n    cleanupExpiredGoals \n  } = useHeroStore();\n\n  const hero = heroes.find(h => h.id === heroId);\n  const initializedRef = useRef<Set<string>>(new Set());\n  const { activeSeasonalTheme } = useMonetizationStore();\n  \n  useEffect(() => {\n    if (!heroId || initializedRef.current.has(heroId)) return;\n\n    // Get the current hero state at the time of effect execution\n    const currentHero = heroes.find(h => h.id === heroId);\n    if (!currentHero) return;\n\n    const now = new Date();\n    \n    // Only cleanup if there are actually expired goals\n    const hasExpiredGoals = currentHero.dailyGoals && currentHero.dailyGoals.length > 0 && \n      currentHero.dailyGoals.some(goal => {\n        const exp = typeof (goal.expiresAt as any) === 'string' \n          ? new Date(goal.expiresAt as unknown as string) \n          : (goal.expiresAt as Date);\n        return exp <= now;\n      });\n    \n    // Generate daily goals if hero doesn't have any or if it's a new day\n    const hasValidGoals = currentHero.dailyGoals && currentHero.dailyGoals.length > 0 && \n      currentHero.dailyGoals.some(goal => {\n        const exp = typeof (goal.expiresAt as any) === 'string' \n          ? new Date(goal.expiresAt as unknown as string) \n          : (goal.expiresAt as Date);\n        return exp > now;\n      });\n\n    // Mark this hero as initialized first to prevent re-execution\n    initializedRef.current.add(heroId);\n    \n    // Perform async operations after marking as initialized\n    if (hasExpiredGoals) {\n      setTimeout(() => cleanupExpiredGoals(heroId), 0);\n    }\n\n    if (!hasValidGoals) {\n      setTimeout(() => generateDailyGoalsForHero(heroId), 0);\n    }\n  }, [heroId]);\n\n  // Verificao peridica para expirao/renovao (a cada 60s)\n  useEffect(() => {\n    if (!heroId) return;\n    const interval = setInterval(() => {\n      const currentHero = heroes.find(h => h.id === heroId);\n      if (!currentHero) return;\n      const now = new Date();\n      const hasValidGoals = currentHero.dailyGoals && currentHero.dailyGoals.length > 0 && \n        currentHero.dailyGoals.some(goal => {\n          const exp = typeof (goal.expiresAt as any) === 'string' \n            ? new Date(goal.expiresAt as unknown as string) \n            : (goal.expiresAt as Date);\n          return exp > now;\n        });\n      if (!hasValidGoals) {\n        cleanupExpiredGoals(heroId);\n        generateDailyGoalsForHero(heroId);\n      }\n    }, 60000);\n    return () => clearInterval(interval);\n  }, [heroId, heroes]);\n\n  if (!hero || !hero.dailyGoals || hero.dailyGoals.length === 0) {\n    return (\n      <div className=\"bg-gray-800 rounded-lg p-6\">\n        <h3 className=\"text-xl font-bold text-white mb-4 flex items-center gap-2\">\n           Metas Dirias\n        </h3>\n        <div className=\"text-gray-400 text-center py-8\">\n          <div className=\"text-4xl mb-2\"></div>\n          <p>Gerando suas metas dirias...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const handleClaimReward = (goal: DailyGoal) => {\n    if (goal.completed) {\n      completeDailyGoal(heroId, goal.id);\n    }\n  };\n\n  const getTimeRemaining = (expiresAt: Date | string): string => {\n    const now = new Date();\n    const expDate = typeof expiresAt === 'string' ? new Date(expiresAt) : expiresAt;\n    const timeLeft = expDate.getTime() - now.getTime();\n    \n    if (timeLeft <= 0) return 'Expirado';\n    \n    const hours = Math.floor(timeLeft / (1000 * 60 * 60));\n    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));\n    \n    if (hours > 0) {\n      return `${hours}h ${minutes}m`;\n    }\n    return `${minutes}m`;\n  };\n\n  const completedGoals = hero.dailyGoals.filter(g => g.completed);\n  const claimableGoals = hero.dailyGoals.filter(g => g.completed && !g.claimed);\n  const totalGoals = hero.dailyGoals.length;\n  const completionPercentage = totalGoals > 0 ? (completedGoals.length / totalGoals) * 100 : 0;\n\n  return (\n    <div className=\"bg-gray-800 rounded-lg p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\n           Metas Dirias\n        </h3>\n        <div className=\"text-right\">\n          <div className=\"text-sm text-gray-400\">\n            Progresso: {completedGoals.length}/{totalGoals}\n          </div>\n          <div className=\"w-24 bg-gray-700 rounded-full h-2 mt-1\">\n            <div \n              className=\"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-300\"\n              style={{ width: `${completionPercentage}%` }}\n            />\n          </div>\n          <div className=\"mt-2 inline-flex items-center gap-2 text-sm\">\n            <span className=\"px-2 py-1 rounded-full bg-gray-700 text-orange-300 border border-orange-500/40\">\n               Streak: {hero.stats?.dailyCompletionStreak || 0}\n            </span>\n            <button\n              onClick={() => { cleanupExpiredGoals(heroId); generateDailyGoalsForHero(heroId); }}\n              className={`px-2 py-1 rounded bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white border border-white/10 hover:brightness-110 flex items-center gap-2`}\n            >\n              {(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}\n              <span> Atualizar Metas</span>\n            </button>\n            {claimableGoals.length > 0 && (\n              <button\n                onClick={() => claimableGoals.forEach(g => completeDailyGoal(heroId, g.id))}\n                className={`px-2 py-1 rounded bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white border border-white/10 hover:brightness-110 flex items-center gap-2`}\n              >\n                {(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}\n                <span> Coletar Tudo</span>\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        {hero.dailyGoals.map((goal) => {\n          const rewards = getDailyGoalRewards(goal);\n          const icon = getDailyGoalCategoryIcon(goal.id);\n          const difficultyColor = getDailyGoalDifficultyColor(goal.id);\n          const progressPercentage = (goal.progress / goal.maxProgress) * 100;\n          const timeRemaining = getTimeRemaining(goal.expiresAt);\n          \n          return (\n            <div \n              key={goal.id}\n              className={`bg-gray-700 rounded-lg p-4 border-l-4 transition-all duration-300 ${\n                goal.completed \n                  ? 'border-green-500 bg-green-900/20' \n                  : 'border-gray-600 hover:border-blue-500'\n              }`}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <span className=\"text-2xl\">{icon}</span>\n                    <h4 className={`font-semibold ${difficultyColor}`}>\n                      {goal.description}\n                    </h4>\n                    {goal.completed && !goal.claimed && (\n                      <span className=\"text-green-400 text-sm\"> Completa</span>\n                    )}\n                    {goal.claimed && (\n                      <span className=\"text-blue-300 text-sm\"> Coletado</span>\n                    )}\n                  </div>\n                  \n                  <div className=\"mb-3\">\n                    <div className=\"flex items-center justify-between text-sm text-gray-400 mb-1\">\n                      <span>Progresso: {goal.progress}/{goal.maxProgress}</span>\n                      <span>Expira em: {timeRemaining}</span>\n                    </div>\n                    <div className=\"w-full bg-gray-600 rounded-full h-2\">\n                      <div \n                        className={`h-2 rounded-full transition-all duration-300 ${\n                          goal.completed \n                            ? 'bg-green-500' \n                            : 'bg-gradient-to-r from-blue-500 to-purple-500'\n                        }`}\n                        style={{ width: `${Math.min(progressPercentage, 100)}%` }}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center gap-4 text-sm\">\n                    <div className=\"flex items-center gap-1 text-yellow-400\">\n                      <span></span>\n                      <span>{rewards.xp} XP</span>\n                    </div>\n                    <div className=\"flex items-center gap-1 text-yellow-500\">\n                      <span></span>\n                      <span>{rewards.gold} Ouro</span>\n                    </div>\n                    {typeof rewards.glory === 'number' && rewards.glory > 0 && (\n                      <div className=\"flex items-center gap-1 text-yellow-300\">\n                        <span></span>\n                        <span>{rewards.glory} Glria</span>\n                      </div>\n                    )}\n                    {typeof rewards.arcaneEssence === 'number' && rewards.arcaneEssence > 0 && (\n                      <div className=\"flex items-center gap-1 text-purple-300\">\n                        <span></span>\n                        <span>{rewards.arcaneEssence} Essncia Arcana</span>\n                      </div>\n                    )}\n                    {rewards.items && rewards.items.length > 0 && (\n                      <div className=\"flex items-center gap-1 text-purple-400\">\n                        <span></span>\n                        <span>{rewards.items.length} Item(s)</span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {goal.completed && !goal.claimed && (\n                  <button\n                    onClick={() => handleClaimReward(goal)}\n                    className={`ml-4 bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center gap-2 hover:brightness-110`}\n                  >\n                    <span>{(seasonalThemes as any)[activeSeasonalTheme || '']?.accents?.[0] || ''}</span>\n                    <span>Coletar</span>\n                  </button>\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {completedGoals.length === totalGoals && totalGoals > 0 && (\n        <div className=\"mt-6 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg p-4 text-center\">\n          <div className=\"text-2xl mb-2\"></div>\n          <h4 className=\"text-white font-bold mb-1\">Parabns!</h4>\n          <p className=\"text-purple-100 text-sm\">\n            Voc completou todas as metas dirias! Volte amanh para novas metas.\n          </p>\n        </div>\n      )}\n\n      <div className=\"mt-6 bg-gray-700 rounded-lg p-4\">\n        <h4 className=\"text-white font-semibold mb-2 flex items-center gap-2\">\n           Dicas\n        </h4>\n        <ul className=\"text-gray-300 text-sm space-y-1\">\n          <li> Complete misses para progredir em vrias metas</li>\n          <li> Metas mais difceis oferecem recompensas maiores</li>\n          <li> A meta \"Dia Perfeito\" oferece bnus especiais</li>\n          <li> Novas metas so geradas a cada dia</li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default DailyGoals;\n","import React, { useState, useEffect } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { eventManager } from '../utils/eventSystem';\nimport { GameEvent, EventProgress, EventReward } from '../types/events';\n\nconst EventsPanel: React.FC = () => {\n  const { selectedHeroId, gainXP, gainGold, addTitle } = useHeroStore();\n  const [activeEvents, setActiveEvents] = useState<GameEvent[]>([]);\n  const [eventProgress, setEventProgress] = useState<EventProgress[]>([]);\n  const [timeUntilRotation, setTimeUntilRotation] = useState({ hours: 0, minutes: 0 });\n\n  useEffect(() => {\n    loadEvents();\n    const interval = setInterval(loadEvents, 60000); // Update every minute\n    return () => clearInterval(interval);\n  }, [selectedHeroId]);\n\n  const loadEvents = () => {\n    const events = eventManager.getActiveEvents();\n    setActiveEvents(events);\n    \n    if (selectedHeroId) {\n      const progress = eventManager.getEventProgress(selectedHeroId);\n      setEventProgress(progress);\n    }\n    \n    const timeLeft = eventManager.getTimeUntilNextRotation();\n    setTimeUntilRotation(timeLeft);\n  };\n\n  const getEventProgress = (eventId: string): EventProgress | undefined => {\n    return eventProgress.find(p => p.eventId === eventId);\n  };\n\n  const getProgressPercentage = (event: GameEvent): number => {\n    const progress = getEventProgress(event.id);\n    if (!progress) return 0;\n    return Math.min((progress.progress / event.targetValue) * 100, 100);\n  };\n\n  const handleClaimRewards = async (event: GameEvent) => {\n    if (!selectedHeroId) return;\n\n    const rewards = eventManager.claimEventRewards(selectedHeroId, event.id);\n    if (!rewards) return;\n\n    // Apply rewards\n    for (const reward of rewards) {\n      switch (reward.type) {\n        case 'xp':\n          if (reward.amount) {\n            gainXP(selectedHeroId, reward.amount);\n          }\n          break;\n        case 'gold':\n          if (reward.amount) {\n            gainGold(selectedHeroId, reward.amount);\n          }\n          break;\n        case 'title':\n          if (reward.titleId) {\n            addTitle(selectedHeroId, reward.titleId);\n          }\n          break;\n      }\n    }\n\n    // Reload events to update UI\n    loadEvents();\n  };\n\n  const getRarityColor = (rarity: string): string => {\n    switch (rarity) {\n      case 'common': return 'border-gray-300 bg-gray-50';\n      case 'rare': return 'border-blue-300 bg-blue-50';\n      case 'epic': return 'border-purple-300 bg-purple-50';\n      case 'legendary': return 'border-yellow-300 bg-yellow-50';\n      default: return 'border-gray-300 bg-gray-50';\n    }\n  };\n\n  const formatRewards = (rewards: EventReward[]): string => {\n    return rewards.map(reward => {\n      switch (reward.type) {\n        case 'xp': return `${reward.amount} XP`;\n        case 'gold': return `${reward.amount} `;\n        case 'title': return `Ttulo: ${reward.titleId}`;\n        case 'item': return reward.itemName || 'Item';\n        default: return '';\n      }\n    }).join(', ');\n  };\n\n  const dailyEvents = activeEvents.filter(e => e.type === 'daily');\n  const weeklyEvents = activeEvents.filter(e => e.type === 'weekly');\n  const specialEvents = activeEvents.filter(e => e.type === 'special');\n\n  if (!selectedHeroId) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"text-center py-12\">\n          <div className=\"text-6xl mb-4\"></div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Eventos Especiais</h2>\n          <p className=\"text-gray-600\">Selecione um heri para ver os eventos disponveis</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6 space-y-8\">\n      {/* Header */}\n      <div className=\"text-center\">\n        <h1 className=\"text-3xl font-bold text-gray-800 mb-2\"> Eventos Especiais</h1>\n        <p className=\"text-gray-600\">\n          Participe de eventos limitados e ganhe recompensas exclusivas!\n        </p>\n        <div className=\"mt-4 inline-flex items-center px-4 py-2 bg-blue-100 rounded-lg\">\n          <span className=\"text-sm text-blue-800\">\n             Prxima rotao em: {timeUntilRotation.hours}h {timeUntilRotation.minutes}m\n          </span>\n        </div>\n      </div>\n\n      {/* Daily Events */}\n      {dailyEvents.length > 0 && (\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\n             Eventos Dirios\n            <span className=\"ml-2 text-sm bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full\">\n              {dailyEvents.length}\n            </span>\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {dailyEvents.map(event => {\n              const progress = getEventProgress(event.id);\n              const percentage = getProgressPercentage(event);\n              const isCompleted = progress?.completed || false;\n              const canClaim = isCompleted && !progress?.rewardsClaimed;\n\n              return (\n                <div\n                  key={event.id}\n                  className={`border-2 rounded-lg p-6 ${getRarityColor(event.rarity)} transition-all duration-200 hover:shadow-lg`}\n                >\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"flex items-center\">\n                      <span className=\"text-3xl mr-3\">{event.icon}</span>\n                      <div>\n                        <h3 className=\"font-bold text-gray-800\">{event.name}</h3>\n                        <p className=\"text-sm text-gray-600\">{event.description}</p>\n                      </div>\n                    </div>\n                    {isCompleted && (\n                      <span className=\"text-green-500 text-xl\"></span>\n                    )}\n                  </div>\n\n                  <div className=\"mb-4\">\n                    <p className=\"text-sm text-gray-700 mb-2\">{event.objective}</p>\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                      <div\n                        className={`bg-gradient-to-r ${event.color} h-2 rounded-full transition-all duration-300`}\n                        style={{ width: `${percentage}%` }}\n                      ></div>\n                    </div>\n                    <p className=\"text-xs text-gray-600 mt-1\">\n                      {progress?.progress || 0} / {event.targetValue}\n                    </p>\n                  </div>\n\n                  <div className=\"mb-4\">\n                    <p className=\"text-sm font-medium text-gray-700 mb-1\">Recompensas:</p>\n                    <p className=\"text-sm text-gray-600\">{formatRewards(event.rewards)}</p>\n                  </div>\n\n                  {canClaim && (\n                    <button\n                      onClick={() => handleClaimRewards(event)}\n                      className=\"w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-2 px-4 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 font-medium\"\n                    >\n                       Resgatar Recompensas\n                    </button>\n                  )}\n\n                  {progress?.rewardsClaimed && (\n                    <div className=\"w-full bg-gray-100 text-gray-500 py-2 px-4 rounded-lg text-center text-sm\">\n                       Recompensas Resgatadas\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      {/* Weekly Events */}\n      {weeklyEvents.length > 0 && (\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\n             Eventos Semanais\n            <span className=\"ml-2 text-sm bg-purple-100 text-purple-800 px-2 py-1 rounded-full\">\n              {weeklyEvents.length}\n            </span>\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {weeklyEvents.map(event => {\n              const progress = getEventProgress(event.id);\n              const percentage = getProgressPercentage(event);\n              const isCompleted = progress?.completed || false;\n              const canClaim = isCompleted && !progress?.rewardsClaimed;\n\n              return (\n                <div\n                  key={event.id}\n                  className={`border-2 rounded-lg p-6 ${getRarityColor(event.rarity)} transition-all duration-200 hover:shadow-lg`}\n                >\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"flex items-center\">\n                      <span className=\"text-4xl mr-4\">{event.icon}</span>\n                      <div>\n                        <h3 className=\"font-bold text-gray-800 text-lg\">{event.name}</h3>\n                        <p className=\"text-sm text-gray-600\">{event.description}</p>\n                      </div>\n                    </div>\n                    {isCompleted && (\n                      <span className=\"text-green-500 text-2xl\"></span>\n                    )}\n                  </div>\n\n                  <div className=\"mb-4\">\n                    <p className=\"text-gray-700 mb-3\">{event.objective}</p>\n                    <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                      <div\n                        className={`bg-gradient-to-r ${event.color} h-3 rounded-full transition-all duration-300`}\n                        style={{ width: `${percentage}%` }}\n                      ></div>\n                    </div>\n                    <p className=\"text-sm text-gray-600 mt-2\">\n                      {progress?.progress || 0} / {event.targetValue}\n                    </p>\n                  </div>\n\n                  <div className=\"mb-4\">\n                    <p className=\"font-medium text-gray-700 mb-2\">Recompensas picas:</p>\n                    <p className=\"text-gray-600\">{formatRewards(event.rewards)}</p>\n                  </div>\n\n                  {canClaim && (\n                    <button\n                      onClick={() => handleClaimRewards(event)}\n                      className=\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200 font-medium text-lg\"\n                    >\n                       Resgatar Recompensas picas\n                    </button>\n                  )}\n\n                  {progress?.rewardsClaimed && (\n                    <div className=\"w-full bg-gray-100 text-gray-500 py-3 px-4 rounded-lg text-center\">\n                       Recompensas picas Resgatadas\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      {/* Special Events */}\n      {specialEvents.length > 0 && (\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\n             Eventos Especiais\n            <span className=\"ml-2 text-sm bg-red-100 text-red-800 px-2 py-1 rounded-full\">\n              {specialEvents.length}\n            </span>\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {specialEvents.map(event => {\n              const progress = getEventProgress(event.id);\n              const percentage = getProgressPercentage(event);\n              const isCompleted = progress?.completed || false;\n              const canClaim = isCompleted && !progress?.rewardsClaimed;\n\n              return (\n                <div\n                  key={event.id}\n                  className={`border-2 rounded-lg p-6 ${getRarityColor(event.rarity)} transition-all duration-200 hover:shadow-lg`}\n                >\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"flex items-center\">\n                      <span className=\"text-4xl mr-4\">{event.icon}</span>\n                      <div>\n                        <h3 className=\"font-bold text-gray-800 text-lg\">{event.name}</h3>\n                        <p className=\"text-sm text-gray-600\">{event.description}</p>\n                      </div>\n                    </div>\n                    {isCompleted && (\n                      <span className=\"text-green-500 text-2xl\"></span>\n                    )}\n                  </div>\n\n                  <div className=\"mb-4\">\n                    <p className=\"text-gray-700 mb-3\">{event.objective}</p>\n                    <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                      <div\n                        className={`bg-gradient-to-r ${event.color} h-3 rounded-full transition-all duration-300`}\n                        style={{ width: `${percentage}%` }}\n                      ></div>\n                    </div>\n                    <p className=\"text-sm text-gray-600 mt-2\">\n                      {progress?.progress || 0} / {event.targetValue}\n                    </p>\n                  </div>\n\n                  <div className=\"mb-4\">\n                    <p className=\"font-medium text-gray-700 mb-2\">Recompensas Lendrias:</p>\n                    <p className=\"text-gray-600\">{formatRewards(event.rewards)}</p>\n                  </div>\n\n                  {canClaim && (\n                    <button\n                      onClick={() => handleClaimRewards(event)}\n                      className=\"w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-3 px-4 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 font-medium text-lg\"\n                    >\n                       Resgatar Recompensas Lendrias\n                    </button>\n                  )}\n\n                  {progress?.rewardsClaimed && (\n                    <div className=\"w-full bg-gray-100 text-gray-500 py-3 px-4 rounded-lg text-center\">\n                       Recompensas Lendrias Resgatadas\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      {/* No Events */}\n      {activeEvents.length === 0 && (\n        <div className=\"text-center py-12\">\n          <div className=\"text-6xl mb-4\"></div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum Evento Ativo</h2>\n          <p className=\"text-gray-600\">\n            Novos eventos sero gerados em breve. Volte mais tarde!\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default EventsPanel;","import React, { useState, useEffect } from 'react';\nimport { Activity, ActivityFilter } from '../types/activity';\nimport { activityManager } from '../utils/activitySystem';\nimport { useHeroStore } from '../store/heroStore';\n\ninterface ActivityFeedProps {\n  heroId?: string;\n  showFilters?: boolean;\n  maxItems?: number;\n  compact?: boolean;\n}\n\nexport const ActivityFeed: React.FC<ActivityFeedProps> = ({\n  heroId,\n  showFilters = true,\n  maxItems = 20,\n  compact = false\n}) => {\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [filter, setFilter] = useState<Partial<ActivityFilter>>({});\n  const [showComments, setShowComments] = useState<Record<string, boolean>>({});\n  const [newComment, setNewComment] = useState<Record<string, string>>({});\n  const { currentHero } = useHeroStore();\n\n  useEffect(() => {\n    loadActivities();\n  }, [heroId, filter, maxItems]);\n\n  const loadActivities = () => {\n    let loadedActivities: Activity[];\n    \n    if (heroId) {\n      loadedActivities = activityManager.getHeroActivities(heroId, maxItems);\n    } else {\n      const feed = activityManager.getActivityFeed(filter);\n      loadedActivities = feed.activities.slice(0, maxItems);\n    }\n    \n    setActivities(loadedActivities);\n  };\n\n  const handleLike = (activityId: string) => {\n    if (activityManager.likeActivity(activityId)) {\n      loadActivities();\n    }\n  };\n\n  const handleComment = (activityId: string) => {\n    const comment = newComment[activityId]?.trim();\n    if (!comment || !currentHero) return;\n\n    if (activityManager.addComment(\n      activityId,\n      currentHero.id,\n      currentHero.name,\n      comment\n    )) {\n      setNewComment(prev => ({ ...prev, [activityId]: '' }));\n      loadActivities();\n    }\n  };\n\n  const handleShare = async (activityId: string) => {\n    const shareData = activityManager.shareActivity(activityId);\n    if (!shareData) return;\n\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: 'HeroForge - Conquista pica',\n          text: shareData.shareText,\n          url: shareData.shareUrl\n        });\n      } catch (error) {\n        // Fallback para cpia\n        copyToClipboard(shareData.shareUrl);\n      }\n    } else {\n      copyToClipboard(shareData.shareUrl);\n    }\n\n    loadActivities();\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text).then(() => {\n      // Mostrar notificao de sucesso\n      console.log('Link copiado para a rea de transferncia!');\n    });\n  };\n\n  const toggleComments = (activityId: string) => {\n    setShowComments(prev => ({\n      ...prev,\n      [activityId]: !prev[activityId]\n    }));\n  };\n\n  const formatTimeAgo = (date: Date) => {\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return 'agora mesmo';\n    if (diffMins < 60) return `${diffMins}m atrs`;\n    if (diffHours < 24) return `${diffHours}h atrs`;\n    if (diffDays < 7) return `${diffDays}d atrs`;\n    return date.toLocaleDateString('pt-BR');\n  };\n\n  const FilterPanel = () => (\n    <div className=\"bg-gray-800/50 backdrop-blur-sm rounded-lg p-4 mb-6\">\n      <h3 className=\"text-lg font-semibold text-white mb-3\">Filtros</h3>\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n            Tipo de Atividade\n          </label>\n          <select\n            className=\"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white\"\n            onChange={(e) => {\n              const types = e.target.value ? [e.target.value as Activity['type']] : undefined;\n              setFilter(prev => ({ ...prev, types }));\n            }}\n          >\n            <option value=\"\">Todos os tipos</option>\n            <option value=\"quest-completed\">Misses Completadas</option>\n            <option value=\"epic-quest-completed\">Misses picas</option>\n            <option value=\"level-up\">Subida de Nvel</option>\n            <option value=\"achievement-unlocked\">Conquistas</option>\n            <option value=\"title-earned\">Ttulos</option>\n            <option value=\"event-completed\">Eventos</option>\n            <option value=\"daily-goal-completed\">Metas Dirias</option>\n            <option value=\"combat-victory\">Vitrias em Combate</option>\n          </select>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n            Perodo\n          </label>\n          <select\n            className=\"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white\"\n            onChange={(e) => {\n              const value = e.target.value;\n              let dateRange;\n              \n              if (value === 'today') {\n                const today = new Date();\n                today.setHours(0, 0, 0, 0);\n                const tomorrow = new Date(today);\n                tomorrow.setDate(tomorrow.getDate() + 1);\n                dateRange = { start: today, end: tomorrow };\n              } else if (value === 'week') {\n                const weekAgo = new Date();\n                weekAgo.setDate(weekAgo.getDate() - 7);\n                dateRange = { start: weekAgo, end: new Date() };\n              } else if (value === 'month') {\n                const monthAgo = new Date();\n                monthAgo.setDate(monthAgo.getDate() - 30);\n                dateRange = { start: monthAgo, end: new Date() };\n              }\n              \n              setFilter(prev => ({ ...prev, dateRange }));\n            }}\n          >\n            <option value=\"\">Todo o perodo</option>\n            <option value=\"today\">Hoje</option>\n            <option value=\"week\">ltima semana</option>\n            <option value=\"month\">ltimo ms</option>\n          </select>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n            Visibilidade\n          </label>\n          <select\n            className=\"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white\"\n            onChange={(e) => {\n              const showOnlyPublic = e.target.value === 'public' ? true : undefined;\n              setFilter(prev => ({ ...prev, showOnlyPublic }));\n            }}\n          >\n            <option value=\"\">Todas as atividades</option>\n            <option value=\"public\">Apenas pblicas</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  );\n\n  const ActivityCard = ({ activity }: { activity: Activity }) => (\n    <div className={`bg-gradient-to-r ${activity.color} p-0.5 rounded-lg mb-4`}>\n      <div className=\"bg-gray-900 rounded-lg p-4\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-start space-x-3 flex-1\">\n            <div className=\"text-2xl\">{activity.icon}</div>\n            <div className=\"flex-1\">\n              <p className=\"text-white font-medium\">{activity.message}</p>\n              <p className=\"text-gray-400 text-sm mt-1\">\n                {formatTimeAgo(activity.timestamp)}\n              </p>\n              \n              {!compact && activity.data.questReward && (\n                <div className=\"mt-2 text-sm text-gray-300\">\n                  <span className=\"text-yellow-400\">+{activity.data.questReward.xp} XP</span>\n                  {activity.data.questReward.gold > 0 && (\n                    <span className=\"ml-2 text-yellow-500\">+{activity.data.questReward.gold} ouro</span>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {!compact && (\n          <div className=\"flex items-center justify-between mt-4 pt-3 border-t border-gray-700\">\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={() => handleLike(activity.id)}\n                className=\"flex items-center space-x-1 text-gray-400 hover:text-red-400 transition-colors\"\n              >\n                <span></span>\n                <span className=\"text-sm\">{activity.likes}</span>\n              </button>\n\n              <button\n                onClick={() => toggleComments(activity.id)}\n                className=\"flex items-center space-x-1 text-gray-400 hover:text-blue-400 transition-colors\"\n              >\n                <span></span>\n                <span className=\"text-sm\">{activity.comments.length}</span>\n              </button>\n\n              <button\n                onClick={() => handleShare(activity.id)}\n                className=\"flex items-center space-x-1 text-gray-400 hover:text-green-400 transition-colors\"\n              >\n                <span></span>\n                <span className=\"text-sm\">{activity.shares}</span>\n              </button>\n            </div>\n          </div>\n        )}\n\n        {!compact && showComments[activity.id] && (\n          <div className=\"mt-4 pt-3 border-t border-gray-700\">\n            {activity.comments.map(comment => (\n              <div key={comment.id} className=\"mb-3 last:mb-0\">\n                <div className=\"flex items-start space-x-2\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-2\">\n                      <span className=\"text-sm font-medium text-white\">\n                        {comment.authorName}\n                      </span>\n                      <span className=\"text-xs text-gray-400\">\n                        {formatTimeAgo(comment.timestamp)}\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-gray-300 mt-1\">{comment.content}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n\n            {currentHero && (\n              <div className=\"mt-3 flex space-x-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Adicionar comentrio...\"\n                  value={newComment[activity.id] || ''}\n                  onChange={(e) => setNewComment(prev => ({\n                    ...prev,\n                    [activity.id]: e.target.value\n                  }))}\n                  className=\"flex-1 bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm\"\n                  onKeyPress={(e) => {\n                    if (e.key === 'Enter') {\n                      handleComment(activity.id);\n                    }\n                  }}\n                />\n                <button\n                  onClick={() => handleComment(activity.id)}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors\"\n                >\n                  Enviar\n                </button>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      {!compact && (\n        <div className=\"mb-6\">\n          <h2 className=\"text-3xl font-bold text-white mb-2\">\n            {heroId ? 'Atividades do Heri' : 'Feed de Atividades'}\n          </h2>\n          <p className=\"text-gray-400\">\n            Acompanhe as conquistas e aventuras picas!\n          </p>\n        </div>\n      )}\n\n      {showFilters && !compact && <FilterPanel />}\n\n      <div className=\"space-y-4\">\n        {activities.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <div className=\"text-6xl mb-4\"></div>\n            <h3 className=\"text-xl font-semibold text-white mb-2\">\n              Nenhuma atividade encontrada\n            </h3>\n            <p className=\"text-gray-400\">\n              {heroId \n                ? 'Este heri ainda no possui atividades registradas.'\n                : 'Comece sua jornada pica para ver atividades aqui!'\n              }\n            </p>\n          </div>\n        ) : (\n          activities.map(activity => (\n            <ActivityCard key={activity.id} activity={activity} />\n          ))\n        )}\n      </div>\n\n      {activities.length >= maxItems && (\n        <div className=\"text-center mt-6\">\n          <button\n            onClick={() => loadActivities()}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors\"\n          >\n            Carregar mais atividades\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ActivityFeed;","// Utilitrio simples de efeitos sonoros usando Web Audio API\n// Evita dependncias externas e funciona sem arquivos de udio\n\nlet audioCtx: AudioContext | null = null;\nlet lastPlayAt = 0;\n\nfunction getAudioContext(): AudioContext {\n  if (!audioCtx) {\n    audioCtx = new (window.AudioContext || (window as any).webkitAudioContext)();\n  }\n  return audioCtx;\n}\n\n\nfunction playSequence(notes: Array<{ f: number; d: number; t?: OscillatorType; v?: number }>, gapMs = 30) {\n  const ctx = getAudioContext();\n  let offset = 0;\n  notes.forEach((n) => {\n    const osc = ctx.createOscillator();\n    const gain = ctx.createGain();\n    osc.type = n.t || 'sine';\n    osc.frequency.value = n.f;\n    gain.gain.value = n.v ?? 0.12;\n    osc.connect(gain);\n    gain.connect(ctx.destination);\n\n    const start = ctx.currentTime + offset / 1000;\n    const stop = start + n.d / 1000;\n    osc.start(start);\n    gain.gain.setValueAtTime(gain.gain.value, start);\n    gain.gain.exponentialRampToValueAtTime(0.0001, stop);\n    osc.stop(stop);\n    offset += n.d + gapMs;\n  });\n}\n\nfunction rateLimit(minIntervalMs = 80): boolean {\n  const now = Date.now();\n  if (now - lastPlayAt < minIntervalMs) return false;\n  lastPlayAt = now;\n  return true;\n}\n\nexport function playSuccess() {\n  if (!rateLimit()) return;\n  // Arpejo curto e alegre\n  playSequence([\n    { f: 740, d: 90 },\n    { f: 880, d: 90 },\n    { f: 988, d: 120 },\n  ]);\n}\n\nexport function playFailure() {\n  if (!rateLimit()) return;\n  // Tom descendente e suave\n  playSequence([\n    { f: 220, d: 140, t: 'sawtooth', v: 0.08 },\n    { f: 180, d: 140, t: 'sawtooth', v: 0.08 },\n    { f: 140, d: 160, t: 'sawtooth', v: 0.08 },\n  ]);\n}\n\nexport function playLevelUp() {\n  if (!rateLimit()) return;\n  // Fanfare curta\n  playSequence([\n    { f: 660, d: 100, t: 'triangle', v: 0.12 },\n    { f: 880, d: 140, t: 'triangle', v: 0.12 },\n    { f: 990, d: 120, t: 'triangle', v: 0.12 },\n    { f: 1320, d: 180, t: 'sine', v: 0.12 },\n  ]);\n}\n\nexport function resumeAudioContextIfNeeded() {\n  const ctx = getAudioContext();\n  if (ctx.state === 'suspended') {\n    ctx.resume().catch(() => {});\n  }\n}\nexport function playHammer() {\n  if (!rateLimit(200)) return;\n  playSequence([\n    { f: 420, d: 40, t: 'square', v: 0.1 },\n    { f: 360, d: 30, t: 'square', v: 0.09 },\n    { f: 520, d: 50, t: 'triangle', v: 0.11 },\n  ], 12);\n}\nexport function playPolish() {\n  if (!rateLimit(250)) return;\n  playSequence([\n    { f: 1200, d: 60, t: 'sine', v: 0.08 },\n    { f: 1350, d: 60, t: 'sine', v: 0.08 },\n    { f: 1500, d: 80, t: 'sine', v: 0.08 },\n  ], 20);\n}\n\nexport function playForgeStart() {\n  if (!rateLimit(120)) return;\n  playSequence([\n    { f: 680, d: 60, t: 'sine', v: 0.06 },\n  ]);\n}\n","import React, { useEffect, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { RankLevel } from '../types/ranks';\nimport { medievalTheme, getRankGradient, getRankIcon } from '../styles/medievalTheme';\n\ninterface RankPromotionAnimationProps {\n  isVisible: boolean;\n  newRank: RankLevel;\n  onComplete: () => void;\n}\n\nexport const RankPromotionAnimation: React.FC<RankPromotionAnimationProps> = ({\n  isVisible,\n  newRank,\n  onComplete\n}) => {\n  const [showParticles, setShowParticles] = useState(false);\n  const [showRankBadge, setShowRankBadge] = useState(false);\n\n  useEffect(() => {\n    if (isVisible) {\n      const timer1 = setTimeout(() => setShowParticles(true), 500);\n      const timer2 = setTimeout(() => setShowRankBadge(true), 1000);\n      const timer3 = setTimeout(() => onComplete(), 3000);\n\n      return () => {\n        clearTimeout(timer1);\n        clearTimeout(timer2);\n        clearTimeout(timer3);\n      };\n    }\n  }, [isVisible, onComplete]);\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80\"\n        >\n          {/* Fundo com efeito de brilho */}\n          <motion.div\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ duration: 0.8, ease: \"easeOut\" }}\n            className=\"absolute inset-0 bg-gradient-radial from-yellow-400/20 via-transparent to-transparent\"\n          />\n\n          {/* Partculas flutuantes */}\n          <AnimatePresence>\n            {showParticles && (\n              <div className=\"absolute inset-0 overflow-hidden\">\n                {[...Array(20)].map((_, i) => (\n                  <motion.div\n                    key={i}\n                    initial={{ \n                      opacity: 0, \n                      y: 100, \n                      x: Math.random() * (typeof window !== 'undefined' ? window.innerWidth : 1000),\n                      scale: 0 \n                    }}\n                    animate={{ \n                      opacity: [0, 1, 0], \n                      y: -100, \n                      scale: [0, 1, 0],\n                      rotate: 360\n                    }}\n                    transition={{ \n                      duration: 2, \n                      delay: i * 0.1,\n                      ease: \"easeOut\"\n                    }}\n                    className=\"absolute w-2 h-2 bg-yellow-400 rounded-full\"\n                  />\n                ))}\n              </div>\n            )}\n          </AnimatePresence>\n\n          {/* Contedo principal */}\n          <motion.div\n            initial={{ scale: 0, rotateY: 180 }}\n            animate={{ scale: 1, rotateY: 0 }}\n            transition={{ duration: 1, ease: \"easeOut\" }}\n            className=\"relative z-10 text-center\"\n          >\n            {/* Ttulo da promoo */}\n            <motion.h1\n              initial={{ y: -50, opacity: 0 }}\n              animate={{ y: 0, opacity: 1 }}\n              transition={{ delay: 0.3, duration: 0.8 }}\n              className=\"text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 mb-8\"\n            >\n              PROMOO!\n            </motion.h1>\n\n            {/* Badge do novo rank */}\n            <AnimatePresence>\n              {showRankBadge && (\n                <motion.div\n                  initial={{ scale: 0, rotateZ: -180 }}\n                  animate={{ scale: 1, rotateZ: 0 }}\n                  transition={{ duration: 0.8, ease: \"easeOut\" }}\n                  className={`inline-flex items-center px-8 py-4 rounded-full bg-gradient-to-r ${getRankGradient(newRank)} text-white text-2xl font-bold shadow-2xl`}\n                >\n                  <motion.span\n                    animate={{ rotate: [0, 10, -10, 0] }}\n                    transition={{ duration: 0.5, repeat: 2 }}\n                    className=\"text-4xl mr-4\"\n                  >\n                    {getRankIcon(newRank)}\n                  </motion.span>\n                  <span>Rank {newRank}</span>\n                </motion.div>\n              )}\n            </AnimatePresence>\n\n            {/* Texto de congratulaes */}\n            <motion.p\n              initial={{ y: 50, opacity: 0 }}\n              animate={{ y: 0, opacity: 1 }}\n              transition={{ delay: 1.5, duration: 0.8 }}\n              className=\"text-xl text-gray-300 mt-8\"\n            >\n              Parabns pela sua ascenso heroica!\n            </motion.p>\n\n            {/* Efeito de brilho no fundo */}\n            <motion.div\n              animate={{ \n                scale: [1, 1.2, 1],\n                opacity: [0.3, 0.6, 0.3]\n              }}\n              transition={{ \n                duration: 2, \n                repeat: Infinity,\n                ease: \"easeInOut\"\n              }}\n              className={`absolute inset-0 -z-10 rounded-full bg-gradient-to-r ${getRankGradient(newRank)} blur-3xl`}\n            />\n          </motion.div>\n\n          {/* Raios de luz */}\n          <div className=\"absolute inset-0 overflow-hidden\">\n            {[...Array(8)].map((_, i) => (\n              <motion.div\n                key={i}\n                initial={{ scaleY: 0, opacity: 0 }}\n                animate={{ scaleY: 1, opacity: [0, 0.8, 0] }}\n                transition={{ \n                  duration: 1.5, \n                  delay: 0.5 + i * 0.1,\n                  ease: \"easeOut\"\n                }}\n                className=\"absolute top-0 bottom-0 w-1 bg-gradient-to-b from-yellow-400 to-transparent\"\n                style={{\n                  left: `${50 + Math.cos(i * Math.PI / 4) * 30}%`,\n                  transform: `rotate(${i * 45}deg)`,\n                  transformOrigin: 'center'\n                }}\n              />\n            ))}\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\ninterface RankProgressAnimationProps {\n  progress: number;\n  isAnimating: boolean;\n  color?: string;\n}\n\nexport const RankProgressAnimation: React.FC<RankProgressAnimationProps> = ({\n  progress,\n  isAnimating,\n  color = 'from-blue-400 to-blue-600'\n}) => {\n  return (\n    <div className=\"relative w-full h-4 bg-gray-700 rounded-full overflow-hidden\">\n      <div\n        className={`h-full bg-gradient-to-r ${color} relative transition-all duration-300 ease-out`}\n        style={{ width: `${progress}%` }}\n      >\n        {/* Efeito de brilho na barra de progresso */}\n        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-20\" />\n      </div>\n      \n      {/* Partculas na barra de progresso - simplificadas */}\n      {isAnimating && (\n        <div className=\"absolute inset-0\">\n          {[...Array(3)].map((_, i) => (\n            <div\n              key={i}\n              className=\"absolute w-1 h-1 bg-white rounded-full opacity-50\"\n              style={{\n                left: `${(progress / 100) * (20 + i * 20)}%`,\n                top: `${4 + i * 2}px`\n              }}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\ninterface FloatingRankBadgeProps {\n  rank: RankLevel;\n  isFloating?: boolean;\n}\n\nexport const FloatingRankBadge: React.FC<FloatingRankBadgeProps> = React.memo(({\n  rank,\n  isFloating = true\n}) => {\n  // Verificao de segurana para o rank\n  if (!rank) {\n    return null;\n  }\n\n  // Temporariamente usando div normal em vez de motion.div para resolver problemas de hooks\n  return (\n    <div\n      className={`inline-flex items-center px-4 py-2 rounded-full bg-gradient-to-r ${getRankGradient(rank)} text-white font-bold ${medievalTheme.effects.shadows.glow}`}\n    >\n      <span className=\"text-xl mr-2\">{getRankIcon(rank)}</span>\n      <span>{rank}</span>\n    </div>\n  );\n});","import React, { useState, useMemo, useEffect } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { resumeAudioContextIfNeeded, playLevelUp } from '../utils/audioEffects';\nimport { Hero } from '../types/hero';\nimport { RankLevel, RankHistory, RankComparison } from '../types/ranks';\nimport { RankProgressAnimation, FloatingRankBadge } from './RankAnimations';\nimport { rankSystem } from '../utils/rankSystem';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes } from '../styles/medievalTheme';\nimport { \n  TrendingUp, \n  Trophy, \n  Target, \n  Clock, \n  Users, \n  Star,\n  ChevronLeft,\n  ChevronRight,\n  Filter,\n  BarChart3,\n  Calendar,\n  Award\n} from 'lucide-react';\n\ninterface EvolutionPanelProps {\n  heroId?: string;\n  className?: string;\n}\n\ntype ViewMode = 'overview' | 'progress' | 'history' | 'leaderboard' | 'comparison';\n\n// Componentes auxiliares\nconst LocalRankCard: React.FC<{ \n  rank: RankLevel; \n  size?: 'small' | 'medium' | 'large'; \n  isFloating?: boolean;\n  className?: string;\n}> = ({ \n  rank, \n  size = 'medium',\n  isFloating = true,\n  className = ''\n}) => (\n  <div className={className}>\n    <FloatingRankBadge rank={rank} isFloating={isFloating} />\n  </div>\n);\n\nconst RankProgress: React.FC<{ progress: number; color: string; isAnimating?: boolean }> = ({ \n  progress, \n  color, \n  isAnimating = false \n}) => (\n  <RankProgressAnimation\n    progress={progress}\n    isAnimating={isAnimating}\n    color={color}\n  />\n);\n\nexport const EvolutionPanel: React.FC<EvolutionPanelProps> = ({ \n  heroId, \n  className = '' \n}) => {\n  const { heroes, getHeroRankProgress, getRankLeaderboard, promoteHero, updateHero, getSelectedHero } = useHeroStore();\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-amber-700/30' : 'border-amber-700/30';\n  const [viewMode, setViewMode] = useState<ViewMode>('overview');\n  const [selectedHeroForComparison, setSelectedHeroForComparison] = useState<string>('');\n  const [historyFilter, setHistoryFilter] = useState<RankLevel | 'all'>('all');\n  const [localHeroId, setLocalHeroId] = useState<string | null>(\n    heroId ?? getSelectedHero()?.id ?? (heroes[0]?.id ?? null)\n  );\n\n  // Sincronizar quando heroId de props mudar\n  useEffect(() => {\n    if (heroId) setLocalHeroId(heroId);\n  }, [heroId]);\n\n  // Garantir seleo vlida ao carregar ou quando a lista de heris muda\n  useEffect(() => {\n    if (!localHeroId && heroes.length > 0) {\n      setLocalHeroId(getSelectedHero()?.id ?? heroes[0].id);\n    }\n  }, [heroes, localHeroId]);\n\n  // Usar o heri escolhido localmente por padro\n  const currentHero = (localHeroId ? heroes.find(h => h.id === localHeroId) : undefined)\n    || getSelectedHero() \n    || heroes[0];\n\n  // Verificar e inicializar rankData para heris existentes (migrao)\n  useEffect(() => {\n    if (currentHero && !currentHero.rankData) {\n      const initializedRankData = rankSystem.initializeRankData(currentHero);\n      updateHero(currentHero.id, { rankData: initializedRankData });\n    }\n  }, [currentHero]);\n  const rankProgress = currentHero ? getHeroRankProgress(currentHero.id) : null;\n  const leaderboard = getRankLeaderboard();\n\n  const filteredHistory = useMemo(() => {\n    if (!currentHero?.rankData?.rankHistory) return [];\n    \n    if (historyFilter === 'all') {\n      return currentHero.rankData.rankHistory;\n    }\n    \n    return currentHero.rankData.rankHistory.filter(entry => entry.rank === historyFilter);\n  }, [currentHero?.rankData?.rankHistory, historyFilter]);\n\n  const comparisonData = useMemo(() => {\n    if (!currentHero || !selectedHeroForComparison) return null;\n    \n    const compareHero = heroes.find(h => h.id === selectedHeroForComparison);\n    if (!compareHero) return null;\n    \n    return {\n      current: currentHero,\n      compare: compareHero,\n      currentProgress: getHeroRankProgress(currentHero.id),\n      compareProgress: getHeroRankProgress(compareHero.id)\n    };\n  }, [currentHero, selectedHeroForComparison, heroes]);\n\n  if (!currentHero || !rankProgress) {\n    return (\n      <div className={`bg-gray-900 border border-gray-700 rounded-lg p-6 ${className}`}>\n        <div className=\"text-center text-slate-400\">\n          <Trophy className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n          <p>Nenhum heri selecionado para anlise de evoluo</p>\n        </div>\n      </div>\n    );\n  }\n\n  const handlePromotion = () => {\n    if (rankProgress.progress.canPromote) {\n      const promoted = promoteHero(currentHero.id);\n      if (promoted) {\n        resumeAudioContextIfNeeded();\n        playLevelUp();\n      }\n    }\n  };\n\n  const renderOverview = () => (\n    <div className=\"space-y-6\">\n      {/* Hero Summary */}\n      <div className={`bg-gradient-to-r from-amber-900/20 to-yellow-900/20 rounded-lg p-6 border ${seasonalBorder}`}>\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h3 className=\"text-xl font-bold text-amber-100\">{currentHero.name}</h3>\n            <p className=\"text-amber-300\">{currentHero.class}  {currentHero.race}</p>\n          </div>\n          <LocalRankCard rank={rankProgress.progress.currentRank} size=\"large\" />\n        </div>\n        <div className=\"mt-2 flex items-center gap-3\">\n          <label className=\"text-xs text-amber-300\">Selecionar heri:</label>\n          <select\n            value={localHeroId ?? ''}\n            onChange={(e) => setLocalHeroId(e.target.value)}\n            className=\"bg-slate-800 text-amber-100 text-sm px-2 py-1 rounded border border-amber-700/40\"\n          >\n            {heroes.map(h => (\n              <option key={h.id} value={h.id}>{h.name}</option>\n            ))}\n          </select>\n        </div>\n        \n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-amber-100\">{currentHero.progression.level}</div>\n            <div className=\"text-sm text-amber-300\">Nvel</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-amber-100\">{(currentHero.progression.xp || 0).toLocaleString()}</div>\n            <div className=\"text-sm text-amber-300\">XP Total</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-amber-100\">{currentHero.stats.questsCompleted}</div>\n            <div className=\"text-sm text-amber-300\">Misses</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-amber-100\">{rankProgress.rankData.totalRankPoints}</div>\n            <div className=\"text-sm text-amber-300\">Pontos de Rank</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Quick Progress */}\n      <RankProgress \n        progress={rankProgress.progress}\n        estimate={rankProgress.estimate}\n        onPromote={handlePromotion}\n        variant=\"detailed\"\n      />\n\n      {/* Recent Achievements */}\n            {rankProgress.rankData?.rankHistory && rankProgress.rankData.rankHistory.length > 0 && (\n        <div className=\"bg-gray-900 border border-gray-700 rounded-lg p-6\">\n          <h4 className=\"text-lg font-semibold text-slate-100 mb-4 flex items-center\">\n            <Award className=\"w-5 h-5 mr-2 text-amber-400\" />\n            Conquistas Recentes\n          </h4>\n          <div className=\"space-y-2\">\n            {rankProgress.rankData.rankHistory.slice(-3).slice().reverse().map((entry, index) => (\n              <div key={index} className=\"flex items-center justify-between p-3 bg-slate-600 rounded\">\n                <div className=\"flex items-center\">\n                  <LocalRankCard rank={entry.rank} size=\"small\" />\n                  <div className=\"ml-3\">\n                    <div className=\"text-slate-100 font-medium\">Promovido para Rank {entry.rank}</div>\n                    <div className=\"text-slate-400 text-sm\">\n                      {new Date(entry.achievedAt).toLocaleDateString('pt-BR')}\n                    </div>\n                  </div>\n                </div>\n                {entry.notableAchievement && (\n                  <div className=\"text-purple-300 text-sm\">{entry.notableAchievement}</div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n\n  const renderProgress = () => (\n    <div className=\"space-y-6\">\n      <RankProgress \n        progress={rankProgress.progress}\n        estimate={rankProgress.estimate}\n        onPromote={handlePromotion}\n        variant=\"detailed\"\n      />\n      \n      {/* Detailed Requirements */}\n        <div className=\"bg-gray-900 border border-gray-700 rounded-lg p-6\">\n        <h4 className=\"text-lg font-semibold text-slate-100 mb-4 flex items-center\">\n          <Target className=\"w-5 h-5 mr-2 text-blue-400\" />\n          Anlise Detalhada de Progresso\n        </h4>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {/* XP Progress */}\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-300\">Experincia</span>\n              <span className=\"text-slate-400\">\n                {(rankProgress.progress.currentXP || 0).toLocaleString()} / {(rankProgress.progress.requiredXP || 0).toLocaleString()}\n              </span>\n            </div>\n            <div className=\"w-full bg-slate-600 rounded-full h-2 overflow-hidden\">\n              {(() => {\n                const pct = Math.max(0, Math.min(100,\n                  ((rankProgress.progress.currentXP || 0) / Math.max(1, (rankProgress.progress.requiredXP || 0))) * 100\n                ));\n                return (\n                  <div\n                    className=\"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-500\"\n                    style={{ width: `${pct}%` }}\n                  />\n                );\n              })()}\n            </div>\n            <div className=\"text-xs text-slate-400\">\n              {rankProgress.progress.nextRank ? \n                `Faltam ${((rankProgress.progress.requiredXP || 0) - (rankProgress.progress.currentXP || 0)).toLocaleString()} XP` :\n                'Rank mximo atingido!'\n              }\n            </div>\n          </div>\n\n          {/* Missions Progress */}\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-300\">Misses</span>\n              <span className=\"text-slate-400\">\n                {rankProgress.progress.currentMissions || 0} / {rankProgress.progress.requiredMissions || 0}\n              </span>\n            </div>\n            <div className=\"w-full bg-slate-600 rounded-full h-2 overflow-hidden\">\n              {(() => {\n                const pct = Math.max(0, Math.min(100,\n                  ((rankProgress.progress.currentMissions || 0) / Math.max(1, (rankProgress.progress.requiredMissions || 0))) * 100\n                ));\n                return (\n                  <div\n                    className=\"bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500\"\n                    style={{ width: `${pct}%` }}\n                  />\n                );\n              })()}\n            </div>\n            <div className=\"text-xs text-slate-400\">\n              {rankProgress.progress.nextRank ? \n                `Faltam ${(rankProgress.progress.requiredMissions || 0) - (rankProgress.progress.currentMissions || 0)} misses` :\n                'Todas as misses concludas!'\n              }\n            </div>\n            {/* Mensagem acima j cobre o restante de misses; removendo duplicao */}\n          </div>\n        </div>\n\n        {/* Time Estimate */}\n        {rankProgress.estimate && (\n          <div className=\"mt-6 p-4 bg-gray-800 rounded-lg\">\n            <div className=\"flex items-center mb-2\">\n              <Clock className=\"w-4 h-4 mr-2 text-amber-400\" />\n              <span className=\"text-slate-200 font-medium\">Estimativa para Prximo Rank</span>\n            </div>\n            <div className=\"text-slate-300\">\n              {rankProgress.estimate.estimatedDays} dias ({rankProgress.estimate.estimatedHours} horas de jogo)\n            </div>\n            <div className=\"text-xs text-slate-400 mt-1\">\n              Baseado no seu ritmo atual de progresso\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  const renderHistory = () => (\n    <div className=\"space-y-6\">\n      {/* Filter */}\n      <div className=\"flex items-center justify-between\">\n        <h4 className=\"text-lg font-semibold text-slate-100 flex items-center\">\n          <Calendar className=\"w-5 h-5 mr-2 text-purple-400\" />\n          Histrico de Ranks\n        </h4>\n        <select\n          value={historyFilter}\n          onChange={(e) => setHistoryFilter(e.target.value as RankLevel | 'all')}\n          className=\"bg-slate-700 border border-slate-600 rounded px-3 py-1 text-slate-200\"\n        >\n          <option value=\"all\">Todos os Ranks</option>\n          <option value=\"S\">Rank S</option>\n          <option value=\"A\">Rank A</option>\n          <option value=\"B\">Rank B</option>\n          <option value=\"C\">Rank C</option>\n          <option value=\"D\">Rank D</option>\n          <option value=\"E\">Rank E</option>\n          <option value=\"F\">Rank F</option>\n        </select>\n      </div>\n\n      {/* History Timeline */}\n      <div className=\"space-y-4\">\n        {filteredHistory.length === 0 ? (\n          <div className=\"text-center text-gray-400 py-8\">\n            <Trophy className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n            <p>Nenhum histrico encontrado para o filtro selecionado</p>\n          </div>\n        ) : (\n          [...filteredHistory].reverse().map((entry, index) => (\n            <div key={index} className=\"flex items-center p-4 bg-slate-700 rounded-lg\">\n              <LocalRankCard rank={entry.rank} size=\"medium\" />\n              <div className=\"ml-4 flex-1\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-slate-100 font-medium\">\n                      Promovido para Rank {entry.rank}\n                    </div>\n                    <div className=\"text-slate-400 text-sm\">\n                      {new Date(entry.achievedAt).toLocaleDateString('pt-BR', {\n                        year: 'numeric',\n                        month: 'long',\n                        day: 'numeric',\n                        hour: '2-digit',\n                        minute: '2-digit'\n                      })}\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    {entry.notableAchievement && (\n                      <div className=\"text-purple-300 text-sm\">{entry.notableAchievement}</div>\n                    )}\n                  </div>\n                </div>\n                {entry.specialAchievement && (\n                  <div className=\"mt-2 text-sm text-purple-300\">\n                     {entry.specialAchievement}\n                  </div>\n                )}\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n    </div>\n  );\n\n  const renderLeaderboard = () => (\n    <div className=\"space-y-6\">\n      <h4 className=\"text-lg font-semibold text-slate-100 flex items-center\">\n        <Users className=\"w-5 h-5 mr-2 text-green-400\" />\n        Ranking Global\n      </h4>\n\n      <div className=\"space-y-3\">\n        {leaderboard.map((entry, index) => (\n          <div \n            key={entry.heroId}\n            className={`flex items-center p-4 rounded-lg ${\n              entry.heroId === currentHero.id \n                ? 'bg-gradient-to-r from-amber-900/30 to-yellow-900/30 border border-amber-700/50' \n                : 'bg-gray-900 border border-gray-700'\n            }`}\n          >\n            <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-slate-600 text-slate-200 font-bold mr-4\">\n              {entry.position}\n            </div>\n            \n            <LocalRankCard rank={entry.rank} size=\"small\" />\n            \n            <div className=\"ml-3 flex-1\">\n              <div className=\"text-slate-100 font-medium\">{entry.heroName}</div>\n              <div className=\"text-slate-400 text-sm\">{entry.heroClass}</div>\n            </div>\n            \n            <div className=\"text-right\">\n              <div className=\"text-amber-400 font-bold\">{entry.rankPoints}</div>\n              <div className=\"text-slate-400 text-sm\">pontos</div>\n            </div>\n            \n            {entry.heroId === currentHero.id && (\n              <Star className=\"w-5 h-5 ml-2 text-amber-400\" />\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n\n  const renderComparison = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h4 className=\"text-lg font-semibold text-slate-100 flex items-center\">\n          <BarChart3 className=\"w-5 h-5 mr-2 text-cyan-400\" />\n          Comparao de Heris\n        </h4>\n        <select\n          value={selectedHeroForComparison}\n          onChange={(e) => setSelectedHeroForComparison(e.target.value)}\n          className=\"bg-slate-700 border border-slate-600 rounded px-3 py-1 text-slate-200\"\n        >\n          <option value=\"\">Selecione um heri para comparar</option>\n          {heroes.filter(h => h.id !== currentHero.id).map(hero => (\n            <option key={hero.id} value={hero.id}>\n              {hero.name} ({hero.class})\n            </option>\n          ))}\n        </select>\n      </div>\n\n      {comparisonData ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {/* Current Hero */}\n          <div className=\"bg-gray-900 border border-gray-700 rounded-lg p-6\">\n            <div className=\"text-center mb-4\">\n              <h5 className=\"text-lg font-semibold text-slate-100\">{comparisonData.current.name}</h5>\n              <p className=\"text-slate-400\">{comparisonData.current.class}</p>\n              <div className=\"mt-2\">\n                <LocalRankCard rank={comparisonData.currentProgress?.progress.currentRank || 'F'} size=\"large\" />\n              </div>\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Nvel</span>\n                <span className=\"text-slate-100\">{comparisonData.current.level}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">XP Total</span>\n                <span className=\"text-slate-100\">{(comparisonData.current.progression.xp || 0).toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Misses</span>\n                <span className=\"text-slate-100\">{comparisonData.current.stats.questsCompleted}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Pontos de Rank</span>\n                <span className=\"text-slate-100\">{comparisonData.currentProgress?.rankData.totalRankPoints || 0}</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Compare Hero */}\n          <div className=\"bg-slate-700 rounded-lg p-6\">\n            <div className=\"text-center mb-4\">\n              <h5 className=\"text-lg font-semibold text-slate-100\">{comparisonData.compare.name}</h5>\n              <p className=\"text-slate-400\">{comparisonData.compare.class}</p>\n              <LocalRankCard rank={comparisonData.compareProgress?.progress.currentRank || 'F'} size=\"large\" className=\"mt-2\" />\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Nvel</span>\n                <span className=\"text-slate-100\">{comparisonData.compare.level}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">XP Total</span>\n                <span className=\"text-slate-100\">{(comparisonData.compare.progression.xp || 0).toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Misses</span>\n                <span className=\"text-slate-100\">{comparisonData.compare.stats.questsCompleted}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-300\">Pontos de Rank</span>\n                <span className=\"text-slate-100\">{comparisonData.compareProgress?.rankData.totalRankPoints || 0}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center text-slate-400 py-8\">\n          <BarChart3 className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n          <p>Selecione um heri para comparar</p>\n        </div>\n      )}\n    </div>\n  );\n\n  const viewModes = [\n    { id: 'overview', label: 'Viso Geral', icon: TrendingUp },\n    { id: 'progress', label: 'Progresso', icon: Target },\n    { id: 'history', label: 'Histrico', icon: Calendar },\n    { id: 'leaderboard', label: 'Ranking', icon: Users },\n    { id: 'comparison', label: 'Comparao', icon: BarChart3 }\n  ] as const;\n\n  return (\n    <div className={`bg-slate-800 rounded-lg ${className}`}>\n      {/* Header */}\n      <div className=\"p-6 border-b border-slate-700\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-2\">\n            <h2 className=\"text-2xl font-bold text-slate-100 flex items-center font-serif tracking-wide\">\n              <Trophy className=\"w-6 h-6 mr-2 text-amber-400\" />\n              Painel de Evoluo\n            </h2>\n            {(() => {\n              const cfg = (seasonalThemes as any)[activeSeasonalTheme || ''];\n              const accents: string[] = cfg?.accents || [];\n              return accents.length ? (\n                <div className=\"text-xl opacity-80\">{accents[0]}{accents[1]}{accents[2]}</div>\n              ) : null;\n            })()}\n          </div>\n          {(rankProgress.rankData?.pendingCelebrations?.length || 0) > 0 && (\n            <div className=\"bg-amber-500 text-amber-900 px-3 py-1 rounded-full text-sm font-medium\">\n              {rankProgress.rankData?.pendingCelebrations?.length || 0} nova(s) conquista(s)!\n            </div>\n          )}\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex flex-wrap gap-2 sm:space-x-1 bg-slate-700 rounded-lg p-1 overflow-x-auto\">\n          {viewModes.map(({ id, label, icon: Icon }) => (\n            <button\n              key={id}\n              onClick={() => setViewMode(id as ViewMode)}\n              className={`flex items-center px-2 sm:px-3 py-2 rounded-md text-xs sm:text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ${\n                viewMode === id\n                  ? 'bg-slate-600 text-slate-100'\n                  : 'text-slate-400 hover:text-slate-200 hover:bg-slate-600/50'\n              }`}\n            >\n              <Icon className=\"w-4 h-4 mr-2\" />\n              {label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"p-6\">\n        {viewMode === 'overview' && renderOverview()}\n        {viewMode === 'progress' && renderProgress()}\n        {viewMode === 'history' && renderHistory()}\n        {viewMode === 'leaderboard' && renderLeaderboard()}\n        {viewMode === 'comparison' && renderComparison()}\n      </div>\n    </div>\n  );\n};\n","import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { RankCelebration as RankCelebrationData, RankLevel } from '../types/ranks';\nimport { RankCard } from './RankCard';\nimport { RankPromotionAnimation } from './RankAnimations';\nimport { \n  Trophy, \n  Star, \n  Sparkles, \n  Crown, \n  Zap, \n  X,\n  ChevronRight,\n  Gift\n} from 'lucide-react';\n\ninterface RankCelebrationProps {\n  celebration: RankCelebrationData;\n  onClose: () => void;\n  onViewRewards?: () => void;\n  className?: string;\n}\n\nexport const RankCelebration: React.FC<RankCelebrationProps> = ({\n  celebration,\n  onClose,\n  onViewRewards,\n  className = ''\n}) => {\n  const [isVisible, setIsVisible] = useState(true);\n  const [showRewards, setShowRewards] = useState(false);\n  const [animationPhase, setAnimationPhase] = useState<'intro' | 'celebrate' | 'rewards'>('intro');\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // Trigger entrance animation\n    const timer1 = setTimeout(() => setIsVisible(true), 100);\n    const timer2 = setTimeout(() => setAnimationPhase('celebrate'), 800);\n    const timer3 = setTimeout(() => setAnimationPhase('rewards'), 2000);\n\n    return () => {\n      clearTimeout(timer1);\n      clearTimeout(timer2);\n      clearTimeout(timer3);\n    };\n  }, []);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    setTimeout(onClose, 300);\n  };\n\n  const getRankIcon = (rank: RankLevel) => {\n    switch (rank) {\n      case 'S': return Crown;\n      case 'SS': return Crown;\n      case 'SSS': return Crown;\n      case 'A': return Trophy;\n      case 'B': return Star;\n      case 'C': return Sparkles;\n      case 'D': return Zap;\n      default: return Trophy;\n    }\n  };\n\n  const getRankColor = (rank: RankLevel) => {\n    switch (rank) {\n      case 'S': return 'from-purple-500 to-pink-500';\n      case 'SS': return 'from-amber-500 to-yellow-500';\n      case 'SSS': return 'from-yellow-400 to-amber-600';\n      case 'A': return 'from-yellow-500 to-orange-500';\n      case 'B': return 'from-blue-500 to-cyan-500';\n      case 'C': return 'from-green-500 to-emerald-500';\n      case 'D': return 'from-gray-500 to-slate-500';\n      case 'E': return 'from-orange-500 to-red-500';\n      case 'F': return 'from-red-500 to-pink-500';\n      default: return 'from-gray-500 to-slate-500';\n    }\n  };\n\n  const RankIcon = getRankIcon(celebration.newRank);\n\n  return (\n    <>\n      {/* Animao principal de promoo */}\n      <RankPromotionAnimation\n        isVisible={isVisible && !showRewards}\n        newRank={celebration.newRank}\n        onComplete={() => setShowRewards(true)}\n      />\n\n      {/* Modal de recompensas */}\n      <AnimatePresence>\n        {isVisible && showRewards && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80\"\n            onClick={handleClose}\n          >\n            <motion.div\n              initial={{ scale: 0, y: 50 }}\n              animate={{ scale: 1, y: 0 }}\n              exit={{ scale: 0, y: 50 }}\n              transition={{ duration: 0.5, ease: \"easeOut\" }}\n              className=\"bg-gradient-to-br from-purple-900 to-blue-900 p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 text-center border border-purple-500\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <div className=\"relative z-10\">\n                <motion.div\n                  animate={{ rotate: [0, 10, -10, 0] }}\n                  transition={{ duration: 0.5, repeat: 2 }}\n                  className=\"text-4xl mb-4\"\n                >\n                  \n                </motion.div>\n\n                <h2 className=\"text-2xl font-bold text-yellow-400 mb-4\">\n                  Recompensas de Rank!\n                </h2>\n\n                {/* Recompensas */}\n                {celebration.rewards && celebration.rewards.length > 0 && (\n                  <div className=\"mb-6\">\n                    <div className=\"space-y-2\">\n                      {celebration.rewards.map((reward, index) => (\n                        <motion.div\n                          key={index}\n                          initial={{ x: -20, opacity: 0 }}\n                          animate={{ x: 0, opacity: 1 }}\n                          transition={{ delay: index * 0.1 }}\n                          className=\"flex items-center justify-center bg-purple-800 bg-opacity-50 rounded-lg p-3\"\n                        >\n                          <span className=\"text-yellow-400 mr-3 text-lg\">{reward.icon}</span>\n                          <div className=\"text-white\">\n                            <span className=\"font-semibold\">{reward.name}</span>\n                            <span className=\"block text-sm text-purple-200\">{reward.description}</span>\n                          </div>\n                        </motion.div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                <motion.button\n                  initial={{ y: 20, opacity: 0 }}\n                  animate={{ y: 0, opacity: 1 }}\n                  transition={{ delay: 0.5 }}\n                  whileHover={{ scale: 1.05 }}\n                  whileTap={{ scale: 0.95 }}\n                  onClick={handleClose}\n                  className=\"bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-yellow-600 hover:to-orange-600 transition-all duration-200 shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                >\n                  Continuar Jornada\n                </motion.button>\n\n                \n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </>\n  );\n};\n\n// Component for managing multiple celebrations\ninterface RankCelebrationManagerProps {\n  celebrations: RankCelebrationData[];\n  onCelebrationViewed: (index: number) => void;\n  onViewRewards?: (celebration: RankCelebrationData) => void;\n}\n\nexport const RankCelebrationManager: React.FC<RankCelebrationManagerProps> = ({\n  celebrations,\n  onCelebrationViewed,\n  onViewRewards\n}) => {\n  const [currentIndex, setCurrentIndex] = useState(0);\n\n  if (celebrations.length === 0) return null;\n\n  const handleClose = () => {\n    onCelebrationViewed(currentIndex);\n    \n    // Show next celebration if available\n    if (currentIndex < celebrations.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n    }\n  };\n\n  const currentCelebration = celebrations[currentIndex];\n\n  return (\n    <RankCelebration\n      celebration={currentCelebration}\n      onClose={handleClose}\n      onViewRewards={onViewRewards ? () => onViewRewards(currentCelebration) : undefined}\n    />\n  );\n};\n","import React from 'react';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes } from '../styles/medievalTheme';\n\ninterface Props {\n  children: React.ReactNode;\n}\n\nconst FRAME_STYLES: Record<string, string> = {\n  medieval: 'border-amber-500/40 bg-gradient-to-br from-slate-800 to-slate-900 shadow-amber-500/20',\n  futurista: 'border-cyan-400/40 bg-gradient-to-br from-slate-900 to-black shadow-cyan-400/20',\n  noir: 'border-gray-500/40 bg-gradient-to-br from-black to-slate-900 shadow-black/40'\n};\n\nconst DialogueFrame: React.FC<Props> = ({ children }) => {\n  const { activeFrameId, activeSeasonalTheme } = useMonetizationStore();\n  const style = FRAME_STYLES[activeFrameId || 'medieval'] || FRAME_STYLES.medieval;\n  const accents = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.accents || [] : [];\n\n  return (\n    <div className={`rounded-xl p-4 border ${style} relative`}> \n      {accents.length > 0 && (\n        <div className=\"absolute -top-2 -right-2 text-sm opacity-80\">\n          <span className=\"mr-1\">{accents[0]}</span>\n          <span className=\"mr-1\">{accents[1]}</span>\n          <span>{accents[2]}</span>\n        </div>\n      )}\n      {children}\n    </div>\n  );\n};\n\nexport default DialogueFrame;","import React from 'react';\nimport DialogueFrame from './DialogueFrame';\nimport { useMonetizationStore } from '../store/monetizationStore';\n\ninterface Props {\n  open: boolean;\n  onClose: () => void;\n  previewFrameId?: 'medieval' | 'futurista' | 'noir';\n}\n\nconst ThemePreviewModal: React.FC<Props> = ({ open, onClose, previewFrameId }) => {\n  const { setActiveFrame } = useMonetizationStore();\n  if (!open) return null;\n  return (\n    <div className=\"fixed inset-0 z-[1000] flex items-center justify-center\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"relative z-10 w-[92vw] max-w-2xl rounded-2xl border border-white/20 bg-slate-900 shadow-2xl\">\n        <div className=\"p-4 border-b border-white/10 flex items-center justify-between\">\n          <div className=\"text-sm text-gray-200\">Pr-visualizao de Moldura</div>\n          <button onClick={onClose} className=\"text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600\">Fechar</button>\n        </div>\n        <div className=\"p-4 space-y-3\">\n          {/* Temporariamente fora a moldura durante preview */}\n          <div>\n            <DialogueFrame>\n              <div className=\"text-white font-semibold mb-1\">Exemplo de Dilogo</div>\n              <div className=\"text-gray-300\">Uma mensagem aparece com a moldura selecionada para voc avaliar o estilo antes da compra.</div>\n              <div className=\"text-xs text-gray-400 mt-1\">Visual: {previewFrameId || 'medieval'}</div>\n            </DialogueFrame>\n          </div>\n          <div className=\"flex gap-2\">\n            <button onClick={() => setActiveFrame(previewFrameId)} className=\"px-3 py-2 text-xs rounded bg-amber-600 hover:bg-amber-700 text-white\">Aplicar</button>\n            <button onClick={onClose} className=\"px-3 py-2 text-xs rounded bg-gray-700 hover:bg-gray-600\">Cancelar</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ThemePreviewModal;","import React, { useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { useHeroStore } from '../store/heroStore';\nimport { SHOP_CATEGORIES, purchaseItem, canAfford, getDailyOffers, getDiscountedPrice, RARITY_CONFIG } from '../utils/shop';\nimport { Item } from '../types/hero';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport ThemePreviewModal from './ThemePreviewModal';\nimport { trackMetric } from '../utils/metricsSystem';\nimport { seasonalThemes, medievalTheme } from '../styles/medievalTheme';\nimport { tokens } from '../styles/designTokens';\n\nconst Shop: React.FC = () => {\n  const { getSelectedHero, updateHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const { ownedFrames, activeFrameId, setActiveFrame, markPurchase, ownedThemes, activeThemeId, setActiveTheme } = useMonetizationStore();\n  const [previewOpen, setPreviewOpen] = useState(false);\n  const [previewId, setPreviewId] = useState<'medieval'|'futurista'|'noir'|undefined>(undefined);\n  const [activeCategory, setActiveCategory] = useState('consumables');\n  const [showDailyOffers, setShowDailyOffers] = useState(false);\n  const [showForgeServices, setShowForgeServices] = useState(false);\n  const [fusionA, setFusionA] = useState<string>('');\n  const [fusionB, setFusionB] = useState<string>('');\n  useEffect(() => { trackMetric.pageVisited(selectedHero?.id || 'system', '/shop'); trackMetric.featureUsed(selectedHero?.id || 'system', 'shop-open'); }, [])\n\n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-full sm:max-w-4xl mx-auto p-4 sm:p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-xl sm:text-2xl font-bold text-gray-800 mb-2\">Loja do Aventureiro</h2>\n        <p className=\"text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base\">Selecione um heri para acessar a loja.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-4 sm:px-6 py-2 rounded hover:bg-blue-700 transition-colors text-sm sm:text-base\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n\n  const handlePurchase = (itemId: string) => {\n    try { trackMetric.featureUsed(selectedHero.id, 'shop-buy-click') } catch {}\n    const result = purchaseItem(selectedHero, itemId);\n    \n    if (result.success && result.item) {\n      try { trackMetric.itemAcquired(selectedHero.id, { itemId }) } catch {}\n      // Atualizar saldo da moeda correta e inventrio\n      const currency = result.currency || 'gold';\n      const newProgression = { ...selectedHero.progression } as any;\n      if (result.newBalance !== undefined) {\n        if (currency === 'gold') newProgression.gold = result.newBalance;\n        else if (currency === 'glory') newProgression.glory = result.newBalance;\n        else if (currency === 'arcaneEssence') newProgression.arcaneEssence = result.newBalance;\n      } else if (result.newGold !== undefined) {\n        newProgression.gold = result.newGold;\n      }\n\n      updateHero(selectedHero.id, {\n        progression: newProgression,\n        inventory: {\n          ...selectedHero.inventory,\n          items: {\n            ...selectedHero.inventory.items,\n            [itemId]: (selectedHero.inventory.items[itemId] || 0) + 1\n          }\n        }\n      });\n      \n      alert(result.message);\n    } else {\n      try { trackMetric.featureUsed(selectedHero.id, 'shop-buy-denied') } catch {}\n      alert(result.message);\n    }\n  };\n\n  const renderItem = (item: Item, index?: number) => {\n    const canBuy = canAfford(selectedHero, item);\n    const discountedPrice = getDiscountedPrice(item, selectedHero);\n    const hasDiscount = discountedPrice < item.price;\n    const rarity = RARITY_CONFIG[item.rarity];\n\n    return (\n      <div \n        key={`${item.id}-${index ?? 0}`}\n        className={`bg-white p-4 rounded-lg border-2 shadow-sm hover:shadow-md transition-shadow`}\n        style={{ borderColor: rarity.color }}\n      >\n        <div className=\"text-center mb-3\">\n          <div className=\"text-3xl mb-2\">{item.icon || ''}</div>\n          <h3 className=\"font-bold text-gray-800\" style={{ color: rarity.color }}>\n            {item.name}\n          </h3>\n          <p className=\"text-sm text-gray-600 mt-1\">{item.description}</p>\n        </div>\n\n        {/* Bnus */}\n        {item.bonus && (\n          <div className=\"text-xs text-center mb-3 space-y-1\">\n            {Object.entries(item.bonus).map(([stat, value]) => (\n              <div key={stat} className=\"text-green-600\">\n                +{value} {stat.charAt(0).toUpperCase() + stat.slice(1)}\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Efeitos */}\n        {item.effects && (\n          <div className=\"text-xs text-center mb-3 space-y-1\">\n            {item.effects.hp && <div className=\"text-red-600\">+{item.effects.hp} HP</div>}\n            {item.effects.mp && <div className=\"text-blue-600\">+{item.effects.mp} MP</div>}\n            {item.effects.duration && <div className=\"text-purple-600\">Durao: {item.effects.duration}min</div>}\n          </div>\n        )}\n\n        {/* Preo */}\n        <div className=\"text-center mb-3\">\n          {(() => {\n            const currency = item.currency || 'gold';\n            const label = currency === 'gold' ? 'ouro' : currency === 'glory' ? 'glria' : 'essncia arcana';\n            if (hasDiscount) {\n              return (\n                <div>\n                  <span className=\"text-sm text-gray-500 line-through\">{item.price} {label}</span>\n                  <span className=\"text-lg font-bold text-green-600 ml-2\">{discountedPrice} {label}</span>\n                </div>\n              );\n            }\n            return <span className=\"text-lg font-bold text-yellow-600\">{item.price} {label}</span>;\n          })()}\n        </div>\n\n        {/* Boto de compra */}\n        <button\n          onClick={() => handlePurchase(item.id)}\n          disabled={!canBuy}\n          className={`w-full py-2 px-4 rounded font-medium transition-colors ${\n            canBuy\n              ? 'bg-green-600 hover:bg-green-700 text-white'\n              : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n          } focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n        >\n          {(() => {\n            if (canBuy) return 'Comprar';\n            const currency = item.currency || 'gold';\n            const label = currency === 'gold' ? 'Ouro' : currency === 'glory' ? 'Glria' : 'Essncia Arcana';\n            return `${label} Insuficiente`;\n          })()}\n        </button>\n      </div>\n    );\n  };\n\n  const dailyOffers = getDailyOffers();\n\n  const handleRefine = (slot: 'weapon' | 'armor' | 'accessory') => {\n    const ok = useHeroStore.getState().refineEquippedItem(selectedHero.id, slot);\n    alert(ok ? 'Refino realizado! (chance aplicada)' : 'Falha: requisitos no atendidos ou item indisponvel.');\n  };\n\n  const handleFuse = () => {\n    if (!fusionA || !fusionB) {\n      alert('Selecione dois itens para fundir.');\n      return;\n    }\n    const ok = useHeroStore.getState().fuseItems(selectedHero.id, fusionA, fusionB);\n    alert(ok ? 'Fuso concluda! Novo item adicionado ao inventrio.' : 'Falha na fuso (verifique tipos e quantidades).');\n  };\n\n  const handleEnchant = (slot: 'weapon' | 'armor' | 'accessory') => {\n    const ok = useHeroStore.getState().enchantEquippedItem(selectedHero.id, slot, 'lifesteal');\n    alert(ok ? 'Encantamento aplicado: Lifesteal!' : 'Essncia insuficiente ou item no equipado.');\n  };\n\n  return (\n    <div className=\"max-w-full lg:max-w-7xl mx-auto p-4 sm:p-6\">\n      {/* Header */}\n      {(() => { const seasonalBorder = ((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.border) || 'border-amber-500/30'; return (\n      <div className={`text-center mb-6 sm:mb-8 ${medievalTheme.layout.containers.panel} p-6 border ${seasonalBorder}`}>\n        <h1 className=\"text-2xl sm:text-4xl font-bold text-white mb-2\">\n           Loja do Aventureiro\n        </h1>\n        <p className=\"text-slate-300 text-sm sm:text-base\">\n          Equipamentos, consumveis e itens especiais para sua jornada\n        </p>\n        <div className=\"mt-3 sm:mt-4 flex flex-wrap justify-center gap-2\">\n          <div className=\"bg-amber-900/20 border border-amber-500/40 rounded-lg p-2 sm:p-3 inline-block\">\n            <span className=\"text-amber-300 font-medium text-sm sm:text-base\">\n               Ouro: {selectedHero.progression.gold || 0}\n            </span>\n          </div>\n          <div className=\"bg-blue-900/20 border border-blue-500/40 rounded-lg p-2 sm:p-3 inline-block\">\n            <span className=\"text-blue-300 font-medium text-sm sm:text-base\">\n               Glria: {selectedHero.progression.glory || 0}\n            </span>\n          </div>\n          <div className=\"bg-purple-900/20 border border-purple-500/40 rounded-lg p-2 sm:p-3 inline-block\">\n            <span className=\"text-purple-300 font-medium text-sm sm:text-base\">\n               Essncia Arcana: {selectedHero.progression.arcaneEssence || 0}\n            </span>\n          </div>\n        </div>\n        <div className=\"mt-3 sm:mt-4\">\n          <a\n            href=\"#cosmetics\"\n            className=\"inline-block px-3 sm:px-4 py-2 bg-gradient-to-r from-rose-600 to-amber-600 text-white rounded-lg hover:brightness-110 transition-colors text-sm sm:text-base\"\n          >\n             Apoie o projeto (Cosmticos)\n          </a>\n        </div>\n      </div>\n      );})()}\n\n      {/* Navegao */}\n      <div className=\"flex flex-wrap justify-center gap-2 mb-4 sm:mb-6\">\n        <button\n          onClick={() => { setShowDailyOffers(false); setShowForgeServices(false); trackMetric.featureUsed(selectedHero.id, 'shop-tab-catalog'); }}\n          className={`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${(!showDailyOffers && !showForgeServices) ? tokens.tabActive : tokens.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n        >\n          Catlogo Geral\n        </button>\n        <button\n          onClick={() => { setShowDailyOffers(true); setShowForgeServices(false); trackMetric.featureUsed(selectedHero.id, 'shop-tab-daily'); }}\n          className={`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${showDailyOffers ? tokens.tabActive : tokens.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n        >\n           Ofertas Dirias\n        </button>\n        <button\n          onClick={() => { setShowDailyOffers(false); setShowForgeServices(true); trackMetric.featureUsed(selectedHero.id, 'shop-tab-forge'); }}\n          className={`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${showForgeServices ? tokens.tabActive : tokens.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n        >\n           Forja e Encantamentos\n        </button>\n      </div>\n\n      {/* Comunicao de fairness e remover anncios */}\n      <div className=\"max-w-full sm:max-w-4xl mx-auto mb-6\">\n        <div className={`rounded-lg border bg-gray-800 p-3 sm:p-4 ${medievalTheme.effects.shadows.small}`}>\n          <div className=\"text-sm sm:text-base text-gray-200\">\n            O jogo core  gratuito e justo. Compras so 100% opcionais e apenas cosmticas ou narrativas.\n          </div>\n          <div className=\"mt-2 flex flex-wrap gap-2\">\n            <button\n              onClick={async () => {\n                try {\n                  const { startCheckout, verifyPurchase } = await import('../services/paymentsService');\n                  const resp = await startCheckout('remove-ads');\n                  if (resp.ok) {\n                    const v = await verifyPurchase(resp.sessionId || '');\n                    if (v.ok) {\n                      trackMetric.purchaseInitiated(selectedHero.id, 'remove-ads');\n                      markPurchase('remove-ads', { id: resp.sessionId || `rcpt-${Date.now()}` });\n                      useMonetizationStore.getState().removeAdsForever();\n                      trackMetric.purchaseCompleted(selectedHero.id, 'remove-ads', resp.sessionId || undefined);\n                      alert('Anncios removidos. Obrigado pelo apoio!');\n                    }\n                  }\n                } catch {\n                  // fallback local\n                  trackMetric.purchaseInitiated(selectedHero.id, 'remove-ads');\n                  markPurchase('remove-ads', { id: `rcpt-${Date.now()}` });\n                  useMonetizationStore.getState().removeAdsForever();\n                  trackMetric.purchaseCompleted(selectedHero.id, 'remove-ads');\n                  alert('Anncios removidos. Obrigado pelo apoio!');\n                }\n              }}\n              className={`px-3 sm:px-4 py-2 rounded bg-gradient-to-r ${((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.buttonGradient) || 'from-rose-600 to-amber-600'} text-white text-sm sm:text-base hover:brightness-110 flex items-center gap-2`}\n            >\n              {((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.accents?.[0]) || ''}\n              <span>Remover anncios (IAP nico)</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Banner sazonal com link para Premium */}\n      <div className=\"max-w-full sm:max-w-4xl mx-auto mb-6\">\n        <div className=\"rounded-lg border bg-gray-800 p-3 sm:p-4 flex items-center justify-between\">\n          <div className=\"text-sm sm:text-base text-gray-200 flex items-center gap-2\">\n            <span>{((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.accents?.[0]) || ''}</span>\n            <span>Ofertas sazonais disponveis conforme o tema atual.</span>\n          </div>\n          <Link to=\"/premium\" onClick={() => { trackMetric.featureUsed(selectedHero.id, 'shop-premium-banner-click'); }} className={`px-3 py-2 rounded bg-gradient-to-r ${((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.buttonGradient) || 'from-amber-600 to-yellow-600'} text-white text-sm hover:brightness-110`}>Ver Ofertas</Link>\n        </div>\n      </div>\n\n      {showDailyOffers ? (\n        /* Ofertas Dirias */\n        <div>\n          <h2 className=\"text-xl sm:text-2xl font-bold text-center mb-4 sm:mb-6 text-amber-400\">\n             Ofertas Especiais do Dia (20% OFF)\n          </h2>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6\">\n            {dailyOffers.map(renderItem)}\n          </div>\n        </div>\n      ) : showForgeServices ? (\n        /* Forja e Encantamentos */\n        <div>\n          <h2 className=\"text-xl sm:text-2xl font-bold text-center mb-4 sm:mb-6 text-white\"> Forja e Encantamentos</h2>\n\n          {/* Refinar */}\n          <div className=\"mb-6\">\n            <h3 className=\"text-lg sm:text-xl font-semibold mb-3\">Refinar Raridade</h3>\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n              {(['weapon','armor','accessory'] as const).map(slot => {\n                const equippedId = (() => {\n                  if (slot === 'weapon') return selectedHero.inventory.equippedMainHand || selectedHero.inventory.equippedOffHand || selectedHero.inventory.equippedWeapon || (selectedHero.inventory.equippedWeapons || [])[0];\n                  if (slot === 'armor') return selectedHero.inventory.equippedChest || selectedHero.inventory.equippedArmor || (selectedHero.inventory.equippedArmorSlots || [])[0];\n                  return selectedHero.inventory.equippedNecklace || selectedHero.inventory.equippedRingLeft || selectedHero.inventory.equippedRingRight || selectedHero.inventory.equippedAccessory || (selectedHero.inventory.equippedAccessories || [])[0];\n                })();\n                const baseItem = equippedId ? (SHOP_CATEGORIES.weapons.items.concat(SHOP_CATEGORIES.armor.items, SHOP_CATEGORIES.accessories.items).find(i => i.id === equippedId) || selectedHero.inventory.customItems?.[equippedId]) : undefined;\n                const currentRarity = equippedId ? (selectedHero.inventory.refined?.[equippedId] || baseItem?.rarity) : undefined;\n                const label = slot === 'weapon' ? 'Arma' : slot === 'armor' ? 'Armadura' : 'Acessrio';\n                const cfgMap: Record<string, { gold: number; essence: number; nextLabel: string }> = {\n                  'comum': { gold: 100, essence: 10, nextLabel: 'Incomum' },\n                  'incomum': { gold: 200, essence: 20, nextLabel: 'Raro' },\n                  'raro': { gold: 400, essence: 40, nextLabel: 'pico' },\n                  'epico': { gold: 1000, essence: 100, nextLabel: 'Lendrio' }\n                };\n                const cfg = currentRarity ? cfgMap[currentRarity] : undefined;\n                return (\n                  <div key={slot} className=\"p-4 rounded-lg border bg-gray-800 text-gray-200\">\n                    <div className=\"font-semibold\">{label}</div>\n                    <div className=\"text-sm text-gray-600\">{equippedId ? (baseItem?.name || 'Item Personalizado') : 'Nenhum equipado'}</div>\n                    <div className=\"text-sm mt-1\">Raridade: {currentRarity ? currentRarity : '-'}</div>\n                    <button\n                      onClick={() => handleRefine(slot)}\n                      disabled={!equippedId || !cfg}\n                      className={`mt-3 w-full py-2 px-4 rounded ${equippedId && cfg ? 'bg-indigo-600 text-white hover:bg-indigo-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}\n                    >\n                      {cfg ? `Refinar  ${cfg.nextLabel} ( ${cfg.gold},  ${cfg.essence})` : 'No disponvel'}\n                    </button>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Fundir */}\n          <div className=\"mb-6\">\n            <h3 className=\"text-lg sm:text-xl font-semibold mb-3\">Fundir Itens</h3>\n            <p className=\"text-sm text-gray-600 mb-2\">Consome 2 itens do mesmo tipo para criar um novo item nico.</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Item A</label>\n                <select value={fusionA} onChange={e => setFusionA(e.target.value)} className=\"w-full border rounded p-2\">\n                  <option value=\"\">Selecione</option>\n                  {Object.entries(selectedHero.inventory.items)\n                    .map(([id, qty]) => ({ id, qty, item: SHOP_CATEGORIES.weapons.items.concat(SHOP_CATEGORIES.armor.items, SHOP_CATEGORIES.accessories.items).find(i => i.id === id) }))\n                    .filter(e => e.item && e.qty > 0)\n                    .map(e => (\n                      <option key={e.id} value={e.id}>{e.item!.name} (x{e.qty})</option>\n                    ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Item B</label>\n                <select value={fusionB} onChange={e => setFusionB(e.target.value)} className=\"w-full border rounded p-2\">\n                  <option value=\"\">Selecione</option>\n                  {Object.entries(selectedHero.inventory.items)\n                    .map(([id, qty]) => ({ id, qty, item: SHOP_CATEGORIES.weapons.items.concat(SHOP_CATEGORIES.armor.items, SHOP_CATEGORIES.accessories.items).find(i => i.id === id) }))\n                    .filter(e => e.item && e.qty > 0)\n                    .map(e => (\n                      <option key={e.id} value={e.id}>{e.item!.name} (x{e.qty})</option>\n                    ))}\n                </select>\n              </div>\n            </div>\n            <button onClick={handleFuse} className={`mt-3 px-4 py-2 bg-gradient-to-r ${((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.buttonGradient) || 'from-green-600 to-emerald-600'} text-white rounded hover:brightness-110 flex items-center gap-2`}>\n              {((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.accents?.[0]) || ''}\n              <span>Fundir</span>\n            </button>\n          </div>\n\n          {/* Encantar */}\n          <div>\n            <h3 className=\"text-lg sm:text-xl font-semibold mb-3\">Encantar Item</h3>\n            <p className=\"text-sm text-gray-600 mb-2\">Aplica efeito especial (lifesteal) ao item equipado. Custo:  50 Essncia.</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n              {(['weapon','armor','accessory'] as const).map(slot => {\n                const equippedId = (() => {\n                  if (slot === 'weapon') return selectedHero.inventory.equippedMainHand || selectedHero.inventory.equippedOffHand || selectedHero.inventory.equippedWeapon || (selectedHero.inventory.equippedWeapons || [])[0];\n                  if (slot === 'armor') return selectedHero.inventory.equippedChest || selectedHero.inventory.equippedArmor || (selectedHero.inventory.equippedArmorSlots || [])[0];\n                  return selectedHero.inventory.equippedNecklace || selectedHero.inventory.equippedRingLeft || selectedHero.inventory.equippedRingRight || selectedHero.inventory.equippedAccessory || (selectedHero.inventory.equippedAccessories || [])[0];\n                })();\n                const label = slot === 'weapon' ? 'Arma' : slot === 'armor' ? 'Armadura' : 'Acessrio';\n                const enchanted = equippedId ? selectedHero.inventory.enchantments?.[equippedId]?.special : undefined;\n                return (\n                  <div key={slot} className=\"p-4 rounded-lg border bg-gray-800 text-gray-200\">\n                    <div className=\"font-semibold\">{label}</div>\n                    <div className=\"text-sm text-gray-600\">{equippedId ? (SHOP_CATEGORIES.weapons.items.concat(SHOP_CATEGORIES.armor.items, SHOP_CATEGORIES.accessories.items).find(i => i.id === equippedId)?.name || 'Item Personalizado') : 'Nenhum equipado'}</div>\n                    <div className=\"text-sm mt-1\">Encanto: {enchanted ? enchanted : '-'}</div>\n                    <button\n                      onClick={() => handleEnchant(slot)}\n                      disabled={!equippedId}\n                      className={`mt-3 w-full py-2 px-4 rounded ${equippedId ? `bg-gradient-to-r ${((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.buttonGradient) || 'from-purple-600 to-violet-600'} text-white hover:brightness-110 flex items-center gap-2` : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}\n                    >\n                      {equippedId ? (((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.accents?.[0]) || '') : ''}\n                      <span>Encantar (Lifesteal)</span>\n                    </button>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      ) : (\n        /* Catlogo Geral */\n        <div>\n          {/* Categorias */}\n          <div className=\"flex flex-wrap justify-center gap-2 mb-4 sm:mb-6\">\n            {Object.entries(SHOP_CATEGORIES).map(([key, category]) => (\n              <button\n                key={key}\n                onClick={() => setActiveCategory(key)}\n                className={`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${activeCategory === key ? tokens.tabActive : tokens.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n              >\n                {category.icon} {category.name}\n              </button>\n            ))}\n          </div>\n\n          {/* Itens da categoria */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6\">\n            {SHOP_CATEGORIES[activeCategory as keyof typeof SHOP_CATEGORIES].items.map(renderItem)}\n          </div>\n\n          {/* Cosmticos e Premium (visual) */}\n          <div id=\"cosmetics\" className=\"mt-8 sm:mt-12\">\n            <h2 className=\"text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-white\"> Cosmticos (visual) e Premium</h2>\n            <p className=\"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base\">Personalize molduras e fundos do heri. Itens premium so opcionais e no afetam o balanceamento narrativo.</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6\">\n              {[{\n                id: 'frame-gold', name: 'Moldura Dourada', icon: '', req: '500 XP', unlocked: (selectedHero.progression.xp || 0) >= 500\n              }, {\n                id: 'frame-royal', name: 'Moldura Real', icon: '', req: 'Rank B+', unlocked: (selectedHero.rankData?.currentRank || 'F') <= 'B'\n              }, {\n                id: 'bg-aurora', name: 'Fundo Aurora', icon: '', req: 'Reputao 10+', unlocked: (selectedHero.progression.reputation || 0) >= 10\n              }, {\n                id: 'frame-futurista', name: 'Moldura Futurista (Premium)', icon: '', req: 'Produto Premium', unlocked: ownedFrames.includes('futurista')\n              }, {\n                id: 'frame-noir', name: 'Moldura Noir (Premium)', icon: '', req: 'Produto Premium', unlocked: ownedFrames.includes('noir')\n              }, {\n                id: 'theme-futurista', name: 'Tema Futurista (Premium)', icon: '', req: 'Tema Premium', unlocked: ownedThemes.includes('futurista')\n              }, {\n                id: 'theme-noir', name: 'Tema Noir (Premium)', icon: '', req: 'Tema Premium', unlocked: ownedThemes.includes('noir')\n              }, {\n                id: 'season-natal', name: 'Tema Sazonal: Festival de Inverno', icon: '', req: 'Sazonal', unlocked: true\n              }, {\n                id: 'season-pascoa', name: 'Tema Sazonal: Renascimento Rnico', icon: '', req: 'Sazonal', unlocked: true\n              }, {\n                id: 'season-ano-novo', name: 'Tema Sazonal: Profecias do Ano Novo', icon: '', req: 'Sazonal', unlocked: true\n              }, {\n                id: 'season-carnaval', name: 'Tema Sazonal: Mascarada dos Bardos', icon: '', req: 'Sazonal', unlocked: true\n              }].map(c => (\n                <div key={c.id} className={`p-3 sm:p-4 rounded-lg border ${c.unlocked ? 'border-emerald-500/40 bg-emerald-900/10' : 'border-slate-600 bg-slate-800'} text-white`}>\n                  <div className=\"text-2xl sm:text-3xl mb-1 sm:mb-2\">{c.icon}</div>\n                  <div className=\"font-semibold text-sm sm:text-base\">{c.name}</div>\n                  <div className=\"text-xs sm:text-sm text-gray-300\">Requisito: {c.req}</div>\n                  <div className=\"mt-2 sm:mt-3 flex gap-2\">\n                <button\n                  onClick={() => { if (c.id.startsWith('frame-')) {\n                    const map: Record<string, any> = { 'frame-gold': 'medieval', 'frame-royal': 'medieval', 'frame-futurista': 'futurista', 'frame-noir': 'noir' };\n                    const target = map[c.id] as ('medieval'|'futurista'|'noir');\n                    setPreviewId(target); setPreviewOpen(true);\n                  }}}\n                  className={`px-3 py-2 rounded-lg text-sm font-medium bg-gray-700 text-white hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                >\n                  Pr-visualizar\n                </button>\n                <button\n                  disabled={!c.unlocked}\n                  onClick={() => { if (c.id.startsWith('frame-')) {\n                    const map: Record<string, any> = { 'frame-gold': 'medieval', 'frame-royal': 'medieval', 'frame-futurista': 'futurista', 'frame-noir': 'noir' };\n                    const target = map[c.id] as ('medieval'|'futurista'|'noir');\n                    setActiveFrame(target);\n                  } else if (c.id.startsWith('theme-')) {\n                    const target = c.id === 'theme-futurista' ? 'futurista' : 'noir';\n                    setActiveTheme(target);\n                  } else if (c.id.startsWith('season-')) {\n                    const map: Record<string, any> = { 'season-natal': 'natal', 'season-pascoa': 'pascoa', 'season-ano_novo': 'ano_novo', 'season-ano-novo': 'ano_novo', 'season-carnaval': 'carnaval' };\n                    const target = map[c.id];\n                    useMonetizationStore.getState().setActiveSeasonalTheme(target);\n                  }}}\n                  className={`px-3 py-2 rounded text-sm font-medium ${c.unlocked ? tokens.tabActive : 'bg-gray-700 text-gray-400 cursor-not-allowed'} focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                >\n                  {c.unlocked ? (\n                    c.id.startsWith('frame-')\n                      ? (activeFrameId === (c.id === 'frame-futurista' ? 'futurista' : c.id === 'frame-noir' ? 'noir' : 'medieval') ? 'Aplicado' : 'Aplicar')\n                      : (c.id.startsWith('theme-')\n                          ? (activeThemeId === (c.id === 'theme-futurista' ? 'futurista' : 'noir') ? 'Aplicado' : 'Aplicar')\n                          : 'Aplicar')\n                  ) : 'Bloqueado'}\n                </button>\n                    {c.id === 'frame-futurista' || c.id === 'frame-noir' || c.id === 'theme-futurista' || c.id === 'theme-noir' ? (\n                      <button\n                        onClick={() => {\n                          const target = c.id.endsWith('futurista') ? 'futurista' : 'noir';\n                          if (c.id.startsWith('frame-')) {\n                            if (!ownedFrames.includes(target)) {\n                              trackMetric.purchaseInitiated(selectedHero.id, `frame-${target}`);\n                              markPurchase(`frame-${target}`, { id: `rcpt-${Date.now()}` });\n                              trackMetric.purchaseCompleted(selectedHero.id, `frame-${target}`);\n                            }\n                          } else {\n                            if (!ownedThemes.includes(target)) {\n                              trackMetric.purchaseInitiated(selectedHero.id, `theme-${target}`);\n                              markPurchase(`theme-${target}`, { id: `rcpt-${Date.now()}` });\n                              trackMetric.purchaseCompleted(selectedHero.id, `theme-${target}`);\n                            }\n                          }\n                        }}\n                        className={`px-3 py-2 rounded-lg text-sm font-medium bg-gradient-to-r ${((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.buttonGradient) || 'from-amber-600 to-yellow-600'} text-white hover:brightness-110 flex items-center gap-2`}\n                      >\n                        {((seasonalThemes as any)[useMonetizationStore.getState().activeSeasonalTheme || '']?.accents?.[0]) || ''}\n                        <span>Comprar Premium</span>\n                      </button>\n                    ) : null}\n                  </div>\n                </div>\n              ))}\n            </div>\n            <div className=\"mt-6 text-sm text-gray-300\">\n              Itens premium so opcionais; servem apenas para personalizao visual.\n            </div>\n          </div>\n          <ThemePreviewModal open={previewOpen} previewFrameId={previewId} onClose={() => setPreviewOpen(false)} />\n          {/* Contedo Premium: DLCs, Final Alternativo, Passe e Tip Jar */}\n          <div id=\"premium-content\" className=\"mt-10\">\n            <h2 className=\"text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-white\"> Contedo Premium</h2>\n            <p className=\"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base\">Opcional, narrativo e sem impacto em balanceamento. Gratuito permanece completo.</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6\">\n              <div className=\"p-4 rounded-lg border bg-gray-800 text-white\">\n                <div className=\"font-semibold\">Captulo Bnus: Ecos do Destino</div>\n                <div className=\"text-sm text-gray-600 mb-2\">Adiciona um captulo extra  sua jornada com cenas exclusivas.</div>\n                <button\n                  onClick={() => {\n                    trackMetric.purchaseInitiated(selectedHero.id, 'dlc-ecos-destino');\n                    markPurchase('dlc-ecos-destino', { id: `rcpt-${Date.now()}` });\n                    if (selectedHero) {\n                      const now = new Date().toISOString();\n                      const chapters = selectedHero.journeyChapters || [];\n                      const bonus = {\n                        id: `dlc-bonus-${selectedHero.id}`,\n                        index: (chapters.length || 0) + 1,\n                        title: 'Captulo Bnus: Ecos do Destino',\n                        summary: 'Um eco misterioso revela caminhos ocultos e memrias antigas.',\n                        createdAt: now,\n                        levelMilestone: selectedHero.progression.level,\n                        locked: false,\n                        relatedQuests: selectedHero.completedQuests || []\n                      } as any;\n                      updateHero(selectedHero.id, { journeyChapters: [...chapters, bonus] });\n                    }\n                    trackMetric.purchaseCompleted(selectedHero.id, 'dlc-ecos-destino');\n                  }}\n                  className=\"mt-2 px-3 py-2 rounded bg-amber-600 text-white hover:bg-amber-700\"\n                >Comprar DLC</button>\n              </div>\n              <div className=\"p-4 rounded-lg border bg-gray-800 text-white\">\n                <div className=\"font-semibold\">Final Alternativo: Caminho das Sombras</div>\n                <div className=\"text-sm text-gray-600 mb-2\">Desbloqueia um eplogo alternativo com escolhas dramticas.</div>\n                <button\n                  onClick={() => { markPurchase('dlc-final-sombras', { id: `rcpt-${Date.now()}` }); }}\n                  className=\"mt-2 px-3 py-2 rounded bg-amber-600 text-white hover:bg-amber-700\"\n                >Comprar DLC</button>\n              </div>\n              <div className=\"p-4 rounded-lg border bg-gray-800 text-white\">\n                <div className=\"font-semibold\">Passe de Temporada</div>\n                <div className=\"text-sm text-gray-600 mb-2\">Contedo narrativo exclusivo por temporada.</div>\n                <button\n                  onClick={() => { trackMetric.purchaseInitiated(selectedHero.id, 'season-pass'); markPurchase('season-pass', { id: `rcpt-${Date.now()}` }); trackMetric.purchaseCompleted(selectedHero.id, 'season-pass'); }}\n                  className=\"mt-2 px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700\"\n                >Ativar Passe</button>\n              </div>\n              <div className=\"p-4 rounded-lg border bg-gray-800 text-white\">\n                <div className=\"font-semibold\">Apoio ao Criador (Tip Jar)</div>\n                <div className=\"text-sm text-gray-600 mb-2\">Recompensas simblicas: emblemas e molduras de agradecimento.</div>\n                <div className=\"flex gap-2\">\n                  {['bronze','silver','gold'].map(l => (\n                    <button key={l}\n                      onClick={() => { trackMetric.purchaseInitiated(selectedHero.id, `tip-${l}`); markPurchase(`tip-${l}`, { id: `rcpt-${Date.now()}` }); trackMetric.purchaseCompleted(selectedHero.id, `tip-${l}`); }}\n                      className={`px-3 py-2 rounded ${l==='gold' ? 'bg-yellow-600' : l==='silver' ? 'bg-gray-400' : 'bg-orange-600'} text-white hover:opacity-90`}\n                    >{l==='bronze' ? 'Bronze' : l==='silver' ? 'Prata' : 'Ouro'}</button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Shop;\n","/**\n * Sistema de Misses Aprimoradas com Decises e Consequncias\n * Implementa o novo sistema de narrativa procedural\n */\n\nimport { EnhancedQuest, EnhancedQuestChoice, Hero } from '../types/hero';\nimport { worldStateManager } from './worldState';\n\n// Templates de misses com decises complexas\nconst ENHANCED_MISSION_TEMPLATES: Omit<EnhancedQuest, 'id' | 'status'>[] = [\n  {\n    title: 'Bando de Ladres na Estrada',\n    description: 'Um grupo de bandidos est atacando comerciantes na estrada principal.',\n    type: 'narrative',\n    difficulty: 'medio',\n    levelRequirement: 2,\n    timeLimit: 3,\n    rewards: { gold: 80, xp: 120 },\n    repeatable: false,\n    location: 'Estrada do Norte',\n    narrative: {\n      intro: 'Voc encontra um grupo de bandidos atacando uma caravana de comerciantes.',\n      situation: 'Os bandidos parecem estar em vantagem numrica, mas voc pode tentar diferentes abordagens...'\n    },\n    enhancedChoices: [\n      {\n        id: 'frontal-attack',\n        text: 'Ataque Frontal',\n        description: 'Confrontar os bandidos diretamente em combate',\n        riskThreshold: 60,\n        rollModifiers: {\n          attribute: 'forca',\n          multiplier: 3,\n          bonus: 5\n        },\n        successEffects: [\n          { type: 'gold', value: 120, description: 'Recompensa dos comerciantes' },\n          { type: 'xp', value: 150, description: 'Experincia de combate' },\n          { type: 'reputation', target: 'Comerciantes', value: 15 },\n          { type: 'reputation', target: 'Guarda da Cidade', value: 10 },\n          { type: 'reputation', target: 'Bandidos', value: -20 }\n        ],\n        failureEffects: [\n          { type: 'gold', value: -30, description: 'Ferimentos custaram poes' },\n          { type: 'reputation', target: 'Bandidos', value: -5 },\n          { type: 'npc_relation', target: 'Mercador Aldric', value: 5, description: 'Tentativa valorizada' }\n        ],\n        requirements: {\n          level: 2\n        }\n      },\n      {\n        id: 'negotiate',\n        text: 'Negociar',\n        description: 'Tentar negociar a libertao dos comerciantes',\n        riskThreshold: 45,\n        rollModifiers: {\n          attribute: 'carisma',\n          multiplier: 4,\n          bonus: 0\n        },\n        successEffects: [\n          { type: 'gold', value: -50, description: 'Pagamento aos bandidos' },\n          { type: 'xp', value: 100, description: 'Experincia diplomtica' },\n          { type: 'reputation', target: 'Comerciantes', value: 20 },\n          { type: 'reputation', target: 'Diplomatas', value: 15 },\n          { type: 'reputation', target: 'Bandidos', value: 10 }\n        ],\n        failureEffects: [\n          { type: 'world_event', target: 'bandit_ambush', probability: 0.3 },\n          { type: 'reputation', target: 'Bandidos', value: -10 }\n        ]\n      },\n      {\n        id: 'stealth-rescue',\n        text: 'Resgate Furtivo',\n        description: 'Esperar a oportunidade e resgatar os comerciantes silenciosamente',\n        riskThreshold: 55,\n        rollModifiers: {\n          attribute: 'destreza',\n          multiplier: 3,\n          bonus: 10\n        },\n        successEffects: [\n          { type: 'gold', value: 100, description: 'Recompensa dos comerciantes' },\n          { type: 'xp', value: 130, description: 'Experincia furtiva' },\n          { type: 'reputation', target: 'Comerciantes', value: 25 },\n          { type: 'item', target: 'pocao-media', description: 'Presente dos comerciantes' }\n        ],\n        failureEffects: [\n          { type: 'spawn_enemy', target: 'bandit_patrol', probability: 0.4 },\n          { type: 'reputation', target: 'Bandidos', value: -15 }\n        ],\n        requirements: {\n          level: 3\n        }\n      },\n      {\n        id: 'ignore',\n        text: 'Ignorar e Seguir',\n        description: 'No se envolver e continuar seu caminho',\n        riskThreshold: 0, // Sempre sucesso\n        successEffects: [\n          { type: 'reputation', target: 'Comerciantes', value: -10 },\n          { type: 'npc_relation', target: 'Mercador Aldric', value: -15 }\n        ],\n        failureEffects: []\n      }\n    ],\n    storySeeds: {\n      context: 'Conflito entre bandidos e comerciantes',\n      tone: 'tense',\n      previousDecisions: []\n    }\n  },\n  {\n    title: 'O Artefato Misterioso',\n    description: 'Um artefato antigo foi descoberto, mas parece emanar energia sinistra.',\n    type: 'narrative',\n    difficulty: 'dificil',\n    levelRequirement: 4,\n    timeLimit: 3,\n    rewards: { gold: 150, xp: 200 },\n    repeatable: false,\n    location: 'Runas Antigas',\n    narrative: {\n      intro: 'Nas profundezas de runas antigas, voc encontra um orbe pulsante emanando energia mgica.',\n      situation: 'O artefato sussurra em sua mente, prometendo poder, mas voc sente uma presena maligna...'\n    },\n    enhancedChoices: [\n      {\n        id: 'take-artifact',\n        text: 'Pegar o Artefato',\n        description: 'Tocar e tentar controlar o poder do artefato',\n        riskThreshold: 70,\n        rollModifiers: {\n          attribute: 'sabedoria',\n          multiplier: 2,\n          bonus: -10 // Penalidade pela natureza perigosa\n        },\n        successEffects: [\n          { type: 'item', target: 'orbe-poder', description: 'Artefato poderoso' },\n          { type: 'xp', value: 250, description: 'Conhecimento arcano' },\n          { type: 'world_event', target: 'magical_awakening', probability: 0.2 }\n        ],\n        failureEffects: [\n          { type: 'gold', value: -100, description: 'Maldio custou recursos' },\n          { type: 'world_event', target: 'dark_corruption', probability: 0.5 },\n          { type: 'npc_relation', target: 'Sbia Elara', value: -20, description: 'Desaprova escolhas perigosas' }\n        ],\n        requirements: {\n          level: 4\n        }\n      },\n      {\n        id: 'study-carefully',\n        text: 'Estudar com Cuidado',\n        description: 'Examinar o artefato sem toc-lo diretamente',\n        riskThreshold: 40,\n        rollModifiers: {\n          attribute: 'inteligencia',\n          multiplier: 3,\n          bonus: 5\n        },\n        successEffects: [\n          { type: 'xp', value: 180, description: 'Conhecimento seguro' },\n          { type: 'gold', value: 80, description: 'Informaes valiosas' },\n          { type: 'npc_relation', target: 'Sbia Elara', value: 15 },\n          { type: 'reputation', target: 'Diplomatas', value: 10 }\n        ],\n        failureEffects: [\n          { type: 'xp', value: 50, description: 'Conhecimento limitado' }\n        ]\n      },\n      {\n        id: 'destroy-artifact',\n        text: 'Destruir o Artefato',\n        description: 'Tentar destruir o artefato para evitar que cause mal',\n        riskThreshold: 65,\n        rollModifiers: {\n          attribute: 'forca',\n          multiplier: 2,\n          bonus: 0\n        },\n        successEffects: [\n          { type: 'xp', value: 160, description: 'Ato heroico' },\n          { type: 'reputation', target: 'Guarda da Cidade', value: 20 },\n          { type: 'world_event', target: 'evil_prevented', probability: 0.8 }\n        ],\n        failureEffects: [\n          { type: 'world_event', target: 'artifact_explosion', probability: 0.6 },\n          { type: 'gold', value: -50, description: 'Danos colaterais' }\n        ],\n        requirements: {\n          level: 3\n        }\n      },\n      {\n        id: 'leave-untouched',\n        text: 'Deixar Intocado',\n        description: 'Sair das runas sem mexer no artefato',\n        riskThreshold: 0,\n        successEffects: [\n          { type: 'xp', value: 80, description: 'Sabedoria da cautela' },\n          { type: 'reputation', target: 'Aventureiros', value: -5, description: 'Considerado cauteloso demais' }\n        ],\n        failureEffects: []\n      }\n    ],\n    worldStateRequirements: {\n      factionReputation: {\n        'Aventureiros': 0 // Deve ter pelo menos reputao neutra\n      }\n    },\n    storySeeds: {\n      context: 'Descoberta de artefato mgico perigoso',\n      tone: 'mysterious',\n      previousDecisions: []\n    }\n  }\n];\n\nexport class EnhancedMissionGenerator {\n  private static instance: EnhancedMissionGenerator;\n\n  static getInstance(): EnhancedMissionGenerator {\n    if (!EnhancedMissionGenerator.instance) {\n      EnhancedMissionGenerator.instance = new EnhancedMissionGenerator();\n    }\n    return EnhancedMissionGenerator.instance;\n  }\n\n  /**\n   * Gera uma misso aprimorada baseada no nvel do heri e estado do mundo\n   */\n  generateEnhancedMission(hero: Hero): EnhancedQuest {\n    // Filtrar templates apropriados\n    const availableTemplates = ENHANCED_MISSION_TEMPLATES.filter(template => {\n      // Verificar nvel\n      if (template.levelRequirement > hero.progression.level) return false;\n      \n      // Verificar requisitos de WorldState\n      if (template.worldStateRequirements) {\n        if (!worldStateManager.checkWorldStateRequirements(hero, template.worldStateRequirements)) {\n          return false;\n        }\n      }\n      \n      return true;\n    });\n\n    if (availableTemplates.length === 0) {\n      return this.generateFallbackMission(hero);\n    }\n\n    // Selecionar template aleatrio\n    const template = availableTemplates[Math.floor(Math.random() * availableTemplates.length)];\n    \n    // Gerar story seeds baseado no estado atual\n    const storySeeds = worldStateManager.generateStorySeeds(hero);\n    \n    // Criar misso\n    const mission: EnhancedQuest = {\n      ...template,\n      id: `enhanced_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      status: 'available',\n      storySeeds: {\n        ...template.storySeeds,\n        previousDecisions: storySeeds.previousDecisions,\n        tone: storySeeds.tone\n      },\n      staminaCost: this.calculateStaminaCost(template.difficulty)\n    };\n\n    // Garantir exatamente 3 caminhos (A, B, C)\n    if (mission.enhancedChoices && mission.enhancedChoices.length > 3) {\n      mission.enhancedChoices = mission.enhancedChoices.slice(0, 3);\n    }\n\n    return mission;\n  }\n\n  /**\n   * Calcula o custo de stamina baseado na dificuldade\n   */\n  private calculateStaminaCost(difficulty: string): number {\n    switch (difficulty) {\n      case 'facil': return 20;\n      case 'medio': return 40;\n      case 'dificil': return 60;\n      case 'epica': return 80;\n      default: return 30;\n    }\n  }\n\n  /**\n   * Gera uma misso de fallback quando nenhum template est disponvel\n   */\n  private generateFallbackMission(_hero: Hero): EnhancedQuest {\n    return {\n      id: `fallback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      title: 'Tarefa Simples',\n      description: 'Uma tarefa bsica para ganhar experincia.',\n      type: 'narrative',\n      difficulty: 'facil',\n      levelRequirement: 1,\n      rewards: { gold: 30, xp: 50 },\n      repeatable: true,\n      status: 'available',\n      enhancedChoices: [\n        {\n          id: 'accept',\n          text: 'Aceitar',\n          description: 'Aceitar a tarefa',\n          riskThreshold: 30,\n          successEffects: [\n            { type: 'gold', value: 30 },\n            { type: 'xp', value: 50 }\n          ],\n          failureEffects: [\n            { type: 'gold', value: 15 },\n            { type: 'xp', value: 25 }\n          ]\n        },\n        {\n          id: 'decline',\n          text: 'Recusar',\n          description: 'Recusar a tarefa',\n          riskThreshold: 0,\n          successEffects: [],\n          failureEffects: []\n        }\n      ],\n      storySeeds: {\n        context: 'Tarefa bsica',\n        tone: 'neutral',\n        previousDecisions: []\n      },\n      staminaCost: 20\n    };\n  }\n\n  /**\n   * Processa a escolha de uma misso aprimorada\n   */\n  processEnhancedChoice(\n    hero: Hero,\n    mission: EnhancedQuest,\n    choiceId: string\n  ): {\n    success: boolean;\n    results: any;\n    narrative: string;\n  } {\n    const choice = mission.enhancedChoices?.find(c => c.id === choiceId);\n    if (!choice) {\n      throw new Error('Escolha no encontrada');\n    }\n\n    // Verificar fadiga\n    if (!worldStateManager.canAcceptQuest(hero, mission.staminaCost || 30)) {\n      return {\n        success: false,\n        results: { error: 'Fadiga alta' },\n        narrative: 'Sua fadiga est alta para aceitar esta misso. Descanse um pouco.'\n      };\n    }\n\n    // Consumir fadiga\n    worldStateManager.consumeStamina(hero, mission.staminaCost || 30);\n\n    // Processar escolha\n    const result = worldStateManager.processChoice(\n      hero,\n      mission.id,\n      choice.id,\n      choice.text,\n      choice.successEffects,\n      choice.failureEffects,\n      choice.riskThreshold,\n      choice.rollModifiers\n    );\n\n    // Gerar narrativa do resultado\n    const narrative = this.generateResultNarrative(choice, result.success, result.rollResult);\n\n    return {\n      success: result.success,\n      results: result,\n      narrative\n    };\n  }\n\n  /**\n   * Gera narrativa do resultado da escolha\n   */\n  private generateResultNarrative(choice: EnhancedQuestChoice, success: boolean, rollResult: any): string {\n    const baseNarrative = success \n      ? `Sua escolha de \"${choice.text}\" foi bem-sucedida!`\n      : `Sua tentativa de \"${choice.text}\" no saiu como esperado...`;\n\n    const rollNarrative = `(Rolou ${rollResult.roll} + ${rollResult.modifiers} = ${rollResult.total} vs ${rollResult.threshold})`;\n\n    const outcomeNarrative = success\n      ? 'As consequncias de sua ao se desenrolam favoravelmente.'\n      : 'Voc ter que lidar com as consequncias imprevistas.';\n\n    return `${baseNarrative}\\n\\n${rollNarrative}\\n\\n${outcomeNarrative}`;\n  }\n}\n\nexport const enhancedMissionGenerator = EnhancedMissionGenerator.getInstance();\n","/**\n * Componente de Display de Stamina\n * Mostra a stamina atual e recuperao em tempo real\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { useHeroStore } from '../store/heroStore';\nimport { worldStateManager } from '../utils/worldState';\n \n\nexport const StaminaDisplay: React.FC = () => {\n  const { getSelectedHero, updateHero, gainGold } = useHeroStore();\n  const [currentTime, setCurrentTime] = useState(Date.now());\n  const selectedHero = getSelectedHero();\n  const trainingUntilISO = selectedHero?.stats?.trainingActiveUntil;\n  const trainingName = selectedHero?.stats?.trainingActiveName;\n  const [trainingSeconds, setTrainingSeconds] = useState<number | null>(null);\n  const [busy, setBusy] = useState(false);\n  \n\n  // Atualizar o tempo a cada segundo\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(Date.now());\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  \n\n  // Atualizar contador de treino baseado no tempo atual\n  useEffect(() => {\n    if (trainingUntilISO) {\n      const until = new Date(trainingUntilISO).getTime();\n      const remainingMs = Math.max(0, until - currentTime);\n      if (remainingMs > 0) {\n        setTrainingSeconds(Math.ceil(remainingMs / 1000));\n      } else {\n        setTrainingSeconds(null);\n      }\n    } else {\n      setTrainingSeconds(null);\n    }\n  }, [currentTime, trainingUntilISO]);\n\n  const formatSecondsToMMSS = (seconds: number | null) => {\n    if (seconds === null) return '--:--';\n    const m = Math.floor(seconds / 60);\n    const s = seconds % 60;\n    return `${m}:${s.toString().padStart(2, '0')}`;\n  };\n\n  if (!selectedHero) {\n    return null;\n  }\n  const currentFatigue = Math.max(0, Number(selectedHero.progression?.fatigue || 0));\n  const percentage = Math.max(0, Math.min(100, (currentFatigue / 100) * 100));\n\n  const getStaminaColor = () => {\n    if (percentage >= 80) return 'from-green-500 to-green-600';\n    if (percentage >= 50) return 'from-yellow-500 to-yellow-600';\n    if (percentage >= 20) return 'from-orange-500 to-orange-600';\n    return 'from-red-500 to-red-600';\n  };\n\n  \n\n  return (\n    <div className=\"bg-gray-800 rounded-lg p-4\">\n      <div className=\"flex items-center justify-between mb-3\">\n        <h3 className=\"text-lg font-semibold text-white flex items-center\">\n           Fadiga\n        </h3>\n        <div className=\"text-sm text-gray-300\">\n          {currentFatigue}/100\n        </div>\n      </div>\n\n      {/* Barra de Fadiga */}\n      <div className=\"relative h-4 bg-gray-700 rounded-full overflow-hidden mb-3\">\n        <motion.div\n          className={`h-full bg-gradient-to-r ${getStaminaColor()}`}\n          initial={{ width: 0 }}\n          animate={{ width: `${percentage}%` }}\n          transition={{ duration: 0.5 }}\n        />\n        <div className=\"absolute inset-0 flex items-center justify-center text-xs font-semibold text-white\">\n          {Math.round(percentage)}%\n        </div>\n      </div>\n\n      {/* Informaes de Fadiga */}\n      <div className=\"space-y-2 text-sm\">\n        <div className=\"text-gray-300\">Fadiga aumenta ao realizar aes e treinos.</div>\n        <div className=\"text-gray-400\">Descanse na taverna para reduzir a fadiga.</div>\n      </div>\n\n      {/* Descanso na Taverna */}\n      <div className=\"mt-4 pt-3 border-t border-gray-700\">\n        <h4 className=\"text-sm font-semibold text-white mb-2\">Descanso na Taverna:</h4>\n        <div className=\"grid grid-cols-3 gap-2 text-xs\">\n          {[\n            { label: 'Soneca', cost: 15, recovery: 15 },\n            { label: 'Noite', cost: 30, recovery: 30 },\n            { label: 'Luxo', cost: 60, recovery: 60 }\n          ].map(o => (\n            <button\n              key={o.label}\n              disabled={busy || currentFatigue <= 0}\n              onClick={() => { \n                if (busy) return; \n                setBusy(true); \n                const h = { ...selectedHero } as any;\n                worldStateManager.rest(h, 'item', o.recovery);\n                updateHero(selectedHero.id, { progression: h.progression, stats: h.stats });\n                gainGold(selectedHero.id, -(o.cost));\n                setBusy(false); \n              }}\n              className={`p-2 rounded ${currentFatigue>0?'bg-amber-700 hover:bg-amber-800 text-white border border-amber-500':'bg-gray-700 text-gray-400 border border-gray-600'} text-center`}\n            >\n              <div className=\"font-semibold\">{o.label}</div>\n              <div>-{o.recovery}  {o.cost} </div>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      \n\n      {/* Status de Fadiga */}\n      <div className=\"mt-3 text-center\">\n        {currentFatigue >= 80 && (\n          <div className=\"text-red-400 text-sm font-semibold\">\n             Fadiga muito alta  descanse!\n          </div>\n        )}\n        {currentFatigue > 0 && currentFatigue < 80 && (\n          <div className=\"text-yellow-400 text-sm\">\n             Fadiga presente  considere descansar.\n          </div>\n        )}\n        {trainingSeconds !== null && (\n          <div className=\"mt-2 text-sm text-yellow-300\">\n             Treino: {trainingName || 'Em andamento'}  {formatSecondsToMMSS(trainingSeconds)}\n          </div>\n        )}\n      </div>\n      \n    </div>\n  );\n};\n","/**\n * Componente de Demonstrao do Sistema de Estado de Mundo\n * Mostra como o novo sistema funciona\n */\n\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { useHeroStore } from '../store/heroStore';\nimport { worldStateManager } from '../utils/worldState';\nimport { enhancedMissionGenerator } from '../utils/enhancedMissions';\nimport { StaminaDisplay } from './StaminaDisplay';\n\nexport const WorldStateDemo: React.FC = () => {\n  const { getSelectedHero, updateHero } = useHeroStore();\n  const [demoResults, setDemoResults] = useState<any[]>([]);\n  const selectedHero = getSelectedHero();\n\n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para ver a demonstrao do sistema de estado de mundo.</p>\n      </div>\n    );\n  }\n\n  const runDemo = () => {\n    const results: any[] = [];\n    \n    // Demonstrar gerao de misso\n    const mission = enhancedMissionGenerator.generateEnhancedMission(selectedHero);\n    results.push({\n      type: 'mission_generated',\n      title: 'Misso Gerada',\n      data: mission\n    });\n\n    // Demonstrar processamento de escolha\n    if (mission.enhancedChoices && mission.enhancedChoices.length > 0) {\n      const choice = mission.enhancedChoices[0];\n      const result = enhancedMissionGenerator.processEnhancedChoice(selectedHero, mission, choice.id);\n      \n      results.push({\n        type: 'choice_processed',\n        title: 'Escolha Processada',\n        data: result\n      });\n\n      // Atualizar heri\n      updateHero(selectedHero.id, { \n        worldState: selectedHero.worldState,\n        progression: selectedHero.progression \n      });\n    }\n\n    // Demonstrar story seeds\n    const storySeeds = worldStateManager.generateStorySeeds(selectedHero);\n    results.push({\n      type: 'story_seeds',\n      title: 'Story Seeds Gerados',\n      data: storySeeds\n    });\n\n    setDemoResults(results);\n  };\n\n  const clearDemo = () => {\n    setDemoResults([]);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"bg-gray-800 rounded-lg p-6\">\n        <h2 className=\"text-2xl font-bold text-white mb-4\">Demonstrao do Sistema de Estado de Mundo</h2>\n        <p className=\"text-gray-300 mb-4\">\n          Este sistema implementa decises com consequncias, estado de mundo persistente e narrativa procedural.\n        </p>\n        \n        <div className=\"flex space-x-4\">\n          <button\n            onClick={runDemo}\n            className=\"px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n          >\n            Executar Demonstrao\n          </button>\n          <button\n            onClick={clearDemo}\n            className=\"px-6 py-3 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors\"\n          >\n            Limpar Resultados\n          </button>\n        </div>\n      </div>\n\n      {/* Estado Atual do Heri */}\n      <div className=\"bg-gray-800 rounded-lg p-6\">\n        <h3 className=\"text-xl font-bold text-white mb-4\">Estado Atual do Heri</h3>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {/* Display de Stamina */}\n          <div className=\"md:col-span-1\">\n            <StaminaDisplay />\n          </div>\n          \n          <div className=\"bg-gray-700 rounded p-4\">\n            <h4 className=\"font-semibold text-white mb-2\">Informaes Bsicas</h4>\n            <div className=\"text-sm text-gray-300 space-y-1\">\n              <div>Nome: {selectedHero.name}</div>\n              <div>Classe: {selectedHero.class}</div>\n              <div>Nvel: {selectedHero.progression.level}</div>\n            </div>\n          </div>\n          \n          <div className=\"bg-gray-700 rounded p-4\">\n            <h4 className=\"font-semibold text-white mb-2\">Decises Tomadas</h4>\n            <div className=\"text-sm text-gray-300\">\n              {selectedHero.worldState?.decisionLog.length || 0} decises registradas\n            </div>\n            {selectedHero.worldState?.decisionLog.slice(-3).map((decision, index) => (\n              <div key={index} className=\"text-xs text-gray-400 mt-1\">\n                 {decision.choiceText} ({decision.rollResult?.success ? 'Sucesso' : 'Falha'})\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Reputao com Faces */}\n        {selectedHero.worldState?.factions && (\n          <div className=\"mt-4\">\n            <h4 className=\"font-semibold text-white mb-2\">Reputao com Faces</h4>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\n              {Object.entries(selectedHero.worldState.factions).map(([name, data]) => (\n                <div key={name} className=\"bg-gray-700 rounded p-2\">\n                  <div className=\"text-sm text-white\">{name}</div>\n                  <div className={`text-xs ${\n                    data.reputation > 0 ? 'text-green-400' : \n                    data.reputation < 0 ? 'text-red-400' : 'text-gray-400'\n                  }`}>\n                    {data.reputation > 0 ? '+' : ''}{data.reputation}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Resultados da Demonstrao */}\n      {demoResults.length > 0 && (\n        <div className=\"space-y-4\">\n          {demoResults.map((result, index) => (\n            <motion.div\n              key={index}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: index * 0.2 }}\n              className=\"bg-gray-800 rounded-lg p-6\"\n            >\n              <h3 className=\"text-xl font-bold text-white mb-4\">{result.title}</h3>\n              \n              {result.type === 'mission_generated' && (\n                <div className=\"space-y-3\">\n                  <div className=\"bg-gray-700 rounded p-4\">\n                    <h4 className=\"font-semibold text-white\">{result.data.title}</h4>\n                    <p className=\"text-gray-300 text-sm mt-1\">{result.data.description}</p>\n                    <div className=\"text-xs text-gray-400 mt-2\">\n                      Localizao: {result.data.location}  Nvel: {result.data.levelRequirement}+  \n                      Stamina: {result.data.staminaCost || 30}\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <h5 className=\"font-semibold text-white\">Escolhas Disponveis:</h5>\n                    {result.data.enhancedChoices?.map((choice: any, choiceIndex: number) => (\n                      <div key={choiceIndex} className=\"bg-gray-700 rounded p-3\">\n                        <div className=\"font-medium text-white\">{choice.text}</div>\n                        <div className=\"text-sm text-gray-300\">{choice.description}</div>\n                        <div className=\"text-xs text-gray-400 mt-1\">\n                          Dificuldade: {choice.riskThreshold}%  \n                          {choice.rollModifiers?.attribute && ` Usa ${choice.rollModifiers.attribute}`}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {result.type === 'choice_processed' && (\n                <div className=\"space-y-3\">\n                  <div className={`p-4 rounded ${\n                    result.data.success ? 'bg-green-900 border border-green-500' : 'bg-red-900 border border-red-500'\n                  }`}>\n                    <h4 className=\"font-semibold text-white\">\n                      {result.data.success ? ' Sucesso!' : ' Falha'}\n                    </h4>\n                    <p className=\"text-gray-300 text-sm mt-1 whitespace-pre-line\">\n                      {result.data.narrative}\n                    </p>\n                  </div>\n                  \n                  <div className=\"bg-gray-700 rounded p-4\">\n                    <h5 className=\"font-semibold text-white mb-2\">Detalhes do Roll:</h5>\n                    <div className=\"text-sm text-gray-300\">\n                      Roll: {result.data.results.rollResult.roll} + \n                      Modificadores: {result.data.results.rollResult.modifiers} = \n                      {result.data.results.rollResult.total} vs {result.data.results.rollResult.threshold}\n                    </div>\n                  </div>\n                  \n                  {result.data.results.appliedEffects.length > 0 && (\n                    <div className=\"bg-gray-700 rounded p-4\">\n                      <h5 className=\"font-semibold text-white mb-2\">Efeitos Aplicados:</h5>\n                      {result.data.results.appliedEffects.map((effect: any, effectIndex: number) => (\n                        <div key={effectIndex} className=\"text-sm text-gray-300\">\n                           {effect.description || `${effect.type}: ${effect.value}`}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n              \n              {result.type === 'story_seeds' && (\n                <div className=\"bg-gray-700 rounded p-4\">\n                  <div className=\"space-y-2\">\n                    <div>\n                      <span className=\"font-semibold text-white\">Contexto:</span>\n                      <span className=\"text-gray-300 ml-2\">{result.data.context}</span>\n                    </div>\n                    <div>\n                      <span className=\"font-semibold text-white\">Tom:</span>\n                      <span className=\"text-gray-300 ml-2\">{result.data.tone}</span>\n                    </div>\n                    {result.data.previousDecisions.length > 0 && (\n                      <div>\n                        <span className=\"font-semibold text-white\">Decises Recentes:</span>\n                        <div className=\"ml-2 text-sm text-gray-300\">\n                          {result.data.previousDecisions.map((decision: string, decIndex: number) => (\n                            <div key={decIndex}> {decision}</div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n              \n              <details className=\"mt-4\">\n                <summary className=\"cursor-pointer text-gray-400 hover:text-white\">\n                  Ver dados brutos (JSON)\n                </summary>\n                <pre className=\"mt-2 p-4 bg-gray-900 rounded text-xs text-gray-300 overflow-auto\">\n                  {JSON.stringify(result.data, null, 2)}\n                </pre>\n              </details>\n            </motion.div>\n          ))}\n        </div>\n      )}\n\n      {/* Explicao do Sistema */}\n      <div className=\"bg-gray-800 rounded-lg p-6\">\n        <h3 className=\"text-xl font-bold text-white mb-4\">Como Funciona o Sistema</h3>\n        \n        <div className=\"space-y-4 text-gray-300\">\n          <div>\n            <h4 className=\"font-semibold text-white\">1. WorldState</h4>\n            <p className=\"text-sm\">\n              Mantm o estado persistente do mundo, incluindo reputao com faces, \n              status de NPCs, eventos ativos e histrico de decises.\n            </p>\n          </div>\n          \n          <div>\n            <h4 className=\"font-semibold text-white\">2. Decision Log</h4>\n            <p className=\"text-sm\">\n              Registra todas as escolhas do jogador com timestamp, impacto e resultados de rolls,\n              criando uma narrativa persistente.\n            </p>\n          </div>\n          \n          <div>\n            <h4 className=\"font-semibold text-white\">3. Enhanced Choices</h4>\n            <p className=\"text-sm\">\n              Escolhas com modificadores de atributos, thresholds de risco e efeitos de \n              sucesso/falha que impactam o mundo.\n            </p>\n          </div>\n          \n          <div>\n            <h4 className=\"font-semibold text-white\">4. Story Seeds</h4>\n            <p className=\"text-sm\">\n              Contexto gerado baseado no estado atual do mundo e decises passadas,\n              usado para criar narrativas dinmicas.\n            </p>\n          </div>\n          \n          <div>\n            <h4 className=\"font-semibold text-white\">5. Stamina System</h4>\n            <p className=\"text-sm\">\n              Sistema de \"forced rest\" onde misses consomem stamina que se recupera ao longo do tempo,\n              criando um loop de engajamento.\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { supabase, supabaseConfigured } from '../lib/supabaseClient';\nimport type { Hero } from '../types/hero';\n\nexport type GuildMember = {\n  id: string;\n  user_id: string;\n  hero_id: string;\n  hero_name: string;\n  rank: 'F' | 'E' | 'D' | 'C' | 'B' | 'A' | 'S';\n  reputation: number;\n  joined_at: string;\n};\n\nexport type GuildLeaderboardEntry = {\n  hero_name: string;\n  rank: GuildMember['rank'];\n  reputation: number;\n  joined_at: string;\n};\n\nconst rankByReputation = (rep: number): GuildMember['rank'] => {\n  if (rep >= 1100) return 'S';\n  if (rep >= 800) return 'A';\n  if (rep >= 550) return 'B';\n  if (rep >= 350) return 'C';\n  if (rep >= 200) return 'D';\n  if (rep >= 100) return 'E';\n  return 'F';\n};\n\nexport async function joinAdventurersGuild(hero: Hero): Promise<{ ok: boolean; error?: string; member?: GuildMember; offline?: boolean }>{\n  if (!hero?.id) return { ok: false, error: 'Heri invlido.' };\n  if (!supabaseConfigured) {\n    return { ok: true, offline: true };\n  }\n  try {\n    const { data: usr } = await supabase.auth.getUser();\n    const userId = usr?.user?.id;\n    if (!userId) return { ok: false, error: 'Faa login para ingressar na Guilda.' };\n    const payload = {\n      user_id: userId,\n      hero_id: hero.id,\n      hero_name: hero.name,\n      rank: 'F',\n      reputation: 0\n    };\n    const { data, error } = await supabase\n      .from('guild_members')\n      .upsert(payload, { onConflict: 'user_id,hero_id' })\n      .select('*')\n      .limit(1);\n    if (error) return { ok: false, error: error.message };\n    const member = (data && data[0]) as GuildMember;\n    return { ok: true, member };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Falha ao ingressar na Guilda.' };\n  }\n}\n\nexport async function addGuildReputation(hero: Hero, delta: number): Promise<{ ok: boolean; error?: string; member?: GuildMember; offline?: boolean }>{\n  if (!hero?.id) return { ok: false, error: 'Heri invlido.' };\n  if (!supabaseConfigured) return { ok: true, offline: true };\n  try {\n    const { data: usr } = await supabase.auth.getUser();\n    const userId = usr?.user?.id;\n    if (!userId) return { ok: false, error: 'Faa login para pontuar reputao.' };\n\n    // Busca registro atual\n    const { data: existing, error: fetchError } = await supabase\n      .from('guild_members')\n      .select('*')\n      .eq('user_id', userId)\n      .eq('hero_id', hero.id)\n      .limit(1);\n    if (fetchError) return { ok: false, error: fetchError.message };\n    const current = (existing && existing[0]) as GuildMember | undefined;\n    const newRep = Math.max(0, (current?.reputation || 0) + delta);\n    const newRank = rankByReputation(newRep);\n\n    const { data, error } = await supabase\n      .from('guild_members')\n      .upsert({\n        user_id: userId,\n        hero_id: hero.id,\n        hero_name: hero.name,\n        reputation: newRep,\n        rank: newRank\n      }, { onConflict: 'user_id,hero_id' })\n      .select('*')\n      .limit(1);\n    if (error) return { ok: false, error: error.message };\n    const member = (data && data[0]) as GuildMember;\n    return { ok: true, member };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro ao atualizar reputao.' };\n  }\n}\n\nexport async function getGuildLeaderboard(limit = 10): Promise<{ data: GuildLeaderboardEntry[]; error?: string; offline?: boolean }>{\n  if (!supabaseConfigured) return { data: [], offline: true };\n  try {\n    const { data, error } = await supabase\n      .from('guild_rankings')\n      .select('*')\n      .limit(limit);\n    if (error) return { data: [], error: error.message };\n    return { data: (Array.isArray(data) ? data : []) as GuildLeaderboardEntry[] };\n  } catch (err: any) {\n    return { data: [], error: err?.message || 'Falha ao carregar leaderboard.' };\n  }\n}\n\n","import { Item } from '../types/hero';\nimport { SHOP_ITEMS } from './shop';\nimport { getRareItemChanceBonus } from './replayModifiers';\n\n/**\n * Utilitrio de loot de bas de masmorras.\n * Retorna 1-2 itens com base no tier de raridade solicitado.\n * Tipos elegveis: weapon, armor, accessory.\n */\nexport type ChestTier = 'comum' | 'raro' | 'epico' | 'lendario';\n\nexport function generateChestLoot(tier: ChestTier): Item[] {\n  const eligibleTypes = new Set(['weapon', 'armor', 'accessory']);\n  const rarityOrder = ['comum', 'raro', 'epico', 'lendario'] as const;\n\n  // Para tier 'comum', restringir  raridade comum; para demais, permitir mnimo por tier\n  const minIndex = rarityOrder.indexOf(tier);\n  const pool = SHOP_ITEMS.filter(i => {\n    if (!eligibleTypes.has(i.type)) return false;\n    const rIdx = rarityOrder.indexOf(i.rarity as typeof rarityOrder[number]);\n    if (tier === 'comum') return rIdx === 0;\n    return rIdx >= minIndex;\n  });\n\n  if (pool.length === 0) return [];\n\n  const pick = () => pool[Math.floor(Math.random() * pool.length)];\n  const items: Item[] = [pick()];\n\n  // Chance de 2 item para tiers acima de comum\n  const bonus = getRareItemChanceBonus();\n  if (tier !== 'raro' && tier !== 'comum' && Math.random() < Math.min(0.8, 0.35 + bonus)) {\n    items.push(pick());\n  }\n\n  // Evitar duplicatas simples\n  const unique: Record<string, Item> = {};\n  for (const it of items) unique[it.id] = it;\n  return Object.values(unique);\n}\n","import React, { useEffect, useState } from 'react';\nimport { resolveCombat } from '../utils/combat';\nimport { Hero, CombatResult, QuestEnemy } from '../types/hero';\nimport { notificationBus } from './NotificationSystem';\n\ninterface BattleModalProps {\n  hero: Hero;\n  enemies: QuestEnemy[];\n  onClose: () => void;\n  onResult: (result: CombatResult) => void;\n  floor?: number;\n  partyRarityBonusPercent?: number;\n}\n\nexport default function BattleModal({ hero, enemies, onClose, onResult, floor, partyRarityBonusPercent }: BattleModalProps) {\n  const [result, setResult] = useState<CombatResult | null>(null);\n  const [petSkillInfo, setPetSkillInfo] = useState<{ name?: string; count: number } | null>(null);\n\n  useEffect(() => {\n    // Executa combate completo por turnos e apresenta o log\n    const res = resolveCombat(hero, enemies, { floor, partyBonusPercent: partyRarityBonusPercent });\n    setResult(res);\n  }, [hero, enemies, floor, partyRarityBonusPercent]);\n\n  useEffect(() => {\n    if (!result) return;\n    const pet = (hero.pets || []).find(p => p.id === (hero as any).activePetId);\n    const skillName = pet?.exclusiveSkill;\n    const count = (result.log || []).filter(line => line.includes('Companheiro')).length;\n    if (skillName && count > 0) {\n      setPetSkillInfo({ name: skillName, count });\n      notificationBus.emit({ type: 'quest', title: 'Skill do Mascote', message: `${skillName} ativou ${count} vez(es)`, icon: '', duration: 2500 });\n    } else {\n      setPetSkillInfo(null);\n    }\n  }, [result]);\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"battle-dialog-title\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"relative z-10 w-full max-w-3xl rounded-lg border border-gray-700 bg-gray-800 p-4 shadow-xl\">\n        <div className=\"flex items-center justify-between\">\n          <h2 id=\"battle-dialog-title\" className=\"text-xl font-bold text-white\"> Batalha</h2>\n          <button onClick={onClose} className=\"text-gray-300 hover:text-white\"></button>\n        </div>\n\n        <div className=\"mt-3 text-sm text-gray-300\">\n          Inimigos: {enemies.map(e => `${e.count} ${e.type}${e.count > 1 ? 's' : ''}`).join(', ')}\n        </div>\n\n        <div className=\"mt-4 max-h-64 overflow-y-auto rounded bg-gray-700 p-3 text-sm\">\n          {result?.log?.map((line, idx) => (\n            <div key={idx} className={`leading-relaxed ${line.includes('Companheiro') ? 'text-emerald-300' : 'text-gray-200'}`}>{line}</div>\n          )) || <div className=\"text-gray-200\">Resolvendo combate...</div>}\n        </div>\n\n        {result && (\n          <div className=\"mt-4\">\n            {(result.petElementHighlights && result.petElementHighlights.length > 0) && (\n              <div className=\"mb-3\">\n                <div className=\"text-xs text-gray-300 mb-1\">Elementos aplicados pelo companheiro</div>\n                <div className=\"flex gap-2 text-base\">\n                  {result.petElementHighlights.map((el, i) => {\n                    const icon = el === 'earth' ? '' : el === 'light' ? '' : el === 'dark' ? '' : '';\n                    return <span key={`${el}-${i}`} title={el}>{icon}</span>;\n                  })}\n                </div>\n              </div>\n            )}\n            <div className={`text-lg font-semibold ${result.victory ? 'text-green-400' : 'text-red-400'}`}>{result.victory ? 'Vitria' : 'Derrota'}</div>\n            <div className=\"mt-1 text-sm text-gray-300\">Dano recebido: {result.damage}</div>\n            {(result.xpGained || result.goldGained) && (\n              <div className=\"text-sm text-gray-300\">Recompensas: {result.xpGained} XP  {result.goldGained} ouro</div>\n            )}\n            {petSkillInfo && (\n              <div className=\"mt-1 text-sm text-emerald-300\"> Skill do mascote: {petSkillInfo.name}  ativou {petSkillInfo.count}x</div>\n            )}\n            {result.itemsGained && result.itemsGained.length > 0 && (\n              <div className=\"text-sm text-gray-300\">Itens: {result.itemsGained.map(i => i.name).join(', ')}</div>\n            )}\n            {((result.petDamage || 0) > 0 || (result.petHealing || 0) > 0 || (result.petStuns || 0) > 0) && (\n              <div className=\"mt-3 rounded bg-gray-700 p-3\">\n                <div className=\"text-sm text-amber-300 font-semibold mb-1\">Companheiro</div>\n                <div className=\"text-sm text-gray-200\">Dano: {result.petDamage || 0}  Cura: {result.petHealing || 0}  Controles: {result.petStuns || 0}</div>\n                {typeof result.petEnergyUsed === 'number' && (\n                  <div className=\"text-xs text-gray-400 mt-1\">Energia consumida: {result.petEnergyUsed}</div>\n                )}\n              </div>\n            )}\n            <div className=\"mt-3 flex gap-2\">\n              <button\n                onClick={() => { onResult(result); onClose(); }}\n                className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700\"\n              >Concluir</button>\n              <button\n                onClick={onClose}\n                className=\"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700\"\n              >Fechar</button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { Hero } from '../types/hero';\nimport { getGameSettings } from '../store/gameSettingsStore';\n\nfunction pick<T>(arr: T[]): T { return arr[Math.floor(Math.random()*arr.length)]; }\nfunction strIncludes(s: string, k: string) { return s.toLowerCase().includes(k.toLowerCase()); }\nfunction cap(s: string) { return s ? s[0].toUpperCase() + s.slice(1) : s; }\nfunction humanizeMemory(summary: string): string {\n  const t = summary.toLowerCase();\n  if (t.includes('social_hostil')) return 'a confuso na taverna';\n  if (t.includes('social_amigavel')) return 'aquele banquete na guilda';\n  if (t.includes('social_neutro')) return 'aquele encontro casual na praa';\n  if (t.includes('missao')) return 'a misso passada';\n  if (t.includes('treino')) return 'o treino no ptio';\n  return 'o incidente anterior';\n}\n\nexport function getNPCDialogue(npc: Hero, player: Hero, context: string): string {\n  const arch = npc.npcPersonality?.archetype || 'explorador';\n  const style = npc.npcPersonality?.chatStyle || 'amigavel';\n  const rel = (npc.socialRelations || {})[player.id] || 0;\n  const mood = rel > 20 ? 'friendly' : rel < -20 ? 'hostile' : 'neutral';\n  const exclamations = ['Pelos deuses!', 'Pela barba de Merlim!', 'Por todos os dracos!', 'Cus e ao!', 'Que sorte!', 'Por Taranis!'];\n  const colloquials = ['essas passagens', 'esses corredores antigos', 'essa caverna', 'essas minas', 'essas runas', 'essa mata fechada'];\n  const survival = ['verifique gua e tochas', 'mantenha o abrigo ao alcance', 'olhe marcas no cho', 'escute o eco antes de avanar', 'prenda a corda na cintura', 'mantenha a lmina afiada'];\n  const whispers = ['espere... ouo passos', 'silncio, algo se move', 'luzes ao longe', 'cheiro de mofo recente', 'corrente de ar vindo da esquerda'];\n  const thoughts = ['melhor no subestimar isso', 'isso me lembra um velho contratempo', 'o mapa pode estar errado', 'no gosto desse silncio', 'preciso ver pegadas'];\n  const biomeColloquials = {\n    caverna: ['caverna', 'gruta escura', 'fendas rochosas'],\n    ruina: ['runas', 'ptio antigo', 'sales quebrados'],\n    floresta: ['mata fechada', 'clareira oculta', 'troncos retorcidos'],\n    cidade: ['becos', 'colunas da praa', 'arcadas do mercado'],\n    montanha: ['desfiladeiro', 'encosta ngreme', 'penhascos ventosos']\n  } as Record<string, string[]>;\n  const archCatch: Record<string, string[]> = {\n    competitivo: ['Nada como provar valor', 'Ningum vai nos superar hoje', 'Hora de subir no ranking'],\n    colaborativo: ['Juntos vamos mais longe', 'Compartilhe o loot, compartilhe a glria', 'Cobertura de flanco e avano'],\n    mercador: ['Negcio bom  metade da batalha', 'Veja preos, veja risco', 'Investir hoje, lucrar amanh'],\n    explorador: ['Mapeie, marque e avance', 'Sinta o vento, leia o terreno', 'Curiosidade abre portas'],\n    sabio: ['Observe padres', 'A mente vence a lmina', 'Conhecimento  proteo'],\n    caotico: ['Improviso vence ttica', 'Se der errado, corra', 'Vamos mexer nesse ninho']\n  };\n  const archPrefix: Record<string, string> = {\n    mercador: 'Oferta:', competitivo: 'Desafio:', colaborativo: 'Proposta:', sabio: 'Conselho:', caotico: 'Ideia:', explorador: 'Plano:'\n  };\n  const envCue = strIncludes(context,'caverna') || strIncludes(context,'corredor') || strIncludes(context,'coluna') || strIncludes(context,'mina') || strIncludes(context,'runa');\n  const excitement = mood === 'friendly' ? pick(exclamations) : mood === 'hostile' ? 'Tsc.' : 'Hmm.';\n  const settings = getGameSettings();\n  const place = (() => {\n    if (!settings.npcBiomeLexiconEnabled) return envCue ? pick(colloquials) : 'este trecho';\n    const ctx = context.toLowerCase();\n    if (strIncludes(ctx, 'caverna') || strIncludes(ctx, 'gruta')) return pick(biomeColloquials.caverna);\n    if (strIncludes(ctx, 'runa') || strIncludes(ctx, 'ruinas')) return pick(biomeColloquials.ruina);\n    if (strIncludes(ctx, 'floresta') || strIncludes(ctx, 'mata')) return pick(biomeColloquials.floresta);\n    if (strIncludes(ctx, 'cidade') || strIncludes(ctx, 'praa') || strIncludes(ctx, 'mercado')) return pick(biomeColloquials.cidade);\n    if (strIncludes(ctx, 'montanha') || strIncludes(ctx, 'penhasco')) return pick(biomeColloquials.montanha);\n    return envCue ? pick(colloquials) : 'este trecho';\n  })();\n  const tip = pick(survival);\n  const aside = Math.random() < (settings.npcDialogueWhisperProb ?? 0.25) ? pick(whispers) : '';\n  const think = Math.random() < (settings.npcDialogueThoughtProb ?? 0.35) ? pick(thoughts) : '';\n  const archLine = pick(archCatch[arch] || archCatch.explorador);\n  const prefix = archPrefix[arch] || 'Plano:';\n  const last = (npc.npcMemory?.interactions || []).slice(-1)[0]?.summary || '';\n  const bg = last ? `E no quero repetir ${humanizeMemory(last)}.` : '';\n  const tone = style === 'sarcastico' ? 'digo com um meio sorriso' : style === 'formal' ? 'digo com postura firme' : style === 'quieto' ? 'digo em voz baixa' : 'digo com brilho nos olhos';\n  const lead = `${excitement} ${prefix} ${archLine}.`;\n  const core = `${cap(player.name)}, pegue seu equipamento e ${tip}. ${tone}: ${context ? cap(context) : 'vamos avanar'} por ${place}.`;\n  const color = `${cap(player.name)}, ${envCue ? 'cautela' : 'fora'}!${aside ? ' [sussurrando] ' + aside + '.' : ''}${think ? ' (pensando) ' + think + '.' : ''} ${bg}`.trim();\n  const friendlyWrap = mood === 'friendly' ? `${lead} ${core} ${color}` : mood === 'hostile' ? `${lead} No confie nas aparncias. ${core} ${color}` : `${lead} ${core} ${color}`;\n  const provider = (import.meta as any)?.env?.VITE_AI_PROVIDER as string | undefined;\n  const model = (import.meta as any)?.env?.VITE_AI_MODEL as string | undefined;\n  if (provider && model) {\n    try {\n      return friendlyWrap;\n    } catch {\n      return friendlyWrap;\n    }\n  }\n  return friendlyWrap;\n}\n\nexport function getSimsDialogueTriplet(npc: Hero, player: Hero): string[] {\n  const base = npc.npcPersonality?.archetype || 'explorador';\n  const pool: string[] = [\n    'Como vai? Precisa de ajuda com essas runas?',\n    'Voc tem poes sobrando? Posso trocar por mapas.',\n    'Quer companhia numa misso rpida?',\n    'Ouvi falar de bandidos perto do mercado. Vamos investigar?',\n    'Tem uma corda extra? A minha arrebentou.',\n    'Voc viu pegadas estranhas perto da taverna?',\n    'Posso te emprestar um pergaminho, se precisar.',\n    'Treino mais tarde? Preciso melhorar minha guarda.',\n    'Tem essncia bestial para troca?',\n    'Quer identificar um ovo raro comigo?',\n    'Precisamos de tochas. Tem algumas?',\n    'Topa explorar a gruta nordeste?',\n    'Voc conseguiu montar? Posso te passar um item.',\n    'Tem notcias do conselho da guilda?',\n    'Rastreie comigo  ouvi metal batendo.',\n    'Vamos vender loot no mercado agora?',\n    'Quer comparar mapas? O meu est incompleto.',\n    'Topa escoltar um mercador?',\n    'Tem flechas de sobra? Estou sem.',\n    'Precisamos de gua. O poo secou hoje.',\n    'Por que no reunimos uma party para a dungeon?',\n    'Voc prefere caminho pela mata ou pelas runas?',\n    'Pode me ensinar uma tcnica de defesa?',\n    'Tem runas antigas para estudo?',\n  ];\n  const q = pool[Math.floor(Math.random()*pool.length)];\n  const offer = 'Posso te dar cobertura se aceitar.';\n  const req = 'Se tiver um item extra, podemos trocar.';\n  return [q, offer, req];\n}","import React, { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { saveDungeonRun, startDungeonRun, updateDungeonRun, finishDungeonRun } from '../services/dungeonService';\nimport { addGuildReputation } from '../services/guildService';\nimport { dungeonConfig, computeRewardMultiplier, isBossFloor, isMiniBossFloor, getDifficultyParams, DungeonDifficulty } from '../utils/dungeonConfig';\nimport { logActivity } from '../utils/activitySystem';\nimport { generateChestLoot } from '../utils/chestLoot';\nimport { SHOP_ITEMS } from '../utils/shop';\nimport BattleModal from './BattleModal';\nimport { getNPCDialogue } from '../services/npcDialogueService';\nimport { RankLevel } from '../types/ranks';\nimport { rankSystem } from '../utils/rankSystem';\nimport { useHeroStore as useStoreRef } from '../store/heroStore';\n\ntype FloorResult = {\n  floor: number;\n  success: boolean;\n  event: 'none' | 'combat' | 'trap' | 'chest' | 'rest';\n  xpGained: number;\n  goldGained: number;\n  narrative: string;\n  itemsAwarded?: string[];\n  itemIdsAwarded?: string[];\n};\n\nconst FLOORS_TOTAL = 20; // usado apenas para compatibilidade com payload anterior\n\nexport default function Dungeon20() {\n  const hero = useHeroStore(s => s.getSelectedHero());\n  const gainXP = useHeroStore(s => s.gainXP);\n  const gainGold = useHeroStore(s => s.gainGold);\n  const gainGlory = useHeroStore(s => s.gainGlory);\n  const gainArcaneEssence = useHeroStore(s => s.gainArcaneEssence);\n  const updateHero = useHeroStore(s => s.updateHero);\n  const addItemToInventory = useHeroStore(s => s.addItemToInventory);\n  const equipItem = useHeroStore(s => s.equipItem);\n  const unequipItem = useHeroStore(s => s.unequipItem);\n  const generateEggForSelected = useStoreRef(s => s.generateEggForSelected);\n\n  const [floorIndex, setFloorIndex] = useState(0);\n  const [running, setRunning] = useState(false);\n  const [finished, setFinished] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [log, setLog] = useState<FloorResult[]>([]);\n  const [awaitingDecision, setAwaitingDecision] = useState(false);\n  const [streak, setStreak] = useState(0);\n  const [startedAt, setStartedAt] = useState<string | undefined>(undefined);\n  const [battleEnemies, setBattleEnemies] = useState<Array<{ type: string; count: number; level?: number }>>([]);\n  const [showBattle, setShowBattle] = useState(false);\n  const [exitedVoluntarily, setExitedVoluntarily] = useState(false);\n  const [pendingEvent, setPendingEvent] = useState<'none' | 'ancient_chest' | 'mystic_shrine' | 'dark_trap' | 'mysterious_merchant' | 'secret_gate' | 'echo_of_past' | 'environment_puzzle' | 'npc_encounter' | 'collectible_relic' | 'corrupted_fountain' | 'celestial_portal'>('none');\n  const [awaitingEventChoice, setAwaitingEventChoice] = useState(false);\n  const [awaitingCombatChoice, setAwaitingCombatChoice] = useState(false);\n  const [blessingFloors, setBlessingFloors] = useState(0);\n  const [blessingMult, setBlessingMult] = useState(1);\n  const [trapFloors, setTrapFloors] = useState(0);\n  const [trapPenaltyMult, setTrapPenaltyMult] = useState(1);\n  const [lootFeedback, setLootFeedback] = useState<string | null>(null);\n  const useItem = useHeroStore(s => s.useItem);\n  const [activeRunId, setActiveRunId] = useState<string | null>(null);\n  const [bossRewardPending, setBossRewardPending] = useState(false);\n  const [selectedAttrReward, setSelectedAttrReward] = useState<'forca'|'destreza'|'constituicao'|'inteligencia'|'sabedoria'|'carisma'|'none'>('none');\n\n  const totalXP = useMemo(() => log.reduce((acc, r) => acc + r.xpGained, 0), [log]);\n  const totalGold = useMemo(() => log.reduce((acc, r) => acc + r.goldGained, 0), [log]);\n\n  // Limite dirio removido\n\n  // Limite de andares por rank (similar ao AIDungeonRun)\n  const getMaxFloorsByRank = (rank?: RankLevel) => {\n    switch (rank) {\n      case 'F':\n      case 'E':\n        return 3;\n      case 'D':\n      case 'C':\n        return 4;\n      case 'B':\n        return 5;\n      case 'A':\n        return 6;\n      case 'S':\n        return 7;\n      case 'SS':\n        return 8;\n      case 'SSS':\n        return 9;\n      default:\n        return 3;\n    }\n  };\n  const heroRank: RankLevel | undefined = hero ? (rankSystem.calculateRank(hero) as RankLevel) : undefined;\n  const maxFloorsAllowed = getMaxFloorsByRank(heroRank);\n\n  const [difficulty, setDifficulty] = useState<DungeonDifficulty>('normal');\n  const diffParams = useMemo(() => getDifficultyParams(difficulty), [difficulty]);\n  const getBiomeByFloor = (floor: number) => {\n    if (floor <= 10) return 'ruinas';\n    if (floor <= 20) return 'cripta-nevada';\n    if (floor <= 30) return 'floresta-fungica';\n    if (floor <= 40) return 'deserto-oculto';\n    return 'abismo-eterio';\n  };\n  const getBiomeClasses = (biome: string) => {\n    if (biome === 'ruinas') return 'from-stone-700 to-gray-900';\n    if (biome === 'cripta-nevada') return 'from-slate-600 to-blue-900';\n    if (biome === 'floresta-fungica') return 'from-emerald-700 to-teal-900';\n    if (biome === 'deserto-oculto') return 'from-amber-700 to-orange-900';\n    return 'from-indigo-700 to-purple-900';\n  };\n\n  const startRun = () => {\n    // Gate: exigir rank D ou superior para entrar\n    if (!hero) {\n      setError('Selecione um heri para jogar a Dungeon.');\n      return;\n    }\n    if (!heroRank || heroRank === 'F' || heroRank === 'E') {\n      setError('Rank insuficiente. A Dungeon Infinita requer rank D ou superior.');\n      return;\n    }\n    const now = Date.now();\n    const cdEnds = hero?.dungeon?.cooldownEndsAt ? new Date(hero.dungeon.cooldownEndsAt).getTime() : 0;\n    if (cdEnds && now < cdEnds) {\n      setError('Cooldown ativo para a dungeon. Aguarde antes de tentar novamente.');\n      return;\n    }\n    const dStamina = hero?.dungeon?.stamina?.current ?? 0;\n    if (dStamina <= 0) {\n      setError('Stamina de dungeon insuficiente. Aguarde a recuperao.');\n      return;\n    }\n    setRunning(true);\n    setFinished(false);\n    setFloorIndex(0);\n    setLog([]);\n    setError(null);\n    setAwaitingDecision(false);\n    setStreak(0);\n    const started = new Date().toISOString();\n    setStartedAt(started);\n    setExitedVoluntarily(false);\n    setPendingEvent('none');\n    setAwaitingEventChoice(false);\n    setBlessingFloors(0);\n    setBlessingMult(1);\n    setTrapFloors(0);\n    setTrapPenaltyMult(1);\n    // Iniciar persistncia remota (offline seguro)\n    (async () => {\n      if (!hero) return;\n      const res = await startDungeonRun(hero, started);\n      if (res.ok && res.runId) {\n        setActiveRunId(res.runId);\n      } else {\n        setActiveRunId(null);\n      }\n    })();\n  };\n\n  const makeNarrative = (success: boolean, event: FloorResult['event'], xp: number, gold: number) => {\n    const base = success ? 'Voc avana com determinao.' : 'Voc tropea e sofre um revs.';\n    const ev = event === 'combat' ? 'Um combate acirrado ocorre.'\n      : event === 'trap' ? 'Uma armadilha quase te pega.'\n      : event === 'chest' ? 'Voc encontra um ba modesto.'\n      : event === 'rest' ? 'Voc encontra um canto seguro para descansar.'\n      : 'O corredor est silencioso.';\n    return `${base} ${ev} (+${xp} XP, +${gold} ouro)`;\n  };\n\n  const DUNGEON_STAMINA_COST = 2;\n  const handleChoice = (risk: 'safe' | 'normal' | 'risky') => {\n    if (!hero || loading || finished) return;\n    const cur = hero.dungeon?.stamina?.current ?? 0;\n    if (cur < DUNGEON_STAMINA_COST) { setError('Stamina de dungeon insuficiente.'); return; }\n    updateHero(hero.id, { dungeon: { ...(hero.dungeon || {}), stamina: { ...((hero.dungeon||{}).stamina||{ current: 0, max: 0, lastRecovery: new Date().toISOString(), recoveryRate: 0 }), current: Math.max(0, cur - DUNGEON_STAMINA_COST) } } });\n    setLoading(true);\n    try {\n      const baseSuccess = (risk === 'safe' ? 0.8 : risk === 'normal' ? 0.6 : 0.4) + diffParams.successBaseBias;\n      const roll = Math.random();\n      const success = roll < baseSuccess;\n\n      let event: FloorResult['event'] = 'none';\n      const re = Math.random();\n      if (re < 0.28) event = 'combat';\n      else if (re < 0.38) { setPendingEvent('mystic_shrine'); setAwaitingEventChoice(true); event = 'rest'; }\n      else if (re < 0.50) { setPendingEvent('ancient_chest'); setAwaitingEventChoice(true); event = 'chest'; }\n      else if (re < 0.58) { setPendingEvent('environment_puzzle'); setAwaitingEventChoice(true); event = 'none'; }\n      else if (re < 0.66) { setPendingEvent('npc_encounter'); setAwaitingEventChoice(true); event = 'none'; }\n      else if (re < 0.74) { setPendingEvent('mysterious_merchant'); setAwaitingEventChoice(true); event = 'none'; }\n      else if (re < 0.80) { setPendingEvent('secret_gate'); setAwaitingEventChoice(true); event = 'none'; }\n      else if (re < 0.88) { setPendingEvent('corrupted_fountain'); setAwaitingEventChoice(true); event = 'none'; }\n      else if (re < 0.94) { setPendingEvent('celestial_portal'); setAwaitingEventChoice(true); event = 'none'; }\n      else if (re < 0.98) { setPendingEvent('echo_of_past'); setAwaitingEventChoice(true); event = 'none'; }\n      else event = 'none';\n\n      // Floor atual e boss\n      const currentFloor = floorIndex + 1;\n      // Impedir escolhas alm do limite por rank\n      if (currentFloor > maxFloorsAllowed) {\n        setLoading(false);\n        setFinished(true);\n        setAwaitingDecision(false);\n        const result: FloorResult = {\n          floor: currentFloor,\n          success: true,\n          event: 'none',\n          xpGained: 0,\n          goldGained: 0,\n          narrative: `Um portal selado bloqueia seu caminho. Rank atual (${heroRank || ''}) permite at ${maxFloorsAllowed} andares.`\n        };\n        const newLog = [...log, result];\n        setLog(newLog);\n        if (activeRunId) {\n          updateDungeonRun(activeRunId, {\n            max_floor_reached: newLog.length,\n            total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n            total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n            logs: newLog\n          });\n        }\n        return;\n      }\n      const boss = isBossFloor(currentFloor);\n      const miniboss = isMiniBossFloor(currentFloor);\n\n      // Combate real quando o evento for 'combat'\n      if (event === 'combat') {\n        const biome = getBiomeByFloor(currentFloor);\n        const bossPoolBySegment: Record<string, string[]> = {\n          'ruinas': ['Guardio de Pedra'],\n          'cripta-nevada': ['Tit de Gelo'],\n          'floresta-fungica': ['Rei Goblin'],\n          'deserto-oculto': ['Arauto gneo'],\n          'abismo-eterio': ['Draco Etreo','Feiticeiro das Sombras']\n        };\n        const templates = boss ? (bossPoolBySegment[biome] || ['Troll']) : miniboss ? ['Ogro','Guardio'] : ['Goblin', 'Esqueleto', 'Bandido', 'Lobo'];\n        const chosen = templates[Math.floor(Math.random() * templates.length)];\n        const count = boss ? 1 : miniboss ? 1 : (Math.random() < 0.2 ? 2 : 1);\n        const level = Math.max(1, Math.floor(((hero.progression.level || 1) + currentFloor * (boss ? 0.5 : miniboss ? 0.4 : 0.3)) * diffParams.enemy));\n        const questEnemies = [{ type: chosen, count, level }];\n        setBattleEnemies(questEnemies);\n        setAwaitingCombatChoice(true);\n        // Esperar ao do jogador: atacar, usar item ou fugir\n        return;\n      }\n\n      // Recompensas com multiplicador de streak e bnus (incluem beno/armadilha)\n      const baseXp = success ? (risk === 'safe' ? 5 : risk === 'normal' ? 8 : 12) : 3;\n      const baseGold = success ? (risk === 'safe' ? 1 : risk === 'normal' ? 2 : 3) : 0;\n      const mult = computeRewardMultiplier(streak) * blessingMult * trapPenaltyMult * diffParams.rewards;\n      const bossRewardMult = boss ? 1.5 : 1;\n      const xp = Math.round(baseXp * mult * bossRewardMult);\n      const gold = Math.round(baseGold * mult * bossRewardMult);\n      const glory = Math.round(gold * 0.5);\n      const essence = boss ? Math.round(1 * mult) : 0;\n\n      gainXP(hero.id, xp);\n      gainGold(hero.id, gold);\n      if (glory > 0) gainGlory(hero.id, glory);\n      if (essence > 0) gainArcaneEssence(hero.id, essence);\n\n      const result: FloorResult = {\n        floor: currentFloor,\n        success,\n        event,\n        xpGained: xp,\n        goldGained: gold,\n        narrative: makeNarrative(success, event, xp, gold)\n      };\n      const newLog = [...log, result];\n      setLog(newLog);\n      if (hero?.dungeon) {\n        const currentMax = hero.dungeon.maxFloor || 0;\n        const nextMax = Math.max(currentMax, newLog.length);\n        updateHero(hero.id, { dungeon: { ...hero.dungeon, maxFloor: nextMax } });\n      }\n      // Persistncia incremental\n      if (activeRunId) {\n        updateDungeonRun(activeRunId, {\n          max_floor_reached: newLog.length,\n          total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n          total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n          logs: newLog\n        });\n      }\n\n      // Log atividades bsicas\n      if (success && event === 'combat') {\n        logActivity.combatVictory({ heroId: hero.id, heroName: hero.name, heroClass: hero.class, enemiesDefeated: boss ? ['Boss da faixa'] : ['Guardas da masmorra'] });\n      } else if (event === 'chest' || event === 'rest' || event === 'trap') {\n        logActivity.eventCompleted({ heroId: hero.id, heroName: hero.name, heroClass: hero.class, eventCompleted: event });\n      }\n\n      // Aps resolver o andar, acionar deciso (se nenhum evento pendente exigir escolha)\n      if (!awaitingEventChoice) setAwaitingDecision(true);\n\n      // Penalidade de morte em boss (para combate tratado acima)\n      if (boss && !success && event === 'combat') {\n        // Penalidade de morte em boss no modo normal\n        const goldLoss = Math.round(totalGold * dungeonConfig.deathPenalty.normal.gold);\n        const xpLoss = Math.round(totalXP * dungeonConfig.deathPenalty.normal.xp);\n        gainGold(hero.id, -goldLoss);\n        gainXP(hero.id, -xpLoss);\n        setFinished(true);\n        setRunning(false);\n        setAwaitingDecision(false);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const ascend = () => {\n    if (finished) return;\n    // Respeitar limite de andares por rank: finalizar ao atingir limite\n    if ((floorIndex + 1) >= maxFloorsAllowed) {\n      setAwaitingDecision(false);\n      setFinished(true);\n      const result: FloorResult = {\n        floor: floorIndex + 1,\n        success: true,\n        event: 'none',\n        xpGained: 0,\n        goldGained: 0,\n        narrative: `Voc atingiu o limite de andares permitido pelo seu rank (${heroRank || ''}). Avance de rank para desbloquear mais andares.`\n      };\n      const newLog = [...log, result];\n      setLog(newLog);\n      if (activeRunId) {\n        updateDungeonRun(activeRunId, {\n          max_floor_reached: newLog.length,\n          total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n          total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n          logs: newLog\n        });\n      }\n      return;\n    }\n    setAwaitingDecision(false);\n    setStreak(s => s + 1);\n    setFloorIndex(i => i + 1);\n    // reduzir durao de beno/armadilha\n    if (blessingFloors > 0) setBlessingFloors(n => {\n      const next = n - 1; if (next <= 0) setBlessingMult(1); return Math.max(0, next);\n    });\n    if (trapFloors > 0) setTrapFloors(n => {\n      const next = n - 1; if (next <= 0) setTrapPenaltyMult(1); return Math.max(0, next);\n    });\n  };\n\n  const exitRun = async () => {\n    setAwaitingDecision(false);\n    setFinished(true);\n    setRunning(false);\n    setExitedVoluntarily(true);\n    await saveRun();\n  };\n\n  const saveRun = async () => {\n    if (!hero) return;\n    const victory = exitedVoluntarily; // vitria quando o jogador decide sair com prmios\n    const payload = {\n      max_floor_reached: log.length,\n      victory,\n      total_xp: totalXP,\n      total_gold: totalGold,\n      logs: log,\n      finished_at: new Date().toISOString(),\n      started_at: startedAt\n    };\n    if (activeRunId) {\n      const res = await finishDungeonRun(activeRunId, {\n        victory,\n        max_floor_reached: payload.max_floor_reached,\n        total_xp: payload.total_xp,\n        total_gold: payload.total_gold,\n        logs: payload.logs,\n        finished_at: payload.finished_at\n      });\n      if (!res.ok) setError(res.error || 'Falha ao salvar run.');\n    } else {\n      const res = await saveDungeonRun(hero, payload);\n      if (!res.ok) setError(res.error || 'Falha ao salvar run.');\n    }\n    const cdMs = 15 * 60 * 1000;\n    const ends = new Date(Date.now() + cdMs).toISOString();\n    if (hero.dungeon) updateHero(hero.id, { dungeon: { ...hero.dungeon, cooldownEndsAt: ends } });\n    // Pequeno bnus de reputao por concluir\n    if (victory) await addGuildReputation(hero, 25);\n    // bloqueio dirio removido\n  };\n\n  const resetRun = () => {\n    setRunning(false);\n    setFinished(false);\n    setFloorIndex(0);\n    setLog([]);\n    setError(null);\n  };\n\n  const handleEventAction = (action: string) => {\n    if (!hero) return;\n    const currentFloor = floorIndex + 1;\n    const boss = isBossFloor(currentFloor);\n    const mult = computeRewardMultiplier(streak) * blessingMult * trapPenaltyMult * diffParams.rewards;\n    const bossRewardMult = boss ? 1.5 : 1;\n\n    switch (pendingEvent) {\n      case 'ancient_chest': {\n        if (action === 'open') {\n          // Probabilidades base: comum 70, raro 20, pico 8, lendrio 2\n          // Aplicar vis por andar e bnus de party completa (+5%)\n          const floorBias = (dungeonConfig.rarityIncreasePerFloor || 0) * currentFloor;\n          const roll = Math.min(100, Math.random() * 100 + floorBias);\n          let tier: 'comum' | 'raro' | 'epico' | 'lendario' = 'comum';\n          if (roll >= 98) tier = 'lendario'; else if (roll >= 90) tier = 'epico'; else if (roll >= 70) tier = 'raro';\n          // Gerar loot de ba com suporte a 'comum'\n          const items = generateChestLoot(tier as any);\n          const gold = Math.round((tier === 'comum' ? 10 : tier === 'raro' ? 25 : tier === 'epico' ? 60 : 150) * mult * bossRewardMult);\n          const gloryChest = Math.round((tier === 'comum' ? 2 : tier === 'raro' ? 4 : tier === 'epico' ? 8 : 15) * bossRewardMult);\n          const essenceChest = tier === 'raro' ? 1 : tier === 'epico' ? 1 : tier === 'lendario' ? 2 : 0;\n          gainGold(hero.id, gold);\n          if (gloryChest > 0) gainGlory(hero.id, gloryChest);\n          if (essenceChest > 0) gainArcaneEssence(hero.id, essenceChest);\n          // Conceder itens ao inventrio\n          if (items.length) {\n            items.forEach(it => {\n              addItemToInventory(hero.id, it.id, 1);\n            });\n          }\n          // Chance de Ovo Misterioso em bas picos/lendrios\n          if ((tier === 'epico' || tier === 'lendario') && Math.random() < 0.2) {\n            generateEggForSelected();\n          }\n          const itemNames = items.map(i => i.name);\n          const itemIds = items.map(i => i.id);\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'chest', xpGained: 0, goldGained: gold, narrative: `Ba antigo: ${tier.toUpperCase()}  +${gold} ouro  +${gloryChest} glria${essenceChest>0?`  +${essenceChest} essncia`:''}${items.length ? '  Itens raros' : ''}` };\n          if (itemNames.length) {\n            result.itemsAwarded = itemNames;\n            result.itemIdsAwarded = itemIds;\n          }\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, {\n              max_floor_reached: newLog.length,\n              total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n              total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n              logs: newLog\n            });\n          }\n        } else {\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Voc deixou o ba intacto.' };\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, {\n              max_floor_reached: newLog.length,\n              total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n              total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n              logs: newLog\n            });\n          }\n        }\n        break;\n      }\n      case 'mystic_shrine': {\n        if (action === 'heal') {\n          const maxHp = hero.derivedAttributes.hp || 1;\n          const curHp = hero.derivedAttributes.currentHp ?? maxHp;\n          const healed = Math.min(maxHp, curHp + Math.round(maxHp * 0.5));\n          updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: healed } });\n          {\n            const result: FloorResult = { floor: currentFloor, success: true, event: 'rest', xpGained: 4, goldGained: 0, narrative: 'Santurio mstico: voc recupera foras (+HP).' };\n            const newLog = [...log, result];\n            setLog(newLog);\n            if (hero.dungeon) {\n              const currentMax = hero.dungeon.maxFloor || 0;\n              const nextMax = Math.max(currentMax, newLog.length);\n              updateHero(hero.id, { dungeon: { ...hero.dungeon, maxFloor: nextMax } });\n            }\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, {\n                max_floor_reached: newLog.length,\n                total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n                total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n                logs: newLog\n              });\n            }\n          }\n          gainXP(hero.id, Math.round(4 * mult));\n        } else if (action === 'bless') {\n          setBlessingFloors(3);\n          setBlessingMult(1.15);\n          {\n            const result: FloorResult = { floor: currentFloor, success: true, event: 'rest', xpGained: 6, goldGained: 0, narrative: 'Santurio mstico: bno temporria por 3 andares.' };\n            const newLog = [...log, result];\n            setLog(newLog);\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, {\n                max_floor_reached: newLog.length,\n                total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n                total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n                logs: newLog\n              });\n            }\n          }\n          gainXP(hero.id, Math.round(6 * mult));\n        }\n        break;\n      }\n      case 'dark_trap': {\n        const damage = Math.round((hero.derivedAttributes.hp || 20) * 0.25);\n        const curHp = hero.derivedAttributes.currentHp ?? (hero.derivedAttributes.hp || 0);\n        const newHp = Math.max(0, curHp - damage);\n        updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: newHp } });\n        setTrapFloors(3);\n        setTrapPenaltyMult(0.9);\n        {\n          const result: FloorResult = { floor: currentFloor, success: false, event: 'trap', xpGained: 0, goldGained: 0, narrative: 'Armadilha sombria: voc sofre dano e fica debilitado por 3 andares.' };\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, {\n              max_floor_reached: newLog.length,\n              total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n              total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n              logs: newLog\n            });\n          }\n        }\n        break;\n      }\n      case 'mysterious_merchant': {\n        if (action === 'buy') {\n          const cost = Math.round(50 * bossRewardMult);\n          if (hero.progression.gold >= cost) {\n            gainGold(hero.id, -cost);\n            const merchandise = generateChestLoot('raro');\n            const chosen = merchandise[0];\n            if (chosen) {\n              addItemToInventory(hero.id, chosen.id, 1);\n            }\n            {\n              const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: -cost, narrative: `Mercador misterioso: voc compra ${chosen ? chosen.name : 'um artefato'} por ${cost} ouro.` };\n              if (chosen) {\n                result.itemsAwarded = [chosen.name];\n                result.itemIdsAwarded = [chosen.id];\n              }\n              const newLog = [...log, result];\n              setLog(newLog);\n              if (activeRunId) {\n                updateDungeonRun(activeRunId, {\n                  max_floor_reached: newLog.length,\n                  total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n                  total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n                  logs: newLog\n                });\n              }\n            }\n          } else {\n            const result: FloorResult = { floor: currentFloor, success: false, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Mercador misterioso: ouro insuficiente.' };\n            const newLog = [...log, result];\n            setLog(newLog);\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, {\n                max_floor_reached: newLog.length,\n                total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n                total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n                logs: newLog\n              });\n            }\n          }\n        } else {\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Mercador misterioso: voc recusa a oferta.' };\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, {\n              max_floor_reached: newLog.length,\n              total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n              total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n              logs: newLog\n            });\n          }\n        }\n        break;\n      }\n      case 'secret_gate': {\n        const dirForward = Math.random() < 0.7;\n        const delta = dirForward ? (1 + Math.floor(Math.random() * 3)) : (-(1 + Math.floor(Math.random() * 2)));\n        setFloorIndex(i => Math.max(0, i + delta));\n        const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: `Porto secreto: voc  teleportado ${dirForward ? `${delta} andares  frente` : `${Math.abs(delta)} andares atrs`}.` };\n        const newLog = [...log, result];\n        setLog(newLog);\n        if (activeRunId) {\n          updateDungeonRun(activeRunId, {\n            max_floor_reached: newLog.length,\n            total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n            total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n            logs: newLog\n          });\n        }\n        break;\n      }\n      case 'echo_of_past': {\n        const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 2, goldGained: 0, narrative: 'Eco do passado: O corredor escurece passos ecoam nas sombras. Um olhar flamejante te observa.' };\n        const newLog = [...log, result];\n        setLog(newLog);\n        if (activeRunId) {\n          updateDungeonRun(activeRunId, {\n            max_floor_reached: newLog.length,\n            total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n            total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n            logs: newLog\n          });\n        }\n        gainXP(hero.id, Math.round(2 * mult));\n        break;\n      }\n      case 'environment_puzzle': {\n        if (action === 'attempt') {\n          const solved = Math.random() < 0.6;\n          if (solved) {\n            const xp = Math.round(10 * mult);\n            gainXP(hero.id, xp);\n            const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: xp, goldGained: 0, narrative: 'Quebra-cabea ambiental resolvido. Portas se abrem adiante.' };\n            const newLog = [...log, result];\n            setLog(newLog);\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n            }\n          } else {\n            const result: FloorResult = { floor: currentFloor, success: false, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Voc falha no mecanismo e libera uma fumaa irritante.' };\n            const newLog = [...log, result];\n            setLog(newLog);\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n            }\n          }\n        } else {\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Voc ignora o enigma e segue em frente.' };\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n          }\n        }\n        break;\n      }\n      case 'npc_encounter': {\n        if (action === 'talk') {\n          const npc = hero;\n          const speech = getNPCDialogue(npc, hero, `bioma ${getBiomeByFloor(currentFloor)}`);\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'rest', xpGained: 3, goldGained: 0, narrative: speech };\n          const newLog = [...log, result];\n          setLog(newLog);\n          gainXP(hero.id, Math.round(3 * mult));\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n          }\n        } else {\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Voc passa silenciosamente pelo viajante.' };\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n          }\n        }\n        break;\n      }\n      case 'collectible_relic': {\n        if (action === 'collect') {\n          const items = ['reliquia-brilho-eterno','reliquia-contos-sussurrados','coroa-quebrada'];\n          const chosen = items[Math.floor(Math.random() * items.length)];\n          addItemToInventory(hero.id, chosen, 1);\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Voc encontra uma relquia com histrias gravadas.' };\n          result.itemIdsAwarded = [chosen];\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n          }\n        } else {\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Voc deixa a relquia onde est.' };\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n          }\n        }\n        break;\n      }\n      case 'corrupted_fountain': {\n        if (action === 'purify') {\n          const successPurify = Math.random() < 0.5;\n          if (successPurify) {\n            setBlessingFloors(2);\n            setBlessingMult(1.2);\n            const result: FloorResult = { floor: currentFloor, success: true, event: 'rest', xpGained: 5, goldGained: 0, narrative: 'Voc purifica a fonte e recebe uma beno.' };\n            const newLog = [...log, result];\n            setLog(newLog);\n            gainXP(hero.id, Math.round(5 * mult));\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n            }\n          } else {\n            setTrapFloors(2);\n            setTrapPenaltyMult(0.85);\n            const result: FloorResult = { floor: currentFloor, success: false, event: 'trap', xpGained: 0, goldGained: 0, narrative: 'A corrupo te atinge; voc  enfraquecido.' };\n            const newLog = [...log, result];\n            setLog(newLog);\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n            }\n          }\n        } else {\n          const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: 'Voc evita a fonte corrompida.' };\n          const newLog = [...log, result];\n          setLog(newLog);\n          if (activeRunId) {\n            updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n          }\n        }\n        break;\n      }\n      case 'celestial_portal': {\n        const forward = Math.random() < 0.8;\n        const delta = forward ? 2 + Math.floor(Math.random() * 4) : -(1 + Math.floor(Math.random() * 2));\n        setFloorIndex(i => Math.max(0, i + delta));\n        const result: FloorResult = { floor: currentFloor, success: true, event: 'none', xpGained: 0, goldGained: 0, narrative: forward ? 'Um portal celeste te empurra adiante.' : 'O portal te joga de volta, mas voc aprende com o salto.' };\n        const newLog = [...log, result];\n        setLog(newLog);\n        if (activeRunId) {\n          updateDungeonRun(activeRunId, { max_floor_reached: newLog.length, total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0), total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0), logs: newLog });\n        }\n        break;\n      }\n    }\n    setPendingEvent('none');\n    setAwaitingEventChoice(false);\n    setAwaitingDecision(true);\n  };\n\n  const biomeNow = getBiomeByFloor(floorIndex + 1);\n  const [lightPos, setLightPos] = useState<{ x: number; y: number }>({ x: 50, y: 50 });\n  return (\n    <div\n      className={`relative overflow-hidden max-w-3xl mx-auto p-6 bg-gradient-to-b ${getBiomeClasses(biomeNow)} rounded-lg shadow-xl`}\n      onMouseMove={(e) => {\n        const rect = (e.currentTarget as HTMLDivElement).getBoundingClientRect();\n        const x = ((e.clientX - rect.left) / rect.width) * 100;\n        const y = ((e.clientY - rect.top) / rect.height) * 100;\n        setLightPos({ x, y });\n      }}\n    >\n      <h2 className=\"text-2xl font-bold text-white\">Dungeon Infinita</h2>\n      <p className=\"text-gray-300\">Andar atual: {floorIndex + 1} {isBossFloor(floorIndex + 1) ? ' Boss' : ''}</p>\n      <p className=\"text-indigo-200\">Bioma: {getBiomeByFloor(floorIndex + 1)}</p>\n      <p className=\"text-indigo-300\">Limite por rank: at {maxFloorsAllowed} andares ({heroRank || ''})</p>\n      <p className=\"text-indigo-300\">Streak: {streak}  Multiplicador: x{computeRewardMultiplier(streak).toFixed(2)}</p>\n\n      {/* Limite dirio removido */}\n\n      {!running && !finished && (\n        <div className=\"mt-4\">\n          <div className=\"mb-3 flex gap-2 items-center\">\n            <span className=\"text-sm text-gray-300\">Dificuldade:</span>\n            <select value={difficulty} onChange={(e) => setDifficulty(e.target.value as DungeonDifficulty)} className=\"px-2 py-1 rounded bg-gray-700 text-gray-100\">\n              <option value=\"facil\">Fcil</option>\n              <option value=\"normal\">Normal</option>\n              <option value=\"dificil\">Difcil</option>\n              <option value=\"epico\">pico</option>\n              <option value=\"hardcore\">Hardcore</option>\n              <option value=\"caotico\">Catico</option>\n            </select>\n          </div>\n          <button\n            onClick={startRun}\n            disabled={!hero || !heroRank || heroRank === 'F' || heroRank === 'E'}\n            className=\"px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50\"\n          >\n            Iniciar Tentativa\n          </button>\n          {(!heroRank || heroRank === 'F' || heroRank === 'E') && (\n            <div className=\"mt-2 text-sm text-red-300\">Requer rank D ou superior para entrar.</div>\n          )}\n        </div>\n      )}\n\n      <div className=\"vfx-layer\">\n        <div className=\"vfx-fog\" />\n        {biomeNow === 'cripta-nevada' && (\n          <div className=\"vfx-snow\">\n            {Array.from({ length: 50 }).map((_, i) => (\n              <span key={`flake-${i}`} className=\"flake\" style={{ ['--x' as any]: `${Math.random() * 100}%`, ['--dur' as any]: `${7 + Math.random() * 5}s`, ['--delay' as any]: `${Math.random() * 4}s` }} />\n            ))}\n          </div>\n        )}\n        {biomeNow === 'deserto-oculto' && (\n          <div className=\"vfx-embers\">\n            {Array.from({ length: 40 }).map((_, i) => (\n              <span key={`ember-${i}`} className=\"ember\" style={{ ['--x' as any]: `${Math.random() * 100}%`, ['--dur' as any]: `${5 + Math.random() * 4}s`, ['--delay' as any]: `${Math.random() * 3}s` }} />\n            ))}\n          </div>\n        )}\n        {biomeNow === 'floresta-fungica' && (\n          <div className=\"vfx-spores\">\n            {Array.from({ length: 36 }).map((_, i) => (\n              <span key={`spore-${i}`} className=\"spore\" style={{ ['--x' as any]: `${Math.random() * 100}%`, ['--dur' as any]: `${6 + Math.random() * 6}s`, ['--delay' as any]: `${Math.random() * 2.5}s` }} />\n            ))}\n          </div>\n        )}\n        {biomeNow === 'abismo-eterio' && (\n          <div className=\"vfx-stars\">\n            {Array.from({ length: 60 }).map((_, i) => (\n              <span key={`star-${i}`} className=\"star\" style={{ ['--x' as any]: `${Math.random() * 100}%`, ['--y' as any]: `${Math.random() * 100}%`, ['--dur' as any]: `${2 + Math.random() * 3}s`, ['--delay' as any]: `${Math.random() * 2}s` }} />\n            ))}\n          </div>\n        )}\n        <div className=\"lantern-overlay\" style={{ ['--lx' as any]: `${lightPos.x}%`, ['--ly' as any]: `${lightPos.y}%` }} />\n      </div>\n\n      {running && (\n        <div className=\"mt-4 p-4 border rounded bg-gray-800 border-gray-700\">\n          <div className=\"text-gray-200\">Andar {floorIndex + 1}</div>\n          <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-3 gap-2\">\n            <button onClick={() => handleChoice('safe')} disabled={loading} className=\"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600 disabled:opacity-50\">Seguro</button>\n            <button onClick={() => handleChoice('normal')} disabled={loading} className=\"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600 disabled:opacity-50\">Padro</button>\n            <button onClick={() => handleChoice('risky')} disabled={loading} className=\"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600 disabled:opacity-50\">Arriscado</button>\n          </div>\n          {awaitingCombatChoice && battleEnemies.length > 0 && (\n            <div className=\"mt-4 p-3 border border-red-700 bg-red-900/20 rounded\">\n              <div className=\"text-white font-semibold\">Combate</div>\n              <div className=\"mt-1 text-gray-200\">Inimigos: {battleEnemies.map(e => `${e.count} ${e.type}${e.count>1?'s':''}`).join(', ')}</div>\n              <div className=\"mt-2 flex gap-2\">\n                <button onClick={() => { setAwaitingCombatChoice(false); setShowBattle(true); }} className=\"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700\">Atacar</button>\n                <button onClick={() => {\n                  const maxHp = hero.derivedAttributes.hp || 1;\n                  const curHp = hero.derivedAttributes.currentHp ?? maxHp;\n                  const healed = Math.min(maxHp, curHp + 20);\n                  updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: healed } });\n                  setAwaitingCombatChoice(false);\n                  setShowBattle(true);\n                }} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700\">Usar item</button>\n                <button onClick={() => {\n                  const fleeSuccess = Math.random() < 0.6;\n                  if (fleeSuccess) {\n                    setLog(prev => [...prev, { floor: floorIndex + 1, success: true, event: 'none', xpGained: 2, goldGained: 0, narrative: 'Voc fugiu do combate.' }]);\n                    gainXP(hero.id, 2);\n                    setAwaitingCombatChoice(false);\n                    setAwaitingDecision(true);\n                  } else {\n                    setAwaitingCombatChoice(false);\n                    setShowBattle(true);\n                  }\n                }} className=\"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700\">Fugir</button>\n              </div>\n            </div>\n          )}\n      {awaitingDecision && !finished && (\n        <div className=\"mt-4 flex items-center gap-3\">\n          <button onClick={ascend} className=\"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700\">Subir</button>\n          <button onClick={exitRun} className=\"px-3 py-2 rounded bg-amber-600 text-black hover:bg-amber-500\">Sair com prmios</button>\n          <span className=\"text-sm text-gray-400\">Multiplicador atual: x{computeRewardMultiplier(streak).toFixed(2)}</span>\n        </div>\n      )}\n      {bossRewardPending && !finished && (\n        <div className=\"mt-4 p-3 border border-yellow-700 bg-yellow-900/20 rounded\">\n          <div className=\"text-white font-semibold\">Recompensa de Chefe</div>\n          <div className=\"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2\">\n            <button onClick={() => { setSelectedAttrReward('forca'); updateHero(hero!.id, { dungeon: { ...((hero!.dungeon)||{}), permanentBonusAttributes: { ...((hero!.dungeon?.permanentBonusAttributes)||{}), forca: ((hero!.dungeon?.permanentBonusAttributes?.forca)||0)+1 } } }); setBossRewardPending(false); setAwaitingDecision(true); }} className=\"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700\">+1 atributo permanente</button>\n            <button onClick={() => { const cur = hero!.dungeon?.rareItemBonusPercent ?? 0; updateHero(hero!.id, { dungeon: { ...((hero!.dungeon)||{}), rareItemBonusPercent: Math.min(100, cur + 10) } }); setBossRewardPending(false); setAwaitingDecision(true); }} className=\"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700\">+10% item raro</button>\n            <button onClick={() => { const list = hero!.dungeon?.specialSkills || []; updateHero(hero!.id, { dungeon: { ...((hero!.dungeon)||{}), specialSkills: [...list, 'habilidade-especial'] } }); setBossRewardPending(false); setAwaitingDecision(true); }} className=\"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700\">Habilidade especial</button>\n            <button onClick={() => { const buffs = hero!.dungeon?.eternalBuffs || []; updateHero(hero!.id, { dungeon: { ...((hero!.dungeon)||{}), eternalBuffs: [...buffs, 'buff-eterno'] } }); setBossRewardPending(false); setAwaitingDecision(true); }} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700\">Buff eterno da dungeon</button>\n          </div>\n        </div>\n      )}\n          {awaitingEventChoice && !finished && (\n            <div className=\"mt-4 p-3 border border-indigo-700 bg-indigo-900/20 rounded\">\n              <div className=\"text-white font-semibold\">Eventos Aleatrios</div>\n              {pendingEvent === 'ancient_chest' && (\n                <div className=\"mt-2 text-gray-200\">\n                  Ba Antigo: abrir pode dar loot raro ou ser armadilha.\n                  <div className=\"mt-2 flex gap-2\">\n                    <button onClick={() => handleEventAction('open')} className=\"px-3 py-2 rounded bg-amber-600 text-black hover:bg-amber-500\">Abrir</button>\n                    <button onClick={() => handleEventAction('skip')} className=\"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700\">Ignorar</button>\n                  </div>\n                </div>\n              )}\n              {pendingEvent === 'mystic_shrine' && (\n                <div className=\"mt-2 text-gray-200\">\n                  Santurio Mstico: cura HP ou concede bno temporria.\n                  <div className=\"mt-2 flex gap-2\">\n                    <button onClick={() => handleEventAction('heal')} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700\">Cura</button>\n                    <button onClick={() => handleEventAction('bless')} className=\"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700\">Bno</button>\n                  </div>\n                </div>\n              )}\n              {pendingEvent === 'mysterious_merchant' && (\n                <div className=\"mt-2 text-gray-200\">\n                  Mercador Misterioso: vende itens raros por ouro coletado.\n                  <div className=\"mt-2 flex gap-2\">\n                    <button onClick={() => handleEventAction('buy')} className=\"px-3 py-2 rounded bg-yellow-600 text-black hover:bg-yellow-500\">Comprar</button>\n                    <button onClick={() => handleEventAction('skip')} className=\"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700\">Recusar</button>\n                  </div>\n                </div>\n              )}\n              {pendingEvent === 'secret_gate' && (\n                <div className=\"mt-2 text-gray-200\">\n                  Porto Secreto: teleporta 1-3 andares  frente (ou atrs).\n                  <div className=\"mt-2\">\n                    <button onClick={() => handleEventAction('teleport')} className=\"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700\">Usar Porto</button>\n                  </div>\n                </div>\n              )}\n              {pendingEvent === 'echo_of_past' && (\n                <div className=\"mt-2 text-gray-200\">\n                  Eco do Passado: mostra uma histria curta do mundo.\n                  <div className=\"mt-2\">\n                    <button onClick={() => handleEventAction('listen')} className=\"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700\">Escutar</button>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n          <div className=\"mt-4\">\n            <h3 className=\"text-white font-semibold\">Registro</h3>\n            <ul className=\"mt-2 text-sm text-gray-300 list-disc pl-5\">\n              {log.map((r, i) => (\n                <li key={`floor-${r.floor}-${i}`}>Andar {r.floor}: {r.narrative}</li>\n              ))}\n            </ul>\n          </div>\n          {log.some(r => (r.itemIdsAwarded && r.itemIdsAwarded.length > 0) || (r.itemsAwarded && r.itemsAwarded.length > 0)) && (\n            <div className=\"mt-4\">\n              <h3 className=\"text-white font-semibold\">Loot por Andar</h3>\n              <ul className=\"mt-2 text-sm text-gray-200 list-disc pl-5\">\n                {log.filter(r => (r.itemIdsAwarded && r.itemIdsAwarded.length > 0) || (r.itemsAwarded && r.itemsAwarded.length > 0)).map((r, i) => (\n                  <li key={`loot-${r.floor}-${i}`} className=\"flex flex-col gap-1\">\n                    <span>Andar {r.floor}:</span>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {(r.itemIdsAwarded && r.itemIdsAwarded.length > 0 ? r.itemIdsAwarded : []).map((itemId, j) => {\n                        const item = SHOP_ITEMS.find(i => i.id === itemId);\n                        const rarityClass = item?.rarity === 'lendario' ? 'bg-yellow-600' : item?.rarity === 'epico' ? 'bg-purple-600' : item?.rarity === 'raro' ? 'bg-blue-600' : 'bg-gray-600';\n                        const equipable = item && (item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory');\n                        const consumable = item?.type === 'consumable';\n                        const isEquipped = !!hero && (\n                          (item?.type === 'weapon' && hero.inventory.equippedWeapon === itemId) ||\n                          (item?.type === 'armor' && hero.inventory.equippedArmor === itemId) ||\n                          (item?.type === 'accessory' && (hero.inventory.equippedAccessories || []).includes(itemId))\n                        );\n                        const bonusParts: string[] = [];\n                        if (item?.bonus) {\n                          Object.entries(item.bonus).forEach(([k, v]) => {\n                            if (typeof v === 'number' && v !== 0) bonusParts.push(`${k}: ${v > 0 ? '+' : ''}${v}`);\n                          });\n                        }\n                        const tooltip = equipable\n                          ? `${item?.name}  ${bonusParts.length ? bonusParts.join(', ') : 'sem bnus'}`\n                          : consumable\n                          ? `${item?.name}  Consumvel`\n                          : item?.name || itemId;\n                        return (\n                          <button\n                            key={`${r.floor}-${itemId}-${j}`}\n                            title={tooltip}\n                            onClick={() => {\n                              if (!hero) return;\n                              if (equipable) {\n                                if (isEquipped) {\n                                  const ok = unequipItem(hero.id, itemId);\n                                  setLootFeedback(ok ? `${item?.name} desequipado!` : `No foi possvel desequipar ${item?.name}.`);\n                                } else {\n                                  const ok = equipItem(hero.id, itemId);\n                                  setLootFeedback(ok ? `${item?.name} equipado!` : `No foi possvel equipar ${item?.name}.`);\n                                }\n                              } else if (consumable) {\n                                const ok = useItem(hero.id, itemId);\n                                const itemName = item?.name || itemId;\n                                if (ok) {\n                                  // Detalhe fica no Inventory via store; aqui damos um resumo simples\n                                  setLootFeedback(`${itemName} usado! Efeito aplicado.`);\n                                } else {\n                                  setLootFeedback(`No foi possvel usar ${itemName}.`);\n                                }\n                              } else {\n                                return;\n                              }\n                              setTimeout(() => setLootFeedback(null), 2000);\n                            }}\n                            className={`px-2 py-1 rounded ${rarityClass} text-white text-xs hover:opacity-90`}\n                          >\n                            {item?.icon ? `${item.icon} ` : ''}{item?.name || itemId}{equipable ? (isEquipped ? '  Desequipar' : '  Equipar') : consumable ? '  Usar' : ''}\n                          </button>\n                        );\n                      })}\n                      {!r.itemIdsAwarded && r.itemsAwarded && r.itemsAwarded.length > 0 && (\n                        <span className=\"px-2 py-1 rounded bg-gray-600 text-white text-xs\">{r.itemsAwarded.join(', ')}</span>\n                      )}\n                    </div>\n                  </li>\n                ))}\n              </ul>\n              {lootFeedback && (\n                <div className=\"mt-2 text-xs text-green-300\">{lootFeedback}</div>\n              )}\n            </div>\n          )}\n          <div className=\"mt-4 text-sm text-gray-200\">Total: {totalXP} XP, {totalGold} ouro</div>\n        </div>\n      )}\n\n      {finished && (\n        <div className=\"mt-4 p-3 bg-gray-700 rounded\">\n          <div className=\"text-lg font-semibold text-white\">Run finalizada</div>\n          <div className=\"text-sm text-gray-300\">Andares concludos: {log.length}  Total: {totalXP} XP, {totalGold} ouro</div>\n          {error && <div className=\"mt-2 text-red-300\">{error}</div>}\n          <div className=\"mt-3 flex gap-2\">\n            <button onClick={saveRun} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700\">Salvar tentativa</button>\n            <button onClick={resetRun} className=\"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700\">Reiniciar</button>\n          </div>\n        </div>\n      )}\n\n      {showBattle && battleEnemies.length > 0 && hero && (\n        <BattleModal\n          hero={hero as any}\n          enemies={battleEnemies as any}\n          floor={floorIndex + 1}\n          partyRarityBonusPercent={0}\n          onClose={() => setShowBattle(false)}\n          onResult={(res) => {\n            const currentFloor = floorIndex + 1;\n            const boss = isBossFloor(currentFloor);\n            const mult = computeRewardMultiplier(streak);\n          const bossRewardMult = boss ? 1.5 : 1;\n            const xp = Math.round((res.xpGained || 0) * mult * bossRewardMult * diffParams.rewards);\n            const gold = Math.round((res.goldGained || 0) * mult * bossRewardMult * diffParams.rewards);\n            const glory = Math.round(gold * 0.5);\n            const essence = boss ? 1 : 0;\n\n            // Aplicar recompensas e dano\n            gainXP(hero.id, xp);\n            gainGold(hero.id, gold);\n            if (glory > 0) gainGlory(hero.id, glory);\n            if (essence > 0) gainArcaneEssence(hero.id, essence);\n            const curHp = hero.derivedAttributes.currentHp ?? (hero.derivedAttributes.hp || 0);\n            const newHp = Math.max(0, curHp - (res.damage || 0));\n            updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: newHp } });\n\n            const victory = !!res.victory;\n            const result: FloorResult = {\n              floor: currentFloor,\n              success: victory,\n              event: 'combat',\n              xpGained: xp,\n              goldGained: gold,\n              narrative: makeNarrative(victory, 'combat', xp, gold)\n            };\n            const newLog = [...log, result];\n            setLog(newLog);\n            if (activeRunId) {\n              updateDungeonRun(activeRunId, {\n                max_floor_reached: newLog.length,\n                total_xp: newLog.reduce((acc, r) => acc + r.xpGained, 0),\n                total_gold: newLog.reduce((acc, r) => acc + r.goldGained, 0),\n                logs: newLog\n              });\n            }\n\n            // Drops especiais de boss: Essncia Bestial e Pergaminho de Montaria\n            if (victory && boss) {\n              if (Math.random() < 0.3) addItemToInventory(hero.id, 'essencia-bestial', 1);\n              if (Math.random() < 0.25) addItemToInventory(hero.id, 'pergaminho-montaria', 1);\n            }\n\n            if (victory) {\n              logActivity.combatVictory({ heroId: hero.id, heroName: hero.name, heroClass: hero.class, enemiesDefeated: boss ? ['Boss da faixa'] : battleEnemies.map(e => e.type) });\n              if (boss) {\n                setBossRewardPending(true);\n                setAwaitingDecision(false);\n              } else {\n                setAwaitingDecision(true);\n              }\n            } else {\n              // Derrota: penalidade maior se for boss\n              if (boss) {\n                const goldLoss = Math.round(totalGold * dungeonConfig.deathPenalty.normal.gold);\n                const xpLoss = Math.round(totalXP * dungeonConfig.deathPenalty.normal.xp);\n                gainGold(hero.id, -goldLoss);\n                gainXP(hero.id, -xpLoss);\n              }\n              setFinished(true);\n              setRunning(false);\n              setAwaitingDecision(false);\n              const stats = { ...(hero.stats || {}) } as any;\n              updateHero(hero.id, { stats: { ...stats, inDungeon: false } });\n            }\n\n            setShowBattle(false);\n            setBattleEnemies([]);\n\n            if (victory && boss) {\n              const rank = (hero.rankData?.currentRank || 'F') as RankLevel;\n              const rankBonusMap: Record<RankLevel, number> = { F: 0, E: 0.02, D: 0.04, C: 0.06, B: 0.08, A: 0.1, S: 0.12 };\n              const rb = rankBonusMap[rank] || 0;\n              const essenceChance = Math.min(0.6, 0.3 + rb);\n              const scrollChance = Math.min(0.5, 0.25 + rb * 0.5);\n              if (Math.random() < essenceChance) addItemToInventory(hero.id, 'essencia-bestial', 1);\n              if (Math.random() < scrollChance) addItemToInventory(hero.id, 'pergaminho-montaria', 1);\n            }\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","import { Hero } from '../types/hero'\nimport { RankLevel } from '../types/ranks'\n\nexport type HuntingCategory = 'controle' | 'coleta' | 'escolta' | 'especial'\nexport type Biome = 'Colinas de Boravon' | 'Rio Marfim' | 'Floresta Nebulosa' | 'Runas Antigas' | 'Floresta Umbral' | 'Caverna Antiga'\n\nexport interface HuntingMission {\n  id: string\n  title: string\n  category: HuntingCategory\n  biome: Biome\n  objective: string\n  target: string\n  amount: number\n  phases: number\n  difficulty: 'facil' | 'medio' | 'dificil' | 'epica'\n  rankRequired: RankLevel\n  baseRewards: { xp: number; gold: number }\n  narrative: string\n  staminaPerPhase: number\n  classHint?: string\n  timeHint?: 'dia' | 'noite'\n}\n\nconst BIOME_TARGETS: Record<Biome, Array<{ target: string; objectivePrefix: string }>> = {\n  'Colinas de Boravon': [\n    { target: 'Lobo Sombrio', objectivePrefix: 'Abater' },\n    { target: 'Bandido Errante', objectivePrefix: 'Neutralizar' }\n  ],\n  'Rio Marfim': [\n    { target: 'Slime cido', objectivePrefix: 'Reduzir' },\n    { target: 'Serpente do Rio', objectivePrefix: 'Afastar' }\n  ],\n  'Floresta Nebulosa': [\n    { target: 'Morcego Vampiro', objectivePrefix: 'Eliminar' },\n    { target: 'Bruxa da Nvoa', objectivePrefix: 'Derrubar' }\n  ],\n  'Runas Antigas': [\n    { target: 'Golem Rachado', objectivePrefix: 'Destruir' }\n  ],\n  'Floresta Umbral': [\n    { target: 'Bruxa da Nvoa', objectivePrefix: 'Derrubar' }\n  ],\n  'Caverna Antiga': [\n    { target: 'Troll de Pedra', objectivePrefix: 'Caar' }\n  ]\n}\n\nfunction chooseBiome(hero: Hero): Biome {\n  const biomes: Biome[] = ['Colinas de Boravon','Rio Marfim','Floresta Nebulosa','Runas Antigas','Floresta Umbral','Caverna Antiga']\n  return biomes[Math.floor(Math.random() * biomes.length)]\n}\n\nfunction gatingByRank(rank?: RankLevel): Array<HuntingCategory> {\n  const r = rank || 'F'\n  if (r === 'F') return ['controle','coleta','escolta']\n  if (r === 'E') return ['controle','coleta','escolta']\n  if (r === 'D') return ['controle','coleta','escolta']\n  if (r === 'C') return ['controle','coleta','escolta']\n  if (r === 'B') return ['controle','coleta','escolta','especial']\n  return ['controle','coleta','escolta','especial']\n}\n\nfunction phasesByCategory(cat: HuntingCategory): number {\n  if (cat === 'controle') return 3\n  if (cat === 'coleta') return 3\n  if (cat === 'escolta') return 4\n  return 3\n}\n\nfunction rankRequirement(cat: HuntingCategory): RankLevel {\n  if (cat === 'especial') return 'A'\n  if (cat === 'escolta') return 'F'\n  if (cat === 'controle') return 'F'\n  return 'F'\n}\n\nexport function generateHuntingMission(hero: Hero, preferredBiome?: Biome, preferredCategory?: HuntingCategory): HuntingMission {\n  const rank = hero.rankData?.currentRank as RankLevel | undefined\n  const allowed = gatingByRank(rank)\n  // Vis por classe\n  const cls = (hero.class || '').toLowerCase()\n  const classBias: Record<string, HuntingCategory[]> = {\n    arqueiro: ['controle','especial','escolta'],\n    guerreiro: ['controle','especial'],\n    mago: ['coleta','especial'],\n    clerigo: ['escolta','controle'],\n    paladino: ['escolta','controle'],\n    assassino: ['controle','especial']\n  }\n  const bias = Object.entries(classBias).find(([k]) => cls.includes(k))?.[1] || []\n  const pickPool = (rank === 'F') ? allowed : (bias.length ? [...bias, ...allowed] : allowed)\n  const category = (preferredCategory && allowed.includes(preferredCategory)) ? preferredCategory : pickPool[Math.floor(Math.random() * pickPool.length)]\n  const biome = preferredBiome || chooseBiome(hero)\n  const pool = BIOME_TARGETS[biome]\n  const chosen = pool[Math.floor(Math.random() * pool.length)]\n  const amount = category === 'controle' ? (6 + Math.floor(Math.random()*5)) : category === 'coleta' ? (4 + Math.floor(Math.random()*4)) : category === 'escolta' ? 1 : 1\n  let diff: 'facil'|'medio'|'dificil'|'epica' = category === 'especial' ? 'epica' : hero.progression.level < 5 ? 'facil' : hero.progression.level < 10 ? 'medio' : 'dificil'\n  let phases = phasesByCategory(category)\n  const rankReq = rankRequirement(category)\n  if (rankReq === 'F') diff = 'facil'\n  if (rankReq === 'F' && category === 'coleta') phases = 2\n  if (rankReq === 'F' && category === 'escolta') phases = 3\n  let baseRewards = { xp: diff === 'epica' ? 120 : diff === 'dificil' ? 90 : diff === 'medio' ? 60 : 40, gold: diff === 'epica' ? 70 : diff === 'dificil' ? 50 : diff === 'medio' ? 35 : 20 }\n  if (rankReq === 'F' && category === 'escolta') baseRewards = { ...baseRewards, xp: baseRewards.xp + 8, gold: baseRewards.gold + 5 }\n  if (rankReq === 'F' && category === 'controle') baseRewards = { ...baseRewards, xp: baseRewards.xp + 5, gold: baseRewards.gold + 3 }\n  const title = category === 'controle' ? `Controle da ${chosen.target}` : category === 'coleta' ? `Coleta de Recursos` : category === 'escolta' ? `Escolta Segura` : `Alvo Especial`\n  const objective = category === 'coleta' ? `Coletar ${amount} ${chosen.target === 'Bruxa da Nvoa' ? 'Essncias Umbral' : 'Ervas/Recursos'}` : `${chosen.objectivePrefix} ${category === 'controle' ? amount : chosen.target}`\n  const narrative = category === 'controle' ? `A populao de ${chosen.target} ameaa caravanas em ${biome}. Reduza sua presena.` : category === 'coleta' ? `Recursos raros foram avistados em ${biome}. Obtenha-os sob risco controlado.` : category === 'escolta' ? `Um NPC precisa alcanar ${biome} em segurana. O caminho  perigoso.` : `Um alvo nico foi identificado em ${biome}. Derrube-o para obter recompensas.`\n  const staminaPerPhase = diff === 'epica' ? 5 : diff === 'dificil' ? 4 : diff === 'medio' ? 3 : 2\n  const timeHint: 'dia'|'noite' | undefined = (() => {\n    if (biome === 'Floresta Nebulosa' || biome === 'Floresta Umbral') return Math.random() < 0.7 ? 'noite' : undefined\n    if (biome === 'Rio Marfim') return Math.random() < 0.6 ? 'dia' : undefined\n    if (category === 'coleta' && Math.random() < 0.5) return Math.random() < 0.5 ? 'noite' : 'dia'\n    return undefined\n  })()\n  const classHint = bias.length ? `Classe favorecida em ${category}` : undefined\n  return {\n    id: `hunt_${Date.now()}_${Math.random().toString(36).slice(2)}`,\n    title,\n    category,\n    biome,\n    objective,\n    target: chosen.target,\n    amount,\n    phases,\n    difficulty: diff,\n    rankRequired: rankReq,\n    baseRewards,\n    narrative,\n    staminaPerPhase,\n    classHint,\n    timeHint\n  }\n}\n","import React, { useEffect, useMemo, useState } from 'react'\nimport { useHeroStore } from '../store/heroStore'\nimport { worldStateManager } from '../utils/worldState'\nimport { generateHuntingMission, HuntingMission, Biome } from '../utils/huntingGenerator'\nimport { RANK_ORDER } from '../types/ranks'\nimport { computeRewardMultiplier } from '../utils/dungeonConfig'\nimport { rankSystem } from '../utils/rankSystem'\nimport { generateChestLoot } from '../utils/chestLoot'\nimport { SHOP_ITEMS } from '../utils/shop'\nimport { useHeroStore as useStoreRef } from '../store/heroStore'\n\ntype PhaseResult = { phase: number; success: boolean; xp: number; gold: number; narrative: string; itemsAwarded?: { id: string; name?: string }[] }\n\nexport default function HuntingMissions() {\n  const hero = useHeroStore(s => s.getSelectedHero())\n  const gainXP = useHeroStore(s => s.gainXP)\n  const gainGold = useHeroStore(s => s.gainGold)\n  const addItemToInventory = useHeroStore(s => s.addItemToInventory)\n  const updateHero = useHeroStore(s => s.updateHero)\n  const updateDailyGoalProgress = useHeroStore(s => s.updateDailyGoalProgress)\n  const generateEggForSelected = useStoreRef(s => s.generateEggForSelected)\n\n  const [biome, setBiome] = useState<Biome>('Colinas de Boravon')\n  const [categorySel, setCategorySel] = useState<'controle'|'coleta'|'escolta'|'especial'|null>(null)\n  const [mission, setMission] = useState<HuntingMission | null>(null)\n  const [running, setRunning] = useState(false)\n  const [finished, setFinished] = useState(false)\n  const [phaseIndex, setPhaseIndex] = useState(0)\n  const [log, setLog] = useState<PhaseResult[]>([])\n  const [error, setError] = useState<string | null>(null)\n  const [streak, setStreak] = useState(0)\n  const [npcIntegrity, setNpcIntegrity] = useState<number | null>(null)\n  const [anyLoot, setAnyLoot] = useState(false)\n  const getHeroRankProgress = useHeroStore(s => s.getHeroRankProgress)\n  const rankProgress = useMemo(() => (hero ? getHeroRankProgress(hero.id) : null), [hero?.id, hero?.progression?.xp, hero?.stats?.questsCompleted])\n  const [autoRun, setAutoRun] = useState(false)\n  const [showDetails, setShowDetails] = useState(false)\n  const cdMs = useMemo(() => {\n    const ends = hero?.hunting?.cooldownEndsAt ? new Date(hero.hunting.cooldownEndsAt).getTime() : 0\n    return ends ? Math.max(0, ends - Date.now()) : 0\n  }, [hero?.hunting?.cooldownEndsAt])\n  const cdActive = cdMs > 0\n  const getHuntingCooldownMinutes = () => {\n    const r = (hero?.rankData?.currentRank || 'F') as 'F'|'E'|'D'|'C'|'B'|'A'|'S'\n    const map: Record<'F'|'E'|'D'|'C'|'B'|'A'|'S', number> = { F: 8, E: 12, D: 15, C: 20, B: 25, A: 30, S: 40 }\n    return map[r] || 15\n  }\n\n  const phasesTotal = useMemo(() => mission?.phases || 0, [mission?.phases])\n  const rank = hero?.rankData?.currentRank\n\n  useEffect(() => {\n    if (!hero) return\n    const prefCat = (hero.rankData?.currentRank === 'F') ? (categorySel ?? undefined) : undefined\n    setMission(generateHuntingMission(hero, biome, prefCat as any))\n  }, [hero?.id, biome, categorySel])\n\n  const canEnter = useMemo(() => {\n    if (!hero || !mission) return false\n    const r = hero.rankData?.currentRank\n    const idxHero = RANK_ORDER.indexOf((r || 'F') as any)\n    const idxReq = RANK_ORDER.indexOf(mission.rankRequired)\n    return idxHero >= idxReq\n  }, [hero?.rankData?.currentRank, mission?.rankRequired])\n\n  useEffect(() => {\n    if (!mission || !hero) return\n    const idxHero = RANK_ORDER.indexOf((hero.rankData?.currentRank || 'F') as any)\n    const idxReq = RANK_ORDER.indexOf(mission.rankRequired)\n    if (idxHero < idxReq) setError('Rank insuficiente para esta misso de caa.')\n    else setError(null)\n  }, [mission?.id, hero?.rankData?.currentRank])\n\n  const start = () => {\n    if (!hero || !mission) return\n    if (!canEnter) { setError('Rank insuficiente para esta misso de caa.'); return }\n    if (cdActive) { setError('Cooldown ativo para Misses de Caa. Aguarde o tempo de recarga.'); return }\n    const needed = worldStateManager.computeEffectiveStaminaCost(hero, staminaCostPerPhase)\n    const currentFatigue = Math.max(0, Number(hero.progression?.fatigue || 0))\n    if (currentFatigue + needed > 100) { setError('Fadiga alta  descanse antes de iniciar.'); return }\n    setRunning(true)\n    setFinished(false)\n    setPhaseIndex(0)\n    setLog([])\n    setError(null)\n    setStreak(0)\n    setNpcIntegrity(mission.category === 'escolta' ? 100 : null)\n    setAnyLoot(false)\n  }\n\n  const staminaCostPerPhase = mission?.rankRequired === 'F' ? 2 : Math.max(2, mission?.staminaPerPhase || 3)\n  const estimatedSuccess = useMemo(() => {\n    if (!hero || !mission) return null\n    const attr = hero.attributes\n    const base = mission.difficulty === 'epica' ? 0.45 : mission.difficulty === 'dificil' ? 0.6 : mission.difficulty === 'medio' ? 0.7 : 0.8\n    const classBonus = mission.category === 'controle' ? (attr.destreza || 0) * 0.01\n      : mission.category === 'coleta' ? (attr.inteligencia || 0) * 0.01\n      : mission.category === 'escolta' ? (attr.constituicao || 0) * 0.008\n      : (attr.forca || 0) * 0.008\n    const chance = Math.max(0.2, Math.min(0.95, base + classBonus))\n    return Math.round(chance * 100)\n  }, [hero?.id, mission?.id])\n\n  const estimatedTotals = useMemo(() => {\n    if (!mission) return null\n    const p = (estimatedSuccess ?? 80) / 100\n    const xpPer = Math.round(p * mission.baseRewards.xp + (1 - p) * Math.round(mission.baseRewards.xp * 0.5))\n    const goldPer = Math.round(p * mission.baseRewards.gold + (1 - p) * Math.round(mission.baseRewards.gold * 0.3))\n    return { xp: xpPer * mission.phases, gold: goldPer * mission.phases }\n  }, [mission?.id, estimatedSuccess])\n\n  const estimatedTotalStamina = useMemo(() => {\n    if (!mission) return 0\n    const extra = Math.max(0, mission.phases - 2)\n    const baseTotal = staminaCostPerPhase * mission.phases + extra\n    return worldStateManager.computeEffectiveStaminaCost(hero as any, baseTotal)\n  }, [mission?.phases, staminaCostPerPhase])\n\n  const resolvePhase = () => {\n    if (!hero || !mission || finished) return\n    const extraPhaseCost = mission.rankRequired === 'F' ? 0 : (phaseIndex >= 2 ? 1 : 0)\n    const totalCost = staminaCostPerPhase + extraPhaseCost\n    const needed = worldStateManager.computeEffectiveStaminaCost(hero, totalCost)\n    const currentFatigue = Math.max(0, Number(hero.progression?.fatigue || 0))\n    if (currentFatigue + needed > 100) { setError('Fadiga alta  pare e descanse.'); setRunning(false); return }\n    worldStateManager.consumeStamina(hero, totalCost)\n    updateHero(hero.id, { progression: hero.progression })\n    const base = mission.difficulty === 'epica' ? 0.45 : mission.difficulty === 'dificil' ? 0.6 : mission.difficulty === 'medio' ? 0.7 : 0.8\n    const riskStep = 0.06\n    // Bnus por classe/atributo\n    const attr = hero.attributes\n    const classBonus = mission.category === 'controle' ? (attr.destreza || 0) * 0.01\n      : mission.category === 'coleta' ? (attr.inteligencia || 0) * 0.01\n      : mission.category === 'escolta' ? (attr.constituicao || 0) * 0.008\n      : (attr.forca || 0) * 0.008\n    const floor = ((hero.rankData?.currentRank || 'F') === 'F') ? 0.3 : 0.2\n    const successChance = Math.max(floor, Math.min(0.95, (base - phaseIndex * riskStep) + classBonus))\n    const roll = Math.random()\n    const success = roll < successChance\n    const mult = computeRewardMultiplier(streak)\n    const xpBase = mission.baseRewards.xp\n    const goldBase = mission.baseRewards.gold\n    const boss = mission.category === 'especial' && phaseIndex + 1 === mission.phases\n    const bossMult = boss ? 1.5 : 1\n    const xp = Math.round((success ? xpBase : Math.round(xpBase * 0.5)) * mult * bossMult)\n    let gold = Math.round((success ? goldBase : Math.round(goldBase * 0.3)) * mult * bossMult)\n    const mountRed = worldStateManager.getMountStaminaReduction(hero as any)\n    if (mountRed > 0) {\n      const rewardBoost = 1 + Math.min(0.3, mountRed * 0.5)\n      gold = Math.round(gold * rewardBoost)\n    }\n    gainXP(hero.id, xp)\n    gainGold(hero.id, gold)\n    const lootTier = boss ? 'epico' : phaseIndex >= 2 ? 'raro' : phaseIndex >= 1 ? 'incomum' as any : 'comum'\n    const itemsEquip = Math.random() < (success ? 0.5 : 0.25) ? generateChestLoot((lootTier as any)) : []\n    itemsEquip.forEach(it => addItemToInventory(hero.id, it.id, 1))\n\n    // Loot especializado por categoria\n    const categoryPools: Record<string, string[]> = {\n      controle: ['pele-lobo-sombrio','colmilho-vampirico','osso-antigo'],\n      coleta: ['erva-sangue','essencia-lunar','cristal-runico'],\n      escolta: ['pergaminho-protecao','pergaminho-velocidade'],\n      especial: boss ? ['lamina-alpha','armadura-pedra-rachada'] : []\n    }\n    const ids = categoryPools[mission.category] || []\n    const extraIds: string[] = []\n    if (ids.length) {\n      // Chance e quantidade conforme sucesso/risco\n      const dropChance = boss ? 1 : success ? 0.7 : 0.4\n      const hour = new Date().getHours()\n      const isNight = hour < 6 || hour >= 18\n      const isDay = hour >= 8 && hour < 17\n      const eligible = ids.filter(id => {\n        if (id === 'essencia-lunar') return isNight\n        if (id === 'erva-sangue') return isDay\n        if (id === 'cristal-runico') return mission.biome === 'Caverna Antiga' || mission.biome === 'Runas Antigas'\n        return true\n      })\n      if (eligible.length && Math.random() < dropChance) {\n        const pickId = eligible[Math.floor(Math.random() * eligible.length)]\n        addItemToInventory(hero.id, pickId, 1)\n        extraIds.push(pickId)\n      }\n    }\n    // Regras simples de perodo\n    if (mission.timeHint === 'noite') {\n      const hour = new Date().getHours()\n      if (hour < 6 || hour >= 18) {\n        if (Math.random() < (success ? 0.6 : 0.3)) {\n          addItemToInventory(hero.id, 'essencia-lunar', 1)\n          extraIds.push('essencia-lunar')\n        }\n      }\n    }\n    const mapName = (id: string) => SHOP_ITEMS.find(i => i.id === id)?.name || id\n    // Emboscadas por bioma\n    const ENEMIES_BY_BIOME: Record<string, string[]> = {\n      'Colinas de Boravon': ['Lobo Sombrio','Bandido'],\n      'Rio Marfim': ['Slime cido','Serpente do Rio'],\n      'Floresta Nebulosa': ['Morcego Vampiro','Bruxa da Nvoa'],\n      'Runas Antigas': ['Golem Rachado','Esqueleto'],\n      'Floresta Umbral': ['Bruxa da Nvoa','Lobo Sombrio'],\n      'Caverna Antiga': ['Troll de Pedra','Slime cido']\n    }\n    const baseAmbush = mission.category === 'escolta' ? 0.25 : 0.15\n    const rankIsF = (hero.rankData?.currentRank || 'F') === 'F'\n    const ambush = Math.random() < ((baseAmbush - (rankIsF ? 0.05 : 0)) + (mission.difficulty === 'dificil' ? 0.05 : mission.difficulty === 'epica' ? 0.1 : 0))\n    let ambushText = ''\n    if (ambush) {\n      const enemies = ENEMIES_BY_BIOME[mission.biome] || ['Inimigos']\n      const foe = enemies[Math.floor(Math.random() * enemies.length)]\n      const ambushDamageBase = Math.round((hero.derivedAttributes.hp || 20) * 0.1)\n      const ambushDamage = Math.round(ambushDamageBase * (((hero.rankData?.currentRank || 'F') === 'F') ? 0.5 : 1))\n      const curHp2 = hero.derivedAttributes.currentHp ?? (hero.derivedAttributes.hp || 0)\n      const newHp2 = Math.max(0, curHp2 - ambushDamage)\n      updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: newHp2 } })\n      ambushText = `  Emboscada: ${foe} causa dano durante a fase.`\n      if (npcIntegrity !== null) {\n        const loss = (((hero.rankData?.currentRank || 'F') === 'F') && mission.category === 'escolta') ? 7 : 10\n        setNpcIntegrity(Math.max(0, npcIntegrity - loss))\n      }\n      const maxHp2 = hero.derivedAttributes.hp || 1\n      if ((newHp2 / maxHp2) < 0.2) { setAutoRun(false); setError('HP baixo, auto desativado.') }\n    }\n    // Penalidades por falha (dano/fadiga e integridade do NPC)\n    if (!success) {\n      const maxHp = hero.derivedAttributes.hp || 1\n      const curHp = hero.derivedAttributes.currentHp ?? maxHp\n      const damageBase = Math.round(maxHp * (boss ? 0.2 : 0.1))\n      const damage = Math.round(damageBase * (((hero.rankData?.currentRank || 'F') === 'F') ? 0.5 : 1))\n      const newHp = Math.max(0, curHp - damage)\n      const newFatigue = Math.min(100, (hero.progression.fatigue || 0) + (boss ? 10 : 6))\n      updateHero(hero.id, { derivedAttributes: { ...hero.derivedAttributes, currentHp: newHp }, progression: { ...hero.progression, fatigue: newFatigue } })\n      if (npcIntegrity !== null) {\n        const baseLoss = boss ? 30 : 15\n        const loss = (((hero.rankData?.currentRank || 'F') === 'F') && mission.category === 'escolta') ? (boss ? 20 : 10) : baseLoss\n        const next = Math.max(0, npcIntegrity - loss)\n        setNpcIntegrity(next)\n      }\n      const maxHp2 = hero.derivedAttributes.hp || 1\n      if ((newHp / maxHp2) < 0.2) { setAutoRun(false); setError('HP baixo, auto desativado.') }\n    }\n    let narrativeExtra = ''\n    const hour2 = new Date().getHours()\n    const night2 = hour2 < 6 || hour2 >= 18\n    const rank = (hero.rankData?.currentRank || 'F') as 'F'|'E'|'D'|'C'|'B'|'A'|'S'\n    const rankBonusMap: Record<'F'|'E'|'D'|'C'|'B'|'A'|'S', number> = { F: 0, E: 0.01, D: 0.02, C: 0.03, B: 0.04, A: 0.05, S: 0.06 }\n    const rb = rankBonusMap[rank] || 0\n    const eggBase = mission.biome === 'Floresta Nebulosa' || mission.biome === 'Floresta Umbral' ? (night2 ? 0.15 + rb : 0.07 + rb) : mission.biome === 'Caverna Antiga' ? (boss ? 0.2 + rb : 0.06 + rb) : 0.05 + rb\n    if (Math.random() < eggBase) {\n      generateEggForSelected()\n      narrativeExtra = '  Ovo misterioso encontrado.'\n    }\n    if (boss && (mission.biome === 'Caverna Antiga' || mission.biome === 'Runas Antigas')) {\n      if (Math.random() < 0.25) {\n        addItemToInventory(hero.id, 'essencia-bestial', 1)\n        extraIds.push('essencia-bestial')\n      }\n    }\n    if (success && npcIntegrity !== null && ((hero.rankData?.currentRank || 'F') === 'F') && mission.category === 'escolta') setNpcIntegrity(Math.min(100, (npcIntegrity || 0) + 5))\n    const result: PhaseResult = { phase: phaseIndex + 1, success, xp, gold, narrative: (success ? `Progresso na fase ${phaseIndex + 1}.` : `Revs na fase ${phaseIndex + 1}.`) + ambushText + narrativeExtra, itemsAwarded: [...itemsEquip.map(i => ({ id: i.id, name: i.name })), ...extraIds.map(id => ({ id, name: mapName(id) }))] }\n    const newLog = [...log, result]\n    setLog(newLog)\n    if ((itemsEquip.length > 0) || (extraIds.length > 0)) setAnyLoot(true)\n    setStreak(s => s + (success ? 1 : 0))\n    setPhaseIndex(i => i + 1)\n    if ((npcIntegrity !== null && npcIntegrity <= 0) || (phaseIndex + 1 >= phasesTotal)) {\n      setFinished(true)\n      setRunning(false)\n      const store = useHeroStore.getState()\n      const current = store.heroes.find(h => h.id === hero.id)\n      if (current) {\n        const newStats = { ...current.stats, questsCompleted: (current.stats.questsCompleted || 0) + 1, lastActiveAt: new Date().toISOString() }\n        store.updateHero(hero.id, { stats: newStats })\n        const ensuredRank = current.rankData ?? rankSystem.initializeRankData(current)\n        const newRankData = rankSystem.updateRankData({ ...current, stats: newStats }, ensuredRank)\n        store.updateHero(hero.id, { rankData: newRankData })\n        updateDailyGoalProgress(hero.id, 'quest-completed', 1)\n        const cdMin = getHuntingCooldownMinutes()\n        const ends = new Date(Date.now() + cdMin * 60 * 1000).toISOString()\n        store.updateHero(hero.id, { hunting: { ...(current.hunting || {}), cooldownEndsAt: ends, lastCompletedAt: new Date().toISOString() } })\n      }\n      if (mission.rankRequired === 'F' && !anyLoot) {\n        const consolation = mission.category === 'coleta' ? 'erva-sangue' : 'osso-antigo'\n        addItemToInventory(hero.id, consolation, 1)\n        setLog(l => [...l, { phase: phasesTotal, success: true, xp: 0, gold: 0, narrative: 'Recompensa de novato concedida.', itemsAwarded: [{ id: consolation }] }])\n      }\n    }\n  }\n\n  const retreat = () => {\n    if (!hero || !mission) return\n    const store = useHeroStore.getState()\n    const current = store.heroes.find(h => h.id === hero.id)\n    if (!current) return\n    const newStats = { ...current.stats, questsCompleted: (current.stats.questsCompleted || 0) + 1, lastActiveAt: new Date().toISOString() }\n    store.updateHero(hero.id, { stats: newStats })\n    const ensuredRank = current.rankData ?? rankSystem.initializeRankData(current)\n    const newRankData = rankSystem.updateRankData({ ...current, stats: newStats }, ensuredRank)\n    store.updateHero(hero.id, { rankData: newRankData })\n    updateDailyGoalProgress(hero.id, 'quest-completed', 1)\n    const cdMin = getHuntingCooldownMinutes()\n    const ends = new Date(Date.now() + cdMin * 60 * 1000).toISOString()\n    store.updateHero(hero.id, { hunting: { ...(current.hunting || {}), cooldownEndsAt: ends, lastCompletedAt: new Date().toISOString() } })\n    setFinished(true)\n    setRunning(false)\n  }\n\n  const restart = () => {\n    if (!hero) return\n    setMission(generateHuntingMission(hero, biome))\n    setFinished(false)\n    setRunning(false)\n    setPhaseIndex(0)\n    setLog([])\n    setError(null)\n    setStreak(0)\n    setNpcIntegrity(null)\n  }\n\n  const reroll = () => {\n    if (!hero || !mission) return\n    let next = generateHuntingMission(hero, biome)\n    let guard = 0\n    while (guard < 10 && next.category === mission.category && next.biome === mission.biome) {\n      next = generateHuntingMission(hero, biome)\n      guard++\n    }\n    setMission(next)\n    setError(null)\n  }\n\n  useEffect(() => {\n    if (running && autoRun && !finished) {\n      const t = setTimeout(() => { resolvePhase() }, 500)\n      return () => clearTimeout(t)\n    }\n  }, [running, autoRun, finished, phaseIndex])\n\n  return (\n    <div className=\"max-w-3xl mx-auto p-6\">\n      <h2 className=\"text-2xl font-bold text-white\">Misses de Caa</h2>\n      {hero && (\n        <div className=\"text-gray-300\">Rank: {hero.rankData?.currentRank || ''}</div>\n      )}\n      <div className=\"mt-3\">\n        <select value={biome} onChange={(e) => setBiome(e.target.value as Biome)} className=\"px-3 py-2 rounded bg-gray-800 text-white\">\n          {(['Colinas de Boravon','Rio Marfim','Floresta Nebulosa','Runas Antigas','Floresta Umbral','Caverna Antiga'] as Biome[]).map(b => (\n            <option key={b} value={b}>{b}</option>\n          ))}\n        </select>\n        {hero?.rankData?.currentRank === 'F' && (\n          <select value={categorySel || ''} onChange={(e) => setCategorySel((e.target.value || null) as any)} className=\"ml-2 px-3 py-2 rounded bg-gray-800 text-white\">\n            <option value=''>Aleatria</option>\n            {(['controle','coleta','escolta'] as const).map(c => (\n              <option key={c} value={c}>{c}</option>\n            ))}\n          </select>\n        )}\n      </div>\n      {mission && (\n        <div className=\"mt-4 p-4 border rounded bg-gray-800 border-gray-700\">\n          <div className=\"text-white font-semibold\">{mission.title}  {mission.biome}</div>\n          <div className=\"text-gray-300 text-sm\">Objetivo: {mission.objective}</div>\n          {showDetails && (\n            <div className=\"mt-2\">\n              <div className=\"text-gray-300 text-sm\">Fases: {mission.phases}  Dificuldade: {mission.difficulty}  Recompensa base: +{mission.baseRewards.xp} XP, +{mission.baseRewards.gold} ouro</div>\n              {mission.rankRequired === 'F' && (mission.category === 'escolta' || mission.category === 'controle') && (\n                <div className=\"text-emerald-300 text-xs\">Bnus Novato ativo para {mission.category}.</div>\n              )}\n              <div className=\"text-gray-400 text-xs\">Custo estimado de fadiga: {staminaCostPerPhase}  {mission.phases} + {Math.max(0, mission.phases - 2)} = {staminaCostPerPhase * mission.phases + Math.max(0, mission.phases - 2)}</div>\n              {(() => {\n                const red = worldStateManager.getMountStaminaReduction(hero as any);\n                if (!red) return null;\n                const pct = Math.round(red * 100);\n                const baseTotal = staminaCostPerPhase * mission.phases + Math.max(0, mission.phases - 2)\n                const effTotal = worldStateManager.computeEffectiveStaminaCost(hero as any, baseTotal)\n                return <div className=\"text-emerald-300 text-xs\">Montaria ativa reduz custo em {pct}%  Efetivo: {effTotal}</div>\n              })()}\n              {estimatedSuccess !== null && (\n                <div className=\"text-gray-400 text-xs\">Chance inicial estimada de sucesso (fase 1): {estimatedSuccess}%</div>\n              )}\n              {rankProgress && rankProgress.progress && (\n                <div className=\"text-gray-400 text-xs mt-1\">Progresso para {rankProgress.progress.nextRank || rankProgress.progress.currentRank}: XP {rankProgress.progress.currentXP}/{rankProgress.progress.requiredXP}  Misses {rankProgress.progress.currentMissions}/{rankProgress.progress.requiredMissions}</div>\n              )}\n              {estimatedTotals && (\n                <div className=\"text-gray-300 text-sm mt-1\">Estimativa bruta de recompensa: ~ +{estimatedTotals.xp} XP, +{estimatedTotals.gold} ouro</div>\n              )}\n              {(() => {\n                const red = worldStateManager.getMountStaminaReduction(hero as any)\n                if (!red) return null\n                const boostPct = Math.round(Math.min(0.3, red * 0.5) * 100)\n                return <div className=\"text-emerald-300 text-xs\">Bnus de ouro por montaria: +{boostPct}%</div>\n              })()}\n              <div className=\"text-gray-400 text-xs\">Dica: atributo que ajuda nesta misso: {mission.category === 'controle' ? 'Destreza' : mission.category === 'coleta' ? 'Inteligncia' : mission.category === 'escolta' ? 'Constituio' : 'Fora'}</div>\n              <div className=\"text-gray-300 text-sm\">Requer Rank: {mission.rankRequired}</div>\n              {mission.classHint && <div className=\"text-gray-400 text-xs\">{mission.classHint}</div>}\n              {mission.timeHint && <div className=\"text-gray-400 text-xs\">Melhor perodo: {mission.timeHint}</div>}\n              <div className=\"text-gray-400 text-xs\">Possvel loot: {(mission.category === 'controle' ? ['pele-lobo-sombrio','colmilho-vampirico','osso-antigo'] : mission.category === 'coleta' ? ['erva-sangue','essencia-lunar','cristal-runico'] : mission.category === 'escolta' ? ['pergaminho-protecao','pergaminho-velocidade'] : []).map((id, idx) => (\n                <span key={`pv_${id}_${idx}`} className=\"inline-block ml-1 px-2 py-0.5 rounded bg-gray-700 text-white text-xs\">{SHOP_ITEMS.find(i => i.id === id)?.name || id}</span>\n              ))}</div>\n            </div>\n          )}\n          {!running && !finished && (\n            <div className=\"mt-3\">\n              <button onClick={start} disabled={!hero || !canEnter || cdActive} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50\">Iniciar Caada</button>\n              <button onClick={reroll} disabled={!hero || running || cdActive} className=\"ml-2 px-3 py-2 rounded bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50\">Nova Misso</button>\n              <button onClick={() => setShowDetails(v => !v)} className=\"ml-2 px-3 py-2 rounded bg-gray-700 text-white hover:bg-gray-600\">{showDetails ? 'Ocultar Detalhes' : 'Detalhes da Misso'}</button>\n              {!canEnter && <div className=\"mt-2 text-sm text-red-300\">Rank insuficiente para esta misso.</div>}\n              {hero && (()=>{ const cf=Math.max(0, Number(hero.progression?.fatigue||0)); const need=worldStateManager.computeEffectiveStaminaCost(hero as any, staminaCostPerPhase); return cf+need>100 })() && <div className=\"mt-2 text-sm text-amber-300\">Fadiga alta para iniciar. Descanse antes.</div>}\n              {hero && (()=>{ const cf=Math.max(0, Number(hero.progression?.fatigue||0)); const need=estimatedTotalStamina; return cf+need>100 })() && <div className=\"mt-2 text-sm text-amber-300\">Ateno: oramento de fadiga pode no cobrir todas as fases.</div>}\n              {canEnter && mission.rankRequired === 'F' && <div className=\"mt-2 text-sm text-emerald-300\">Misso inicial liberada para Novatos (Rank F).</div>}\n              {cdActive && <div className=\"mt-2 text-sm text-amber-300\">Cooldown ativo: aguarde {Math.ceil(cdMs/60000)} min.</div>}\n              {error && <div className=\"mt-2 text-sm text-red-300\">{error}</div>}\n            </div>\n          )}\n          {running && (\n            <div className=\"mt-3\">\n              <div className=\"text-gray-200\">Fase {phaseIndex + 1} de {phasesTotal}</div>\n              {npcIntegrity !== null && <div className=\"text-gray-400 text-xs\">Integridade do NPC: {npcIntegrity}%</div>}\n              {(() => {\n                const extraPhaseCost = mission?.rankRequired === 'F' ? 0 : (phaseIndex >= 2 ? 1 : 0)\n                const baseNext = staminaCostPerPhase + extraPhaseCost\n                const effNext = worldStateManager.computeEffectiveStaminaCost(hero as any, baseNext)\n                const redPct = Math.round(worldStateManager.getMountStaminaReduction(hero as any) * 100)\n                return <div className=\"text-emerald-300 text-xs\">Custo desta fase: base {baseNext}  efetivo {effNext}{redPct?`  reduo ${redPct}%`:''}</div>\n              })()}\n              <div className=\"mt-2 flex gap-2\">\n                <button onClick={resolvePhase} className=\"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700\">Prosseguir</button>\n                <button onClick={retreat} className=\"px-3 py-2 rounded bg-amber-600 text-black hover:bg-amber-500\">Recuar e guardar loot</button>\n                <button onClick={() => setAutoRun(v => !v)} className={`px-3 py-2 rounded ${autoRun ? 'bg-teal-600' : 'bg-teal-700'} text-white hover:bg-teal-500`}>{autoRun ? 'Auto: ON' : 'Auto: OFF'}</button>\n              </div>\n              <div className=\"mt-2 text-sm text-gray-400\">Multiplicador atual: x{computeRewardMultiplier(streak).toFixed(2)}</div>\n            </div>\n          )}\n          {log.length > 0 && (\n            <div className=\"mt-4\">\n              <div className=\"text-white font-semibold\">Registro</div>\n              <ul className=\"mt-2 text-sm text-gray-300 list-disc pl-5\">\n                {log.map(r => (\n                  <li key={r.phase}>Fase {r.phase}: {r.narrative}  +{r.xp} XP, +{r.gold} ouro{r.itemsAwarded && r.itemsAwarded.length ? `  Loot` : ''}</li>\n                ))}\n              </ul>\n              {/* Loot acumulado */}\n              {log.some(r => r.itemsAwarded && r.itemsAwarded.length > 0) && (\n                <div className=\"mt-3\">\n                  <div className=\"text-white font-semibold\">Loot acumulado</div>\n                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                    {log.flatMap(r => r.itemsAwarded || []).map((it, idx) => (\n                      <span key={`${it.id}_${idx}`} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\">{it.name || it.id}</span>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n          {finished && (\n            <div className=\"mt-3\">\n              <div className=\"text-sm text-gray-200\">Caada finalizada.</div>\n              <div className=\"mt-2 text-sm text-gray-300\">Total: +{log.reduce((a,b)=>a+b.xp,0)} XP, +{log.reduce((a,b)=>a+b.gold,0)} ouro</div>\n              {log.some(r => r.itemsAwarded && r.itemsAwarded.length) && (\n                <div className=\"mt-2\">\n                  <div className=\"text-white font-semibold text-sm\">Itens recebidos</div>\n                  <div className=\"mt-1 flex flex-wrap gap-2\">\n                    {log.flatMap(r => r.itemsAwarded || []).map((it, idx) => (\n                      <span key={`fin_${it.id}_${idx}`} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\">{it.name || it.id}</span>\n                    ))}\n                  </div>\n                </div>\n              )}\n              <div className=\"mt-2\">\n                <button onClick={() => setFinished(false)} className=\"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700\">Completar Misso</button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","import React, { useMemo, useState, useCallback } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { SHOP_ITEMS } from '../utils/shop';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes, medievalTheme } from '../styles/medievalTheme';\nimport { Jewel } from '../types/jewel';\n\ntype ItemType = 'todos' | 'consumable' | 'weapon' | 'armor' | 'accessory' | 'material';\ntype ItemRarity = 'todas' | 'comum' | 'incomum' | 'raro' | 'epico' | 'lendario';\n\nconst Inventory: React.FC = () => {\n  const { getSelectedHero, equipItem, sellItem, useItem, unequipItem, upgradeItem, socketJewel, removeJewel, fuseJewels } = useHeroStore();\n  const hero = getSelectedHero();\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-slate-600' : 'border-slate-600';\n\n  const [selectedType, setSelectedType] = useState<ItemType>('todos');\n  const [selectedRarity, setSelectedRarity] = useState<ItemRarity>('todas');\n  const [search, setSearch] = useState('');\n  const [qtyByItem, setQtyByItem] = useState<Record<string, number>>({});\n  const [feedback, setFeedback] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n\n  const weaponCapacity = 2;\n  const armorCapacity = 4;\n  const accessoryCapacity = 9;\n\n  const equippedWeapons = hero?.inventory.equippedWeapons || [];\n  const equippedArmorSlots = hero?.inventory.equippedArmorSlots || [];\n  const equippedAccessories = hero?.inventory.equippedAccessories || [];\n\n  const rarityClass = useCallback((rarity?: string) => {\n    switch (rarity) {\n      case 'lendario': return 'border-amber-400 bg-amber-900/10';\n      case 'epico': return 'border-violet-400 bg-violet-900/10';\n      case 'raro': return 'border-blue-400 bg-blue-900/10';\n      case 'incomum': return 'border-emerald-400 bg-emerald-900/10';\n      default: return 'border-slate-600 bg-slate-800';\n    }\n  }, []);\n\n  const getMaxSlotsForItem = (itemId?: string) => {\n    if (!itemId) return 0;\n    const item = SHOP_ITEMS.find(i => i.id === itemId);\n    if (!item) return 0;\n    if (item.type === 'weapon') return 2;\n    if (item.type === 'armor') return 3;\n    if (item.type === 'accessory') return 1;\n    return 0;\n  };\n\n  const getJewelLabel = (jewelKey: string) => {\n    const [_, tipo, nivelStr] = jewelKey.split(':');\n    const j = new Jewel(crypto.randomUUID(), tipo as any, Number(nivelStr));\n    const b = j.getBonus();\n    const parts: string[] = [];\n    if (b.forca) parts.push(`+${b.forca} Fora`);\n    if (b.inteligencia) parts.push(`+${b.inteligencia} Inteligncia`);\n    if (b.destreza) parts.push(`+${b.destreza} Destreza`);\n    if (b.constituicao) parts.push(`+${b.constituicao} Constituio`);\n    if (b.armorClass) parts.push(`+${b.armorClass} Defesa`);\n    return `${tipo.toUpperCase()} Nv.${j.nivel}  ${parts.join(' / ')}`;\n  };\n\n  const buildTooltip = (itemId: string) => {\n    const item = SHOP_ITEMS.find(i => i.id === itemId);\n    if (!item) return '';\n    const parts: string[] = [item.name];\n    if (item.bonus) {\n      const b = item.bonus as any;\n      const map: Record<string,string> = { forca: 'Fora', destreza: 'Destreza', constituicao: 'Constituio', inteligencia: 'Inteligncia' };\n      for (const k of Object.keys(b)) {\n        const labelKey = k === 'sabedoria' ? 'inteligencia' : (k === 'carisma' ? 'destreza' : k);\n        parts.push(`+${b[k]} ${map[labelKey] || labelKey}`);\n      }\n    }\n    if (item.effects) {\n      const e = item.effects as any;\n      if (e.hp) parts.push(`+${e.hp} HP`);\n      if (e.mp) parts.push(`+${e.mp} MP`);\n      if (e.special) parts.push(`${e.special}`);\n    }\n    return parts.join('  ');\n  };\n\n  const onDragStart = (ev: React.DragEvent, itemId: string) => {\n    ev.dataTransfer.setData('text/plain', itemId);\n  };\n  const onJewelDragStart = (ev: React.DragEvent, jewelKey: string) => {\n    ev.dataTransfer.setData('application/jewel', jewelKey);\n  };\n  const makeDropHandler = (slot: 'mainHand'|'offHand'|'helm'|'chest'|'belt'|'gloves'|'boots'|'cape'|'ringLeft'|'ringRight'|'necklace'|'earringLeft'|'earringRight') => (ev: React.DragEvent) => {\n    ev.preventDefault();\n    const itemId = ev.dataTransfer.getData('text/plain');\n    const item = SHOP_ITEMS.find(i => i.id === itemId);\n    if (!hero || !item) return;\n    if (slot === 'mainHand' && item.type !== 'weapon') return;\n    if (slot === 'offHand' && item.type !== 'weapon') return;\n    if (slot === 'helm' && !(item.type === 'armor' && item.slot === 'helm')) return;\n    if (slot === 'chest' && !(item.type === 'armor' && (!item.slot || item.slot === 'chest'))) return;\n    if (slot === 'belt' && !(item.type === 'armor' && item.slot === 'belt')) return;\n    if (slot === 'gloves' && !(item.type === 'armor' && item.slot === 'gloves')) return;\n    if (slot === 'boots' && !(item.type === 'armor' && item.slot === 'boots')) return;\n    if (slot === 'cape' && !(item.type === 'armor' && item.slot === 'cape')) return;\n    if (slot === 'necklace' && !(item.type === 'accessory' && item.slot === 'necklace')) return;\n    if ((slot === 'ringLeft' || slot === 'ringRight') && !(item.type === 'accessory' && (item.slot === 'ring' || !item.slot))) return;\n    if ((slot === 'earringLeft' || slot === 'earringRight') && !(item.type === 'accessory' && item.slot === 'earring')) return;\n    const ok = equipItem(hero.id, itemId);\n    if (ok) setFeedback({ message: `Equipado: ${item.name}`, type: 'success' }); else setFeedback({ message: `No foi possvel equipar ${item.name}.`, type: 'error' });\n    setTimeout(() => setFeedback(null), 1500);\n  };\n  const onDragOver = (ev: React.DragEvent) => ev.preventDefault();\n\n  const inventoryEntries = useMemo(() => {\n    if (!hero) return [] as Array<[string, number]>;\n    return Object.entries(hero.inventory.items).filter(([, qty]) => qty > 0);\n  }, [hero]);\n\n  const filtered = useMemo(() => {\n    return inventoryEntries.filter(([itemId]) => {\n      const item = SHOP_ITEMS.find(i => i.id === itemId);\n      if (!item) return false;\n      if (selectedType !== 'todos' && item.type !== selectedType) return false;\n      if (selectedRarity !== 'todas' && item.rarity !== selectedRarity) return false;\n      if (search && !item.name.toLowerCase().includes(search.toLowerCase())) return false;\n      return true;\n    });\n  }, [inventoryEntries, selectedType, selectedRarity, search]);\n\n  const handleQtyChange = (itemId: string, value: number, max: number) => {\n    const v = Math.max(1, Math.min(max, Number.isFinite(value) ? value : 1));\n    setQtyByItem(s => ({ ...s, [itemId]: v }));\n  };\n\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"text-center py-12\">\n          <div className=\"text-6xl mb-3\"></div>\n          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Inventrio</h1>\n          <p className=\"text-gray-600\">Selecione ou crie um heri para acessar o inventrio.</p>\n          <div className=\"mt-4\">\n            <a href=\"/create\" className=\"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700\">Criar Heri</a>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto p-6\">\n      {/* Header */}\n      <div className={`${medievalTheme.layout.containers.panel} ${seasonalBorder} p-6 mb-6 text-slate-200`}>\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\"> Inventrio</h1>\n            <p className=\"text-slate-400 mt-2\">Gerencie seus itens: equipar, consumir e vender.</p>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-sm text-slate-400\">Heri</div>\n            <div className=\"font-semibold text-slate-100\">{hero.name}</div>\n          </div>\n        </div>\n        {/* Feedback banner */}\n        {feedback && (\n          <div\n            role=\"status\"\n            aria-live=\"polite\"\n            className={`mt-4 px-4 py-2 rounded text-sm ${\n              feedback.type === 'success'\n                ? 'bg-emerald-900/20 text-emerald-300 border border-emerald-700'\n                : 'bg-red-900/20 text-red-300 border border-red-700'\n            }`}\n          >\n            {feedback.message}\n          </div>\n        )}\n      </div>\n\n      {/* Equipamentos (slots especficos) */}\n      <div className={`${medievalTheme.layout.containers.panel} ${seasonalBorder} p-6 mt-6 text-slate-200`}>\n        <h2 className=\"text-xl font-bold mb-4\"> Equipamentos</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div>\n            <div className=\"font-semibold mb-2\">Armas</div>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {(['mainHand','offHand'] as const).map((slot) => {\n                const id = slot === 'mainHand' ? hero.inventory.equippedMainHand : hero.inventory.equippedOffHand;\n                const item = id ? SHOP_ITEMS.find(i => i.id === id) : undefined;\n                return (\n                  <div key={slot} onDrop={makeDropHandler(slot)} onDragOver={onDragOver}\n                       className={`h-20 rounded border flex items-center justify-center text-sm ${id ? rarityClass(item?.rarity) : 'border-dashed border-slate-600 bg-slate-800'}`}\n                       title={id ? buildTooltip(id) : (slot === 'mainHand' ? 'Arraste arma (mo principal)' : 'Arraste arma (mo secundria)')}>\n                    {id ? (\n                      <button onClick={() => { const ok = unequipItem(hero.id, id!); if (ok) setFeedback({ message: 'Desequipado.', type: 'success' }); }} className=\"px-2 py-1 bg-slate-700 text-white rounded\">\n                        {item?.icon} {item?.name}\n                      </button>\n                    ) : (\n                      <span className=\"text-slate-400\">{slot === 'mainHand' ? 'Mo Principal' : 'Mo Secundria'}</span>\n                    )}\n                    {id && (\n                      <div className=\"mt-1 w-full px-2\">\n                        <div className=\"flex items-center gap-1\">\n                          {Array.from({ length: getMaxSlotsForItem(id) }).map((_, idx) => {\n                            const eq = hero.inventory.equippedJewelsByItemId?.[id] || [];\n                            const jewelKey = eq[idx];\n                            return (\n                              <div key={idx}\n                                   onDrop={(ev) => { ev.preventDefault(); const key = ev.dataTransfer.getData('application/jewel'); if (key) { const ok = socketJewel(hero.id, id!, key); setFeedback(ok ? { message: 'Joia engastada.', type: 'success' } : { message: 'No foi possvel engastar.', type: 'error' }); setTimeout(() => setFeedback(null), 1500); } }}\n                                   onDragOver={onDragOver}\n                                   className={`h-6 w-6 rounded-full border ${jewelKey ? 'border-violet-600 bg-violet-900/20' : 'border-slate-600 bg-slate-900'} flex items-center justify-center text-[10px]`}\n                                   title={jewelKey ? getJewelLabel(jewelKey) : 'Solte joia aqui'}>\n                                {jewelKey ? (\n                                  <button onClick={() => { const ok = removeJewel(hero.id, id!, idx); setFeedback(ok ? { message: 'Joia removida.', type: 'success' } : { message: 'Falha ao remover.', type: 'error' }); setTimeout(() => setFeedback(null), 1200); }} className=\"text-slate-200\">\n                                    \n                                  </button>\n                                ) : (\n                                  <span className=\"text-slate-500\"></span>\n                                )}\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n          <div>\n            <div className=\"font-semibold mb-2\">Armadura</div>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {([\n                ['helm', hero.inventory.equippedHelm, 'Helmo'],\n                ['chest', hero.inventory.equippedChest, 'Armadura'],\n                ['belt', hero.inventory.equippedBelt, 'Cintura'],\n                ['gloves', hero.inventory.equippedGloves, 'Luvas'],\n                ['boots', hero.inventory.equippedBoots, 'Botas'],\n                ['cape', hero.inventory.equippedCape, 'Asa/Capa']\n              ] as const).map(([slot, id, label]) => {\n                const item = id ? SHOP_ITEMS.find(i => i.id === id) : undefined;\n                return (\n                  <div key={slot} onDrop={makeDropHandler(slot as any)} onDragOver={onDragOver}\n                       className={`h-20 rounded border flex items-center justify-center text-sm ${id ? rarityClass(item?.rarity) : 'border-dashed border-slate-600 bg-slate-800'}`}\n                       title={id ? buildTooltip(id!) : `Arraste ${label} aqui`}>\n                    {id ? (\n                      <button onClick={() => { const ok = unequipItem(hero.id, id!); if (ok) setFeedback({ message: 'Desequipado.', type: 'success' }); }} className=\"px-2 py-1 bg-slate-700 text-white rounded\">\n                        {item?.icon} {item?.name}\n                      </button>\n                    ) : (\n                      <span className=\"text-slate-400\">{label}</span>\n                    )}\n                    {id && (\n                      <div className=\"mt-1 w-full px-2\">\n                        <div className=\"flex items-center gap-1\">\n                          {Array.from({ length: getMaxSlotsForItem(id) }).map((_, idx) => {\n                            const eq = hero.inventory.equippedJewelsByItemId?.[id] || [];\n                            const jewelKey = eq[idx];\n                            return (\n                              <div key={idx}\n                                   onDrop={(ev) => { ev.preventDefault(); const key = ev.dataTransfer.getData('application/jewel'); if (key) { const ok = socketJewel(hero.id, id!, key); setFeedback(ok ? { message: 'Joia engastada.', type: 'success' } : { message: 'No foi possvel engastar.', type: 'error' }); setTimeout(() => setFeedback(null), 1500); } }}\n                                   onDragOver={onDragOver}\n                                   className={`h-6 w-6 rounded-full border ${jewelKey ? 'border-violet-600 bg-violet-900/20' : 'border-slate-600 bg-slate-900'} flex items-center justify-center text-[10px]`}\n                                   title={jewelKey ? getJewelLabel(jewelKey) : 'Solte joia aqui'}>\n                                {jewelKey ? (\n                                  <button onClick={() => { const ok = removeJewel(hero.id, id!, idx); setFeedback(ok ? { message: 'Joia removida.', type: 'success' } : { message: 'Falha ao remover.', type: 'error' }); setTimeout(() => setFeedback(null), 1200); }} className=\"text-slate-200\">\n                                    \n                                  </button>\n                                ) : (\n                                  <span className=\"text-slate-500\"></span>\n                                )}\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n          <div>\n            <div className=\"font-semibold mb-2\">Acessrios</div>\n            <div className=\"grid grid-cols-3 gap-2\">\n              {([\n                ['ringLeft', hero.inventory.equippedRingLeft, 'Anel (esq.)'],\n                ['ringRight', hero.inventory.equippedRingRight, 'Anel (dir.)'],\n                ['necklace', hero.inventory.equippedNecklace, 'Colar'],\n                ['earringLeft', hero.inventory.equippedEarringLeft, 'Brinco (esq.)'],\n                ['earringRight', hero.inventory.equippedEarringRight, 'Brinco (dir.)']\n              ] as const).map(([slot, id, label]) => {\n                const item = id ? SHOP_ITEMS.find(i => i.id === id) : undefined;\n                return (\n                  <div key={slot} onDrop={makeDropHandler(slot as any)} onDragOver={onDragOver}\n                       className={`h-20 rounded border flex items-center justify-center text-xs ${id ? rarityClass(item?.rarity) : 'border-dashed border-slate-600 bg-slate-800'}`}\n                       title={id ? buildTooltip(id!) : `Arraste ${label} aqui`}>\n                    {id ? (\n                      <button onClick={() => { const ok = unequipItem(hero.id, id!); if (ok) setFeedback({ message: 'Desequipado.', type: 'success' }); }} className=\"px-2 py-1 bg-slate-700 text-white rounded\">\n                        {item?.icon} {item?.name}\n                      </button>\n                    ) : (\n                      <span className=\"text-slate-400\">{label}</span>\n                    )}\n                    {id && (\n                      <div className=\"mt-1 w-full px-2\">\n                        <div className=\"flex items-center gap-1\">\n                          {Array.from({ length: getMaxSlotsForItem(id) }).map((_, idx) => {\n                            const eq = hero.inventory.equippedJewelsByItemId?.[id] || [];\n                            const jewelKey = eq[idx];\n                            return (\n                              <div key={idx}\n                                   onDrop={(ev) => { ev.preventDefault(); const key = ev.dataTransfer.getData('application/jewel'); if (key) { const ok = socketJewel(hero.id, id!, key); setFeedback(ok ? { message: 'Joia engastada.', type: 'success' } : { message: 'No foi possvel engastar.', type: 'error' }); setTimeout(() => setFeedback(null), 1500); } }}\n                                   onDragOver={onDragOver}\n                                   className={`h-6 w-6 rounded-full border ${jewelKey ? 'border-violet-600 bg-violet-900/20' : 'border-slate-600 bg-slate-900'} flex items-center justify-center text-[10px]`}\n                                   title={jewelKey ? getJewelLabel(jewelKey) : 'Solte joia aqui'}>\n                                {jewelKey ? (\n                                  <button onClick={() => { const ok = removeJewel(hero.id, id!, idx); setFeedback(ok ? { message: 'Joia removida.', type: 'success' } : { message: 'Falha ao remover.', type: 'error' }); setTimeout(() => setFeedback(null), 1200); }} className=\"text-slate-200\">\n                                    \n                                  </button>\n                                ) : (\n                                  <span className=\"text-slate-500\"></span>\n                                )}\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n            <div className=\"mt-3 grid grid-cols-2 gap-2\">\n              <div className=\"h-16 rounded border border-slate-600 bg-slate-800 flex items-center justify-center text-xs\" title=\"Mascote ativo\">\n                <span className=\"text-slate-300\">Mascote: {(hero as any).pets?.find((p: any) => p.id === (hero as any).activePetId)?.name || '-'}</span>\n              </div>\n              <div className=\"h-16 rounded border border-slate-600 bg-slate-800 flex items-center justify-center text-xs\" title=\"Montaria ativa\">\n                <span className=\"text-slate-300\">Montaria: {(hero as any).mounts?.find((m: any) => m.id === (hero as any).activeMountId)?.name || '-'}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className=\"text-xs text-slate-400 mt-3\">Arraste itens da lista e solte nos slots compatveis.</div>\n      </div>\n\n      {/* Filtros */}\n      <div className={`${medievalTheme.layout.containers.panel} ${seasonalBorder} p-4 text-slate-200`}>\n        <div className=\"flex flex-wrap items-center gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <label className=\"text-sm text-slate-300\">Tipo</label>\n            <select\n              value={selectedType}\n              onChange={(e) => setSelectedType(e.target.value as ItemType)}\n              className=\"px-2 py-1 border rounded text-sm bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            >\n              <option value=\"todos\">Todos</option>\n              <option value=\"consumable\">Consumvel</option>\n              <option value=\"weapon\">Arma</option>\n              <option value=\"armor\">Armadura</option>\n              <option value=\"accessory\">Acessrio</option>\n              <option value=\"material\">Material</option>\n            </select>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <label className=\"text-sm text-slate-300\">Raridade</label>\n            <select\n              value={selectedRarity}\n              onChange={(e) => setSelectedRarity(e.target.value as ItemRarity)}\n              className=\"px-2 py-1 border rounded text-sm bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            >\n              <option value=\"todas\">Todas</option>\n              <option value=\"comum\">Comum</option>\n              <option value=\"incomum\">Incomum</option>\n              <option value=\"raro\">Raro</option>\n              <option value=\"epico\">pico</option>\n              <option value=\"lendario\">Lendrio</option>\n            </select>\n          </div>\n          <input\n            type=\"text\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            placeholder=\"Buscar por nome\"\n            className=\"flex-1 min-w-0 sm:min-w-[200px] px-3 py-1 border rounded text-sm bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n          />\n          <button\n            onClick={() => { setSelectedType('todos'); setSelectedRarity('todas'); setSearch(''); }}\n            className=\"px-3 py-1 rounded bg-slate-700 text-slate-100 hover:bg-slate-600 text-sm\"\n          >\n            Limpar filtros\n          </button>\n        </div>\n      </div>\n\n      {/* Lista de Itens */}\n      <div className={`${medievalTheme.layout.containers.panel} ${seasonalBorder} p-6 mt-6 text-slate-200`}>\n        {filtered.length > 0 ? (\n          <div className=\"space-y-3\">\n            {filtered.map(([itemId, qty]) => {\n              const item = SHOP_ITEMS.find(i => i.id === itemId);\n              if (!item) return null;\n              const unitSell = Math.floor(item.price * 0.6);\n              const sellQty = qtyByItem[itemId] ?? 1;\n              const isEquipped =\n                (item.type === 'weapon' && [hero.inventory.equippedMainHand, hero.inventory.equippedOffHand].includes(itemId)) ||\n                (item.type === 'armor' && [hero.inventory.equippedHelm, hero.inventory.equippedChest, hero.inventory.equippedBelt, hero.inventory.equippedGloves, hero.inventory.equippedBoots, hero.inventory.equippedCape].includes(itemId)) ||\n                (item.type === 'accessory' && [hero.inventory.equippedRingLeft, hero.inventory.equippedRingRight, hero.inventory.equippedNecklace, hero.inventory.equippedEarringLeft, hero.inventory.equippedEarringRight].includes(itemId));\n\n              return (\n                <div key={itemId} className=\"flex items-center justify-between bg-slate-800 border border-slate-700 p-3 rounded\" draggable onDragStart={(e) => onDragStart(e, itemId)} title={buildTooltip(itemId)}>\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"text-2xl\">{item.icon}</div>\n                    <div>\n                      <div className=\"font-semibold text-slate-100\">{item.name}</div>\n                      <div className=\"text-sm text-slate-400\">Qtd: {qty}  Preo venda: {unitSell} ouro/un</div>\n                      {isEquipped && (\n                        <div className=\"text-xs text-emerald-300\">\n                          Equipado{` `}\n                          {(() => {\n                            const lvl = hero.inventory.upgrades?.[itemId] ?? 0;\n                            return lvl > 0 ? ` Aprimorado +${lvl}` : '';\n                          })()}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-3\">\n                    {/* Equipar / Usar */}\n                    {item.type === 'consumable' ? (\n                        <button\n                          onClick={() => {\n                            const ok = useItem(hero.id, itemId);\n                            if (ok) {\n                              setFeedback({ message: `Consumido: ${item.name}. Efeito aplicado.`, type: 'success' });\n                            } else {\n                              setFeedback({ message: `No foi possvel consumir ${item.name}.`, type: 'error' });\n                            }\n                            setTimeout(() => setFeedback(null), 1800);\n                          }}\n                          disabled={qty <= 0}\n                          className={`px-3 py-2 rounded text-white ${qty <= 0 ? 'bg-slate-500 cursor-not-allowed' : 'bg-violet-600 hover:bg-violet-700'}`}\n                        >\n                          Usar\n                        </button>\n                      ) : (\n                      isEquipped ? (\n                        <>\n                          <button\n                            onClick={() => {\n                              const ok = unequipItem(hero.id, itemId);\n                              if (ok) {\n                                setFeedback({ message: `Desequipado: ${item.name}. Atributos atualizados.`, type: 'success' });\n                              } else {\n                                setFeedback({ message: `No foi possvel desequipar ${item.name}.`, type: 'error' });\n                              }\n                              setTimeout(() => setFeedback(null), 1800);\n                            }}\n                            className=\"px-3 py-2 rounded text-white bg-slate-700 hover:bg-slate-800\"\n                          >\n                            Desequipar\n                          </button>\n                          {(item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory') && (\n                            <button\n                              onClick={() => {\n                                const ok = upgradeItem(hero.id, itemId);\n                                const newLvl = (hero.inventory.upgrades?.[itemId] ?? 0) + (ok ? 1 : 0);\n                                if (ok) {\n                                  setFeedback({ message: `Aprimorado: ${item.name} para +${newLvl}.`, type: 'success' });\n                                } else {\n                                  setFeedback({ message: `No foi possvel aprimorar ${item.name}. Ouro insuficiente?`, type: 'error' });\n                                }\n                                setTimeout(() => setFeedback(null), 2000);\n                              }}\n                              className=\"px-3 py-2 rounded text-white bg-amber-600 hover:bg-amber-700\"\n                            >\n                              Aprimorar\n                            </button>\n                          )}\n                        </>\n                      ) : (\n                        <button\n                          onClick={() => {\n                            const ok = equipItem(hero.id, itemId);\n                            if (ok) {\n                              setFeedback({ message: `Equipado: ${item.name}. Atributos atualizados.`, type: 'success' });\n                            } else {\n                              setFeedback({ message: `No foi possvel equipar ${item.name}.`, type: 'error' });\n                            }\n                            setTimeout(() => setFeedback(null), 1800);\n                          }}\n                          className=\"px-3 py-2 rounded text-white bg-indigo-600 hover:bg-indigo-700\"\n                        >\n                          Equipar\n                        </button>\n                      )\n                    )}\n\n                    {/* Quantidade e Venda */}\n                    <input\n                      type=\"number\"\n                      min={1}\n                      max={qty}\n                      value={sellQty}\n                      onChange={(e) => handleQtyChange(itemId, Number(e.target.value), qty)}\n                      className=\"w-16 sm:w-20 px-2 py-1 border rounded bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                      aria-label={`Quantidade para vender ${item.name}`}\n                    />\n                    <div className=\"text-sm text-slate-300\">Total: {unitSell * Math.max(1, Math.min(qty, sellQty))} ouro</div>\n                    <button\n                      onClick={() => {\n                        const amount = Math.max(1, Math.min(qty, sellQty));\n                        const ok = sellItem(hero.id, itemId, amount);\n                        const totalGold = unitSell * Math.max(1, Math.min(qty, sellQty));\n                        if (ok) {\n                          setFeedback({ message: `Vendido: ${amount}x ${item.name} por ${totalGold} ouro.`, type: 'success' });\n                        } else {\n                          setFeedback({ message: `No foi possvel vender ${item.name}.`, type: 'error' });\n                        }\n                        setTimeout(() => setFeedback(null), 1800);\n                      }}\n                      disabled={isEquipped}\n                      className={`px-4 py-2 rounded text-white ${isEquipped ? 'bg-slate-500 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700'}`}\n                      title={isEquipped ? 'Item equipado  desequipe para vender' : 'Vender quantidade selecionada'}\n                    >\n                      Vender\n                    </button>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        ) : (\n          <div className=\"text-center py-10 text-slate-400\">\n            <div className=\"text-3xl sm:text-5xl mb-2\"></div>\n            <p>Nenhum item corresponde aos filtros.</p>\n          </div>\n        )}\n      </div>\n\n      {/* Joias */}\n      <div className={`${medievalTheme.layout.containers.panel} ${seasonalBorder} p-6 mt-6 text-slate-200`}>\n        <h2 className=\"text-xl font-bold mb-3\"> Joias</h2>\n        {Object.entries(hero.inventory.jewels || {}).length > 0 ? (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n            {Object.entries(hero.inventory.jewels || {}).map(([key, qty]) => (\n              <div key={key} className=\"flex items-center justify-between bg-slate-800 border border-slate-700 p-2 rounded\" draggable onDragStart={(e) => onJewelDragStart(e, key)} title={getJewelLabel(key)}>\n                <div className=\"text-sm\">\n                  <div className=\"font-semibold text-slate-100\">{getJewelLabel(key)}</div>\n                  <div className=\"text-slate-400\">Qtd: {qty}</div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <button onClick={() => { const ok = fuseJewels(hero.id, key); setFeedback(ok ? { message: 'Fuso realizada.', type: 'success' } : { message: 'Falha na fuso.', type: 'error' }); setTimeout(() => setFeedback(null), 1600); }} className=\"px-3 py-1 rounded bg-violet-600 text-white hover:bg-violet-700\" disabled={(qty || 0) < 2}>Fundir</button>\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-slate-400\">Nenhuma joia. Obtenha joias e arraste sobre os sockets dos itens equipados.</div>\n        )}\n        <div className=\"text-xs text-slate-400 mt-2\">Arraste uma joia para um equipamento equipado para engastar. Funda 2 joias iguais para subir de nvel.</div>\n      </div>\n    </div>\n  );\n};\n\nexport default Inventory;\n","import React from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport type { Pet } from '../types/hero';\nimport { useNavigate } from 'react-router-dom';\n\nconst Row: React.FC<{ label: string; value: string | number | undefined }> = ({ label, value }) => (\n  <div className=\"flex justify-between text-sm\"><span className=\"text-gray-300\">{label}</span><span className=\"text-gray-100 font-medium\">{value}</span></div>\n);\n\nconst HatchResultModal: React.FC<{ petId: string; onClose: () => void }> = ({ petId, onClose }) => {\n  const { getSelectedHero, setActivePet } = useHeroStore();\n  const hero = getSelectedHero();\n  const pet = hero?.pets?.find(p => p.id === petId) as Pet | undefined;\n  const navigate = useNavigate();\n  const hatchInfo = (hero?.hatchHistory || []).find(h => h.petId === petId);\n  if (!pet) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center\">\n      <div className=\"w-full max-w-md rounded-xl border border-amber-500 bg-slate-900 p-5 text-white\">\n        <div className=\"text-center mb-3\">\n          <div className=\"text-5xl mb-2\"></div>\n          <div className=\"text-xl font-bold\">Mascote Eclodido!</div>\n        </div>\n        <div className=\"space-y-2\">\n          <Row label=\"Nome\" value={pet.name} />\n          <Row label=\"Tipo\" value={pet.type} />\n          <Row label=\"Classe\" value={pet.petClass} />\n          <Row label=\"Raridade\" value={pet.rarity} />\n          {typeof hatchInfo?.hatchCost === 'number' && <Row label=\"Custo gasto\" value={`${hatchInfo!.hatchCost} ouro`} />}\n          {pet.mutation?.variant && <Row label=\"Mutao\" value={pet.mutation.variant} />}\n          {pet.exclusiveSkill && <Row label=\"Habilidade\" value={pet.exclusiveSkill} />}\n          <div className=\"mt-2 text-xs text-gray-300\">Qualidade: {pet.qualityRoll}%  Nvel: {pet.level}  Estgio: {pet.stage.replace('_', ' ')}</div>\n        </div>\n        <div className=\"mt-4 flex gap-2\">\n          <button onClick={() => { setActivePet(pet.id); onClose(); }} className=\"px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-700\">Tornar Ativo</button>\n          <button onClick={() => { onClose(); navigate('/meus'); }} className=\"px-3 py-2 rounded bg-purple-600 hover:bg-purple-700\">Ver Mascotes</button>\n          <button onClick={() => { onClose(); navigate('/pets'); }} className=\"px-3 py-2 rounded bg-amber-600 hover:bg-amber-700\">Ir  Cmara</button>\n          <button onClick={onClose} className=\"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600\">Fechar</button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default HatchResultModal;","import React, { useEffect, useMemo, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { useHeroStore } from '../store/heroStore';\nimport { Egg, Pet } from '../types/hero';\nimport { INCUBATION_MS, EGG_IDENTIFY_COST } from '../utils/pets';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport HatchResultModal from './HatchResultModal';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes, getSeasonalButtonGradient } from '../styles/medievalTheme';\n\nconst formatRemaining = (iso?: string) => {\n  if (!iso) return '';\n  const end = new Date(iso).getTime();\n  const diff = Math.max(0, end - Date.now());\n  const h = Math.floor(diff / 3_600_000);\n  const m = Math.floor((diff % 3_600_000) / 60_000);\n  const s = Math.floor((diff % 60_000) / 1000);\n  if (h > 0) return `${h}h ${m}m ${s}s`;\n  if (m > 0) return `${m}m ${s}s`;\n  return `${s}s`;\n};\n\nconst TabButton: React.FC<{ active: boolean; onClick: () => void; label: string; icon: string }> = ({ active, onClick, label, icon }) => (\n  <button onClick={onClick} className={`px-3 py-2 rounded border ${active ? 'bg-amber-600 text-white border-amber-500' : 'bg-gray-800 border-gray-700 text-gray-200'} hover:bg-amber-700 transition-colors`}>{icon} {label}</button>\n);\n\nconst EggCard: React.FC<{ egg: Egg; onIdentify: () => void; onIncubate: () => void; onAccelerateEssencia: () => void; onAccelerateBrasas: () => void; onAccelerateGold: (amount: number) => void; onHatch: () => void; inventory: Record<string, number>; gold: number }>\n  = ({ egg, onIdentify, onIncubate, onAccelerateEssencia, onAccelerateBrasas, onAccelerateGold, onHatch, inventory, gold }) => {\n  const remaining = formatRemaining(egg.incubationEndsAt);\n  const costRange = EGG_IDENTIFY_COST[egg.baseRarity];\n  const hatchCostByRarity: Record<string, number> = { comum: 5, incomum: 10, raro: 20, epico: 50, lendario: 100, mistico: 200 };\n  const hatchCost = hatchCostByRarity[String(egg.identified?.rarity || egg.baseRarity)] || 0;\n  return (\n    <div className=\"p-4 rounded-lg bg-slate-800 border border-slate-700 flex flex-col gap-2\">\n      <div className=\"flex justify-between items-center\">\n        <div className=\"font-semibold\">{egg.name}</div>\n        <div className=\"text-xs text-amber-300\">Raridade: {egg.baseRarity}</div>\n      </div>\n      <div className=\"text-xs text-gray-300\">{egg.description}</div>\n      <div className=\"text-sm\">\n        Status: <span className=\"font-medium\">{egg.status}</span>\n        {egg.status === 'identificado' && egg.identified && (\n          <span className=\"ml-2 text-gray-300\"> {egg.identified.type}  {egg.identified.petClass}  Chance de habilidade {egg.identified.skillChancePercent}%</span>\n        )}\n        {egg.status === 'incubando' && egg.incubatingSlot !== undefined && (\n          <span className=\"ml-2 text-gray-300\"> Slot {egg.incubatingSlot + 1}  Fim em {remaining}</span>\n        )}\n      </div>\n      <div className=\"flex flex-wrap gap-2 mt-2\">\n        {egg.status === 'misterioso' && (\n          <button onClick={onIdentify} className=\"px-3 py-1 rounded bg-indigo-600 hover:bg-indigo-700 text-white text-sm\"> Identificar ({costRange.min}{costRange.max} ouro)</button>\n        )}\n        {egg.status === 'identificado' && (\n          (() => {\n            const usedSlots = (useHeroStore.getState().getSelectedHero()?.eggs || []).filter(e => e.status === 'incubando' && typeof e.incubatingSlot === 'number').length;\n            const full = usedSlots >= 3;\n            return (\n              <button onClick={onIncubate} disabled={full} className={`px-3 py-1 rounded text-white text-sm ${full ? 'bg-gray-700 cursor-not-allowed' : 'bg-purple-600 hover:bg-purple-700'}`}> Incubar</button>\n            );\n          })()\n        )}\n        {egg.status === 'incubando' && (\n          <>\n            <button disabled={!inventory['essencia-calor']} onClick={onAccelerateEssencia} className={`px-3 py-1 rounded ${inventory['essencia-calor'] ? 'bg-red-600 hover:bg-red-700' : 'bg-gray-700'} text-white text-sm`}> Essncia (-15m)</button>\n            <button disabled={!inventory['brasas-magicas']} onClick={onAccelerateBrasas} className={`px-3 py-1 rounded ${inventory['brasas-magicas'] ? 'bg-orange-600 hover:bg-orange-700' : 'bg-gray-700'} text-white text-sm`}> Brasas (-1h)</button>\n            <button onClick={() => onAccelerateGold(50)} className=\"px-3 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm\"> Acelerar com Ouro</button>\n          </>\n        )}\n        {(egg.status === 'pronto_para_chocar' || egg.status === 'incubando') && (\n          <button onClick={onHatch} disabled={(() => {\n            const hero = useHeroStore.getState().getSelectedHero();\n            if (!hero) return false;\n            if (!hero.hatchCooldownEndsAt) return false;\n            const cd = Date.now() < new Date(hero.hatchCooldownEndsAt).getTime();\n            const goldInsufficient = (hero.progression.gold || 0) < hatchCost;\n            return cd || goldInsufficient;\n          })()} className={`px-3 py-1 rounded text-white text-sm ${(() => {\n            const hero = useHeroStore.getState().getSelectedHero();\n            const cd = hero?.hatchCooldownEndsAt && Date.now() < new Date(hero.hatchCooldownEndsAt).getTime();\n            const goldInsufficient = hero ? (hero.progression.gold || 0) < hatchCost : false;\n            return (cd || goldInsufficient) ? 'bg-gray-700 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700';\n          })()}`}> Chocar</button>\n        )}\n        {(egg.status === 'pronto_para_chocar' || egg.status === 'incubando') && (\n          (() => {\n            const hero = useHeroStore.getState().getSelectedHero();\n            const cdMs = hero?.hatchCooldownEndsAt ? Math.max(0, new Date(hero.hatchCooldownEndsAt).getTime() - Date.now()) : 0;\n            const cdText = cdMs > 0 ? `${Math.ceil(cdMs / 1000)}s` : '';\n            const gold = hero?.progression.gold || 0;\n            const pct = cdMs > 0 ? Math.max(0, Math.min(100, Math.round(cdMs / 300))) : 0;\n            return (\n              <div className=\"text-xs text-gray-300\">\n                <div className=\"flex items-center gap-2\"><span className=\"text-amber-300\">Custo: {hatchCost} ouro</span>{cdText && <span>CD: {cdText}</span>}{gold < hatchCost && <span className=\"text-red-300\">Ouro insuficiente</span>}</div>\n                {cdMs > 0 && (\n                  <div className=\"w-40 bg-gray-700 rounded-full h-1.5 mt-1\">\n                    <div className=\"h-1.5 rounded-full bg-amber-500\" style={{ width: `${pct}%` }} />\n                  </div>\n                )}\n              </div>\n            );\n          })()\n        )}\n        {(egg.status === 'pronto_para_chocar' || egg.status === 'incubando') && (\n          (() => {\n            const hatchCostByRarity: Record<string, number> = { comum: 5, incomum: 10, raro: 20, epico: 50, lendario: 100, mistico: 200 };\n            const rarity = String(egg.identified?.rarity || egg.baseRarity);\n            const cost = hatchCostByRarity[rarity] || 0;\n            const hero = useHeroStore.getState().getSelectedHero();\n            const cdMs = hero?.hatchCooldownEndsAt ? Math.max(0, new Date(hero.hatchCooldownEndsAt).getTime() - Date.now()) : 0;\n            const cdText = cdMs > 0 ? `${Math.ceil(cdMs / 1000)}s` : '';\n            return <div className=\"text-xs text-gray-300 flex items-center gap-2\"><span className=\"text-amber-300\">Custo: {cost} ouro</span>{cdText && <span>CD: {cdText}</span>}</div>;\n          })()\n        )}\n      </div>\n    </div>\n  );\n};\n\n  const PetCard: React.FC<{ pet: Pet; onTrain: () => void; onSoulStone: () => void; onFeedBasic: () => void; onFeedDeluxe: () => void; onSetActive: () => void; onRename: (name: string) => void; onRefine: () => void; onSuggestMission?: () => void; onSell?: () => void; inventory: Record<string, number>; isActive: boolean }>\n  = ({ pet, onTrain, onSoulStone, onFeedBasic, onFeedDeluxe, onSetActive, onRename, onRefine, onSuggestMission, onSell, inventory, isActive }) => (\n    <div className=\"p-4 rounded-lg bg-slate-800 border border-slate-700 flex flex-col gap-2 overflow-hidden clip-container\">\n      <div className=\"flex justify-between items-center\">\n        <div className=\"font-semibold\">{pet.name} {isActive && <span className=\"ml-2 text-xs bg-emerald-700 text-white px-2 py-1 rounded\">Ativo</span>} {pet.mutation?.visualBadge && <span className=\"ml-1\">{pet.mutation.visualBadge}</span>}</div>\n        <div className=\"text-xs text-amber-300\">{pet.type}  {pet.petClass}  {pet.rarity ?? 'comum'}</div>\n      </div>\n      <div className=\"text-sm\">Nvel {pet.level}  Estgio: {pet.stage.replace('_', ' ')}</div>\n      {pet.exclusiveSkill && <div className=\"text-xs text-emerald-300\">Skill Exclusiva: {pet.exclusiveSkill}</div>}\n      <div className=\"mt-1\">\n        <div className=\"flex justify-between items-center\">\n          <span className=\"text-amber-300 text-[10px]\">Energia</span>\n          <span className=\"text-gray-300 text-[10px]\">{Math.max(0, Math.min(100, pet.energy || 0))}%</span>\n        </div>\n        <div className=\"w-full bg-gray-700 rounded-full h-1.5\">\n          <div className=\"h-1.5 rounded-full bg-amber-500\" style={{ width: `${Math.max(0, Math.min(100, pet.energy || 0))}%` }} />\n        </div>\n        {pet.exclusiveSkill && (\n          <div className=\"mt-1 text-xs\">\n            {(() => {\n              const costMap: Record<string, number> = { 'Instinto Feral': 8, 'Pulso Arcano': 10, 'Aura Sagrada': 9, 'Sussurro Sombrio': 12 };\n              const cost = costMap[pet.exclusiveSkill] || 8;\n              const ready = (pet.energy || 0) >= cost;\n              return <span className={`px-2 py-0.5 rounded ${ready ? 'bg-green-700 text-white' : 'bg-gray-700 text-gray-300'}`}>{ready ? 'Skill pronta' : 'Skill indisponvel'}</span>;\n            })()}\n          </div>\n        )}\n      </div>\n      <div className=\"flex flex-wrap gap-2 mt-2 clearfix min-w-0\">\n        <button onClick={onTrain} className=\"px-3 py-1 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm\"> Treinar (+100 XP)</button>\n        <button disabled={!inventory['pedra-alma']} onClick={onSoulStone} className={`px-3 py-1 rounded ${inventory['pedra-alma'] ? 'bg-violet-600 hover:bg-violet-700' : 'bg-gray-700'} text-white text-sm`}> Pedra de Alma (+300 XP)</button>\n        <button disabled={!inventory['racao-basica']} onClick={onFeedBasic} className={`px-3 py-1 rounded ${inventory['racao-basica'] ? 'bg-orange-600 hover:bg-orange-700' : 'bg-gray-700'} text-white text-sm`}> Rao (+50 XP)</button>\n        <button disabled={!inventory['racao-deluxe']} onClick={onFeedDeluxe} className={`px-3 py-1 rounded ${inventory['racao-deluxe'] ? 'bg-amber-600 hover:bg-amber-700' : 'bg-gray-700'} text-white text-sm`}> Rao Deluxe (+150 XP)</button>\n        <button onClick={onSetActive} className=\"px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-700 text-white text-sm\"> Tornar Ativo</button>\n        <button disabled={!inventory['essencia-vinculo'] && !inventory['pedra-magica']} onClick={onRefine} className={`px-3 py-1 rounded ${(inventory['essencia-vinculo'] || inventory['pedra-magica']) ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-gray-700'} text-white text-sm`}> Refinar Vnculo (+1%)</button>\n        {onSuggestMission && !(inventory['essencia-vinculo'] || inventory['pedra-magica']) && (\n          <button aria-label=\"Sugerir Misso\" onClick={onSuggestMission} className=\"px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-700 active:brightness-90 text-white text-sm\"> Sugerir Misso</button>\n        )}\n        {onSell && (\n          <button aria-label=\"Vender Mascote\" onClick={onSell} className=\"px-3 py-1 rounded bg-green-700 hover:bg-green-800 active:brightness-90 text-white text-sm\"> Vender Mascote</button>\n        )}\n        <button disabled={!inventory['tonico-companheiro']} onClick={() => {\n          if (inventory['tonico-companheiro']) {\n            if (consumeInventoryItem(useHeroStore.getState().getSelectedHero()!.id, 'tonico-companheiro', 1)) {\n              const hero = useHeroStore.getState().getSelectedHero()!;\n              useHeroStore.getState().updateHero(hero.id, { pets: (hero.pets || []).map(p => p.id === pet.id ? { ...p, energy: Math.min(100, (p.energy || 0) + 50) } : p) });\n            }\n          }\n        }} className={`px-3 py-1 rounded ${inventory['tonico-companheiro'] ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-gray-700'} text-white text-sm`}> Tnico de Energia (+50)</button>\n      </div>\n      {(() => {\n        const totalReq = 1;\n        const readyCount = ((inventory['essencia-vinculo']||0)>0 || (inventory['pedra-magica']||0)>0) ? 1 : 0;\n        const pct = Math.round((readyCount / totalReq) * 100);\n        return (\n          <div className=\"mt-1 w-full bg-gray-700 rounded h-2\">\n            <div className=\"h-2 bg-indigo-500\" style={{ width: `${pct}%` }} />\n          </div>\n        );\n      })()}\n      <div className=\"flex items-center gap-2 mt-2 flex-wrap min-w-0\">\n        <input type=\"text\" placeholder=\"Renomear\" className=\"px-2 py-1 rounded bg-slate-700 text-white text-sm\" onKeyDown={(e) => { if (e.key === 'Enter') onRename((e.target as HTMLInputElement).value); }} />\n        <span className=\"text-xs text-gray-300\">Pressione Enter para salvar</span>\n      </div>\n    </div>\n);\n\nexport const PetsPanel: React.FC = () => {\n  const { getSelectedHero, generateEggForSelected, identifyEggForSelected, startIncubationForSelected, accelerateIncubationForSelected, hatchEggForSelected, consumeInventoryItem, addPetXPForSelected, setActivePet, updateHero, refinePetForSelected, suggestCompanionQuestForSelected } = useHeroStore();\n  const hero = getSelectedHero();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const [tab, setTab] = useState<'ovos'|'camara'|'meus'|'historico'>('ovos');\n  const [hatchingEggId, setHatchingEggId] = useState<string | null>(null);\n  const [hatchResultPetId, setHatchResultPetId] = useState<string | null>(null);\n  const [historyFilter, setHistoryFilter] = useState<'todos'|'raro'|'epico'|'lendario'|'mistico'>('todos');\n  const [confirmEggId, setConfirmEggId] = useState<string | null>(null);\n  const [confirmAccelerateGold, setConfirmAccelerateGold] = useState<number>(0);\n  const [confirmSellPetId, setConfirmSellPetId] = useState<string | null>(null);\n  const [isSelling, setIsSelling] = useState<boolean>(false);\n\n  useEffect(() => {\n    const iv = setInterval(() => { useHeroStore.getState().updateIncubationTick?.(); }, 1000);\n    return () => clearInterval(iv);\n  }, []);\n\n  useEffect(() => {\n    try {\n      const params = new URLSearchParams(location.search);\n      const hatchNext = params.get('hatchNext');\n      const eggsArr = hero.eggs || [];\n      if (hatchNext && eggsArr.length > 0) {\n        const ready = eggsArr.find(e => e.status === 'pronto_para_chocar');\n        if (ready) setConfirmEggId(ready.id);\n        navigate('/pets', { replace: true });\n      }\n    } catch {}\n  }, [location.search]);\n\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar Mascotes.</p>\n      </div>\n    );\n  }\n\n  const eggs = hero.eggs || [];\n  const pets = (hero.pets || []).filter(Boolean).map(p => ({ ...p, rarity: (p as any).rarity ?? 'comum' }));\n  const inventory = hero.inventory.items || {};\n  const rarityOrder = ['mistico','lendario','epico','raro','incomum','comum'];\n  const statusOrder = ['pronto_para_chocar','incubando','identificado','misterioso'];\n  const eggsSorted = [...eggs].sort((a,b) => {\n    const sa = statusOrder.indexOf(a.status);\n    const sb = statusOrder.indexOf(b.status);\n    if (sa !== sb) return sa - sb;\n    const ra = rarityOrder.indexOf(String(a.identified?.rarity || a.baseRarity));\n    const rb = rarityOrder.indexOf(String(b.identified?.rarity || b.baseRarity));\n    return ra - rb;\n  });\n  const rarityCounts = (() => {\n    const acc: Record<string, number> = { comum:0, incomum:0, raro:0, epico:0, lendario:0, mistico:0 };\n    eggs.forEach(e => { const r = String(e.identified?.rarity || e.baseRarity); acc[r] = (acc[r]||0)+1; });\n    return acc;\n  })();\n  const hatchSummary = (() => {\n    const hist = hero.hatchHistory || [];\n    const total = hist.length;\n    let mut = 0;\n    let totalCost = 0;\n    const counts: Record<string, number> = { comum:0, incomum:0, raro:0, epico:0, lendario:0, mistico:0 };\n    const now = Date.now();\n    const last7 = { total: 0, mutations: 0, cost: 0 };\n    const last30 = { total: 0, mutations: 0, cost: 0 };\n    hist.forEach(h => {\n      const p = pets.find(pp => pp.id === h.petId);\n      const ts = new Date(h.timestamp).getTime();\n      if (p) {\n        counts[String(p.rarity ?? 'comum')] = (counts[String(p.rarity ?? 'comum')] || 0) + 1;\n        if (p.mutation?.variant) mut++;\n      }\n      if (typeof h.hatchCost === 'number') totalCost += h.hatchCost;\n      if (now - ts <= 7*24*60*60*1000) {\n        last7.total += 1;\n        if (p?.mutation?.variant) last7.mutations += 1;\n        if (typeof h.hatchCost === 'number') last7.cost += h.hatchCost;\n      }\n      if (now - ts <= 30*24*60*60*1000) {\n        last30.total += 1;\n        if (p?.mutation?.variant) last30.mutations += 1;\n        if (typeof h.hatchCost === 'number') last30.cost += h.hatchCost;\n      }\n    });\n    const rate = total > 0 ? Math.round((mut / total) * 100) : 0;\n    const rate7 = last7.total > 0 ? Math.round((last7.mutations / last7.total) * 100) : 0;\n    const rate30 = last30.total > 0 ? Math.round((last30.mutations / last30.total) * 100) : 0;\n    return { total, counts, rate, totalCost, last7, last30, rate7, rate30 };\n  })();\n  const filteredHistory = (() => {\n    const hist = hero.hatchHistory || [];\n    if (historyFilter === 'todos') return hist;\n    const order = ['comum','incomum','raro','epico','lendario','mistico'];\n    const minIdx = order.indexOf(historyFilter);\n    return hist.filter(h => {\n      const pet = pets.find(p => p.id === h.petId);\n      if (!pet) return false;\n      return order.indexOf(pet.rarity ?? 'comum') >= minIdx;\n    });\n  })();\n\n  const incubatingSlots: (Egg | undefined)[] = [undefined, undefined, undefined];\n  eggs.filter(e => e.status === 'incubando').forEach(e => { if (typeof e.incubatingSlot === 'number') incubatingSlots[e.incubatingSlot!] = e; });\n\n  const handleGenerateEgg = () => generateEggForSelected();\n  const handleIdentify = (eggId: string) => identifyEggForSelected(eggId);\n  const handleIncubate = (eggId: string, slot?: number) => startIncubationForSelected(eggId, slot);\n  const handleAccelerateEssencia = (eggId: string) => {\n    if (consumeInventoryItem(hero.id, 'essencia-calor', 1)) accelerateIncubationForSelected(eggId, 'essencia');\n  };\n  const handleAccelerateBrasas = (eggId: string) => {\n    if (consumeInventoryItem(hero.id, 'brasas-magicas', 1)) accelerateIncubationForSelected(eggId, 'brasas');\n  };\n  const handleAccelerateGold = (eggId: string, amount: number) => accelerateIncubationForSelected(eggId, 'ouro', amount);\n  const handleHatch = async (eggId: string) => {\n    setConfirmEggId(eggId);\n  };\n\n  const confirmHatchProceed = () => {\n    const eggId = confirmEggId!;\n    const hero = useHeroStore.getState().getSelectedHero();\n    if (hero && confirmAccelerateGold > 0) {\n      useHeroStore.getState().accelerateHatchCooldownForSelected(confirmAccelerateGold);\n    }\n    setConfirmEggId(null);\n    setConfirmAccelerateGold(0);\n    setHatchingEggId(eggId);\n    setTimeout(() => {\n      hatchEggForSelected(eggId);\n      const h2 = useHeroStore.getState().getSelectedHero();\n      if (h2) {\n        useHeroStore.getState().updateHero(h2.id, { eggs: (h2.eggs || []).filter(e => e.id !== eggId) });\n        const last = (h2.hatchHistory || []).slice(-1)[0];\n        if (last?.petId) setHatchResultPetId(last.petId);\n      }\n      setHatchingEggId(null);\n    }, 1200);\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto clip-container overflow-hidden\">\n      <div className=\"mb-4 flex gap-2\">\n        <TabButton active={tab==='ovos'} onClick={() => setTab('ovos')} label=\"Inventrio de Ovos\" icon=\"\" />\n        <TabButton active={tab==='camara'} onClick={() => setTab('camara')} label=\"Cmara de Ecloso\" icon=\"\" />\n        <TabButton active={tab==='meus'} onClick={() => setTab('meus')} label=\"Meus Mascotes\" icon=\"\" />\n        <TabButton active={tab==='historico'} onClick={() => setTab('historico')} label=\"Histrico de Ecloses\" icon=\"\" />\n        <label className=\"ml-auto flex items-center gap-1 text-xs text-gray-300\">\n          <input type=\"checkbox\" onChange={e => { try { localStorage.setItem('auto_accept_companion_mission', e.target.checked ? '1' : '0'); if (hero?.id) trackMetric.featureUsed(hero.id, `pref:auto_accept_companion_mission:${e.target.checked?'on':'off'}`); } catch {} }} defaultChecked={(() => { try { return localStorage.getItem('auto_accept_companion_mission') === '1'; } catch { return false; } })()} /> Aceitar misso sugerida\n        </label>\n      </div>\n\n      {tab === 'ovos' && (\n        <div className=\"space-y-3\">\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <h2 className=\"text-xl font-bold\">Ovos</h2>\n              <div className=\"text-xs text-gray-300\">Capacidade: {eggs.length}/30</div>\n              {(() => {\n                const cdMs = hero.hatchCooldownEndsAt ? Math.max(0, new Date(hero.hatchCooldownEndsAt).getTime() - Date.now()) : 0;\n                if (cdMs > 0) {\n                  const pct = Math.max(0, Math.min(100, Math.round(cdMs / 300) ));\n                  return (\n                    <div className=\"mt-1\">\n                      <div className=\"text-xs text-gray-300\">Cooldown de Chocagem: {Math.ceil(cdMs / 1000)}s</div>\n                      <div className=\"w-40 bg-gray-700 rounded-full h-1.5\">\n                        <div className=\"h-1.5 rounded-full bg-amber-500\" style={{ width: `${pct}%` }} />\n                      </div>\n                    </div>\n                  );\n                }\n                return null;\n              })()}\n            </div>\n            \n          </div>\n          <div className=\"flex justify-end mb-2\">\n            {(() => {\n              const readyList = eggsSorted.filter(e => e.status === 'pronto_para_chocar');\n              if (readyList.length === 0) return null;\n              const target = readyList[0];\n              const hatchCostByRarity: Record<string, number> = { comum: 5, incomum: 10, raro: 20, epico: 50, lendario: 100, mistico: 200 };\n              const cost = hatchCostByRarity[String(target.identified?.rarity || target.baseRarity)] || 0;\n              const cdMs = hero.hatchCooldownEndsAt ? Math.max(0, new Date(hero.hatchCooldownEndsAt).getTime() - Date.now()) : 0;\n              const gold = hero.progression.gold || 0;\n              const disabled = cdMs > 0 || gold < cost;\n              const rarity = String(target.identified?.rarity || target.baseRarity);\n              const high = ['epico','lendario','mistico'].includes(rarity);\n              const baseClass = disabled ? 'bg-gray-700 cursor-not-allowed' : high ? 'bg-gradient-to-r from-amber-600 to-emerald-600 hover:brightness-110' : 'bg-amber-600 hover:bg-amber-700';\n              const label = high ? ' Chocar Prximo' : ' Chocar Prximo';\n              return (\n                <button onClick={() => setConfirmEggId(target.id)} disabled={disabled} className={`px-3 py-2 rounded text-white text-sm ${baseClass}`}>{label}</button>\n              );\n            })()}\n          </div>\n          <div className=\"text-xs text-gray-300 flex flex-wrap gap-2\">\n            {Object.entries(rarityCounts).map(([r,c]) => (\n              <span key={r} className=\"px-2 py-1 rounded bg-slate-800 border border-slate-700\">{r}: {c}</span>\n            ))}\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n            {eggs.length === 0 && <div className=\"text-gray-400\">Nenhum ovo ainda. Explore misses e dungeons para encontrar ovos!</div>}\n            {eggsSorted.map(egg => (\n              <EggCard\n                key={egg.id}\n                egg={egg}\n                inventory={inventory}\n                gold={hero.progression.gold}\n                onIdentify={() => handleIdentify(egg.id)}\n                onIncubate={() => handleIncubate(egg.id)}\n                onAccelerateEssencia={() => handleAccelerateEssencia(egg.id)}\n                onAccelerateBrasas={() => handleAccelerateBrasas(egg.id)}\n                onAccelerateGold={(amt) => handleAccelerateGold(egg.id, amt)}\n                onHatch={() => handleHatch(egg.id)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {tab === 'camara' && (\n        <div className=\"space-y-3\">\n          <h2 className=\"text-xl font-bold\">Cmara de Ecloso</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n            {[0,1,2].map(slot => (\n              <div key={slot} className=\"p-4 rounded-lg bg-slate-900 border border-slate-700\">\n                <div className=\"font-semibold mb-2\">Slot {slot+1}</div>\n                {incubatingSlots[slot] ? (\n                  <EggCard\n                    egg={incubatingSlots[slot]!}\n                    inventory={inventory}\n                    gold={hero.progression.gold}\n                    onIdentify={() => {}}\n                    onIncubate={() => {}}\n                    onAccelerateEssencia={() => handleAccelerateEssencia(incubatingSlots[slot]!.id)}\n                    onAccelerateBrasas={() => handleAccelerateBrasas(incubatingSlots[slot]!.id)}\n                    onAccelerateGold={(amt) => handleAccelerateGold(incubatingSlots[slot]!.id, amt)}\n                    onHatch={() => handleHatch(incubatingSlots[slot]!.id)}\n                  />\n                ) : (\n                  <div className=\"text-gray-400 text-sm\">Vazio. Selecione um ovo identificado para incubar.</div>\n                )}\n              </div>\n            ))}\n          </div>\n          <div className=\"mt-3\">\n            <h3 className=\"text-sm text-gray-300\">Elegveis para incubao</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 mt-2\">\n              {eggs.filter(e => e.status === 'identificado').map(e => (\n                <div key={e.id} className=\"p-3 rounded bg-slate-800 border border-slate-700 flex justify-between items-center\">\n                  <div>\n                    <div className=\"font-semibold\">{e.name}</div>\n                    <div className=\"text-xs text-gray-400\">{e.identified?.type}  {e.identified?.petClass}  {e.identified?.rarity}</div>\n                  </div>\n                  <button onClick={() => handleIncubate(e.id)} className=\"px-3 py-1 rounded bg-purple-600 hover:bg-purple-700 text-white text-sm\">Incubar</button>\n                </div>\n              ))}\n              {eggs.filter(e => e.status === 'identificado').length === 0 && (\n                <div className=\"text-gray-400\">Nenhum ovo identificado no momento.</div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {tab === 'meus' && (\n        <div className=\"space-y-3\">\n          <div>\n            <h2 className=\"text-xl font-bold\">Meus Mascotes</h2>\n            <div className=\"text-xs text-gray-300\">Capacidade: {pets.length}/50</div>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n            {pets.length === 0 && <div className=\"text-gray-400\">Nenhum mascote ainda. Incube e choque ovos para obter companheiros!</div>}\n            {pets.map(pet => (\n              <PetCard\n                key={pet.id}\n                pet={pet}\n                inventory={inventory}\n                onTrain={() => addPetXPForSelected(pet.id, 100)}\n                onSoulStone={() => {\n                  if (consumeInventoryItem(hero.id, 'pedra-alma', 1)) addPetXPForSelected(pet.id, 300);\n                }}\n                onFeedBasic={() => {\n                  if (consumeInventoryItem(hero.id, 'racao-basica', 1)) {\n                    addPetXPForSelected(pet.id, 50);\n                    updateHero(hero.id, { pets: (hero.pets || []).map(p => p.id === pet.id ? { ...p, energy: Math.min(100, (p.energy || 0) + 10) } : p) });\n                  }\n                }}\n                onFeedDeluxe={() => {\n                  if (consumeInventoryItem(hero.id, 'racao-deluxe', 1)) {\n                    addPetXPForSelected(pet.id, 150);\n                    updateHero(hero.id, { pets: (hero.pets || []).map(p => p.id === pet.id ? { ...p, energy: Math.min(100, (p.energy || 0) + 30) } : p) });\n                  }\n                }}\n                onSetActive={() => setActivePet(pet.id)}\n                onRename={(name) => updateHero(hero.id, { pets: (hero.pets || []).map(p => p.id === pet.id ? { ...p, name } : p) })}\n                isActive={hero.activePetId === pet.id}\n                onRefine={() => refinePetForSelected(pet.id)}\n                onSuggestMission={() => {\n                  const ok = suggestCompanionQuestForSelected();\n                  if (ok) {\n                    try { (window as any).notificationBus?.emit?.({ type: 'quest', title: 'Misso sugerida', message: 'Uma misso de companheiros foi adicionada ao quadro', icon: '', duration: 2500 }); } catch {}\n                  } else {\n                    try { (window as any).notificationBus?.emit?.({ type: 'item', title: 'Sem misso disponvel', message: 'Nenhuma necessidade detectada para sugerir misso.', icon: '', duration: 2000 }); } catch {}\n                  }\n                }}\n                onSell={() => setConfirmSellPetId(pet.id)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {tab === 'historico' && (\n        <div className=\"space-y-3\">\n          <h2 className=\"text-xl font-bold\">Histrico de Ecloses</h2>\n          <div className=\"text-xs text-gray-300 flex flex-wrap gap-2\">\n            <span className=\"px-2 py-1 rounded bg-slate-800 border border-slate-700\">Total: {hatchSummary.total}</span>\n            {Object.entries(hatchSummary.counts).map(([r,c]) => (\n              <span key={`sum-${r}`} className=\"px-2 py-1 rounded bg-slate-800 border border-slate-700\">{r}: {c}</span>\n            ))}\n            <span className=\"px-2 py-1 rounded bg-slate-800 border border-slate-700\">Taxa de mutao: {hatchSummary.rate}%</span>\n            <span className=\"px-2 py-1 rounded bg-slate-800 border border-slate-700\">Custo total: {hatchSummary.totalCost} ouro</span>\n          </div>\n          <div className=\"text-xs text-gray-300 flex flex-wrap gap-2\">\n            <span className=\"px-2 py-1 rounded bg-slate-800 border border-slate-700\">ltimos 7 dias: {hatchSummary.last7.total}  Mutao {hatchSummary.rate7}%  Custo {hatchSummary.last7.cost} ouro</span>\n            <span className=\"px-2 py-1 rounded bg-slate-800 border border-slate-700\">ltimos 30 dias: {hatchSummary.last30.total}  Mutao {hatchSummary.rate30}%  Custo {hatchSummary.last30.cost} ouro</span>\n          </div>\n          <div className=\"flex gap-2 items-center text-xs\">\n            <span className=\"text-gray-300\">Filtrar:</span>\n            {['todos','raro','epico','lendario','mistico'].map(f => (\n              <button key={f} onClick={() => setHistoryFilter(f as any)} className={`px-2 py-1 rounded ${historyFilter===f ? 'bg-amber-600 text-white' : 'bg-gray-700 text-gray-200'}`}>{f}</button>\n            ))}\n          </div>\n          <div className=\"space-y-2\">\n            {filteredHistory.length === 0 && <div className=\"text-gray-400\">Nenhuma ecloso registrada para este filtro.</div>}\n            {filteredHistory.map(h => (\n              <div key={h.timestamp} className=\"p-3 rounded bg-slate-800 border border-slate-700 text-sm text-gray-200 flex items-center justify-between\">\n                <div>\n                   Eclodiu em {new Date(h.timestamp).toLocaleString()}  Mascote {(hero.pets||[]).find(p=>p.id===h.petId)?.name || h.petId.slice(0,8)}  Raridade {(hero.pets||[]).find(p=>p.id===h.petId)?.rarity}\n                </div>\n                {(() => {\n                  const pet = (hero.pets||[]).find(p=>p.id===h.petId);\n                  if (pet?.mutation?.variant) return <span className=\"px-2 py-1 rounded bg-amber-700 text-white text-xs\"> Mutado</span>;\n                  return null;\n                })()}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      <AnimatePresence>\n        {hatchingEggId && (\n          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50\">\n            {(() => {\n              const egg = (hero.eggs || []).find(e => e.id === hatchingEggId);\n              const type = egg?.identified?.type;\n              const gradient = type === 'feral' ? 'from-emerald-700 to-emerald-900'\n                : type === 'arcano' ? 'from-indigo-700 to-indigo-900'\n                : type === 'sagrado' ? 'from-amber-600 to-amber-900'\n                : type === 'sombrio' ? 'from-slate-800 to-black' : 'from-slate-800 to-slate-900';\n              return (\n                <motion.div initial={{ scale: 0.8 }} animate={{ scale: 1 }} exit={{ scale: 0.8 }} className={`p-6 rounded-xl bg-gradient-to-br ${gradient} border border-amber-500 text-center text-white`}>\n                  <div className=\"text-6xl mb-2\"></div>\n                  <div className=\"text-lg font-semibold mb-2\">O ovo est se movendo!</div>\n                  <div className=\"text-sm opacity-90\">Rachaduras luz uma criatura {egg?.identified?.type || 'misteriosa'} emerge</div>\n                </motion.div>\n              );\n            })()}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {confirmEggId && (() => {\n        const egg = eggs.find(e => e.id === confirmEggId)!;\n        const hatchCostByRarity: Record<string, number> = { comum: 5, incomum: 10, raro: 20, epico: 50, lendario: 100, mistico: 200 };\n        const hatchCost = hatchCostByRarity[String(egg.identified?.rarity || egg.baseRarity)] || 0;\n        const cdMs = hero.hatchCooldownEndsAt ? Math.max(0, new Date(hero.hatchCooldownEndsAt).getTime() - Date.now()) : 0;\n        const gold = hero.progression.gold || 0;\n        const insufficient = gold < hatchCost;\n        const reduceMsPreview = Math.floor((confirmAccelerateGold / 10) * 60 * 1000);\n        const newCdMsPreview = cdMs > 0 ? Math.max(0, cdMs - reduceMsPreview) : 0;\n        return (\n          <div className=\"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center\">\n            <div className=\"w-full max-w-md rounded-xl border border-amber-500 bg-slate-900 p-5 text-white\">\n              <div className=\"text-lg font-semibold mb-2\">Confirmar Chocagem</div>\n              <div className=\"text-sm text-gray-200\">Custo: {hatchCost} ouro</div>\n              {cdMs > 0 && (\n                <div className=\"text-sm text-gray-300 mt-1\">Cooldown ativo: {Math.ceil(cdMs/1000)}s</div>\n              )}\n              <div className=\"mt-3 text-xs text-gray-300\">\n                <div>Ovo: {egg.name}</div>\n                <div>Raridade: {String(egg.identified?.rarity || egg.baseRarity)}</div>\n                {egg.identified && (\n                  <div className=\"mt-1\">\n                    <div>Tipo: {egg.identified.type}  Classe: {egg.identified.petClass}</div>\n                    {Array.isArray(egg.identified.candidates) && egg.identified.candidates.length > 0 && (\n                      <div className=\"mt-1\">Possveis mascotes: {egg.identified.candidates.join(', ')}</div>\n                    )}\n                  </div>\n                )}\n              </div>\n              <div className=\"mt-3\">\n                <label className=\"text-xs text-gray-300\">Acelerar cooldown com ouro (10 ouro = 1 min)</label>\n                <input type=\"number\" min={0} value={confirmAccelerateGold} onChange={(e) => setConfirmAccelerateGold(Math.max(0, Number(e.target.value)))} className=\"mt-1 w-full px-2 py-1 rounded bg-slate-800 border border-slate-700\" />\n                {confirmAccelerateGold > 0 && (\n                  <div className=\"mt-2 text-xs text-amber-300\">Reduo prevista: {Math.floor(reduceMsPreview/60000)} min  Novo cooldown: {Math.ceil(newCdMsPreview/1000)}s</div>\n                )}\n              </div>\n              {insufficient && <div className=\"mt-2 text-xs text-red-300\">Ouro insuficiente para chocar.</div>}\n              <div className=\"mt-4 flex gap-2\">\n                <button disabled={insufficient} onClick={confirmHatchProceed} className={`px-3 py-2 rounded ${insufficient ? 'bg-gray-700 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700'}`}>Confirmar</button>\n                <button onClick={() => { setConfirmAccelerateGold(0); setConfirmEggId(null); }} className=\"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600\">Cancelar</button>\n              </div>\n            </div>\n          </div>\n        );\n      })()}\n      {confirmSellPetId && (() => {\n        const pet = (hero.pets || []).find(p => p.id === confirmSellPetId)!;\n        const baseByRarity: Record<string, number> = { comum: 100, incomum: 200, raro: 400, epico: 800, lendario: 1600, mistico: 3000 };\n        const base = baseByRarity[String(pet.rarity ?? 'comum')] || 100;\n        const levelBonus = Math.max(0, pet.level || 1) * 20;\n        const refineBonus = Math.max(0, pet.refineLevel || 0) * 50;\n        const mutationBonus = pet.mutation?.variant ? 200 : 0;\n        const price = base + levelBonus + refineBonus + mutationBonus;\n        return (\n          <div className=\"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center\" role=\"dialog\" aria-modal=\"true\">\n            <div className=\"w-full max-w-md rounded-xl border border-amber-500 bg-slate-900 p-5 text-white\">\n              <div className=\"text-lg font-semibold mb-2\">Confirmar Venda de Mascote</div>\n              <div className=\"text-sm text-gray-200\">Voc receber {price} ouro por {pet.name}.</div>\n              <div className=\"mt-2 text-xs text-gray-300\">Raridade: {String(pet.rarity ?? 'comum')}  Nvel {pet.level}  Refino {(pet.refineLevel||0)}</div>\n              <div className=\"mt-4 flex gap-2\">\n                <button aria-busy={isSelling} onClick={() => {\n                  setIsSelling(true);\n                  setTimeout(() => {\n                    try {\n                      useHeroStore.getState().sellPetForSelected(confirmSellPetId!);\n                      (window as any).notificationBus?.emit?.({ type: 'gold', title: 'Venda concluda', message: `${pet.name} vendido por ${price} ouro.`, icon: '', duration: 3000 });\n                    } catch {}\n                    setIsSelling(false);\n                    setConfirmSellPetId(null);\n                  }, 600);\n                }} className={`px-3 py-2 rounded ${isSelling ? 'bg-gray-700 cursor-wait' : 'bg-green-700 hover:bg-green-800'} text-white`}>{isSelling ? 'Processando' : 'Confirmar'}</button>\n                <button onClick={() => setConfirmSellPetId(null)} className=\"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600\">Cancelar</button>\n              </div>\n            </div>\n          </div>\n        );\n      })()}\n      {hatchResultPetId && (\n        <HatchResultModal petId={hatchResultPetId} onClose={() => setHatchResultPetId(null)} />\n      )}\n    </div>\n  );\n};\n\nexport default PetsPanel;\n","import React, { useMemo, useState, useEffect } from 'react'\nimport { useHeroStore } from '../store/heroStore'\nimport { Mount } from '../types/hero'\nimport { notificationBus } from './NotificationSystem'\n\nconst sampleMounts: Mount[] = [\n  { id: crypto.randomUUID(), name: 'Cavalo Rstico', type: 'cavalo', rarity: 'comum', stage: 'comum', speedBonus: 1, attributes: { destreza: 1 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Lobo Gigante', type: 'lobo', rarity: 'raro', stage: 'comum', speedBonus: 0, attributes: { forca: 2 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Grifo Jovem', type: 'grifo', rarity: 'raro', stage: 'comum', speedBonus: 1, attributes: { destreza: 1 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Urso Montanhs', type: 'urso', rarity: 'incomum', stage: 'comum', speedBonus: 0, attributes: { forca: 2 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Felino gil', type: 'felino', rarity: 'raro', stage: 'comum', speedBonus: 1, attributes: { destreza: 2 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Cervo Celeste', type: 'cervo', rarity: 'incomum', stage: 'comum', speedBonus: 1, attributes: { destreza: 1 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Alce Majestoso', type: 'alce', rarity: 'raro', stage: 'comum', speedBonus: 1, attributes: { constituicao: 2 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Hipogrifo Jovem', type: 'hipogrifo', rarity: 'raro', stage: 'comum', speedBonus: 1, attributes: { destreza: 2 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Rinoceronte de Guerra', type: 'rinoceronte', rarity: 'raro', stage: 'comum', speedBonus: 0, attributes: { forca: 3, constituicao: 1 }, createdAt: new Date().toISOString() },\n  { id: crypto.randomUUID(), name: 'Wyvern Veloz', type: 'wyvern', rarity: 'raro', stage: 'comum', speedBonus: 1, attributes: { destreza: 2 }, createdAt: new Date().toISOString() }\n]\n\nexport const MountsPanel: React.FC = () => {\n  const { getSelectedHero, addMountToSelected, setActiveMount, evolveMountForSelected, refineCompanion, buyItem, setFavoriteMount, generateMountForSelected } = useHeroStore()\n  const hero = getSelectedHero()\n  const [sortKey, setSortKey] = useState<'velocidade'|'raridade'|'estagio'|'nome'|'maestria'>('estagio')\n  const [compareAId, setCompareAId] = useState<string | undefined>(undefined)\n  const [compareBId, setCompareBId] = useState<string | undefined>(undefined)\n  const [selectedType, setSelectedType] = useState<Mount['type'] | 'todos'>('todos')\n  const [selectedRarity, setSelectedRarity] = useState<'todos'|'comum'|'incomum'|'raro'|'epico'|'lendario'|'mistico'>('todos')\n  const [selectedStage, setSelectedStage] = useState<'todos'|'comum'|'encantada'|'lendaria'>('todos')\n  const [searchTerm, setSearchTerm] = useState('')\n  const [detailId, setDetailId] = useState<string | undefined>(undefined)\n  const [tick, setTick] = useState(0)\n  useEffect(() => { const id = setInterval(() => setTick(t => t + 1), 1000); return () => clearInterval(id) }, [])\n  useEffect(() => { const onKey = (e: KeyboardEvent) => { const favs = hero?.favoriteMountIds || []; if (e.key === '1' && favs[0]) setActiveMount(favs[0]); if (e.key === '2' && favs[1]) setActiveMount(favs[1]); if (e.key === '3' && favs[2]) setActiveMount(favs[2]); }; window.addEventListener('keydown', onKey as any); return () => window.removeEventListener('keydown', onKey as any); }, [hero?.favoriteMountIds])\n\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar Montarias.</p>\n      </div>\n    )\n  }\n\n  const mounts = hero.mounts || []\n  const activeId = hero.activeMountId\n  const inventory = hero.inventory.items || {}\n\n  const canRefineAny = (inventory['pedra-magica'] || 0) > 0 || (inventory['essencia-vinculo'] || 0) > 0\n  const canEvolveAny = (inventory['pergaminho-montaria'] || 0) > 0 && (hero.progression.gold || 0) >= 200\n\n  const sortedMounts = useMemo(() => {\n    const copy = [...mounts]\n    if (sortKey === 'maestria') copy.sort((a,b) => (Math.max(0,b.mastery||0)) - (Math.max(0,a.mastery||0)))\n    else if (sortKey === 'velocidade') copy.sort((a,b) => (b.speedBonus||0) - (a.speedBonus||0))\n    else if (sortKey === 'raridade') {\n      const order: Record<string, number> = { comum: 0, incomum: 1, raro: 2, epico: 3, lendario: 4, mistico: 5 }\n      copy.sort((a,b) => (order[b.rarity]-order[a.rarity]) || a.name.localeCompare(b.name))\n    }\n    else if (sortKey === 'estagio') {\n      const order: Record<string, number> = { comum: 0, encantada: 1, lendaria: 2 }\n      copy.sort((a,b) => (order[b.stage]-order[a.stage]) || a.name.localeCompare(b.name))\n    }\n    else copy.sort((a,b) => a.name.localeCompare(b.name))\n    return copy\n  }, [mounts, sortKey])\n\n  const bestMountId = useMemo(() => {\n    if (!mounts.length) return undefined\n    if (hero?.favoriteMountId && mounts.some(m => m.id === hero.favoriteMountId)) return hero.favoriteMountId\n    const stageOrder: Record<string, number> = { comum: 0, encantada: 1, lendaria: 2 }\n    const rarityOrder: Record<string, number> = { comum: 0, incomum: 1, raro: 2, epico: 3, lendario: 4, mistico: 5 }\n    const score = (m: Mount) => {\n      const attrSum = Object.values(m.attributes || {}).reduce((s, v) => s + (typeof v === 'number' ? v : 0), 0)\n      return (m.speedBonus || 0) * 3 + attrSum + (stageOrder[m.stage] || 0) * 2 + (rarityOrder[m.rarity] || 0)\n    }\n    return mounts.slice().sort((a,b) => score(b) - score(a))[0]?.id\n  }, [mounts, hero?.favoriteMountId])\n\n  const activeSpeed = useMemo(() => {\n    const am = (hero.mounts || []).find(m => m.id === activeId)\n    return Math.max(0, am?.speedBonus || 0)\n  }, [hero.mounts, activeId])\n\n  const typeIcon: Record<Mount['type'], string> = {\n    cavalo: '',\n    lobo: '',\n    grifo: '',\n    javali: '',\n    lagarto: '',\n    draconiano: '',\n    urso: '',\n    felino: '',\n    cervo: '',\n    alce: '',\n    hipogrifo: '',\n    rinoceronte: '',\n    wyvern: ''\n  }\n  const rarityClass: Record<string, string> = {\n    comum: 'bg-gray-700 text-gray-200',\n    incomum: 'bg-emerald-700 text-emerald-100',\n    raro: 'bg-blue-700 text-blue-100',\n    epico: 'bg-purple-700 text-purple-100',\n    lendario: 'bg-amber-700 text-amber-100',\n    mistico: 'bg-pink-700 text-pink-100'\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-xl font-bold\">Montarias</h2>\n        <div className=\"flex gap-2\">\n          <button disabled={!bestMountId} onClick={() => bestMountId && setActiveMount(bestMountId)} className={`px-3 py-2 rounded ${bestMountId?'bg-indigo-600 hover:bg-indigo-700':'bg-gray-700'} text-white text-sm`}>Ativar melhor</button>\n          {hero?.favoriteMountId && (\n            <button onClick={() => setActiveMount(hero.favoriteMountId)} className=\"px-3 py-2 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm\">Ativar favorita </button>\n          )}\n          \n          \n          <button onClick={() => { try { const payload = JSON.stringify((hero.mounts||[]).map(m => ({ name:m.name, type:m.type, rarity:m.rarity, stage:m.stage, speedBonus:m.speedBonus, attributes:m.attributes, refineLevel:m.refineLevel, mastery:m.mastery })), null, 2); navigator.clipboard.writeText(payload); notificationBus.emit({ type:'item', title:'Exportado', message:'Estbulo copiado para a rea de transferncia', duration:3000 }); } catch { notificationBus.emit({ type:'item', title:'Falha ao exportar', message:'Verifique permisses do navegador', duration:3000 }); } }} className=\"px-3 py-2 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm\">Exportar</button>\n          <button onClick={() => { const json = window.prompt('Cole o JSON de montarias'); if (!json) return; const ok = (useHeroStore.getState() as any).importMountsForSelected(json); if (!ok) notificationBus.emit({ type:'item', title:'Importao falhou', message:'Formato invlido ou sem capacidade', duration:3000 }); }} className=\"px-3 py-2 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm\">Importar</button>\n          \n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-between mb-3\">\n        <div className=\"text-xs text-gray-300\">\n           Pergaminhos: <span className=\"text-amber-300 font-semibold\">{inventory['pergaminho-montaria']||0}</span>\n          <span className=\"ml-3\"> Essncia Bestial: <span className=\"text-amber-300 font-semibold\">{inventory['essencia-bestial']||0}</span></span>\n          <span className=\"ml-3\"> Pedra Mgica: <span className=\"text-amber-300 font-semibold\">{inventory['pedra-magica']||0}</span></span>\n          <span className=\"ml-3\"> Essncia de Vnculo: <span className=\"text-amber-300 font-semibold\">{inventory['essencia-vinculo']||0}</span></span>\n          <span className=\"ml-3\"> Estbulo: <span className=\"text-amber-300 font-semibold\">{mounts.length}/{hero.stableCapacity || 50}</span></span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <label className=\"text-xs text-gray-300\">Ordenar por</label>\n          <select value={sortKey} onChange={e => setSortKey(e.target.value as any)} className=\"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded\">\n            <option value=\"estagio\">Estgio</option>\n            <option value=\"raridade\">Raridade</option>\n            <option value=\"velocidade\">Velocidade</option>\n            <option value=\"nome\">Nome</option>\n            <option value=\"maestria\">Maestria</option>\n          </select>\n          <input value={searchTerm} onChange={e => setSearchTerm(e.target.value)} placeholder=\"Buscar por nome\" className=\"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded\" />\n        <label className=\"ml-2 flex items-center gap-1 text-xs text-gray-300\">\n          <span>Tipo</span>\n          <select value={selectedType} onChange={e => setSelectedType(e.target.value as any)} className=\"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded\">\n            <option value=\"todos\">Todos</option>\n            {Object.keys(typeIcon).map(t => (<option key={t} value={t}>{t}</option>))}\n          </select>\n        </label>\n        \n        <label className=\"ml-2 flex items-center gap-1 text-xs text-gray-300\">\n          <span>Raridade</span>\n          <select value={selectedRarity} onChange={e => setSelectedRarity(e.target.value as any)} className=\"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded\">\n            {['todos','comum','incomum','raro','epico','lendario','mistico'].map(r => (<option key={r} value={r}>{r}</option>))}\n          </select>\n        </label>\n        <label className=\"ml-2 flex items-center gap-1 text-xs text-gray-300\">\n          <span>Estgio</span>\n          <select value={selectedStage} onChange={e => setSelectedStage(e.target.value as any)} className=\"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded\">\n            {['todos','comum','encantada','lendaria'].map(s => (<option key={s} value={s}>{s}</option>))}\n          </select>\n        </label>\n      </div>\n      </div>\n\n      {(canEvolveAny || canRefineAny) && (\n        <div className=\"mb-3 rounded-lg p-2 bg-emerald-800/30 border border-emerald-500/30 text-emerald-200 text-xs\">\n          {canEvolveAny && <span>Evoluo disponvel: use pergaminhos e ouro para avanar o estgio. </span>}\n          {canRefineAny && <span>Refino possvel: consome materiais e pode falhar em nveis altos.</span>}\n        </div>\n      )}\n\n      {(() => {\n        const rarities = ['comum','incomum','raro','epico','lendario','mistico'] as const;\n        const byRarity = rarities.map(r => ({ r, c: (mounts||[]).filter(m => m.rarity === r).length }));\n        const typeCounts = Object.keys(typeIcon).map(t => ({ t, c: (mounts||[]).filter(m => m.type === t).length }));\n        const topTypes = typeCounts.sort((a,b)=>b.c-a.c).slice(0,3);\n        return (\n          <div className=\"mb-3 rounded-lg p-2 bg-slate-800 border border-slate-700 text-xs text-gray-300\">\n            <div>Resumo: {byRarity.map(x => `${x.r}:${x.c}`).join('  ')}  Top tipos: {topTypes.map(x => `${x.t}:${x.c}`).join('  ')}</div>\n          </div>\n        )\n      })()}\n\n      {(hero.favoriteMountIds && hero.favoriteMountIds.length > 0) && (\n        <div className=\"mb-3 rounded-lg p-2 bg-slate-800 border border-amber-500/30\">\n          <div className=\"text-xs text-amber-300 mb-1\">Favoritos</div>\n          <div className=\"flex gap-2\">\n            {hero.favoriteMountIds.slice(0,3).map(fid => {\n              const fm = (hero.mounts||[]).find(mm => mm.id === fid)\n              if (!fm) return null\n              const idx = (hero.favoriteMountIds||[]).slice(0,3).indexOf(fid)\n              const label = idx>=0 ? `[${idx+1}]` : ''\n              const isActiveFav = hero.activeMountId === fid\n              return (\n                <button key={fid} onClick={() => setActiveMount(fid)} className={`px-2 py-1 rounded ${isActiveFav?'bg-amber-800':'bg-amber-700 hover:bg-amber-800'} text-white text-[11px]`}>{label} {typeIcon[fm.type]} {fm.name}</button>\n              )\n            })}\n          </div>\n        </div>\n      )}\n\n      {(() => {\n        const today = new Date().toDateString();\n        let seed = today.split('').reduce((acc, ch) => acc + ch.charCodeAt(0), 0);\n        const rand = () => { const x = Math.sin(seed++) * 10000; return x - Math.floor(x); };\n        const types = Object.keys(typeIcon) as (keyof typeof typeIcon)[];\n        const rarities: ('comum'|'incomum'|'raro'|'epico'|'lendario'|'mistico')[] = ['comum','incomum','raro','epico','lendario'];\n        const priceByRarity: Record<string, number> = { comum: 150, incomum: 220, raro: 400, epico: 900, lendario: 2000, mistico: 4000 };\n        const offers = Array.from({ length: 3 }).map(() => {\n          const t = types[Math.floor(rand() * types.length)] as any;\n          const r = rarities[Math.floor(rand() * rarities.length)] as any;\n          return { type: t, rarity: r, price: priceByRarity[r] };\n        });\n        return (\n          <div className=\"mb-3 rounded-lg p-3 bg-slate-800 border border-emerald-500/30\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-emerald-300 text-xs font-medium\">Mercador do Estbulo</span>\n              <span className=\"text-gray-400 text-[11px]\">Ofertas do dia</span>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\n              {offers.map((o, idx) => (\n                <div key={idx} className=\"bg-slate-900 rounded p-2 border border-slate-700 flex items-center justify-between\">\n                  <div className=\"text-xs text-gray-200\">{typeIcon[o.type]} {String(o.type)}  <span className={`px-2 py-0.5 rounded ${rarityClass[o.rarity]}`}>{o.rarity}</span></div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-amber-300 text-xs\"> {o.price}</span>\n                    <button onClick={() => (useHeroStore.getState() as any).buyMountOffer(hero.id, o.type, o.rarity, o.price)} className=\"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-[11px]\">Comprar</button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        );\n      })()}\n\n      {compareAId && compareBId && (\n        <div className=\"mb-3 rounded-lg p-3 bg-slate-800 border border-amber-500/40 text-amber-200 text-xs\">\n          {(() => {\n            const a = mounts.find(m => m.id === compareAId)\n            const b = mounts.find(m => m.id === compareBId)\n            if (!a || !b) return null\n            const aInit = Math.max(0, (hero.derivedAttributes.initiative || 0) - activeSpeed + (a.speedBonus || 0))\n            const bInit = Math.max(0, (hero.derivedAttributes.initiative || 0) - activeSpeed + (b.speedBonus || 0))\n            const attrSum = (m: Mount) => Object.values(m.attributes || {}).reduce((s, v) => s + (typeof v === 'number' ? v : 0), 0)\n            return (\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <div className=\"font-semibold text-white text-sm\">{typeIcon[a.type]} {a.name}</div>\n                  <div className=\"text-amber-300\">Velocidade +{a.speedBonus}  Iniciativa {aInit}</div>\n                  <div className=\"text-gray-300\">Bnus {attrSum(a)}</div>\n                </div>\n                <div>\n                  <div className=\"font-semibold text-white text-sm\">{typeIcon[b.type]} {b.name}</div>\n                  <div className=\"text-amber-300\">Velocidade +{b.speedBonus}  Iniciativa {bInit}</div>\n                  <div className=\"text-gray-300\">Bnus {attrSum(b)}</div>\n                </div>\n              </div>\n            )\n          })()}\n          <div className=\"mt-2 flex gap-2\">\n            <button onClick={() => setCompareAId(undefined)} className=\"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-[11px]\">Limpar A</button>\n            <button onClick={() => setCompareBId(undefined)} className=\"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-[11px]\">Limpar B</button>\n            <button onClick={() => { setCompareAId(undefined); setCompareBId(undefined) }} className=\"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-[11px]\">Limpar</button>\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n        {mounts.length === 0 && <div className=\"text-gray-400\">Nenhuma montaria ainda. Conquiste pergaminhos e essncias em misses para desbloquear.</div>}\n        {sortedMounts.filter(m => {\n          const needsEssence = m.stage === 'encantada'\n          const hasScroll = (inventory['pergaminho-montaria'] || 0) > 0\n          const hasEssence = (inventory['essencia-bestial'] || 0) > 0\n          const enoughGold = (hero.progression.gold || 0) >= (m.stage === 'comum' ? 200 : 700)\n          const evolvable = hasScroll && enoughGold && (!needsEssence || hasEssence)\n          const refinable = ((inventory['pedra-magica'] || 0) > 0 || (inventory['essencia-vinculo'] || 0) > 0) && ((m.refineLevel || 0) < 10)\n          if (selectedType !== 'todos' && m.type !== selectedType) return false\n          if (selectedRarity !== 'todos' && m.rarity !== selectedRarity) return false\n          if (selectedStage !== 'todos' && m.stage !== selectedStage) return false\n          if (searchTerm && !m.name.toLowerCase().includes(searchTerm.toLowerCase())) return false\n          if (showEvolvableOnly && !evolvable) return false\n          if (showRefinableOnly && !refinable) return false\n          return true\n        }).map(m => {\n          const needsEssence = m.stage === 'encantada';\n          const hasScroll = (inventory['pergaminho-montaria'] || 0) > 0;\n          const hasEssence = (inventory['essencia-bestial'] || 0) > 0;\n          const enoughGold = (hero.progression.gold || 0) >= (m.stage === 'comum' ? 200 : 700);\n          const canEvolve = hasScroll && enoughGold && (!needsEssence || hasEssence);\n          const isActive = activeId===m.id\n          const isMaxRefine = (m.refineLevel || 0) >= 10\n          const nextRefine = (m.refineLevel || 0) + 1\n          const refineChance = nextRefine <= 3 ? 100 : nextRefine <= 6 ? 75 : 45\n          const predictedInitiative = Math.max(0, (hero.derivedAttributes.initiative || 0) - activeSpeed + (m.speedBonus || 0))\n          return (\n          <div key={m.id} className={`p-4 rounded-lg ${isActive?'border-amber-500':'border-slate-700'} bg-slate-800 border flex flex-col gap-2`}>\n            <div className=\"flex justify-between items-center\">\n              <div className=\"font-semibold\">{typeIcon[m.type]} {m.name} {m.stage==='encantada' && <span className=\"ml-2 text-xs bg-purple-700 text-white px-2 py-1 rounded\">Encantada</span>} {m.stage==='lendaria' && <span className=\"ml-2 text-xs bg-amber-600 text-white px-2 py-1 rounded\">Lendria</span>} {typeof m.refineLevel==='number' && m.refineLevel>0 && <span className=\"ml-2 text-xs bg-violet-700 text-white px-2 py-1 rounded\">Refino +{m.refineLevel}</span>} {typeof m.mastery==='number' && m.mastery>0 && <span className=\"ml-2 text-xs bg-emerald-700 text-white px-2 py-1 rounded\">Maestria {m.mastery}</span>} {(() => { const ms = Math.max(0, m.mastery||0); const label = ms>=30 ? 'Mestre' : ms>=20 ? 'Perito' : ms>=10 ? 'Adepto' : ''; return label ? <span className=\"ml-2 text-xs bg-emerald-800 text-white px-2 py-1 rounded\">{label}</span> : null })()} {hero.favoriteMountId===m.id && <span className=\"ml-2 text-xs bg-amber-700 text-white px-2 py-1 rounded\"> Favorita</span>} {bestMountId===m.id && <span className=\"ml-2 text-xs bg-indigo-700 text-white px-2 py-1 rounded\">Recomendada</span>} <span className={`ml-2 text-[10px] px-2 py-1 rounded ${rarityClass[m.rarity]}`}>{m.rarity}</span></div>\n              <div className=\"text-xs text-amber-300\">{m.type}  {m.stage}  {m.rarity}</div>\n            </div>\n            <div className=\"text-sm text-gray-200\">Velocidade: +{m.speedBonus}</div>\n            {m.locked && <div className=\"text-[11px] text-emerald-300\"> Travada</div>}\n            {!isActive && (\n              <div className=\"text-[11px] text-amber-300\">Iniciativa se ativar: {predictedInitiative}</div>\n            )}\n            {isActive && (\n              <div className=\"text-xs text-amber-400\">Iniciativa atual: {hero.derivedAttributes.initiative}</div>\n            )}\n            {isActive && (() => { const mb = hero.mountBuff; if (!mb?.speedBonus) return null; const end = mb.expiresAt ? new Date(mb.expiresAt).getTime() : 0; const rem = Math.max(0, end - Date.now()); if (rem <= 0) return null; const mins = Math.floor(rem/60000); const secs = Math.floor((rem%60000)/1000); return (<div className=\"text-[11px] text-emerald-300\">Buff de treino +{mb.speedBonus}  expira em {String(mins).padStart(2,'0')}:{String(secs).padStart(2,'0')}</div>); })()}\n            {m.attributes && Object.keys(m.attributes).length > 0 && (\n              <div className=\"text-xs text-gray-300\">Bnus: {Object.entries(m.attributes).map(([k,v]) => `${k}+${v}`).join(', ')}</div>\n            )}\n            {(() => {\n              const totalReq = (m.stage==='encantada') ? 3 : 2;\n              const readyCount = ((inventory['pergaminho-montaria']||0)>0 ? 1 : 0) + (((hero.progression.gold||0) >= (m.stage === 'comum' ? 200 : 700)) ? 1 : 0) + ((m.stage==='encantada' && (inventory['essencia-bestial']||0)>0) ? 1 : 0);\n              const pct = Math.round((readyCount / totalReq) * 100);\n              return (\n                <div className=\"mt-1 w-full bg-gray-700 rounded h-2\">\n                  <div className=\"h-2 bg-indigo-500\" style={{ width: `${pct}%` }} />\n                </div>\n              );\n            })()}\n            {(() => { const mastery = Math.max(0, m.mastery || 0); const prog = mastery % 10; const toNext = 10 - (prog || 10); return (\n              <>\n                <div className=\"mt-1 w-full bg-gray-700 rounded h-2\">\n                  <div className=\"h-2 bg-emerald-600\" style={{ width: `${prog*10}%` }} />\n                </div>\n                <div className=\"text-[11px] text-gray-400\">Maestria: {prog}/10  Prximo bnus em {toNext}</div>\n              </>\n            ) })()}\n            {m.history && m.history.length > 0 && (\n              <div className=\"text-[11px] text-gray-400\">Histrico: {m.history.slice(0,3).map(h => `${new Date(h.ts).toLocaleTimeString()} ${h.action}${h.details?` ${h.details}`:''}`).join('  ')}</div>\n            )}\n            <div className=\"flex gap-2 mt-2\">\n              <button disabled={isActive} title={isActive?'Montaria ativa':''} onClick={() => setActiveMount(m.id)} className={`px-3 py-1 rounded ${isActive?'bg-gray-700 text-gray-300':'bg-indigo-600 hover:bg-indigo-700 text-white'} text-sm`}>{isActive?'Ativa':'Ativar'}</button>\n              {isActive && (\n                <button onClick={() => setActiveMount(undefined)} className=\"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm\">Desativar</button>\n              )}\n              <button onClick={() => setFavoriteMount(hero.favoriteMountId===m.id?undefined:m.id)} className=\"px-3 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm\">{hero.favoriteMountId===m.id?'Remover Favorita':'Favoritar '}</button>\n              <button onClick={() => setCompareAId(m.id)} className=\"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm\">Comparar A</button>\n              <button onClick={() => setCompareBId(m.id)} className=\"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm\">Comparar B</button>\n              <button onClick={() => (useHeroStore.getState() as any).toggleFavoriteMount(m.id)} className=\"px-3 py-1 rounded bg-amber-700 hover:bg-amber-800 text-white text-sm\">{(hero.favoriteMountIds||[]).includes(m.id)?'Desafixar ':'Fixar '}</button>\n              <button onClick={() => (useHeroStore.getState() as any).toggleLockMount(m.id)} className=\"px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm\">{m.locked?'Destravar ':'Travar '}</button>\n              <button onClick={() => setDetailId(m.id)} className=\"px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm\">Detalhes</button>\n              <button disabled={!canEvolve} title={canEvolve?`Consome  x1${needsEssence?' +  x1':''} e ${m.stage==='comum'?200:700} ouro`:''} onClick={() => { if (canEvolve) { const ok = window.confirm(`Confirmar evoluo de ${m.name}? Custos:  x1${needsEssence?' +  x1':''} e ${m.stage==='comum'?200:700} ouro.`); if (ok) evolveMountForSelected(m.id); } }} className={`px-3 py-1 rounded ${canEvolve?'bg-purple-600 hover:bg-purple-700':'bg-gray-700'} text-white text-sm`}>Evoluir</button>\n              {isActive && (\n                <button onClick={() => (useHeroStore.getState() as any).trainMountForSelected()} className=\"px-3 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-sm\">Treinar</button>\n              )}\n              <button onClick={() => { const newName = window.prompt('Novo nome para a montaria', m.name) || ''; if (newName.trim()) (useHeroStore.getState() as any).renameMountForSelected(m.id, newName.trim()) }} className=\"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm\">Renomear</button>\n              <button disabled={!canRefineAny || isMaxRefine} title={isMaxRefine?'Refino mximo atingido':(canRefineAny?'Consome  Pedra Mgica ou  Essncia de Vnculo':'') } onClick={() => { if (canRefineAny && !isMaxRefine) { const ok = window.confirm(`Tentar refinar ${m.name}? Consome 1 material e pode falhar.`); if (ok) refineCompanion(hero.id, 'mount', m.id); } }} className={`px-3 py-1 rounded ${(!canRefineAny || isMaxRefine)?'bg-gray-700':'bg-violet-600 hover:bg-violet-700'} text-white text-sm`}>{isMaxRefine?'Refino Mx.':'Refinar'}</button>\n              {!canRefineAny && !isMaxRefine && (\n                <>\n                  <button\n                    onClick={() => {\n                      const ok = window.confirm('Comprar  Pedra Mgica?');\n                      if (!ok) return;\n                      const success = buyItem(hero.id, 'pedra-magica')\n                      if (success) notificationBus.emit({ type: 'item', title: 'Material comprado', message: ' +1 adicionada ao inventrio.', duration: 3000, icon: '' })\n                      else notificationBus.emit({ type: 'gold', title: 'Compra falhou', message: 'Verifique seu saldo.', duration: 3000 })\n                    }} className=\"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white\">Comprar </button>\n                  <button\n                    onClick={() => {\n                      const ok = window.confirm('Comprar  Essncia de Vnculo?');\n                      if (!ok) return;\n                      const success = buyItem(hero.id, 'essencia-vinculo')\n                      if (success) notificationBus.emit({ type: 'item', title: 'Material comprado', message: ' +1 adicionada ao inventrio.', duration: 3000, icon: '' })\n                      else notificationBus.emit({ type: 'gold', title: 'Compra falhou', message: 'Verifique seu saldo.', duration: 3000 })\n                    }} className=\"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white\">Comprar </button>\n                </>\n              )}\n              {!isMaxRefine && <span className=\"text-[11px] text-gray-400 self-center\">Chance ~{refineChance}%</span>}\n            </div>\n            {!canEvolve && (\n              <div className=\"text-xs text-gray-400 flex items-center gap-2\">Requisitos:  x1 {needsEssence && '   x1'}  Ouro {(m.stage==='comum')?200:700}\n                <button\n                  disabled={(inventory['pergaminho-montaria']||0)>0}\n                  onClick={() => {\n                    const ok = window.confirm('Comprar  Pergaminho de Montaria?');\n                    if (!ok) return;\n                    const success = buyItem(hero.id, 'pergaminho-montaria')\n                    if (success) notificationBus.emit({ type: 'item', title: 'Pergaminho comprado', message: ' +1 adicionado ao inventrio.', duration: 3000, icon: '' })\n                    else notificationBus.emit({ type: 'gold', title: 'Compra falhou', message: 'Verifique seu saldo.', duration: 3000 })\n                  }} className={`px-2 py-1 rounded ${((inventory['pergaminho-montaria']||0)>0)?'bg-gray-700':'bg-emerald-700 hover:bg-emerald-800'} text-white`}>Comprar </button>\n                {needsEssence && (\n                  <button\n                    disabled={(inventory['essencia-bestial']||0)>0}\n                    onClick={() => {\n                      const ok = window.confirm('Comprar  Essncia Bestial?');\n                      if (!ok) return;\n                      const success = buyItem(hero.id, 'essencia-bestial')\n                      if (success) notificationBus.emit({ type: 'item', title: 'Essncia comprada', message: ' +1 adicionada ao inventrio.', duration: 3000, icon: '' })\n                      else notificationBus.emit({ type: 'gold', title: 'Compra falhou', message: 'Verifique seu saldo.', duration: 3000 })\n                    }} className={`px-2 py-1 rounded ${((inventory['essencia-bestial']||0)>0)?'bg-gray-700':'bg-emerald-700 hover:bg-emerald-800'} text-white`}>Comprar </button>\n                )}\n              </div>\n            )}\n          </div>\n        )})}\n      </div>\n      {detailId && (() => {\n        const m = mounts.find(mm => mm.id === detailId)\n        if (!m) return null\n        return (\n          <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-50\">\n            <div className=\"bg-slate-900 border border-slate-700 rounded-lg p-4 w-[90%] max-w-2xl\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <div className=\"text-white font-semibold\">{typeIcon[m.type]} {m.name}</div>\n                <button onClick={() => setDetailId(undefined)} className=\"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-xs\">Fechar</button>\n              </div>\n              <div className=\"text-xs text-gray-300 mb-2\">Tipo {m.type}  {m.stage}  {m.rarity}</div>\n              <div className=\"grid grid-cols-2 gap-2 mb-3\">\n                <div className=\"text-sm text-gray-200\">Velocidade: +{m.speedBonus}</div>\n                <div className=\"text-sm text-gray-200\">Maestria: {Math.max(0,m.mastery||0)}</div>\n                <div className=\"text-sm text-gray-200\">Estado: {m.locked?' Travada':' Destravada'}</div>\n                {m.attributes && (\n                  <div className=\"col-span-2 text-xs text-gray-300\">Bnus: {Object.entries(m.attributes).map(([k,v]) => `${k}+${v}`).join(', ')}</div>\n                )}\n              </div>\n              <div className=\"mb-3\">\n                <div className=\"text-xs text-gray-400 mb-1\">Histrico</div>\n                <div className=\"max-h-40 overflow-auto text-[11px] text-gray-400 bg-slate-800 border border-slate-700 rounded p-2\">\n                  {(m.history||[]).map((h,i) => (\n                    <div key={i}>{new Date(h.ts).toLocaleString()}  {h.action}{h.details?` ${h.details}`:''}</div>\n                  ))}\n                </div>\n              </div>\n              <div className=\"mb-3\">\n                <div className=\"text-xs text-gray-400 mb-1\">Notas</div>\n                <div className=\"flex gap-2\">\n                  <input defaultValue={m.note||''} id=\"mount-note-input\" className=\"flex-1 bg-slate-800 border border-slate-700 rounded px-2 py-1 text-xs text-gray-200\" />\n                  <button onClick={() => { const el = document.getElementById('mount-note-input') as HTMLInputElement; const val = el?.value || ''; (useHeroStore.getState() as any).setMountNoteForSelected(m.id, val); }} className=\"px-3 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-sm\">Salvar nota</button>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <button onClick={() => setFavoriteMount(hero.favoriteMountId===m.id?undefined:m.id)} className=\"px-3 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm\">{hero.favoriteMountId===m.id?'Remover Favorita':'Favoritar '}</button>\n                <button onClick={() => { const newName = window.prompt('Novo nome para a montaria', m.name) || ''; if (newName.trim()) (useHeroStore.getState() as any).renameMountForSelected(m.id, newName.trim()) }} className=\"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm\">Renomear</button>\n                <button onClick={() => (useHeroStore.getState() as any).toggleLockMount(m.id)} className=\"px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm\">{m.locked?'Destravar ':'Travar '}</button>\n                <button onClick={() => { const ok = window.confirm(`Liberar ${m.name}?`); if (ok) { (useHeroStore.getState() as any).removeMountForSelected(m.id); setDetailId(undefined); } }} className=\"px-3 py-1 rounded bg-red-700 hover:bg-red-800 text-white text-sm\">Liberar</button>\n              </div>\n            </div>\n          </div>\n        )\n      })()}\n    </div>\n  )\n}\n\nexport default MountsPanel","/**\n * Dirio do Heri - Hero Journal\n * Exibe o histrico de decises e narrativa do heri\n */\n\nimport React, { useState } from 'react';\nimport { getAltharionLore } from '../utils/story';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Hero, DecisionLogEntry } from '../types/hero';\nimport { getReputationLevel, getReputationDescription } from '../utils/reputationSystem';\n\ninterface HeroJournalProps {\n  hero: Hero;\n}\n\nexport const HeroJournal: React.FC<HeroJournalProps> = ({ hero }) => {\n  const [selectedEntry, setSelectedEntry] = useState<DecisionLogEntry | null>(null);\n  const [filterType, setFilterType] = useState<'all' | 'success' | 'failure'>('all');\n\n  const decisionLog = hero.worldState?.decisionLog || [];\n  \n  const filteredEntries = decisionLog.filter(entry => {\n    if (filterType === 'all') return true;\n    return entry.rollResult?.success === (filterType === 'success');\n  }).sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n\n  const formatDate = (timestamp: string) => {\n    return new Date(timestamp).toLocaleDateString('pt-BR', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getImpactSummary = (entry: DecisionLogEntry) => {\n    const impacts: string[] = [];\n    \n    if (entry.impact.immediate.gold) {\n      impacts.push(`${entry.impact.immediate.gold > 0 ? '+' : ''}${entry.impact.immediate.gold} ouro`);\n    }\n    \n    if (entry.impact.immediate.xp) {\n      impacts.push(`+${entry.impact.immediate.xp} XP`);\n    }\n    \n    if (entry.impact.immediate.reputation) {\n      Object.entries(entry.impact.immediate.reputation).forEach(([faction, value]) => {\n        impacts.push(`${faction}: ${value > 0 ? '+' : ''}${value}`);\n      });\n    }\n    \n    if (entry.impact.immediate.items) {\n      impacts.push(`${entry.impact.immediate.items.length} item(s)`);\n    }\n    \n    return impacts.join(', ') || 'Sem impactos imediatos';\n  };\n\n  const getReputationSummary = () => {\n    if (!hero.worldState?.factions) return [];\n\n    return Object.entries(hero.worldState.factions)\n      .filter(([_, data]) => Math.abs(data.reputation) > 5)\n      .sort(([_, a], [__, b]) => b.reputation - a.reputation)\n      .map(([name, data]) => {\n        const level = getReputationLevel(data.reputation);\n        const displayName = name.charAt(0).toUpperCase() + name.slice(1);\n        return {\n          name: displayName,\n          reputation: data.reputation,\n          status: level.name,\n          description: getReputationDescription(data.reputation),\n          color: level.color\n        };\n      });\n  };\n\n  const reputationSummary = getReputationSummary();\n  const worldTopics = getAltharionLore('topics');\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"bg-gray-800 rounded-lg p-6\">\n        <h2 className=\"text-2xl font-bold text-white mb-4\">Dirio de {hero.name}</h2>\n        \n        {/* Estatsticas Gerais */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n          <div className=\"bg-gray-700 rounded p-3\">\n            <div className=\"text-gray-400 text-sm\">Decises Tomadas</div>\n            <div className=\"text-2xl font-bold text-white\">{decisionLog.length}</div>\n          </div>\n          <div className=\"bg-gray-700 rounded p-3\">\n            <div className=\"text-gray-400 text-sm\">Taxa de Sucesso</div>\n            <div className=\"text-2xl font-bold text-green-400\">\n              {decisionLog.length > 0 \n                ? Math.round((decisionLog.filter(e => e.rollResult?.success).length / decisionLog.length) * 100)\n                : 0}%\n            </div>\n          </div>\n          <div className=\"bg-gray-700 rounded p-3\">\n            <div className=\"text-gray-400 text-sm\">Fadiga Atual</div>\n            <div className=\"text-2xl font-bold text-amber-400\">\n              {Math.max(0, Number(hero.progression?.fatigue || 0))}/100\n            </div>\n          </div>\n        </div>\n\n        {/* Filtros */}\n        <div className=\"flex space-x-2\">\n          {(['all', 'success', 'failure'] as const).map((filter) => (\n            <button\n              key={filter}\n              onClick={() => setFilterType(filter)}\n              className={`px-4 py-2 rounded transition-colors ${\n                filterType === filter\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-gray-700 text-gray-300 hover:bg-gray-600'\n              }`}\n            >\n              {filter === 'all' ? 'Todas' : filter === 'success' ? 'Sucessos' : 'Falhas'}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Reputao com Faces */}\n      {reputationSummary.length > 0 && (\n        <div className=\"bg-gray-800 rounded-lg p-6\">\n          <h3 className=\"text-xl font-bold text-white mb-4\">Reputao</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n            {reputationSummary.map(({ name, reputation, status, description, color }) => (\n              <div key={name} className=\"flex justify-between items-center bg-gray-700 rounded p-3\">\n                <div>\n                  <div className=\"text-white font-semibold\">{name}</div>\n                  <div className={`text-sm ${color}`} title={description}>\n                    {status}\n                  </div>\n                </div>\n                <div className={`text-lg font-bold ${\n                  reputation > 0 ? 'text-green-400' : reputation < 0 ? 'text-red-400' : 'text-gray-400'\n                }`}>\n                  {reputation > 0 ? '+' : ''}{reputation}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Histria do Mundo */}\n      <div className=\"bg-gray-800 rounded-lg p-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"text-xl font-bold text-white\">Histria do Mundo</h3>\n          <span className=\"text-xs text-gray-400\">Wiki</span>\n        </div>\n        <div className=\"space-y-4\">\n          {worldTopics.sections.map((sec: any) => (\n            <div key={sec.id} className=\"rounded border border-white/10 bg-white/5 p-4\">\n              <div className=\"text-white font-semibold mb-2\">{sec.title}</div>\n              <ul className=\"list-disc ml-5 text-sm text-gray-200 space-y-1\">\n                {sec.bullets.map((b: string, i: number) => (\n                  <li key={i}>{b}</li>\n                ))}\n              </ul>\n            </div>\n          ))}\n        </div>\n        <div className=\"mt-3 text-xs text-gray-400\">Base: Forjador de Heris  Altharion</div>\n      </div>\n\n      {/* Timeline de Decises */}\n      <div className=\"bg-gray-800 rounded-lg p-6\">\n        <h3 className=\"text-xl font-bold text-white mb-4\">Histrico de Decises</h3>\n        \n        {filteredEntries.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <div className=\"text-gray-400 text-lg\">Nenhuma deciso registrada ainda</div>\n            <div className=\"text-gray-500 text-sm mt-2\">\n              Complete misses e eventos para comear a construir sua histria\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {filteredEntries.map((entry, index) => (\n              <motion.div\n                key={entry.id}\n                initial={{ opacity: 0, x: -20 }}\n                animate={{ opacity: 1, x: 0 }}\n                transition={{ delay: index * 0.1 }}\n                className={`border-l-4 pl-4 py-3 cursor-pointer transition-all ${\n                  entry.rollResult?.success \n                    ? 'border-green-500 bg-green-900/20 hover:bg-green-900/30' \n                    : 'border-red-500 bg-red-900/20 hover:bg-red-900/30'\n                }`}\n                onClick={() => setSelectedEntry(entry)}\n              >\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-2\">\n                      <span className={`text-lg ${entry.rollResult?.success ? '' : ''}`}>\n                        {entry.rollResult?.success ? '' : ''}\n                      </span>\n                      <span className=\"text-white font-semibold\">{entry.choiceText}</span>\n                    </div>\n                    <div className=\"text-gray-400 text-sm mt-1\">\n                      {formatDate(entry.timestamp)}\n                    </div>\n                    <div className=\"text-gray-300 text-sm mt-1\">\n                      {getImpactSummary(entry)}\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"text-sm text-gray-400\">\n                      Roll: {entry.rollResult?.roll} + {entry.rollResult?.modifiers} = {entry.rollResult?.roll + entry.rollResult?.modifiers}\n                    </div>\n                    <div className=\"text-sm text-gray-500\">\n                      vs {entry.rollResult?.threshold}\n                    </div>\n                  </div>\n                </div>\n              </motion.div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Modal de Detalhes da Deciso */}\n      <AnimatePresence>\n        {selectedEntry && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\"\n            onClick={() => setSelectedEntry(null)}\n          >\n            <motion.div\n              initial={{ scale: 0.9, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.9, opacity: 0 }}\n              className=\"bg-gray-800 rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <div className=\"flex justify-between items-start mb-4\">\n                <h3 className=\"text-xl font-bold text-white\">Detalhes da Deciso</h3>\n                <button\n                  onClick={() => setSelectedEntry(null)}\n                  className=\"text-gray-400 hover:text-white text-2xl\"\n                >\n                  \n                </button>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <div>\n                  <div className=\"text-gray-400 text-sm\">Escolha</div>\n                  <div className=\"text-white font-semibold\">{selectedEntry.choiceText}</div>\n                </div>\n                \n                <div>\n                  <div className=\"text-gray-400 text-sm\">Data</div>\n                  <div className=\"text-white\">{formatDate(selectedEntry.timestamp)}</div>\n                </div>\n                \n                <div>\n                  <div className=\"text-gray-400 text-sm\">Resultado do Roll</div>\n                  <div className={`text-lg font-bold ${selectedEntry.rollResult?.success ? 'text-green-400' : 'text-red-400'}`}>\n                    {selectedEntry.rollResult?.success ? 'Sucesso' : 'Falha'}\n                  </div>\n                  <div className=\"text-gray-300 text-sm\">\n                    Roll: {selectedEntry.rollResult?.roll} + Modificadores: {selectedEntry.rollResult?.modifiers} = {selectedEntry.rollResult?.roll + selectedEntry.rollResult?.modifiers} vs {selectedEntry.rollResult?.threshold}\n                  </div>\n                </div>\n                \n                {/* Impactos Imediatos */}\n                {Object.keys(selectedEntry.impact.immediate).length > 0 && (\n                  <div>\n                    <div className=\"text-gray-400 text-sm mb-2\">Impactos Imediatos</div>\n                    <div className=\"bg-gray-700 rounded p-3 space-y-1\">\n                      {selectedEntry.impact.immediate.gold && (\n                        <div className=\"text-yellow-400\">\n                          Ouro: {selectedEntry.impact.immediate.gold > 0 ? '+' : ''}{selectedEntry.impact.immediate.gold}\n                        </div>\n                      )}\n                      {selectedEntry.impact.immediate.xp && (\n                        <div className=\"text-blue-400\">\n                          XP: +{selectedEntry.impact.immediate.xp}\n                        </div>\n                      )}\n                      {selectedEntry.impact.immediate.reputation && Object.entries(selectedEntry.impact.immediate.reputation).map(([faction, value]) => (\n                        <div key={faction} className=\"text-purple-400\">\n                          {faction}: {value > 0 ? '+' : ''}{value}\n                        </div>\n                      ))}\n                      {selectedEntry.impact.immediate.items && (\n                        <div className=\"text-green-400\">\n                          Itens: {selectedEntry.impact.immediate.items.join(', ')}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n                \n                {/* Impactos de Longo Prazo */}\n                {Object.keys(selectedEntry.impact.longTerm).length > 0 && (\n                  <div>\n                    <div className=\"text-gray-400 text-sm mb-2\">Impactos de Longo Prazo</div>\n                    <div className=\"bg-gray-700 rounded p-3 space-y-1\">\n                      {selectedEntry.impact.longTerm.npcRelations && Object.entries(selectedEntry.impact.longTerm.npcRelations).map(([npc, value]) => (\n                        <div key={npc} className=\"text-cyan-400\">\n                          {npc}: {value > 0 ? '+' : ''}{value} relao\n                        </div>\n                      ))}\n                      {selectedEntry.impact.longTerm.worldEvents && (\n                        <div className=\"text-orange-400\">\n                          Eventos: {selectedEntry.impact.longTerm.worldEvents.join(', ')}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n","export interface MissionChoice {\n  key: 'A' | 'B' | 'C';\n  text: string;\n  success: number; // 0..1\n}\n\nexport interface Mission {\n  id: string;\n  description: string;\n  objective: string;\n  location: string;\n  challenge: string;\n  difficulty: 'easy' | 'normal' | 'hard';\n  choices: MissionChoice[];\n}\n\nexport interface MissionGenerateRequest {\n  hero: any;\n  context?: any;\n}\n\nexport interface MissionGenerateResponse {\n  mission: Mission;\n}\n\nexport interface MissionResolveRequest {\n  mission: Mission;\n  choice: 'A' | 'B' | 'C';\n  hero: any;\n}\n\nexport interface MissionResolveResult {\n  success: boolean;\n  xp: number;\n  title: string;\n  loot: string;\n  narrative: string;\n  roll: number;\n  prob: number;\n}\n\nfunction clampProb(p: number) {\n  return Math.max(0.05, Math.min(0.95, p));\n}\n\nfunction pickDifficulty(level: number): 'easy' | 'normal' | 'hard' {\n  if (level >= 7) return 'hard';\n  if (level >= 4) return 'normal';\n  return 'easy';\n}\n\nfunction defaultMissionFromHero(hero: any): Mission {\n  const name = hero?.name || 'Heri';\n  const klass = hero?.class || hero?.klass || 'Aventureiro';\n  const level = Number(hero?.level || hero?.progression?.level || 1) || 1;\n  const difficulty = pickDifficulty(level);\n  const objective = 'Recuperar um artefato antigo perdido';\n  const location = 'Runas de Valthor';\n  const challenge = 'Guardio espectral e armadilhas antigas';\n  const attrs = hero?.attributes || {};\n  const diffPenalty = difficulty === 'easy' ? 0 : difficulty === 'normal' ? 0.10 : 0.20;\n  const probA = clampProb(0.30 + ((Number(attrs.sabedoria) || 0) * 0.05) - diffPenalty);\n  const probB = clampProb(0.30 + ((Number(attrs.forca) || 0) * 0.05) - diffPenalty);\n  const probC = clampProb(0.30 + ((Number(attrs.destreza) || 0) * 0.05) - diffPenalty);\n  return {\n    id: `m-${Date.now()}`,\n    description: `${name}  ${klass}  Nvel ${level}. Objetivo: ${objective}. Local: ${location}. Desafio: ${challenge}.`,\n    objective,\n    location,\n    challenge,\n    difficulty,\n    choices: [\n      { key: 'A', text: 'Investigar rotas alternativas com cautela', success: probA },\n      { key: 'B', text: 'Confrontar o guardio diretamente', success: probB },\n      { key: 'C', text: 'Usar astcia para distrair e infiltrar-se', success: probC }\n    ]\n  };\n}\n\nfunction resolveOutcomeLocal(mission: Mission, choiceKey: 'A' | 'B' | 'C', hero: any): MissionResolveResult {\n  const level = Number(hero?.level || hero?.progression?.level || 1) || 1;\n  const choice = (mission?.choices || []).find(c => c.key === choiceKey);\n  const prob = choice ? Number(choice.success) : 0.5;\n  const roll = Math.random();\n  const success = roll <= prob;\n  const difficulty = mission?.difficulty || pickDifficulty(level);\n  const baseByDiff = difficulty === 'easy' ? 12 : difficulty === 'normal' ? 20 : 26;\n  const baseWithLevel = baseByDiff + Math.min(10, Math.floor(level / 2));\n  const xpRaw = success ? Math.round(baseWithLevel * 1.6) : Math.round(baseWithLevel * 0.6);\n  const xp = Math.max(10, Math.min(50, xpRaw));\n  const lootChance = success ? 0.35 : 0.1;\n  const titleChance = success ? 0.2 : 0.05;\n  const gotLoot = Math.random() < lootChance;\n  const gotTitle = Math.random() < titleChance;\n  const loot = gotLoot ? 'Relquia menor das Runas' : '';\n  const title = gotTitle ? (difficulty === 'hard' ? 'Quebrador de Guardies' : 'Eco das Runas') : '';\n  const outcomeTextSuccess = `Com determinao e ${choice?.text?.toLowerCase() || 'ttica cuidadosa'}, o heri supera o desafio em ${mission?.location}. O artefato  recuperado e o caminho fica marcado por passos seguros.`;\n  const outcomeTextFail = `A abordagem ${choice?.text?.toLowerCase() || 'arrisca'} sai do controle. O guardio repele o avano e o heri recua, aprendendo com cada ferida e armadilha ativada.`;\n  return {\n    success,\n    xp,\n    title,\n    loot,\n    narrative: success ? outcomeTextSuccess : outcomeTextFail,\n    roll,\n    prob\n  };\n}\n\nexport async function generateMission(req: MissionGenerateRequest): Promise<Mission> {\n  let res = await fetch('/api/mission/generate', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(req)\n  });\n  if (!res.ok) {\n    // Fallback para funo serverless\n    const text1 = await res.text();\n    if (res.status === 404) {\n      res = await fetch('/api/mission-generate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(req)\n      });\n    }\n    if (!res.ok) {\n      // ltimo fallback: gerar misso localmente para no bloquear o fluxo\n      try {\n        return defaultMissionFromHero(req.hero);\n      } catch {\n        const text2 = await res.text().catch(() => '');\n        throw new Error(`Falha ao gerar misso: ${res.status} ${(text2 || text1 || '').slice(0,200)}`);\n      }\n    }\n  }\n  const data: MissionGenerateResponse = await res.json();\n  return data.mission;\n}\n\nexport async function resolveMission(req: MissionResolveRequest): Promise<MissionResolveResult> {\n  let res = await fetch('/api/mission/resolve', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(req)\n  });\n  if (!res.ok) {\n    const text1 = await res.text();\n    if (res.status === 404) {\n      res = await fetch('/api/mission-resolve', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(req)\n      });\n    }\n    if (!res.ok) {\n      // Fallback local: resolve sem servidor\n      try {\n        return resolveOutcomeLocal(req.mission, req.choice, req.hero);\n      } catch {\n        const text2 = await res.text().catch(() => '');\n        throw new Error(`Falha ao resolver misso: ${res.status} ${(text2 || text1 || '').slice(0,200)}`);\n      }\n    }\n  }\n  const data = await res.json();\n  // Express: { result } | Serverless: direct object\n  return (data.result || data) as MissionResolveResult;\n}\n","import { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { generateMission, resolveMission, Mission } from '../services/missionService';\nimport { notificationBus } from './NotificationSystem';\nimport { playSuccess, playFailure, playLevelUp, resumeAudioContextIfNeeded } from '../utils/audioEffects';\nimport { logActivity } from '../utils/activitySystem';\n\nexport default function QuickMission({ autoStart = false, compact = false }: { autoStart?: boolean; compact?: boolean } = {}) {\n  const selectedHeroId = useHeroStore(s => s.selectedHeroId);\n  const heroes = useHeroStore(s => s.heroes);\n  const gainXP = useHeroStore(s => s.gainXP);\n  const hero = useMemo(() => heroes.find(h => h.id === selectedHeroId), [heroes, selectedHeroId]);\n  const [loading, setLoading] = useState(false);\n  const [mission, setMission] = useState<Mission | null>(null);\n  const [result, setResult] = useState<any>(null);\n  const [error, setError] = useState<string>('');\n  const [levelUp, setLevelUp] = useState<number | null>(null);\n\n  function xpForLevel(level: number) {\n    // espelha lgica do store: level*100 + (level-1)*50\n    return level * 100 + (level - 1) * 50;\n  }\n\n  useEffect(() => {\n    if (levelUp) {\n      const t = setTimeout(() => setLevelUp(null), 1800);\n      return () => clearTimeout(t);\n    }\n  }, [levelUp]);\n\n  // Auto iniciar gerao de misso em modo simples\n  useEffect(() => {\n    if (autoStart && hero && !mission && !loading) {\n      handleGenerate();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autoStart, hero?.id]);\n\n  async function handleGenerate() {\n    if (!hero) return;\n    resumeAudioContextIfNeeded();\n    setLoading(true);\n    setError('');\n    setResult(null);\n    try {\n      const m = await generateMission({ hero: { name: hero.name, class: hero.class, level: hero.progression.level, attributes: hero.attributes } });\n      setMission(m);\n      // Toast de misso gerada\n      notificationBus.emit({\n        type: 'quest',\n        title: 'Misso gerada',\n        message: `${m.objective || 'Objetivo desconhecido'}  Dificuldade: ${m.difficulty}`,\n        duration: 3200\n      });\n    } catch (err: any) {\n      setError(err?.message || 'Falha ao gerar misso');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleChoice(key: 'A' | 'B' | 'C') {\n    if (!hero || !mission) return;\n    resumeAudioContextIfNeeded();\n    setLoading(true);\n    setError('');\n    try {\n      const prevLevel = hero.progression.level;\n      const r = await resolveMission({ mission, choice: key, hero: { level: hero.progression.level } });\n      setResult(r);\n      // Toast de resultado\n      notificationBus.emit({\n        type: 'quest',\n        title: r.success ? 'Misso concluda' : 'Misso falhou',\n        message: mission.objective || mission.description,\n        icon: r.success ? '' : '',\n        duration: 3500\n      });\n      // udio\n      if (r.success) {\n        playSuccess();\n      } else {\n        playFailure();\n      }\n      // Aplicar XP imediatamente para simplificar o MVP\n      if (r?.xp) {\n        gainXP(hero.id, r.xp);\n        // Toast de XP\n        notificationBus.emit({\n          type: 'xp',\n          title: 'XP Ganho!',\n          message: 'Misso rpida',\n          value: r.xp,\n          duration: 2800\n        });\n        const updatedHero = heroes.find(h => h.id === hero.id);\n        if (updatedHero && updatedHero.progression.level > prevLevel) {\n          setLevelUp(updatedHero.progression.level);\n          playLevelUp();\n          // Log de level up\n          logActivity.levelUp({\n            heroId: updatedHero.id,\n            heroName: updatedHero.name,\n            heroClass: updatedHero.class,\n            heroLevel: updatedHero.progression.level\n          });\n        }\n        // Log de misso concluda\n        if (r.success) {\n          logActivity.questCompleted({\n            heroId: hero.id,\n            heroName: hero.name,\n            heroClass: hero.class,\n            heroLevel: hero.progression.level,\n            questName: mission.objective || mission.description,\n            questDifficulty: mission.difficulty,\n            xpGained: r.xp\n          });\n        }\n      }\n      // Ttulo conquistado\n      if (r.title) {\n        notificationBus.emit({\n          type: 'achievement',\n          title: 'Ttulo conquistado!',\n          message: r.title,\n          icon: '',\n          duration: 4200\n        });\n        logActivity.titleEarned({\n          heroId: hero.id,\n          heroName: hero.name,\n          heroClass: hero.class,\n          heroLevel: hero.progression.level,\n          titleEarned: r.title\n        });\n      }\n    } catch (err: any) {\n      setError(err?.message || 'Falha ao resolver misso');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (!hero) {\n    return (\n      <div className=\"max-w-3xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Selecione um heri</h2>\n        <p className=\"text-gray-600\">Escolha um heri para jogar uma misso rpida.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-3xl mx-auto p-6\">\n      {!compact && (\n        <>\n          <h2 className=\"text-2xl font-bold text-white\">Misso Rpida</h2>\n          <p className=\"text-gray-300\">Heri: {hero.name} (Nvel {hero.progression.level})   Estrelas: {hero.progression.stars || 0}</p>\n          {hero.activeTitle && (\n            <p className=\"text-sm text-gray-400 mt-1\">Ttulo ativo: <span className=\"font-medium\">{hero.activeTitle}</span></p>\n          )}\n        </>\n      )}\n      <div className=\"mt-2\">\n        {(() => {\n          const currentLevel = hero.progression.level;\n          const xpTotal = hero.progression.xp;\n          const xpCurBase = xpForLevel(currentLevel);\n          const xpNextBase = xpForLevel(currentLevel + 1);\n          const xpIntoLevel = Math.max(0, xpTotal - xpCurBase);\n          const xpNeeded = Math.max(1, xpNextBase - xpCurBase);\n          const pct = Math.min(100, Math.max(0, Math.round((xpIntoLevel / xpNeeded) * 100)));\n          return (\n            <div>\n              <div className=\"text-sm text-gray-300\">XP atual: {xpIntoLevel} / {xpNeeded} ({pct}%)</div>\n              <div className=\"w-full h-2 bg-gray-700 rounded mt-1\">\n                <div className=\"h-2 bg-green-500 rounded\" style={{ width: `${pct}%` }} />\n              </div>\n            </div>\n          );\n        })()}\n      </div>\n\n      {!compact && (\n        <div className=\"mt-4\">\n          <button\n            onClick={handleGenerate}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50\"\n            disabled={loading}\n          >\n            {loading ? 'Gerando...' : mission ? 'Gerar outra misso' : 'Gerar misso'}\n          </button>\n        </div>\n      )}\n\n      {error && (\n        <div className=\"mt-4 p-3 bg-red-50 text-red-700 rounded\">{error}</div>\n      )}\n\n      {mission && (\n        <div className=\"mt-6 p-4 border rounded bg-gray-800 border-gray-700 shadow-sm\">\n          <h3 className=\"text-xl font-semibold text-white\">Descrio</h3>\n          <p className=\"mt-2 text-gray-200\">{mission.description}</p>\n          <div className=\"mt-3 text-sm text-gray-300\">Dificuldade: <span className=\"font-medium\">{mission.difficulty}</span></div>\n\n          <h4 className=\"mt-4 font-semibold\">Escolhas</h4>\n          <div className=\"mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2\">\n            {mission.choices.map(ch => (\n              <button\n                key={ch.key}\n                onClick={() => handleChoice(ch.key as any)}\n                className=\"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600\"\n                disabled={loading || !!result}\n              >\n                <div className=\"font-medium text-white\">{ch.key}</div>\n                <div className=\"text-sm text-gray-200\">{ch.text}</div>\n                <div className=\"text-xs text-gray-300\">Sucesso ~{Math.round(ch.success * 100)}%</div>\n              </button>\n            ))}\n          </div>\n\n          {result && (\n            <div className=\"mt-4 p-3 bg-gray-700 rounded\">\n              <div className=\"text-lg font-semibold text-white\">Resultado: {result.success ? 'Sucesso' : 'Falha'}</div>\n              <p className=\"mt-1 text-gray-200\">{result.narrative}</p>\n              <div className=\"mt-2 text-sm text-gray-200\">XP ganho: <span className=\"font-medium\">{result.xp}</span></div>\n              {(result.title || result.loot) && (\n                <div className=\"mt-1 text-sm text-gray-300\">{result.title ? `Ttulo: ${result.title}` : ''} {result.loot ? `Loot: ${result.loot}` : ''}</div>\n              )}\n              <div className=\"mt-2 text-xs text-gray-300\">Roll: {result.roll?.toFixed(2)}  Prob: {Math.round((result.prob || 0) * 100)}%</div>\n              <div className=\"mt-3\">\n                <button onClick={() => { setMission(null); setResult(null); }} className=\"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700\">Nova misso</button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {levelUp && (\n        <div className=\"fixed inset-0 pointer-events-none flex items-center justify-center z-50\">\n          <div className=\"bg-black bg-opacity-50 absolute inset-0\" />\n          <div className=\"relative z-10 text-center p-6 rounded-xl bg-gray-800 shadow-xl border border-gray-700\">\n            <div className=\"text-5xl mb-2\"></div>\n            <div className=\"text-xl font-bold text-white\">Nvel {levelUp} alcanado!</div>\n            <div className=\"text-sm text-gray-300\">\n              +1  Estrela  Novo ttulo: {hero.activeTitle || ''}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import React from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport DialogueFrame from './DialogueFrame';\n\nconst NarrativeChapters: React.FC = () => {\n  const { getSelectedHero } = useHeroStore();\n  const hero = getSelectedHero();\n  const chapters = hero?.journeyChapters || [];\n  const nextMilestone = [4,8,12,16,20].find(m => (hero?.progression.level ?? 1) < m);\n\n  if (!hero) {\n    return null;\n  }\n\n  return (\n    <div className=\"mt-8 rounded-xl p-6 bg-white/5 border border-white/10\">\n      <div className=\"flex items-center gap-2 mb-3\">\n        <span className=\"text-xl\"></span>\n        <h3 className=\"text-lg font-bold\">Captulos da Jornada</h3>\n      </div>\n      <ul className=\"space-y-3\">\n        {chapters.map((c) => (\n          <li key={c.id} className=\"text-sm text-gray-200\">\n            <DialogueFrame>\n              <div className=\"font-semibold text-white mb-1\">{c.title}</div>\n              <div className=\"text-gray-300\">{c.summary}</div>\n              <div className=\"text-xs text-gray-400 mt-1\">Criado em {new Date(c.createdAt).toLocaleString()}  Nvel {c.levelMilestone}</div>\n            </DialogueFrame>\n          </li>\n        ))}\n      </ul>\n      {chapters.length === 0 && (\n        <div className=\"text-sm text-gray-400\">Ainda sem captulos. Eles so gerados automaticamente a cada 4 nveis.</div>\n      )}\n      {nextMilestone && (\n        <div className=\"mt-3 text-xs text-gray-400\">Prximo captulo em nvel {nextMilestone}.</div>\n      )}\n    </div>\n  );\n};\n\nexport default NarrativeChapters;\n","import React, { useMemo, useEffect, useState, useRef } from 'react';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport { useHeroStore } from '../store/heroStore';\nimport { medievalTheme, seasonalThemes, getSeasonalButtonGradient } from '../styles/medievalTheme';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport NarrativeChapters from './NarrativeChapters';\nimport { getAltharionLore } from '../utils/story';\nimport { recommendEvents } from '../services/socialEventsService';\nimport { getProfile } from '../services/userService';\nimport { getOrRunDailyResult } from '../services/idleBattleService';\nimport { supabase, supabaseConfigured } from '../lib/supabaseClient';\nimport { onboardingManager, ONBOARDING_FLOWS } from '../utils/onboardingSystem';\n\nconst StepCard: React.FC<{\n  title: string;\n  description: string;\n  icon: string;\n  ctaLabel: string;\n  to: string;\n  highlight?: boolean;\n  examples?: string[];\n  stepIndex?: number;\n  testId?: string;\n}> = ({ title, description, icon, ctaLabel, to, highlight, examples, stepIndex, testId }) => {\n  const navigate = useNavigate();\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-white/20' : 'border-white/20';\n  const shortLore = useMemo(() => getAltharionLore('short'), []);\n  return (\n    <div\n      className={`rounded-xl p-6 border transition-all duration-300 ${\n        highlight ? 'border-amber-400 bg-amber-900/10' : `${seasonalBorder} bg-white/10`\n      } hover:bg-white/15 hover:border-amber-400`}\n    >\n      <div className=\"flex items-start space-x-4\">\n        <div className=\"text-4xl\">{icon}</div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-3 mb-1\">\n            <div className=\"text-xl font-bold text-amber-300\">{title}</div>\n            {typeof stepIndex === 'number' && (\n              <span className=\"px-2 py-0.5 rounded bg-gray-800 text-gray-200 text-xs border border-white/10\">Etapa {stepIndex}</span>\n            )}\n          </div>\n          <div className=\"text-gray-300 text-sm mb-4\">{description}</div>\n          {Array.isArray(examples) && examples.length > 0 && (\n            <ul className=\"text-xs text-gray-200 mb-4 list-disc ml-4\">\n              {examples.map((e, i) => (\n                <li key={i}>{e}</li>\n              ))}\n            </ul>\n          )}\n          {(() => {\n            const g = getSeasonalButtonGradient(activeSeasonalTheme as any);\n            const accents: string[] = ((seasonalThemes as any)[activeSeasonalTheme || '']?.accents) || [];\n            return (\n              <button\n                onClick={() => navigate(to)}\n                className={`px-4 py-2 rounded-lg bg-gradient-to-r ${g} text-white font-semibold transition-all duration-200 hover:brightness-110 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 flex items-center gap-2`}\n                aria-label={ctaLabel}\n                data-testid={testId}\n              >\n                {accents[0] || ''}\n                <span>{ctaLabel}</span>\n              </button>\n            );\n          })()}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst ProgressBar: React.FC<{ percent: number; label?: string }> = ({ percent, label }) => {\n  return (\n    <div data-testid=\"journey-progress\">\n      {label && <div className=\"text-xs text-slate-400 mb-1\">{label}</div>}\n      <div className=\"w-full h-3 bg-slate-700 rounded-full overflow-hidden\" role=\"progressbar\" aria-valuenow={Math.max(0, Math.min(100, percent))} aria-valuemin={0} aria-valuemax={100}>\n        <div\n          className={`h-3 bg-gradient-to-r ${medievalTheme.gradients.buttons.success} rounded-full transition-all duration-500`}\n          style={{ width: `${Math.max(0, Math.min(100, percent))}%` }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst JourneyFlow: React.FC = () => {\n  const { getSelectedHero, heroes } = useHeroStore();\n  const hero = getSelectedHero();\n  const [daily, setDaily] = useState<any | null>(null);\n  const [submitting, setSubmitting] = useState(false);\n  const [leaderboard, setLeaderboard] = useState<any[]>([]);\n  const [progressLoading, setProgressLoading] = useState(false);\n  const [progressError, setProgressError] = useState<string | null>(null);\n  const [playerProgress, setPlayerProgress] = useState<{ missions_completed: number; achievements_unlocked: number; playtime_minutes: number; last_login?: string | null } | null>(null);\n  const [onbPct, setOnbPct] = useState<number>(0);\n  const [onbCounts, setOnbCounts] = useState<{completed:number;total:number}>({completed:0,total:0});\n  const [onbStep, setOnbStep] = useState<ReturnType<typeof onboardingManager.getCurrentStep>>(null);\n  const [prefShowHints, setPrefShowHints] = useState<boolean>(() => { try { return localStorage.getItem('hfn_show_hints') === '1'; } catch { return false; } });\n  const [prefSkipTutorials, setPrefSkipTutorials] = useState<boolean>(() => { try { return localStorage.getItem('hfn_skip_tutorials') === '1'; } catch { return false; } });\n  const [fbChoice, setFbChoice] = useState<'up'|'down'|null>(null);\n  const [fbText, setFbText] = useState('');\n  const [recommendedEvents, setRecommendedEvents] = useState<any[]>([]);\n  const [recLoading, setRecLoading] = useState(false);\n  const [trackerExpandedFlowId, setTrackerExpandedFlowId] = useState<string | null>(null);\n  const progressAbortRef = useRef<AbortController | null>(null);\n  const isMountedRef = useRef<boolean>(true);\n  const navigate = useNavigate();\n  const location = useLocation();\n  const params = new URLSearchParams(location.search);\n  const referralCode = params.get('ref') || undefined;\n  const inviterBy = params.get('by') || undefined;\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-white/20' : 'border-white/20';\n\n  // Redirecionar primeira visita para a introduo cinematogrfica\n  useEffect(() => {\n    try {\n      const seen = localStorage.getItem('introSeen');\n      if (!seen && !prefSkipTutorials) {\n        navigate('/intro');\n      }\n    } catch {}\n  }, [prefSkipTutorials]);\n\n  const xpPercent = useMemo(() => {\n    if (!hero) return 0;\n    const currentXp = hero.progression?.xp ?? 0;\n    const level = hero.progression?.level ?? 1;\n    const nextLevelXp = level * 100 + (level - 1) * 50;\n    const prevLevelXp = (level - 1) * 100 + (level - 2 >= 0 ? (level - 2) * 50 : 0);\n    const inLevelXp = Math.max(0, currentXp - prevLevelXp);\n    const levelSpan = Math.max(1, nextLevelXp - prevLevelXp);\n    return Math.round((inLevelXp / levelSpan) * 100);\n  }, [hero]);\n\n  useEffect(() => {\n    if (hero) {\n      const result = getOrRunDailyResult(hero);\n      setDaily(result);\n      // Envio automtico de resultados para ranking  modo offline: no chama API se no houver base\n      (async () => {\n        const apiBase = (import.meta as any)?.env?.VITE_API_BASE;\n        if (!apiBase) {\n          setLeaderboard([]);\n          return;\n        }\n        try {\n          setSubmitting(true);\n          await fetch(`${apiBase}/daily/submit`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ hero })\n          });\n          const resp = await fetch(`${apiBase}/daily/leaderboard`);\n          const data = await resp.json();\n          setLeaderboard(Array.isArray(data?.entries) ? data.entries : []);\n        } catch (err) {\n          // silencioso em dev sem API\n        } finally {\n          setSubmitting(false);\n        }\n      })();\n    }\n  }, [hero]);\n\n  async function submitDaily() {\n    if (!hero) return;\n    try {\n      setSubmitting(true);\n      await fetch('/api/daily/submit', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ hero })\n      });\n      const resp = await fetch('/api/daily/leaderboard');\n      const data = await resp.json();\n      setLeaderboard(Array.isArray(data?.entries) ? data.entries : []);\n    } catch (err) {\n      console.warn('Falha ao enviar resultado dirio:', err);\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  async function fetchPlayerProgress(signal?: AbortSignal) {\n    if (signal?.aborted) return;\n    if (isMountedRef.current) {\n      setProgressLoading(true);\n      setProgressError(null);\n    }\n    try {\n      if (!supabaseConfigured) {\n        if (!signal?.aborted && isMountedRef.current) {\n          setProgressError('Nuvem desativada neste ambiente.');\n          setPlayerProgress(null);\n        }\n        return;\n      }\n      const { data } = await supabase.auth.getUser();\n      const userId = data?.user?.id || null;\n      if (!userId) {\n        if (!signal?.aborted && isMountedRef.current) {\n          setProgressError('Faa login para ver seu progresso.');\n          setPlayerProgress(null);\n        }\n      } else {\n        const res = await fetch(`/api/player-progress?action=get&id=${encodeURIComponent(userId)}`, { signal });\n        const json = await res.json();\n        if (!res.ok) throw new Error(json?.error || 'Falha ao carregar progresso');\n        if (!signal?.aborted && isMountedRef.current) {\n          setPlayerProgress(json?.progress || null);\n        }\n      }\n    } catch (e: any) {\n      if (e?.name === 'AbortError') return;\n      if (!signal?.aborted && isMountedRef.current) {\n        setProgressError(e?.message || String(e));\n        setPlayerProgress(null);\n      }\n    } finally {\n      if (!signal?.aborted && isMountedRef.current) {\n        setProgressLoading(false);\n      }\n    }\n  }\n\n  useEffect(() => {\n    isMountedRef.current = true;\n    let timer: any = null;\n    const run = () => {\n      if (progressAbortRef.current) {\n        try { progressAbortRef.current.abort(); } catch {}\n      }\n      progressAbortRef.current = new AbortController();\n      fetchPlayerProgress(progressAbortRef.current.signal);\n    };\n    if (!progressLoading) {\n      run();\n      timer = setInterval(run, 5 * 60 * 1000);\n    }\n    const onVis = () => {\n      if (document.hidden) {\n        if (timer) { clearInterval(timer); timer = null; }\n      } else {\n        if (!timer) timer = setInterval(run, 5 * 60 * 1000);\n      }\n    };\n    document.addEventListener('visibilitychange', onVis);\n    return () => {\n      if (timer) clearInterval(timer);\n      document.removeEventListener('visibilitychange', onVis);\n      if (progressAbortRef.current) {\n        try { progressAbortRef.current.abort(); } catch {}\n      }\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!hero) { setRecommendedEvents([]); return; }\n        setRecLoading(true);\n        const p = await getProfile(hero.id);\n        const csv = Array.isArray(p?.interests) && p.interests.length ? p.interests.join(',') : undefined;\n        const list = await recommendEvents(hero.id, csv);\n        setRecommendedEvents(Array.isArray(list) ? list.slice(0, 3) : []);\n      } catch { setRecommendedEvents([]); } finally { setRecLoading(false); }\n    })();\n  }, [hero?.id]);\n\n  useEffect(() => {\n    try {\n      onboardingManager.loadState();\n      const p = onboardingManager.getProgress();\n      setOnbPct(p.percentage);\n      setOnbCounts({completed:p.completed,total:p.total});\n      setOnbStep(onboardingManager.getCurrentStep());\n      const onStep = (d: any) => { setOnbStep(d?.step || null); const np = onboardingManager.getProgress(); setOnbPct(np.percentage); setOnbCounts({completed:np.completed,total:np.total}); };\n      onboardingManager.on('step-changed', onStep);\n      onboardingManager.on('step-completed', onStep);\n      onboardingManager.on('flow-completed', () => { const np = onboardingManager.getProgress(); setOnbPct(np.percentage); setOnbCounts({completed:np.completed,total:np.total}); setOnbStep(null); });\n      return () => {\n        onboardingManager.off('step-changed', onStep);\n        onboardingManager.off('step-completed', onStep);\n      };\n    } catch {}\n  }, []);\n\n  function goToCurrentStep() {\n    const s = onboardingManager.getCurrentStep();\n    if (s?.action?.type === 'navigate' && s.action.target) navigate(s.action.target);\n  }\n  function startTutorial() {\n    onboardingManager.startFlow('first-steps');\n    goToCurrentStep();\n  }\n  function nextTutorialStep() {\n    const moved = onboardingManager.nextStep();\n    if (!moved) return;\n    goToCurrentStep();\n  }\n  function prevTutorialStep() {\n    const moved = onboardingManager.previousStep();\n    if (!moved) return;\n    goToCurrentStep();\n  }\n  function skipCurrentStep() {\n    const ok = onboardingManager.skipStep();\n    if (!ok) return;\n    goToCurrentStep();\n  }\n  function submitFeedback() {\n    try {\n      const payload = { choice: fbChoice, text: fbText, ts: Date.now() };\n      localStorage.setItem('journey-feedback', JSON.stringify(payload));\n    } catch {}\n  }\n  const flowStats = useMemo(() => {\n    return ONBOARDING_FLOWS.map(flow => {\n      const total = flow.steps.length;\n      const completed = flow.steps.filter(s => onboardingManager.isStepCompleted(s.id)).length;\n      const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;\n      const completedFlow = onboardingManager.isFlowCompleted(flow.id);\n      return { flow, total, completed, percentage, completedFlow };\n    });\n  }, [onbCounts.completed, onbStep]);\n\n  const shortLore = useMemo(() => getAltharionLore('short'), []);\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <div className=\"mb-8 text-center\">\n        <div className=\"flex items-center justify-center gap-2 mb-2\">\n          <h1 className=\"text-4xl font-bold text-amber-400 font-serif tracking-wide\">\n            {medievalTheme.icons.ui.guild} Jornada do Heri\n          </h1>\n          {(() => {\n            const cfg = (seasonalThemes as any)[activeSeasonalTheme || ''];\n            const accents: string[] = cfg?.accents || [];\n            return accents.length ? (\n              <div className=\"text-2xl opacity-80\">{accents[0]}{accents[1]}{accents[2]}</div>\n            ) : null;\n          })()}\n        </div>\n        <p className=\"text-gray-300 italic\">Comece, personalize e avance com clareza.</p>\n      </div>\n\n      <div className={`rounded-xl p-6 mb-8 bg-amber-900/10 border border-amber-500/30`}>\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"text-sm text-amber-300 font-semibold\">Forjador de Heris  Introduo</div>\n          <div className=\"flex items-center gap-2\">\n            <Link to=\"/intro?version=game_intro\" className=\"px-3 py-1 rounded bg-amber-600 text-black text-xs\">Ver Narrao</Link>\n            <Link to=\"/intro?version=cinematic\" className=\"px-3 py-1 rounded bg-indigo-600 text-white text-xs\">Ver Trailer</Link>\n          </div>\n        </div>\n        <div className=\"space-y-2 text-sm text-gray-200\">\n          {shortLore.paragraphs.map((p, i) => (\n            <p key={i}>{p}</p>\n          ))}\n        </div>\n      </div>\n\n      <div className={`rounded-xl p-4 mb-8 bg-white/10 border ${seasonalBorder}`}>\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"text-sm text-gray-400\">Progresso da Jornada</div>\n          <div className=\"text-xs text-gray-300\">{onbCounts.completed}/{onbCounts.total}</div>\n        </div>\n        <ProgressBar percent={onbPct} />\n        <div className=\"mt-3 flex flex-wrap gap-2\">\n          {onbStep ? (\n            <>\n              <button onClick={prevTutorialStep} className=\"px-3 py-1 rounded bg-gray-800 text-white text-xs\">Voltar</button>\n              <button onClick={goToCurrentStep} className={`px-3 py-1 rounded bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white text-xs`}>Continuar</button>\n              <button onClick={nextTutorialStep} className=\"px-3 py-1 rounded bg-gray-800 text-white text-xs\">Avanar</button>\n            </>\n          ) : (\n            <button onClick={startTutorial} className={`px-3 py-1 rounded bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white text-xs`}>Iniciar Tutorial</button>\n          )}\n        </div>\n        {onbStep && (\n          <div className=\"mt-4 rounded-lg border border-white/20 bg-white/5 p-3\" aria-live=\"polite\">\n            <div className=\"text-white font-semibold text-sm\">{onbStep.title}</div>\n            <div className=\"text-[13px] text-gray-300\">{onbStep.description}</div>\n            {onbStep.content && <div className=\"mt-2 text-xs text-gray-300\">{onbStep.content}</div>}\n            <div className=\"mt-2 flex items-center gap-2\">\n              {onbStep.action?.type === 'navigate' && onbStep.action.target && (\n                <button onClick={goToCurrentStep} className={`px-2 py-1 rounded bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white text-xs`}>Ir agora</button>\n              )}\n              {onbStep.skippable && (\n                <button onClick={skipCurrentStep} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\">Pular</button>\n              )}\n              <button onClick={nextTutorialStep} className=\"px-2 py-1 rounded bg-gray-800 text-white text-xs\">Concluir e avanar</button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className={`rounded-xl p-4 mb-8 bg-white/10 border ${seasonalBorder}`}>\n        <div className=\"text-sm text-gray-400 mb-3\">Rastreador de Onboarding</div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n          {flowStats.map(({ flow, total, completed, percentage, completedFlow }) => (\n            <div key={flow.id} className=\"rounded-lg p-3 border border-white/20 bg-white/5\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-white font-semibold text-sm\">{flow.name}</div>\n                <span className={`text-xs ${completedFlow ? 'text-emerald-300' : 'text-gray-300'}`}>{completed}/{total}</span>\n              </div>\n              <div className=\"mt-2\">\n                <ProgressBar percent={percentage} />\n              </div>\n              <div className=\"mt-2 flex items-center gap-2\">\n                <button onClick={() => { onboardingManager.startFlow(flow.id); goToCurrentStep(); }} className=\"px-2 py-1 rounded bg-gray-800 text-white text-xs\">{completed > 0 ? 'Retomar' : 'Iniciar'}</button>\n                <button onClick={() => setTrackerExpandedFlowId(trackerExpandedFlowId === flow.id ? null : flow.id)} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs\" aria-expanded={trackerExpandedFlowId === flow.id}>Etapas</button>\n              </div>\n              {trackerExpandedFlowId === flow.id && (\n                <div className=\"mt-2 space-y-1\">\n                  {flow.steps.map(step => (\n                    <div key={step.id} className=\"flex items-center justify-between text-xs text-gray-200\">\n                      <span className={`flex items-center gap-2`}>{onboardingManager.isStepCompleted(step.id) ? '' : ''} {step.title}</span>\n                      {step.action?.type === 'navigate' && step.action.target ? (\n                        <button onClick={() => navigate(step.action!.target!)} className=\"px-2 py-1 rounded bg-gray-700 text-white\">Ir</button>\n                      ) : null}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Status Rpido */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n        <div className={`rounded-xl p-4 bg-white/10 border ${seasonalBorder}`}>\n          <div className=\"text-sm text-gray-400\">Heris</div>\n          <div className=\"text-2xl font-bold\">{heroes.length}</div>\n        </div>\n        <div className={`rounded-xl p-4 bg-white/10 border ${seasonalBorder}`}>\n          <div className=\"text-sm text-gray-400\">Nvel</div>\n          <div className=\"text-2xl font-bold\">{hero?.progression?.level ?? 1}</div>\n        </div>\n        <div className={`rounded-xl p-4 bg-white/10 border ${seasonalBorder}`}>\n          <ProgressBar percent={xpPercent} label=\"Progresso para o prximo nvel\" />\n        </div>\n      </div>\n\n      \n\n      \n\n      {/* Captulos sugeridos pela IA */}\n      <NarrativeChapters />\n\n      \n\n      \n\n      <div className=\"space-y-4\">\n        <StepCard\n          title=\"Criar Heri (com IA)\"\n          description=\"Crie rapidamente um heri com nome, frase, imagem e histria.\"\n          icon=\"\"\n          ctaLabel=\"Forjar Heri\"\n          to={referralCode ? `/create?ref=${referralCode}${inviterBy?`&by=${inviterBy}`:''}` : \"/create\"}\n          highlight={!hero}\n          examples={[\"Ex: Artemis, Arqueiro\", \"Ex: Histria gerada pela IA\"]}\n          stepIndex={1}\n          testId=\"create-hero-button\"\n        />\n        <StepCard\n          title=\"Ver Galeria\"\n          description=\"Visualize, edite avatares e personalize ttulos e visuais.\"\n          icon=\"\"\n          ctaLabel=\"Abrir Galeria\"\n          to=\"/gallery\"\n          examples={[\"Ex: Editar avatar\", \"Ex: Favoritar um ttulo\"]}\n          stepIndex={2}\n          testId=\"open-gallery-button\"\n        />\n        <StepCard\n          title=\"Misses IA\"\n          description=\"Aceite desafios dinmicos e faa escolhas que afetam recompensas.\"\n          icon=\"\"\n          ctaLabel=\"Ir para Misses\"\n          to=\"/quests\"\n          examples={[\"Ex: Escolher caminho de explorao\", \"Ex: Ganhar XP e ouro\"]}\n          stepIndex={3}\n          testId=\"open-quests-button\"\n        />\n        <StepCard\n          title=\"Evoluir Heri\"\n          description=\"Acompanhe nveis, ranks e conquistas com recompensas visuais.\"\n          icon=\"\"\n          ctaLabel=\"Ver Evoluo\"\n          to=\"/evolution\"\n          examples={[\"Ex: Subir para nvel 2\", \"Ex: Desbloquear um ttulo\"]}\n          stepIndex={4}\n          testId=\"open-evolution-button\"\n        />\n      </div>\n\n      {/* Banner de Convite */}\n      {referralCode && (\n        <div className=\"mt-6 rounded-xl p-4 bg-emerald-900/20 border border-emerald-500/40\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <div className=\"text-lg font-semibold text-emerald-300\"> Convite recebido</div>\n              <div className=\"text-sm text-gray-200\">Crie seu heri com este convite para ajudar quem te convidou a ganhar bnus.</div>\n            </div>\n            <Link\n              to={`/create?ref=${referralCode}`}\n              className=\"px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-semibold\"\n            >\n              Criar com convite\n            </Link>\n          </div>\n        </div>\n      )}\n\n      {/* Seco Final */}\n      <div className=\"mt-10 rounded-xl p-6 bg-white/5 border border-white/10\">\n        <div className=\"text-gray-300 text-sm mb-3\">No final da jornada:</div>\n        <div className=\"flex flex-wrap gap-3\">\n          <Link to=\"/leaderboards\" className=\"px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white text-sm\">\n            {medievalTheme.icons.ui.leaderboard} Ranking\n          </Link>\n          <Link to=\"/shop\" className=\"px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white text-sm\">\n             Loja\n          </Link>\n          <span className=\"px-3 py-2 rounded-lg bg-gray-800 text-gray-400 text-sm\">\n            <Link to=\"/social-events\" className=\"text-white hover:text-amber-300\"> Comunidade</Link>\n          </span>\n          <Link to=\"/premium\" className=\"px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white text-sm\">\n             Personalizao\n          </Link>\n        </div>\n      </div>\n\n      <div className=\"mt-6 rounded-xl p-6 bg-white/10 border border-white/20\">\n        <div className=\"text-lg font-semibold text-white mb-2\">Preferncias</div>\n        <div className=\"flex flex-wrap items-center gap-3 text-xs text-gray-300\">\n          <label className=\"flex items-center gap-2\">\n            <input type=\"checkbox\" checked={prefShowHints} onChange={e => { setPrefShowHints(e.target.checked); try { localStorage.setItem('hfn_show_hints', e.target.checked ? '1' : '0'); } catch {} }} aria-checked={prefShowHints} />\n            Mostrar dicas de UI\n          </label>\n          <label className=\"flex items-center gap-2\">\n            <input type=\"checkbox\" checked={prefSkipTutorials} onChange={e => { setPrefSkipTutorials(e.target.checked); try { localStorage.setItem('hfn_skip_tutorials', e.target.checked ? '1' : '0'); } catch {} }} aria-checked={prefSkipTutorials} />\n            Pular tutoriais\n          </label>\n          <button onClick={() => { try { localStorage.setItem('introSeen', '1'); } catch {} }} className=\"px-3 py-1 rounded bg-gray-800 text-white\">Pular introduo</button>\n        </div>\n      </div>\n\n      <div className={`mt-6 rounded-xl p-6 bg-white/10 border ${seasonalBorder}`}>\n        <div className=\"text-lg font-semibold text-white mb-2\">Feedback</div>\n        <div className=\"flex items-center gap-3 mb-3\">\n          <button onClick={() => setFbChoice('up')} className={`px-3 py-2 rounded ${fbChoice==='up' ? 'bg-emerald-700 text-white' : 'bg-gray-800 text-white'}`} aria-pressed={fbChoice==='up'} aria-label=\"Gostei\"> Gostei</button>\n          <button onClick={() => setFbChoice('down')} className={`px-3 py-2 rounded ${fbChoice==='down' ? 'bg-red-700 text-white' : 'bg-gray-800 text-white'}`} aria-pressed={fbChoice==='down'} aria-label=\"No gostei\"> No gostei</button>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <input value={fbText} onChange={e => setFbText(e.target.value)} placeholder=\"Comente sua experincia\" className=\"flex-1 px-3 py-2 rounded bg-gray-800 text-white border border-white/10 text-sm\" aria-label=\"Comentrio\" />\n          <button onClick={submitFeedback} className={`px-3 py-2 rounded bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white text-sm`}>Enviar</button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default JourneyFlow;\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport { getAltharionLore } from '../utils/story';\n\nconst supportedVersions = ['short', 'cinematic', 'game_intro', 'topics', 'full'] as const;\n\nconst lineVariants = {\n  initial: { opacity: 0, y: 10 },\n  enter: { opacity: 1, y: 0, transition: { duration: 0.8 } },\n  exit: { opacity: 0, y: -10, transition: { duration: 0.6 } }\n};\n\nconst IntroCinematic: React.FC = () => {\n  const location = useLocation();\n  const lore = React.useMemo(() => {\n    const params = new URLSearchParams(location.search);\n    const v = params.get('version') || 'short';\n    const key = (supportedVersions as readonly string[]).includes(v) ? (v as any) : 'game_intro';\n    const data = getAltharionLore(key as any) as any;\n    const linesArr = data?.lines || data?.script || data?.paragraphs || [];\n    const title = data?.title || 'Narrao Inicial do Jogo';\n    const lines: string[] = Array.isArray(linesArr) ? linesArr : [];\n    const isCinematic = key === 'cinematic';\n    return { title, lines, isCinematic };\n  }, [location.search]);\n  const [index, setIndex] = useState(0);\n  const [autoPlay, setAutoPlay] = useState(true);\n  const [ttsEnabled, setTtsEnabled] = useState(true);\n  const navigate = useNavigate();\n  const nextTimeout = useRef<number | null>(null);\n  const ambientRef = useRef<HTMLAudioElement | null>(null);\n  const crescendoRef = useRef<HTMLAudioElement | null>(null);\n  const utterRef = useRef<SpeechSynthesisUtterance | null>(null);\n\n  // TTS helpers\n  const voices = useMemo(() => {\n    return window.speechSynthesis?.getVoices() || [];\n  }, []);\n\n  const pickVoice = () => {\n    const vs = window.speechSynthesis?.getVoices() || voices;\n\n    const matchesGooglePtBr = (v: SpeechSynthesisVoice) => {\n      const name = (v?.name || '').toLowerCase();\n      const uri = (v?.voiceURI || '').toLowerCase();\n      const hay = name + ' ' + uri;\n      return hay.includes('google') && hay.match(/portugu[e]s|portugues/) && hay.match(/brasil|brazil|pt-br/);\n    };\n\n    // Tentar nomes comuns\n    const preferredNames = [\n      'Google portugus do Brasil',\n      'Google Portugus do Brasil',\n      'Google PT-BR',\n      'Google Brazilian Portuguese'\n    ].map(n => n.toLowerCase());\n\n    const voiceByName = vs.find(v => preferredNames.includes((v.name || '').toLowerCase()));\n    const voiceByHeuristic = vs.find(matchesGooglePtBr);\n    if (voiceByName) return voiceByName;\n    if (voiceByHeuristic) return voiceByHeuristic;\n\n    // Caso no haja Google, preferir pt-BR/pt-* e nomes femininos\n    const isFemaleName = (name: string) => {\n      const n = (name || '').toLowerCase();\n      return /female|femin|mulher|ana|camila|luciana|maria|vit[o]ria|helena|gabriela|bruna|carla|laura/.test(n);\n    };\n    const preferPool = (pool: SpeechSynthesisVoice[]) => {\n      if (!pool.length) return null;\n      const sorted = [...pool].sort((a, b) => Number(isFemaleName(b.name)) - Number(isFemaleName(a.name)));\n      return sorted[0];\n    };\n\n    const ptbr = vs.filter(v => (v.lang || '').toLowerCase() === 'pt-br');\n    const pt = vs.filter(v => (v.lang || '').toLowerCase().startsWith('pt'));\n    return preferPool(ptbr) || preferPool(pt) || preferPool(vs) || vs[0];\n  };\n\n  const computeDelay = (text: string) => {\n    const base = 1400;\n    const perCharMs = 45;\n    const maxMs = 9000;\n    return Math.min(maxMs, base + perCharMs * Math.min(text.length, 160));\n  };\n\n  const speak = (text: string, onEnd?: () => void) => {\n    try {\n      if (!ttsEnabled || !window.speechSynthesis) {\n        onEnd?.();\n        return;\n      }\n      const utter = new SpeechSynthesisUtterance(text);\n      const voice = pickVoice();\n      if (voice) utter.voice = voice;\n      // Forar pt-BR para evitar variaes\n      utter.lang = 'pt-BR';\n      // Leve ajuste para soar mais feminina\n      utter.rate = 0.92;\n      utter.pitch = 1.08;\n      utter.onstart = () => {\n        // sincronizao iniciada\n      };\n      utter.onend = () => onEnd?.();\n      utter.onerror = () => {\n        // Em alguns navegadores, erros disparam rapidamente; avanar com atraso proporcional\n        setTimeout(() => onEnd?.(), computeDelay(text));\n      };\n      utterRef.current = utter;\n      window.speechSynthesis.speak(utter);\n    } catch {\n      onEnd?.();\n    }\n  };\n\n  // Avano de linhas: usa onend da TTS quando ativada; seno usa delay dinmico\n  useEffect(() => {\n    const text = lore.lines[index];\n    if (!autoPlay || !text) return () => {};\n\n    // Limpar qualquer timeout anterior\n    if (nextTimeout.current) {\n      clearTimeout(nextTimeout.current);\n      nextTimeout.current = null;\n    }\n\n    if (ttsEnabled && window.speechSynthesis) {\n      // Limpar fila anterior apenas se houver algo falando/pendente\n      try {\n        const synth = window.speechSynthesis as SpeechSynthesis;\n        // @ts-ignore: pending existe em alguns navegadores\n        if (synth.speaking || (synth as any).pending) synth.cancel();\n      } catch {}\n      // Falar e avanar somente quando a narrao terminar\n      const id = setTimeout(() => {\n        speak(text, () => {\n          setIndex((i) => Math.min(i + 1, lore.lines.length));\n        });\n      }, 50);\n      return () => {\n        // no cancelar aqui para no cortar; apenas limpar timeout se existir\n        clearTimeout(id);\n        if (nextTimeout.current) { clearTimeout(nextTimeout.current); nextTimeout.current = null; }\n      };\n    } else {\n      // Sem TTS: usar atraso proporcional ao tamanho do texto\n      const delayMs = computeDelay(text);\n      nextTimeout.current = window.setTimeout(() => {\n        setIndex((i) => Math.min(i + 1, lore.lines.length));\n      }, delayMs);\n      return () => {\n        if (nextTimeout.current) {\n          clearTimeout(nextTimeout.current);\n          nextTimeout.current = null;\n        }\n      };\n    }\n  }, [index, autoPlay, ttsEnabled, lore.lines]);\n\n  // Msica ambiente e crescendo com fade\n  useEffect(() => {\n    // Preparar players\n    if (!ambientRef.current) {\n      const base = (import.meta.env && import.meta.env.BASE_URL) || '/';\n      const ambientSrc = `${base}audio/intro-ambient.mp3`;\n      const a = new Audio(ambientSrc);\n      a.preload = 'auto';\n      a.loop = true;\n      a.volume = 0;\n      ambientRef.current = a;\n      a.play().catch(() => {/* arquivo opcional ou bloqueio de autoplay */});\n      // Fade-in mais sutil para ambient\n      let v = 0;\n      const id = setInterval(() => {\n        v = Math.min(0.25, v + 0.02);\n        a.volume = v;\n        if (v >= 0.25) clearInterval(id);\n      }, 500);\n    }\n    if (!crescendoRef.current) {\n      const base = (import.meta.env && import.meta.env.BASE_URL) || '/';\n      const crescendoSrc = `${base}audio/intro-crescendo.mp3`;\n      const c = new Audio(crescendoSrc);\n      c.preload = 'auto';\n      c.loop = true;\n      c.volume = 0;\n      crescendoRef.current = c;\n    }\n    return () => {\n      // Fade-out suave ao desmontar\n      const a = ambientRef.current;\n      const c = crescendoRef.current;\n      if (a) {\n        let v = a.volume;\n        const id = setInterval(() => {\n          v = Math.max(0, v - 0.05);\n          a.volume = v;\n          if (v <= 0) { clearInterval(id); a.pause(); }\n        }, 150);\n      }\n      if (c) {\n        let v = c.volume;\n        const id = setInterval(() => {\n          v = Math.max(0, v - 0.05);\n          c.volume = v;\n          if (v <= 0) { clearInterval(id); c.pause(); }\n        }, 150);\n      }\n    };\n  }, []);\n\n  // Ativar crescendo na segunda metade\n  useEffect(() => {\n    const c = crescendoRef.current;\n    if (!c) return;\n    const threshold = Math.floor(lore.lines.length * 0.75);\n    if (index >= threshold) {\n      c.play().catch(() => {});\n      let v = c.volume;\n      const id = setInterval(() => {\n        v = Math.min(0.35, v + 0.02);\n        c.volume = v;\n        if (v >= 0.35) clearInterval(id);\n      }, 500);\n      return () => clearInterval(id);\n    }\n  }, [index]);\n\n  const isFinished = index >= lore.lines.length;\n\n  const handleSkip = () => {\n    window.speechSynthesis?.cancel();\n    try { localStorage.setItem('introSeen', '1'); } catch {}\n    const a = ambientRef.current;\n    const c = crescendoRef.current;\n    if (a) {\n      let v = a.volume;\n      const id = setInterval(() => {\n        v = Math.max(0, v - 0.05);\n        a.volume = v;\n        if (v <= 0) { clearInterval(id); a.pause(); }\n      }, 150);\n    }\n    if (c) {\n      let v = c.volume;\n      const id = setInterval(() => {\n        v = Math.max(0, v - 0.05);\n        c.volume = v;\n        if (v <= 0) { clearInterval(id); c.pause(); }\n      }, 150);\n    }\n    navigate('/journey');\n  };\n\n  // Marcar como vista quando termina\n  useEffect(() => {\n    if (isFinished) {\n      try { localStorage.setItem('introSeen', '1'); } catch {}\n      // Fade-out ao finalizar\n      const a = ambientRef.current;\n      const c = crescendoRef.current;\n      if (a) {\n        let v = a.volume;\n        const id = setInterval(() => {\n          v = Math.max(0, v - 0.05);\n          a.volume = v;\n          if (v <= 0) { clearInterval(id); a.pause(); }\n        }, 150);\n      }\n      if (c) {\n        let v = c.volume;\n        const id = setInterval(() => {\n          v = Math.max(0, v - 0.05);\n          c.volume = v;\n          if (v <= 0) { clearInterval(id); c.pause(); }\n        }, 150);\n      }\n    }\n  }, [isFinished]);\n\n  return (\n    <div className=\"min-h-screen relative overflow-hidden bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900\">\n      {/* Partculas simples */}\n      <div className=\"absolute inset-0 pointer-events-none\">\n        <div className=\"absolute -top-24 left-1/2 -translate-x-1/2 w-[60vw] h-[60vw] rounded-full bg-amber-500/10 blur-3xl\" />\n        <div className=\"absolute bottom-0 left-1/4 w-[30vw] h-[30vw] rounded-full bg-indigo-500/10 blur-3xl\" />\n        {lore.isCinematic && (\n          <div className=\"absolute top-1/3 left-1/2 -translate-x-1/2 w-[40vw] h-[40vw] rounded-full bg-cyan-400/10 blur-3xl animate-pulse\" />\n        )}\n      </div>\n\n      <div className=\"relative z-10 container mx-auto px-6 py-10 flex flex-col items-center text-center\">\n        <div className=\"text-amber-400 text-sm tracking-widest uppercase mb-4\" aria-live=\"polite\">{lore.title}</div>\n        <div className=\"max-w-3xl\">\n          <AnimatePresence mode=\"wait\">\n            {!isFinished && (\n              <motion.p\n                key={index}\n                variants={lineVariants}\n                initial=\"initial\"\n                animate=\"enter\"\n                exit=\"exit\"\n                className=\"text-xl md:text-2xl text-slate-100 font-serif leading-relaxed\"\n              >\n                {lore.lines[index]}\n              </motion.p>\n            )}\n          </AnimatePresence>\n\n          {/* Controles */}\n          {!isFinished && (\n            <div className=\"mt-8 flex items-center justify-center gap-3 text-sm\">\n              <button\n                className=\"px-3 py-2 rounded bg-amber-600 text-white hover:bg-amber-700\"\n                onClick={() => {\n                  setAutoPlay((v) => {\n                    const nv = !v;\n                    if (window.speechSynthesis && ttsEnabled) {\n                      nv ? window.speechSynthesis.resume() : window.speechSynthesis.pause();\n                    }\n                    return nv;\n                  });\n                }}\n                aria-label={autoPlay ? 'Pausar' : 'Reproduzir'}\n              >\n                {autoPlay ? 'Pausar' : 'Reproduzir'}\n              </button>\n              <button\n                className={`px-3 py-2 rounded ${ttsEnabled ? 'bg-gray-700 text-gray-200 hover:bg-gray-600' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'}`}\n                onClick={() => setTtsEnabled((v) => {\n                  const nv = !v;\n                  if (!nv) {\n                    try { window.speechSynthesis?.cancel(); } catch {}\n                  }\n                  return nv;\n                })}\n                aria-label={ttsEnabled ? 'Desativar Narrao' : 'Ativar Narrao'}\n              >\n                {ttsEnabled ? 'Narrao Ativada' : 'Narrao Desativada'}\n              </button>\n              <button\n                className=\"px-3 py-2 rounded bg-gray-700 text-gray-200 hover:bg-gray-600\"\n                onClick={handleSkip}\n              >\n                Pular\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Final */}\n        {isFinished && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.96 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.8 }}\n            className=\"mt-12 bg-slate-800/60 backdrop-blur-sm border border-amber-500/40 rounded-xl p-6 w-full max-w-xl\"\n          >\n            <div className=\"text-4xl md:text-5xl text-amber-400 mb-2\"></div>\n            <div className=\"text-slate-200 text-lg mb-4 font-medium\">\n              O selo da Guilda de Altharion brilha diante de voc.\n            </div>\n            <div className=\"flex items-center justify-center gap-3\">\n              <Link\n                to=\"/create\"\n                className=\"px-5 py-3 rounded bg-amber-600 text-white hover:bg-amber-700 shadow\"\n              >\n                Forjar Heri\n              </Link>\n              <Link\n                to=\"/journey\"\n                className=\"px-5 py-3 rounded bg-gray-700 text-gray-200 hover:bg-gray-600\"\n              >\n                Ir ao Incio\n              </Link>\n            </div>\n            <div className=\"mt-4 text-xs text-gray-400\">A introduo ser mostrada uma vez; voc pode revisit-la via /intro.</div>\n          </motion.div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default IntroCinematic;\n","import { Hero } from '../types/hero';\nimport { getGameSettings } from '../store/gameSettingsStore';\n\nexport type DialogueTag = 'gossip' | 'event' | 'humor' | 'time_morning' | 'time_evening' | 'seasonal' | 'guild_mission' | 'warning';\nexport type DialoguePriority = 'urgent' | 'plot' | 'social' | 'ambient';\n\nexport interface DialogueLine {\n  text: string;\n  tags: DialogueTag[];\n  priority: DialoguePriority;\n  npcId?: string;\n  weight?: number;\n  requiredRelation?: number;\n  requiredReputation?: number;\n}\n\nconst bank: DialogueLine[] = [\n  { text: 'Ouvi que {npc} anda perto da taverna com segredos.', tags: ['gossip'], priority: 'social', weight: 3 },\n  { text: 'Dizem que um heri venceu um golem rachado ontem.', tags: ['event'], priority: 'plot', weight: 4 },\n  { text: 'Se precisar de mapas, tenho uns rabiscos confiveis.', tags: ['humor','event'], priority: 'social', weight: 2 },\n  { text: 'Manh cheia: planejo patrulhar as runas.', tags: ['time_morning'], priority: 'ambient', weight: 2 },\n  { text: 'Noite longa: hoje quase virei comida de troll.', tags: ['time_evening'], priority: 'ambient', weight: 2 },\n  { text: 'Festival do sol chegando, precisaremos de tochas.', tags: ['seasonal'], priority: 'ambient', weight: 1 },\n  { text: 'Misso em andamento? Posso te cobrir no flanco.', tags: ['guild_mission'], priority: 'plot', weight: 3, requiredRelation: 20 },\n  { text: 'Cuidado com emboscadas no mercado subterrneo.', tags: ['warning'], priority: 'urgent', weight: 4 },\n  { text: 'Pela barba de Merlim, seu nome ecoou pela cidade.', tags: ['humor','event'], priority: 'social', weight: 3, requiredReputation: 200 },\n  { text: 'Ouvi rumores de rivalidades na guilda hoje.', tags: ['gossip','guild_mission'], priority: 'social', weight: 2 },\n  { text: 'H um mapa antigo apontando para um acesso secreto.', tags: ['event'], priority: 'plot', weight: 3 },\n  { text: 'Planejando misso? Dividir o loot antes evita briga.', tags: ['guild_mission'], priority: 'plot', weight: 3 },\n  { text: 'Se me pagar com poes, conto um atalho seguro.', tags: ['humor','event'], priority: 'social', weight: 2 },\n  { text: 'A chuva traz bruxas; v armado  Floresta Umbral.', tags: ['seasonal','warning'], priority: 'plot', weight: 3 },\n  { text: 'Seu arco canta; ouvi dizer que acertou trs bandidos.', tags: ['humor','event'], priority: 'social', weight: 2 },\n  { text: 'De manh o conselho decide misses difceis.', tags: ['time_morning','guild_mission'], priority: 'plot', weight: 2 },\n  { text: ' noite a verdade aparece: quem falhou e quem brilhou.', tags: ['time_evening','guild_mission'], priority: 'plot', weight: 2 },\n  { text: 'Quer espalhar um rumor til? Sei a pessoa certa.', tags: ['gossip'], priority: 'social', weight: 2 },\n  { text: 'Tenho uma pista de caverna com cristais rnicos.', tags: ['event'], priority: 'plot', weight: 3 },\n  { text: 'Se for com rivais, tenha um plano de fuga.', tags: ['warning','guild_mission'], priority: 'plot', weight: 3 }\n];\n\nfunction score(line: DialogueLine, npc: Hero, player: Hero, now: Date): number {\n  const s = getGameSettings();\n  const hour = now.getHours();\n  const isMorning = hour >= 5 && hour < 12;\n  const isEvening = hour >= 18 || hour < 2;\n  if (line.requiredRelation && ((npc.socialRelations || {})[player.id] || 0) < line.requiredRelation) return -1;\n  if (line.requiredReputation && (player.progression.reputation || 0) < line.requiredReputation) return -1;\n  let base = line.weight || 1;\n  if (line.priority === 'urgent') base += 3;\n  if (line.tags.includes('time_morning') && isMorning) base += 2;\n  if (line.tags.includes('time_evening') && isEvening) base += 2;\n  return base;\n}\n\nexport function generateDialogue(npc: Hero, player: Hero, tags: DialogueTag[], limit = 3): string[] {\n  const now = new Date();\n  const filtered = bank.filter(b => tags.every(t => b.tags.includes(t)));\n  const scored = filtered\n    .map(l => ({ l, s: score(l, npc, player, now) }))\n    .filter(x => x.s >= 0)\n    .sort((a,b) => b.s - a.s)\n    .slice(0, Math.max(1, limit))\n    .map(x => x.l.text.replace('{npc}', npc.name));\n  return scored;\n}\n\nexport function generateMixed(npc: Hero, player: Hero, limit = 3): string[] {\n  const now = new Date();\n  const pool = bank\n    .map(l => ({ l, s: score(l, npc, player, now) }))\n    .filter(x => x.s >= 0)\n    .sort((a,b) => b.s - a.s)\n    .slice(0, 8)\n    .map(x => x.l.text.replace('{npc}', npc.name));\n  return pool.slice(0, limit);\n}","import { Hero } from '../types/hero';\nimport { updateOnSocial } from './relationshipSystem';\nimport { notificationBus } from '../components/NotificationSystem';\nimport { useHeroStore } from '../store/heroStore';\n\nfunction clamp(v: number, min: number, max: number) { return Math.max(min, Math.min(max, v)); }\n\nexport function actionConversar(npc: Hero, player: Hero) {\n  const mood = (npc.npcMood || 'neutro') === 'irritado' ? 'hostil' : 'amigvel';\n  const res = updateOnSocial(npc, player, mood === 'amigvel' ? 'amigvel' : 'neutro');\n  notificationBus.emit({ type: 'quest', title: 'Conversar', message: `${npc.name}: relao ${res.value}`, icon: '', duration: 2000 });\n}\n\nexport function actionElogiar(npc: Hero, player: Hero) {\n  const good = npc.npcMood !== 'irritado' && npc.npcMood !== 'triste';\n  const delta = good ? 5 : -3;\n  const map = { ...(npc.socialRelations || {}) };\n  const relCur = map[player.id] || 0;\n  const factor = Math.max(0.2, (100 - Math.max(0, relCur)) / 100);\n  const deltaScaled = Math.ceil(delta * factor);\n  map[player.id] = clamp(relCur + deltaScaled, -100, 100);\n  npc.socialRelations = map;\n  notificationBus.emit({ type: good ? 'achievement' : 'stamina', title: 'Elogiar', message: `${npc.name} ${good ? 'apreciou' : 'no gostou'} do elogio`, icon: good ? '' : '', duration: 2000 });\n}\n\nexport function actionPedirAjuda(npc: Hero, player: Hero) {\n  const rel = (npc.socialRelations || {})[player.id] || 0;\n  const ok = rel >= 20 && npc.npcMood !== 'irritado' && npc.npcMood !== 'cansado';\n  if (ok) {\n    const types: Array<'boost_xp'|'stamina_refill'|'reduce_cooldown'|'boost_initiative'|'gold_bonus'|'success_boost'|'stamina_discount'|'loot_bonus'|'ambush_shield'> = ['boost_xp','stamina_refill','reduce_cooldown','boost_initiative','gold_bonus','success_boost','stamina_discount','loot_bonus','ambush_shield'];\n    const pick = types[Math.floor(Math.random()*types.length)];\n    const now = Date.now();\n    const level = rel >= 80 ? 3 : rel >= 50 ? 2 : 1;\n    const helpStatus: any = { type: pick, missionsRemaining: 1, expiresAt: new Date(now + 2 * 60 * 60 * 1000).toISOString(), level };\n    if (pick === 'boost_xp') helpStatus.boostXpPercent = level === 3 ? 0.20 : level === 2 ? 0.15 : 0.10;\n    if (pick === 'boost_initiative') helpStatus.initiativeBonus = level === 3 ? 8 : level === 2 ? 6 : 5;\n    if (pick === 'gold_bonus') helpStatus.goldBonusPercent = level === 3 ? 0.20 : level === 2 ? 0.15 : 0.10;\n    if (pick === 'success_boost') helpStatus.successBoostPercent = level === 3 ? 0.10 : level === 2 ? 0.07 : 0.05;\n    if (pick === 'stamina_discount') helpStatus.staminaCostReduction = level === 3 ? 2 : 1;\n    if (pick === 'loot_bonus') helpStatus.lootDropBonusPercent = level === 3 ? 0.25 : level === 2 ? 0.15 : 0.10;\n    if (pick === 'ambush_shield') helpStatus.ambushReductionPercent = level === 3 ? 0.5 : level === 2 ? 0.35 : 0.2;\n    if (pick === 'reduce_cooldown') helpStatus.reduceCooldownMinutes = level === 3 ? 12 : level === 2 ? 8 : 5;\n    if (pick === 'stamina_refill') {\n      const refill = level === 3 ? 30 : level === 2 ? 20 : 10;\n      const cur = Math.max(0, Number(player.progression?.fatigue || 0));\n      const next = Math.max(0, cur - refill);\n      helpStatus.staminaRefillAmount = refill;\n      useHeroStore.getState().updateHero(player.id, { progression: { ...(player.progression || {}), fatigue: next } });\n    }\n    const stats = { ...(player.stats || {}) } as any;\n    stats.helpStatus = helpStatus;\n    useHeroStore.getState().updateHero(player.id, { stats });\n    const msg = pick === 'boost_xp'\n      ? `+${Math.round((helpStatus.boostXpPercent || 0)*100)}% XP na prxima misso`\n      : pick === 'stamina_refill'\n      ? `Fadiga -${helpStatus.staminaRefillAmount || 10}`\n      : pick === 'reduce_cooldown'\n      ? `Cooldown -${helpStatus.reduceCooldownMinutes || 5} min na prxima misso`\n      : pick === 'boost_initiative'\n      ? `+${helpStatus.initiativeBonus || 5} Iniciativa na prxima misso`\n      : pick === 'gold_bonus'\n      ? `+${Math.round((helpStatus.goldBonusPercent || 0)*100)}% ouro na prxima misso`\n      : pick === 'success_boost'\n      ? `+${Math.round((helpStatus.successBoostPercent || 0)*100)}% chance de sucesso nas fases`\n      : pick === 'stamina_discount'\n      ? `Custo de Fadiga reduzido em ${helpStatus.staminaCostReduction || 1}`\n      : pick === 'loot_bonus'\n      ? `Chance de loot +${Math.round((helpStatus.lootDropBonusPercent || 0)*100)}%`\n      : `Proteo contra emboscada (${Math.round((helpStatus.ambushReductionPercent || 0)*100)}% menos risco/dano)`;\n    notificationBus.emit({ type: 'achievement', title: 'Ajuda concedida', message: `${npc.name}: ${msg}`, icon: '', duration: 2500 });\n  } else {\n    notificationBus.emit({ type: 'stamina', title: 'Pedir ajuda', message: `${npc.name} recusou`, icon: '', duration: 2000 });\n  }\n}\n\nexport function actionDarPresente(npc: Hero, player: Hero, itemId: string) {\n  const bias = itemId.includes('pocao') ? 'guerreiro' : itemId.includes('pedra') || itemId.includes('arcane') ? 'mago' : itemId.includes('flor') || itemId.includes('vinculo') ? 'social' : 'neutro';\n  let delta = 4;\n  if (bias === 'guerreiro' && (npc.class === 'guerreiro' || npc.class === 'paladino')) delta = 7;\n  if (bias === 'mago' && (npc.class === 'mago' || npc.class === 'feiticeiro')) delta = 7;\n  if (bias === 'social') delta = 6;\n  const map = { ...(npc.socialRelations || {}) };\n  const relCur = map[player.id] || 0;\n  const factor = Math.max(0.2, (100 - Math.max(0, relCur)) / 100);\n  const deltaScaled = Math.ceil(delta * factor);\n  map[player.id] = clamp(relCur + deltaScaled, -100, 100);\n  npc.socialRelations = map;\n  const mem = { ...(npc.npcMemory || {}) } as any;\n  const giftStats = { ...(mem.giftStatsByHeroId || {}) } as Record<string, { count: number; quality: number }>;\n  const q = itemId.includes('lendario') || itemId.includes('deluxe') ? 3 : itemId.includes('epico') ? 2 : 1;\n  const cur = giftStats[player.id] || { count: 0, quality: 0 };\n  const next = { count: cur.count + 1, quality: cur.quality + q };\n  giftStats[player.id] = next;\n  mem.giftStatsByHeroId = giftStats;\n  useHeroStore.getState().updateHero(npc.id, { npcMemory: mem });\n  notificationBus.emit({ type: 'achievement', title: 'Presente', message: `${npc.name} gostou do presente (${itemId})`, icon: '', duration: 2000 });\n  if (next.count >= 3 && next.quality >= 5) {\n    try {\n      const reward = itemId.includes('pocao') ? 'pergaminho-protecao' : itemId.includes('pedra') ? 'essencia-vinculo' : 'racao-basica';\n      useHeroStore.getState().addItemToInventory(player.id, reward, 1);\n      notificationBus.emit({ type: 'achievement', title: 'Recompensa de Presente', message: `${npc.name} te deu ${reward} em agradecimento!`, icon: '', duration: 3000 });\n    } catch {}\n  }\n}\n\nexport function actionProvocar(npc: Hero, player: Hero) {\n  const map = { ...(npc.socialRelations || {}) };\n  map[player.id] = clamp((map[player.id] || 0) - 8, -100, 100);\n  npc.socialRelations = map;\n  notificationBus.emit({ type: 'stamina', title: 'Provocar', message: `${npc.name} ficou irritado`, icon: '', duration: 2000 });\n}\n","import React, { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { generateMixed, generateDialogue } from '../utils/dialogueEngine';\nimport { tokens } from '../styles/designTokens';\nimport { medievalTheme, seasonalThemes } from '../styles/medievalTheme';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { actionConversar, actionElogiar, actionPedirAjuda, actionDarPresente, actionProvocar } from '../utils/socialActions';\nimport { aiService } from '../services/aiService';\nimport { getGameSettings } from '../store/gameSettingsStore';\n\nconst Badge: React.FC<{ color: string; icon: string; label: string }> = ({ color, icon, label }) => (\n  <span className={`px-2 py-1 rounded text-xs font-medium border`} style={{ borderColor: color, color }}>\n    <span className=\"mr-1\">{icon}</span>{label}\n  </span>\n);\n\nconst TavernInteractions: React.FC = () => {\n  const { heroes, getSelectedHero, setNPCInteractionOverlay } = useHeroStore() as any;\n  const updateHero = useHeroStore((s: any) => s.updateHero);\n  const restAtTavern = useHeroStore((s: any) => s.restAtTavern);\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-amber-600/30' : 'border-amber-600/30';\n  const player = getSelectedHero();\n  const npcs = useMemo(() => heroes.filter((h: any) => h.origin === 'npc'), [heroes]);\n  const [visibleIds, setVisibleIds] = useState<string[]>([]);\n  useEffect(() => {\n    const ids = npcs.map((n: any) => n.id);\n    function sample(arr: string[], k: number) {\n      const a = [...arr];\n      for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; }\n      return a.slice(0, Math.max(0, Math.min(6, a.length)));\n    }\n    setVisibleIds(sample(ids, 6));\n    const iv = setInterval(() => {\n      const latestIds = npcs.map((n: any) => n.id);\n      setVisibleIds(sample(latestIds, 6));\n    }, 60000);\n    return () => clearInterval(iv);\n  }, [npcs.length]);\n  const [activeNpcId, setActiveNpcId] = useState<string | null>(null);\n  if (!player || npcs.length === 0) return null;\n  const npc = npcs.find(n => n.id === activeNpcId) || npcs.find(n => visibleIds.includes(n.id)) || npcs[0];\n  const lines = generateMixed(npc, player, 1);\n  const morning = generateDialogue(npc, player, ['time_morning'], 1);\n  const evening = generateDialogue(npc, player, ['time_evening'], 1);\n  const gossip = generateDialogue(npc, player, ['gossip'], 1);\n  const uniqueLines = Array.from(new Set([gossip[0], lines[0], morning[0], evening[0]].filter(Boolean)));\n  const [aiCompact, setAiCompact] = useState<string[] | null>(null);\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      try {\n        const routine = (npc.npcRoutine || []).find(r => {\n          const [sh, sm] = (r.start || '00:00').split(':').map(Number);\n          const [eh, em] = (r.end || '23:59').split(':').map(Number);\n          const h = new Date().getHours();\n          return h >= sh && h < eh;\n        });\n        const activity = routine?.activity || 'exploracao';\n        const mood = npc.npcMood || 'neutro';\n        const rel = (npc.socialRelations || {})[player.id] || 0;\n        const context = `Atividade atual: ${activity}. Humor: ${mood}. Relao com ${player.name}: ${rel}. Preferncias: ${JSON.stringify(npc.npcMemory?.preferences || {})}. ltimas interaes: ${(npc.npcMemory?.interactions || []).slice(-3).map(i => i.summary).join(', ')}`;\n        const systemMessage = 'Voc  um NPC de fantasia. Gere um nico comentrio curto e contextual (mx. 1 linha), em PT-BR, baseado na rotina atual, humor e memrias. Evite repetio e clichs. Somente texto do NPC.';\n        const prompt = `Crie uma fala nica e original relacionada  ${activity}, refletindo o humor ${mood}, mencionando discretamente um detalhe da rotina ou local, para o heri ${player.name}.`;\n        const res = await aiService.generateTextSafe({ systemMessage, prompt, context, maxTokens: 120, temperature: 0.8 });\n        const raw = (res.text || '').split('\\n').map(s => s.trim()).filter(Boolean);\n        const cleaned = raw.map(t => t.replace(/^NPC:\\s*/i, '')).filter(t => t.length > 0);\n        const picked = cleaned.slice(0, 1);\n        if (!cancelled && picked.length) setAiCompact(picked);\n      } catch {\n        if (!cancelled) setAiCompact(null);\n      }\n    })();\n    return () => { cancelled = true; };\n  }, [npc.id, player.id, npc.npcMood]);\n  const compact = (aiCompact && aiCompact.length) ? aiCompact : uniqueLines.slice(0, 1);\n\n  const relVal = (npc.socialRelations || {})[player.id] || 0;\n  const displayMood = relVal >= 40 ? 'feliz' : relVal >= 20 ? 'tranquilo' : npc.npcMood;\n  const moodEmoji = displayMood === 'feliz' ? '' : displayMood === 'tranquilo' ? '' : displayMood === 'neutro' ? '' : displayMood === 'estressado' ? '' : displayMood === 'irritado' ? '' : displayMood === 'triste' ? '' : '';\n  const needs = npc.npcNeeds || { fadiga: 20, fome: 20, social: 50, aventura: 40, tarefa: 40 };\n  return (\n    <div className={`${tokens.cardBase} border ${seasonalBorder}`}>\n      <div className=\"flex items-center justify-between mb-3\">\n        <h2 className=\"text-2xl font-bold\"> Taverna</h2>\n        <div className=\"flex items-center gap-2\">\n          <Badge color=\"#F59E0B\" icon=\"\" label=\"Ambiental\" />\n          <Badge color=\"#10B981\" icon=\"\" label=\"Social\" />\n          <Badge color=\"#EF4444\" icon=\"\" label=\"Urgente\" />\n        </div>\n      </div>\n      <div className=\"flex items-center gap-2 mb-3\">\n        {(visibleIds.length ? visibleIds : npcs.slice(0,6).map(n => n.id))\n          .map(id => npcs.find(n => n.id === id))\n          .filter(Boolean)\n          .map(n => (\n            <button key={n!.id} onClick={() => setActiveNpcId(n!.id)} className={`px-2 py-1 rounded border ${activeNpcId===n!.id ? tokens.tabActive : tokens.tabInactive}`}>{n!.name}</button>\n          ))}\n      </div>\n      <div className=\"space-y-2\">\n        <div className=\"flex items-center gap-3 text-xs text-gray-300\">\n          <span>Mood: {moodEmoji}</span>\n          <span> {needs.fadiga}%</span>\n          <span> {needs.fome}%</span>\n          <span> {needs.social}%</span>\n          <span> {needs.aventura}%</span>\n          <span> {needs.tarefa}%</span>\n        </div>\n        {compact.map((t,i) => (<div key={`l-${i}`} className=\"p-2 rounded border bg-gray-900 border-gray-700\">{npc.name}: {t}</div>))}\n      </div>\n      {(() => {\n        const s: any = player.stats || {};\n        const lastMap = s.lastInteractionByNpcId || {};\n        const lastIso = lastMap[npc.id];\n        const sameDay = !!lastIso && new Date(lastIso).toDateString() === new Date().toDateString();\n        const limit = (getGameSettings().dailyNpcInteractionsLimit ?? 2);\n        const globalDate = s.dailyNpcInteractionsDate;\n        const globalCount = s.dailyNpcInteractionsCount || 0;\n        const todayStr = new Date().toDateString();\n        const sameDayGlobal = !!globalDate && new Date(globalDate).toDateString() === todayStr;\n        const canGlobal = !sameDayGlobal || globalCount < limit;\n        const can = !sameDay && canGlobal;\n        const mark = () => {\n          const map = { ...(player.stats as any).lastInteractionByNpcId, [npc.id]: new Date().toISOString() };\n          const baseStats = { ...player.stats } as any;\n          const prevDate = baseStats.dailyNpcInteractionsDate;\n          const prevCount = baseStats.dailyNpcInteractionsCount || 0;\n          const isSame = !!prevDate && new Date(prevDate).toDateString() === todayStr;\n          const nextCount = isSame ? prevCount + 1 : 1;\n          const stats = { ...baseStats, lastInteractionByNpcId: map, dailyNpcInteractionsDate: new Date().toISOString(), dailyNpcInteractionsCount: nextCount };\n          useHeroStore.getState().updateHero(player.id, { stats });\n        };\n        const runIfAllowed = (fn: () => void) => { if (!can) return; fn(); mark(); };\n        return (\n          <div>\n          <div className=\"mt-3 flex items-center gap-2 flex-wrap\">\n            <button onClick={() => runIfAllowed(() => actionConversar(npc, player))} className={`px-3 py-2 rounded ${can?`bg-gradient-to-r ${medievalTheme.gradients.buttons.secondary} text-white`:'bg-gray-700 text-gray-400 cursor-not-allowed'}`}> Conversar</button>\n            <button onClick={() => runIfAllowed(() => actionElogiar(npc, player))} className={`px-3 py-2 rounded ${can?`bg-gradient-to-r ${medievalTheme.gradients.buttons.royal} text-white`:'bg-gray-700 text-gray-400 cursor-not-allowed'}`}> Elogiar</button>\n            <button onClick={() => runIfAllowed(() => actionPedirAjuda(npc, player))} className={`px-3 py-2 rounded ${can?`bg-gradient-to-r ${medievalTheme.gradients.buttons.primary} text-white`:'bg-gray-700 text-gray-400 cursor-not-allowed'}`}> Pedir Ajuda</button>\n            <div className=\"flex items-center gap-2\">\n              <select id=\"gift-type\" className=\"px-2 py-1 border rounded text-sm bg-gray-900 text-gray-200 border-gray-700\">\n                <option value=\"pocao-media\">Poo</option>\n                <option value=\"flor-rara\">Flor</option>\n                <option value=\"pedra-magica\">Pedra</option>\n                <option value=\"essencia-vinculo\">Essncia</option>\n              </select>\n              <button onClick={() => {\n                const sel = (document.getElementById('gift-type') as HTMLSelectElement)?.value || 'pocao-media';\n                runIfAllowed(() => actionDarPresente(npc, player, sel));\n              }} className={`px-3 py-2 rounded ${can?`bg-gradient-to-r ${medievalTheme.gradients.buttons.success} text-white`:'bg-gray-700 text-gray-400 cursor-not-allowed'}`}> Dar Presente</button>\n            </div>\n            <button onClick={() => runIfAllowed(() => actionProvocar(npc, player))} className={`px-3 py-2 rounded ${can?`bg-gradient-to-r ${medievalTheme.gradients.buttons.danger} text-white`:'bg-gray-700 text-gray-400 cursor-not-allowed'}`}> Provocar</button>\n            <button onClick={() => {\n              if (!can) return;\n              const ok = restAtTavern(player.id, 25, 25, 'short_rest');\n              if (ok) {\n                const stats = { ...(player.stats as any) };\n                const gs = getGameSettings();\n                const until = new Date(Date.now() + (gs.restBuffDurationMinutes || 10) * 60 * 1000).toISOString();\n                updateHero(player.id, { stats: { ...stats, restBuffActiveUntil: until } });\n              }\n              mark();\n            }} className={`px-3 py-2 rounded ${can?`bg-gradient-to-r ${medievalTheme.gradients.buttons.secondary} text-white`:'bg-gray-700 text-gray-400 cursor-not-allowed'}`}> Descansar</button>\n            <button onClick={() => runIfAllowed(() => {\n              const stats = { ...(player.stats as any) };\n              const cd = stats.meditationBuffCooldownEndsAt ? new Date(stats.meditationBuffCooldownEndsAt).getTime() : 0;\n              if (cd && Date.now() < cd) return;\n              const gs = getGameSettings();\n              const until = new Date(Date.now() + (gs.meditationDurationMinutes || 2) * 60 * 1000).toISOString();\n              const cdUntil = new Date(Date.now() + (gs.meditationCooldownMinutes || 10) * 60 * 1000).toISOString();\n              updateHero(player.id, { stats: { ...stats, meditationBuffActiveUntil: until, meditationBuffCooldownEndsAt: cdUntil } });\n            })} className={`px-3 py-2 rounded bg-purple-700 text-white`}> Meditar</button>\n          </div>\n          {(() => {\n            const hs = (player.stats as any)?.helpStatus;\n            if (!hs || (hs.expiresAt && Date.now() > new Date(hs.expiresAt).getTime())) return null;\n            const msg = hs.type === 'boost_xp'\n              ? `Ajuda ativa: +${Math.round(((hs.boostXpPercent || 0) * 100))}% XP na prxima misso`\n              : hs.type === 'stamina_refill'\n              ? `Ajuda ativa: Stamina recuperada (+${hs.staminaRefillAmount || 10})`\n              : hs.type === 'reduce_cooldown'\n              ? `Ajuda ativa: Reduz cooldown de misso em ${hs.reduceCooldownMinutes || 5} min`\n              : hs.type === 'boost_initiative'\n              ? `Ajuda ativa: +${hs.initiativeBonus || 5} Iniciativa na prxima misso`\n              : hs.type === 'gold_bonus'\n              ? `Ajuda ativa: +${Math.round(((hs.goldBonusPercent || 0) * 100))}% ouro na prxima misso`\n              : hs.type === 'success_boost'\n              ? `Ajuda ativa: +${Math.round(((hs.successBoostPercent || 0) * 100))}% chance de sucesso`\n              : hs.type === 'stamina_discount'\n              ? `Ajuda ativa: Custo de Stamina reduzido em ${hs.staminaCostReduction || 1}`\n              : hs.type === 'loot_bonus'\n              ? `Ajuda ativa: Chance de loot +${Math.round(((hs.lootDropBonusPercent || 0) * 100))}%`\n              : `Ajuda ativa: Proteo contra emboscada (${Math.round(((hs.ambushReductionPercent || 0) * 100))}% menos risco/dano)`;\n            const icon = hs.type === 'boost_xp' ? '' : hs.type === 'stamina_refill' ? '' : hs.type === 'reduce_cooldown' ? '' : hs.type === 'gold_bonus' ? '' : hs.type === 'success_boost' ? '' : hs.type === 'stamina_discount' ? '' : hs.type === 'loot_bonus' ? '' : '';\n            return (<div className=\"mt-2 text-xs px-2 py-1 rounded bg-purple-900/30 border border-purple-600/30 text-purple-200 inline-flex items-center gap-2\">{icon} {msg}</div>);\n          })()}\n          {(() => {\n            const s: any = player.stats || {};\n            const restUntil = s.restBuffActiveUntil ? new Date(s.restBuffActiveUntil).getTime() : 0;\n            const medUntil = s.meditationBuffActiveUntil ? new Date(s.meditationBuffActiveUntil).getTime() : 0;\n            const medCd = s.meditationBuffCooldownEndsAt ? new Date(s.meditationBuffCooldownEndsAt).getTime() : 0;\n            const parts: string[] = [];\n            if (restUntil && Date.now() < restUntil) parts.push(`Descanso ativo`);\n            if (medUntil && Date.now() < medUntil) parts.push(`Meditao ativa`);\n            if (medCd && Date.now() < medCd && !(medUntil && Date.now() < medUntil)) parts.push(`Meditao em cooldown`);\n            if (!parts.length) return null;\n            return (<div className=\"mt-2 text-xs px-2 py-1 rounded bg-indigo-900/30 border border-indigo-600/30 text-indigo-200 inline-flex items-center gap-2\">{parts.join('  ')}</div>);\n          })()}\n          </div>\n        );\n      })()}\n    </div>\n  );\n};\n\nexport default TavernInteractions;","import { supabase, supabaseConfigured } from '../lib/supabaseClient';\n\nexport type TavernScope = 'global' | 'local';\n\nexport interface TavernMessage {\n  id: string;\n  author: string;\n  content: string;\n  scope: TavernScope;\n  created_at: string; // ISO string\n}\n\nexport interface TavernListResult {\n  data: TavernMessage[];\n  error?: string;\n  offline?: boolean;\n}\n\nexport async function listMessages(scope: TavernScope = 'global', limit = 50): Promise<TavernListResult> {\n  if (!supabaseConfigured) {\n    return { data: [], error: 'Supabase desabilitado: exibindo chat offline.', offline: true };\n  }\n\n  try {\n    const { data, error } = await supabase\n      .schema('public')\n      .from('tavern_messages')\n      .select('id, author, content, scope, created_at')\n      .eq('scope', scope)\n      .order('created_at', { ascending: false })\n      .limit(limit);\n\n    if (error) {\n      const msg = String(error.message || '').toLowerCase();\n      const friendly = (msg.includes('schema cache') || msg.includes('does not exist'))\n        ? 'Tabelas da Taverna no encontradas. Aplique supabase/tavern.sql no seu projeto Supabase.'\n        : `Erro ao carregar mensagens: ${error.message}`;\n      return { data: [], error: friendly };\n    }\n    return { data: (data as TavernMessage[]) || [] };\n  } catch (err: any) {\n    return { data: [], error: `Falha ao listar mensagens: ${err?.message || 'erro desconhecido'}` };\n  }\n}\n\nexport interface SendMessageResult {\n  ok: boolean;\n  error?: string;\n  offline?: boolean;\n  message?: TavernMessage;\n  pendingApproval?: boolean;\n}\n\nexport async function sendMessage(author: string, content: string, scope: TavernScope = 'global'): Promise<SendMessageResult> {\n  const trimmed = (content || '').trim();\n  if (!trimmed) {\n    return { ok: false, error: 'Mensagem vazia.' };\n  }\n\n  if (!supabaseConfigured) {\n    // Retorna como offline; o componente deve gerenciar estado local\n    const offlineMsg: TavernMessage = {\n      id: `offline-${Date.now()}`,\n      author,\n      content: trimmed,\n      scope,\n      created_at: new Date().toISOString(),\n    };\n    return { ok: true, offline: true, message: offlineMsg };\n  }\n\n  try {\n    const { data, error } = await supabase\n      .schema('public')\n      .from('tavern_messages')\n      .insert({ author, content: trimmed, scope })\n      .select('id, author, content, scope, created_at')\n      .single();\n\n    if (error) {\n      const msg = String(error.message || '').toLowerCase();\n      const friendly = (msg.includes('schema cache') || msg.includes('does not exist'))\n        ? 'Tabelas da Taverna no encontradas. Aplique supabase/tavern.sql no seu projeto Supabase.'\n        : `Erro ao enviar: ${error.message}`;\n      return { ok: false, error: friendly };\n    }\n    return { ok: true, message: data as TavernMessage };\n  } catch (err: any) {\n    return { ok: false, error: `Falha ao enviar mensagem: ${err?.message || 'erro desconhecido'}` };\n  }\n}\n\nexport async function sendMessageForApproval(author: string, content: string, scope: TavernScope = 'global'): Promise<SendMessageResult> {\n  const trimmed = (content || '').trim();\n  if (!trimmed) {\n    return { ok: false, error: 'Mensagem vazia.' };\n  }\n  if (!supabaseConfigured) {\n    const offlineMsg: TavernMessage = {\n      id: `offline-${Date.now()}`,\n      author,\n      content: trimmed,\n      scope,\n      created_at: new Date().toISOString(),\n    };\n    return { ok: true, offline: true, message: offlineMsg };\n  }\n  try {\n    // Insere como no aprovada; RLS impedir retorno no select\n    const { error } = await supabase\n      .schema('public')\n      .from('tavern_messages')\n      .insert({ author, content: trimmed, scope, approved: false });\n    if (error) {\n      const msg = String(error.message || '').toLowerCase();\n      const friendly = (msg.includes('schema cache') || msg.includes('does not exist'))\n        ? 'Tabelas da Taverna no encontradas. Aplique supabase/tavern.sql no seu projeto Supabase.'\n        : `Erro ao enviar para aprovao: ${error.message}`;\n      return { ok: false, error: friendly };\n    }\n    // Retorna uma cpia local marcada como pendente\n    const pending: TavernMessage = {\n      id: `pending-${Date.now()}`,\n      author,\n      content: `${trimmed} (pendente de aprovao)`,\n      scope,\n      created_at: new Date().toISOString(),\n    };\n    return { ok: true, message: pending, pendingApproval: true };\n  } catch (err: any) {\n    return { ok: false, error: `Falha ao enviar para aprovao: ${err?.message || 'erro desconhecido'}` };\n  }\n}\n\nexport function moderateMessage(content: string): { ok: boolean; sanitized: string; reason?: string } {\n  const trimmed = (content || '').trim();\n  if (!trimmed) return { ok: false, sanitized: '', reason: 'Mensagem vazia.' };\n  if (trimmed.length > 500) return { ok: false, sanitized: trimmed.slice(0, 500), reason: 'Muito longa.' };\n  // Simples moderao placeholder (poderemos integrar um servio real depois)\n  return { ok: true, sanitized: trimmed };\n}\n\nexport async function reportMessage(messageId: string, reason: string, autoHide = false, userId?: string): Promise<{ ok: boolean; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern-report', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ messageId, reason, autoHide, userId })\n    });\n    if (!resp.ok) {\n      const err = await resp.json().catch(() => ({}));\n      return { ok: false, error: err?.error || 'Falha ao enviar denncia' };\n    }\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro desconhecido ao denunciar' };\n  }\n}\n\nexport async function adminListPendingMessages(adminToken: string): Promise<{ pending: TavernMessage[]; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern-approve', {\n      method: 'GET',\n      headers: { 'Authorization': `Bearer ${adminToken}` }\n    });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { pending: [], error: json?.error || 'Falha ao listar pendentes' };\n    }\n    return { pending: (json?.pending || []) as TavernMessage[] };\n  } catch (err: any) {\n    return { pending: [], error: err?.message || 'Erro ao listar pendentes' };\n  }\n}\n\nexport async function adminSetMessageApproval(messageId: string, approved: boolean, adminToken: string): Promise<{ ok: boolean; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern-approve', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${adminToken}` },\n      body: JSON.stringify({ messageId, approved })\n    });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { ok: false, error: json?.error || 'Falha ao atualizar aprovao' };\n    }\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro ao atualizar aprovao' };\n  }\n}\n\nexport async function generateRumorsAI(scope: TavernScope = 'global', extraContext: string = ''): Promise<{ rumors: string[]; error?: string }>{\n  try {\n    // Coleta de contexto leve: ltimas mensagens aprovadas do escopo\n    let contextPieces: string[] = [];\n    if (supabaseConfigured && !import.meta.env.DEV) {\n      const list = await listMessages(scope, 10);\n      if (list.data && list.data.length > 0) {\n        const parts = list.data.slice(0, 5).map(m => `Autor: ${m.author}; Contedo: ${m.content}`);\n        contextPieces.push(...parts);\n      }\n    }\n    if (extraContext) contextPieces.push(extraContext);\n    const prompt = `Gere 5 rumores curtos, em portugus, no estilo fantasia medieval, cada um em uma linha, baseados nestes fatos do chat da taverna:\n${contextPieces.length ? contextPieces.join('\\n') : 'Sem fatos disponveis hoje.'}\nRegras: mximo 120 caracteres por rumor, sem spoilers, tom leve e divertido.`;\n\n    const resp = await fetch('/api/hf-text', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ prompt, maxTokens: 256, temperature: 0.8 })\n    });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      const msg = json?.error?.message || json?.error || 'Falha ao gerar rumores';\n      return { rumors: [], error: msg };\n    }\n    const text = (json?.text || json?.resultado || '') as string;\n    const lines = String(text)\n      .split(/\\r?\\n/)\n      .map(s => s.replace(/^[-\\d.\\)\\s]+/, '').trim())\n      .filter(s => s.length > 0)\n      .slice(0, 5);\n    return { rumors: lines };\n  } catch (err: any) {\n    return { rumors: [], error: err?.message || 'Erro desconhecido ao gerar rumores' };\n  }\n}\n\nexport interface DiceEventPayload {\n  heroId: string;\n  heroName: string;\n  roll: number;\n  critical?: boolean;\n  betAmount?: number;\n  opponentName?: string;\n}\n\nexport async function recordDiceEvent(ev: DiceEventPayload): Promise<{ ok: boolean; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=dice', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(ev)\n    });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { ok: false, error: json?.error || 'Falha ao registrar evento de dados' };\n    }\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro desconhecido ao registrar evento de dados' };\n  }\n}\n\nexport interface WeeklyDiceEntry { heroName: string; best: number; crits: number; count: number }\nexport async function getWeeklyDiceLeadersServer(): Promise<{ entries: WeeklyDiceEntry[]; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=dice-weekly', { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { entries: [], error: json?.error || 'Falha ao obter ranking semanal' };\n    }\n    return { entries: (json?.entries || []) as WeeklyDiceEntry[] };\n  } catch (err: any) {\n    return { entries: [], error: err?.message || 'Erro desconhecido ao obter ranking semanal' };\n  }\n}\n\nexport async function getWeeklyChampions(): Promise<{ champions: { week_start: string; week_end: string; hero_name: string; score: number }[]; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=dice-weekly-champions', { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { champions: [], error: json?.error || 'Falha ao obter campees' };\n    }\n    return { champions: (json?.champions || []) as any[] };\n  } catch (err: any) {\n    return { champions: [], error: err?.message || 'Erro desconhecido ao obter campees' };\n  }\n}\n\nexport async function snapshotWeeklyChampion(adminToken: string): Promise<{ ok: boolean; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=dice-weekly-snapshot', { method: 'POST', headers: { 'Authorization': `Bearer ${adminToken}` } });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { ok: false, error: json?.error || 'Falha ao criar snapshot semanal' };\n    }\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro desconhecido ao criar snapshot' };\n  }\n}\n\nexport async function getNextWeeklySnapshot(tzOffsetMin?: number): Promise<{ nextSnapshotAt?: string; error?: string }>{\n  try {\n    const qs = typeof tzOffsetMin === 'number' ? `&tz_offset_min=${tzOffsetMin}` : '';\n    const resp = await fetch(`/api/tavern?action=dice-weekly-next${qs}`, { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { error: json?.error || 'Falha ao obter prxima execuo' };\n    }\n    return { nextSnapshotAt: json?.nextSnapshotAt };\n  } catch (err: any) {\n    return { error: err?.message || 'Erro desconhecido ao obter prxima execuo' };\n  }\n}\n\nexport async function snapshotWeeklyChampionAuto(adminToken: string): Promise<{ ok: boolean; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=dice-weekly-snapshot-auto', { method: 'POST', headers: { 'Authorization': `Bearer ${adminToken}` } });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) {\n      return { ok: false, error: json?.error || 'Falha ao criar snapshot automtico' };\n    }\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro desconhecido ao criar snapshot automtico' };\n  }\n}\n\nexport async function getTavernSettings(): Promise<{ settings: Record<string, string>; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=settings-get', { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { settings: {}, error: json?.error || 'Falha ao obter configuraes' };\n    const list = Array.isArray(json?.settings) ? json.settings : [];\n    const map: Record<string, string> = {};\n    list.forEach((s: any) => { if (s && s.key) map[s.key] = String(s.value || ''); });\n    return { settings: map };\n  } catch (err: any) {\n    return { settings: {}, error: err?.message || 'Erro ao obter configuraes' };\n  }\n}\n\nexport async function setTavernSettings(adminToken: string, settings: { tz_offset_min?: number; reroll_daily_cap?: number }): Promise<{ ok: boolean; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=settings-set', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${adminToken}` }, body: JSON.stringify(settings) });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { ok: false, error: json?.error || 'Falha ao salvar configuraes' };\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro ao salvar configuraes' };\n  }\n}\n\nexport async function setSupporterCap(adminToken: string, heroId: string, cap_bonus: number): Promise<{ ok: boolean; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=supporter-set', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${adminToken}` }, body: JSON.stringify({ heroId, cap_bonus }) });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { ok: false, error: json?.error || 'Falha ao definir cap bnus' };\n    return { ok: true };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro ao definir cap bnus' };\n  }\n}\n\nexport async function getCronStatus(): Promise<{ nextSnapshotAt?: string; lastSnapshotAt?: string; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=dice-weekly-cron-status', { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { error: json?.error || 'Falha ao obter status do cron' };\n    return { nextSnapshotAt: json?.nextSnapshotAt, lastSnapshotAt: json?.lastSnapshotAt };\n  } catch (err: any) {\n    return { error: err?.message || 'Erro ao obter status do cron' };\n  }\n}\n\nexport async function getCronLogs(): Promise<{ logs: Array<{ executed_at: string; status: string; message?: string }>; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=dice-weekly-cron-logs', { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { logs: [], error: json?.error || 'Falha ao obter logs' };\n    return { logs: Array.isArray(json?.logs) ? json.logs : [] };\n  } catch (err: any) {\n    return { logs: [], error: err?.message || 'Erro ao obter logs' };\n  }\n}\n\nexport async function getRerollUsage(heroId: string): Promise<{ count: number; cap: number; error?: string }>{\n  try {\n    const resp = await fetch(`/api/tavern?action=reroll-usage-get&heroId=${encodeURIComponent(heroId)}`, { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { count: 0, cap: 5, error: json?.error || 'Falha ao obter uso dirio' };\n    return { count: Number(json?.count || 0), cap: Number(json?.cap || 5) };\n  } catch (err: any) {\n    return { count: 0, cap: 5, error: err?.message || 'Erro ao obter uso dirio' };\n  }\n}\n\nexport async function incrementRerollUsage(heroId: string): Promise<{ ok: boolean; count?: number; cap?: number; reason?: string; error?: string }>{\n  try {\n    const resp = await fetch('/api/tavern?action=reroll-usage-increment', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ heroId }) });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { ok: false, error: json?.error || 'Falha ao incrementar' };\n    return { ok: !!json?.ok, count: json?.count, cap: json?.cap, reason: json?.reason };\n  } catch (err: any) {\n    return { ok: false, error: err?.message || 'Erro ao incrementar' };\n  }\n}\n\nexport async function getRerollUsageHistory(heroId: string, days: number = 7): Promise<{ history: Array<{ usage_date: string; count: number }>; cap: number; error?: string }>{\n  try {\n    const resp = await fetch(`/api/tavern?action=reroll-usage-history&heroId=${encodeURIComponent(heroId)}&days=${days}`, { method: 'GET' });\n    const json = await resp.json().catch(() => ({}));\n    if (!resp.ok) return { history: [], cap: 5, error: json?.error || 'Falha ao obter histrico' };\n    return { history: Array.isArray(json?.history) ? json.history : [], cap: Number(json?.cap || 5) };\n  } catch (err: any) {\n    return { history: [], cap: 5, error: err?.message || 'Erro ao obter histrico' };\n  }\n}\n","import React, { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { getWeeklyDungeonHighlights } from '../services/dungeonService';\nimport { activityManager, logActivity } from '../utils/activitySystem';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes, getSeasonalButtonGradient } from '../styles/medievalTheme';\nimport { tokens } from '../styles/designTokens';\nimport { notificationBus } from './NotificationSystem';\nimport NPCPresenceLayer from './NPCPresenceLayer';\nimport TavernInteractions from './TavernInteractions';\nimport DialogueFrame from './DialogueFrame';\nimport ActivitiesPanel from './ActivitiesPanel';\nimport { getNPCDialogue } from '../services/npcDialogueService';\nimport { runTick } from '../utils/npcAI';\nimport { getTavernSettings, recordDiceEvent, incrementRerollUsage, generateRumorsAI } from '../services/tavernService';\n\ntype Tab = 'npcs' | 'eventos' | 'descanso';\n\nconst sampleRumors = (heroName?: string) => {\n  const today = new Date().toISOString().slice(0, 10);\n  return [\n    `Ouvi dizer que um drago despertou nas minas do 12 andar (${today})`,\n    `Algum viu o novo aventureiro ${heroName || 'um heri misterioso'}? Derrotou um troll sozinho!`,\n    'Dizem que o Festival de Lorien comea amanh  tragam suas moedas raras!',\n    'O mago da Torre de Cristal anda nervoso algo sobre um artefato perdido.',\n  ];\n};\n\nconst dailyEvents = [\n  ' Promoo: hidromel por metade do preo at o pr do sol!',\n  ' Concurso de histrias: melhor conto ganha um ttulo temporrio.',\n  ' Noite de dados: quem tirar 20 ganha medalha no perfil!',\n  ' Bardo itinerante: canes picas aps o cair da noite.',\n  ' Velas da sorte: acenda uma e receba um pequeno bnus de XP.',\n];\n\nfunction pickDailyEvent() {\n  const dayIdx = Math.floor(Date.now() / (1000 * 60 * 60 * 24)) % dailyEvents.length;\n  return dailyEvents[dayIdx];\n}\n\nconst Tavern: React.FC = () => {\n  const { getSelectedHero, restAtTavern } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  const { activeSeasonalTheme } = useMonetizationStore();\n\n  const [tab, setTab] = useState<Tab>('npcs');\n  const [mural, setMural] = useState<string[]>([]);\n  const [generatedRumors, setGeneratedRumors] = useState<string[]>([]);\n  const [rumorsLoading, setRumorsLoading] = useState<boolean>(false);\n  const [rumorsError, setRumorsError] = useState<string | undefined>(undefined);\n  const [rumorIntervalSec, setRumorIntervalSec] = useState<number>(60);\n  const [rumorStats, setRumorStats] = useState<Record<string, number>>({});\n  const [rumorFilter, setRumorFilter] = useState<'all'|'player'|'npc'>('all');\n  const [lastRumorTs, setLastRumorTs] = useState<string | null>(null);\n  const [error, setError] = useState<string | undefined>(undefined);\n  // Descanso\n  const [restMessage, setRestMessage] = useState<string | null>(null);\n  // Dados: Noite de Dados Especial\n  const [diceRolling, setDiceRolling] = useState<boolean>(false);\n  const [lastRoll, setLastRoll] = useState<number | null>(null);\n  const [criticalGlow, setCriticalGlow] = useState<boolean>(false);\n  const [diceMessage, setDiceMessage] = useState<string | null>(null);\n  const [rerollCap, setRerollCap] = useState<number>(5);\n  const [rollCap, setRollCap] = useState<number>(10);\n  const [npcDiceResults, setNpcDiceResults] = useState<Array<{ id: string; name: string; roll: number; critical: boolean }>>([]);\n  const getRerollTokens = () => {\n    const hero = useHeroStore.getState().getSelectedHero();\n    return hero ? Number(((hero.stats as any)?.tavernRerollTokens) || 0) : 0;\n  };\n  const getRerollDaily = () => {\n    const hero = useHeroStore.getState().getSelectedHero();\n    if (!hero) return { count: 0, cap: rerollCap };\n    const s: any = hero.stats || {};\n    const d = s.tavernRerollDate ? new Date(s.tavernRerollDate) : null;\n    const today = new Date();\n    const sameDay = d && d.toDateString() === today.toDateString();\n    const count = sameDay ? Number(s.tavernRerollCount || 0) : 0;\n    return { count, cap: rerollCap };\n  };\n  const getRollDaily = () => {\n    const hero = useHeroStore.getState().getSelectedHero();\n    if (!hero) return { count: 0, cap: rollCap };\n    const s: any = hero.stats || {};\n    const d = s.tavernRollDate ? new Date(s.tavernRollDate) : null;\n    const today = new Date();\n    const sameDay = d && d.toDateString() === today.toDateString();\n    const count = sameDay ? Number(s.tavernRollCount || 0) : 0;\n    return { count, cap: rollCap };\n  };\n  const offlineRumors = useMemo(() => sampleRumors(selectedHero?.name), [selectedHero?.name]);\n  const todayEvent = useMemo(() => pickDailyEvent(), []);\n  const heroes = useHeroStore.getState().heroes;\n  const npcs = useMemo(() => heroes.filter(h => h.origin === 'npc'), [heroes.length]);\n  const [activeDialogue, setActiveDialogue] = useState<string | null>(null);\n\n  const simulateNPCDiceNight = async () => {\n    const state = useHeroStore.getState();\n    const allHeroes = state.heroes || [];\n    const npcList = allHeroes.filter(h => h.origin === 'npc');\n    const todayStr = new Date().toDateString();\n    const cap = Math.min(8, npcList.length);\n    const selected = npcList.slice().sort(() => Math.random() - 0.5).slice(0, cap);\n    const results: Array<{ id: string; name: string; roll: number; critical: boolean }> = [];\n    for (const n of selected) {\n      const s: any = n.stats || {};\n      const prevDate = s.tavernDiceLastDate ? new Date(s.tavernDiceLastDate).toDateString() : '';\n      if (prevDate === todayStr) continue;\n      const roll = Math.floor(Math.random() * 20) + 1;\n      const critical = roll === 20;\n      results.push({ id: n.id, name: n.name, roll, critical });\n      try { logActivity.tavernDice({ heroId: n.id, heroName: n.name, heroClass: n.class, heroLevel: n.progression.level, roll, critical } as any); } catch {}\n      try { await recordDiceEvent({ heroId: n.id, heroName: n.name, roll, critical }); } catch {}\n      const stats = { ...s, tavernDiceLastDate: new Date().toISOString(), tavernDiceLastRoll: roll, tavernDiceRolls: (s.tavernDiceRolls || 0) + 1, tavernCrits: (s.tavernCrits || 0) + (critical ? 1 : 0), tavernBestRoll: Math.max(roll, s.tavernBestRoll || 0) };\n      const updates: any = { stats };\n      if (critical) {\n        try { state.gainXP(n.id, 100); } catch {}\n        const title = { id: 'mestre-dos-dados', name: 'Mestre dos Dados', description: 'Obteve um crtico (20) na Noite de Dados', rarity: 'especial', category: 'special', badge: '', unlockedAt: new Date() } as any;\n        const hasTitle = (n.titles || []).some((t: any) => t.id === 'mestre-dos-dados');\n        if (!hasTitle) {\n          updates.titles = [ ...(n.titles || []), title ];\n        }\n      }\n      try { state.updateHero(n.id, updates); } catch {}\n    }\n    if (results.length) setNpcDiceResults(results);\n  };\n\n  const injectTavernQuests = () => {\n    const state = useHeroStore.getState();\n    const existing = state.availableQuests || [];\n    const ids = new Set(existing.map(q => String(q.id)));\n    const hero = state.getSelectedHero();\n    const baseLevel = Math.max(1, hero?.progression.level || 1);\n    const quests = [\n      {\n        id: 'tavern-delivery',\n        title: 'Entrega de Barris',\n        description: 'Leve barris do depsito  rea do balco sem derramar.',\n        type: 'contrato', difficulty: 'facil', levelRequirement: baseLevel,\n        rewards: { gold: 20, xp: 25 }, repeatable: true, sticky: true,\n        categoryHint: 'controle', biomeHint: 'cidade', narrative: { intro: 'O taberneiro precisa de ajuda com um carregamento.' , situation: 'Mover barris com cuidado pelo salo.' }\n      },\n      {\n        id: 'tavern-help',\n        title: 'Ajudar o Taberneiro',\n        description: 'Sirva clientes e acalme uma discusso antes que vire confuso.',\n        type: 'historia', difficulty: 'medio', levelRequirement: baseLevel,\n        rewards: { gold: 30, xp: 40 }, repeatable: true, sticky: true,\n        categoryHint: 'especial', biomeHint: 'cidade', narrative: { intro: 'Hora do pico, o salo est cheio.' , situation: 'Manter a ordem e atender pedidos.' }\n      },\n      {\n        id: 'tavern-bard',\n        title: 'Evento do Bardo',\n        description: 'Auxilie o bardo com o set, promova o show e gerencie o pblico.',\n        type: 'historia', difficulty: 'medio', levelRequirement: baseLevel,\n        rewards: { gold: 25, xp: 50 }, repeatable: true, sticky: true,\n        categoryHint: 'especial', biomeHint: 'cidade', narrative: { intro: 'O bardo itinerante precisa de suporte.' , situation: 'Garantir que o espetculo ocorra sem incidentes.' }\n      }\n    ] as any[];\n    const toAdd = quests.filter(q => !ids.has(String(q.id)));\n    if (toAdd.length) {\n      useHeroStore.setState({ availableQuests: [...toAdd, ...existing] });\n    }\n  };\n\n  useEffect(() => {\n    if (!generatedRumors.length) {\n      setGeneratedRumors(offlineRumors);\n      setLastRumorTs(new Date().toISOString());\n    }\n  }, [offlineRumors]);\n\n  useEffect(() => {\n    let timer: any = null;\n    if (tab === 'npcs') {\n      timer = setInterval(() => {\n        try { runTick(selectedHero, npcs, notificationBus.emit); } catch {}\n      }, 30000);\n    }\n    return () => { if (timer) try { clearInterval(timer); } catch {} };\n  }, [tab, selectedHero?.id, npcs.length]);\n\n  useEffect(() => {\n    injectTavernQuests();\n  }, [selectedHero?.id]);\n\n  useEffect(() => {\n    try { useHeroStore.getState().triggerAutoInteraction('tavern'); } catch {}\n  }, [selectedHero?.id]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const sres = await getTavernSettings();\n        const capStr = sres.settings?.['reroll_daily_cap'];\n        const v = Number(capStr);\n        if (!isNaN(v) && v > 0) setRerollCap(v);\n        const rollCapStr = sres.settings?.['roll_daily_cap'];\n        const vr = Number(rollCapStr);\n        if (!isNaN(vr) && vr > 0) setRollCap(vr);\n      } catch {}\n    })();\n  }, []);\n\n  useEffect(() => { setError(undefined); }, [tab]);\n\n  useEffect(() => {\n    let timer: any = null;\n    if (tab === 'eventos') {\n      simulateNPCDiceNight();\n    }\n    return () => { if (timer) { try { clearInterval(timer); } catch {} } };\n  }, [tab, rumorFilter, rumorIntervalSec]);\n\n  const startDialogueWithNPC = () => {\n    try {\n      const player = useHeroStore.getState().getSelectedHero();\n      const pool = npcs.length ? npcs : [];\n      const npc = pool.length ? pool[Math.floor(Math.random() * pool.length)] : undefined;\n      if (npc && player) {\n        const line = getNPCDialogue(npc, player, 'taverna  ambiente social');\n        setActiveDialogue(line);\n      } else {\n        setActiveDialogue('Nenhum NPC disponvel agora.');\n      }\n    } catch { setActiveDialogue('Falha ao iniciar dilogo.'); }\n  };\n\n  const promoteToMural = (content: string) => {\n    setMural(prev => [content, ...prev]);\n  };\n\n  const handleGenerateRumors = async () => {\n    setRumorsError(undefined);\n    setRumorsLoading(true);\n    try {\n      const state = useHeroStore.getState();\n      const player = state.getSelectedHero();\n      const heroesAll = state.heroes || [];\n      const npcsLocal = heroesAll.filter(h => h.origin === 'npc');\n      const now = new Date();\n      const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n      const feed = activityManager.getActivityFeed({ dateRange: { start: weekAgo, end: now }, showOnlyPublic: true });\n      const acts = feed.activities;\n\n      const makeTag = (t: string) => {\n        if (t.includes('quest')) return 'quest';\n        if (t.includes('rank')) return 'rank';\n        if (t.includes('dice')) return 'tavern-dice';\n        if (t.includes('rest')) return 'tavern-rest';\n        if (t.includes('guild')) return 'guild';\n        if (t.includes('pet')) return 'pet';\n        if (t.includes('combat')) return 'combat';\n        return 'misc';\n      };\n      const importance = (type: string) => {\n        return type === 'epic-quest-completed' ? 10\n          : type === 'rank-promotion' ? 9\n          : type === 'quest-completed' ? 7\n          : type === 'combat-victory' ? 6\n          : type === 'tavern-dice' ? 5\n          : type === 'tavern-rest' ? 3\n          : type === 'item-used' ? 2\n          : 1;\n      };\n      const recencyBoost = (d: Date) => {\n        const diff = Math.max(0, now.getTime() - d.getTime());\n        const hours = diff / 3_600_000;\n        return hours <= 6 ? 3 : hours <= 24 ? 2 : hours <= 72 ? 1 : 0;\n      };\n      const playerActs = player ? acts.filter(a => a.data.heroId === player.id) : [];\n      const npcRumorFromMemory = (n: any) => {\n        const last = (n.npcMemory?.interactions || []).slice(-5);\n        const lines = last.map((m: any) => {\n          const t = String(m.summary || '');\n          const date = new Date(m.ts || Date.now());\n          const tag = t.includes('missao') ? 'quest' : t.includes('social') ? 'social' : t.includes('treino') ? 'training' : t.includes('mercado') ? 'market' : t.includes('exploracao') ? 'exploration' : 'npc';\n          const base = t.includes('missao') ? 6 : t.includes('social_hostil') ? 5 : t.includes('social_amigavel') ? 4 : t.includes('exploracao') ? 3 : 2;\n          const weight = base + recencyBoost(date);\n          const msg = tag === 'quest' ? `${n.name} concluiu uma misso recente  rumores dizem que foi arriscada.`\n            : tag === 'social' ? `${n.name} esteve envolvido em uma interao social (${t.replace('social_','')}).`\n            : tag === 'training' ? `${n.name} treinou duro hoje, dizem que ganhou vigor.`\n            : tag === 'market' ? `${n.name} fez trocas no mercado; alguns itens chamaram ateno.`\n            : `${n.name} explorou reas prximas e voltou com histrias.`;\n          return { content: msg, tag, date, weight, source: 'npc' as const };\n        });\n        return lines;\n      };\n\n      const wrapPlayer = playerActs.map(a => {\n        const tag = makeTag(a.type);\n        const w = importance(a.type) + recencyBoost(a.timestamp);\n        const msg = a.type === 'epic-quest-completed' ? `Fala-se que ${a.data.heroName} venceu uma misso pica: \"${a.data.questName}\".`\n          : a.type === 'quest-completed' ? `${a.data.heroName} concluiu \"${a.data.questName}\" (${a.data.questDifficulty || ''}).`\n          : a.type === 'rank-promotion' ? `${a.data.heroName} foi promovido ao Rank ${a.data.newRank}.`\n          : a.type === 'combat-victory' ? `${a.data.heroName} derrotou ${Array.isArray(a.data.enemiesDefeated) ? (a.data.enemiesDefeated.length === 1 ? a.data.enemiesDefeated[0] : `${a.data.enemiesDefeated.length} inimigos`) : 'inimigos'}.`\n          : a.type === 'tavern-dice' ? `${a.data.heroName} rolou ${((a.data as any).roll)} na Noite de Dados${(a.data as any).critical ? '  dizem que foi CRTICO!' : ''}.`\n          : a.type === 'tavern-rest' ? `${a.data.heroName} descansou na taverna e recuperou ${a.data.fatigueRecovered || 0} de Fadiga.`\n          : a.type === 'item-used' ? `${a.data.heroName} usou ${a.data.itemName || 'um item'} (${a.data.hpRecovered ? `+${a.data.hpRecovered} HP` : ''}${a.data.mpRecovered ? ` +${a.data.mpRecovered} MP` : ''}).`\n          : `${a.data.heroName} realizou ${a.type}.`;\n        return { content: msg, tag, date: a.timestamp, weight: w, source: 'player' as const };\n      });\n\n      const npcLines = npcsLocal.flatMap(n => npcRumorFromMemory(n));\n      const merge = [...wrapPlayer, ...npcLines].sort((a, b) => b.weight - a.weight);\n      const count = Math.min(10, merge.length);\n      const playerCount = Math.floor(count * 0.5);\n      const npcCount = count - playerCount;\n      const playerPool = merge.filter(r => r.source === 'player').slice(0, playerCount);\n      const npcPool = merge.filter(r => r.source === 'npc').slice(0, npcCount);\n      const selected = [...playerPool, ...npcPool].sort((a,b) => b.date.getTime() - a.date.getTime());\n      const filtered = rumorFilter === 'all' ? selected : selected.filter(r => r.source === rumorFilter);\n      const lines = filtered.map(r => `${r.content} (${r.date.toISOString().slice(0,10)}) [#${r.tag}]`);\n      const stats: Record<string, number> = {};\n      filtered.forEach(r => { stats[r.tag] = (stats[r.tag] || 0) + 1; });\n      setRumorStats(stats);\n      setGeneratedRumors(lines);\n      setLastRumorTs(new Date().toISOString());\n    } catch (e: any) {\n      setRumorsError(e?.message || 'Falha ao gerar rumores.');\n    } finally {\n      setRumorsLoading(false);\n    }\n  };\n\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-white/20' : 'border-white/20';\n  return (\n    <div className=\"max-w-5xl mx-auto p-6\">\n      <div className={`bg-white/10 border ${seasonalBorder} rounded-lg p-6`}>\n        <div className=\"flex items-center justify-between bg-gradient-to-r from-royal-900/20 via-amber-800/10 to-transparent px-3 py-2 rounded\">\n          <div>\n            <h1 className=\"text-2xl md:text-3xl font-bold text-amber-300\"> Taverna \"Pnei Saltitante\"</h1>\n            <p className=\"text-sm text-gray-300\">Rumores, comunidade e roleplay assncrono.</p>\n            {selectedHero && (() => {\n              const now = new Date();\n              const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n              const feed = activityManager.getActivityFeed({ dateRange: { start: weekAgo, end: now }, showOnlyPublic: true });\n              const acts = feed.activities.filter(a => a.type === 'tavern-dice' || a.type === 'tavern-rest');\n              const score: Record<string, number> = {};\n              acts.forEach(a => {\n                const name = a.data.heroName;\n                if (!name) return;\n                const isDice = a.type === 'tavern-dice';\n                const isRest = a.type === 'tavern-rest';\n                const crit = isDice ? Number(!!(a.data as any).critical) : 0;\n                score[name] = (score[name] || 0) + (isDice ? (crit * 10 + 2) : (isRest ? 1 : 0));\n              });\n              const entries = Object.entries(score).sort((a,b) => b[1] - a[1]);\n              const topName = entries[0]?.[0];\n              if (topName && topName === selectedHero.name) {\n                return <span className=\"mt-1 inline-flex items-center gap-1 text-xs text-amber-300\"> Campeo da Semana</span>;\n              }\n              return null;\n            })()}\n          </div>\n          <div className=\"text-3xl\"></div>\n        </div>\n\n        <div className=\"mt-3 bg-amber-900/30 border border-amber-500/40 text-amber-200 text-xs md:text-sm px-3 py-2 rounded\">\n          Ambiente focado em single-player: interaja com NPCs, eventos e descanso.\n        </div>\n\n        <div className=\"mt-4 flex gap-2\">\n          <button\n            onClick={() => setTab('npcs')}\n            className={`px-3 py-2 rounded ${tab === 'npcs' ? tokens.tabActive : tokens.tabInactive}`}\n          >\n             NPCs\n          </button>\n          <button\n            onClick={() => setTab('eventos')}\n            className={`px-3 py-2 rounded ${tab === 'eventos' ? tokens.tabActive : tokens.tabInactive}`}\n          >\n             Eventos da Taverna\n          </button>\n          <button\n            onClick={() => setTab('descanso')}\n            className={`px-3 py-2 rounded ${tab === 'descanso' ? tokens.tabActive : tokens.tabInactive}`}\n          >\n             Descanso\n          </button>\n        </div>\n\n        {tab === 'npcs' && (\n          <div className=\"mt-6 space-y-4\">\n            <TavernInteractions />\n            <NPCPresenceLayer />\n          </div>\n        )}\n\n        {null}\n\n        {tab === 'eventos' && (\n          <div className=\"mt-6\">\n            <h2 className=\"text-xl font-semibold text-amber-300 mb-2\">Eventos de Hoje</h2>\n            <div className=\"bg-gray-800/60 border border-white/10 rounded p-3 text-gray-200\">\n              {todayEvent}\n            </div>\n            <div className=\"text-xs text-gray-400 mt-2\">\n              Uma fofoca diferente surge a cada dia. Participe para ganhar prestgio!\n            </div>\n\n            \n\n            {/* Noite de Dados Especial */}\n            <div className=\"mt-6 bg-gradient-to-br from-royal-900/30 via-amber-800/10 to-transparent border border-amber-500/30 rounded p-4\">\n              <h3 className=\"text-lg font-semibold text-amber-300 flex items-center gap-2\"> Noite de Dados Especial</h3>\n              <p className=\"text-sm text-gray-300 mt-1\">Role um d20. Se tirar 20 (crtico): medalha por 7 dias, ttulo \"Mestre dos Dados\" e +100 XP.</p>\n              <div className=\"mt-3 flex items-center gap-3 flex-wrap\">\n                <button\n                  onClick={async () => {\n                    if (diceRolling) return;\n                    const rd = getRollDaily();\n                    if (rd.count >= rd.cap) { setDiceMessage('Limite dirio de rolagens atingido'); return; }\n                    setDiceRolling(true);\n                    setCriticalGlow(false);\n                    setDiceMessage(null);\n                    await new Promise(r => setTimeout(r, 600));\n                    const roll = Math.floor(Math.random() * 20) + 1;\n                    setLastRoll(roll);\n                    const isCrit = roll === 20;\n                    if (selectedHero) {\n                      try {\n                        logActivity.tavernDice({\n                          heroId: selectedHero.id,\n                          heroName: selectedHero.name,\n                          heroClass: selectedHero.class,\n                          heroLevel: selectedHero.progression.level,\n                          roll,\n                          critical: isCrit,\n                          betAmount: betAmount > 0 ? betAmount : undefined\n                        } as any);\n                      } catch {}\n                      try { await recordDiceEvent({ heroId: selectedHero.id, heroName: selectedHero.name, roll, critical: isCrit, betAmount: betAmount > 0 ? betAmount : undefined }); } catch {}\n                      try {\n                        const heroNow = useHeroStore.getState().getSelectedHero();\n                        if (heroNow) {\n                          const s = { ...(heroNow.stats || {}) } as any;\n                          s.tavernRollDate = new Date().toISOString();\n                          s.tavernRollCount = (s.tavernRollCount || 0) + 1;\n                          s.tavernDiceRolls = (s.tavernDiceRolls || 0) + 1;\n                          s.tavernCrits = (s.tavernCrits || 0) + (isCrit ? 1 : 0);\n                          s.tavernBestRoll = Math.max(roll, s.tavernBestRoll || 0);\n                          useHeroStore.getState().updateHero(heroNow.id, { stats: s });\n                        }\n                      } catch {}\n                    }\n                    if (isCrit && selectedHero) {\n                      setCriticalGlow(true);\n                      setDiceMessage('CRTICO! Voc ganhou medalha, ttulo e +100 XP');\n                      try { notificationBus.emit({ type: 'achievement', title: 'Crtico na Taverna!', message: '+100 XP  Mestre dos Dados', icon: '', duration: 3500 }); } catch {}\n                      try { useHeroStore.getState().gainXP(selectedHero.id, 100); } catch {}\n                      try {\n                        const title = { id: 'mestre-dos-dados', name: 'Mestre dos Dados', description: 'Obteve um crtico (20) na Noite de Dados', rarity: 'especial', category: 'special', badge: '', unlockedAt: new Date() } as any;\n                        useHeroStore.getState().addTitleToSelectedHero(title, false);\n                      } catch {}\n                      try {\n                        const hero = useHeroStore.getState().getSelectedHero();\n                        if (hero) {\n                          const expires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();\n                          const stats = { ...(hero.stats || {}) } as any;\n                          stats.profileMedal = { icon: '', name: 'Mestre dos Dados', expiresAt: expires };\n                          useHeroStore.getState().updateHero(hero.id, { stats });\n                        }\n                      } catch {}\n                    } else {\n                      setDiceMessage('Nada mal  continue tentando pelo crtico!');\n                    }\n                    setDiceRolling(false);\n                  }}\n                  className={`px-4 py-2 rounded ${diceRolling ? 'bg-gray-700 text-gray-300' : `bg-gradient-to-r ${getSeasonalButtonGradient(activeSeasonalTheme as any)} text-white`}`}\n                >\n                  {diceRolling ? 'Rolando' : 'Rolar d20'}\n                </button>\n                <div className=\"relative min-w-[100px] h-[36px] flex items-center justify-center\">\n                  {criticalGlow && <div className=\"dice-crit-ring\" />}\n                  {criticalGlow && <div className=\"dice-crit-sparkle\" />}\n                  <div className={`text-center text-2xl font-bold ${criticalGlow ? 'text-amber-300 dice-crit-number' : 'text-gray-200'}`}>\n                    {lastRoll !== null ? lastRoll : ''}\n                  </div>\n                </div>\n                {diceMessage && <span className=\"text-xs text-amber-300\">{diceMessage}</span>}\n                <div className=\"ml-auto text-xs text-gray-300 flex items-center gap-2\">\n                  <span>Fichas: <span className=\"text-amber-300 font-semibold\">{getRerollTokens()}</span></span>\n                  {(() => { const hero = useHeroStore.getState().getSelectedHero(); const s = hero ? (getRerollDaily()) : { count: 0, cap: rerollCap }; return <span>Hoje: <span className=\"text-amber-300 font-semibold\">{s.count}/{s.cap}</span></span>; })()}\n                  {(() => { const hero = useHeroStore.getState().getSelectedHero(); const r = hero ? (getRollDaily()) : { count: 0, cap: rollCap }; return <span>Rolagens: <span className=\"text-amber-300 font-semibold\">{r.count}/{r.cap}</span></span>; })()}\n                  <button\n                    onClick={async () => {\n                      const hero = useHeroStore.getState().getSelectedHero();\n                      if (!hero || lastRoll === null) return;\n                      const tokens = getRerollTokens();\n                      if (tokens <= 0 || diceRolling) return;\n                      try {\n                        const inc = await incrementRerollUsage(hero.id);\n                        if (!inc.ok && inc.reason === 'cap') { setDiceMessage('Limite dirio de rerrolagens atingido'); return; }\n                        if (inc.cap && inc.count !== undefined) setRerollCap(Number(inc.cap));\n                      } catch {}\n                      setDiceRolling(true);\n                      setCriticalGlow(false);\n                      await new Promise(r => setTimeout(r, 400));\n                      const roll = Math.floor(Math.random() * 20) + 1;\n                      setLastRoll(roll);\n                      const isCrit = roll === 20;\n                      try {\n                        const s = { ...(hero.stats || {}) } as any;\n                        s.tavernRerollTokens = Math.max(0, (s.tavernRerollTokens || 0) - 1);\n                        s.tavernRerollDate = new Date().toISOString();\n                        s.tavernRerollCount = (s.tavernRerollCount || 0) + 1;\n                        s.tavernDiceRolls = (s.tavernDiceRolls || 0) + 1;\n                        s.tavernCrits = (s.tavernCrits || 0) + (isCrit ? 1 : 0);\n                        s.tavernBestRoll = Math.max(roll, s.tavernBestRoll || 0);\n                        useHeroStore.getState().updateHero(hero.id, { stats: s });\n                      } catch {}\n                      try { logActivity.tavernDice({ heroId: hero.id, heroName: hero.name, heroClass: hero.class, heroLevel: hero.progression.level, roll, critical: isCrit } as any); } catch {}\n                      try { await recordDiceEvent({ heroId: hero.id, heroName: hero.name, roll, critical: isCrit }); } catch {}\n                      if (isCrit) {\n                        try { notificationBus.emit({ type: 'achievement', title: 'Crtico (rerrolado)!', message: '+100 XP  Mestre dos Dados', icon: '', duration: 3500 }); } catch {}\n                        try { useHeroStore.getState().gainXP(hero.id, 100); } catch {}\n                      }\n                      setDiceRolling(false);\n                    }}\n                    className={`px-3 py-1 rounded ${getRerollTokens() > 0 ? 'bg-indigo-600 hover:bg-indigo-700 text-white' : 'bg-gray-700 text-gray-400'}`}\n                    disabled={getRerollTokens() <= 0 || diceRolling || lastRoll === null}\n                  >Rerrolar</button>\n                </div>\n              </div>\n              {npcDiceResults.length > 0 && (\n                <div className=\"mt-4 text-sm text-gray-200\">\n                  <div className=\"font-semibold text-amber-300 mb-1\">Participantes NPCs (hoje)</div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n                    {npcDiceResults.map(r => (\n                      <div key={r.id} className=\"px-2 py-1 rounded border border-white/10 bg-black/20 flex items-center justify-between\">\n                        <span>{r.name}</span>\n                        <span className={r.critical ? 'text-amber-300 font-bold' : 'text-gray-200'}>{r.roll}{r.critical ? '  CRTICO' : ''}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Mdulos de ranking e apostas desativados para modo single-player */}\n\n            <div className=\"mt-6 bg-gradient-to-br from-indigo-900/30 via-amber-800/10 to-transparent border border-indigo-500/30 rounded p-4\">\n              <h3 className=\"text-lg font-semibold text-amber-300 flex items-center gap-2\"> Jogo das Cartas</h3>\n              <p className=\"text-sm text-gray-300 mt-1\">Puxe 3 cartas (110). Soma das 2 maiores define o placar contra um NPC.</p>\n              {selectedHero && (() => {\n                const s = (selectedHero.stats || {}) as any;\n                const wins = Number(s.miniCardsWins || 0);\n                const losses = Number(s.miniCardsLosses || 0);\n                const best = Number(s.miniCardsBestScore || 0);\n                return (\n                  <div className=\"mt-2 text-xs text-gray-300\">Placar pessoal: {wins} vitrias  {losses} derrotas  melhor {best}</div>\n                );\n              })()}\n              <div className=\"mt-3 flex items-center gap-3 flex-wrap\">\n                <button\n                  onClick={() => {\n                    const hero = useHeroStore.getState().getSelectedHero();\n                    if (!hero) return;\n                    const draw = () => [1,2,3].map(() => Math.floor(Math.random() * 10) + 1).sort((a,b) => b - a).slice(0,2).reduce((acc,v) => acc + v, 0);\n                    const playerScore = draw();\n                    const heroesAll = useHeroStore.getState().heroes || [];\n                    const npcPool = heroesAll.filter(h => h.origin === 'npc');\n                    const npc = npcPool.length ? npcPool[Math.floor(Math.random() * npcPool.length)] : undefined;\n                    const npcScore = draw();\n                    const win = playerScore > npcScore;\n                    const s = { ...(hero.stats || {}) } as any;\n                    s.miniCardsWins = Number(s.miniCardsWins || 0) + (win ? 1 : 0);\n                    s.miniCardsLosses = Number(s.miniCardsLosses || 0) + (win ? 0 : 1);\n                    s.miniCardsBestScore = Math.max(Number(s.miniCardsBestScore || 0), playerScore);\n                    s.miniCardsLastDate = new Date().toISOString();\n                    useHeroStore.getState().updateHero(hero.id, { stats: s });\n                    try { useHeroStore.getState().updateAchievementProgress(); } catch {}\n                    if (win) {\n                      try { useHeroStore.getState().gainXP(hero.id, 35); } catch {}\n                      try { notificationBus.emit({ type: 'achievement', title: 'Vitria nas Cartas', message: `Placar ${playerScore}  +35 XP`, icon: '', duration: 3000 }); } catch {}\n                    } else {\n                      try { notificationBus.emit({ type: 'info', title: 'Derrota nas Cartas', message: `NPC marcou ${npcScore}`, icon: '', duration: 2500 }); } catch {}\n                    }\n                    setNpcDiceResults(prev => {\n                      const id = npc?.id || `npc-${Date.now()}`;\n                      const name = npc?.name || 'NPC';\n                      const roll = npcScore;\n                      const critical = false;\n                      return [...prev.filter(x => x.id !== id), { id, name, roll, critical }];\n                    });\n                  }}\n                  className={`px-4 py-2 rounded bg-indigo-600 hover:bg-indigo-700 text-white`}\n                >Jogar</button>\n                {selectedHero && (() => {\n                  const heroesAll = useHeroStore.getState().heroes || [];\n                  const npcList = heroesAll.filter(h => h.origin === 'npc').slice(0, 6);\n                  const entries = npcList.map(n => {\n                    const score = Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + 2;\n                    return { id: n.id, name: n.name, roll: score, critical: false };\n                  }).sort((a,b) => b.roll - a.roll);\n                  return (\n                    <div className=\"text-xs text-gray-300\">Top NPCs hoje: {entries.slice(0,3).map(e => `${e.name} ${e.roll}`).join('  ')}</div>\n                  );\n                })()}\n              </div>\n            </div>\n\n            <div className=\"mt-6 bg-gradient-to-br from-green-900/30 via-amber-800/10 to-transparent border border-green-500/30 rounded p-4\">\n              <h3 className=\"text-lg font-semibold text-amber-300 flex items-center gap-2\"> Pedra  Papel  Tesoura</h3>\n              <p className=\"text-sm text-gray-300 mt-1\">Melhor de 5 contra um NPC. Vence quem fizer 3 pontos.</p>\n              {selectedHero && (() => {\n                const s = (selectedHero.stats || {}) as any;\n                const wins = Number(s.miniRpsWins || 0);\n                const losses = Number(s.miniRpsLosses || 0);\n                const streak = Number(s.miniRpsStreak || 0);\n                const best = Number(s.miniRpsBestStreak || 0);\n                return (\n                  <div className=\"mt-2 text-xs text-gray-300\">Placar pessoal: {wins} vitrias  {losses} derrotas  sequncia {streak} (melhor {best})</div>\n                );\n              })()}\n              <div className=\"mt-3 flex items-center gap-2\">\n                {['pedra','papel','tesoura'].map(choice => (\n                  <button\n                    key={choice}\n                    onClick={() => {\n                      const hero = useHeroStore.getState().getSelectedHero();\n                      if (!hero) return;\n                      const map: Record<string, string> = { pedra: 'tesoura', papel: 'pedra', tesoura: 'papel' };\n                      const npcChoice = ['pedra','papel','tesoura'][Math.floor(Math.random()*3)];\n                      const win = map[choice] === npcChoice;\n                      const s = { ...(hero.stats || {}) } as any;\n                      const prevStreak = Number(s.miniRpsStreak || 0);\n                      s.miniRpsWins = Number(s.miniRpsWins || 0) + (win ? 1 : 0);\n                      s.miniRpsLosses = Number(s.miniRpsLosses || 0) + (win ? 0 : 1);\n                      s.miniRpsStreak = win ? prevStreak + 1 : 0;\n                      s.miniRpsBestStreak = Math.max(Number(s.miniRpsBestStreak || 0), s.miniRpsStreak);\n                      s.miniRpsLastDate = new Date().toISOString();\n                      useHeroStore.getState().updateHero(hero.id, { stats: s });\n                      try { useHeroStore.getState().updateAchievementProgress(); } catch {}\n                      if (win) {\n                        try { useHeroStore.getState().gainXP(hero.id, 25); } catch {}\n                        try { notificationBus.emit({ type: 'achievement', title: 'Vitria no RPS', message: `NPC jogou ${npcChoice}  +25 XP`, icon: '', duration: 2500 }); } catch {}\n                      } else {\n                        try { notificationBus.emit({ type: 'info', title: 'Derrota no RPS', message: `NPC jogou ${npcChoice}`, icon: '', duration: 2500 }); } catch {}\n                      }\n                    }}\n                    className={`px-3 py-2 rounded bg-green-700 hover:bg-green-800 text-white`}\n                  >{choice}</button>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {tab === 'descanso' && (\n          <div className=\"mt-6 bg-gray-900/40 border border-white/10 rounded p-4\">\n            <h3 className=\"text-lg font-semibold text-amber-300\"> Descanso na Taverna</h3>\n            <p className=\"text-sm text-gray-300 mt-1\">Recupere sua Fadiga com uma boa noite de sono.</p>\n            <div className=\"mt-3 text-sm text-gray-200\">\n              {selectedHero ? (\n                <span>\n                  Saldo: Ouro {selectedHero.progression.gold}  Fadiga {selectedHero.progression.fatigue}\n                </span>\n              ) : (\n                <span>Selecione um heri para descansar.</span>\n              )}\n            </div>\n            <div className=\"mt-3 flex items-center gap-3 flex-wrap\">\n              {(() => {\n                const options = [\n                  { label: 'Soneca', type: 'soneca', cost: 15, recovery: 15 },\n                  { label: 'Noite padro', type: 'noite', cost: 30, recovery: 30 },\n                  { label: 'Sute de luxo', type: 'luxo', cost: 60, recovery: 60 }\n                ];\n                const fatigue = selectedHero?.progression.fatigue ?? 0;\n                const gold = selectedHero?.progression.gold ?? 0;\n                const baseHelper = !selectedHero\n                  ? 'Selecione um heri'\n                  : fatigue <= 0\n                    ? 'Fadiga j est em 0'\n                    : undefined;\n                return (\n                  <>\n                    {options.map(opt => {\n                      const canRest = !!selectedHero && gold >= opt.cost && fatigue > 0;\n                      return (\n                        <button\n                          key={opt.type}\n                          onClick={() => {\n                            if (!selectedHero) return;\n                            const ok = restAtTavern(selectedHero.id, opt.cost, opt.recovery, opt.type);\n                            setRestMessage(\n                              ok\n                                ? `Voc descansou (${opt.label}) e recuperou at ${opt.recovery} de Fadiga.`\n                                : 'No foi possvel descansar (verifique ouro e fadiga).'\n                            );\n                          }}\n                          disabled={!canRest}\n                          className={`px-3 py-2 rounded text-sm ${canRest ? 'bg-gradient-to-r from-amber-600 to-yellow-600 text-white hover:brightness-110' : 'bg-gray-700 text-gray-300'}`}\n                          title={`Recupera ${opt.recovery} Fadiga por ${opt.cost} ouro`}\n                        >\n                          {opt.label} ({opt.cost} ouro)\n                        </button>\n                      );\n                    })}\n                    <span className=\"text-xs text-gray-300 min-w-[180px]\">\n                      {baseHelper ?? (gold < options[1].cost ? 'Ouro insuficiente' : 'Escolha o conforto do descanso')}\n                    </span>\n                  </>\n                );\n              })()}\n            </div>\n            {restMessage && (\n              <div className=\"mt-3 text-xs text-green-300\">{restMessage}</div>\n            )}\n          </div>\n        )}\n\n        {/* Painel de moderao removido no modo single-player */}\n      </div>\n    </div>\n  );\n};\n\nexport default Tavern;\n","import React, { useEffect, useMemo, useRef, useState } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { useHeroStore } from '../store/heroStore'\nimport { getAvailableRecipes, RECIPES } from '../utils/forging'\nimport { resumeAudioContextIfNeeded, playSuccess, playFailure, playHammer, playPolish, playForgeStart } from '../utils/audioEffects'\nimport { SHOP_ITEMS, purchaseItem, getDiscountedPrice, canAfford } from '../utils/shop'\nimport { RANK_CONFIG } from '../types/ranks'\nimport { notificationBus } from './NotificationSystem'\nimport { Link } from 'react-router-dom'\n\ntype DialogueType = 'dica' | 'historia' | 'comentario'\n\ninterface BlacksmithNPCProps {\n  className?: string\n}\n\nconst DIALOGUES: Record<DialogueType, string[]> = {\n  dica: [\n    'Use essncias arcanas para elevar a raridade sem perder o fio da lmina.',\n    'Combine materiais de mesma categoria para criar itens nicos pela fuso.',\n    'A forja simples depende do seu rank. Suba o rank e novas receitas surgem.',\n    'Refinar a pea equipada pode render bnus poderosos  mas h risco.'\n  ],\n  historia: [\n    'J forjei a lmina do Guardio da Guilda. Brilhou como um sol ao romper o amanhecer.',\n    'Quando o martelo canta, lembro do meu mestre. Cada batida carrega um pedao do seu legado.',\n    'O ao que no falha  aquele temperado com pacincia. Heris apressados aprendem isso na marra.'\n  ],\n  comentario: [\n    'O ar hoje est bom para tmpera. Sinto nos ossos.',\n    'Cuidado com as fagulhas. Elas tm vontade prpria.',\n    'Nada como o cheiro de ferro aquecido para comear o dia.'\n  ]\n}\n\nexport const BlacksmithNPC: React.FC<BlacksmithNPCProps> = ({ className = '' }) => {\n  const { getSelectedHero, craftItem, refineEquippedItem, fuseItems, enchantEquippedItem, updateHero } = useHeroStore()\n  const hero = getSelectedHero()\n  const [currentWork, setCurrentWork] = useState<'martelar' | 'polir' | 'inspecionar'>('martelar')\n  const [isNear, setIsNear] = useState(false)\n  const [activeDialogue, setActiveDialogue] = useState<{ type: DialogueType; text: string } | null>(null)\n  const [showPanel, setShowPanel] = useState(false)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const npcRef = useRef<HTMLDivElement>(null)\n  const [npcPos, setNpcPos] = useState<{ x: number; y: number }>({ x: 0, y: 0 })\n  const [audioReady, setAudioReady] = useState(false)\n  const [lastAction, setLastAction] = useState<{ type: string; at: number } | null>(null)\n  const [forgingId, setForgingId] = useState<string | null>(null)\n  const [forgingProgress, setForgingProgress] = useState<number>(0)\n  const [forgingStage, setForgingStage] = useState<number>(0)\n  const forgingTimerRef = useRef<any>(null)\n  const [detailsOpenId, setDetailsOpenId] = useState<string | null>(null)\n  const [forgingQueue, setForgingQueue] = useState<string[]>([])\n  const [forgeView, setForgeView] = useState<'eligible'|'rank'>('eligible')\n  const [recipeQuery, setRecipeQuery] = useState('')\n\n  const startForging = (rid: string, rname: string) => {\n    if (forgingId) return\n    if (audioReady) {\n      resumeAudioContextIfNeeded()\n      try { playForgeStart() } catch {}\n    }\n    setForgingId(rid)\n    setForgingProgress(0)\n    setForgingStage(0)\n    const startedAt = Date.now()\n    const tick = setInterval(() => {\n      const elapsed = Date.now() - startedAt\n      const pct = Math.min(100, Math.floor((elapsed / 2400) * 100))\n      setForgingProgress(pct)\n      if (pct >= 25 && forgingStage < 1) setForgingStage(1)\n      if (pct >= 50 && forgingStage < 2) setForgingStage(2)\n      if (pct >= 75 && forgingStage < 3) setForgingStage(3)\n      if (pct >= 100) {\n        clearInterval(tick)\n        forgingTimerRef.current = null\n        const ok = craftItem(hero!.id, rid)\n        if (ok) {\n          if (audioReady) playSuccess()\n          setActiveDialogue({ type: 'comentario', text: 'Boa tmpera. A pea parece equilibrada.' })\n          setLastAction({ type: 'forjar:ok', at: Date.now() })\n          try { notificationBus.emit({ type: 'success', title: 'Forja concluda', message: `${rname} forjado com sucesso!`, timeoutMs: 3000 }) } catch {}\n        } else {\n          if (audioReady) playFailure()\n          setActiveDialogue({ type: 'comentario', text: 'Faltam insumos ou rank. Verifique seu inventrio e posio.' })\n          setLastAction({ type: 'forjar:falha', at: Date.now() })\n          try { notificationBus.emit({ type: 'error', title: 'Forja falhou', message: 'Verifique materiais e rank.', timeoutMs: 3000 }) } catch {}\n        }\n        setForgingId(null)\n        setForgingProgress(0)\n        setForgingStage(0)\n        setTimeout(() => {\n          setForgingQueue(q => {\n            const next = q[0]\n            const rest = q.slice(1)\n            if (next) {\n              const rnext = RECIPES.find(rr => rr.id === next)\n              if (rnext) startForging(rnext.id, rnext.name)\n            }\n            return rest\n          })\n        }, 200)\n      }\n    }, 80)\n    forgingTimerRef.current = tick\n  }\n\n  const quickBuyMaterial = (itemId: string) => {\n    if (!hero) return\n    const result = purchaseItem(hero, itemId)\n    if (result.success && result.item) {\n      const currency = result.currency || 'gold'\n      const newProgression = { ...hero.progression } as any\n      if (result.newBalance !== undefined) {\n        if (currency === 'gold') newProgression.gold = result.newBalance\n        else if (currency === 'glory') newProgression.glory = result.newBalance\n        else if (currency === 'arcaneEssence') newProgression.arcaneEssence = result.newBalance\n      } else if (result.newGold !== undefined) {\n        newProgression.gold = result.newGold\n      }\n      updateHero(hero.id, {\n        progression: newProgression,\n        inventory: {\n          ...hero.inventory,\n          items: {\n            ...hero.inventory.items,\n            [itemId]: (hero.inventory.items[itemId] || 0) + 1\n          }\n        }\n      })\n      try { notificationBus.emit({ type: 'success', title: 'Material adquirido', message: result.message, timeoutMs: 3000 }) } catch {}\n    } else {\n      try { notificationBus.emit({ type: 'error', title: 'Falha na compra', message: result.message, timeoutMs: 3000 }) } catch {}\n    }\n  }\n\n  const quickBuyAllForRecipe = (recipeId: string) => {\n    const state = useHeroStore.getState()\n    const h = state.getSelectedHero()\n    if (!h) return\n    const recipe = RECIPES.find(r => r.id === recipeId)\n    if (!recipe) return\n    let successCount = 0\n    for (const m of recipe.inputs) {\n      const have = h.inventory.items[m.id] || 0\n      const need = Math.max(0, m.qty - have)\n      for (let i = 0; i < need; i++) {\n        const res = purchaseItem(useHeroStore.getState().getSelectedHero()!, m.id)\n        if (res.success && res.item) {\n          const heroNow = useHeroStore.getState().getSelectedHero()!\n          const currency = res.currency || 'gold'\n          const prog = { ...heroNow.progression } as any\n          if (res.newBalance !== undefined) {\n            if (currency === 'gold') prog.gold = res.newBalance\n            else if (currency === 'glory') prog.glory = res.newBalance\n            else if (currency === 'arcaneEssence') prog.arcaneEssence = res.newBalance\n          } else if (res.newGold !== undefined) {\n            prog.gold = res.newGold\n          }\n          updateHero(heroNow.id, {\n            progression: prog,\n            inventory: {\n              ...heroNow.inventory,\n              items: {\n                ...heroNow.inventory.items,\n                [m.id]: (heroNow.inventory.items[m.id] || 0) + 1\n              }\n            }\n          })\n          successCount++\n        } else {\n          break\n        }\n      }\n    }\n    if (successCount > 0) {\n      try { notificationBus.emit({ type: 'success', title: 'Materiais adquiridos', message: `Comprados ${successCount} insumos para a receita.`, timeoutMs: 3000 }) } catch {}\n    } else {\n      try { notificationBus.emit({ type: 'error', title: 'Compra indisponvel', message: 'Saldo insuficiente ou item no disponvel.', timeoutMs: 3000 }) } catch {}\n    }\n  }\n  const idleCommentTimer = useRef<number | null>(null)\n\n  useEffect(() => {\n    const id = setInterval(() => {\n      const actions: typeof currentWork[] = ['martelar', 'polir', 'inspecionar']\n      setCurrentWork(actions[Math.floor(Math.random() * actions.length)])\n    }, 4000)\n    return () => clearInterval(id)\n  }, [])\n\n  useEffect(() => {\n    if (!hero) return\n    try {\n      const v = localStorage.getItem(`forgeView:${hero.id}`)\n      const q = localStorage.getItem(`forgeQuery:${hero.id}`)\n      if (v === 'eligible' || v === 'rank') setForgeView(v as any)\n      if (q) setRecipeQuery(q)\n    } catch {}\n  }, [hero?.id])\n\n  useEffect(() => {\n    if (!hero) return\n    try {\n      localStorage.setItem(`forgeView:${hero.id}`, forgeView)\n      localStorage.setItem(`forgeQuery:${hero.id}`, recipeQuery)\n    } catch {}\n  }, [forgeView, recipeQuery, hero?.id])\n\n  useEffect(() => {\n    const id = setInterval(() => {\n      const nx = Math.max(-8, Math.min(12, (Math.random() - 0.5) * 24))\n      const ny = Math.max(-6, Math.min(6, (Math.random() - 0.5) * 12))\n      setNpcPos({ x: nx, y: ny })\n    }, 5000)\n    return () => clearInterval(id)\n  }, [])\n\n  useEffect(() => {\n    const el = containerRef.current\n    if (!el) return\n    const onMove = (e: MouseEvent) => {\n      const npcEl = npcRef.current\n      if (!npcEl) return\n      const rect = npcEl.getBoundingClientRect()\n      const cx = rect.left + rect.width / 2\n      const cy = rect.top + rect.height / 2\n      const dx = e.clientX - cx\n      const dy = e.clientY - cy\n      const dist = Math.sqrt(dx * dx + dy * dy)\n      setIsNear(dist < 140)\n    }\n    el.addEventListener('mousemove', onMove)\n    const onKey = (ke: KeyboardEvent) => {\n      if (ke.key.toLowerCase() === 't') {\n        speak('comentario')\n      } else if (ke.key.toLowerCase() === 'f') {\n        setShowPanel(v => !v)\n      } else if (ke.key === 'Enter') {\n        try {\n          if (!showPanel || !hero || forgingId) return\n          const list = (forgeView === 'eligible' ? recipes : rankEligibleRecipes).filter(r => r.name.toLowerCase().includes(recipeQuery.toLowerCase()))\n          const withMats = list.find(r => r.inputs.every(inp => (hero.inventory.items[inp.id] || 0) >= inp.qty))\n          const pick = withMats || list[0]\n          if (pick) startForging(pick.id, pick.name)\n        } catch {}\n      }\n    }\n    window.addEventListener('keydown', onKey)\n    return () => { el.removeEventListener('mousemove', onMove); window.removeEventListener('keydown', onKey) }\n  }, [])\n\n  useEffect(() => {\n    if (idleCommentTimer.current) window.clearInterval(idleCommentTimer.current)\n    idleCommentTimer.current = window.setInterval(() => {\n      if (!showPanel && !activeDialogue) {\n        const pool = DIALOGUES['comentario']\n        const text = pool[Math.floor(Math.random() * pool.length)]\n        setActiveDialogue({ type: 'comentario', text })\n      }\n    }, 20000)\n    return () => {\n      if (idleCommentTimer.current) window.clearInterval(idleCommentTimer.current)\n      idleCommentTimer.current = null\n    }\n  }, [showPanel, activeDialogue])\n\n  const recipes = useMemo(() => (hero ? getAvailableRecipes(hero) : []), [hero])\n  const rankEligibleRecipes = useMemo(() => {\n    if (!hero) return []\n    const rankOrder = ['F','E','D','C','B','A','S'] as const\n    const heroRank = (hero.rankData?.currentRank || 'F') as typeof rankOrder[number]\n    const heroRankIdx = rankOrder.indexOf(heroRank)\n    return RECIPES.filter(r => {\n      const reqIdx = rankOrder.indexOf((r.rankRequired || 'F') as any)\n      return heroRankIdx >= reqIdx\n    })\n  }, [hero])\n\n  const smartTips = useMemo(() => {\n    if (!hero) return [] as Array<{ id: string; name: string; missing: Array<{ id: string; qty: number }>; rankOk: boolean }>\n    const rankOrder = ['F','E','D','C','B','A','S'] as const\n    const heroRank = (hero.rankData?.currentRank || 'F') as typeof rankOrder[number]\n    const heroRankIdx = rankOrder.indexOf(heroRank)\n    const inv = hero.inventory.items\n    const rarityScore = (rar?: string) => ({ comum: 1, incomum: 2, raro: 3, epico: 4, lendario: 5 } as any)[(rar || 'comum').toLowerCase()] || 1\n    const candidates = RECIPES.map(r => {\n      const reqIdx = rankOrder.indexOf((r.rankRequired || 'F') as any)\n      const rankOk = heroRankIdx >= reqIdx\n      const missing = r.inputs.map(inp => ({ id: inp.id, qty: Math.max(0, inp.qty - (inv[inp.id] || 0)) })).filter(m => m.qty > 0)\n      const maxRarity = Math.max(...missing.map(m => rarityScore(SHOP_ITEMS.find(i => i.id === m.id)?.rarity))) || 1\n      return { id: r.id, name: r.name, missing, rankOk, maxRarity }\n    })\n    const filtered = candidates.filter(c => c.rankOk && c.missing.length > 0)\n    return filtered\n      .sort((a, b) => {\n        const ta = a.missing.reduce((s, m) => s + m.qty, 0)\n        const tb = b.missing.reduce((s, m) => s + m.qty, 0)\n        if (ta !== tb) return ta - tb\n        return b.maxRarity - a.maxRarity\n      })\n      .slice(0, 3)\n  }, [hero])\n\n  const rarityClasses = (rar?: string) => {\n    const r = (rar || '').toLowerCase()\n    if (r === 'lendario') return 'bg-amber-900/40 text-amber-200 border-amber-600/40'\n    if (r === 'epico') return 'bg-purple-900/40 text-purple-200 border-purple-600/40'\n    if (r === 'raro') return 'bg-blue-900/40 text-blue-200 border-blue-600/40'\n    if (r === 'incomum') return 'bg-green-900/40 text-green-200 border-green-600/40'\n    return 'bg-slate-800/40 text-slate-200 border-white/10'\n  }\n\n  const speak = (type: DialogueType) => {\n    const pool = DIALOGUES[type]\n    const text = pool[Math.floor(Math.random() * pool.length)]\n    let dynamic = ''\n    if (type === 'dica') {\n      if (hero) {\n        const rank = hero.rankData?.currentRank || 'F'\n        const count = recipes.length\n        dynamic = count > 0 ? ` Voc tem ${count} receita(s) aptas ao seu rank ${rank}.` : ` Suba de rank ou junte materiais para liberar novas receitas.`\n      }\n    }\n    setActiveDialogue({ type, text: `${text}${dynamic}` })\n    setShowPanel(true)\n    try {\n      resumeAudioContextIfNeeded()\n      setAudioReady(true)\n      const synth = window.speechSynthesis\n      if (synth) {\n        const utter = new SpeechSynthesisUtterance(text)\n        utter.lang = 'pt-BR'\n        utter.rate = 1\n        synth.cancel()\n        synth.speak(utter)\n      }\n    } catch {}\n  }\n\n  return (\n    <div ref={containerRef} className={`relative w-full min-h-[420px] rounded-2xl border border-white/10 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 overflow-hidden ${className}`}>\n      <div className=\"absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-amber-700/30 via-transparent to-transparent\" />\n      <div className=\"absolute left-6 right-6 top-6 bottom-24 rounded-2xl bg-slate-800/40 border border-amber-700/20\" />\n\n      <motion.div ref={npcRef} className=\"absolute left-10 bottom-16 w-44 h-44 rounded-xl bg-slate-700/60 border border-white/10 flex items-center justify-center\"\n        animate={{ x: npcPos.x + (currentWork === 'inspecionar' ? 6 : currentWork === 'polir' ? -4 : 0), y: npcPos.y + (currentWork === 'polir' ? -3 : 0) }}\n        transition={{ type: 'spring', stiffness: 120, damping: 14 }}>\n        {forgingId && forgingStage === 1 && (\n          <motion.div className=\"absolute inset-0\" animate={{ x: [-1, 1, -1, 0] }} transition={{ duration: 0.3, repeat: Infinity }} />\n        )}\n        <div className=\"text-center\">\n          <div className=\"text-6xl\"></div>\n          <div className=\"mt-1 text-xs text-amber-300\">Forjador</div>\n          {hero && (\n            <div className=\"mt-1 text-[10px] inline-flex items-center gap-1 px-2 py-1 rounded bg-slate-800/60 border border-white/10\">\n              <span>{RANK_CONFIG[(hero.rankData?.currentRank || 'F') as any]?.icon}</span>\n              <span>{RANK_CONFIG[(hero.rankData?.currentRank || 'F') as any]?.name}</span>\n              <span>({hero.rankData?.currentRank || 'F'})</span>\n            </div>\n          )}\n          <AnimatePresence>\n            {isNear && (\n              <motion.div initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 8 }} className=\"mt-2 text-xs px-2 py-1 rounded bg-amber-800/40 text-amber-200 border border-amber-600/40\">\n                Saudaes, heri.\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n        {currentWork === 'martelar' && (\n          <motion.div className=\"absolute inset-0 rounded-xl\" animate={{ boxShadow: ['0 0 0px rgba(251,191,36,0.0)', '0 0 12px rgba(251,191,36,0.35)', '0 0 0px rgba(251,191,36,0.0)'] }} transition={{ duration: 1.2, repeat: Infinity }} />\n        )}\n        <motion.div className=\"absolute right-2 top-2 text-3xl\" animate={{ rotate: currentWork === 'martelar' ? [0, -20, 0, -20, 0] : 0 }} transition={{ duration: currentWork === 'martelar' ? 0.8 : 0.4, repeat: currentWork === 'martelar' ? Infinity : 0 }}>\n          {currentWork === 'martelar' ? '' : currentWork === 'polir' ? '' : ''}\n        </motion.div>\n      </motion.div>\n\n      <div className=\"absolute left-56 bottom-24 right-6\">\n        <div className=\"flex flex-wrap gap-2\">\n          <button onClick={() => speak('dica')} className=\"px-3 py-2 rounded bg-amber-600 text-white text-xs hover:bg-amber-700\">Pedir dica</button>\n          <button onClick={() => speak('historia')} className=\"px-3 py-2 rounded bg-amber-600 text-white text-xs hover:bg-amber-700\">Ouvir histria</button>\n          <button onClick={() => speak('comentario')} className=\"px-3 py-2 rounded bg-amber-600 text-white text-xs hover:bg-amber-700\">Comentar ambiente</button>\n          <button onClick={() => setShowPanel(v => !v)} className=\"px-3 py-2 rounded bg-slate-700 text-white text-xs hover:bg-slate-600\">Abrir painel</button>\n          {!audioReady && (\n            <button onClick={() => { resumeAudioContextIfNeeded(); setAudioReady(true) }} className={`px-3 py-2 rounded text-xs bg-slate-700 text-white hover:bg-slate-600`}>Ativar udio</button>\n          )}\n          {audioReady && (\n            <button onClick={() => { try { window.speechSynthesis?.cancel() } catch {}; setAudioReady(false) }} className={`px-3 py-2 rounded text-xs bg-red-700 text-white hover:bg-red-800`}>Silenciar udio</button>\n          )}\n        </div>\n\n        <AnimatePresence>\n          {activeDialogue && (\n            <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 10 }} className=\"mt-3 p-3 rounded-lg bg-slate-800/60 border border-white/10\">\n              <div className=\"text-xs text-amber-300 uppercase\">{activeDialogue.type}</div>\n              <div className=\"text-sm text-white mt-1\">{activeDialogue.text}</div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        <AnimatePresence>\n          {showPanel && hero && (\n            <motion.div initial={{ opacity: 0, y: 12 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 12 }} className=\"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3\">\n              <div className=\"p-3 rounded-lg bg-slate-800/60 border border-white/10\">\n                <div className=\"text-sm font-semibold text-white mb-2\">Forja Simples</div>\n                <div className=\"mb-2 flex items-center gap-2\">\n                  <input value={recipeQuery} onChange={e => setRecipeQuery(e.target.value)} placeholder=\"Buscar receita\" className=\"px-2 py-1 rounded bg-slate-700 text-white text-xs w-full\" />\n                  <button onClick={() => setForgeView('eligible')} className={`px-2 py-1 rounded text-xs ${forgeView === 'eligible' ? 'bg-emerald-700 text-white' : 'bg-slate-700 text-white hover:bg-slate-600'}`}>Elegveis</button>\n                  <button onClick={() => setForgeView('rank')} className={`px-2 py-1 rounded text-xs ${forgeView === 'rank' ? 'bg-emerald-700 text-white' : 'bg-slate-700 text-white hover:bg-slate-600'}`}>Aptas ao Rank</button>\n                </div>\n                {recipes.length === 0 && <div className=\"text-xs text-gray-400\">Sem receitas disponveis.</div>}\n                {recipes.length > 0 && (\n                  <div className=\"space-y-2\">\n                    {(forgeView === 'eligible' ? recipes : rankEligibleRecipes).filter(r => r.name.toLowerCase().includes(recipeQuery.toLowerCase())).map(r => (\n                      <div key={r.id} className=\"p-2 rounded bg-slate-700/60 border border-white/10 flex items-center justify-between\">\n                        <div>\n                          <div className=\"text-white text-sm\">{r.name}</div>\n                          <div className=\"text-xs text-gray-300\">Rank: {r.rankRequired || 'F'}</div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <button\n                            disabled={!!forgingId}\n                            onClick={() => startForging(r.id, r.name)}\n                            className={`px-2 py-1 rounded text-xs ${forgingId ? 'bg-gray-600 text-gray-300 cursor-not-allowed' : 'bg-emerald-600 text-white hover:bg-emerald-700'}`}\n                          >\n                            {forgingId ? 'Forjando' : 'Forjar'}\n                          </button>\n                          <button\n                            onClick={() => setForgingQueue(q => q.length < 3 ? [...q, r.id] : q)}\n                            className=\"px-2 py-1 rounded bg-slate-700 text-white text-xs hover:bg-slate-600\"\n                          >\n                            Adicionar  fila\n                          </button>\n                          {forgingId === r.id && (\n                            <button onClick={() => { if (forgingTimerRef.current) { clearInterval(forgingTimerRef.current); forgingTimerRef.current = null } setForgingId(null); setForgingProgress(0); setForgingStage(0) }} className=\"px-2 py-1 rounded bg-gray-700 text-white text-xs hover:bg-gray-600\">Cancelar</button>\n                          )}\n                          {forgingId === r.id && (\n                            <div className=\"relative w-24 h-2 rounded bg-slate-700 overflow-hidden\">\n                              <div className={`h-2 ${forgingStage === 0 ? 'bg-amber-500' : forgingStage === 1 ? 'bg-red-500' : forgingStage === 2 ? 'bg-blue-500' : 'bg-emerald-500'}`} style={{ width: `${forgingProgress}%` }} />\n                              <div className=\"absolute top-[-6px] text-[10px]\" style={{ left: `calc(${forgingProgress}% - 6px)` }}></div>\n                              <div className=\"absolute right-1 top-[-14px] text-[10px] text-gray-200\">~{Math.max(0, Math.ceil((2400 * (1 - forgingProgress/100)) / 1000))}s</div>\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-1\">\n                            {[\n                              { l: 'Aquecer', i: '' },\n                              { l: 'Martelar', i: '' },\n                              { l: 'Tmpera', i: '' },\n                              { l: 'Polir', i: '' }\n                            ].map((st, idx) => (\n                              <span key={st.l} className={`px-2 py-0.5 rounded text-[10px] border ${forgingId === r.id && forgingStage >= idx ? 'bg-emerald-700 text-white border-emerald-500' : 'bg-slate-700 text-gray-300 border-white/10'}`}>{st.i} {st.l}</span>\n                            ))}\n                          </div>\n                          <button onClick={() => setDetailsOpenId(detailsOpenId === r.id ? null : r.id)} className=\"px-2 py-1 rounded bg-slate-700 text-white text-xs hover:bg-slate-600\">{detailsOpenId === r.id ? 'Ocultar detalhes' : 'Detalhes'}</button>\n                        </div>\n                        {forgingQueue.length > 0 && (\n                          <div className=\"mt-2 text-[10px] text-gray-300\">\n                            Fila: {forgingQueue.map((id, idx) => {\n                              const rr = RECIPES.find(x => x.id === id)\n                              const name = rr?.name || id\n                              const canUp = idx > 0\n                              const canDown = idx < forgingQueue.length - 1\n                              const estSec = Math.ceil(2400 / 1000) * (idx + 1)\n                              return (\n                                <span key={`${id}-${idx}`} className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-slate-700 text-white mr-1\">\n                                  <span>{name}</span>\n                                  <span className=\"opacity-70\">~{estSec}s</span>\n                                  <button disabled={!canUp} onClick={() => setForgingQueue(q => { const nq = [...q]; const t = nq[idx]; nq[idx] = nq[idx-1]; nq[idx-1] = t; return nq })} className={`px-1 rounded ${canUp ? 'bg-slate-600 hover:bg-slate-500' : 'bg-slate-800 opacity-50'}`}></button>\n                                  <button disabled={!canDown} onClick={() => setForgingQueue(q => { const nq = [...q]; const t = nq[idx]; nq[idx] = nq[idx+1]; nq[idx+1] = t; return nq })} className={`px-1 rounded ${canDown ? 'bg-slate-600 hover:bg-slate-500' : 'bg-slate-800 opacity-50'}`}></button>\n                                  <button onClick={() => setForgingQueue(q => q.filter((x, i) => i !== idx))} className=\"px-1 rounded bg-red-700 hover:bg-red-800\"></button>\n                                </span>\n                              )\n                            })}\n                          </div>\n                        )}\n                        {detailsOpenId === r.id && (\n                          <div className=\"mt-2 p-2 rounded bg-slate-800/60 border border-white/10\">\n                            <div className=\"text-xs text-gray-300 mb-1\">Consumo</div>\n                            <div className=\"flex flex-wrap gap-1 items-center\">\n                              {r.inputs.map(inp => {\n                                const item = SHOP_ITEMS.find(i => i.id === inp.id)\n                                const label = item ? item.name : inp.id\n                                const icon = item?.icon || ''\n                                const have = hero.inventory.items[inp.id] || 0\n                                return (\n                                  <span key={`${r.id}-${inp.id}`} className={`inline-flex items-center gap-1 px-2 py-0.5 rounded border text-xs ${have >= inp.qty ? 'bg-slate-700 text-white border-white/20' : 'bg-red-900/40 text-red-200 border-red-600/40'}`}>\n                                    <span>{icon}</span>\n                                    <span>{inp.qty}x {label}</span>\n                                    <span className=\"opacity-70\">(Voc tem {have})</span>\n                                  </span>\n                                )\n                              })}\n                            </div>\n                            <div className=\"text-xs text-gray-300 mt-2 mb-1\">Resultado</div>\n                            {(() => {\n                              const outItem = SHOP_ITEMS.find(i => i.id === r.output.id)\n                              const label = outItem ? outItem.name : r.output.id\n                              const icon = outItem?.icon || ''\n                              const rar = outItem?.rarity\n                              return (\n                                <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded border text-xs ${rarityClasses(rar)}`}>\n                                  <span>{icon}</span>\n                                  <span>{r.output.qty}x {label}</span>\n                                </span>\n                              )\n                            })()}\n                            {(() => {\n                              const outItem = SHOP_ITEMS.find(i => i.id === r.output.id)\n                              const bonus = outItem?.bonus\n                              if (!bonus) return null\n                              return (\n                                <div className=\"mt-2 text-[11px] text-gray-200\">\n                                  {Object.entries(bonus).map(([k,v]) => (\n                                    <span key={k} className=\"inline-block mr-2\">+{v} {k}</span>\n                                  ))}\n                                </div>\n                              )\n                            })()}\n                            {(() => {\n                              const deficits = r.inputs.map(inp => {\n                                const have = hero.inventory.items[inp.id] || 0\n                                const need = Math.max(0, inp.qty - have)\n                                const item = SHOP_ITEMS.find(i => i.id === inp.id)\n                                const priceEach = item ? getDiscountedPrice(item, hero) : 0\n                                const currency = item?.currency || 'gold'\n                                return { id: inp.id, need, priceEach, currency, available: !!item }\n                              }).filter(d => d.need > 0)\n                              if (deficits.length === 0) return null\n                              const totals: Record<'gold'|'glory'|'arcaneEssence', number> = { gold: 0, glory: 0, arcaneEssence: 0 }\n                              deficits.forEach(d => {\n                                if (!d.available) return\n                                const cur = (d.currency as 'gold'|'glory'|'arcaneEssence')\n                                totals[cur] += d.priceEach * d.need\n                              })\n                              const haveGold = hero.progression.gold || 0\n                              const haveGlory = hero.progression.glory || 0\n                              const haveEss = hero.progression.arcaneEssence || 0\n                              const enough = (totals.gold <= haveGold) && (totals.glory <= haveGlory) && (totals.arcaneEssence <= haveEss)\n                              return (\n                                <div className=\"mt-3 p-2 rounded bg-slate-900/60 border border-white/10\">\n                                  <div className=\"text-xs text-white mb-1\">Compra rpida (faltantes)</div>\n                                  <div className=\"text-[11px] text-gray-200 space-x-2\">\n                                    <span>Ouro: {Math.ceil(totals.gold)}</span>\n                                    <span>Glria: {Math.ceil(totals.glory)}</span>\n                                    <span>Essncia: {Math.ceil(totals.arcaneEssence)}</span>\n                                  </div>\n                                  <div className=\"text-[11px] text-gray-400 mt-1\">Saldo  Ouro: {haveGold}  Glria: {haveGlory}  Essncia: {haveEss}</div>\n                                  <div className=\"mt-2 flex items-center gap-2\">\n                                    <button\n                                      onClick={() => quickBuyAllForRecipe(r.id)}\n                                      disabled={!enough}\n                                      className={`px-2 py-1 rounded text-xs ${enough ? 'bg-emerald-700 text-white hover:bg-emerald-800' : 'bg-slate-700 text-gray-300 cursor-not-allowed'}`}\n                                    >\n                                      Confirmar compra\n                                    </button>\n                                    {!enough && (\n                                      <span className=\"text-[11px] text-red-300\">Saldo insuficiente para todos os insumos.</span>\n                                    )}\n                                  </div>\n                                </div>\n                              )\n                            })()}\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                )}\n                <div className=\"mt-2 text-xs text-gray-300\">\n                  Tempo total estimado da fila: {Math.ceil(((forgingQueue.length * 2400) + (forgingId ? (2400 * (1 - forgingProgress/100)) : 0)) / 1000)}s\n                </div>\n              </div>\n\n              <div className=\"p-3 rounded-lg bg-slate-800/60 border border-white/10\">\n              <div className=\"text-sm font-semibold text-white mb-2\">Aprimoramentos</div>\n              <div className=\"flex flex-wrap gap-2\">\n                <button onClick={() => {\n                    const ok = refineEquippedItem(hero.id, 'weapon')\n                    if (audioReady) { resumeAudioContextIfNeeded(); ok ? playSuccess() : playFailure() }\n                    setLastAction({ type: ok ? 'refinar:ok' : 'refinar:falha', at: Date.now() })\n                    try { notificationBus.emit({ type: ok ? 'success' : 'error', title: ok ? 'Refino realizado' : 'Refino falhou', message: ok ? 'Arma refinada.' : 'Requisitos no atendidos.', timeoutMs: 3000 }) } catch {}\n                  }} className=\"px-2 py-1 rounded bg-purple-600 text-white text-xs hover:bg-purple-700\">Refinar Arma</button>\n                <button onClick={() => {\n                    const ok = refineEquippedItem(hero.id, 'armor')\n                    if (audioReady) { resumeAudioContextIfNeeded(); ok ? playSuccess() : playFailure() }\n                    setLastAction({ type: ok ? 'refinar:ok' : 'refinar:falha', at: Date.now() })\n                    try { notificationBus.emit({ type: ok ? 'success' : 'error', title: ok ? 'Refino realizado' : 'Refino falhou', message: ok ? 'Armadura refinada.' : 'Requisitos no atendidos.', timeoutMs: 3000 }) } catch {}\n                  }} className=\"px-2 py-1 rounded bg-purple-600 text-white text-xs hover:bg-purple-700\">Refinar Armadura</button>\n                <button onClick={() => {\n                    const ok = refineEquippedItem(hero.id, 'accessory')\n                    if (audioReady) { resumeAudioContextIfNeeded(); ok ? playSuccess() : playFailure() }\n                    setLastAction({ type: ok ? 'refinar:ok' : 'refinar:falha', at: Date.now() })\n                    try { notificationBus.emit({ type: ok ? 'success' : 'error', title: ok ? 'Refino realizado' : 'Refino falhou', message: ok ? 'Acessrio refinado.' : 'Requisitos no atendidos.', timeoutMs: 3000 }) } catch {}\n                  }} className=\"px-2 py-1 rounded bg-purple-600 text-white text-xs hover:bg-purple-700\">Refinar Acessrio</button>\n                <button onClick={() => {\n                    const ok = enchantEquippedItem(hero.id, 'weapon', 'lifesteal')\n                    if (audioReady) { resumeAudioContextIfNeeded(); ok ? playSuccess() : playFailure() }\n                    setLastAction({ type: ok ? 'encantar:ok' : 'encantar:falha', at: Date.now() })\n                    try { notificationBus.emit({ type: ok ? 'success' : 'error', title: ok ? 'Encantamento aplicado' : 'Encantamento falhou', message: ok ? 'Lifesteal ativo na arma.' : 'Essncia insuficiente ou item no equipado.', timeoutMs: 3000 }) } catch {}\n                  }} className=\"px-2 py-1 rounded bg-indigo-600 text-white text-xs hover:bg-indigo-700\">Encantar Arma</button>\n              </div>\n                <div className=\"mt-2 text-xs text-gray-400\">Refinos e encantos consomem ouro/essncia e podem falhar.</div>\n              </div>\n\n              <div className=\"p-3 rounded-lg bg-slate-800/60 border border-white/10 md:col-span-2\">\n                <div className=\"text-sm font-semibold text-white mb-2\">Fuso Procedural</div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <input placeholder=\"ID do Item A\" className=\"px-2 py-1 rounded bg-slate-700 text-white text-xs\" id=\"fuse-a\" />\n                  <input placeholder=\"ID do Item B\" className=\"px-2 py-1 rounded bg-slate-700 text-white text-xs\" id=\"fuse-b\" />\n                </div>\n                <div className=\"mt-2\">\n                  <button onClick={() => {\n                    const a = (document.getElementById('fuse-a') as HTMLInputElement)?.value\n                    const b = (document.getElementById('fuse-b') as HTMLInputElement)?.value\n                    if (a && b) {\n                      const ok = fuseItems(hero.id, a, b)\n                      if (audioReady) { resumeAudioContextIfNeeded(); ok ? playSuccess() : playFailure() }\n                      setLastAction({ type: ok ? 'fusao:ok' : 'fusao:falha', at: Date.now() })\n                      try { notificationBus.emit({ type: ok ? 'success' : 'error', title: ok ? 'Fuso concluda' : 'Fuso falhou', message: ok ? 'Novo item nico gerado.' : 'Verifique tipos e quantidades.', timeoutMs: 3000 }) } catch {}\n                    }\n                  }} className=\"px-3 py-1 rounded bg-amber-600 text-white text-xs hover:bg-amber-700\">Fundir</button>\n                </div>\n              </div>\n\n              <div className=\"p-3 rounded-lg bg-slate-800/60 border border-white/10 md:col-span-2\">\n                <div className=\"text-sm font-semibold text-white mb-2\">Dicas Inteligentes</div>\n                {smartTips.length === 0 && <div className=\"text-xs text-gray-400\">Sem dicas no momento. Voc j possui materiais para as receitas aptas ou precisa subir de rank.</div>}\n                {smartTips.length > 0 && (\n                  <div className=\"space-y-2\">\n            {smartTips.map(t => (\n              <div key={t.id} className=\"p-2 rounded bg-slate-700/60 border border-white/10\">\n                <div className=\"text-white text-sm mb-1\">{t.name}</div>\n                        <div className=\"flex flex-wrap gap-1 items-center\">\n                          {t.missing.map(m => {\n                            const item = SHOP_ITEMS.find(i => i.id === m.id)\n                            const label = item ? item.name : m.id\n                            const rar = item?.rarity\n                            const icon = item?.icon || ''\n                            const price = item ? getDiscountedPrice(item, hero!) : 0\n                            const currency = (item?.currency || 'gold')\n                            const currencyLabel = currency === 'gold' ? 'ouro' : currency === 'glory' ? 'glria' : 'essncia'\n                            const affordable = item ? canAfford(hero!, item) : false\n                            return (\n                              <span key={`${t.id}-${m.id}`} className={`inline-flex items-center gap-1 px-2 py-0.5 rounded border text-xs ${rarityClasses(rar)} ${m.qty === 1 ? 'animate-pulse' : ''}`} title={m.qty === 1 ? 'Falta 1 para completar' : ''}>\n                                <span>{icon}</span>\n                                <span>{m.qty}x {label}</span>\n                                <button onClick={() => quickBuyMaterial(m.id)} disabled={!affordable} className={`ml-1 px-2 py-0.5 rounded ${affordable ? 'bg-emerald-700 hover:bg-emerald-800 text-white' : 'bg-slate-700 text-gray-300 cursor-not-allowed'}`}>Comprar ({price} {currencyLabel})</button>\n                              </span>\n                            )\n                          })}\n                        </div>\n                        <div className=\"mt-2\">\n                          <button onClick={() => quickBuyAllForRecipe(t.id)} className=\"inline-flex items-center gap-1 px-2 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-700\">Comprar faltantes</button>\n                          <Link to=\"/shop\" className=\"ml-2 inline-flex items-center gap-1 px-2 py-1 rounded bg-slate-700 text-white text-xs hover:bg-slate-600\">Ir  Loja</Link>\n                        </div>\n              </div>\n            ))}\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n\n      <div className=\"absolute left-0 right-0 bottom-0 p-3 bg-slate-900/60 border-t border-white/10\">\n        <div className=\"text-xs text-gray-300\">Movimente o cursor para se aproximar do Forjador e interaja.</div>\n      </div>\n\n      <motion.div className=\"absolute left-8 bottom-8 text-2xl\" animate={{ scale: [1, 1.1, 0.95, 1], opacity: [0.7, 1, 0.8, 0.7] }} transition={{ duration: 1.6, repeat: Infinity }}>\n        \n      </motion.div>\n      <motion.div className=\"absolute left-24 bottom-20 text-xl\" animate={{ opacity: [0, 1, 0], y: [0, -6, 0] }} transition={{ duration: 1.2, repeat: Infinity }}>\n        \n      </motion.div>\n\n      {audioReady && (\n        <HammerAudio work={currentWork} />\n      )}\n\n      <ActionFollowUp action={lastAction} enabled={audioReady} hero={hero || null} />\n      <GlowBurst action={lastAction} hero={hero || null} />\n    </div>\n  )\n}\n\nexport default BlacksmithNPC\n\nconst HammerAudio: React.FC<{ work: 'martelar' | 'polir' | 'inspecionar' }> = ({ work }) => {\n  useEffect(() => {\n    let id: any\n    if (work === 'martelar') {\n      id = setInterval(() => { try { playHammer() } catch {} }, 3000)\n    } else if (work === 'polir') {\n      id = setInterval(() => { try { playPolish() } catch {} }, 3800)\n    } else {\n      return\n    }\n    return () => clearInterval(id)\n  }, [work])\n  return null\n}\n\nconst ActionFollowUp: React.FC<{ action: { type: string; at: number } | null; enabled: boolean; hero: any }> = ({ action, enabled, hero }) => {\n  useEffect(() => {\n    if (!action) return\n    const id = setTimeout(() => {\n      const type = action.type\n      const titleName = hero?.titles?.find((t: any) => t.id === hero?.activeTitle)?.name\n      const baseOk = 'Bom trabalho. A pea responde bem sob presso.'\n      const baseFail = 'Nem sempre o fogo obedece. Vamos ajustar o prximo passo.'\n      let extra = titleName ? ` ${titleName} tem mos firmes para a forja.` : ''\n      try {\n        const key = `forgeHistory:${hero?.id}`\n        const prev = JSON.parse(localStorage.getItem(key) || '[]')\n        const last = prev.slice(-3)\n        const okCount = last.filter((x: any) => x.ok).length\n        const failCount = last.filter((x: any) => !x.ok).length\n        if (okCount >= 3) extra += ' Sequncia tima, continue assim.'\n        else if (failCount >= 2) extra += ' Vamos revisar materiais e rank para melhorar.'\n      } catch {}\n      const msg = (type.endsWith(':ok') ? baseOk : baseFail) + extra\n      try {\n        const evt = new CustomEvent('npc-followup', { detail: { msg } })\n        window.dispatchEvent(evt)\n      } catch {}\n    }, 8000)\n    return () => clearTimeout(id)\n  }, [action?.type, action?.at])\n\n  useEffect(() => {\n    const onEvt = (e: any) => {\n      const msg = e?.detail?.msg\n      if (typeof msg === 'string' && enabled) {\n        try {\n          const synth = window.speechSynthesis\n          if (synth) {\n            const utter = new SpeechSynthesisUtterance(msg)\n            utter.lang = 'pt-BR'\n            utter.rate = 1\n            synth.cancel()\n            synth.speak(utter)\n          }\n        } catch {}\n      }\n    }\n    window.addEventListener('npc-followup', onEvt)\n    return () => window.removeEventListener('npc-followup', onEvt)\n  }, [enabled])\n  return null\n}\n\nconst GlowBurst: React.FC<{ action: { type: string; at: number } | null; hero: any }> = ({ action, hero }) => {\n  const [visible, setVisible] = useState(false)\n  useEffect(() => {\n    if (!action) return\n    if (!String(action.type).endsWith(':ok')) return\n    setVisible(true)\n    const id = setTimeout(() => setVisible(false), 1200)\n    return () => clearTimeout(id)\n  }, [action?.type, action?.at])\n  if (!visible) return null\n  const color = RANK_CONFIG[(hero?.rankData?.currentRank || 'F') as any]?.color || '#22c55e'\n  return (\n    <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} exit={{ opacity: 0 }} className=\"pointer-events-none absolute left-40 bottom-28 w-28 h-28 rounded-full\" style={{ boxShadow: `0 0 18px ${color}` }} />\n  )\n}","import React from 'react'\nimport { Link } from 'react-router-dom'\nimport { useHeroStore } from '../store/heroStore'\nimport { BlacksmithNPC } from './BlacksmithNPC'\n\nconst HeroForge: React.FC = () => {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-200 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-400 mb-6\">Selecione um heri para acessar a Forja.</p>\n        <Link to=\"/gallery\" className=\"bg-amber-600 text-white px-6 py-2 rounded hover:bg-amber-700 transition-colors\">Ver Galeria</Link>\n      </div>\n    )\n  }\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <div className=\"mb-4 flex items-center justify-between\">\n        <h2 className=\"text-xl md:text-2xl font-bold text-amber-400\">Forja do Heri</h2>\n        <div className=\"flex items-center gap-2\">\n          <Link to={`/shop`} className=\"px-3 py-2 rounded bg-emerald-600 text-white text-sm hover:bg-emerald-700\">Visitar Loja</Link>\n          <Link to={`/inventory`} className=\"px-3 py-2 rounded bg-amber-600 text-white text-sm hover:bg-amber-700\">Ver Inventrio</Link>\n          <Link to={`/hero/${hero.id}`} className=\"px-3 py-2 rounded bg-slate-700 text-white text-sm hover:bg-slate-600\">Voltar ao Heri</Link>\n        </div>\n      </div>\n      <BlacksmithNPC />\n    </div>\n  )\n}\n\nexport default HeroForge","export interface CheckoutRequest {\n  productId: string;\n}\n\nexport interface CheckoutResponse {\n  ok: boolean;\n  sessionId?: string;\n  redirectUrl?: string;\n}\n\nexport async function startCheckout(productId: string): Promise<CheckoutResponse> {\n  try {\n    const headers = await authHeaders();\n    const res = await fetch('/api/payments/create-checkout-session', { method: 'POST', headers, body: JSON.stringify({ productId }) });\n    if (!res.ok) {\n      try { const j = await res.json(); throw new Error(j?.message || 'Falha ao iniciar checkout'); } catch { throw new Error('Falha ao iniciar checkout'); }\n    }\n    const json = await res.json();\n    try {\n      if (json?.redirectUrl) {\n        window.location.href = json.redirectUrl;\n      }\n    } catch {}\n    return json;\n  } catch {\n    // Fallback local: simular sucesso\n    return { ok: true, sessionId: `local-${Date.now()}` };\n  }\n}\n\nexport async function verifyPurchase(sessionId: string): Promise<{ ok: boolean; productId?: string }> {\n  try {\n    const headers = await authHeaders();\n    const res = await fetch('/api/payments/verify', { method: 'POST', headers, body: JSON.stringify({ sessionId }) });\n    if (!res.ok) { try { const j = await res.json(); throw new Error(j?.message || 'Falha ao verificar'); } catch { throw new Error('Falha ao verificar'); } }\n    return await res.json();\n  } catch {\n    return { ok: true };\n  }\n}\nimport { supabase, supabaseConfigured } from '../lib/supabaseClient';\n\nasync function authHeaders(userId?: string): Promise<Record<string, string>> {\n  const headers: Record<string, string> = { 'Content-Type': 'application/json' };\n  try {\n    const { data } = await supabase.auth.getSession();\n    const token = data?.session?.access_token;\n    const uid = data?.session?.user?.id;\n    if (token) headers['Authorization'] = `Bearer ${token}`;\n    if (!supabaseConfigured && uid) headers['X-User-Id'] = uid;\n    if (!headers['X-User-Id'] && userId && !supabaseConfigured) headers['X-User-Id'] = userId;\n  } catch {}\n  return headers;\n}","import React, { useEffect, useState } from 'react'\nimport { Link } from 'react-router-dom'\nimport { trackMetric } from '../utils/metricsSystem'\nimport { useMonetizationStore } from '../store/monetizationStore'\nimport { verifyPurchase } from '../services/paymentsService'\nimport { notificationBus } from './NotificationSystem'\n\nconst PremiumCenter: React.FC = () => {\n  const { markPurchase, removeAdsForever, setActiveTheme, setActiveFrame, seasonPassActive, adsRemoved, ownedThemes, ownedFrames, activeThemeId, activeFrameId } = useMonetizationStore()\n  const priceRemoveAds = import.meta.env.VITE_PRICE_REMOVE_ADS || ''\n  const priceSeasonPass = import.meta.env.VITE_PRICE_SEASON_PASS || ''\n  const priceThemeMedieval = import.meta.env.VITE_PRICE_THEME_MEDIEVAL || ''\n  const priceFrameOrnate = import.meta.env.VITE_PRICE_FRAME_ORNATE || ''\n  const fmt = (() => {\n    try {\n      const loc = (import.meta.env.VITE_LOCALE || 'pt-BR') as string\n      const cur = (import.meta.env.VITE_CURRENCY || 'BRL') as string\n      return new Intl.NumberFormat(loc, { style: 'currency', currency: cur })\n    } catch { return null }\n  })()\n  const valRemoveAds = Number(import.meta.env.VITE_PRICE_REMOVE_ADS_VALUE || '0')\n  const valSeasonPass = Number(import.meta.env.VITE_PRICE_SEASON_PASS_VALUE || '0')\n  const valThemeMedieval = Number(import.meta.env.VITE_PRICE_THEME_MEDIEVAL_VALUE || '0')\n  const valFrameOrnate = Number(import.meta.env.VITE_PRICE_FRAME_ORNATE_VALUE || '0')\n  const displayPrice = (txt: string, val: number) => fmt && val > 0 ? fmt.format(val) : (txt || '')\n  const [statusMsg, setStatusMsg] = useState<string>('')\n  useEffect(() => {\n    trackMetric.pageVisited('system', '/premium')\n    trackMetric.featureUsed('system', 'premium-center-open')\n  }, [])\n  useEffect(() => {\n    (async () => {\n      try {\n        const p = new URLSearchParams(window.location.search)\n        const checkout = p.get('checkout')\n        const sid = p.get('sid')\n        const prod = p.get('p') || ''\n        if (checkout === 'success' && sid) {\n          const v = await verifyPurchase(sid)\n          if (v.ok) {\n            markPurchase(prod || 'premium', { id: sid })\n            if (prod === 'remove-ads') {\n              removeAdsForever()\n            } else if (prod.startsWith('theme-')) {\n              setActiveTheme(prod.replace('theme-',''))\n            } else if (prod.startsWith('frame-')) {\n              setActiveFrame(prod.replace('frame-',''))\n            } else if (prod === 'season-pass') {\n              // j ativado via store quando comprado; reforo visual\n            }\n            trackMetric.purchaseCompleted('system', prod || 'premium', sid)\n            setStatusMsg('Compra concluda com sucesso. Obrigado pelo apoio!')\n          } else {\n            setStatusMsg('Falha ao verificar compra. Tente novamente.')\n          }\n        } else if (checkout === 'cancel') {\n          setStatusMsg('Pagamento cancelado.')\n        }\n      } catch {}\n    })()\n  }, [])\n  return (\n    <div className=\"max-w-5xl mx-auto p-6\">\n      <h1 className=\"text-2xl font-bold text-amber-300 mb-2\">Centro Premium</h1>\n      {statusMsg && <div className=\"text-sm text-emerald-300 mb-3\">{statusMsg}</div>}\n      <div className=\"mb-4 grid grid-cols-1 sm:grid-cols-2 gap-3\">\n        <div className=\"rounded-lg border border-white/20 bg-white/5 p-3\">\n          <div className=\"text-sm text-gray-200\">Status</div>\n          <div className=\"text-xs text-gray-300 mt-1\">Premium: {seasonPassActive?.active ? 'Ativo' : 'Inativo'}</div>\n          <div className=\"text-xs text-gray-300\">Ads: {adsRemoved ? 'Removidos' : 'Ativos'}</div>\n          <div className=\"text-xs text-gray-300\">Tema ativo: {activeThemeId || '-'}</div>\n          <div className=\"text-xs text-gray-300\">Frame ativo: {activeFrameId || '-'}</div>\n        </div>\n        <div className=\"rounded-lg border border-white/20 bg-white/5 p-3\">\n          <div className=\"text-sm text-gray-200\">Cosmticos</div>\n          <div className=\"text-xs text-gray-300 mt-1\">Temas: {(ownedThemes || []).length}</div>\n          <div className=\"text-xs text-gray-300\">Frames: {(ownedFrames || []).length}</div>\n        </div>\n      </div>\n      <div className=\"mb-4 grid grid-cols-1 sm:grid-cols-2 gap-3\">\n        <div className=\"rounded-lg border border-indigo-500/40 bg-indigo-900/10 p-3\">\n          <div className=\"text-sm text-indigo-200\">Aes rpidas (Tema)</div>\n          <select\n            value={activeThemeId || ''}\n            onChange={e => { const v = e.target.value || undefined; setActiveTheme(v); try { trackMetric.featureUsed('system', 'theme-switch'); } catch {}; try { notificationBus.publish({ id: `theme-${Date.now()}`, type: 'info', title: 'Tema aplicado', message: `Tema ${v || ''} ativo`, timeoutMs: 3000 }); } catch {} }}\n            className=\"mt-2 w-full border border-indigo-700 bg-indigo-950 text-indigo-100 text-xs rounded p-2\"\n          >\n            <option value=\"\">Selecionar</option>\n            {(ownedThemes || []).map(t => (<option key={t} value={t}>{t}</option>))}\n          </select>\n        </div>\n        <div className=\"rounded-lg border border-cyan-500/40 bg-cyan-900/10 p-3\">\n          <div className=\"text-sm text-cyan-200\">Aes rpidas (Frame)</div>\n          <select\n            value={activeFrameId || ''}\n            onChange={e => { const v = e.target.value || undefined; setActiveFrame(v); try { trackMetric.featureUsed('system', 'frame-switch'); } catch {}; try { notificationBus.publish({ id: `frame-${Date.now()}`, type: 'info', title: 'Frame aplicado', message: `Frame ${v || ''} ativo`, timeoutMs: 3000 }); } catch {} }}\n            className=\"mt-2 w-full border border-cyan-700 bg-cyan-950 text-cyan-100 text-xs rounded p-2\"\n          >\n            <option value=\"\">Selecionar</option>\n            {(ownedFrames || []).map(f => (<option key={f} value={f}>{f}</option>))}\n          </select>\n        </div>\n      </div>\n      <div className=\"mb-6\">\n        <Link to=\"/shop\" className=\"inline-block px-3 py-2 rounded bg-amber-600 text-white text-sm hover:bg-amber-700\">Abrir Loja</Link>\n      </div>\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n        <div className=\"rounded-lg border border-amber-500/40 bg-amber-900/10 p-4\">\n          <div className=\"text-lg font-semibold text-amber-300 mb-1\">Remover Anncios</div>\n          <div className=\"text-xs text-amber-200 mb-3\">Experincia sem anncios em todo o jogo</div>\n          <div className=\"text-xs text-amber-200 mb-2\">{displayPrice(priceRemoveAds, valRemoveAds)}</div>\n          <button\n            onClick={async () => { try { trackMetric.purchaseInitiated('system', 'remove-ads') } catch {}; const resp = await import('../services/paymentsService'); await resp.startCheckout('remove-ads'); }}\n            disabled={adsRemoved}\n            className={`px-3 py-2 rounded text-sm ${adsRemoved ? 'bg-gray-400 text-gray-800 cursor-not-allowed' : 'bg-amber-600 text-white hover:bg-amber-700'}`}\n          >{adsRemoved ? 'Comprado' : 'Comprar'}</button>\n        </div>\n        <div className=\"rounded-lg border border-pink-500/40 bg-pink-900/10 p-4\">\n          <div className=\"text-lg font-semibold text-pink-300 mb-1\">Season Pass</div>\n          <div className=\"text-xs text-pink-200 mb-3\">Recompensas sazonais, cosmticos e bnus</div>\n          <div className=\"text-xs text-pink-200 mb-2\">{displayPrice(priceSeasonPass, valSeasonPass)}</div>\n          <button\n            onClick={async () => { try { trackMetric.purchaseInitiated('system', 'season-pass') } catch {}; const resp = await import('../services/paymentsService'); await resp.startCheckout('season-pass'); }}\n            disabled={!!seasonPassActive?.active}\n            className={`px-3 py-2 rounded text-sm ${seasonPassActive?.active ? 'bg-gray-400 text-gray-800 cursor-not-allowed' : 'bg-pink-600 text-white hover:bg-pink-700'}`}\n          >{seasonPassActive?.active ? 'Ativo' : 'Comprar'}</button>\n        </div>\n        <div className=\"rounded-lg border border-indigo-500/40 bg-indigo-900/10 p-4\">\n          <div className=\"text-lg font-semibold text-indigo-300 mb-1\">Tema Medieval</div>\n          <div className=\"text-xs text-indigo-200 mb-3\">Paleta e decorao temtica</div>\n          <div className=\"text-xs text-indigo-200 mb-2\">{displayPrice(priceThemeMedieval, valThemeMedieval)}</div>\n          <button\n            onClick={async () => { try { trackMetric.purchaseInitiated('system', 'theme-medieval') } catch {}; const resp = await import('../services/paymentsService'); await resp.startCheckout('theme-medieval'); }}\n            disabled={(ownedThemes || []).includes('medieval')}\n            className={`px-3 py-2 rounded text-sm ${((ownedThemes || []).includes('medieval')) ? 'bg-gray-400 text-gray-800 cursor-not-allowed' : 'bg-indigo-600 text-white hover:bg-indigo-700'}`}\n          >{((ownedThemes || []).includes('medieval')) ? (activeThemeId === 'medieval' ? 'Ativo' : 'Comprado') : 'Comprar'}</button>\n        </div>\n        <div className=\"rounded-lg border border-cyan-500/40 bg-cyan-900/10 p-4\">\n          <div className=\"text-lg font-semibold text-cyan-300 mb-1\">Frame Ornado</div>\n          <div className=\"text-xs text-cyan-200 mb-3\">Moldura estilizada para UI</div>\n          <div className=\"text-xs text-cyan-200 mb-2\">{displayPrice(priceFrameOrnate, valFrameOrnate)}</div>\n          <button\n            onClick={async () => { try { trackMetric.purchaseInitiated('system', 'frame-ornate') } catch {}; const resp = await import('../services/paymentsService'); await resp.startCheckout('frame-ornate'); }}\n            disabled={(ownedFrames || []).includes('ornate')}\n            className={`px-3 py-2 rounded text-sm ${((ownedFrames || []).includes('ornate')) ? 'bg-gray-400 text-gray-800 cursor-not-allowed' : 'bg-cyan-600 text-white hover:bg-cyan-700'}`}\n          >{((ownedFrames || []).includes('ornate')) ? (activeFrameId === 'ornate' ? 'Ativo' : 'Comprado') : 'Comprar'}</button>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default PremiumCenter","import React, { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { SocialEvent, listEvents, listEventsPaged, createEvent, recommendEventsPaged } from '../services/socialEventsService';\nimport { listFriends } from '../services/userService';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useMonetizationStore } from '../store/monetizationStore';\nimport { seasonalThemes } from '../styles/medievalTheme';\nimport { tokens } from '../styles/designTokens';\nimport { computeOccupancyPercent, isNearFull } from '../utils/eventsHelpers';\nimport { trackMetric } from '../utils/metricsSystem';\n\nconst SocialEventsPage: React.FC = () => {\n  const { getSelectedHero } = useHeroStore();\n  const me = getSelectedHero();\n  const navigate = useNavigate();\n  const [tab, setTab] = useState<'explore' | 'create'>('explore');\n  const [events, setEvents] = useState<SocialEvent[]>([]);\n  const [recommended, setRecommended] = useState<SocialEvent[]>([]);\n  const [filters, setFilters] = useState<{ tag: string }>({ tag: '' });\n  const [loading, setLoading] = useState(false);\n  const [sortMode, setSortMode] = useState<'date'|'occupancy'>('date');\n  const [nearFullOnly, setNearFullOnly] = useState(false);\n  const [limitRecommended, setLimitRecommended] = useState(6);\n  const [recOffset, setRecOffset] = useState(0);\n  const [limitEvents, setLimitEvents] = useState(9);\n  const [eventsOffset, setEventsOffset] = useState(0);\n  const [hasMoreRec, setHasMoreRec] = useState(true);\n  const [hasMoreEvents, setHasMoreEvents] = useState(true);\n  const [loadingMoreRec, setLoadingMoreRec] = useState(false);\n  const [loadingMoreEvents, setLoadingMoreEvents] = useState(false);\n  const [errorRec, setErrorRec] = useState<string | null>(null);\n  const [errorEvents, setErrorEvents] = useState<string | null>(null);\n  const [retryRecCount, setRetryRecCount] = useState(0);\n  const [retryEventsCount, setRetryEventsCount] = useState(0);\n  const [name, setName] = useState('');\n  const [dateTime, setDateTime] = useState('');\n  const [locationText, setLocationText] = useState('');\n  const [lat, setLat] = useState<string>('');\n  const [lng, setLng] = useState<string>('');\n  const [description, setDescription] = useState('');\n  const [capacity, setCapacity] = useState<number>(100);\n  const [tags, setTags] = useState<string>('');\n  const [privacy, setPrivacy] = useState<'public' | 'private' | 'invite'>('public');\n  const [invitedCsv, setInvitedCsv] = useState('');\n  const [friends, setFriends] = useState<string[]>([]);\n  const isLogged = !!me;\n  const { seasonPassActive } = useMonetizationStore();\n  const { activeSeasonalTheme } = useMonetizationStore();\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-slate-700' : 'border-slate-700';\n\n  const viewerId = useMemo(() => me?.id || '', [me?.id]);\n\n  const load = async () => {\n    if (!viewerId) { setEvents([]); setRecommended([]); return; }\n    setLoading(true);\n    try {\n      try { trackMetric.featureUsed(me?.id || 'system', 'events_initial_load_started'); } catch {}\n      const listPaged = await listEventsPaged(viewerId, { tag: filters.tag || undefined, limit: limitEvents, offset: 0 });\n      setEvents(listPaged.items);\n      setEventsOffset(listPaged.items.length);\n      setHasMoreEvents(!!listPaged.pagination?.hasMore);\n      const recPaged = await recommendEventsPaged(viewerId, tags ? tags.split(',').map(s => s.trim()).join(',') : undefined, { limit: limitRecommended, offset: 0 });\n      setRecommended(recPaged.items);\n      setRecOffset(recPaged.items.length);\n      setHasMoreRec(!!recPaged.pagination?.hasMore);\n      try { trackMetric.featureUsed(me?.id || 'system', 'events_initial_load_completed'); } catch {}\n    } catch {}\n    setLoading(false);\n  };\n\n  useEffect(() => { load(); }, [viewerId]);\n  useEffect(() => { (async () => { if (!viewerId) { setFriends([]); return; } try { const f = await listFriends(viewerId); setFriends(f); } catch {} })(); }, [viewerId]);\n\n  useEffect(() => {\n    if (tab === 'create') {\n      if (seasonPassActive?.active && capacity === 100) {\n        setCapacity(200);\n        try { trackMetric.featureUsed(me?.id || 'system', 'event_capacity_auto_applied'); } catch {}\n      }\n    }\n  }, [tab, seasonPassActive?.active]);\n\n  useEffect(() => {\n    try { trackMetric.featureUsed(me?.id || 'system', 'events_sort_changed'); } catch {}\n  }, [sortMode]);\n\n  const showMoreRecommended = async () => {\n    try {\n      setLoadingMoreRec(true);\n      setErrorRec(null);\n      const recPaged = await recommendEventsPaged(viewerId, tags ? tags.split(',').map(s => s.trim()).join(',') : undefined, { limit: limitRecommended, offset: recOffset });\n      const map = new Map<string, SocialEvent>();\n      [...recommended, ...recPaged.items].forEach(e => map.set(e.id, e));\n      setRecommended(Array.from(map.values()));\n      setRecOffset(recOffset + recPaged.items.length);\n      setHasMoreRec(!!recPaged.pagination?.hasMore);\n      trackMetric.featureUsed(me?.id || 'system', 'events_load_more_backend_recommended');\n    } catch {\n      setErrorRec('Falha ao carregar recomendaes');\n      try { trackMetric.featureUsed(me?.id || 'system', 'events_load_more_backend_recommended_error'); } catch {}\n      if (retryRecCount < 1) {\n        setRetryRecCount(retryRecCount + 1);\n        setTimeout(() => { showMoreRecommended(); }, 800);\n      }\n    } finally {\n      setLoadingMoreRec(false);\n    }\n  };\n\n  const showMoreEvents = async () => {\n    try {\n      setLoadingMoreEvents(true);\n      setErrorEvents(null);\n      const listPaged = await listEventsPaged(viewerId, { tag: filters.tag || undefined, limit: limitEvents, offset: eventsOffset });\n      const map = new Map<string, SocialEvent>();\n      [...events, ...listPaged.items].forEach(e => map.set(e.id, e));\n      setEvents(Array.from(map.values()));\n      setEventsOffset(eventsOffset + listPaged.items.length);\n      setHasMoreEvents(!!listPaged.pagination?.hasMore);\n      trackMetric.featureUsed(me?.id || 'system', 'events_load_more_backend_list');\n    } catch {\n      setErrorEvents('Falha ao carregar eventos');\n      try { trackMetric.featureUsed(me?.id || 'system', 'events_load_more_backend_list_error'); } catch {}\n      if (retryEventsCount < 1) {\n        setRetryEventsCount(retryEventsCount + 1);\n        setTimeout(() => { showMoreEvents(); }, 800);\n      }\n    } finally {\n      setLoadingMoreEvents(false);\n    }\n  };\n\n  const sortedRecommended = useMemo(() => {\n    const arr = recommended.slice();\n    arr.sort((a,b) => {\n      if (sortMode === 'occupancy') {\n        return computeOccupancyPercent(b.capacity, b.attendees) - computeOccupancyPercent(a.capacity, a.attendees);\n      }\n      return new Date(a.dateTime).getTime() - new Date(b.dateTime).getTime();\n    });\n    return arr;\n  }, [recommended, sortMode]);\n\n  const sortedEvents = useMemo(() => {\n    const arr = events.slice();\n    arr.sort((a,b) => {\n      if (sortMode === 'occupancy') {\n        return computeOccupancyPercent(b.capacity, b.attendees) - computeOccupancyPercent(a.capacity, a.attendees);\n      }\n      return new Date(a.dateTime).getTime() - new Date(b.dateTime).getTime();\n    });\n    return arr;\n  }, [events, sortMode]);\n\n  const handleCreate = async () => {\n    if (!viewerId) return;\n    const invited = invitedCsv.split(',').map(s => s.trim()).filter(Boolean);\n    const payload = {\n      name: name.trim(),\n      dateTime: new Date(dateTime).toISOString(),\n      locationText: locationText.trim() || undefined,\n      lat: lat ? Number(lat) : undefined,\n      lng: lng ? Number(lng) : undefined,\n      description: description.trim() || undefined,\n      capacity: capacity,\n      tags: tags.split(',').map(t => t.trim()).filter(Boolean),\n      privacy,\n      ownerId: viewerId,\n      invitedIds: invited\n    };\n    if (!payload.name || !payload.dateTime) return;\n    setLoading(true);\n    try {\n      const ev = await createEvent(payload);\n      setName(''); setDateTime(''); setLocationText(''); setLat(''); setLng(''); setDescription(''); setCapacity(100); setTags(''); setPrivacy('public'); setInvitedCsv('');\n      setTab('explore');\n      const list = await listEvents(viewerId);\n      setEvents(list);\n      navigate(`/event/${ev.id}`);\n    } catch {}\n    setLoading(false);\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-3xl font-bold text-white\"> Eventos Sociais</h1>\n        <div className=\"flex gap-2\">\n          <button onClick={() => setTab('explore')} className={`px-4 py-2 rounded ${tab==='explore'?tokens.tabActive:tokens.tabInactive}`}>Explorar</button>\n          <button onClick={() => setTab('create')} className={`px-4 py-2 rounded ${tab==='create'?tokens.tabActive:tokens.tabInactive}`}>Criar Evento</button>\n          <Link to=\"/organizer\" className={`${tokens.tabActive}`}>Painel do Organizador</Link>\n        </div>\n      </div>\n\n      {!isLogged && (\n        <div className=\"bg-red-900/20 border border-red-600/40 p-4 rounded mb-6 text-red-300 text-sm\">Selecione um heri para atuar como usurio atual.</div>\n      )}\n\n      {tab==='explore' && (\n        <div className=\"space-y-8\">\n          <div className={`bg-gray-800 p-4 rounded border ${seasonalBorder}`}>\n            <div className=\"flex gap-2 items-end\">\n              <div className=\"flex-1\">\n                <label className=\"block text-sm text-slate-200\">Tag</label>\n                <input value={filters.tag} onChange={(e)=>setFilters({ tag: e.target.value })} placeholder=\"ex: msica, jogos\" className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n              </div>\n              <button onClick={load} className={`${tokens.tabActive}`}>Filtrar</button>\n              <label className=\"flex items-center gap-2 text-xs text-slate-400 ml-2\">\n                <input type=\"checkbox\" checked={nearFullOnly} onChange={e=>setNearFullOnly(e.target.checked)} />\n                Quase lotados\n              </label>\n              <label className=\"flex items-center gap-2 text-xs text-slate-400 ml-2\">\n                <span>Ordenar</span>\n                <select value={sortMode} onChange={e=>setSortMode(e.target.value as any)} className=\"px-2 py-1 rounded border bg-slate-900 border-slate-600 text-slate-200\">\n                  <option value=\"date\">Data</option>\n                  <option value=\"occupancy\">Ocupao</option>\n                </select>\n              </label>\n            </div>\n          </div>\n          {nearFullOnly && (\n            <div className=\"text-xs text-red-300 bg-red-900/20 border border-red-600/40 rounded p-3\">Filtrando por eventos quase lotados (ocupao  90%).</div>\n          )}\n          {(loading && recommended.length===0) && (\n            <div>\n              <div className=\"text-sm text-slate-400 inline-flex items-center gap-2 mb-3\">\n                <span className=\"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full\" />\n                <span>Carregando sugestes</span>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {Array.from({ length: 3 }).map((_, i) => (\n                  <div key={i} className=\"bg-slate-800 p-4 rounded border border-slate-700 animate-pulse\">\n                    <div className=\"h-4 bg-slate-700 rounded w-2/3\" />\n                    <div className=\"h-3 bg-slate-700 rounded w-1/3 mt-2\" />\n                    <div className=\"h-24 bg-slate-800 rounded mt-4\" />\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          {recommended.length>0 && (\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <h2 className=\"text-xl font-semibold text-white\">Sugestes para voc</h2>\n                <button onClick={load} className={`${tokens.tabInactive}`}>Atualizar</button>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {sortedRecommended\n                  .filter(ev => {\n                    if (!nearFullOnly) return true;\n                    return isNearFull(ev.capacity, ev.attendees);\n                  })\n                  .map(ev => (\n                  <div key={ev.id} className={`bg-gray-800 p-4 rounded border ${seasonalBorder} hover:shadow-lg hover:border-slate-600`}>\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <div className=\"text-lg font-semibold text-white\">{ev.name}</div>\n                        <div className=\"text-xs text-slate-400\">{new Date(ev.dateTime).toLocaleString()}</div>\n                        {ev.locationText && <div className=\"text-xs text-slate-400\">{ev.locationText}</div>}\n                      </div>\n                      <div className=\"text-2xl\"></div>\n                    </div>\n                    {isNearFull(ev.capacity, ev.attendees) ? (<div className=\"mt-1 text-[11px] px-2 py-0.5 rounded bg-red-900/20 text-red-300 border border-red-600/40 inline-block\">Quase lotado</div>) : null}\n                    <div className=\"text-sm text-slate-300 mt-2 line-clamp-3\">{ev.description}</div>\n                    <div className=\"mt-1 text-[11px] text-slate-400\">Ocupao: {computeOccupancyPercent(ev.capacity, ev.attendees)}%</div>\n                    <div className=\"w-full h-2 bg-slate-700 rounded mt-1\">\n                      <div className={`h-2 rounded ${isNearFull(ev.capacity, ev.attendees) ? 'bg-red-500' : 'bg-emerald-500'}`} style={{ width: `${computeOccupancyPercent(ev.capacity, ev.attendees)}%` }} />\n                    </div>\n                    <div className=\"mt-2 text-xs text-slate-400\">{ev.tags.join(', ')}</div>\n                    <div className=\"mt-3\">\n                      <button onClick={()=>navigate(`/event/${ev.id}`)} className={`w-full px-3 py-2 rounded ${tokens.tabActive}`}>Ver Detalhes</button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n              <div className=\"mt-3\">\n                {hasMoreRec ? (\n                  <button onClick={showMoreRecommended} disabled={loadingMoreRec} className={`${tokens.tabInactive}`}>{loadingMoreRec ? (<span className=\"inline-flex items-center gap-2\"><span className=\"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full\" /> Carregando</span>) : 'Mostrar mais'}</button>\n                ) : (\n                  <span className=\"text-xs text-slate-400\">Fim das recomendaes</span>\n                )}\n                {errorRec && (\n                  <div className=\"text-xs text-red-300 mt-1 inline-flex items-center gap-2\">\n                    <span>{errorRec}</span>\n                    <button onClick={showMoreRecommended} className=\"px-2 py-0.5 rounded bg-red-900/20 border border-red-600/40 text-red-300\">Tentar novamente</button>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n          <div>\n            <div className=\"flex items-center justify-between mb-2\">\n              <h2 className=\"text-xl font-semibold text-white\">Todos os eventos</h2>\n              <button onClick={load} className={`${tokens.tabInactive}`}>Atualizar</button>\n            </div>\n            {(loading && events.length===0) && (\n              <div>\n                <div className=\"text-sm text-slate-400 inline-flex items-center gap-2 mb-3\">\n                  <span className=\"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full\" />\n                  <span>Carregando eventos</span>\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  {Array.from({ length: 6 }).map((_, i) => (\n                    <div key={i} className=\"bg-slate-800 p-4 rounded border border-slate-700 animate-pulse\">\n                      <div className=\"h-4 bg-slate-700 rounded w-2/3\" />\n                      <div className=\"h-3 bg-slate-700 rounded w-1/3 mt-2\" />\n                      <div className=\"h-24 bg-slate-800 rounded mt-4\" />\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n            {events.length>0 ? (<>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {sortedEvents\n                  .filter(ev => {\n                    if (!nearFullOnly) return true;\n                    return isNearFull(ev.capacity, ev.attendees);\n                  })\n                  .map(ev => (\n                  <div key={ev.id} className={`bg-gray-800 p-4 rounded border ${seasonalBorder} hover:shadow-lg hover:border-slate-600`}>\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <div className=\"text-lg font-semibold text-white\">{ev.name}</div>\n                        <div className=\"text-xs text-slate-400\">{new Date(ev.dateTime).toLocaleString()}</div>\n                        {ev.locationText && <div className=\"text-xs text-slate-400\">{ev.locationText}</div>}\n                      </div>\n                      <div className=\"text-2xl\"></div>\n                    </div>\n                    {isNearFull(ev.capacity, ev.attendees) ? (<div className=\"mt-1 text-[11px] px-2 py-0.5 rounded bg-red-900/20 text-red-300 border border-red-600/40 inline-block\">Quase lotado</div>) : null}\n                    <div className=\"text-sm text-slate-300 mt-2 line-clamp-3\">{ev.description}</div>\n                    <div className=\"mt-1 text-[11px] text-slate-400\">Ocupao: {computeOccupancyPercent(ev.capacity, ev.attendees)}%</div>\n                    <div className=\"w-full h-2 bg-slate-700 rounded mt-1\">\n                      <div className={`h-2 rounded ${isNearFull(ev.capacity, ev.attendees) ? 'bg-red-500' : 'bg-emerald-500'}`} style={{ width: `${computeOccupancyPercent(ev.capacity, ev.attendees)}%` }} />\n                    </div>\n                    <div className=\"mt-2 text-xs text-slate-400\">Capacidade: {ev.capacity}</div>\n                    <div className=\"mt-3\">\n                      <button onClick={()=>navigate(`/event/${ev.id}`)} className={`w-full px-3 py-2 rounded ${tokens.tabActive}`}>Ver Detalhes</button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n              <div className=\"mt-3\">\n                {hasMoreEvents ? (\n                  <button onClick={showMoreEvents} disabled={loadingMoreEvents} className={`${tokens.tabInactive}`}>{loadingMoreEvents ? (<span className=\"inline-flex items-center gap-2\"><span className=\"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full\" /> Carregando</span>) : 'Mostrar mais'}</button>\n                ) : (\n                  <span className=\"text-xs text-slate-400\">Fim dos resultados</span>\n                )}\n                {errorEvents && (\n                  <div className=\"text-xs text-red-300 mt-1 inline-flex items-center gap-2\">\n                    <span>{errorEvents}</span>\n                    <button onClick={showMoreEvents} className=\"px-2 py-0.5 rounded bg-red-900/20 border border-red-600/40 text-red-300\">Tentar novamente</button>\n                  </div>\n                )}\n              </div>\n            </>) : (\n              <div className=\"text-center py-12 text-slate-400\">\n                <div className=\"text-6xl mb-2\"></div>\n                <div>Nenhum evento disponvel</div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {tab==='create' && (\n        <div className={`max-w-2xl mx-auto bg-gray-800 p-6 rounded border ${seasonalBorder}`}>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm text-slate-200\">Nome</label>\n              <input value={name} onChange={e=>setName(e.target.value)} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-200\">Data/Horrio</label>\n              <input type=\"datetime-local\" value={dateTime} onChange={e=>setDateTime(e.target.value)} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-200\">Localizao</label>\n              <input value={locationText} onChange={e=>setLocationText(e.target.value)} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n              <div className=\"grid grid-cols-2 gap-2 mt-2\">\n                <input placeholder=\"Lat\" value={lat} onChange={e=>setLat(e.target.value)} className=\"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n                <input placeholder=\"Lng\" value={lng} onChange={e=>setLng(e.target.value)} className=\"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-200\">Descrio</label>\n              <textarea value={description} onChange={e=>setDescription(e.target.value)} rows={4} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-200\">Limite de participantes</label>\n              <input type=\"number\" value={capacity} onChange={e=>setCapacity(Number(e.target.value))} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n              <div className=\"text-xs text-slate-400 mt-1\">{seasonPassActive?.active ? 'Passe de temporada ativo: capacidade recomendada ampliada.' : 'Capacidade padro.'}</div>\n              <div className=\"mt-2\">\n                <button onClick={()=>setCapacity(seasonPassActive?.active ? 200 : 100)} className={`${tokens.tabActive} text-xs`}>Aplicar capacidade sugerida</button>\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-200\">Categorias/tags (separadas por vrgula)</label>\n              <input value={tags} onChange={e=>setTags(e.target.value)} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-200\">Privacidade</label>\n              <select value={privacy} onChange={e=>setPrivacy(e.target.value as any)} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\">\n                <option value=\"public\">Pblico</option>\n                <option value=\"private\">Privado</option>\n                <option value=\"invite\">Convidados especficos</option>\n              </select>\n            </div>\n            {privacy !== 'public' && (\n              <div>\n                <label className=\"block text-sm text-slate-200\">Convidados (IDs separados por vrgula)</label>\n                <input value={invitedCsv} onChange={e=>setInvitedCsv(e.target.value)} className=\"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n                {friends.length>0 && (\n                  <div className=\"mt-2\">\n                    <div className=\"text-xs text-slate-400 mb-1\">Selecione amigos para adicionar</div>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                      {friends.map(fid => (\n                        <button key={fid} type=\"button\" onClick={() => {\n                          const ids = invitedCsv.split(',').map(s=>s.trim()).filter(Boolean);\n                          if (!ids.includes(fid)) setInvitedCsv(ids.concat(fid).join(', '));\n                        }} className={`${tokens.tabInactive} text-xs`}>\n                          {fid.slice(0,6)}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n            <button onClick={handleCreate} disabled={!name.trim() || !dateTime || loading || !isLogged} className={`w-full px-4 py-2 rounded ${tokens.tabActive}`}>Criar Evento</button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SocialEventsPage;","import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useHeroStore } from '../store/heroStore';\nimport { SocialEvent, getEvent, attendEvent, fetchEventChat, sendEventChat, listEventMedia, addEventMedia, rateEvent, updateEvent } from '../services/socialEventsService';\nimport { computeOccupancyPercent, isNearFull } from '../utils/eventsHelpers';\nimport { trackMetric } from '../utils/metricsSystem';\nimport { listFriends } from '../services/userService';\n\nconst EventDetailPage: React.FC = () => {\n  const { id } = useParams();\n  const { getSelectedHero } = useHeroStore();\n  const me = getSelectedHero();\n  const viewerId = useMemo(() => me?.id || '', [me?.id]);\n  const [ev, setEv] = useState<SocialEvent | null>(null);\n  const [attStatus, setAttStatus] = useState<'yes'|'no'|'maybe'|''>('');\n  const [chat, setChat] = useState<{ id: string; userId: string; text: string; ts: number }[]>([]);\n  const [chatInput, setChatInput] = useState('');\n  const [chatSending, setChatSending] = useState(false);\n  const [media, setMedia] = useState<{ id: string; userId: string; url: string; caption?: string; ts: number }[]>([]);\n  const [mediaUrl, setMediaUrl] = useState('');\n  const [mediaCaption, setMediaCaption] = useState('');\n  const [chatLoading, setChatLoading] = useState(false);\n  const [mediaLoading, setMediaLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [rating, setRating] = useState<number>(5);\n  const [ratingComment, setRatingComment] = useState('');\n  const [friends, setFriends] = useState<string[]>([]);\n  const [addingInvite, setAddingInvite] = useState<boolean>(false);\n  const [presenceError, setPresenceError] = useState<string | null>(null);\n  const [mediaRefreshCount, setMediaRefreshCount] = useState<number | null>(null);\n  const [autoRefreshMedia, setAutoRefreshMedia] = useState(false);\n  const [refreshIntervalSec, setRefreshIntervalSec] = useState(30);\n  const mediaAutoRef = useRef<any>(null);\n  const [autoRefreshChat, setAutoRefreshChat] = useState(false);\n  const [chatIntervalSec, setChatIntervalSec] = useState(30);\n  const chatAutoRef = useRef<any>(null);\n  const [newMsgCount, setNewMsgCount] = useState(0);\n  const [lastSeenTs, setLastSeenTs] = useState<number | null>(null);\n  const initialAbortRef = useRef<AbortController | null>(null);\n  const mediaAbortRef = useRef<AbortController | null>(null);\n  const chatAbortRef = useRef<AbortController | null>(null);\n\n  const load = async () => {\n    if (!id) return;\n    const e = await getEvent(id, viewerId);\n    setEv(e);\n    if (e) {\n      const s = e.attendees?.[viewerId];\n      setAttStatus((s as any) || '');\n      setChatLoading(true);\n      if (initialAbortRef.current) { try { initialAbortRef.current.abort(); } catch {} }\n      initialAbortRef.current = new AbortController();\n      const msgs = await fetchEventChat(e.id, initialAbortRef.current.signal);\n      setChat(msgs);\n      setLastSeenTs(msgs.length ? Math.max(...msgs.map(m => m.ts)) : null);\n      setNewMsgCount(0);\n      setChatLoading(false);\n      setMediaLoading(true);\n      const m = await listEventMedia(e.id, initialAbortRef.current.signal);\n      setMedia(m);\n      setMediaLoading(false);\n    }\n  };\n\n  useEffect(() => { load(); }, [id, viewerId]);\n  useEffect(() => { return () => { try { initialAbortRef.current?.abort(); } catch {} try { mediaAbortRef.current?.abort(); } catch {} try { chatAbortRef.current?.abort(); } catch {} }; }, []);\n  useEffect(() => { (async () => { if (!viewerId) { setFriends([]); return; } try { const f = await listFriends(viewerId); setFriends(f); } catch {} })(); }, [viewerId]);\n\n  const attendeesCount = useMemo(() => Object.values(ev?.attendees || {}).filter(v => v==='yes').length, [ev?.attendees]);\n  const nearFull = useMemo(() => isNearFull(ev?.capacity, ev?.attendees), [ev?.capacity, ev?.attendees]);\n  const occupancyPercent = useMemo(() => computeOccupancyPercent(ev?.capacity, ev?.attendees), [ev?.capacity, ev?.attendees]);\n\n  const canRate = useMemo(() => {\n    if (!ev) return false;\n    const dt = new Date(ev.dateTime).getTime();\n    const past = Date.now() >= dt;\n    const attended = ev.attendees?.[viewerId] === 'yes';\n    return past && attended;\n  }, [ev, viewerId]);\n\n  const googleMapSrc = useMemo(() => {\n    if (!ev) return '';\n    if (typeof ev.lat === 'number' && typeof ev.lng === 'number') {\n      const q = `${ev.lat},${ev.lng}`;\n      return `https://www.google.com/maps?q=${encodeURIComponent(q)}&output=embed`;\n    }\n    if (ev.locationText) {\n      return `https://www.google.com/maps?q=${encodeURIComponent(ev.locationText)}&output=embed`;\n    }\n    return '';\n  }, [ev?.lat, ev?.lng, ev?.locationText]);\n\n  const setPresence = async (s: 'yes'|'no'|'maybe') => {\n    if (!ev || !viewerId) return;\n    try {\n      setPresenceError(null);\n      const updated = await attendEvent(ev.id, viewerId, s);\n      setEv(updated);\n      setAttStatus(s);\n      try { trackMetric.featureUsed(me?.id || 'system', 'event_presence_set'); } catch {}\n    } catch (err: any) {\n      setPresenceError(err?.message || 'Falha ao confirmar presena');\n    }\n  };\n\n  const sendMsg = async () => {\n    if (!ev || !viewerId) return;\n    const t = chatInput.trim();\n    if (!t) return;\n    const msg = await sendEventChat(ev.id, viewerId, t);\n    setChat(prev => [...prev.slice(-99), msg]);\n    setChatInput('');\n  };\n\n  const addMediaItem = async () => {\n    if (!ev || !viewerId) return;\n    const u = mediaUrl.trim();\n    if (!u) return;\n    setUploading(true);\n    setUploadProgress(5);\n    let timer: any = null;\n    try {\n      timer = setInterval(() => { setUploadProgress(p => Math.min(90, p + 15)); }, 150);\n      const m = await addEventMedia(ev.id, viewerId, u, mediaCaption.trim() || undefined);\n      setUploadProgress(100);\n      setTimeout(() => { setUploading(false); setUploadProgress(0); }, 300);\n      setMedia(prev => [...prev.slice(-99), m]);\n      setMediaUrl('');\n      setMediaCaption('');\n      try { trackMetric.featureUsed(me?.id || 'system', 'event_media_add'); } catch {}\n    } catch {\n      setUploading(false);\n      setUploadProgress(0);\n    } finally {\n      if (timer) clearInterval(timer);\n    }\n  };\n\n  const submitRating = async () => {\n    if (!ev || !viewerId) return;\n    const ok = await rateEvent(ev.id, viewerId, rating, ratingComment.trim() || undefined);\n    if (ok) {\n      setRatingComment('');\n    }\n  };\n\n  const addFriendInvite = async (fid: string) => {\n    try {\n      if (!ev || !viewerId || ev.ownerId !== viewerId) return;\n      setAddingInvite(true);\n      const invited = Array.isArray(ev?.invitedIds) ? ev.invitedIds.slice() : [];\n      if (!invited.includes(fid)) invited.push(fid);\n      const upd = await updateEvent(ev.id, viewerId, { invitedIds: invited });\n      setEv(upd);\n    } catch {} finally { setAddingInvite(false); }\n  };\n\n  useEffect(() => {\n    if (!ev || !autoRefreshMedia) return;\n    const tick = async () => {\n      try {\n        if (mediaAbortRef.current) { try { mediaAbortRef.current.abort(); } catch {} }\n        mediaAbortRef.current = new AbortController();\n        const m = await listEventMedia(ev.id, mediaAbortRef.current.signal);\n        setMedia(m);\n      } catch {}\n    };\n    mediaAutoRef.current = setInterval(tick, refreshIntervalSec * 1000);\n    try { trackMetric.featureUsed(me?.id || 'system', 'event_media_auto_refresh_enabled'); } catch {}\n    return () => {\n      if (mediaAutoRef.current) {\n        clearInterval(mediaAutoRef.current);\n        mediaAutoRef.current = null;\n        try { trackMetric.featureUsed(me?.id || 'system', 'event_media_auto_refresh_disabled'); } catch {}\n      }\n      try { mediaAbortRef.current?.abort(); } catch {}\n    };\n  }, [autoRefreshMedia, ev?.id, refreshIntervalSec]);\n\n  useEffect(() => {\n    if (!ev || !autoRefreshChat) return;\n    const tick = async () => {\n      try {\n        if (chatAbortRef.current) { try { chatAbortRef.current.abort(); } catch {} }\n        chatAbortRef.current = new AbortController();\n        const msgs = await fetchEventChat(ev.id, chatAbortRef.current.signal);\n        setChat(msgs);\n        const latest = msgs.length ? Math.max(...msgs.map(m => m.ts)) : null;\n        if (latest !== null && lastSeenTs !== null) {\n          const count = msgs.filter(m => m.ts > lastSeenTs).length;\n          setNewMsgCount(count);\n        }\n      } catch {}\n    };\n    chatAutoRef.current = setInterval(tick, chatIntervalSec * 1000);\n    try { trackMetric.featureUsed(me?.id || 'system', 'event_chat_auto_refresh_enabled'); } catch {}\n    return () => {\n      if (chatAutoRef.current) {\n        clearInterval(chatAutoRef.current);\n        chatAutoRef.current = null;\n        try { trackMetric.featureUsed(me?.id || 'system', 'event_chat_auto_refresh_disabled'); } catch {}\n      }\n      try { chatAbortRef.current?.abort(); } catch {}\n    };\n  }, [autoRefreshChat, ev?.id, chatIntervalSec]);\n\n  const downloadICS = () => {\n    if (!ev) return;\n    const dt = new Date(ev.dateTime);\n    const pad = (n: number) => String(n).padStart(2, '0');\n    const toUTC = (d: Date) => {\n      const yyyy = d.getUTCFullYear();\n      const mm = pad(d.getUTCMonth() + 1);\n      const dd = pad(d.getUTCDate());\n      const HH = pad(d.getUTCHours());\n      const MM = pad(d.getUTCMinutes());\n      const SS = pad(d.getUTCSeconds());\n      return `${yyyy}${mm}${dd}T${HH}${MM}${SS}Z`;\n    };\n    const start = toUTC(dt);\n    const end = toUTC(new Date(dt.getTime() + 2 * 60 * 60 * 1000));\n    const uid = `evt-${ev.id}@heroforgenew`;\n    const lines = [\n      'BEGIN:VCALENDAR',\n      'VERSION:2.0',\n      'PRODID:-//HeroForgeNew//Social Events//EN',\n      'CALSCALE:GREGORIAN',\n      'METHOD:PUBLISH',\n      'BEGIN:VEVENT',\n      `UID:${uid}`,\n      `DTSTAMP:${start}`,\n      `DTSTART:${start}`,\n      `DTEND:${end}`,\n      `SUMMARY:${(ev.name||'Evento').replace(/\\r|\\n/g,' ')}`,\n      `DESCRIPTION:${(ev.description||'').replace(/\\r|\\n/g,' ')}`,\n      `LOCATION:${(ev.locationText||'').replace(/\\r|\\n/g,' ')}`,\n      'END:VEVENT',\n      'END:VCALENDAR'\n    ];\n    const blob = new Blob([lines.join('\\r\\n')], { type: 'text/calendar;charset=utf-8' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${ev.name?.replace(/[^a-z0-9]+/gi,'-') || 'evento'}.ics`;\n    a.click();\n    URL.revokeObjectURL(url);\n    try { trackMetric.featureUsed(me?.id || 'system', 'event_ics_downloaded'); } catch {}\n  };\n\n  const shareEvent = () => {\n    if (!ev) return;\n    const url = window.location.origin + `/event/${ev.id}`;\n    const text = `${ev.name}  ${new Date(ev.dateTime).toLocaleString()}${ev.locationText?`  ${ev.locationText}`:''}`;\n    const body = `${text}\\n${url}`;\n    const wa = `https://wa.me/?text=${encodeURIComponent(body)}`;\n    const mail = `mailto:?subject=${encodeURIComponent(ev.name||'Evento')}&body=${encodeURIComponent(body)}`;\n    const tg = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;\n    try {\n      const nav: any = navigator;\n      if (nav.share) {\n        nav.share({ title: ev.name, text, url });\n        try { trackMetric.featureUsed(me?.id || 'system', 'event_shared_native'); } catch {}\n        return;\n      }\n    } catch {}\n    window.open(wa, '_blank');\n    try { trackMetric.featureUsed(me?.id || 'system', 'event_shared_whatsapp'); } catch {}\n  };\n\n  const copyEventLink = async () => {\n    try {\n      if (!ev) return;\n      const url = window.location.origin + `/event/${ev.id}`;\n      await navigator.clipboard.writeText(url);\n      try { trackMetric.featureUsed(me?.id || 'system', 'event_link_copied'); } catch {}\n    } catch {}\n  };\n\n  if (!ev) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-2\"></div>\n        <div className=\"text-gray-600\">Evento no encontrado</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6 space-y-6\">\n      <div className=\"bg-white p-6 rounded border\">\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <div className=\"text-2xl font-bold text-gray-800\">{ev.name}</div>\n            <div className=\"text-sm text-gray-600\">{new Date(ev.dateTime).toLocaleString()}</div>\n            {ev.locationText && <div className=\"text-sm text-gray-600\">{ev.locationText}</div>}\n            <div className=\"text-sm text-gray-600 mt-1\">Capacidade: {ev.capacity}  Confirmados: {attendeesCount}</div>\n          </div>\n          <div className=\"text-3xl\"></div>\n        </div>\n        <div className=\"mt-3 text-gray-800 whitespace-pre-line\">{ev.description}</div>\n        {nearFull && (\n          <div className=\"mt-2 text-xs px-2 py-1 rounded bg-red-50 text-red-700 border border-red-200 inline-block\">Quase lotado</div>\n        )}\n        <div className=\"mt-3\">\n          <div className=\"text-xs text-gray-600 mb-1\">Ocupao</div>\n          <div className=\"w-full h-2 bg-gray-200 rounded\">\n            <div className={`h-2 rounded ${nearFull ? 'bg-red-500' : 'bg-green-500'}`} style={{ width: `${occupancyPercent}%` }} />\n          </div>\n          <div className=\"text-xs text-gray-600 mt-1\">{occupancyPercent}%</div>\n        </div>\n        {googleMapSrc && (\n          <div className=\"mt-4\">\n            <iframe title=\"map\" src={googleMapSrc} className=\"w-full h-64 rounded border\" loading=\"lazy\" />\n          </div>\n        )}\n        <div className=\"mt-4 flex gap-2\">\n          <button onClick={()=>setPresence('yes')} disabled={attendeesCount >= (ev.capacity||0) && attStatus !== 'yes'} className={`px-3 py-2 rounded ${attStatus==='yes'?'bg-green-600 text-white':'bg-gray-200 text-gray-800'} ${attendeesCount >= (ev.capacity||0) && attStatus !== 'yes' ? 'opacity-60 cursor-not-allowed' : ''}`}>Vou</button>\n          <button onClick={()=>setPresence('maybe')} className={`px-3 py-2 rounded ${attStatus==='maybe'?'bg-yellow-500 text-white':'bg-gray-200 text-gray-800'}`}>Talvez</button>\n          <button onClick={()=>setPresence('no')} className={`px-3 py-2 rounded ${attStatus==='no'?'bg-red-500 text-white':'bg-gray-200 text-gray-800'}`}>No vou</button>\n          {presenceError && <span className=\"text-xs text-red-600 ml-2\">{presenceError}</span>}\n          <div className=\"ml-auto flex items-center gap-2\">\n            <button onClick={downloadICS} className=\"px-3 py-2 rounded bg-gray-800 text-white\">Adicionar ao calendrio</button>\n            <button onClick={shareEvent} className=\"px-3 py-2 rounded bg-indigo-600 text-white\">Compartilhar</button>\n            <button onClick={copyEventLink} className=\"px-3 py-2 rounded bg-gray-200 text-gray-800\">Copiar Link</button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"font-semibold mb-2 flex items-center justify-between\"><span>Chat do Evento</span><div className=\"flex items-center gap-2\"><label className=\"flex items-center gap-1 text-xs text-gray-600\"><input type=\"checkbox\" checked={autoRefreshChat} onChange={e=>setAutoRefreshChat(e.target.checked)} /> Auto-refresh</label><select value={chatIntervalSec} onChange={e=>setChatIntervalSec(Number(e.target.value))} className=\"px-2 py-1 rounded border text-xs\"><option value={15}>15s</option><option value={30}>30s</option><option value={60}>60s</option></select>{newMsgCount>0 && (<span className=\"px-2 py-0.5 rounded bg-amber-100 text-amber-700 text-xs\">Novas {newMsgCount}</span>)}<button onClick={()=>{ const latest = chat.length ? Math.max(...chat.map(m=>m.ts)) : null; setLastSeenTs(latest); setNewMsgCount(0); }} className=\"px-2 py-1 rounded bg-gray-200 text-gray-800 text-xs\">Marcar como lidas</button></div></div>\n          <div className=\"max-h-60 overflow-y-auto border rounded p-2 bg-gray-50\">\n            {chatLoading && chat.length===0 && (\n              <div className=\"space-y-2 animate-pulse\">\n                <div className=\"h-3 bg-gray-200 rounded w-3/4\" />\n                <div className=\"h-3 bg-gray-200 rounded w-2/3\" />\n                <div className=\"h-3 bg-gray-200 rounded w-1/2\" />\n              </div>\n            )}\n            {chatSending && (\n              <div className=\"text-xs text-gray-600\">Enviando</div>\n            )}\n            {chat.length>0 ? chat.map(m => (\n              <div key={m.id} className=\"text-sm text-gray-800 flex justify-between\">\n                <span><span className=\"font-semibold\">{m.userId.slice(0,6)}</span>: {m.text}</span>\n                <span className=\"text-xs text-gray-500\">{new Date(m.ts).toLocaleTimeString()}</span>\n              </div>\n            )) : <div className=\"text-xs text-gray-500\">Sem mensagens ainda</div>}\n          </div>\n          <div className=\"flex gap-2 mt-2\">\n            <input value={chatInput} onChange={e=>setChatInput(e.target.value)} placeholder=\"Mensagem\" className=\"flex-1 p-2 border rounded\" />\n            <button onClick={sendMsg} disabled={!chatInput.trim() || chatSending} className=\"px-3 py-2 rounded bg-blue-600 text-white\">{chatSending ? 'Enviando' : 'Enviar'}</button>\n          </div>\n        </div>\n\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"font-semibold mb-2 flex items-center justify-between\">\n            <span>Mdias</span>\n            <div className=\"flex items-center gap-2\">\n              {viewerId === ev.ownerId && (\n                <>\n                  <label className=\"flex items-center gap-1 text-xs text-gray-600\">\n                    <input type=\"checkbox\" checked={autoRefreshMedia} onChange={e=>setAutoRefreshMedia(e.target.checked)} /> Auto-refresh\n                  </label>\n                  <select value={refreshIntervalSec} onChange={e=>setRefreshIntervalSec(Number(e.target.value))} className=\"px-2 py-1 rounded border text-xs\">\n                    <option value={15}>15s</option>\n                    <option value={30}>30s</option>\n                    <option value={60}>60s</option>\n                  </select>\n                </>\n              )}\n              <button onClick={async()=>{ if (!ev) return; const prev = media.length; setMediaLoading(true); try { const m = await listEventMedia(ev.id); setMedia(m); setMediaRefreshCount(Math.max(0, m.length - prev)); try { trackMetric.featureUsed(me?.id || 'system', 'event_media_refresh'); } catch {} } finally { setMediaLoading(false);} }} className=\"px-2 py-1 rounded bg-gray-200 text-gray-800 text-xs\">Atualizar</button>\n            </div>\n          </div>\n          {mediaRefreshCount !== null && (\n            <div className=\"text-xs text-gray-600 mb-2\">Atualizado {mediaRefreshCount} itens</div>\n          )}\n          {mediaLoading && media.length===0 && (\n            <div className=\"grid grid-cols-2 gap-3 animate-pulse\">\n              <div className=\"border rounded overflow-hidden\">\n                <div className=\"w-full h-32 bg-gray-200\" />\n              </div>\n              <div className=\"border rounded overflow-hidden\">\n                <div className=\"w-full h-32 bg-gray-200\" />\n              </div>\n            </div>\n          )}\n          <div className=\"grid grid-cols-2 gap-3\">\n            {media.map(m => (\n              <div key={m.id} className=\"border rounded overflow-hidden\">\n                <img src={m.url} alt={m.caption||''} className=\"w-full h-32 object-cover\" />\n                {m.caption && <div className=\"text-xs p-2 text-gray-700\">{m.caption}</div>}\n              </div>\n            ))}\n          </div>\n          <div className=\"mt-2 flex gap-2\">\n            <input value={mediaUrl} onChange={e=>setMediaUrl(e.target.value)} placeholder=\"URL da imagem/vdeo\" className=\"flex-1 p-2 border rounded\" />\n            <input value={mediaCaption} onChange={e=>setMediaCaption(e.target.value)} placeholder=\"Legenda (opcional)\" className=\"flex-1 p-2 border rounded\" />\n            <button onClick={addMediaItem} disabled={!mediaUrl.trim() || uploading} className=\"px-3 py-2 rounded bg-indigo-600 text-white\">{uploading ? 'Enviando' : 'Adicionar'}</button>\n          </div>\n          {uploading && (\n            <div className=\"mt-2\">\n              <div className=\"w-full h-2 bg-gray-200 rounded\">\n                <div className=\"h-2 rounded bg-indigo-600\" style={{ width: `${uploadProgress}%` }} />\n              </div>\n              <div className=\"text-xs text-gray-600 mt-1\">{uploadProgress}%</div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {canRate && (\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"font-semibold mb-2\">Avaliao ps-evento</div>\n          <div className=\"flex items-center gap-3\">\n            <input type=\"range\" min={1} max={5} value={rating} onChange={e=>setRating(Number(e.target.value))} />\n            <div className=\"text-sm text-gray-700\">{rating} </div>\n          </div>\n          <textarea value={ratingComment} onChange={e=>setRatingComment(e.target.value)} rows={3} placeholder=\"Comentrio\" className=\"mt-2 w-full p-2 border rounded\" />\n          <button onClick={submitRating} className=\"mt-2 px-3 py-2 rounded bg-amber-600 text-white\">Enviar Avaliao</button>\n        </div>\n      )}\n\n      {viewerId === ev.ownerId && (\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"font-semibold mb-2\">Convidar Amigos</div>\n          {friends.length>0 ? (\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\n              {friends.map(fid => (\n                <button key={fid} onClick={()=>addFriendInvite(fid)} disabled={addingInvite || (ev.invitedIds||[]).includes(fid)} className={`px-2 py-1 rounded ${ (ev.invitedIds||[]).includes(fid) ? 'bg-gray-300 text-gray-700' : 'bg-indigo-600 text-white hover:bg-indigo-700' } text-xs`}>\n                  {fid.slice(0,6)}\n                </button>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-xs text-gray-500\">Sua lista de amigos est vazia.</div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default EventDetailPage;","import React, { useEffect, useMemo, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { useHeroStore } from '../store/heroStore';\nimport { SocialEvent, listEvents, updateEvent, deleteEvent } from '../services/socialEventsService';\nimport { computeOccupancyPercent, isNearFull } from '../utils/eventsHelpers';\nimport { trackMetric } from '../utils/metricsSystem';\n\nconst OrganizerDashboard: React.FC = () => {\n  const { getSelectedHero } = useHeroStore();\n  const me = getSelectedHero();\n  const ownerId = useMemo(() => me?.id || '', [me?.id]);\n  const location = useLocation();\n  const [events, setEvents] = useState<SocialEvent[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [importing, setImporting] = useState(false);\n  const [sortMode, setSortMode] = useState<'date'|'occupancy'>('date');\n  const [nearFullOnly, setNearFullOnly] = useState(false);\n  const { activeSeasonalTheme } = (useHeroStore() as any);\n  const seasonalBorder = activeSeasonalTheme ? (seasonalThemes as any)[activeSeasonalTheme]?.border || 'border-slate-700' : 'border-slate-700';\n\n  const load = async () => {\n    if (!ownerId) { setEvents([]); return; }\n    setLoading(true);\n    try { const list = await listEvents(ownerId, { ownerId }); setEvents(list); } catch {}\n    setLoading(false);\n  };\n\n  useEffect(() => { load(); }, [ownerId]);\n\n  useEffect(() => {\n    try {\n      const p = new URLSearchParams(location.search);\n      const nf = p.get('nearFull');\n      if (nf === '1') setNearFullOnly(true);\n    } catch {}\n  }, [location.search]);\n\n  const save = async (id: string, updates: Partial<SocialEvent>) => {\n    if (!ownerId) return;\n    const ev = await updateEvent(id, ownerId, updates);\n    setEvents(prev => prev.map(e => e.id===id ? ev : e));\n  };\n\n  const remove = async (id: string) => {\n    if (!ownerId) return;\n    const ok = await deleteEvent(id, ownerId);\n    if (ok) setEvents(prev => prev.filter(e => e.id !== id));\n  };\n\n  useEffect(() => {\n    try { trackMetric.custom?.('organizer_sort_changed', { mode: sortMode }); } catch {}\n  }, [sortMode]);\n\n  const exportEvents = async () => {\n    try {\n      if (!ownerId) return;\n      const q = new URLSearchParams();\n      q.set('ownerId', ownerId);\n      const res = await fetch(`/api/events/export?${q.toString()}`);\n      if (!res.ok) return;\n      const data = await res.json();\n      const blob = new Blob([JSON.stringify(data?.events || [], null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `events-${ownerId}-${Date.now()}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } catch {}\n  };\n\n  const importEvents = async (file: File) => {\n    try {\n      if (!ownerId) return;\n      setImporting(true);\n      const text = await file.text();\n      const list = JSON.parse(text);\n      const res = await fetch('/api/events/import', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ actorId: ownerId, events: Array.isArray(list) ? list : [] }) });\n      if (res.ok) load();\n    } catch {} finally { setImporting(false); }\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {nearFullOnly && (\n        <div className=\"mb-4 text-xs text-red-300 bg-red-900/20 border border-red-600/40 rounded p-3\">Filtrando por eventos quase lotados (ocupao  90%).</div>\n      )}\n      {events.length>0 && (\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-6\">\n          {(() => { const total = events.length; const avg = Math.round(events.reduce((sum,e)=> sum + computeOccupancyPercent(e.capacity, e.attendees), 0) / Math.max(1, total)); const near = events.filter(e=> isNearFull(e.capacity, e.attendees)).length; return (\n            <>\n              <div className={`bg-gray-800 p-4 rounded border ${seasonalBorder}`}><div className=\"text-sm text-slate-400\">Eventos</div><div className=\"text-2xl font-bold text-white\">{total}</div></div>\n              <div className={`bg-gray-800 p-4 rounded border ${seasonalBorder}`}><div className=\"text-sm text-slate-400\">Ocupao mdia</div><div className=\"text-2xl font-bold text-white\">{avg}%</div></div>\n              <div className={`bg-gray-800 p-4 rounded border ${seasonalBorder}`}><div className=\"text-sm text-slate-400\">Quase lotados</div><div className=\"text-2xl font-bold text-white\">{near}</div></div>\n            </>\n          ) })()}\n        </div>\n      )}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-3xl font-bold text-white\"> Painel do Organizador</h1>\n        <div className=\"flex items-center gap-2\">\n          <button onClick={load} className={`${tokens.tabInactive}`}>Atualizar</button>\n          <button onClick={exportEvents} className={`${tokens.tabActive}`}>Exportar</button>\n          <label className={`${tokens.tabActive} cursor-pointer`}>\n            Importar\n            <input type=\"file\" accept=\"application/json\" onChange={e=>{ const f=e.target.files?.[0]; if (f) importEvents(f); }} className=\"hidden\" />\n          </label>\n          {importing && <span className=\"text-xs text-slate-400\">Importando</span>}\n          <label className=\"flex items-center gap-2 text-xs text-slate-400 ml-2\">\n            <span>Ordenar</span>\n            <select value={sortMode} onChange={e=>setSortMode(e.target.value as any)} className=\"px-2 py-1 rounded border bg-slate-900 border-slate-600 text-slate-200\">\n              <option value=\"date\">Data</option>\n              <option value=\"occupancy\">Ocupao</option>\n            </select>\n          </label>\n          <label className=\"flex items-center gap-2 text-xs text-slate-400 ml-2\">\n            <input type=\"checkbox\" checked={nearFullOnly} onChange={e=>setNearFullOnly(e.target.checked)} /> Quase lotados\n          </label>\n        </div>\n      </div>\n      {!ownerId && <div className=\"bg-red-900/20 border border-red-600/40 p-4 rounded mb-6 text-red-300 text-sm\">Selecione um heri para gerenciar seus eventos.</div>}\n      {events.length>0 ? (\n        <div className=\"space-y-4\">\n          {events\n            .filter(e => nearFullOnly ? isNearFull((e as any).capacity, (e as any).attendees) : true)\n            .slice()\n            .sort((a,b) => {\n              if (sortMode === 'occupancy') {\n                return computeOccupancyPercent(b.capacity, b.attendees) - computeOccupancyPercent(a.capacity, a.attendees);\n              }\n              return new Date(a.dateTime).getTime() - new Date(b.dateTime).getTime();\n            })\n            .map(e => (\n            <div key={e.id} className={`bg-gray-800 p-4 rounded border ${seasonalBorder}`}>\n              <div className=\"flex items-start justify-between\">\n                <div>\n                  <input value={e.name} onChange={ev=>save(e.id, { name: ev.target.value })} className=\"text-lg font-semibold text-white w-full bg-transparent\" />\n                  <div className=\"text-xs text-slate-400\">{new Date(e.dateTime).toLocaleString()}</div>\n                  {(() => { const pct = computeOccupancyPercent(e.capacity, e.attendees); const near = isNearFull(e.capacity, e.attendees); return (\n                    <div className=\"mt-1\">\n                      <div className=\"flex items-center gap-2\">\n                        {near && <span className=\"px-2 py-0.5 rounded bg-red-900/20 text-red-300 border border-red-600/40 text-[11px]\">Quase lotado</span>}\n                        <span className=\"text-[11px] text-slate-400\">Ocupao: {pct}%</span>\n                      </div>\n                      <div className=\"w-full h-2 bg-slate-700 rounded mt-1\">\n                        <div className={`h-2 rounded ${near ? 'bg-red-500' : 'bg-emerald-500'}`} style={{ width: `${pct}%` }} />\n                      </div>\n                    </div>\n                  ); })()}\n                </div>\n                <button onClick={()=>remove(e.id)} className=\"px-3 py-2 rounded bg-red-600 text-white\">Excluir</button>\n              </div>\n              <textarea value={e.description||''} onChange={ev=>save(e.id, { description: ev.target.value })} rows={3} className=\"mt-2 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2\">\n                <input value={e.locationText||''} onChange={ev=>save(e.id, { locationText: ev.target.value })} placeholder=\"Localizao\" className=\"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n                <input value={e.lat?.toString()||''} onChange={ev=>save(e.id, { lat: ev.target.value ? Number(ev.target.value) : undefined })} placeholder=\"Lat\" className=\"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n                <input value={e.lng?.toString()||''} onChange={ev=>save(e.id, { lng: ev.target.value ? Number(ev.target.value) : undefined })} placeholder=\"Lng\" className=\"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n                <input type=\"number\" value={e.capacity} onChange={ev=>save(e.id, { capacity: Number(ev.target.value) })} placeholder=\"Capacidade\" className=\"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\" />\n              </div>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2\">\n                <select value={e.privacy} onChange={ev=>save(e.id, { privacy: ev.target.value as any })} className=\"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\">\n                  <option value=\"public\">Pblico</option>\n                  <option value=\"private\">Privado</option>\n                  <option value=\"invite\">Convidados</option>\n                </select>\n                <input value={(e.tags||[]).join(', ')} onChange={ev=>save(e.id, { tags: ev.target.value.split(',').map(s=>s.trim()).filter(Boolean) })} placeholder=\"Tags\" className=\"p-2 border rounded col-span-3 bg-slate-900 border-slate-600 text-slate-200\" />\n              </div>\n              <div className=\"text-xs text-slate-400 mt-2\">ID: {e.id}</div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 text-slate-400\">\n          <div className=\"text-6xl mb-2\"></div>\n          <div>Nenhum evento criado</div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default OrganizerDashboard;\nimport { seasonalThemes } from '../styles/medievalTheme';\nimport { tokens } from '../styles/designTokens';","import React, { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { listFriends, addFriend, removeFriend } from '../services/userService';\nimport { tokens } from '../styles/designTokens';\n\nconst FriendsPage: React.FC = () => {\n  const { getSelectedHero, heroes } = useHeroStore();\n  const me = getSelectedHero();\n  const userId = useMemo(() => me?.id || '', [me?.id]);\n  const [friends, setFriends] = useState<string[]>([]);\n  const [targetId, setTargetId] = useState('');\n\n  const load = async () => {\n    if (!userId) { setFriends([]); return; }\n    const list = await listFriends(userId);\n    setFriends(list);\n  };\n\n  useEffect(() => { load(); }, [userId]);\n\n  const add = async () => {\n    if (!userId || !targetId) return;\n    const ok = await addFriend(userId, targetId);\n    if (ok) load();\n    setTargetId('');\n  };\n\n  const remove = async (id: string) => {\n    if (!userId) return;\n    const ok = await removeFriend(userId, id);\n    if (ok) load();\n  };\n\n  if (!userId) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-2\"></div>\n        <div className=\"text-slate-400\">Selecione um heri para gerenciar amigos</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <div className={`bg-gray-800 p-6 rounded border border-slate-700`}>\n        <div className=\"text-2xl font-bold text-white mb-4\">Amigos</div>\n        <div className=\"flex gap-2 mb-4\">\n          <select value={targetId} onChange={e=>setTargetId(e.target.value)} className=\"flex-1 p-2 border rounded bg-slate-900 border-slate-600 text-slate-200\">\n            <option value=\"\">Selecionar heri</option>\n            {heroes.filter(h=>h.id!==userId).map(h=> (\n              <option key={h.id} value={h.id}>{h.name}</option>\n            ))}\n          </select>\n          <button onClick={add} disabled={!targetId} className={`${tokens.tabActive}`}>Adicionar</button>\n        </div>\n        <div>\n          <div className=\"text-sm font-semibold text-slate-300 mb-2\">Seus amigos</div>\n          <ul className=\"space-y-2\">\n            {friends.map(fid => (\n              <li key={fid} className=\"flex items-center justify-between bg-slate-800 p-2 rounded border border-slate-700\">\n                <span className=\"text-slate-100\">{heroes.find(h=>h.id===fid)?.name || fid.slice(0,6)}</span>\n                <button onClick={()=>remove(fid)} className=\"px-3 py-1 rounded bg-red-600 text-white text-sm\">Remover</button>\n              </li>\n            ))}\n            {friends.length===0 && (\n              <li className=\"text-xs text-slate-400\">Voc ainda no tem amigos adicionados.</li>\n            )}\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FriendsPage;","import React, { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { listNotifications } from '../services/userService';\nimport { useNavigate } from 'react-router-dom';\nimport { tokens } from '../styles/designTokens';\n\nconst SocialNotificationsPage: React.FC = () => {\n  const { getSelectedHero } = useHeroStore();\n  const me = getSelectedHero();\n  const userId = useMemo(() => me?.id || '', [me?.id]);\n  const [items, setItems] = useState<any[]>([]);\n  const navigate = useNavigate();\n\n  const load = async () => {\n    if (!userId) { setItems([]); return; }\n    const list = await listNotifications(userId);\n    setItems(list);\n  };\n\n  useEffect(() => { load(); }, [userId]);\n\n  if (!userId) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-2\"></div>\n        <div className=\"text-slate-400\">Selecione um heri para ver notificaes</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-3xl font-bold text-white\">Notificaes</h1>\n        <button onClick={load} className={`${tokens.tabInactive}`}>Atualizar</button>\n      </div>\n      {items.length>0 ? (\n        <div className=\"space-y-3\">\n          {items.map(n => (\n            <div key={n.id} className=\"bg-gray-800 p-4 rounded border border-slate-700\">\n              <div className=\"text-sm text-slate-300\">Evento recomendado</div>\n              <div className=\"text-lg font-semibold text-white\">{n.event?.name}</div>\n              <div className=\"text-xs text-slate-400\">{new Date(n.event?.dateTime).toLocaleString()}</div>\n              <div className=\"mt-2\">\n                <button onClick={()=>navigate(`/event/${n.event?.id}`)} className={`${tokens.tabActive}`}>Ver evento</button>\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 text-slate-400\">\n          <div className=\"text-6xl mb-2\"></div>\n          <div>Sem notificaes no momento</div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SocialNotificationsPage;","import React, { useEffect, useMemo, useState } from 'react';\nimport { useHeroStore } from '../store/heroStore';\nimport { listEventsHistory } from '../services/userService';\nimport { useNavigate } from 'react-router-dom';\n\nconst UserEventsHistoryPage: React.FC = () => {\n  const { getSelectedHero } = useHeroStore();\n  const me = getSelectedHero();\n  const userId = useMemo(() => me?.id || '', [me?.id]);\n  const [events, setEvents] = useState<any[]>([]);\n  const navigate = useNavigate();\n\n  const load = async () => {\n    if (!userId) { setEvents([]); return; }\n    const list = await listEventsHistory(userId);\n    setEvents(list);\n  };\n\n  useEffect(() => { load(); }, [userId]);\n\n  if (!userId) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-2\"></div>\n        <div className=\"text-gray-600\">Selecione um heri para ver seu histrico</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-3xl font-bold text-gray-800\">Histrico de Participao</h1>\n        <button onClick={load} className=\"px-3 py-2 rounded bg-gray-200\">Atualizar</button>\n      </div>\n      {events.length>0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {events.map(ev => (\n            <div key={ev.id} className=\"bg-white p-4 rounded border hover:shadow\">\n              <div className=\"text-lg font-semibold text-gray-800\">{ev.name}</div>\n              <div className=\"text-xs text-gray-600\">{new Date(ev.dateTime).toLocaleString()}</div>\n              {ev.locationText && <div className=\"text-xs text-gray-600\">{ev.locationText}</div>}\n              <div className=\"mt-3\">\n                <button onClick={()=>navigate(`/event/${ev.id}`)} className=\"w-full px-3 py-2 rounded bg-blue-600 text-white\">Abrir</button>\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 text-gray-500\">\n          <div className=\"text-6xl mb-2\"></div>\n          <div>Nenhum evento no histrico</div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default UserEventsHistoryPage;","import React from 'react'\nimport { useHeroStore } from '../store/heroStore'\n\nconst PartyInvitesPanel: React.FC = () => {\n  const { getSelectedHero, heroes } = useHeroStore()\n  const selectedHero = getSelectedHero()\n  const parties = useHeroStore(s => (Array.isArray((s as any).parties) ? (s as any).parties : [])) as any[]\n  const acceptInvite = useHeroStore(s => s.acceptPartyInvite)\n  const declineInvite = useHeroStore(s => (s as any).declinePartyInvite)\n\n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-3xl mx-auto p-6 text-center\">\n        <div className=\"text-5xl mb-3\"></div>\n        <div className=\"text-gray-300\">Selecione um heri para gerenciar convites de party.</div>\n      </div>\n    )\n  }\n\n  const myInvites = parties.filter(p => Array.isArray(p.invites) && p.invites.includes(selectedHero.id))\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <h1 className=\"text-2xl font-bold text-amber-300 mb-4\">Convites de Party</h1>\n      {myInvites.length === 0 ? (\n        <div className=\"text-gray-400\">Nenhum convite pendente.</div>\n      ) : (\n        <div className=\"space-y-3\">\n          {myInvites.map(p => {\n            const leader = heroes.find(h => h.id === p.leaderId)\n            const leaderName = leader?.name || p.leaderId.slice(-4)\n            return (\n              <div key={p.id} className=\"flex items-center justify-between bg-white/5 border border-white/10 rounded p-3\">\n                <div>\n                  <div className=\"text-white font-semibold\">{p.name}</div>\n                  <div className=\"text-xs text-gray-300\">Lder: {leaderName}  Membros: {Array.isArray(p.members) ? p.members.length : 0}</div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <button onClick={() => acceptInvite(selectedHero.id, p.id)} className=\"px-3 py-2 rounded bg-green-600 hover:bg-green-700 text-white text-sm\">Aceitar</button>\n                  <button onClick={() => declineInvite(selectedHero.id, p.id)} className=\"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm\">Recusar</button>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default PartyInvitesPanel","import React, { useEffect, useMemo, useState } from 'react';\nimport { metricsManager } from '../utils/metricsSystem';\n\nconst MetricsDashboard: React.FC = () => {\n  const kpi = useMemo(() => metricsManager.getKPIDashboard(), []);\n  const perf = kpi.performance;\n  const eng = kpi.engagement;\n  const gp = kpi.gameplay;\n  const install = useMemo(() => {\n    const events = metricsManager.getEvents();\n    const featureEvents = events.filter(e => e.eventType === 'feature-used');\n    let accepted = 0, dismissed = 0;\n    const byDevice: Record<string, { accepted: number; dismissed: number }> = {};\n    featureEvents.forEach(ev => {\n      const f = String(ev.data?.feature || '');\n      const dev = String(ev.data?.device || 'unknown');\n      if (!byDevice[dev]) byDevice[dev] = { accepted: 0, dismissed: 0 };\n      if (f === 'pwa-install-accepted') { accepted++; byDevice[dev].accepted++; }\n      if (f === 'pwa-install-dismissed') { dismissed++; byDevice[dev].dismissed++; }\n    });\n    const total = accepted + dismissed;\n    const rate = total > 0 ? accepted / total : 0;\n    const deviceRows = Object.entries(byDevice).map(([d, v]) => ({ device: d, accepted: v.accepted, dismissed: v.dismissed, rate: (v.accepted + v.dismissed) > 0 ? v.accepted / (v.accepted + v.dismissed) : 0 }));\n    return { accepted, dismissed, total, rate, deviceRows };\n  }, []);\n\n  const installsByDay = useMemo(() => {\n    const events = metricsManager.getEvents();\n    const featureEvents = events.filter(e => e.eventType === 'feature-used' && String(e.data?.feature) === 'pwa-installed');\n    const byDay: Record<string, number> = {};\n    featureEvents.forEach(ev => {\n      const day = ev.timestamp.toISOString().split('T')[0];\n      byDay[day] = (byDay[day] || 0) + 1;\n    });\n    const last7Days = Array.from({ length: 7 }, (_, i) => {\n      const d = new Date();\n      d.setDate(d.getDate() - (6 - i));\n      return d.toISOString().split('T')[0];\n    });\n    const series = last7Days.map(day => ({ day, count: byDay[day] || 0 }));\n    return series;\n  }, []);\n\n  const monetizationFunnel = useMemo(() => {\n    const events = metricsManager.getEvents();\n    const featureEvents = events.filter(e => e.eventType === 'feature-used');\n    const shopOpens = featureEvents.filter(e => e.data?.feature === 'shop-open').length;\n    const premiumOpens = featureEvents.filter(e => e.data?.feature === 'premium-center-open').length;\n    const premiumBannerClicks = featureEvents.filter(e => e.data?.feature === 'shop-premium-banner-click').length;\n    const purchaseInitiated = events.filter(e => e.eventType === 'purchase-initiated').length;\n    const purchaseCompleted = events.filter(e => e.eventType === 'purchase-completed').length;\n    const rateBanner = shopOpens > 0 ? premiumBannerClicks / shopOpens : 0;\n    const rateCheckout = premiumBannerClicks > 0 ? purchaseInitiated / premiumBannerClicks : 0;\n    const ratePurchase = purchaseInitiated > 0 ? purchaseCompleted / purchaseInitiated : 0;\n    const adImpressions = events.filter(e => e.eventType === 'ad-impression').length;\n    const adClicks = events.filter(e => e.eventType === 'ad-click').length;\n    const adCtr = adImpressions > 0 ? adClicks / adImpressions : 0;\n    const purchases = events.filter(e => e.eventType === 'purchase-completed');\n    const PRODUCT_PRICES: Record<string, number> = { 'remove-ads': 4.99, 'season-pass': 9.99 };\n    const revenue = purchases.reduce((sum, p) => {\n      const id = String(p.data?.productId || '');\n      if (id && PRODUCT_PRICES[id] !== undefined) return sum + PRODUCT_PRICES[id];\n      if (id.startsWith('frame-')) return sum + 1.99;\n      if (id.startsWith('theme-')) return sum + 2.99;\n      return sum;\n    }, 0);\n    const uniqueBuyers = new Set(purchases.map(p => p.userId).filter(Boolean)).size;\n    const arppu = uniqueBuyers > 0 ? revenue / uniqueBuyers : 0;\n    return { shopOpens, premiumOpens, premiumBannerClicks, purchaseInitiated, purchaseCompleted, rateBanner, rateCheckout, ratePurchase, adImpressions, adClicks, adCtr, revenue, arppu };\n  }, []);\n  const customizationLocal = useMemo(() => {\n    const events = metricsManager.getEvents();\n    const featureEvents = events.filter(e => e.eventType === 'feature-used');\n    const themeSwitches = featureEvents.filter(e => e.data?.feature === 'theme-switch').length;\n    const frameSwitches = featureEvents.filter(e => e.data?.feature === 'frame-switch').length;\n    return { themeSwitches, frameSwitches };\n  }, []);\n  const [dailyRemote, setDailyRemote] = useState<Array<{ day: string; installs: number; purchases: number; sessions: number; dau: number }>>([]);\n  const [summaryRemote, setSummaryRemote] = useState<{ installs: number; purchases: number; revenue: number } | null>(null);\n  useEffect(() => {\n    const abort = new AbortController();\n    (async () => {\n      try {\n        const res = await fetch('/api/metrics/daily', { signal: abort.signal });\n        const json = await res.json();\n        if (res.ok && Array.isArray(json?.days)) setDailyRemote(json.days);\n      } catch {}\n      try {\n        const res = await fetch('/api/metrics/summary', { signal: abort.signal });\n        const json = await res.json();\n        if (res.ok && json) setSummaryRemote(json);\n      } catch {}\n    })();\n    return () => { try { abort.abort(); } catch {} };\n  }, []);\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-3xl font-bold text-gray-800\"> Mtricas e KPIs</h1>\n      </div>\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Viso Geral</div>\n          <div className=\"text-sm text-gray-700\">Usurios totais: {kpi.overview.totalUsers}</div>\n          <div className=\"text-sm text-gray-700\">Usurios ativos: {kpi.overview.activeUsers}</div>\n          <div className=\"text-sm text-gray-700\">Sesses: {kpi.overview.totalSessions}</div>\n          <div className=\"text-sm text-gray-700\">Durao mdia: {Math.round(kpi.overview.averageSessionDuration)}s</div>\n        </div>\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Engajamento</div>\n          <div className=\"text-sm text-gray-700\">DAU: {eng.dailyActiveUsers}</div>\n          <div className=\"text-sm text-gray-700\">WAU: {eng.weeklyActiveUsers}</div>\n          <div className=\"text-sm text-gray-700\">MAU: {eng.monthlyActiveUsers}</div>\n          <div className=\"text-sm text-gray-700\">Aes por sesso: {eng.averageActionsPerSession.toFixed(1)}</div>\n        </div>\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Performance</div>\n          <div className=\"text-sm text-gray-700\">Load: {Math.round(perf.pageLoadTime)}ms</div>\n          <div className=\"text-sm text-gray-700\">Render: {Math.round(perf.componentRenderTime)}ms</div>\n          <div className=\"text-sm text-gray-700\">API: {Math.round(perf.apiResponseTime)}ms</div>\n          <div className=\"text-sm text-gray-700\">Erros: {(perf.errorRate*100).toFixed(2)}%</div>\n          <div className=\"text-sm text-gray-700\">Memria: {Math.round(perf.memoryUsage)}MB</div>\n        </div>\n      </div>\n      <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Gameplay</div>\n          <div className=\"text-sm text-gray-700\">Heris: {gp.totalHeroes}</div>\n          <div className=\"text-sm text-gray-700\">Misses: {gp.totalQuestsCompleted}</div>\n          <div className=\"text-sm text-gray-700\">XP Total: {gp.totalXpGained}</div>\n          <div className=\"text-sm text-gray-700\">Ouro Total: {gp.totalGoldEarned}</div>\n          <div className=\"text-sm text-gray-700\">Classe popular: {gp.mostPopularClass}</div>\n          <div className=\"text-sm text-gray-700\">Misso mais completada: {gp.mostCompletedQuest}</div>\n        </div>\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Tendncias</div>\n          <div className=\"text-sm text-gray-700\">Reteno 7 dias: {(gp.conversionFunnels.retention7Days*100).toFixed(1)}%</div>\n          <div className=\"text-xs text-gray-600 mt-2\">Usurios por dia (ltimos 7): {kpi.trends.userGrowth.slice(-7).map(t=>t.count).join(', ')}</div>\n          <div className=\"text-xs text-gray-600 mt-1\">Sesses por dia (ltimos 7): {kpi.trends.engagementTrend.slice(-7).map(t=>t.sessions).join(', ')}</div>\n        </div>\n      </div>\n      <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Instalao PWA</div>\n          <div className=\"text-sm text-gray-700\">Total: {install.total}</div>\n          <div className=\"text-sm text-gray-700\">Aceitas: {install.accepted}</div>\n          <div className=\"text-sm text-gray-700\">Recusas: {install.dismissed}</div>\n          <div className=\"text-sm text-gray-700\">Taxa de aceitao: {(install.rate*100).toFixed(1)}%</div>\n        </div>\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Converso por dispositivo</div>\n          {install.deviceRows.length === 0 ? (\n            <div className=\"text-sm text-gray-700\">Sem dados</div>\n          ) : (\n            <ul className=\"text-sm text-gray-700 space-y-1\">\n              {install.deviceRows.map(row => (\n                <li key={row.device}>\n                  <span className=\"font-medium\">{row.device}</span>: {row.accepted}/{row.accepted + row.dismissed} ({(row.rate*100).toFixed(1)}%)\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </div>\n      <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Instalaes por dia (7d)</div>\n          <div className=\"text-xs text-gray-700\">{installsByDay.map(s => `${s.day.split('-').slice(1).join('/')}:${s.count}`).join(' | ')}</div>\n        </div>\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Funil de Monetizao</div>\n          <div className=\"text-sm text-gray-700\">Aberturas Loja: {monetizationFunnel.shopOpens}</div>\n          <div className=\"text-sm text-gray-700\">Aberturas Premium: {monetizationFunnel.premiumOpens}</div>\n          <div className=\"text-sm text-gray-700\">Cliques em Banner Premium: {monetizationFunnel.premiumBannerClicks} ({(monetizationFunnel.rateBanner*100).toFixed(1)}%)</div>\n          <div className=\"text-sm text-gray-700\">Checkouts iniciados: {monetizationFunnel.purchaseInitiated} ({(monetizationFunnel.rateCheckout*100).toFixed(1)}%)</div>\n          <div className=\"text-sm text-gray-700\">Compras concludas: {monetizationFunnel.purchaseCompleted} ({(monetizationFunnel.ratePurchase*100).toFixed(1)}%)</div>\n          <div className=\"text-sm text-gray-700\">Impresses de anncio: {monetizationFunnel.adImpressions}</div>\n          <div className=\"text-sm text-gray-700\">Cliques em anncio: {monetizationFunnel.adClicks} (CTR {(monetizationFunnel.adCtr*100).toFixed(2)}%)</div>\n          <div className=\"text-sm text-gray-800 mt-2\">Receita estimada: US${monetizationFunnel.revenue.toFixed(2)}</div>\n          <div className=\"text-sm text-gray-800\">ARPPU: US${monetizationFunnel.arppu.toFixed(2)}</div>\n        </div>\n      </div>\n      <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Personalizao (local)</div>\n          <div className=\"text-sm text-gray-700\">Trocas de tema: {customizationLocal.themeSwitches}</div>\n          <div className=\"text-sm text-gray-700\">Trocas de frame: {customizationLocal.frameSwitches}</div>\n        </div>\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Personalizao por dia (remoto)</div>\n          {dailyRemote.length === 0 ? (\n            <div className=\"text-sm text-gray-700\">Sem dados</div>\n          ) : (\n            <div className=\"text-xs text-gray-700\">{dailyRemote.slice(-7).map(d => `${d.day.split('-').slice(1).join('/')}: Tema ${Number((d as any).themeSwitches||0)}, Frame ${Number((d as any).frameSwitches||0)}`).join(' | ')}</div>\n          )}\n        </div>\n      </div>\n      <div className=\"mt-6 grid grid-cols-1\">\n        <div className=\"bg-white p-4 rounded border\">\n          <div className=\"text-lg font-semibold text-gray-800 mb-2\">Mtricas agregadas (remoto)</div>\n          {dailyRemote.length === 0 ? (\n            <div className=\"text-sm text-gray-700\">Sem dados remotos</div>\n          ) : (\n            <div className=\"text-xs text-gray-700\">{dailyRemote.slice(-7).map(d => `${d.day.split('-').slice(1).join('/')}: Inst ${d.installs}, Comp ${d.purchases}, Sess ${d.sessions}, DAU ${d.dau}`).join(' | ')}</div>\n          )}\n          {summaryRemote && (\n            <div className=\"text-sm text-gray-800 mt-2\">Total instalaes: {summaryRemote.installs}  Compras: {summaryRemote.purchases}  Receita estimada: US${summaryRemote.revenue.toFixed(2)}</div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MetricsDashboard;","import React from 'react'\nimport { Link, Outlet, useLocation } from 'react-router-dom'\n\nconst StableHub: React.FC = () => {\n  const location = useLocation()\n  const isActive = (path: string) => location.pathname === path\n\n  const tabClass = (path: string) => (\n    isActive(path)\n      ? 'px-3 py-1 rounded bg-amber-700 text-white font-semibold shadow'\n      : 'px-3 py-1 rounded hover:bg-amber-800/40 text-amber-200 transition-colors'\n  )\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <div className=\"mb-4 flex items-center justify-between\">\n        <h1 className=\"text-2xl md:text-3xl font-serif text-amber-300\"> Estbulo</h1>\n      </div>\n      <div className=\"mb-6 bg-slate-800 border border-slate-600 rounded p-2\">\n        <div className=\"flex gap-2\">\n          <Link to=\"/stable/pets\" className={tabClass('/stable/pets')}> Mascotes</Link>\n          <Link to=\"/stable/mounts\" className={tabClass('/stable/mounts')}> Montarias</Link>\n        </div>\n      </div>\n      <Outlet />\n    </div>\n  )\n}\n\nexport default StableHub","import React from 'react'\nimport { Link } from 'react-router-dom'\nimport { useHeroStore } from '../store/heroStore'\nimport { useProgressionStore } from '../store/progressionStore'\n\nexport const BlockedView: React.FC<{ feature: 'hunting_basic' | 'shop_basic' | 'crafting_simple' | 'stable_basic' }> = ({ feature }) => {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  const status = useProgressionStore(s => s.getGateStatus)(feature, hero)\n  return (\n    <div className=\"max-w-3xl mx-auto p-6 text-center\">\n      <div className=\"text-6xl mb-4\"></div>\n      <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Recurso bloqueado</h2>\n      <p className=\"text-gray-600 mb-1\">{status.reason || 'Progresso insuficiente'}</p>\n      <div className=\"text-xs text-gray-500 mb-6\">{status.nextHint}</div>\n      {status.nextHint && <p className=\"text-gray-500 mb-6\">{status.nextHint}</p>}\n      <div className=\"flex gap-3 justify-center\">\n        <Link to=\"/training\" className=\"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors\">Ir treinar</Link>\n        <Link to=\"/evolution\" className=\"bg-amber-600 text-black px-6 py-2 rounded hover:bg-amber-700 transition-colors\">Ver evoluo</Link>\n      </div>\n    </div>\n  )\n}\n\nexport const FeatureGate: React.FC<{ feature: 'hunting_basic' | 'shop_basic' | 'crafting_simple' | 'stable_basic'; children: React.ReactNode }> = ({ feature, children }) => {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  const enabled = useProgressionStore(s => s.isFeatureEnabled)(feature, hero)\n  if (!enabled) return <BlockedView feature={feature} />\n  return <>{children}</>\n}","import { Routes, Route, Link, Navigate } from 'react-router-dom'\nimport React, { Suspense } from 'react'\nimport Layout from './components/Layout'\nimport HeroList from './components/HeroList'\nimport HeroForm from './components/HeroForm'\nconst HeroDetailLazy = React.lazy(() => import('./components/HeroDetail'))\nimport HeroProgression from './components/HeroProgression'\nimport GuildSystem from './components/GuildSystem'\nimport GuildHub from './features/guild/Hub'\nimport QuestBoard from './components/QuestBoard'\nimport TitlesManager from './components/TitlesManager'\nimport Leaderboards from './components/Leaderboards'\nimport DailyGoals from './components/DailyGoals'\nimport EventsPanel from './components/EventsPanel'\nimport ActivityFeed from './components/ActivityFeed'\nimport { EvolutionPanel } from './components/EvolutionPanel'\nimport { RankCelebrationManager } from './components/RankCelebration'\nconst DynamicMissionsPanelLazy = React.lazy(() => import('./components/DynamicMissionsPanel'))\nconst AIRecommendationsPanelLazy = React.lazy(() => import('./components/AIRecommendationsPanel'))\nimport Shop from './components/Shop'\nimport Training from './components/Training'\nimport { WorldStateDemo } from './components/WorldStateDemo'\nconst MissionsHubLazy = React.lazy(() => import('./components/MissionsHub'))\nimport Dungeon20 from './components/Dungeon20'\nimport HuntingMissions from './components/HuntingMissions'\nimport Inventory from './components/Inventory'\nimport PetsPanel from './components/PetsPanel'\nimport ErrorBoundary from './components/ErrorBoundary'\nimport MountsPanel from './components/MountsPanel'\nimport { useEffect } from 'react'\nimport { startPlaytimeHeartbeat, stopPlaytimeHeartbeat } from './services/progressService'\nimport { useHeroStore } from './store/heroStore'\nimport { formatTitleDisplay } from './utils/titles'\nimport { HeroJournal } from './components/HeroJournal'\nimport QuickMission from './components/QuickMission'\nimport JourneyFlow from './components/JourneyFlow'\n// (removido import duplicado de MissionsHub)\nconst AdminDashboardLazy = React.lazy(() => import('./components/AdminDashboard'))\nimport IntroCinematic from './components/IntroCinematic'\nimport Tavern from './components/Tavern'\nimport HeroForge from './components/HeroForge'\nimport PremiumCenter from './components/PremiumCenterSimple'\nimport SocialEventsPage from './components/SocialEventsPage'\nimport EventDetailPage from './components/EventDetailPage'\nimport OrganizerDashboard from './components/OrganizerDashboard'\nimport FriendsPage from './components/FriendsPage'\nimport SocialNotificationsPage from './components/SocialNotificationsPage'\nimport UserEventsHistoryPage from './components/UserEventsHistoryPage'\nimport PartyInvitesPanel from './components/PartyInvitesPanel'\nimport MetricsDashboard from './components/MetricsDashboard'\nimport StableHub from './components/StableHub'\nimport { rankSystem } from './utils/rankSystem'\nimport { FeatureGate } from './components/FeatureGate'\nimport { useProgressionStore } from './store/progressionStore'\n\n// Componente wrapper para HeroProgression que precisa do heri selecionado\nfunction HeroProgressionWrapper() {\n  const { getSelectedHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  \n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para ver sua progresso.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  \n  return <HeroProgression hero={selectedHero} />;\n}\n\n// Componente wrapper para GuildSystem que precisa do heri selecionado\nfunction GuildSystemWrapper() {\n  const { getSelectedHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  \n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar o sistema de party.</p>\n        <Link to=\"/\" className=\"bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  \n  return <GuildSystem hero={selectedHero} />;\n}\n\n\n// Componente wrapper para DailyGoals que precisa do heri selecionado\nfunction DailyGoalsWrapper() {\n  const { getSelectedHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  \n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para ver suas metas dirias.</p>\n        <Link to=\"/\" className=\"bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  \n  return <DailyGoals heroId={selectedHero.id} />;\n}\n\n// Componente wrapper para EvolutionPanel que precisa do heri selecionado\nfunction EvolutionPanelWrapper() {\n  const { getSelectedHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  \n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para ver sua evoluo de ranks.</p>\n        <Link to=\"/\" className=\"bg-amber-600 text-white px-6 py-2 rounded hover:bg-amber-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  \n  return <EvolutionPanel heroId={selectedHero.id} className=\"max-w-6xl mx-auto\" />;\n}\n\n\n// Componente wrapper para DynamicMissionsPanel que precisa do heri selecionado\nfunction DynamicMissionsPanelWrapper() {\n  const { getSelectedHero, refreshQuests, availableQuests, acceptQuest } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  \n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para ver misses dinmicas.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  \n  const handleMissionAccept = (_mission: import('./services/dynamicMissionsAI').DynamicMission) => {\n    // Ao aceitar uma misso de IA, refletir no sistema de misses padro\n    refreshQuests(selectedHero.progression.level);\n    const quest = availableQuests.find(q => selectedHero.progression.level >= q.levelRequirement && !selectedHero.activeQuests.includes(q.id));\n    if (quest) {\n      acceptQuest(selectedHero.id, quest.id);\n      console.log(' Misso IA aceita, vinculada a misso:', quest.title);\n    } else {\n      console.log(' Nenhuma misso disponvel para vincular');\n    }\n  };\n\n  return <Suspense fallback={<div className=\"p-6\">Carregando...</div>}><DynamicMissionsPanelLazy hero={selectedHero} className=\"max-w-6xl mx-auto\" onMissionAccept={handleMissionAccept} /></Suspense>;\n}\n\n// Componente wrapper para AIRecommendationsPanel que precisa do heri selecionado\nfunction AIRecommendationsPanelWrapper() {\n  const { getSelectedHero, refreshQuests, availableQuests, acceptQuest, gainXP } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  \n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para ver recomendaes de IA.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  \n  const handleApply = (rec: import('./services/recommendationAI').Recommendation) => {\n    // Aes bsicas ao aplicar recomendao\n    if (rec.type === 'quest') {\n      // Garantir lista atualizada e aceitar a primeira misso elegvel\n      refreshQuests(selectedHero.progression.level);\n      const quest = availableQuests.find(q => selectedHero.progression.level >= q.levelRequirement && !selectedHero.activeQuests.includes(q.id));\n      if (quest) {\n        acceptQuest(selectedHero.id, quest.id);\n        console.log(' Recomendao aplicada: misso aceita', quest.title);\n      } else {\n        console.log(' Nenhuma misso elegvel para aceitar no momento');\n      }\n    } else if (rec.type === 'training' || rec.type === 'progression') {\n      // Pequeno bnus para refletir ao aplicada\n      gainXP(selectedHero.id, 25);\n      console.log(' Recomendao aplicada: bnus de XP');\n    } else {\n      console.log(' Recomendao aplicada:', rec.type);\n    }\n  };\n\n  return (\n    <Suspense fallback={<div className=\"p-6\">Carregando...</div>}>\n      <AIRecommendationsPanelLazy \n        hero={selectedHero} \n        className=\"max-w-6xl mx-auto\" \n        onRecommendationApply={handleApply}\n      />\n    </Suspense>\n  );\n}\n\n// Componente wrapper para EnhancedQuestBoard que precisa do heri selecionado\n\n// Componente wrapper para HeroJournal que precisa do heri selecionado\nfunction HeroJournalWrapper() {\n  const { getSelectedHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  \n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para ver seu dirio de aventuras.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  \n  return <HeroJournal hero={selectedHero} />;\n}\n\n// Wrapper para QuickMission que precisa do heri selecionado\nfunction QuickMissionWrapper() {\n  const { getSelectedHero } = useHeroStore();\n  const selectedHero = getSelectedHero();\n  if (!selectedHero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para jogar uma misso rpida.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">\n          Voltar  Lista de Heris\n        </Link>\n      </div>\n    );\n  }\n  return <QuickMission />;\n}\n\nfunction HuntingGateWrapper() {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar misses de caa.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">Voltar  Lista de Heris</Link>\n      </div>\n    )\n  }\n  return <FeatureGate feature=\"hunting_basic\"><HuntingMissions /></FeatureGate>\n}\n\nfunction QuestBoardGateWrapper() {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar misses.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">Voltar  Lista de Heris</Link>\n      </div>\n    )\n  }\n  return <FeatureGate feature=\"hunting_basic\"><QuestBoard /></FeatureGate>\n}\n\nfunction ShopGateWrapper() {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar a loja.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">Voltar  Lista de Heris</Link>\n      </div>\n    )\n  }\n  return <FeatureGate feature=\"shop_basic\"><Shop /></FeatureGate>\n}\n\nfunction ForgeGateWrapper() {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar a forja.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">Voltar  Lista de Heris</Link>\n      </div>\n    )\n  }\n  return <FeatureGate feature=\"crafting_simple\"><HeroForge /></FeatureGate>\n}\n\nfunction DungeonGateWrapper() {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar a dungeon.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">Voltar  Lista de Heris</Link>\n      </div>\n    )\n  }\n  const curRank = hero.rankData?.currentRank || rankSystem.calculateRank(hero)\n  const allowedRanks = ['C','B','A','S','SS','SSS']\n  if (!allowedRanks.includes(curRank)) {\n    return (\n      <div className=\"max-w-3xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Dungeon bloqueada</h2>\n        <p className=\"text-gray-600\">Requer rank C. Rank atual: {curRank}.</p>\n        <div className=\"flex gap-3 justify-center mt-4\">\n          <Link to=\"/training\" className=\"bg-green-600 text-white px-6 py-2 rounded\">Ir treinar</Link>\n          <Link to=\"/quests\" className=\"bg-amber-600 text-black px-6 py-2 rounded\">Fazer misses</Link>\n          <Link to=\"/evolution\" className=\"bg-indigo-600 text-white px-6 py-2 rounded\">Ver evoluo</Link>\n        </div>\n      </div>\n    )\n  }\n  return <Dungeon20 />\n}\n\nfunction InventoryGateWrapper() {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar o inventrio.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">Voltar  Lista de Heris</Link>\n      </div>\n    )\n  }\n  const basicOnly = useProgressionStore(s => s.basicTrainingOnly)\n  if (basicOnly) return <FeatureGate feature=\"hunting_basic\"><Inventory /></FeatureGate>\n  return <Inventory />\n}\n\nfunction StableGateWrapper() {\n  const { getSelectedHero } = useHeroStore()\n  const hero = getSelectedHero()\n  if (!hero) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6 text-center\">\n        <div className=\"text-6xl mb-4\"></div>\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Nenhum heri selecionado</h2>\n        <p className=\"text-gray-600 mb-6\">Selecione um heri para acessar o Estbulo.</p>\n        <Link to=\"/\" className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors\">Voltar  Lista de Heris</Link>\n      </div>\n    )\n  }\n  return <FeatureGate feature=\"stable_basic\"><StableHub /></FeatureGate>\n}\n\nfunction App() {\n  const heroes = useHeroStore(s => s.heroes);\n  const markCelebrationViewed = useHeroStore(s => s.markCelebrationViewed);\n  const selectedHeroId = useHeroStore(s => s.selectedHeroId);\n  const selectedHero = heroes.find(h => h.id === selectedHeroId);\n  \n  // Configurao de segurana bsica\n  useEffect(() => {\n    // Executar segurana apenas em produo para no interferir no preview/local\n    if (!import.meta.env.DEV) {\n      // Prevenir clickjacking: se estiver em iframe, tentar subir para o topo\n      try {\n        const topWin = window.top;\n        if (topWin && window.self !== topWin) {\n          topWin.location.href = window.self.location.href;\n        }\n      } catch {\n        // Ignorar erros de mesma origem ou restries\n      }\n\n      // Configurar Content Security Policy via meta tag\n      const cspMeta = document.createElement('meta');\n      cspMeta.httpEquiv = 'Content-Security-Policy';\n      const sbUrl = import.meta.env.VITE_SUPABASE_URL as string | undefined;\n      let sbOrigin = '';\n      try { sbOrigin = sbUrl ? new URL(sbUrl).origin : ''; } catch {}\n      const connectSrc = [\n        \"'self'\",\n        sbOrigin,\n        'https://vercel.live',\n        'wss://vercel.live',\n        'https://*.vercel.live',\n        'wss://*.vercel.live'\n      ].filter(Boolean).join(' ');\n      const adsOrigins = [\n        'https://pagead2.googlesyndication.com',\n        'https://tpc.googlesyndication.com',\n        'https://googleads.g.doubleclick.net',\n        'https://ep1.adtrafficquality.google',\n        'https://ep2.adtrafficquality.google'\n      ];\n      const fontOrigins = [\n        'https://fonts.gstatic.com',\n        'https://vercel.live',\n        'https://*.vercel.live'\n      ];\n      cspMeta.content = [\n        \"default-src 'self'\",\n        `frame-src 'self' https://vercel.live https://*.vercel.live https://accounts.google.com https://www.google.com ${adsOrigins.join(' ')}`,\n        `connect-src ${connectSrc} ${adsOrigins.join(' ')}`,\n        \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://accounts.google.com\",\n        `font-src 'self' ${fontOrigins.join(' ')} data:`,\n        `script-src 'self' ${adsOrigins.join(' ')} https://vercel.live https://*.vercel.live`,\n        \"img-src 'self' data: blob: https:\"\n      ].join('; ') + ';';\n      document.head.appendChild(cspMeta);\n    }\n  }, []);\n\n  useEffect(() => {\n    try {\n      if (selectedHero) {\n        document.title = formatTitleDisplay(selectedHero);\n      } else {\n        document.title = 'HeroForgeNew';\n      }\n    } catch {}\n  }, [selectedHero?.id, selectedHero?.activeTitle, selectedHero?.name]);\n\n  useEffect(() => {\n    try {\n      startPlaytimeHeartbeat(1);\n      let localTimer: any = null;\n      const getSelectedHero = useHeroStore.getState().getSelectedHero;\n      const updateHero = useHeroStore.getState().updateHero;\n      const startLocal = () => {\n        if (localTimer) { try { clearInterval(localTimer) } catch {} localTimer = null }\n        localTimer = setInterval(() => {\n          const h = getSelectedHero();\n          if (!h) return;\n          const stats = { ...(h.stats || {}) } as any;\n          const total = Math.max(0, (stats.totalPlayTime || 0)) + 1;\n          stats.totalPlayTime = total;\n          stats.lastActiveAt = new Date().toISOString();\n          updateHero(h.id, { stats });\n        }, 60000);\n      };\n      const stopLocal = () => { if (localTimer) { try { clearInterval(localTimer) } catch {} localTimer = null } };\n      startLocal();\n      const onVis = () => {\n        if (document.hidden) {\n          stopPlaytimeHeartbeat();\n          stopLocal();\n        } else {\n          startPlaytimeHeartbeat(1);\n          startLocal();\n        }\n      };\n      document.addEventListener('visibilitychange', onVis);\n      return () => {\n        document.removeEventListener('visibilitychange', onVis);\n        stopPlaytimeHeartbeat();\n        stopLocal();\n      };\n    } catch {}\n  }, []);\n\n  // Coletar todas as celebraes pendentes\n  const allCelebrations = heroes.flatMap(hero => \n    (hero.rankData?.pendingCelebrations || []).map((celebration, index) => ({\n      ...celebration,\n      heroId: hero.id,\n      celebrationIndex: index\n    }))\n  );\n\n  const handleCelebrationViewed = (celebrationIndex: number) => {\n    const celebration = allCelebrations[celebrationIndex];\n    if (celebration) {\n      markCelebrationViewed(celebration.heroId, celebration.celebrationIndex);\n    }\n  };\n\n  return (\n    <>\n      {/* OnboardingDetector removido temporariamente */}\n      \n      {/* Gerenciador de Celebraes de Rank */}\n      {allCelebrations.length > 0 && (\n        <RankCelebrationManager\n          celebrations={allCelebrations}\n          onCelebrationViewed={handleCelebrationViewed}\n        />\n      )}\n      \n      <Routes>\n        <Route path=\"/\" element={<Layout />}>\n          <Route index element={<JourneyFlow />} />\n          <Route path=\"journey\" element={<JourneyFlow />} />\n          <Route path=\"intro\" element={<IntroCinematic />} />\n          <Route path=\"create\" element={<HeroForm />} />\n          <Route path=\"heroes/new\" element={<HeroForm />} />\n          <Route path=\"gallery\" element={<HeroList />} />\n          <Route path=\"hero/:id\" element={<Suspense fallback={<div className=\"p-6\">Carregando heri</div>}><HeroDetailLazy /></Suspense>} />\n          <Route path=\"progression\" element={<HeroProgressionWrapper />} />\n          <Route path=\"evolution\" element={<EvolutionPanelWrapper />} />\n          {/* GuildSystem disponvel em rota separada caso necessrio */}\n        <Route path=\"guild\" element={<GuildSystemWrapper />} />\n          {/* Hub da Guilda dos Aventureiros */}\n          <Route path=\"guild-hub\" element={<GuildHub />} />\n          <Route path=\"missions\" element={<Suspense fallback={<div className=\"p-6\">Carregando...</div>}><MissionsHubLazy /></Suspense>} />\n          <Route path=\"dungeon-20\" element={<DungeonGateWrapper />} />\n          <Route path=\"dungeon-infinita\" element={<DungeonGateWrapper />} />\n          <Route path=\"hunting\" element={<HuntingGateWrapper />} />\n          {/* Quadro de Misses (disponveis, ativas e concludas) */}\n          <Route path=\"quests\" element={<QuestBoardGateWrapper />} />\n          <Route path=\"daily-goals\" element={<DailyGoalsWrapper />} />\n          <Route path=\"events\" element={<EventsPanel />} />\n          <Route path=\"social-events\" element={<SocialEventsPage />} />\n          <Route path=\"party-invites\" element={<PartyInvitesPanel />} />\n          <Route path=\"event/:id\" element={<EventDetailPage />} />\n          <Route path=\"organizer\" element={<OrganizerDashboard />} />\n          <Route path=\"friends\" element={<FriendsPage />} />\n          <Route path=\"notifications\" element={<SocialNotificationsPage />} />\n          <Route path=\"events-history\" element={<UserEventsHistoryPage />} />\n          <Route path=\"metrics\" element={<MetricsDashboard />} />\n          <Route path=\"activities\" element={<ActivityFeed />} />\n          {/* Rota de tutorial removida temporariamente */}\n          <Route path=\"titles\" element={<TitlesManager />} />\n          <Route path=\"leaderboards\" element={<Leaderboards />} />\n          \n          <Route path=\"ai-missions\" element={<DynamicMissionsPanelWrapper />} />\n          <Route path=\"ai-recommendations\" element={<AIRecommendationsPanelWrapper />} />\n          {/* Taverna (single-player) */}\n          <Route path=\"tavern\" element={<Tavern />} />\n          {/* Rotas de misses narrativas removidas */}\n          <Route path=\"hero-journal\" element={<HeroJournalWrapper />} />\n          <Route path=\"quick-mission\" element={<QuickMissionWrapper />} />\n          <Route path=\"admin\" element={<Suspense fallback={<div className=\"p-6\">Carregando...</div>}><AdminDashboardLazy /></Suspense>} />\n          <Route path=\"shop\" element={<ShopGateWrapper />} />\n          <Route path=\"premium-center\" element={<PremiumCenter />} />\n          <Route path=\"premium\" element={<PremiumCenter />} />\n          {/* Estbulo com sub-rotas para Mascotes e Montarias */}\n          <Route path=\"stable\" element={<StableGateWrapper />}>\n            <Route index element={<Navigate to=\"/stable/pets\" replace />} />\n            <Route path=\"pets\" element={<ErrorBoundary fallback={<div className=\"p-6 rounded bg-red-900/40 border border-red-700 text-red-200\">Falha ao carregar Mascotes</div>}><PetsPanel /></ErrorBoundary>} />\n            <Route path=\"mounts\" element={<MountsPanel />} />\n          </Route>\n          {/* Arena de Duelos removida para modo single-player */}\n          <Route path=\"inventory\" element={<InventoryGateWrapper />} />\n          <Route path=\"hero-forge\" element={<ForgeGateWrapper />} />\n          <Route path=\"training\" element={<Training />} />\n          {/* Redirecionar rotas antigas para novo hub */}\n          <Route path=\"pets\" element={<Navigate to=\"/stable/pets\" replace />} />\n          <Route path=\"mounts\" element={<Navigate to=\"/stable/mounts\" replace />} />\n          <Route path=\"world-state-demo\" element={<WorldStateDemo />} />\n        </Route>\n      </Routes>\n    </>\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter } from 'react-router-dom'\nimport App from './App.tsx'\nimport './index.css'\nimport { getGameSettings } from './store/gameSettingsStore.ts'\n\n// Configurao dinmica do basename para diferentes ambientes\nconst getBasename = () => {\n  // Detectar se estamos no GitHub Pages\n  if (window.location.hostname === 'dilmax12.github.io') {\n    return '/HeroForgeNew'\n  }\n  // Para Vercel e outros ambientes (incluindo localhost)\n  return '/'\n}\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <BrowserRouter\n      basename={getBasename()}\n      future={{ v7_startTransition: true, v7_relativeSplatPath: true }}\n    >\n      <App />\n    </BrowserRouter>\n  </React.StrictMode>,\n)\n\nconst initAnalytics = () => {\n  const id = import.meta.env.VITE_GA_MEASUREMENT_ID\n  if (!id) return\n  const script = document.createElement('script')\n  script.async = true\n  script.src = `https://www.googletagmanager.com/gtag/js?id=${id}`\n  document.head.appendChild(script)\n  const inline = document.createElement('script')\n  inline.innerHTML = `window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js', new Date());gtag('config','${id}');`\n  document.head.appendChild(inline)\n}\n\nif (import.meta.env.PROD) {\n  initAnalytics()\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', () => {\n      navigator.serviceWorker.register('/sw.js').catch(() => {})\n    })\n  }\n}\n\n// Flags de desempenho baseadas no dispositivo/rede\ntry {\n  const store = getGameSettings()\n  const reduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches\n  const conn = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection\n  const saveData = !!(conn && conn.saveData)\n  const effectiveType = conn && conn.effectiveType ? String(conn.effectiveType) : 'unknown'\n  store.updateSettings({ reducedMotionEnabled: reduced, saveDataEnabled: saveData, networkEffectiveType: effectiveType })\n  store.updateSettings({ autoInteractionEnabled: true })\n  if (window.matchMedia) {\n    window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', (e: any) => {\n      try { getGameSettings().updateSettings({ reducedMotionEnabled: !!e.matches }) } catch {}\n    })\n  }\n  if (conn && typeof conn.addEventListener === 'function') {\n    conn.addEventListener('change', () => {\n      try {\n        const c = (navigator as any).connection\n        getGameSettings().updateSettings({ saveDataEnabled: !!(c && c.saveData), networkEffectiveType: c && c.effectiveType ? String(c.effectiveType) : 'unknown' })\n      } catch {}\n    })\n  }\n} catch {}\n"],"file":"assets/index-324810f8.js"}