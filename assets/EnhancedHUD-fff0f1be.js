import{j as s}from"./motion-3c015c26.js";import{r as l,b as Q}from"./vendor-374d307f.js";import{L as ge}from"./router-6c8d423a.js";import{t as be,f as Y,b as ve,L as ye,v as Z,x as je,u as w,y as C,s as we,z as he,A as Ne,w as Me,C as Se}from"./index-324810f8.js";import"./supabase-4349ac75.js";import"./icons-5fe8db7b.js";async function Ae(){try{localStorage.removeItem("replay_weekly_mutator")}catch{}return null}async function ke(){try{localStorage.removeItem("replay_global_events")}catch{}return[]}async function Ie(){var g;if(!be)return[];const{data:t}=await Y.auth.getUser(),p=(g=t==null?void 0:t.user)==null?void 0:g.id;if(!p)return[];const{data:T,error:A}=await Y.from("player_relics").select("relic_id, relics(name,effect)").eq("user_id",p);if(A)return[];const f=(T||[]).map(h=>{var N,b;return{id:h.relic_id,name:(N=h.relics)==null?void 0:N.name,effect:(b=h.relics)==null?void 0:b.effect}});try{localStorage.setItem("replay_player_relics",JSON.stringify(f))}catch{}return f}const He=({hero:t})=>{var U,z,G,J,W,K;const{activeSeasonalTheme:p}=ve(),[T,A]=l.useState(null),[f,g]=l.useState(!1),[h,N]=l.useState([]),[b,ee]=l.useState(null),m=l.useRef(null),M=t.progression.level>=ye,k=Z(t.progression.level),te=M?k:Z(t.progression.level+1),se=t.progression.xp-k,L=Math.max(0,se),B=Math.max(1,te-k),I=M?100:Math.max(0,Math.min(100,L/B*100)),P=t.derivedAttributes.hp||0,u=t.derivedAttributes.currentHp??P,_=Math.max(0,Math.min(100,u/P*100)),E=t.derivedAttributes.mp||0,x=t.derivedAttributes.currentMp??E,D=Math.max(0,Math.min(100,x/E*100)),[Pe,ne]=l.useState(null),[H,R]=l.useState(null),[Ee,F]=l.useState(0),[Re,V]=l.useState(0),ae=e=>e>=80?"bg-blue-500":e>=50?"bg-blue-400":"bg-blue-300",ie=e=>e>=70?"bg-red-500":e>=30?"bg-red-400":"bg-red-300",re=e=>e>=70?"bg-indigo-500":e>=30?"bg-indigo-400":"bg-indigo-300";l.useEffect(()=>{let e=!0;return(async()=>{try{const n=await je(t);e&&A(n)}catch{}try{const n=await Ae();e&&ee((n==null?void 0:n.name)||null),await ke(),await Ie()}catch{}})(),()=>{e=!1}},[t.id]);const O=l.useRef(u),X=l.useRef(x);l.useEffect(()=>{const e=O.current??0,n=X.current??0,a=Math.max(0,(u??0)-(e??0)),c=Math.max(0,(x??0)-(n??0));if(a>0){F(a);const r=setTimeout(()=>F(0),2e3);return()=>clearTimeout(r)}if(c>0){V(c);const r=setTimeout(()=>V(0),2e3);return()=>clearTimeout(r)}O.current=u??0,X.current=x??0},[u,x]);const q=w(e=>e.getSelectedHero),v=w(e=>e.setActiveMount),le=w(e=>e.evolveMountForSelected),ce=w(e=>e.refineCompanion),oe=w(e=>e.trainMountForSelected);Q.useEffect(()=>{const e=n=>{const a=t.favoriteMountIds||[];n.key==="1"&&a[0]&&v(a[0]),n.key==="2"&&a[1]&&v(a[1]),n.key==="3"&&a[2]&&v(a[2])};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t.favoriteMountIds]);const S=Q.useMemo(()=>{var r;const e=t.mounts||[];if(!e.length)return;if(t.favoriteMountId&&e.some(i=>i.id===t.favoriteMountId))return t.favoriteMountId;const n={comum:0,encantada:1,lendaria:2},a={comum:0,incomum:1,raro:2,epico:3,lendario:4,mistico:5},c=i=>{const o=Object.values(i.attributes||{}).reduce((d,j)=>d+(typeof j=="number"?j:0),0);return(i.speedBonus||0)*3+o+(n[i.stage]||0)*2+(a[i.rarity]||0)};return(r=e.slice().sort((i,o)=>c(o)-c(i))[0])==null?void 0:r.id},[t.mounts,t.favoriteMountId]);l.useEffect(()=>{const e=setInterval(()=>{var i,o;const n=Date.now(),a=q()??t,c=(i=a.stats)!=null&&i.lastActiveAt?new Date(a.stats.lastActiveAt).getTime():n,r=Math.max(0,6e4-(n-c)%6e4);if(ne(Math.ceil(r/1e3)),(o=a.stats)!=null&&o.trainingActiveUntil){const d=new Date(a.stats.trainingActiveUntil).getTime(),j=Math.max(0,d-n);j>0?R(Math.ceil(j/1e3)):R(null)}else R(null)},1e3);return()=>clearInterval(e)},[t.id,q]);const de=e=>{if(e===null)return"--:--";const n=Math.floor(e/60),a=e%60;return`${n}:${a.toString().padStart(2,"0")}`},me=async()=>{var n,a;if(!t||f)return;const e=(a=(n=import.meta)==null?void 0:n.env)==null?void 0:a.VITE_API_BASE;if(e){g(!0);try{const c={hero:t};if(m.current)try{m.current.abort()}catch{}m.current=new AbortController,await fetch(`${e}/daily-submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),signal:m.current.signal});const i=await(await fetch(`${e}/daily-leaderboard`,{signal:m.current.signal})).json();N(Array.isArray(i.entries)?i.entries.slice(0,3):[]),C.emit({type:"achievement",title:"Ranking Di√°rio",message:"Resultado enviado com sucesso! Confira o Top do dia.",icon:"üìÖ",duration:3500})}catch{C.emit({type:"quest",title:"Falha no envio",message:"N√£o foi poss√≠vel enviar seu resultado di√°rio.",icon:"‚ö†Ô∏è",duration:4e3})}finally{g(!1)}}};l.useEffect(()=>((async()=>{var n,a;!t||f||!((a=(n=import.meta)==null?void 0:n.env)!=null&&a.VITE_API_BASE)||await me()})(),()=>{var e;try{(e=m.current)==null||e.abort()}catch{}}),[t==null?void 0:t.id]);const $=l.useRef(t.progression.achievements.length);l.useEffect(()=>{const e=t.progression.achievements.length;e>$.current&&(t.progression.achievements.slice($.current).forEach(a=>{C.emit({type:"quest",title:"Conquista Desbloqueada",message:`${a.title}`,icon:"üèÜ",duration:3e3})}),$.current=e)},[t.progression.achievements.length]);const ue=p&&((U=we[p])==null?void 0:U.border)||"border-gray-700",xe=typeof t.derivedAttributes.power=="number"?t.derivedAttributes.power:he(t.attributes,t.class,t.progression.level,t.inventory,t.activeTitle).power,y=(t.pets||[]).find(e=>e.id===t.activePetId),pe={"Instinto Feral":8,"Pulso Arcano":10,"Aura Sagrada":9,"Sussurro Sombrio":12},fe=(y!=null&&y.exclusiveSkill?(y.energy||0)>=(pe[y.exclusiveSkill]||8):!1)?"shadow-2xl shadow-amber-500/20 border-amber-500/40":ue;return s.jsxs("div",{className:`fixed top-2 right-2 md:top-4 md:right-4 z-50 bg-gray-900/95 backdrop-blur-sm border ${fe} rounded-lg p-2 md:p-4 min-w-56 sm:min-w-64 md:min-w-80 max-w-[90vw] shadow-xl`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2 md:mb-3",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"relative",children:[t.image?s.jsx("img",{src:t.image,alt:t.name,className:"w-20 h-20 md:w-24 md:h-24 rounded-lg object-cover border border-amber-500/40 shadow-sm",loading:"lazy",decoding:"async"}):s.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg bg-gray-800 flex items_center justify-center text-2xl",children:s.jsx("span",{children:t.avatar||"üõ°Ô∏è"})}),s.jsxs("div",{className:"absolute bottom-0 left-1 inline-flex items-center gap-1 px-3 py-0 rounded-md bg-black/50 border border-amber-500/30 text-[10px] md:text-[11px]",children:[s.jsxs("span",{className:"text-white",children:["Nv. ",t.progression.level]}),s.jsxs("span",{className:"text-yellow-300",children:[Ne(((z=t==null?void 0:t.rankData)==null?void 0:z.currentRank)||"F")," ",((G=t==null?void 0:t.rankData)==null?void 0:G.currentRank)||"F"]})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("div",{className:"text-white font-semibold text-sm md:text-base leading-tight truncate max-w-[40vw]",children:t.name})}),s.jsx("div",{className:"text-gray-400 text-[10px] md:text-xs",children:t.class})]})]}),s.jsxs("div",{className:"px-2 py-1 rounded-md bg-amber-500/20 text-amber-300 border border-amber-500/30 text-[10px] md:text-xs",children:["Poder ",xe]})]}),b&&s.jsx("div",{className:"mb-2",children:s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-purple-800/40 text-purple-200 border border-purple-600/40 text-[10px] md:text-xs",children:["Mutador semanal: ",b]})}),(t.mounts||[]).find(e=>e.id===t.activeMountId)&&s.jsxs("div",{className:"mb-2 md:mb-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-amber-300 text-[11px] md:text-xs font-medium",children:"Montaria Ativa"}),s.jsxs("span",{className:"text-gray-300 text-[11px] md:text-xs",children:["Velocidade +",((J=(t.mounts||[]).find(e=>e.id===t.activeMountId))==null?void 0:J.speedBonus)||0]})]}),s.jsxs("div",{className:"w-full bg-gray-800 rounded p-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"text-white text-xs md:text-sm font-medium",children:(W=(t.mounts||[]).find(e=>e.id===t.activeMountId))==null?void 0:W.name}),s.jsx("div",{className:"text-xs",children:(()=>{const e=(t.mounts||[]).find(n=>n.id===t.activeMountId);return e?s.jsxs("span",{className:"text-amber-300",children:[e.stage,typeof e.refineLevel=="number"&&e.refineLevel>0?` ‚Ä¢ +${e.refineLevel}`:"",typeof e.mastery=="number"&&e.mastery>0?` ‚Ä¢ Maestria ${e.mastery}`:"",(()=>{const n=Math.max(0,e.mastery||0);return n>=30?" ‚Ä¢ Mestre":n>=20?" ‚Ä¢ Perito":n>=10?" ‚Ä¢ Adepto":""})()]}):null})()})]}),(()=>{const e=Me.getMountStaminaReduction(t);if(!e)return null;const n=Math.round(e*100);return s.jsxs("div",{className:"mt-1 text-[11px] text-emerald-300",children:["Redu√ß√£o de custo de fadiga por a√ß√£o: ",n,"%"]})})(),s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[s.jsx("button",{onClick:()=>v(void 0),className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-[11px]",children:"Desativar"}),S&&S!==t.activeMountId&&s.jsx("button",{onClick:()=>v(S),className:"px-2 py-1 rounded bg-indigo-600 hover:bg-indigo-700 text-white text-[11px]",children:"Ativar melhor"}),s.jsx("button",{onClick:()=>oe(),className:"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-[11px]",children:"Treinar"}),(()=>{const e=(t.mounts||[]).find(d=>d.id===t.activeMountId);if(!e)return null;const n=e.stage==="encantada",a=(t.inventory.items["pergaminho-montaria"]||0)>0,c=(t.inventory.items["essencia-bestial"]||0)>0,r=(t.progression.gold||0)>=(e.stage==="comum"?200:700),i=a&&r&&(!n||c),o=(e.refineLevel||0)>=10;return s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!i,title:i?`Consome üìú x1${n?" + üß¨ x1":""}`:"",onClick:()=>{i&&window.confirm(`Evoluir ${e.name}? Custos: üìú x1${n?" + üß¨ x1":""} e ${e.stage==="comum"?200:700} ouro.`)&&le(e.id)},className:`px-2 py-1 rounded ${i?"bg-purple-600 hover:bg-purple-700":"bg-gray-700"} text-white text-[11px]`,children:"Evoluir"}),s.jsx("button",{disabled:o||!((t.inventory.items["pedra-magica"]||0)>0||(t.inventory.items["essencia-vinculo"]||0)>0),title:o?"Refino m√°ximo atingido":"",onClick:()=>{window.confirm(`Refinar ${e.name}? Consome 1 material e pode falhar.`)&&ce(t.id,"mount",e.id)},className:`px-2 py-1 rounded ${o?"bg-gray-700":"bg-violet-600 hover:bg-violet-700"} text-white text-[11px]`,children:o?"Refino M√°x.":"Refinar"})]})})()]}),(()=>{const e=t.mountBuff;if(!(e!=null&&e.speedBonus))return null;const n=e.expiresAt?new Date(e.expiresAt).getTime():0,a=Math.max(0,n-Date.now()),c=Math.floor(a/6e4),r=Math.floor(a%6e4/1e3);return s.jsxs("div",{className:"mt-2 text-[11px] text-emerald-300",children:["Buff de velocidade +",e.speedBonus," ‚Ä¢ expira em ",String(c).padStart(2,"0"),":",String(r).padStart(2,"0")]})})(),(()=>{const e=(t.mounts||[]).find(r=>r.id===t.activeMountId),n=(t.mounts||[]).find(r=>r.id===S);if(!e||!n||e.id===n.id)return null;const a=Math.max(0,(t.derivedAttributes.initiative||0)-(e.speedBonus||0)),c=Math.max(0,a+(n.speedBonus||0));return s.jsxs("div",{className:"mt-2 text-[11px] text-amber-300",children:["Melhor op√ß√£o: ",n.name," ‚Ä¢ Velocidade +",n.speedBonus," ‚Ä¢ Iniciativa se ativar: ",c]})})()]})]}),s.jsxs("div",{className:"mb-2 md:mb-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-blue-400 text-[11px] md:text-xs font-medium",children:"Experi√™ncia"}),s.jsx("span",{className:"text-gray-300 text-[11px] md:text-xs",children:M?"MAX":`${L}/${B} XP`})]}),s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-1.5 md:h-2",children:s.jsx("div",{className:`h-1.5 md:h-2 rounded-full transition-all duration-300 ${ae(I)}`,style:{width:`${I}%`}})}),s.jsx("div",{className:"text-[11px] md:text-xs text-gray-400 mt-1",children:M?"N√≠vel M√°ximo":`${I.toFixed(1)}% para o n√≠vel ${t.progression.level+1}`})]}),typeof t.attributePoints=="number"&&t.attributePoints>0&&s.jsxs("div",{className:"mb-2 md:mb-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-amber-300 text-[11px] md:text-xs font-medium",children:"Pontos de Atributo"}),s.jsx("span",{className:"text-gray-200 text-[11px] md:text-xs",children:t.attributePoints})]}),s.jsxs("div",{className:"w-full bg-gray-700 rounded h-7 md:h-8 flex items-center justify-between px-2 md:px-3",children:[s.jsx("span",{className:"text-[11px] md:text-xs text-gray-300",children:"Voc√™ tem pontos para gastar"}),s.jsx(ge,{to:"/progression#atributos",title:"Gaste seus pontos de atributo",onClick:()=>{try{Se.featureUsed(t.id,"hud-attribute-link")}catch{}},className:"text-[11px] md:text-xs bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded animate-pulse",children:"Gastar"})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-red-400 text-xs font-medium",children:"Vida"}),s.jsxs("span",{className:"text-gray-300 text-xs",children:[u,"/",P]})]}),s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${ie(_)}`,style:{width:`${_}%`}})})]}),s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-indigo-400 text-xs font-medium",children:"Mana"}),s.jsxs("span",{className:"text-gray-300 text-xs",children:[x,"/",E]})]}),s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${re(D)}`,style:{width:`${D}%`}})})]}),H!==null&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-yellow-300 text-xs font-medium",children:"Treino"}),s.jsx("span",{className:"text-gray-300 text-[11px]",children:((K=t.stats)==null?void 0:K.trainingActiveName)||"Em andamento"})]}),s.jsxs("div",{className:"w-full bg-gray-700 rounded h-7 flex items-center justify-between px-2",children:[s.jsx("span",{className:"text-[11px] text-gray-300",children:"Tempo restante"}),s.jsx("span",{className:"text-[11px] text-yellow-300 font-medium",children:de(H)})]})]}),typeof t.progression.fatigue=="number"&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-amber-300 text-xs font-medium",children:"Fadiga"}),s.jsxs("span",{className:"text-gray-300 text-xs",children:[t.progression.fatigue,"/100"]})]}),t.progression.fatigue>=50?s.jsx("div",{className:"text-xs text-amber-300 mt-1 flex items-center",children:"üò¥ Fadiga alta ‚Äî descanse na taverna ou use um t√¥nico"}):t.progression.fatigue>0?s.jsx("div",{className:"text-[10px] text-gray-400",children:"Em recupera√ß√£o passiva durante o tempo"}):null]})]})};export{He as default};
//# sourceMappingURL=EnhancedHUD-fff0f1be.js.map
