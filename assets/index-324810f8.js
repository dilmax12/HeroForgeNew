var Un=Object.defineProperty;var Vn=(a,s,t)=>s in a?Un(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var Ue=(a,s,t)=>(Vn(a,typeof s!="symbol"?s+"":s,t),t);import{j as e,A as oa,m as tt}from"./motion-3c015c26.js";import{a as Qn,c as Za,r as x,b as at}from"./vendor-374d307f.js";import{u as Wt,a as ua,L as $e,O as _i,b as Xn,c as Jn,R as Wn,d as He,N as Ps,B as Kn}from"./router-6c8d423a.js";import{c as Yn}from"./supabase-4349ac75.js";import{S as ms,E as Zn,a as eo,C as to,b as Cs,W as Br,U as Or,H as Is,T as hs,c as us,d as ao,A as Lr,F as so,G as ro,L as io,P as Hr,e as no,f as Wa,g as oo,h as co,i as Gr,j as zr,k as Ts,l as lo,Z as mo,m as uo}from"./icons-5fe8db7b.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var Ws={},Ur=Qn;Ws.createRoot=Ur.createRoot,Ws.hydrateRoot=Ur.hydrateRoot;const po="modulepreload",go=function(a){return"/HeroForgeNew/"+a},Vr={},wt=function(s,t,r){if(!t||t.length===0)return s();const i=document.getElementsByTagName("link");return Promise.all(t.map(n=>{if(n=go(n),n in Vr)return;Vr[n]=!0;const o=n.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(!!r)for(let m=i.length-1;m>=0;m--){const u=i[m];if(u.href===n&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${c}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":po,o||(d.as="script",d.crossOrigin=""),d.href=n,document.head.appendChild(d),o)return new Promise((m,u)=>{d.addEventListener("load",m),d.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>s()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function xo(a,s){let t;try{t=a()}catch{return}return{getItem:i=>{var n;const o=l=>l===null?null:JSON.parse(l,s==null?void 0:s.reviver),c=(n=t.getItem(i))!=null?n:null;return c instanceof Promise?c.then(o):o(c)},setItem:(i,n)=>t.setItem(i,JSON.stringify(n,s==null?void 0:s.replacer)),removeItem:i=>t.removeItem(i)}}const Ka=a=>s=>{try{const t=a(s);return t instanceof Promise?t:{then(r){return Ka(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return Ka(r)(t)}}}},ho=(a,s)=>(t,r,i)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:w=>w,version:0,merge:(w,k)=>({...k,...w}),...s},o=!1;const c=new Set,l=new Set;let d;try{d=n.getStorage()}catch{}if(!d)return a((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...w)},r,i);const m=Ka(n.serialize),u=()=>{const w=n.partialize({...r()});let k;const E=m({state:w,version:n.version}).then(h=>d.setItem(n.name,h)).catch(h=>{k=h});if(k)throw k;return E},p=i.setState;i.setState=(w,k)=>{p(w,k),u()};const g=a((...w)=>{t(...w),u()},r,i);let v;const y=()=>{var w;if(!d)return;o=!1,c.forEach(E=>E(r()));const k=((w=n.onRehydrateStorage)==null?void 0:w.call(n,r()))||void 0;return Ka(d.getItem.bind(d))(n.name).then(E=>{if(E)return n.deserialize(E)}).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==n.version){if(n.migrate)return n.migrate(E.state,E.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return E.state}).then(E=>{var h;return v=n.merge(E,(h=r())!=null?h:g),t(v,!0),u()}).then(()=>{k==null||k(v,void 0),o=!0,l.forEach(E=>E(v))}).catch(E=>{k==null||k(void 0,E)})};return i.persist={setOptions:w=>{n={...n,...w},w.getStorage&&(d=w.getStorage())},clearStorage:()=>{d==null||d.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>y(),hasHydrated:()=>o,onHydrate:w=>(c.add(w),()=>{c.delete(w)}),onFinishHydration:w=>(l.add(w),()=>{l.delete(w)})},y(),v||g},fo=(a,s)=>(t,r,i)=>{let n={storage:xo(()=>localStorage),partialize:y=>y,version:0,merge:(y,w)=>({...w,...y}),...s},o=!1;const c=new Set,l=new Set;let d=n.storage;if(!d)return a((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...y)},r,i);const m=()=>{const y=n.partialize({...r()});return d.setItem(n.name,{state:y,version:n.version})},u=i.setState;i.setState=(y,w)=>{u(y,w),m()};const p=a((...y)=>{t(...y),m()},r,i);i.getInitialState=()=>p;let g;const v=()=>{var y,w;if(!d)return;o=!1,c.forEach(E=>{var h;return E((h=r())!=null?h:p)});const k=((w=n.onRehydrateStorage)==null?void 0:w.call(n,(y=r())!=null?y:p))||void 0;return Ka(d.getItem.bind(d))(n.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==n.version){if(n.migrate)return[!0,n.migrate(E.state,E.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var h;const[b,f]=E;if(g=n.merge(f,(h=r())!=null?h:p),t(g,!0),b)return m()}).then(()=>{k==null||k(g,void 0),g=r(),o=!0,l.forEach(E=>E(g))}).catch(E=>{k==null||k(void 0,E)})};return i.persist={setOptions:y=>{n={...n,...y},y.storage&&(d=y.storage)},clearStorage:()=>{d==null||d.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>v(),hasHydrated:()=>o,onHydrate:y=>(c.add(y),()=>{c.delete(y)}),onFinishHydration:y=>(l.add(y),()=>{l.delete(y)})},n.skipHydration||v(),g||p},bo=(a,s)=>"getStorage"in s||"serialize"in s||"deserialize"in s?ho(a,s):fo(a,s),ks=bo;let ts;const vo=new Uint8Array(16);function yo(){if(!ts&&(ts=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ts))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ts(vo)}const At=[];for(let a=0;a<256;++a)At.push((a+256).toString(16).slice(1));function jo(a,s=0){return At[a[s+0]]+At[a[s+1]]+At[a[s+2]]+At[a[s+3]]+"-"+At[a[s+4]]+At[a[s+5]]+"-"+At[a[s+6]]+At[a[s+7]]+"-"+At[a[s+8]]+At[a[s+9]]+"-"+At[a[s+10]]+At[a[s+11]]+At[a[s+12]]+At[a[s+13]]+At[a[s+14]]+At[a[s+15]]}const wo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Qr={randomUUID:wo};function la(a,s,t){if(Qr.randomUUID&&!s&&!a)return Qr.randomUUID();a=a||{};const r=a.random||(a.rng||yo)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,s){t=t||0;for(let i=0;i<16;++i)s[t+i]=r[i];return s}return jo(r)}const fa={F:{level:"F",name:"Novato",color:"#9CA3AF",icon:"âšª",description:"Um recÃ©m-chegado ao mundo das aventuras.",gradient:"from-gray-400 to-gray-600",textColor:"text-gray-600",glowColor:"shadow-gray-400/50"},E:{level:"E",name:"Aventureiro",color:"#10B981",icon:"ğŸŸ¢",description:"Um viajante experiente com pequenas vitÃ³rias.",gradient:"from-emerald-400 to-emerald-600",textColor:"text-emerald-600",glowColor:"shadow-emerald-400/50"},D:{level:"D",name:"Explorador",color:"#3B82F6",icon:"ğŸ”µ",description:"Aventureiro constante, conhecido nas tavernas.",gradient:"from-blue-400 to-blue-600",textColor:"text-blue-600",glowColor:"shadow-blue-400/50"},C:{level:"C",name:"HerÃ³i Local",color:"#8B5CF6",icon:"ğŸŸ£",description:"Reconhecido em cidades e aldeias.",gradient:"from-purple-400 to-purple-600",textColor:"text-purple-600",glowColor:"shadow-purple-400/50"},B:{level:"B",name:"GuardiÃ£o",color:"#F59E0B",icon:"ğŸŸ¡",description:"Um protetor notÃ¡vel, admirado pelo povo.",gradient:"from-amber-400 to-amber-600",textColor:"text-amber-600",glowColor:"shadow-amber-400/50"},A:{level:"A",name:"CampeÃ£o",color:"#EF4444",icon:"ğŸ”´",description:"HerÃ³i de elite, famoso em todo o reino.",gradient:"from-red-400 to-red-600",textColor:"text-red-600",glowColor:"shadow-red-400/50"},S:{level:"S",name:"Lenda Viva",color:"#FFD700",icon:"â­",description:"Um mito vivo, sÃ­mbolo de glÃ³ria eterna.",gradient:"from-yellow-300 via-yellow-400 to-amber-500",textColor:"text-yellow-600",glowColor:"shadow-yellow-400/75 animate-pulse"},SS:{level:"SS",name:"Ãcone Imortal",color:"#FFE55C",icon:"ğŸŒŸ",description:"AlÃ©m da lenda: referÃªncia viva de todos os herÃ³is.",gradient:"from-amber-300 via-amber-400 to-yellow-500",textColor:"text-amber-600",glowColor:"shadow-amber-300/80 animate-pulse"},SSS:{level:"SSS",name:"Mito Absoluto",color:"#FFF1A6",icon:"ğŸ‘‘",description:"O pinÃ¡culo da guilda: inspiraÃ§Ã£o eterna.",gradient:"from-yellow-200 via-yellow-300 to-amber-400",textColor:"text-yellow-700",glowColor:"shadow-yellow-200/90 animate-pulse"}},_a={F:{xp:0,missions:0},E:{xp:200,missions:2},D:{xp:600,missions:5},C:{xp:1200,missions:10,titles:1},B:{xp:2500,missions:20,titles:2},A:{xp:4e3,missions:30,titles:3,specialRequirements:["legendary_quest"]},S:{xp:7e3,missions:50,titles:5,specialRequirements:["legendary_quest","epic_achievement"]},SS:{xp:9500,missions:70,titles:6,specialRequirements:["legendary_quest","epic_achievement"]},SSS:{xp:13e3,missions:100,titles:8,specialRequirements:["legendary_quest","epic_achievement"]}},Xt=["F","E","D","C","B","A","S","SS","SSS"],Ga={F:[{type:"visual",name:"Emblema de Novato",description:"Seu primeiro emblema de aventureiro",icon:"ğŸ›¡ï¸",unlocked:!0}],E:[{type:"cosmetic",name:"Capa Verde",description:"Uma capa simples mas digna",icon:"ğŸ§¥",unlocked:!1},{type:"gameplay",name:"+5% XP Bonus",description:"ExperiÃªncia adicional em missÃµes",icon:"âš¡",unlocked:!1}],D:[{type:"visual",name:"BrasÃ£o de Explorador",description:"SÃ­mbolo de um verdadeiro explorador",icon:"ğŸ…",unlocked:!1},{type:"gameplay",name:"MissÃµes Especiais",description:"Acesso a missÃµes de dificuldade mÃ©dia",icon:"ğŸ“œ",unlocked:!1}],C:[{type:"cosmetic",name:"Armadura Roxa",description:"Armadura digna de um herÃ³i local",icon:"âš”ï¸",unlocked:!1},{type:"gameplay",name:"+10% Gold Bonus",description:"Ouro adicional em recompensas",icon:"ğŸ’°",unlocked:!1}],B:[{type:"visual",name:"Aura Dourada",description:"Uma aura que demonstra seu poder",icon:"âœ¨",unlocked:!1},{type:"special",name:"TÃ­tulo de GuardiÃ£o",description:"Reconhecimento oficial do reino",icon:"ğŸ‘‘",unlocked:!1}],A:[{type:"cosmetic",name:"Capa de CampeÃ£o",description:"Capa vermelha dos grandes herÃ³is",icon:"ğŸ­",unlocked:!1},{type:"special",name:"HistÃ³ria Ã‰pica IA",description:"HistÃ³ria personalizada gerada por IA",icon:"ğŸ“–",unlocked:!1}],S:[{type:"special",name:"Lenda Personalizada",description:"HistÃ³ria e imagem lendÃ¡ria Ãºnica",icon:"ğŸŒŸ",unlocked:!1},{type:"visual",name:"Efeito LendÃ¡rio",description:"PartÃ­culas e brilho permanente",icon:"ğŸ’«",unlocked:!1},{type:"gameplay",name:"Acesso Total",description:"Todas as funcionalidades desbloqueadas",icon:"ğŸ—ï¸",unlocked:!1}],SS:[{type:"gameplay",name:"Habilidade Exclusiva: Ordem Superior",description:"Nova habilidade de elite disponÃ­vel na Ã¡rvore de talentos",icon:"ğŸŒ€",unlocked:!1},{type:"cosmetic",name:"Traje Ãcone Imortal",description:"Visual Ãºnico da guilda para SS",icon:"ğŸ‘—",unlocked:!1},{type:"visual",name:"Aura MÃ­tica",description:"Aura dourada reforÃ§ada",icon:"âœ¨",unlocked:!1}],SSS:[{type:"special",name:"Carta de ParabenizaÃ§Ã£o da Guilda",description:"Mensagem oficial celebrando sua ascensÃ£o ao topo",icon:"ğŸ“œ",unlocked:!1},{type:"gameplay",name:"Convite para MissÃµes MÃ­ticas",description:"Desbloqueia missÃ£o de raridade mÃ­tica",icon:"ğŸ—¡ï¸",unlocked:!1},{type:"cosmetic",name:"Coroa do Mito Absoluto",description:"Adorno Ãºnico para SSS",icon:"ğŸ‘‘",unlocked:!1}]},Xr={F:0,E:5,D:10,C:15,B:20,A:25,S:30,SS:35,SSS:45},Jr={F:{epicSlots:1,rewardMultiplier:1},E:{epicSlots:1,rewardMultiplier:1.05},D:{epicSlots:1,rewardMultiplier:1.1},C:{epicSlots:1,rewardMultiplier:1.12},B:{epicSlots:1,rewardMultiplier:1.15},A:{epicSlots:1,rewardMultiplier:1.18},S:{epicSlots:2,rewardMultiplier:1.22},SS:{epicSlots:2,rewardMultiplier:1.25},SSS:{epicSlots:3,rewardMultiplier:1.3}},No=[{id:"contrato-entrega",titleTemplate:"Entrega para {location}",descriptionTemplate:"Leve esta {item} para {npc} em {location}. Cuidado com {threat} no caminho.",type:"contrato",baseReward:{gold:30,xp:20,glory:2},modifiers:["neblina","bandidos","tempo-ruim"]},{id:"contrato-escolta",titleTemplate:"Escolta de {npc}",descriptionTemplate:"Proteja {npc} durante a viagem atÃ© {location}. HÃ¡ relatos de {threat} na regiÃ£o.",type:"contrato",baseReward:{gold:50,xp:35,glory:3},enemies:[{type:"Bandido",count:2}]},{id:"caca-lobos",titleTemplate:"Perigo na {location}",descriptionTemplate:"Uma matilha de {enemy} estÃ¡ aterrorizando {location}. Derrote {count} deles.",type:"caca",baseReward:{gold:40,xp:30,glory:2},enemies:[{type:"Lobo",count:3}]},{id:"caca-goblins",titleTemplate:"InvasÃ£o Goblin",descriptionTemplate:"Goblins estÃ£o saqueando {location}. Elimine {count} invasores.",type:"caca",baseReward:{gold:60,xp:45,glory:3},enemies:[{type:"Goblin",count:4}]},{id:"exploracao-artefato",titleTemplate:"Artefato Perdido",descriptionTemplate:"Encontre o {artifact} perdido nas {location}. Dizem que estÃ¡ guardado por {guardian}.",type:"exploracao",baseReward:{gold:80,xp:60,glory:4,arcaneEssence:1,items:[{id:"pocao-media",qty:1}]},enemies:[{type:"Esqueleto",count:2}]},{id:"exploracao-mapa",titleTemplate:"Mapeamento de {location}",descriptionTemplate:"Explore e mapeie a regiÃ£o de {location}. Registre pontos de interesse e perigos.",type:"exploracao",baseReward:{gold:70,xp:50,glory:3}},{id:"historia-misterio",titleTemplate:"MistÃ©rio em {location}",descriptionTemplate:"Estranhos eventos ocorrem em {location}. Investigue e descubra a verdade.",type:"historia",baseReward:{gold:100,xp:80,glory:5,arcaneEssence:1,items:[{id:"pergaminho-xp",qty:1}]}}],So=[{id:"guild-treinar-mascote",titleTemplate:"Treinar o Mascote com {npc}",descriptionTemplate:"Participe de treinos supervisionados em {location} com {npc}. Aumente a experiÃªncia do seu mascote.",type:"caca",baseReward:{gold:40,xp:35,glory:3,items:[{id:"racao-basica",qty:2},{id:"pedra-alma",qty:1}]}},{id:"guild-capturar-criatura",titleTemplate:"Capturar uma Criatura Jovem em {location}",descriptionTemplate:"Localize e capture uma criatura jovem com a ajuda de {npc}. Traga o espÃ©cime para estudo.",type:"exploracao",baseReward:{gold:60,xp:50,glory:4,arcaneEssence:1,items:[{id:"essencia-vinculo",qty:1}]}},{id:"guild-acalmar-fera",titleTemplate:"Acalmar uma Fera Selvagem perto de {location}",descriptionTemplate:"Aproxime-se com cuidado e acalme a fera sob orientaÃ§Ã£o de {npc}. Evite confrontos desnecessÃ¡rios.",type:"caca",baseReward:{gold:70,xp:55,glory:4,items:[{id:"racao-deluxe",qty:1}]},enemies:[{type:"Lobo",count:1}]},{id:"guild-essencia-bestial",titleTemplate:"Encontrar a EssÃªncia Bestial em {location}",descriptionTemplate:"Explore ruÃ­nas e cavernas antigas com {npc} para recuperar a EssÃªncia Bestial.",type:"exploracao",baseReward:{gold:90,xp:70,glory:5,arcaneEssence:1,items:[{id:"essencia-bestial",qty:1}]}},{id:"guild-ovo-basico",titleTemplate:"Primeiro Ovo da Guilda em {location}",descriptionTemplate:"Participe de uma coleta supervisionada com {npc} para obter um ovo comum.",type:"exploracao",baseReward:{gold:30,xp:40,glory:3,items:[{id:"reward-egg-basico",qty:1}]}}],Ks=["Vila do Vale","Bosque Sombrio","Montanhas Geladas","PÃ¢ntano Negro","RuÃ­nas Antigas","Porto dos Ventos","Cavernas Profundas","Torre Abandonada","Floresta Encantada","Deserto Ardente","Cidade Perdida","CemitÃ©rio Assombrado"],Ys=["Mercador Aldric","SÃ¡bia Elara","Ferreiro Gorin","Curandeira Mira","CapitÃ£o Theron","Escriba Lysander","CaÃ§ador Kael","Bruxa Morgana"],Co=["carta importante","poÃ§Ã£o rara","mapa antigo","gema preciosa","pergaminho mÃ¡gico","relÃ­quia sagrada","chave misteriosa","amuleto protetor"],ko=["Orbe de Cristal","Espada Ã‰lfica","Anel dos Antigos","Cajado do Poder","Escudo Sagrado","Coroa Perdida","Livro dos Segredos","CÃ¡lice Dourado"],qi=["bandidos","lobos famintos","espÃ­ritos inquietos","goblins selvagens","trolls das montanhas","serpentes venenosas","mortos-vivos","dragÃµes jovens"],Ao=["um golem de pedra","esqueletos guerreiros","um troll antigo","espÃ­ritos guardiÃµes","uma hidra menor","gÃ¡rgulas de pedra"],Fi={rapida:{goldMultiplier:.7,xpMultiplier:.8,enemyCountMultiplier:.7},padrao:{goldMultiplier:1,xpMultiplier:1,enemyCountMultiplier:1},epica:{goldMultiplier:1.5,xpMultiplier:1.8,enemyCountMultiplier:1.4}};function Ot(a){return a[Math.floor(Math.random()*a.length)]}function $a(a,s){return a.replace(/\{(\w+)\}/g,(t,r)=>s[r]||t)}function Bi(a,s){const t=Fi[s];return{gold:Math.floor(a.gold*t.goldMultiplier),xp:Math.floor(a.xp*t.xpMultiplier),items:a.items,glory:a.glory?Math.floor(a.glory*t.goldMultiplier):void 0,arcaneEssence:a.arcaneEssence?Math.floor(a.arcaneEssence*t.goldMultiplier):void 0}}function Mo(a=[],s){const t=Fi[s];return a.map(r=>({...r,count:Math.max(1,Math.floor(r.count*t.enemyCountMultiplier)),level:s==="rapida"?1:s==="padrao"?2:3}))}function aa(a="padrao",s=1,t=!1){var d,m,u,p;const r=Ot(t?So:No),i={location:Ot(Ks),npc:Ot(Ys),item:Ot(Co),artifact:Ot(ko),threat:Ot(qi),guardian:Ot(Ao),enemy:((m=(d=r.enemies)==null?void 0:d[0])==null?void 0:m.type)||"Inimigo",count:((p=(u=r.enemies)==null?void 0:u[0])==null?void 0:p.count.toString())||"1"},n=`quest-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o=Bi(r.baseReward,a),c=r.enemies?Mo(r.enemies,a):void 0,l={id:n,title:$a(r.titleTemplate,i),description:$a(r.descriptionTemplate,i),type:r.type,difficulty:a,levelRequirement:Math.max(1,s-1),timeLimit:(()=>a==="rapida"?Math.floor(Math.random()*16)+5:a==="epica"?Math.floor(Math.random()*61)+120:60)(),enemies:c,rewards:o,repeatable:r.type==="caca"||r.type==="contrato",isGuildQuest:t,failurePenalty:a==="epica"?{gold:20,reputation:-5}:void 0,templateId:r.id,categoryHint:r.id==="contrato-escolta"?"escolta":r.type==="caca"?"controle":r.type==="exploracao"?"coleta":void 0,biomeHint:(()=>{const g=i.location;return g==="RuÃ­nas Antigas"?"RuÃ­nas Antigas":g==="Cavernas Profundas"?"Caverna Antiga":g==="Floresta Encantada"?"Floresta Nebulosa":g==="Bosque Sombrio"?"Floresta Umbral":g==="Montanhas Geladas"?"Colinas de Boravon":g==="Porto dos Ventos"||g==="Rio Marfim"?"Rio Marfim":"Floresta Nebulosa"})(),phasesHint:a==="rapida"?3:a==="epica"?6:4,baseRewardsHint:{xp:o.xp,gold:o.gold}};return t&&console.log("ğŸ° MissÃ£o de guilda gerada:",l.title,"- Dificuldade:",a),l}function Eo(a=1,s=0,t="F"){console.log("ğŸ¯ generateQuestBoard chamada:",{heroLevel:a,guildLevel:s});const r=[],i=Jr[t]||Jr.F,n=(()=>{try{const m=localStorage.getItem("heroforge-onboarding"),u=m?JSON.parse(m):{},p=Array.isArray(u==null?void 0:u.validatedSteps)?u.validatedSteps:[],g=localStorage.getItem("hfn_training_basic_done")==="1";return p.includes("create-hero")&&p.includes("accept-quest")&&g}catch{return!1}})(),o=t==="F"&&!n;r.push(aa("rapida",a)),r.push(aa("rapida",a)),r.push(aa("padrao",a)),r.push(aa("padrao",a)),r.push(aa("padrao",a));for(let m=0;m<Math.max(1,i.epicSlots);m++)r.push(aa("epica",a));if(console.log("ğŸ° Verificando missÃµes de guilda - guildLevel:",s),s>0){if(console.log("âœ… Gerando missÃ£o de guilda padrÃ£o"),r.push(aa("padrao",a,!0)),s>=3&&(console.log("âœ… Gerando missÃ£o de guilda Ã©pica"),r.push(aa("epica",a,!0))),a>=5){const m={location:Ot(Ks),npc:Ot(Ys)},u=`guild-ovo-${Date.now()}-${Math.random().toString(36).slice(2)}`;r.push({id:u,title:$a("Primeiro Ovo da Guilda em {location}",m),description:$a("Participe de uma coleta supervisionada com {npc} para obter um ovo comum.",m),type:"exploracao",difficulty:"padrao",levelRequirement:Math.max(5,a),timeLimit:60,enemies:void 0,rewards:{gold:30,xp:40,glory:3,items:[{id:"reward-egg-basico",qty:1}]},repeatable:!1,isGuildQuest:!0,failurePenalty:{gold:10},templateId:"guild-ovo-basico",categoryHint:"coleta"}),console.log("ğŸ° MissÃ£o especial da guilda para EstÃ¡bulo inserida")}}else console.log("âŒ Nenhuma missÃ£o de guilda gerada - guildLevel Ã© 0");const c=r.filter(m=>m.isGuildQuest);console.log("ğŸ“‹ MissÃµes geradas:",{total:r.length,guildQuests:c.length,guildQuestTitles:c.map(m=>m.title)});const l=r.map(m=>{var u,p;return{...m,rewards:{...m.rewards,gold:Math.floor((((u=m.rewards)==null?void 0:u.gold)||0)*i.rewardMultiplier),xp:Math.floor((((p=m.rewards)==null?void 0:p.xp)||0)*i.rewardMultiplier)}}});if(!l.some(m=>m.categoryHint==="escolta")){const m={location:Ot(Ks),npc:Ot(Ys),threat:Ot(qi)},u=`quest-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;l.push({id:u,title:$a("Escolta de {npc}",m),description:$a("Proteja {npc} durante a viagem atÃ© {location}. HÃ¡ relatos de {threat} na regiÃ£o.",m),type:"contrato",difficulty:"padrao",levelRequirement:Math.max(1,a-1),timeLimit:60,enemies:[{type:"Bandido",count:2,level:2}],rewards:Bi({gold:50,xp:35,glory:3},"padrao"),repeatable:!0,isGuildQuest:!1,failurePenalty:void 0,templateId:"contrato-escolta",categoryHint:"escolta",phasesHint:4,baseRewardsHint:{xp:35,gold:50}})}if(t==="F"&&n)return l.filter(m=>m.categoryHint==="coleta"||m.categoryHint==="escolta");if(o){const m=l.filter(u=>u.categoryHint==="coleta"||u.categoryHint==="escolta");return m.length?m:l}return l}const Oi=[{id:"primeira-missao",title:"Primeira MissÃ£o",description:"Complete sua primeira missÃ£o",icon:"ğŸ¯",maxProgress:1},{id:"heroi-da-vila",title:"HerÃ³i da Vila",description:"Complete 10 missÃµes",icon:"ğŸ†",maxProgress:10},{id:"cacador-experiente",title:"CaÃ§ador Experiente",description:"Complete 5 missÃµes de caÃ§a",icon:"ğŸ¹",maxProgress:5},{id:"explorador-corajoso",title:"Explorador Corajoso",description:"Complete 3 missÃµes de exploraÃ§Ã£o",icon:"ğŸ—ºï¸",maxProgress:3},{id:"lenda-epica",title:"Lenda Ã‰pica",description:"Complete uma missÃ£o Ã©pica",icon:"âš”ï¸",maxProgress:1},{id:"amigo-dos-animais",title:"Amigo dos Animais",description:"Complete 5 missÃµes de companheiros da guilda",icon:"ğŸ¾",maxProgress:5},{id:"domador-de-feras",title:"Domador de Feras",description:"Coletar 3 EssÃªncias Bestiais",icon:"ğŸ§¬",maxProgress:3},{id:"cavaleiro-mitico",title:"Cavaleiro MÃ­tico",description:"Encontrar 2 Pergaminhos de Montaria",icon:"ğŸ“œ",maxProgress:2}],Wr={regenHpPerMin:6,regenMpPerMin:5,regenStaminaPerMin:5,deathRecoveryMinutes:10,deathPenaltyEnabled:!0,restBuffHpMpMultiplier:1.5,restBuffStaminaMultiplier:2,restBuffDurationMinutes:10,meditationMpBonusPerMin:8,meditationDurationMinutes:2,meditationCooldownMinutes:10,dungeonRegenMultiplier:.5,inviteLinksEnabled:!0,inviteLinkValidityDays:7,invitePrivacyLevel:"public",inviteShareIncludeContacts:!1,inviteRewardGold:100,inviteRewardXP:150,npcImmersiveModeEnabled:!1,npcDialogueWhisperProb:.25,npcDialogueThoughtProb:.35,npcBiomeLexiconEnabled:!0,npcSeedTarget:30,npcVisibleCap:6,npcRotationSeconds:60,npcNotificationsMode:"compact",npcNotifyMaxPerTick:3,npcInteractionDifficulty:"normal",npcRelationKnownThreshold:10,npcRelationFriendThreshold:40,npcRelationBestFriendThreshold:75,npcRelationAllyThreshold:90,npcRelationRivalThreshold:-30,npcDuelRivalryModerate:-30,npcDuelRivalryHigh:-60,npcDuelLevelDiffMax:5,npcInteractionCooldownSeconds:90,npcRelationDecayPerDay:1,npcRelationPositiveWeight:4,npcRelationNegativeWeight:5,npcRelationFactionCascadePercent:.005,relationIntensityPercent:100,eventsCascadePerDay:2,interactionsCooldownMinutes:15,randomEventsEnabled:!0,eventsCooldownDaysMin:2,eventsCooldownDaysMax:4,rivalEncounterChance:.2,autoInteractionEnabled:!0,autoChanceMinPercent:30,autoChanceMaxPercent:70,notifSoundEnabled:!0,notifVisualMode:"compact",notifPriorityMode:"important_first",notifFrequency:"normal",dailyNpcInteractionsLimit:2,reducedMotionEnabled:!1,saveDataEnabled:!1,networkEffectiveType:"unknown"},Pa=Za()(ks((a,s)=>({...Wr,updateSettings:t=>{const r={...s(),...t};a(r)},resetDefaults:()=>a(Wr),applyGuildBuffs:({xpBuffPercent:t,trainingDiscountPercent:r,eventName:i,expiresAt:n,sourceGuildId:o})=>{const c=s();a({...c,guildXpBuffPercent:t??c.guildXpBuffPercent??0,trainingCostReductionPercent:r??c.trainingCostReductionPercent??0,activeGuildEventName:i??c.activeGuildEventName,guildEventExpiresAt:n??c.guildEventExpiresAt,guildBuffSourceGuildId:o??c.guildBuffSourceGuildId})},clearGuildBuffs:()=>{const t=s();a({...t,guildXpBuffPercent:0,trainingCostReductionPercent:0,activeGuildEventName:void 0,guildEventExpiresAt:void 0,guildBuffSourceGuildId:void 0})}}),{name:"heroforge-game-settings",version:1,partialize:a=>({regenHpPerMin:a.regenHpPerMin,regenMpPerMin:a.regenMpPerMin,regenStaminaPerMin:a.regenStaminaPerMin,deathRecoveryMinutes:a.deathRecoveryMinutes,deathPenaltyEnabled:a.deathPenaltyEnabled,restBuffHpMpMultiplier:a.restBuffHpMpMultiplier,restBuffStaminaMultiplier:a.restBuffStaminaMultiplier,restBuffDurationMinutes:a.restBuffDurationMinutes,meditationMpBonusPerMin:a.meditationMpBonusPerMin,meditationDurationMinutes:a.meditationDurationMinutes,meditationCooldownMinutes:a.meditationCooldownMinutes,dungeonRegenMultiplier:a.dungeonRegenMultiplier,guildXpBuffPercent:a.guildXpBuffPercent,trainingCostReductionPercent:a.trainingCostReductionPercent,activeGuildEventName:a.activeGuildEventName,guildEventExpiresAt:a.guildEventExpiresAt,guildBuffSourceGuildId:a.guildBuffSourceGuildId,inviteLinksEnabled:a.inviteLinksEnabled,inviteLinkValidityDays:a.inviteLinkValidityDays,invitePrivacyLevel:a.invitePrivacyLevel,inviteShareIncludeContacts:a.inviteShareIncludeContacts,inviteRewardGold:a.inviteRewardGold,inviteRewardXP:a.inviteRewardXP,npcImmersiveModeEnabled:a.npcImmersiveModeEnabled,npcDialogueWhisperProb:a.npcDialogueWhisperProb,npcDialogueThoughtProb:a.npcDialogueThoughtProb,npcBiomeLexiconEnabled:a.npcBiomeLexiconEnabled,npcSeedTarget:a.npcSeedTarget,npcVisibleCap:a.npcVisibleCap,npcRotationSeconds:a.npcRotationSeconds,npcNotificationsMode:a.npcNotificationsMode,npcNotifyMaxPerTick:a.npcNotifyMaxPerTick,npcInteractionDifficulty:a.npcInteractionDifficulty,npcRelationKnownThreshold:a.npcRelationKnownThreshold,npcRelationFriendThreshold:a.npcRelationFriendThreshold,npcRelationBestFriendThreshold:a.npcRelationBestFriendThreshold,npcRelationAllyThreshold:a.npcRelationAllyThreshold,npcRelationRivalThreshold:a.npcRelationRivalThreshold,npcDuelRivalryModerate:a.npcDuelRivalryModerate,npcDuelRivalryHigh:a.npcDuelRivalryHigh,npcDuelLevelDiffMax:a.npcDuelLevelDiffMax,npcInteractionCooldownSeconds:a.npcInteractionCooldownSeconds,npcRelationDecayPerDay:a.npcRelationDecayPerDay,npcRelationPositiveWeight:a.npcRelationPositiveWeight,npcRelationNegativeWeight:a.npcRelationNegativeWeight,npcRelationFactionCascadePercent:a.npcRelationFactionCascadePercent,relationIntensityPercent:a.relationIntensityPercent,eventsCascadePerDay:a.eventsCascadePerDay,interactionsCooldownMinutes:a.interactionsCooldownMinutes,randomEventsEnabled:a.randomEventsEnabled,eventsCooldownDaysMin:a.eventsCooldownDaysMin,eventsCooldownDaysMax:a.eventsCooldownDaysMax,rivalEncounterChance:a.rivalEncounterChance,autoInteractionEnabled:a.autoInteractionEnabled,autoChanceMinPercent:a.autoChanceMinPercent,autoChanceMaxPercent:a.autoChanceMaxPercent,notifSoundEnabled:a.notifSoundEnabled,notifVisualMode:a.notifVisualMode,notifPriorityMode:a.notifPriorityMode,notifFrequency:a.notifFrequency,dailyNpcInteractionsLimit:a.dailyNpcInteractionsLimit,reducedMotionEnabled:a.reducedMotionEnabled,saveDataEnabled:a.saveDataEnabled,networkEffectiveType:a.networkEffectiveType})})),ft=()=>Pa.getState();function fs(a,s,t){return Math.max(s,Math.min(t,a))}function Li(a){const s=ft();return a<=(s.npcRelationRivalThreshold??-30)?"rival":a>=(s.npcRelationAllyThreshold??90)?"aliado":a>=(s.npcRelationBestFriendThreshold??75)?"melhor_amigo":a>=(s.npcRelationFriendThreshold??40)?"amigo":a>=(s.npcRelationKnownThreshold??10)?"conhecido":"neutro"}function vr(a,s,t){var k,E;const r=ft(),i=r.npcRelationPositiveWeight??4,n=r.npcRelationNegativeWeight??5,o=a.npcMemory||{interactions:[],preferences:{},scoreByAction:{},friendStatusByHeroId:{},lastContactByHeroId:{},lastInteractionByType:{}},c=o.interactions.filter(h=>h.heroId===s.id&&(h.impact||0)>0).length,l=(k=o.lastContactByHeroId)!=null&&k[s.id]?Math.max(0,3-(Date.now()-new Date(o.lastContactByHeroId[s.id]).getTime())/(60*60*1e3)):0,d=t==="amigÃ¡vel"?i+Math.min(3,c)+Math.floor(l):t==="neutro"?1:-n,m={...a.socialRelations||{}},u=m[s.id]||0,p=(r.relationIntensityPercent??100)/100,g=Math.max(.2,(100-Math.max(0,u))/100),v=Math.ceil(d*p*g),y=fs(u+v,-100,100);m[s.id]=y,a.socialRelations=m;const w=Li(y);return o.friendStatusByHeroId={...o.friendStatusByHeroId||{},[s.id]:w==="neutro"?((E=o.friendStatusByHeroId)==null?void 0:E[s.id])||"neutro":w},o.lastContactByHeroId={...o.lastContactByHeroId||{},[s.id]:new Date().toISOString()},a.npcMemory=o,{value:y,tier:w}}function Ro(a,s){const t=(a.reputationFactions||[]).reduce((o,c)=>o+Math.max(0,c.reputation||0),0);if(t<=0)return;const i=ft().npcRelationFactionCascadePercent??.02,n=Math.floor(t*i);s.forEach(o=>{var m,u;const c={...o.socialRelations||{}},l=(u=(m=o.npcMemory)==null?void 0:m.lastContactByHeroId)==null?void 0:u[a.id];(l?(Date.now()-new Date(l).getTime())/(24*60*60*1e3):1/0)<=3&&(c[a.id]=fs((c[a.id]||0)+Math.min(2,n),-100,100)),o.socialRelations=c})}function Po(a){if(a.length<2)return null;const s=a[Math.floor(Math.random()*a.length)];let t=a[Math.floor(Math.random()*a.length)];s.id===t.id&&(t=a[(a.indexOf(s)+1)%a.length]);const r=Math.floor(-3+Math.random()*7),i={...s.socialRelations||{}};i[t.id]=fs((i[t.id]||0)+r,-100,100),s.socialRelations=i;const n={...t.socialRelations||{}};return n[s.id]=fs((n[s.id]||0)+r,-100,100),t.socialRelations=n,{a:s,b:t,delta:r}}function Hi(a){var s;try{const t=((s=a.npcMemory)==null?void 0:s.friendStatusByHeroId)||{},r=Object.keys(t);if(r.length===0)return{tierName:"neutro",value:0};const i=r.map(o=>({id:o,status:t[o]})),n=["rival","neutro","conhecido","amigo","melhor_amigo","aliado"];return i.sort((o,c)=>n.indexOf(c.status)-n.indexOf(o.status)),{tierName:i[0].status,value:1}}catch{return{tierName:"neutro",value:0}}}function Io(a){const t=(ft().relationIntensityPercent??100)/100,r=Hi(a).tierName;return Math.min(.5,(r==="amigo"?.1:r==="melhor_amigo"?.2:r==="aliado"?.3:0)*t)}function To(a){const t=(ft().relationIntensityPercent??100)/100,r=Hi(a).tierName;return Math.min(.25,(r==="amigo"?.05:r==="melhor_amigo"?.1:r==="aliado"?.15:0)*t)}const Ee=[{id:"orbe-amaldicoado",name:"Orbe AmaldiÃ§oado",description:"Artefato sombrio que exala energia maligna. NÃ£o consumÃ­vel.",type:"material",rarity:"epico",price:500,icon:"ğŸ•³ï¸",currency:"arcaneEssence"},{id:"orbe-purificado",name:"Orbe Purificado",description:"Artefato purificado por magia sagrada. NÃ£o consumÃ­vel.",type:"material",rarity:"raro",price:480,icon:"ğŸ”®",currency:"glory"},{id:"pocao-pequena",name:"PoÃ§Ã£o de Cura Pequena",description:"Restaura 20 HP instantaneamente",type:"consumable",rarity:"comum",price:25,icon:"ğŸ§ª",effects:{hp:20}},{id:"pocao-media",name:"PoÃ§Ã£o de Cura MÃ©dia",description:"Restaura 50 HP instantaneamente",type:"consumable",rarity:"raro",price:60,icon:"ğŸ§ª",effects:{hp:50}},{id:"pocao-grande",name:"PoÃ§Ã£o de Cura Grande",description:"Restaura 100 HP instantaneamente",type:"consumable",rarity:"epico",price:150,icon:"ğŸ§ª",effects:{hp:100}},{id:"pocao-mana",name:"PoÃ§Ã£o de Mana",description:"Restaura 30 MP instantaneamente",type:"consumable",rarity:"comum",price:30,icon:"ğŸ”®",effects:{mp:30}},{id:"contrato-montaria",name:"Contrato de EstÃ¡bulo",description:"Permite recrutar uma montaria aleatÃ³ria.",type:"consumable",rarity:"raro",price:300,icon:"ğŸ“œ"},{id:"kit-montaria",name:"Kit de Montaria",description:"Pacote com itens para montar e evoluir: contrato, pergaminho, essÃªncia bestial e pedra mÃ¡gica.",type:"bundle",rarity:"raro",price:950,icon:"ğŸ"},{id:"pergaminho-xp",name:"Pergaminho de ExperiÃªncia",description:"Concede 50 XP de bÃ´nus",type:"consumable",rarity:"raro",price:80,icon:"ğŸ“œ",effects:{duration:0}},{id:"essencia-calor",name:"EssÃªncia de Calor",description:"Acelera a incubaÃ§Ã£o de ovos em 15 minutos.",type:"consumable",rarity:"comum",price:35,icon:"ğŸ”¥"},{id:"brasas-magicas",name:"Brasas MÃ¡gicas",description:"Acelera a incubaÃ§Ã£o de ovos em 1 hora.",type:"consumable",rarity:"raro",price:120,icon:"â™¨ï¸"},{id:"pedra-alma",name:"Pedra de Alma",description:"Canaliza energia para evoluÃ§Ã£o de mascotes (+300 XP).",type:"consumable",rarity:"epico",price:200,icon:"ğŸª¨"},{id:"racao-basica",name:"RaÃ§Ã£o BÃ¡sica de Mascote",description:"+50 XP para mascotes ao alimentar.",type:"consumable",rarity:"comum",price:30,icon:"ğŸ–"},{id:"racao-deluxe",name:"RaÃ§Ã£o Deluxe de Mascote",description:"+150 XP para mascotes ao alimentar.",type:"consumable",rarity:"raro",price:90,icon:"ğŸ—"},{id:"essencia-vinculo",name:"EssÃªncia de VÃ­nculo",description:"Aprimora o vÃ­nculo com o mascote, aumentando seus bÃ´nus em 1%.",type:"consumable",rarity:"raro",price:140,icon:"ğŸ”—"},{id:"tonico-companheiro",name:"TÃ´nico do Companheiro",description:"Restaura 50 de energia do mascote ativo.",type:"consumable",rarity:"raro",price:120,icon:"âš¡"},{id:"tonico-descanso",name:"TÃ´nico de Descanso",description:"Reduz 20 pontos de Fadiga imediatamente",type:"consumable",rarity:"comum",price:35,icon:"â˜•",effects:{fatigue:20}},{id:"elixir-vigor",name:"Elixir de Vigor",description:"Reduz 40 pontos de Fadiga imediatamente",type:"consumable",rarity:"raro",price:95,icon:"âš—ï¸",effects:{fatigue:40}},{id:"elixir-forca",name:"Elixir de ForÃ§a",description:"+2 ForÃ§a por 60 minutos",type:"consumable",rarity:"raro",price:100,icon:"ğŸ’ª",bonus:{forca:2},effects:{duration:60}},{id:"elixir-agilidade",name:"Elixir de Agilidade",description:"+2 Destreza por 60 minutos",type:"consumable",rarity:"raro",price:100,icon:"ğŸ’¨",bonus:{destreza:2},effects:{duration:60}},{id:"elixir-intelecto",name:"Elixir de Intelecto",description:"+2 InteligÃªncia por 60 minutos",type:"consumable",rarity:"raro",price:100,icon:"ğŸ§ ",bonus:{inteligencia:2},effects:{duration:60}},{id:"pocao-mana-grande",name:"PoÃ§Ã£o de Mana Grande",description:"Restaura 100 MP instantaneamente",type:"consumable",rarity:"epico",price:160,icon:"ğŸ”®",effects:{mp:100}},{id:"pergaminho-fortuna",name:"Pergaminho de Fortuna",description:"Aumenta ganho de ouro em 10% por 30 minutos",type:"consumable",rarity:"raro",price:120,icon:"ğŸ“œ",effects:{duration:30}},{id:"espada-aprendiz",name:"Espada de Aprendiz",description:"LÃ¢mina leve para iniciantes. +3 ForÃ§a, +1 Destreza",type:"weapon",rarity:"comum",price:80,icon:"ğŸ—¡ï¸",bonus:{forca:3,destreza:1},slot:"mainHand"},{id:"machado-rustico",name:"Machado RÃºstico",description:"Pesado e bruto. +4 ForÃ§a, -1 Destreza",type:"weapon",rarity:"comum",price:100,icon:"ğŸª“",bonus:{forca:4,destreza:-1},slot:"mainHand"},{id:"arco-simples",name:"Arco Simples",description:"Arco de treino. +3 Destreza (alcance duplo)",type:"weapon",rarity:"comum",price:90,icon:"ğŸ¹",bonus:{destreza:3},slot:"mainHand"},{id:"lamina-viajante",name:"LÃ¢mina do Viajante",description:"EdiÃ§Ã£o limitada. +4 ForÃ§a, +1 Destreza",type:"weapon",rarity:"raro",price:180,icon:"ğŸ—¡ï¸",bonus:{forca:4,destreza:1},slot:"mainHand"},{id:"escudo-madeira",name:"Escudo de Madeira",description:"ProteÃ§Ã£o simples para a mÃ£o secundÃ¡ria. +2 ConstituiÃ§Ã£o",type:"weapon",rarity:"comum",price:90,icon:"ğŸ›¡ï¸",bonus:{constituicao:2},slot:"offHand"},{id:"adaga-leve",name:"Adaga Leve",description:"Perfeita para mÃ£o secundÃ¡ria. +2 Destreza",type:"weapon",rarity:"comum",price:85,icon:"ğŸ—¡ï¸",bonus:{destreza:2},slot:"offHand"},{id:"espada-ferro",name:"Espada de Ferro",description:"Uma espada confiÃ¡vel de ferro forjado. +3 ForÃ§a",type:"weapon",rarity:"comum",price:100,icon:"âš”ï¸",bonus:{forca:3}},{id:"espada-aco",name:"Espada de AÃ§o",description:"LÃ¢mina afiada de aÃ§o temperado. +5 ForÃ§a",type:"weapon",rarity:"raro",price:250,icon:"ğŸ—¡ï¸",bonus:{forca:5}},{id:"adaga-sombras",name:"Adaga das Sombras",description:"LÃ¢mina Ã©lfica encantada. +3 Destreza, +2 ForÃ§a",type:"weapon",rarity:"epico",price:400,icon:"ğŸ—¡ï¸",bonus:{destreza:3,forca:2}},{id:"cajado-sabio",name:"Cajado do SÃ¡bio",description:"Cajado mÃ¡gico antigo. +4 InteligÃªncia, +2 Sabedoria",type:"weapon",rarity:"epico",price:450,icon:"ğŸª„",bonus:{inteligencia:4,sabedoria:2},currency:"arcaneEssence",setId:"arcanista"},{id:"arco-madeira",name:"Arco de Madeira",description:"Arco simples de madeira resistente. +2 Destreza",type:"weapon",rarity:"comum",price:80,icon:"ğŸ¹",bonus:{destreza:2}},{id:"arco-composto",name:"Arco Composto",description:"Arco avanÃ§ado com maior alcance. +4 Destreza, +1 ForÃ§a",type:"weapon",rarity:"raro",price:220,icon:"ğŸ¹",bonus:{destreza:4,forca:1}},{id:"arco-elfico",name:"Arco Ã‰lfico Encantado",description:"Arco Ã©lfico com runas mÃ¡gicas. +5 Destreza, +2 Sabedoria",type:"weapon",rarity:"epico",price:480,icon:"ğŸ¹",bonus:{destreza:5,sabedoria:2},currency:"glory",setId:"elfico"},{id:"besta-pesada",name:"Besta Pesada",description:"Besta de guerra com grande poder. +3 ForÃ§a, +3 Destreza",type:"weapon",rarity:"raro",price:320,icon:"ğŸ¹",bonus:{forca:3,destreza:3}},{id:"lanca-guarda",name:"LanÃ§a da Guarda",description:"Leve e resistente, usada pelos sentinelas da cidade. +3 ForÃ§a, +1 ConstituiÃ§Ã£o",type:"weapon",rarity:"comum",price:110,icon:"ğŸ—¡ï¸",bonus:{forca:3,constituicao:1}},{id:"machado-ferro",name:"Machado de Ferro",description:"Perfeito para quem confia mais na forÃ§a que na tÃ©cnica. +4 ForÃ§a",type:"weapon",rarity:"comum",price:120,icon:"ğŸª“",bonus:{forca:4}},{id:"espada-flamejante",name:"Espada Flamejante",description:"Brilha como um sol em batalha. Chance temÃ¡tica de causar dano de fogo.",type:"weapon",rarity:"raro",price:280,icon:"ğŸ”¥",bonus:{forca:5}},{id:"martelo-guerra",name:"Martelo de Guerra",description:"Seu impacto ecoa como trovÃ£o. +6 ForÃ§a, +3 ConstituiÃ§Ã£o",type:"weapon",rarity:"epico",price:520,icon:"ğŸ”¨",bonus:{forca:6,constituicao:3},currency:"glory"},{id:"katana-vento",name:"Katana do Vento",description:"A lÃ¢mina canta ao cortar o ar. +4 ForÃ§a, +5 Destreza",type:"weapon",rarity:"epico",price:540,icon:"ğŸ—¡ï¸",bonus:{forca:4,destreza:5},currency:"glory"},{id:"lanca-aurora",name:"LanÃ§a da Aurora",description:"SÃ­mbolo dos cavaleiros celestiais. +6 ForÃ§a, +2 Sabedoria (sagrado)",type:"weapon",rarity:"epico",price:560,icon:"ğŸ—¡ï¸",bonus:{forca:6,sabedoria:2},currency:"glory",setId:"aurora"},{id:"espada-ultimo-heroi",name:"Espada do Ãšltimo HerÃ³i",description:"Forjada nas chamas do destino. BÃ´nus temÃ¡tico de crÃ­tico/XP.",type:"weapon",rarity:"lendario",price:1200,icon:"âš”ï¸",bonus:{forca:8,carisma:2},currency:"arcaneEssence",setId:"eterno"},{id:"espada-longa-ferro",name:"Espada Longa de Ferro",description:"BÃ¡sica e confiÃ¡vel. +3 ForÃ§a",type:"weapon",rarity:"comum",price:100,icon:"âš”ï¸",bonus:{forca:3}},{id:"montante-aco",name:"Montante de AÃ§o",description:"Duas mÃ£os; alto dano, mais lenta. +6 ForÃ§a, -1 Destreza",type:"weapon",rarity:"raro",price:280,icon:"âš”ï¸",bonus:{forca:6,destreza:-1}},{id:"machado-guerra",name:"Machado de Guerra",description:"Feito para quebrar defesas. +5 ForÃ§a, -1 Destreza",type:"weapon",rarity:"raro",price:260,icon:"ğŸª“",bonus:{forca:5,destreza:-1}},{id:"lanca-gladiador",name:"LanÃ§a do Gladiador",description:"Alcance longo e preciso. +4 ForÃ§a, +1 Destreza",type:"weapon",rarity:"raro",price:240,icon:"ğŸ—¡ï¸",bonus:{forca:4,destreza:1}},{id:"montante-flamejante",name:"Montante Flamejante",description:"LendÃ¡ria; emite chamas ao atacar. +8 ForÃ§a",type:"weapon",rarity:"lendario",price:1300,icon:"ğŸ”¥",bonus:{forca:8},currency:"arcaneEssence"},{id:"adagas-gemeas",name:"Adagas GÃªmeas",description:"RÃ¡pidas; ideais para crÃ­ticos. +4 Destreza, +1 ForÃ§a",type:"weapon",rarity:"raro",price:230,icon:"ğŸ—¡ï¸",bonus:{destreza:4,forca:1}},{id:"katar-sombrio",name:"Katar Sombrio",description:"Perfura armaduras leves. +5 Destreza, -1 ConstituiÃ§Ã£o",type:"weapon",rarity:"raro",price:260,icon:"ğŸ—¡ï¸",bonus:{destreza:5,constituicao:-1}},{id:"lamina-nevoa",name:"LÃ¢mina de NÃ©voa",description:"A nÃ©voa envolve o portador. +4 Destreza, +2 Sabedoria",type:"weapon",rarity:"epico",price:420,icon:"ğŸŒ«ï¸",bonus:{destreza:4,sabedoria:2}},{id:"laminas-ocultas",name:"LÃ¢minas Ocultas",description:"LendÃ¡rias; chance de ataque duplo. +6 Destreza, +2 ForÃ§a",type:"weapon",rarity:"lendario",price:1150,icon:"ğŸ—¡ï¸",bonus:{destreza:6,forca:2},currency:"arcaneEssence"},{id:"espadas-curtas-duplas",name:"Espadas Curtas Duplas",description:"EquilÃ­brio entre velocidade e dano. +4 Destreza, +2 ForÃ§a",type:"weapon",rarity:"raro",price:240,icon:"ğŸ—¡ï¸",bonus:{destreza:4,forca:2}},{id:"cajado-carvalho",name:"Cajado de Carvalho",description:"BÃ¡sico; canaliza magia elemental. +2 InteligÃªncia",type:"weapon",rarity:"comum",price:90,icon:"ğŸª„",bonus:{inteligencia:2}},{id:"cajado-cristal",name:"Cajado de Cristal",description:"Amplifica feitiÃ§os de gelo. +3 InteligÃªncia, +1 Sabedoria",type:"weapon",rarity:"raro",price:260,icon:"ğŸ”®",bonus:{inteligencia:3,sabedoria:1}},{id:"cajado-arcano",name:"Cajado Arcano",description:"Runas aceleram conjuraÃ§Ã£o. +4 InteligÃªncia",type:"weapon",rarity:"epico",price:420,icon:"ğŸª„",bonus:{inteligencia:4}},{id:"cajado-vortice",name:"Cajado do VÃ³rtice",description:"Dano mÃ¡gico em Ã¡rea. +5 InteligÃªncia, +2 Sabedoria",type:"weapon",rarity:"epico",price:560,icon:"ğŸŒ€",bonus:{inteligencia:5,sabedoria:2},currency:"glory"},{id:"cetro-almas",name:"Cetro das Almas",description:"LendÃ¡rio; regenera mana ao causar dano. +3 Sabedoria, +4 InteligÃªncia",type:"weapon",rarity:"lendario",price:1200,icon:"ğŸª„",bonus:{sabedoria:3,inteligencia:4},currency:"arcaneEssence"},{id:"cajado-luz",name:"Cajado da Luz",description:"BÃ¡sico; concede magias de cura. +2 Sabedoria, +1 ConstituiÃ§Ã£o",type:"weapon",rarity:"comum",price:90,icon:"âœ¨",bonus:{sabedoria:2,constituicao:1}},{id:"cajado-fe-duas-maos",name:"Cajado de Duas MÃ£os da FÃ©",description:"Amplia bÃªnÃ§Ã£os. +3 Sabedoria, +1 ConstituiÃ§Ã£o",type:"weapon",rarity:"raro",price:240,icon:"ğŸª„",bonus:{sabedoria:3,constituicao:1}},{id:"maca-devoto",name:"MaÃ§a do Devoto",description:"Aumenta cura e resistÃªncia. +2 ForÃ§a, +2 Sabedoria",type:"weapon",rarity:"raro",price:250,icon:"ğŸ”¨",bonus:{forca:2,sabedoria:2}},{id:"cajado-divino",name:"Cajado Divino",description:"Chance de curar aliados ao atacar. +4 Sabedoria, +2 ConstituiÃ§Ã£o",type:"weapon",rarity:"epico",price:520,icon:"âœ¨",bonus:{sabedoria:4,constituicao:2},currency:"glory"},{id:"reliquia-sagrada",name:"RelÃ­quia Sagrada",description:"Aura protetora. +3 Sabedoria, +3 ConstituiÃ§Ã£o",type:"weapon",rarity:"lendario",price:1100,icon:"â›ª",bonus:{sabedoria:3,constituicao:3},currency:"arcaneEssence"},{id:"alaude-carvalho",name:"AlaÃºde de Carvalho",description:"BÃ¡sico; melhora a moral do grupo. +1 Carisma, +1 Sabedoria",type:"weapon",rarity:"comum",price:80,icon:"ğŸ¸",bonus:{carisma:1,sabedoria:1}},{id:"alaude-cristal",name:"AlaÃºde de Cristal",description:"Amplifica habilidades musicais. +2 Carisma, +2 Sabedoria",type:"weapon",rarity:"raro",price:220,icon:"ğŸ¸",bonus:{carisma:2,sabedoria:2}},{id:"harpa-prata",name:"Harpa de Prata",description:"Magia sonora de cura e buffs. +2 Sabedoria, +2 Carisma",type:"weapon",rarity:"epico",price:420,icon:"ğŸµ",bonus:{sabedoria:2,carisma:2}},{id:"tambor-guerra",name:"Tambor de Guerra",description:"BÃ´nus de ataque e defesa em grupo. +3 Carisma, +2 ConstituiÃ§Ã£o",type:"weapon",rarity:"epico",price:520,icon:"ğŸ¥",bonus:{carisma:3,constituicao:2},currency:"glory"},{id:"alaude-lendas",name:"AlaÃºde das Lendas",description:"LendÃ¡rio; multiplica inspiraÃ§Ã£o. +4 Carisma, +3 Sabedoria",type:"weapon",rarity:"lendario",price:1100,icon:"ğŸ¸",bonus:{carisma:4,sabedoria:3},currency:"arcaneEssence"},{id:"bastao-madeira",name:"BastÃ£o de Madeira",description:"BÃ¡sico; equilÃ­brio ataque/defesa. +2 Destreza, +1 ConstituiÃ§Ã£o",type:"weapon",rarity:"comum",price:90,icon:"ğŸ¥‹",bonus:{destreza:2,constituicao:1}},{id:"lanca-vento",name:"LanÃ§a do Vento",description:"Ataques em Ã¡rea e longo alcance. +3 Destreza, +2 ConstituiÃ§Ã£o",type:"weapon",rarity:"raro",price:260,icon:"ğŸ—¡ï¸",bonus:{destreza:3,constituicao:2}},{id:"naginata",name:"Naginata",description:"Arma hÃ­brida; bÃ´nus em esquiva. +4 Destreza, +1 ForÃ§a",type:"weapon",rarity:"raro",price:280,icon:"ğŸ—¡ï¸",bonus:{destreza:4,forca:1}},{id:"punhos-ferro",name:"Punhos de Ferro",description:"Estilo corpo a corpo puro. +3 Destreza, +1 ForÃ§a",type:"weapon",rarity:"comum",price:120,icon:"ğŸ‘Š",bonus:{destreza:3,forca:1}},{id:"bastao-dragao",name:"BastÃ£o do DragÃ£o",description:"LendÃ¡rio; canaliza energia espiritual. +3 Destreza, +4 Sabedoria",type:"weapon",rarity:"lendario",price:1200,icon:"ğŸ²",bonus:{destreza:3,sabedoria:4},currency:"arcaneEssence"},{id:"peitoral-couro-leve",name:"Peitoral de Couro Leve",description:"ProteÃ§Ã£o Ã¡gil. +2 ConstituiÃ§Ã£o, +1 Destreza",type:"armor",rarity:"comum",price:75,icon:"ğŸ›¡ï¸",bonus:{constituicao:2,destreza:1},slot:"chest"},{id:"tunica-estudioso",name:"TÃºnica do Estudioso",description:"Favorece o estudo arcano. +1 ConstituiÃ§Ã£o, +2 InteligÃªncia",type:"armor",rarity:"comum",price:70,icon:"ğŸª¶",bonus:{constituicao:1,inteligencia:2},slot:"chest"},{id:"armadura-novato",name:"Armadura do Novato",description:"ProteÃ§Ã£o bÃ¡sica para quem estÃ¡ comeÃ§ando. +3 ConstituiÃ§Ã£o",type:"armor",rarity:"comum",price:100,icon:"ğŸ¥‹",bonus:{constituicao:3},slot:"chest"},{id:"armadura-couro",name:"Armadura de Couro",description:"ProteÃ§Ã£o bÃ¡sica de couro curtido. +2 ConstituiÃ§Ã£o",type:"armor",rarity:"comum",price:75,icon:"ğŸ¦º",bonus:{constituicao:2},slot:"chest"},{id:"armadura-cota",name:"Cota de Malha",description:"Armadura de anÃ©is entrelaÃ§ados. +4 ConstituiÃ§Ã£o",type:"armor",rarity:"raro",price:200,icon:"ğŸ›¡ï¸",bonus:{constituicao:4},slot:"chest"},{id:"armadura-placas",name:"Armadura de Placas",description:"ProteÃ§Ã£o mÃ¡xima em placas de aÃ§o. +6 ConstituiÃ§Ã£o, -1 Destreza",type:"armor",rarity:"epico",price:500,icon:"ğŸ›¡ï¸",bonus:{constituicao:6,destreza:-1},slot:"chest",currency:"glory"},{id:"armadura-couro-tachas",name:"Armadura de Couro com Tachas",description:"Couro reforÃ§ado com tachas metÃ¡licas. +3 ConstituiÃ§Ã£o, +1 Destreza",type:"armor",rarity:"raro",price:180,icon:"ğŸ¦º",bonus:{constituicao:3,destreza:1}},{id:"gibao-elfico",name:"GibÃ£o Ã‰lfico",description:"Armadura Ã©lfica leve e flexÃ­vel. +2 ConstituiÃ§Ã£o, +3 Destreza",type:"armor",rarity:"epico",price:420,icon:"ğŸ¦º",bonus:{constituicao:2,destreza:3},slot:"chest",setId:"elfico"},{id:"armadura-ferro",name:"Armadura de Ferro",description:"PadrÃ£o entre os guardas da cidade. +4 ConstituiÃ§Ã£o",type:"armor",rarity:"comum",price:120,icon:"ğŸ›¡ï¸",bonus:{constituicao:4},slot:"chest"},{id:"manto-arcano",name:"Manto Arcano",description:"Bordado com sÃ­mbolos antigos. +1 ConstituiÃ§Ã£o, +3 InteligÃªncia",type:"armor",rarity:"raro",price:220,icon:"ğŸª„",bonus:{constituicao:1,inteligencia:3},slot:"cape",setId:"arcanista"},{id:"armadura-cacador",name:"Armadura do CaÃ§ador",description:"Perfeita para quem caÃ§a monstros nas sombras. +2 ConstituiÃ§Ã£o, +3 Destreza",type:"armor",rarity:"raro",price:260,icon:"ğŸ¦º",bonus:{constituicao:2,destreza:3},slot:"chest"},{id:"armadura-escamas",name:"Armadura de Escamas",description:"Forjada a partir de escamas de draco. +4 ConstituiÃ§Ã£o, +2 Sabedoria",type:"armor",rarity:"raro",price:320,icon:"ğŸ›¡ï¸",bonus:{constituicao:4,sabedoria:2},slot:"chest"},{id:"cota-sagrada",name:"Cota Sagrada",description:"ImbuÃ­da com bÃªnÃ§Ã£os divinas. +4 ConstituiÃ§Ã£o, +3 Sabedoria",type:"armor",rarity:"epico",price:520,icon:"ğŸ›¡ï¸",bonus:{constituicao:4,sabedoria:3},slot:"chest",currency:"glory",setId:"aurora"},{id:"armadura-cristal",name:"Armadura de Cristal",description:"Reflete tanto luz quanto feitiÃ§os. +5 ConstituiÃ§Ã£o, +3 Sabedoria",type:"armor",rarity:"epico",price:560,icon:"ğŸ§¿",bonus:{constituicao:5,sabedoria:3},slot:"chest",currency:"glory"},{id:"vestes-arcanista",name:"Vestes do Arcanista",description:"Brilha suavemente sob a lua. +2 ConstituiÃ§Ã£o, +6 InteligÃªncia",type:"armor",rarity:"epico",price:600,icon:"ğŸª„",bonus:{constituicao:2,inteligencia:6},slot:"chest",currency:"arcaneEssence",setId:"arcanista"},{id:"armadura-dragao-anciao",name:"Armadura do DragÃ£o AnciÃ£o",description:"Forjada das escamas de um dragÃ£o lendÃ¡rio. BÃ´nus temÃ¡ticos de resistÃªncia e XP.",type:"armor",rarity:"lendario",price:1400,icon:"ğŸ›¡ï¸",bonus:{constituicao:8,sabedoria:4},slot:"chest",currency:"arcaneEssence",setId:"eterno"},{id:"armadura-couro-reforcado",name:"Armadura de Couro ReforÃ§ado",description:"Couro reforÃ§ado para iniciantes. +3 ConstituiÃ§Ã£o, +1 Destreza",type:"armor",rarity:"comum",price:110,icon:"ğŸ¦º",bonus:{constituicao:3,destreza:1},slot:"chest"},{id:"cota-malha-abencoada",name:"Cota de Malha AbenÃ§oada",description:"ProteÃ§Ã£o com bÃªnÃ§Ã£os leves. +4 ConstituiÃ§Ã£o, +1 Sabedoria",type:"armor",rarity:"raro",price:280,icon:"ğŸ›¡ï¸",bonus:{constituicao:4,sabedoria:1},slot:"chest"},{id:"platina-imperial",name:"Platina Imperial",description:"Placas imperiais. +6 ConstituiÃ§Ã£o, +1 Carisma",type:"armor",rarity:"epico",price:560,icon:"ğŸ›¡ï¸",bonus:{constituicao:6,carisma:1},slot:"chest",currency:"glory"},{id:"tunica-couro",name:"TÃºnica de Couro",description:"Leve e prÃ¡tica. +2 ConstituiÃ§Ã£o, +1 Destreza",type:"armor",rarity:"comum",price:90,icon:"ğŸ¦º",bonus:{constituicao:2,destreza:1},slot:"chest"},{id:"roupa-sombras",name:"Roupa das Sombras",description:"Feita para discriÃ§Ã£o. +3 Destreza, +1 InteligÃªncia",type:"armor",rarity:"raro",price:240,icon:"ğŸ¦º",bonus:{destreza:3,inteligencia:1},slot:"chest"},{id:"traje-viajante",name:"Traje do Viajante",description:"ConfortÃ¡vel para longas jornadas. +2 Destreza, +1 ConstituiÃ§Ã£o",type:"armor",rarity:"comum",price:120,icon:"ğŸ¦º",bonus:{destreza:2,constituicao:1},slot:"chest"},{id:"veste-bardo-errante",name:"Veste do Bardo Errante",description:"Cativa multidÃµes. +2 Destreza, +2 Carisma",type:"armor",rarity:"raro",price:260,icon:"ğŸª¶",bonus:{destreza:2,carisma:2},slot:"chest"},{id:"roupas-celestes-monge",name:"Roupas Celestes do Monge",description:"LendÃ¡ria; leve e espiritual. +3 Destreza, +3 Sabedoria",type:"armor",rarity:"lendario",price:900,icon:"ğŸ¥‹",bonus:{destreza:3,sabedoria:3},slot:"chest",currency:"arcaneEssence"},{id:"veste-arcana",name:"Veste Arcana",description:"Favorece o estudo arcano. +1 ConstituiÃ§Ã£o, +4 InteligÃªncia",type:"armor",rarity:"raro",price:300,icon:"ğŸª„",bonus:{constituicao:1,inteligencia:4},slot:"chest"},{id:"manto-seda-espiritual",name:"Manto de Seda Espiritual",description:"Sereno e protetor. +2 Sabedoria, +1 ConstituiÃ§Ã£o",type:"armor",rarity:"raro",price:280,icon:"ğŸª„",bonus:{sabedoria:2,constituicao:1},slot:"chest"},{id:"tunica-sol",name:"TÃºnica do Sol",description:"Banho de luz. +2 ConstituiÃ§Ã£o, +4 Sabedoria",type:"armor",rarity:"epico",price:520,icon:"ğŸª„",bonus:{constituicao:2,sabedoria:4},slot:"chest",currency:"glory"},{id:"roupas-sabio-eterno",name:"Roupas do SÃ¡bio Eterno",description:"Sabedoria acumulada. +2 ConstituiÃ§Ã£o, +5 InteligÃªncia",type:"armor",rarity:"epico",price:560,icon:"ğŸª„",bonus:{constituicao:2,inteligencia:5},slot:"chest",currency:"glory"},{id:"manto-eternidade",name:"Manto da Eternidade",description:"LendÃ¡rio; protege contra o esquecimento. +3 ConstituiÃ§Ã£o, +6 InteligÃªncia",type:"armor",rarity:"lendario",price:1200,icon:"ğŸª„",bonus:{constituicao:3,inteligencia:6},slot:"cape",currency:"arcaneEssence"},{id:"capacete-ferro",name:"Capacete de Ferro",description:"Protege a cabeÃ§a com firmeza. +1 ConstituiÃ§Ã£o",type:"armor",rarity:"comum",price:90,icon:"ğŸª–",bonus:{constituicao:1},slot:"helm"},{id:"elmo-guardiao",name:"Elmo do GuardiÃ£o",description:"BÃªnÃ§Ã£os leves e proteÃ§Ã£o sÃ³lida. +2 ConstituiÃ§Ã£o, +1 Sabedoria",type:"armor",rarity:"raro",price:220,icon:"ğŸª–",bonus:{constituicao:2,sabedoria:1},slot:"helm"},{id:"cinto-couro",name:"Cinto de Couro",description:"Suporte bÃ¡sico. +1 Destreza",type:"armor",rarity:"comum",price:70,icon:"ğŸ§µ",bonus:{destreza:1},slot:"belt"},{id:"cinto-gladiador",name:"Cinto do Gladiador",description:"Firmeza no centro. +2 ForÃ§a",type:"armor",rarity:"raro",price:180,icon:"ğŸ§¶",bonus:{forca:2},slot:"belt"},{id:"luvas-couro",name:"Luvas de Couro",description:"Aprimora a pegada. +1 Destreza",type:"armor",rarity:"comum",price:60,icon:"ğŸ§¤",bonus:{destreza:1},slot:"gloves"},{id:"luvas-runicas",name:"Luvas RÃºnicas",description:"InscriÃ§Ãµes arcanas. +2 Destreza, +1 InteligÃªncia",type:"armor",rarity:"epico",price:320,icon:"ğŸ§¤",bonus:{destreza:2,inteligencia:1},slot:"gloves"},{id:"botas-caminhante",name:"Botas do Caminhante",description:"ConfortÃ¡veis para longas viagens. +1 Destreza, +1 ConstituiÃ§Ã£o",type:"armor",rarity:"comum",price:90,icon:"ğŸ‘¢",bonus:{destreza:1,constituicao:1},slot:"boots"},{id:"botas-velozes",name:"Botas Velozes",description:"Passos rÃ¡pidos e precisos. +2 Destreza",type:"armor",rarity:"raro",price:200,icon:"ğŸ‘¢",bonus:{destreza:2},slot:"boots"},{id:"capa-iniciante",name:"Capa do Iniciante",description:"ProteÃ§Ã£o leve e estilo bÃ¡sico. +1 Destreza",type:"armor",rarity:"comum",price:60,icon:"ğŸ§¥",bonus:{destreza:1},slot:"cape"},{id:"capa-aventura",name:"Capa da Aventura",description:"Ideal para exploradores. +2 Destreza, +1 ConstituiÃ§Ã£o",type:"armor",rarity:"raro",price:180,icon:"ğŸ§¥",bonus:{destreza:2,constituicao:1},slot:"cape"},{id:"capa-heroi",name:"Capa do HerÃ³i",description:"Ecoa histÃ³rias Ã©picas. +3 Destreza, +2 Sabedoria",type:"armor",rarity:"epico",price:420,icon:"ğŸ§¥",bonus:{destreza:3,sabedoria:2},slot:"cape"},{id:"asas-lendarias",name:"Asas LendÃ¡rias",description:"Voos mÃ­ticos. +4 Destreza, +2 InteligÃªncia, +1 Sabedoria",type:"armor",rarity:"lendario",price:900,icon:"ğŸª½",bonus:{destreza:4,inteligencia:2,sabedoria:1},slot:"cape",currency:"arcaneEssence"},{id:"anel-forca",name:"Anel da ForÃ§a",description:"Anel mÃ¡gico que aumenta a forÃ§a fÃ­sica. +2 ForÃ§a",type:"accessory",rarity:"raro",price:150,icon:"ğŸ’",bonus:{forca:2},slot:"ring"},{id:"amuleto-sabedoria",name:"Amuleto da Sabedoria",description:"Amuleto Ã©lfico que clareia a mente. +3 Sabedoria",type:"accessory",rarity:"raro",price:180,icon:"ğŸ”®",bonus:{sabedoria:3},slot:"necklace",currency:"arcaneEssence",setId:"arcanista"},{id:"colar-carisma",name:"Colar do Carisma",description:"Joia encantada que aumenta o charme. +3 Carisma",type:"accessory",rarity:"epico",price:300,icon:"ğŸ“¿",bonus:{carisma:3},slot:"necklace"},{id:"aljava-encantada",name:"Aljava Encantada",description:"Aljava mÃ¡gica que melhora a precisÃ£o. +2 Destreza, +1 Sabedoria",type:"accessory",rarity:"raro",price:200,icon:"ğŸ¹",bonus:{destreza:2,sabedoria:1},currency:"arcaneEssence"},{id:"bracadeira-arqueiro",name:"BraÃ§adeira do Arqueiro",description:"ProteÃ§Ã£o para o braÃ§o que saca a corda. +3 Destreza",type:"accessory",rarity:"raro",price:160,icon:"ğŸ›¡ï¸",bonus:{destreza:3},setId:"elfico"},{id:"anel-precisao",name:"Anel da PrecisÃ£o",description:"Anel que aprimora a mira. +2 Destreza, +1 InteligÃªncia",type:"accessory",rarity:"epico",price:280,icon:"ğŸ’",bonus:{destreza:2,inteligencia:1},slot:"ring",setId:"elfico"},{id:"anel-aventureiro",name:"Anel do Aventureiro",description:"+5% XP recebido (temÃ¡tico)",type:"accessory",rarity:"raro",price:120,icon:"ğŸ’",slot:"ring"},{id:"pingente-sorte",name:"Pingente da Sorte",description:"Chance de evitar armadilhas em masmorras",type:"accessory",rarity:"raro",price:150,icon:"ğŸ“¿",slot:"necklace"},{id:"brincos-eco",name:"Brincos do Eco",description:"+1 em todos os atributos por 10 minutos",type:"accessory",rarity:"epico",price:200,icon:"ğŸ””",bonus:{forca:1,destreza:1,constituicao:1,inteligencia:1,sabedoria:1,carisma:1},effects:{duration:10},slot:"earring"},{id:"amuleto-brisa",name:"Amuleto da Brisa",description:"+2 Defesa MÃ¡gica / +10% velocidade em masmorras (temÃ¡tico)",type:"accessory",rarity:"raro",price:120,icon:"ğŸª¶"},{id:"anel-bronze",name:"Anel de Bronze",description:"Um simples anel de sorte. +1 Sabedoria",type:"accessory",rarity:"comum",price:60,icon:"ğŸ’",bonus:{sabedoria:1},slot:"ring"},{id:"colar-madeira",name:"Colar de Madeira",description:"Amuleto de proteÃ§Ã£o bÃ¡sica. +1 ConstituiÃ§Ã£o",type:"accessory",rarity:"comum",price:60,icon:"ğŸ“¿",bonus:{constituicao:1},slot:"necklace"},{id:"amuleto-vitalidade",name:"Amuleto da Vitalidade",description:"Energiza o corpo e a alma. Aumenta a vitalidade.",type:"accessory",rarity:"raro",price:240,icon:"ğŸ“¿",bonus:{constituicao:3},slot:"necklace"},{id:"anel-precisao-raro",name:"Anel de PrecisÃ£o",description:"Ideal para arqueiros e assassinos. BÃ´nus temÃ¡tico de crÃ­tico.",type:"accessory",rarity:"raro",price:220,icon:"ğŸ’",bonus:{destreza:2},slot:"ring"},{id:"medalhao-guardiao",name:"MedalhÃ£o do GuardiÃ£o",description:"Carrega uma prece antiga. +2 ConstituiÃ§Ã£o, +3 Sabedoria",type:"accessory",rarity:"raro",price:260,icon:"ğŸ“¿",bonus:{constituicao:2,sabedoria:3},slot:"necklace",setId:"aurora"},{id:"anel-furia",name:"Anel da FÃºria",description:"Libera um poder destrutivo, a um custo. +5 ForÃ§a, -2 ConstituiÃ§Ã£o",type:"accessory",rarity:"epico",price:380,icon:"ğŸ’",bonus:{forca:5,constituicao:-2},slot:"ring"},{id:"colar-equilibrio",name:"Colar do EquilÃ­brio",description:"Harmoniza corpo e mente. +3 ForÃ§a, +3 ConstituiÃ§Ã£o",type:"accessory",rarity:"epico",price:400,icon:"ğŸ“¿",bonus:{forca:3,constituicao:3},slot:"necklace"},{id:"amuleto-tempo",name:"Amuleto do Tempo",description:"Manipula o tempo a seu favor. BÃ´nus temÃ¡tico de velocidade/XP.",type:"accessory",rarity:"lendario",price:900,icon:"âŒ›",bonus:{destreza:3,carisma:2},slot:"necklace",currency:"arcaneEssence"},{id:"anel-eternidade",name:"Anel da Eternidade",description:"SÃ­mbolo da imortalidade dos verdadeiros herÃ³is. BÃ´nus temÃ¡tico de crÃ­tico/espÃ­rito.",type:"accessory",rarity:"lendario",price:1100,icon:"ğŸ’",bonus:{sabedoria:5,destreza:3},slot:"ring",currency:"arcaneEssence",setId:"eterno"},{id:"anel-vitalidade",name:"Anel da Vitalidade",description:"+HP (representado por ConstituiÃ§Ã£o). +3 ConstituiÃ§Ã£o",type:"accessory",rarity:"raro",price:220,icon:"ğŸ’",bonus:{constituicao:3},slot:"ring"},{id:"anel-foco-arcano",name:"Anel do Foco Arcano",description:"+Mana (representado por InteligÃªncia). +3 InteligÃªncia",type:"accessory",rarity:"raro",price:240,icon:"ğŸ’",bonus:{inteligencia:3},slot:"ring"},{id:"colar-viajante",name:"Colar do Viajante",description:"Velocidade e leveza. +2 Destreza",type:"accessory",rarity:"raro",price:200,icon:"ğŸ“¿",bonus:{destreza:2},slot:"necklace"},{id:"bracelete-gladiador",name:"Bracelete do Gladiador",description:"Poder do arena. +3 ForÃ§a",type:"accessory",rarity:"raro",price:240,icon:"ğŸ›¡ï¸",bonus:{forca:3},slot:"ring"},{id:"amuleto-cura",name:"Amuleto da Cura",description:"Restaura HP gradualmente (temÃ¡tico). +2 ConstituiÃ§Ã£o",type:"accessory",rarity:"epico",price:420,icon:"ğŸ“¿",bonus:{constituicao:2},slot:"necklace",currency:"glory"},{id:"anel-destreza",name:"Anel da Destreza",description:"Aprimora chances de crÃ­tico (temÃ¡tico). +2 Destreza",type:"accessory",rarity:"raro",price:220,icon:"ğŸ’",bonus:{destreza:2},slot:"ring"},{id:"colar-inspiracao",name:"Colar da InspiraÃ§Ã£o",description:"Perfeito para bardos e clÃ©rigos. +3 Carisma, +1 Sabedoria",type:"accessory",rarity:"epico",price:400,icon:"ğŸ“¿",bonus:{carisma:3,sabedoria:1},slot:"necklace"},{id:"pingente-resistencia",name:"Pingente da ResistÃªncia",description:"ProteÃ§Ã£o arcana. +2 Sabedoria",type:"accessory",rarity:"raro",price:240,icon:"ğŸ“¿",bonus:{sabedoria:2},slot:"necklace"},{id:"anel-tempestade",name:"Anel da Tempestade",description:"Chance de relÃ¢mpago (temÃ¡tico). +2 Destreza, +1 InteligÃªncia",type:"accessory",rarity:"epico",price:420,icon:"ğŸ’",bonus:{destreza:2,inteligencia:1},slot:"ring",currency:"glory"},{id:"simbolo-luz",name:"SÃ­mbolo da Luz",description:"Reduz dano das trevas (temÃ¡tico). +2 Sabedoria, +1 ConstituiÃ§Ã£o",type:"accessory",rarity:"raro",price:260,icon:"âœï¸",bonus:{sabedoria:2,constituicao:1},slot:"necklace"},{id:"capa-vermelha",name:"Capa Vermelha",description:"Capa elegante de cor carmesim. Puramente cosmÃ©tica.",type:"cosmetic",rarity:"comum",price:50,icon:"ğŸ§¥"},{id:"coroa-ouro",name:"Coroa de Ouro",description:"Coroa dourada para verdadeiros lÃ­deres. CosmÃ©tica.",type:"cosmetic",rarity:"lendario",price:1e3,icon:"ğŸ‘‘"},{id:"mascara-sombras",name:"MÃ¡scara das Sombras",description:"MÃ¡scara misteriosa para herÃ³is discretos. CosmÃ©tica.",type:"cosmetic",rarity:"epico",price:200,icon:"ğŸ­"},{id:"moldura-dourada",name:"Moldura Dourada",description:"Visual desbloqueÃ¡vel por XP (temÃ¡tico)",type:"cosmetic",rarity:"raro",price:300,icon:"ğŸŸ¨"},{id:"moldura-real",name:"Moldura Real",description:"Visual de prestÃ­gio por rank (temÃ¡tico)",type:"cosmetic",rarity:"epico",price:600,icon:"ğŸ‘‘"},{id:"reliquia-brilho-eterno",name:"RelÃ­quia do Brilho Eterno",description:"Artefato antigo que conta histÃ³rias de herÃ³is esquecidos.",type:"material",rarity:"epico",price:0,icon:"ğŸ•¯ï¸"},{id:"reliquia-contos-sussurrados",name:"RelÃ­quia dos Contos Sussurrados",description:"Ao tocÃ¡-la, ouvem-se vozes narrando aventuras.",type:"material",rarity:"raro",price:0,icon:"ğŸ“œ"},{id:"coroa-quebrada",name:"Coroa Quebrada do Rei Goblin",description:"Fragmento que testemunha uma ascensÃ£o e queda.",type:"material",rarity:"raro",price:0,icon:"ğŸ‘‘"},{id:"fundo-aurora",name:"Fundo Aurora",description:"Visual por reputaÃ§Ã£o (temÃ¡tico)",type:"cosmetic",rarity:"raro",price:350,icon:"ğŸŒŒ"},{id:"nucleo-mana-menor",name:"NÃºcleo Menor de Mana",description:"EssÃªncia bruta para forjas e encantamentos. NÃ£o consumÃ­vel.",type:"material",rarity:"comum",price:40,icon:"ğŸ”·"},{id:"nucleo-mana",name:"NÃºcleo de Mana",description:"NÃºcleo usado em encantamentos e forjas. NÃ£o consumÃ­vel.",type:"material",rarity:"raro",price:90,icon:"ğŸ”·"},{id:"nucleo-mana-raro",name:"NÃºcleo Raro de Mana",description:"NÃºcleo refinado para obras complexas. NÃ£o consumÃ­vel.",type:"material",rarity:"epico",price:220,icon:"ğŸ”·"},{id:"nucleo-ancestral",name:"NÃºcleo Ancestral",description:"NÃºcleo lendÃ¡rio usado em obras-primas. NÃ£o consumÃ­vel.",type:"material",rarity:"lendario",price:500,icon:"ğŸ”¶"},{id:"pele-lobo-sombrio",name:"Pele de Lobo Sombrio",description:"Material obtido em caÃ§adas. Usado para reforÃ§ar armaduras leves.",type:"material",rarity:"comum",price:25,icon:"ğŸº"},{id:"colmilho-vampirico",name:"Colmilho VampÃ­rico",description:"Parte rara de monstros noturnos. Ãštil em forjas sombrias.",type:"material",rarity:"raro",price:80,icon:"ğŸ§›"},{id:"osso-antigo",name:"Osso Antigo",description:"Osso resistente de criatura ancestral. Componente de armaduras.",type:"material",rarity:"raro",price:70,icon:"ğŸ¦´"},{id:"erva-sangue",name:"Erva de Sangue",description:"Planta vermelha usada por curandeiros em poÃ§Ãµes de vida.",type:"material",rarity:"comum",price:20,icon:"ğŸŒ¿"},{id:"essencia-lunar",name:"EssÃªncia Lunar",description:"EssÃªncia rara coletada em clareiras sob lua cheia.",type:"material",rarity:"raro",price:120,icon:"ğŸŒ™"},{id:"cristal-runico",name:"Cristal RÃºnico",description:"Cristal com inscriÃ§Ãµes arcanas, usado em encantamentos.",type:"material",rarity:"epico",price:220,icon:"ğŸ”·"},{id:"pergaminho-protecao",name:"Pergaminho de ProteÃ§Ã£o",description:"Aumenta a resistÃªncia a dano por 20 minutos.",type:"consumable",rarity:"raro",price:140,icon:"ğŸ“œ",effects:{duration:20}},{id:"pergaminho-velocidade",name:"Pergaminho de Velocidade",description:"Agilidade temporÃ¡ria para escoltas e evasÃ£o (20 min).",type:"consumable",rarity:"raro",price:140,icon:"ğŸ“œ",effects:{duration:20}},{id:"lamina-alpha",name:"LÃ¢mina Alpha",description:"Forjada do lÃ­der da alcateia. +4 ForÃ§a, +3 Destreza",type:"weapon",rarity:"epico",price:620,icon:"ğŸ—¡ï¸",bonus:{forca:4,destreza:3}},{id:"armadura-pedra-rachada",name:"Armadura de Pedra Rachada",description:"ResÃ­duo de golem, pesado e protetor. +6 ConstituiÃ§Ã£o",type:"armor",rarity:"epico",price:640,icon:"ğŸ›¡ï¸",bonus:{constituicao:6}},{id:"pedra-alma",name:"Pedra de Alma",description:"Canaliza energia para evoluÃ§Ã£o de mascotes.",type:"material",rarity:"raro",price:180,icon:"ğŸª¨"},{id:"pedra-magica",name:"Pedra MÃ¡gica",description:"Usada para refinar mascotes e montarias (+1% por nÃ­vel).",type:"material",rarity:"raro",price:220,icon:"ğŸ”·"},{id:"pergaminho-montaria",name:"Pergaminho de Montaria",description:"Permite evoluir a montaria para o prÃ³ximo estÃ¡gio.",type:"material",rarity:"epico",price:400,icon:"ğŸ“œ"},{id:"essencia-bestial",name:"EssÃªncia Bestial",description:"EssÃªncia rara necessÃ¡ria para montarias lendÃ¡rias.",type:"material",rarity:"lendario",price:800,icon:"ğŸ§¬"},{id:"carne-selvagem",name:"Carne Selvagem",description:"Comida para treinar mascotes (+50 XP).",type:"consumable",rarity:"comum",price:30,icon:"ğŸ–"},{id:"peixe-mistico",name:"Peixe MÃ­stico",description:"Comida rara para mascotes (+120 XP).",type:"consumable",rarity:"raro",price:90,icon:"ğŸŸ"},{id:"frutas-rubras",name:"Frutas Rubras",description:"Comida doce para mascotes (+80 XP).",type:"consumable",rarity:"incomum",price:50,icon:"ğŸ"},{id:"essencia-calor",name:"EssÃªncia de Calor",description:"Acelera incubaÃ§Ã£o de ovos (-15min).",type:"material",rarity:"raro",price:100,icon:"ğŸ”¥"},{id:"brasas-magicas",name:"Brasas MÃ¡gicas",description:"Acelera incubaÃ§Ã£o de ovos (-1h).",type:"material",rarity:"epico",price:160,icon:"â™¨ï¸"},{id:"racao-basica",name:"RaÃ§Ã£o BÃ¡sica",description:"Comida comum para mascotes (+50 XP).",type:"consumable",rarity:"comum",price:25,icon:"ğŸ–"},{id:"racao-deluxe",name:"RaÃ§Ã£o Deluxe",description:"Comida premium para mascotes (+150 XP).",type:"consumable",rarity:"raro",price:120,icon:"ğŸ—"},{id:"essencia-vinculo",name:"EssÃªncia de VÃ­nculo",description:"Refina o vÃ­nculo com mascotes/montarias (+1%).",type:"material",rarity:"raro",price:220,icon:"ğŸŒ€"}],Do=(()=>{const a={};for(const s of Ee)a[s.id]=s;return a})(),$t={consumables:{name:"ConsumÃ­veis",icon:"ğŸ§ª",items:Ee.filter(a=>a.type==="consumable")},weapons:{name:"Armas",icon:"âš”ï¸",items:Ee.filter(a=>a.type==="weapon")},armor:{name:"Armaduras",icon:"ğŸ›¡ï¸",items:Ee.filter(a=>a.type==="armor")},accessories:{name:"AcessÃ³rios",icon:"ğŸ’",items:Ee.filter(a=>a.type==="accessory")},cosmetics:{name:"CosmÃ©ticos",icon:"ğŸ‘‘",items:Ee.filter(a=>a.type==="cosmetic")}},Gi={comum:{color:"#9CA3AF",bgColor:"#F3F4F6",multiplier:1},incomum:{color:"#10B981",bgColor:"#ECFDF5",multiplier:1.3},raro:{color:"#3B82F6",bgColor:"#EFF6FF",multiplier:1.6},epico:{color:"#8B5CF6",bgColor:"#F5F3FF",multiplier:2},lendario:{color:"#F59E0B",bgColor:"#FFFBEB",multiplier:3}},$o={arcanista:{name:"Conjunto Arcanista",bonus:{inteligencia:2,sabedoria:1}},aurora:{name:"Conjunto Aurora",bonus:{forca:2,sabedoria:2}},elfico:{name:"Conjunto Ã‰lfico do Arqueiro",bonus:{destreza:2,sabedoria:1}},eterno:{name:"Conjunto do Ãšltimo HerÃ³i",bonus:{forca:3,carisma:1,sabedoria:1}}};function yr(a,s){const t=s.currency||"gold",r=a.progression,i=t==="gold"?r.gold||0:t==="glory"?r.glory||0:r.arcaneEssence||0,n=Fa(s,a);return i>=n}function bs(a,s){const t=Ee.find(d=>d.id===s);if(!t)return{success:!1,message:"Item nÃ£o encontrado na loja!"};if(!yr(a,t)){const d=t.currency||"gold",m=a.progression,u=d==="gold"?m.gold||0:d==="glory"?m.glory||0:m.arcaneEssence||0,p=d==="gold"?"ouro":d==="glory"?"glÃ³ria":"essÃªncia arcana";return{success:!1,message:`${p.charAt(0).toUpperCase()+p.slice(1)} insuficiente! VocÃª precisa de ${Fa(t,a)} ${p}, mas tem apenas ${u}.`}}if(t.type!=="consumable"&&(a.inventory.items[s]||0)>0&&(t.type==="weapon"||t.type==="armor"||t.type==="accessory"))return{success:!1,message:"VocÃª jÃ¡ possui este equipamento!"};const r=t.currency||"gold",i=a.progression,n=r==="gold"?i.gold||0:r==="glory"?i.glory||0:i.arcaneEssence||0,o=Fa(t,a),c=n-o,l=r==="gold"?"ouro":r==="glory"?"glÃ³ria":"essÃªncia arcana";return{success:!0,message:`${t.name} comprado com sucesso! (-${o} ${l})`,newGold:r==="gold"?c:void 0,currency:r,newBalance:c,item:t}}function _o(a,s,t=1){const r=Ee.find(o=>o.id===s),i=a.inventory.items[s]||0;if(!r)return{success:!1,message:"Item nÃ£o encontrado!"};if(i<t)return{success:!1,message:`VocÃª nÃ£o possui ${t}x ${r.name}!`};const n=Math.floor(r.price*.6*t);return{success:!0,message:`${t}x ${r.name} vendido por ${n} ouro!`,newGold:a.progression.gold+n,item:r}}function qo(a,s){const t=Do[s]||Ee.find(l=>l.id===s),r=(a.inventory.items[s]||0)>0;if(!t||!r)return{success:!1,message:"VocÃª nÃ£o possui este item!"};if(t.type==="consumable"||t.type==="cosmetic")return{success:!1,message:"Este item nÃ£o pode ser equipado!"};if(t.requirements){const l=t.requirements.minLevel||0;if((a.progression.level||a.level||1)<l)return{success:!1,message:`Requer nÃ­vel ${l}`};const d=t.requirements.classAllow,m=t.requirements.classDeny;if(d&&d.length>0&&!d.includes(a.class))return{success:!1,message:"Classe incompatÃ­vel para este item"};if(m&&m.length>0&&m.includes(a.class))return{success:!1,message:"Sua classe nÃ£o pode usar este item"}}const i=a.inventory,o=(()=>{if(t.type==="weapon")return(t.slot==="offHand"?"offHand":"mainHand")==="mainHand"?i.equippedMainHand?i.equippedOffHand?null:"offHand":"mainHand":i.equippedOffHand?i.equippedMainHand?null:"mainHand":"offHand";if(t.type==="armor"){const l=t.slot;return l==="helm"&&!i.equippedHelm?"helm":l==="chest"&&!i.equippedChest?"chest":l==="belt"&&!i.equippedBelt?"belt":l==="gloves"&&!i.equippedGloves?"gloves":l==="boots"&&!i.equippedBoots?"boots":l==="cape"&&!i.equippedCape?"cape":l||i.equippedChest?null:"chest"}if(t.type==="accessory"){const l=t.slot;return l==="necklace"&&!i.equippedNecklace?"necklace":l==="ring"?i.equippedRingLeft?i.equippedRingRight?null:"ringRight":"ringLeft":l==="earring"?i.equippedEarringLeft?i.equippedEarringRight?null:"earringRight":"earringLeft":l?null:i.equippedRingLeft?i.equippedRingRight?i.equippedNecklace?i.equippedEarringLeft?i.equippedEarringRight?null:"earringRight":"earringLeft":"necklace":"ringRight":"ringLeft"}return null})();if(!o)return{success:!1,message:"Sem slot disponÃ­vel compatÃ­vel"};const c={mainHand:"mÃ£o principal",offHand:"mÃ£o secundÃ¡ria",helm:"helmo",chest:"armadura",belt:"cintura",gloves:"luvas",boots:"botas",cape:"asa/capa",ringLeft:"anel (esq.)",ringRight:"anel (dir.)",necklace:"colar",earringLeft:"brinco (esq.)",earringRight:"brinco (dir.)"};return{success:!0,message:`${t.name} equipado no slot ${c[o]}!`}}function Fo(a,s){var o,c,l;const t=Ee.find(d=>d.id===s),r=(a.inventory.items[s]||0)>0;if(!t||!r)return{success:!1,message:"VocÃª nÃ£o possui este item!"};if(t.type!=="consumable")return{success:!1,message:"Este item nÃ£o pode ser usado!"};let i=`${t.name} usado!`;const n={};if((o=t.effects)!=null&&o.hp){const d=a.derivedAttributes.currentHp||a.derivedAttributes.hp,m=Math.min(a.derivedAttributes.hp,d+t.effects.hp);n.hp=m,i+=` +${t.effects.hp} HP`}if((c=t.effects)!=null&&c.mp){const d=a.derivedAttributes.currentMp||a.derivedAttributes.mp,m=Math.min(a.derivedAttributes.mp,d+t.effects.mp);n.mp=m,i+=` +${t.effects.mp} MP`}if(t.id==="pergaminho-xp"&&(n.xp=50,i+=" +50 XP"),(l=t.effects)!=null&&l.fatigue){const d=a.progression.fatigue??0,m=Math.min(t.effects.fatigue,d),u=Math.max(0,d-m);n.fatigue=u,m>0?i+=` -${m} Fadiga`:i+=" (sem efeito: Fadiga jÃ¡ 0)"}return{success:!0,message:i,effects:n}}function Bo(){const s=new Date().toDateString().split("").reduce((n,o)=>n+o.charCodeAt(0),0),t=()=>{const n=Math.sin(s)*1e4;return n-Math.floor(n)},r=[],i=Ee.filter(n=>n.rarity!=="lendario");for(let n=0;n<3;n++){const o=Math.floor(t()*i.length),c={...i[o]};c.price=Math.floor(c.price*.8),r.push(c)}return r}const Oo={F:0,E:.02,D:.04,C:.06,B:.08,A:.1,S:.12},Lo={comum:1,raro:.9,epico:.8,lendario:.7};function Ho(a){return a>=1e3?.15:a>=500?.1:a>=200?.05:0}function Fa(a,s){var d;const t=Ho(s.progression.reputation),r=((d=s.rankData)==null?void 0:d.currentRank)??"F",i=Oo[r]??0,n=Lo[a.rarity]??1,o=Io(s),c=Math.max(0,Math.min(.5,(t+i+o)*n)),l=Go(a);return Math.floor(l*(1-c))}function Go(a){var r;const s=a.rarity,t=((r=Gi[s])==null?void 0:r.multiplier)??1;if(a.level&&a.level>0){if(a.rarity==="lendario"){const i=a.level*t*100;return Math.max(1e4,Math.min(25e3,Math.floor(i)))}return Math.floor(a.level*t*100)}return a.price}function zo(a,s=0){const t=["espada","arco","cajado","machado"],r=t[a%t.length],i=["Flamejante","do CaÃ§ador","dos Ecos","GÃ©lido","Trovejante"],n=["da Rapidez","da FÃºria","da PrecisÃ£o","do GuardiÃ£o"],o=i[(a+1)%i.length],c=n[(a+2)%n.length],l=a%100+s,d=l>90?"lendario":l>70?"epico":l>40?"raro":"comum",m=d==="lendario"?3:d==="epico"?2:d==="raro"?1:0,u=o==="Flamejante"?"fire":o==="GÃ©lido"?"ice":o==="Trovejante"?"thunder":void 0,p={forca:r==="espada"?2:0,destreza:r==="arco"?2:0,inteligencia:r==="cajado"?2:0};return{id:crypto.randomUUID(),name:`${r} ${o} ${c}`,baseType:r,rarity:d,sockets:m,bonus:p,elementOverride:u}}function Uo(){var a;try{const s=localStorage.getItem("replay_weekly_mutator");if(!s)return null;const t=JSON.parse(s),r=(a=t==null?void 0:t.modifiers)==null?void 0:a.enemy_element;return typeof r=="string"?r:null}catch{return null}}function Vo(){var a;try{const s=localStorage.getItem("replay_player_relics"),t=s?JSON.parse(s):[];let r=0;for(const i of t||[]){const n=(a=i==null?void 0:i.effect)==null?void 0:a.global_crit_bonus;typeof n=="number"&&(r+=n)}return Math.max(0,Math.min(.5,r))}catch{return 0}}function Qo(){var a;try{const s=localStorage.getItem("replay_global_events"),t=s?JSON.parse(s):[];let r=1;for(const i of t||[]){const n=(a=i==null?void 0:i.modifiers)==null?void 0:a.enemy_damage_multiplier;typeof n=="number"&&(r*=n)}return Math.max(.5,Math.min(3,r))}catch{return 1}}function Xo(){var a;try{const s=localStorage.getItem("replay_global_events"),t=s?JSON.parse(s):[];let r=0;for(const i of t||[]){const n=(a=i==null?void 0:i.modifiers)==null?void 0:a.rare_item_chance;typeof n=="number"&&(r+=n)}return Math.max(0,Math.min(.5,r))}catch{return 0}}const na={enemyBase:{hp:30,atk:6,def:3},scaling:{hpPerFloor:.12,atkPerFloor:.1,defPerFloor:.08,bossMultiplier:1.8,affixBonus:.2},rewards:{xpPerFloor:6,goldPerFloor:2,rarityIncreasePerFloor:.6,streakMultiplierPerFloor:.07},events:{baseChance:.1},deathPenalty:{normal:{gold:.5,xp:.3},hardcore:{gold:.8,xp:.6}},difficultyMultipliers:{facil:{enemy:.85,rewards:.9,successBaseBias:.1},normal:{enemy:1,rewards:1,successBaseBias:0},dificil:{enemy:1.2,rewards:1.25,successBaseBias:-.05},epico:{enemy:1.45,rewards:1.5,successBaseBias:-.1},hardcore:{enemy:1.6,rewards:1.7,successBaseBias:-.15},caotico:{enemy:1.3,rewards:1.6,successBaseBias:-.2}}};function as(a){return a>0&&a%10===0}function Jo(a){return a>0&&a%5===0&&a%10!==0}function ma(a){return 1+a*na.rewards.streakMultiplierPerFloor}function Wo(a){return na.difficultyMultipliers[a]||na.difficultyMultipliers.normal}const Ko={fire:{beats:"earth",weak:"water"},water:{beats:"fire",weak:"thunder"},earth:{beats:"thunder",weak:"fire"},air:{},thunder:{beats:"water",weak:"earth"},light:{beats:"dark",weak:"dark"},dark:{beats:["fire","water","earth","air","thunder"],weak:"light"},physical:{}},Zs={fire:{name:"Fogo",icon:"ğŸ”¥",color:"#FF4500",description:"+10% dano contÃ­nuo; vence Terra; perde para Ãgua"},water:{name:"Ãgua",icon:"ğŸŒŠ",color:"#1E90FF",description:"+10% cura recebida; vence Fogo; perde para Raio"},earth:{name:"Terra",icon:"ğŸŒ±",color:"#8B4513",description:"+20% defesa base; vence Raio; perde para Fogo"},air:{name:"Ar",icon:"ğŸŒª",color:"#87CEEB",description:"+10% chance de crÃ­tico; instÃ¡vel"},thunder:{name:"Raio",icon:"âš¡",color:"#FFD700",description:"+10% velocidade; vence Ãgua; perde para Terra"},light:{name:"Luz",icon:"âœ¨",color:"#FFFF00",description:"+5% cura e dano sagrado; vence Trevas"},dark:{name:"Trevas",icon:"ğŸ’€",color:"#4B0082",description:"Roubo de vida 5%; vence todos exceto Luz"},physical:{name:"FÃ­sico",icon:"âš”ï¸",color:"#808080",description:"Neutro"}};function Kr(a){const s=[],t=[],r=[];return Object.entries(Ko).forEach(([i,n])=>{const o=i;o!==a&&(n.beats===a?t.push(o):n.weak===a?s.push(o):r.push(o))}),{strong:s,weak:t,neutral:r}}function zi(){const a=["fire","water","earth","air","thunder","light","dark"];return a[Math.floor(Math.random()*a.length)]}function da(a){return{guerreiro:["earth","fire","physical"],mago:["fire","water","thunder"],arqueiro:["air","thunder","earth"],clerigo:["light","water","earth"],ladino:["dark","air","thunder"],patrulheiro:["earth","air","water"],paladino:["light","fire","earth"]}[a.toLowerCase()]||["physical"]}function Yo(a,s){return!s||s==="physical"?1:a===s?1.1:1}function Ui(a){return Zs[a]||Zs.physical}const Yr={fire:{beats:["earth"],weak:["water"]},water:{beats:["fire"],weak:["thunder"]},earth:{beats:["thunder"],weak:["fire"]},air:{beats:[]},thunder:{beats:["water"],weak:["earth"]},light:{beats:["dark"],weak:["dark"]},dark:{beats:["fire","water","earth","air","thunder"],weak:["light"]},physical:{beats:[]}};function Vi(a,s,t=0,r=0){var n,o;let i=1;return(n=Yr[a])!=null&&n.beats.includes(s)&&(i*=1.3),(o=Yr[s])!=null&&o.beats.includes(a)&&(i*=.75),i*=1+(t-r)/100,Math.max(.4,Math.min(i,2.5))}const Zo={Lobo:{hp:25,forca:6,destreza:8,constituicao:5,inteligencia:2,sabedoria:6,carisma:3,armor:1,weapon:{name:"Presas",atk:4,critChance:.1}},Goblin:{hp:20,forca:4,destreza:9,constituicao:4,inteligencia:5,sabedoria:4,carisma:2,armor:2,weapon:{name:"Adaga Enferrujada",atk:3,critChance:.15}},Bandido:{hp:35,forca:7,destreza:6,constituicao:6,inteligencia:4,sabedoria:5,carisma:4,armor:3,weapon:{name:"Espada Curta",atk:5,critChance:.08}},Esqueleto:{hp:30,forca:5,destreza:7,constituicao:8,inteligencia:3,sabedoria:4,carisma:1,armor:2,weapon:{name:"Espada Antiga",atk:4,critChance:.05}},Troll:{hp:80,forca:12,destreza:3,constituicao:10,inteligencia:2,sabedoria:3,carisma:2,armor:4,weapon:{name:"Clava Gigante",atk:8,critChance:.12}},"GuardiÃ£o de Pedra":{hp:120,forca:14,destreza:2,constituicao:16,inteligencia:3,sabedoria:5,carisma:1,armor:8,weapon:{name:"Punhos MonolÃ­ticos",atk:10,critChance:.08}},"Rei Goblin":{hp:95,forca:10,destreza:12,constituicao:10,inteligencia:6,sabedoria:4,carisma:6,armor:5,weapon:{name:"LÃ¢mina Real Goblin",atk:9,critChance:.18}},"Feiticeiro das Sombras":{hp:90,forca:6,destreza:7,constituicao:9,inteligencia:14,sabedoria:10,carisma:5,armor:3,weapon:{name:"Cajado Obscuro",atk:11,critChance:.15}},"TitÃ£ de Gelo":{hp:130,forca:13,destreza:4,constituicao:18,inteligencia:4,sabedoria:6,carisma:2,armor:7,weapon:{name:"Martelo Glacial",atk:12,critChance:.12}},"Draco EtÃ©reo":{hp:140,forca:15,destreza:8,constituicao:14,inteligencia:8,sabedoria:6,carisma:8,armor:6,weapon:{name:"Garras EtÃ©reas",atk:13,critChance:.2}},"Arauto Ãgneo":{hp:125,forca:14,destreza:6,constituicao:12,inteligencia:10,sabedoria:5,carisma:4,armor:5,weapon:{name:"LanÃ§a Flamejante",atk:12,critChance:.16}}},ec={Lobo:{items:[{id:"pele-lobo",name:"Pele de Lobo",description:"Material para crafting",type:"consumable",rarity:"comum",price:15},{id:"pocao-pequena",name:"PoÃ§Ã£o de Cura Pequena",description:"Restaura 20 HP",type:"consumable",rarity:"comum",price:25,effects:{hp:20}}],dropRates:[.6,.3]},Goblin:{items:[{id:"moeda-goblin",name:"Moeda Goblin",description:"Moeda de valor duvidoso",type:"consumable",rarity:"comum",price:10},{id:"adaga-ferro",name:"Adaga de Ferro",description:"+2 ForÃ§a",type:"weapon",rarity:"comum",price:50,bonus:{forca:2}}],dropRates:[.7,.2]},Bandido:{items:[{id:"espada-ferro",name:"Espada de Ferro",description:"+3 ForÃ§a",type:"weapon",rarity:"raro",price:100,bonus:{forca:3}},{id:"armadura-couro",name:"Armadura de Couro",description:"+2 ConstituiÃ§Ã£o",type:"armor",rarity:"comum",price:75,bonus:{constituicao:2}}],dropRates:[.25,.4]},Esqueleto:{items:[{id:"osso-antigo",name:"Osso Antigo",description:"Material mÃ¡gico",type:"consumable",rarity:"raro",price:30},{id:"pergaminho-xp",name:"Pergaminho de ExperiÃªncia",description:"+50 XP",type:"consumable",rarity:"raro",price:80,effects:{duration:0}}],dropRates:[.5,.2]},"GuardiÃ£o de Pedra":{items:[{id:"armadura-pedra-rachada",name:"Armadura de Pedra Rachada",description:"+6 ConstituiÃ§Ã£o",type:"armor",rarity:"epico",price:640,bonus:{constituicao:6}}],dropRates:[.3]},"Rei Goblin":{items:[{id:"adaga-ferro",name:"Adaga de Ferro",description:"+2 ForÃ§a",type:"weapon",rarity:"comum",price:50,bonus:{forca:2}},{id:"anel-precisao",name:"Anel da PrecisÃ£o",description:"+2 Destreza, +1 InteligÃªncia",type:"accessory",rarity:"epico",price:280,bonus:{destreza:2,inteligencia:1}}],dropRates:[.35,.15]},"Feiticeiro das Sombras":{items:[{id:"cajado-arcano",name:"Cajado Arcano",description:"+4 InteligÃªncia",type:"weapon",rarity:"epico",price:420,bonus:{inteligencia:4}}],dropRates:[.25]},"TitÃ£ de Gelo":{items:[{id:"cajado-cristal",name:"Cajado de Cristal",description:"+3 InteligÃªncia, +1 Sabedoria",type:"weapon",rarity:"raro",price:260,bonus:{inteligencia:3,sabedoria:1}}],dropRates:[.3]},"Draco EtÃ©reo":{items:[{id:"asas-lendarias",name:"Asas LendÃ¡rias",description:"+4 Destreza, +2 InteligÃªncia, +1 Sabedoria",type:"armor",rarity:"lendario",price:900,bonus:{destreza:4,inteligencia:2,sabedoria:1},slot:"cape"}],dropRates:[.08]},"Arauto Ãgneo":{items:[{id:"espada-flamejante",name:"Espada Flamejante",description:"Chance temÃ¡tica de causar dano de fogo.",type:"weapon",rarity:"raro",price:280,bonus:{forca:5}}],dropRates:[.25]}};function er(a,s=1){const t=Zo[a];if(!t)throw new Error(`Tipo de inimigo desconhecido: ${a}`);const r=1+(s-1)*.3;return{name:a,hp:Math.floor((t.hp||20)*r),maxHp:Math.floor((t.hp||20)*r),forca:Math.floor((t.forca||5)*r),destreza:Math.floor((t.destreza||5)*r),constituicao:Math.floor((t.constituicao||5)*r),inteligencia:t.inteligencia||3,sabedoria:t.sabedoria||3,carisma:t.carisma||3,armor:Math.floor((t.armor||0)*r),weapon:t.weapon}}function Qi(a){const s=a.derivedAttributes.currentHp||a.derivedAttributes.hp;return{name:a.name,hp:s,maxHp:a.derivedAttributes.hp,forca:a.attributes.forca,destreza:a.attributes.destreza,constituicao:a.attributes.constituicao,inteligencia:a.attributes.inteligencia,sabedoria:a.attributes.sabedoria,carisma:a.attributes.carisma,armor:a.derivedAttributes.armorClass,weapon:{name:"Arma BÃ¡sica",atk:2,critChance:.05}}}function ss(a,s,t){var o,c,l;let r=50+(a.destreza-s.destreza)*3;((t==null?void 0:t.attackElement)||"physical")==="thunder"&&(r+=5);let i=Math.max(5,Math.min(95,r));if(Math.floor(Math.random()*100)+1<=i){const d=((o=a.weapon)==null?void 0:o.atk)||0;let m=a.forca+d+((t==null?void 0:t.skillBonus)||0),u=((c=a.weapon)==null?void 0:c.critChance)||.05;u=Math.min(.95,u+Vo()),((t==null?void 0:t.attackElement)||"physical")==="air"&&(u=Math.min(.95,u+.1));const p=Math.random()<u,g=(t==null?void 0:t.ramp)||1,v=Vi((t==null?void 0:t.attackElement)||"physical",(t==null?void 0:t.defendElement)||"physical",(t==null?void 0:t.atkAffinity)||0,(t==null?void 0:t.defResistance)||0),y=Math.floor((s.armor||0)*(((t==null?void 0:t.defendElement)||"physical")==="earth"?1.2:1)),w=t!=null&&t.isEnemyAttack?Qo():1,k=Math.max(1,Math.floor(m*(p?1.5:1)*g*v*w-y)),E=((l=a.weapon)==null?void 0:l.name)||"punhos",h=p?" CRÃTICO!":"",b=v>1?" (super efetivo!)":v<1?" (pouco efetivo)":"";return{hit:!0,damage:k,crit:p,message:`${a.name} ataca com ${E} e causa ${k} de dano${h}${b}`}}else return{hit:!1,damage:0,crit:!1,message:`${a.name} erra o ataque!`}}function Xi(a){const s=ec[a];if(!s)return[];const t=[];s.items.forEach((i,n)=>{const o=s.dropRates[n]||0;Math.random()<o&&t.push(i)});const r=[{id:"pedra-alma",chance:.05},{id:"essencia-calor",chance:.02},{id:"brasas-magicas",chance:.01}];return a==="Troll"&&(r.push({id:"essencia-bestial",chance:.03}),r.push({id:"pergaminho-montaria",chance:.02})),r.forEach(({id:i,chance:n})=>{if(Math.random()<n){const o=Ee.find(c=>c.id===i);o&&t.push(o)}}),t}function tr(a,s){const t=a.maxHp+a.forca+a.destreza,r=Math.max(1,a.maxHp/20)-s,i=r>=0?1+r*.2:Math.max(.5,1+r*.1);return Math.floor(t*i)}function Ji(a){return Math.floor((a.maxHp+a.forca)*.8)+Math.floor(Math.random()*10)}function Zr(a,s,t){var p,g;const r=s.element||"physical";console.debug("[combat] resolveSkillUse:start",{user:a==null?void 0:a.name,target:(s==null?void 0:s.name)||"enemy",skill:t==null?void 0:t.name,effects:t==null?void 0:t.effects});let i=t.basePower||0;switch(t.type){case"attack":i+=a.attributes.forca*.5;break;case"support":i+=a.attributes.inteligencia*.3;break;case"buff":i+=a.attributes.destreza*.2;break}console.debug("[combat] basePower",i);const n=Vi(t.element||"physical",r,Yo(a.element,t.element),0);console.debug("[combat] elementMultiplier",n);let o=0,c=0;const l=[];if(t.type==="attack"){const v=s.constituicao||s.constituicao||0;let y=Math.max(0,Math.floor(i*n)-v*.3);(a.element||"physical")==="light"&&(t.element||"physical")==="light"&&(y=Math.floor(y*1.05)),o=y,console.debug("[combat] attack calc",{targetDefense:v,finalDamage:o})}else if(t.type==="support"&&t.name.includes("Cura")){let v=Math.floor(i);(a.element||"physical")==="water"&&(v=Math.floor(v*1.1)),(a.element||"physical")==="light"&&(v=Math.floor(v*1.05)),c=v,console.debug("[combat] healing calc",{healing:c})}if(t.effects){const v=t.effects,y=[];if(v.special&&y.push(v.special),typeof v.heal=="number"&&v.heal>0&&y.push(`cura ${v.heal}`),(p=v.buff)!=null&&p.attribute&&y.push(`buff ${String(v.buff.attribute)}`),(g=v.debuff)!=null&&g.attribute&&y.push(`debuff ${String(v.debuff.attribute)}`),l.push(...y),console.debug("[combat] effects parsed",y),v.special==="double_strike"&&o>0&&(o=Math.floor(o*2)),v.special==="lifesteal_small"&&o>0){let w=Math.floor(o*.2);(a.element||"physical")==="water"&&(w=Math.floor(w*1.1)),(a.element||"physical")==="light"&&(w=Math.floor(w*1.05)),c+=w}v.special==="heal_over_time"&&(c+=v.heal?v.heal:Math.floor(i*.5))}const d=.9,m=Math.random()<d;console.debug("[combat] success roll",{success:m});let u=`${a.name} usa ${t.name}!`;return m?(o>0&&(u+=` Causa ${o} de dano`,n>1?u+=" (super efetivo!)":n<1&&(u+=" (pouco efetivo)")),c>0&&(u+=` Cura ${c} HP`),l.length>0&&(u+=` (${l.join(", ")})`),{damage:o,elementMultiplier:n,healing:c,effects:l,success:!0,message:u}):(u+=" Mas falhou!",{damage:0,elementMultiplier:1,effects:[],success:!1,message:u})}function Wi(a,s,t={}){var h,b,f,j,N,T;const r=[];let i=0,n=0,o=[];const c=Qi(a);r.push(`${c.name} entra em combate!`);const l=a.element||"physical",d=(a.pets||[]).find(F=>F.id===a.activePetId);let m=(d==null?void 0:d.energy)??0,u=0,p=0,g=0,v=0,y=0,w=null,k=0;const E=new Set;for(const F of s)for(let te=0;te<F.count;te++){const D=er(F.type,F.level||1);let $=Uo()||zi();D.name==="GuardiÃ£o de Pedra"&&($="earth"),D.name==="Rei Goblin"&&($="air"),D.name==="Feiticeiro das Sombras"&&($="dark"),D.name==="TitÃ£ de Gelo"&&($="ice"),D.name==="Draco EtÃ©reo"&&($="thunder"),D.name==="Arauto Ãgneo"&&($="fire"),r.push(`
--- Enfrentando ${D.name} ---`),r.push(`Elemento do inimigo: ${$}`);let X=0,Q=0,Y=1,G=!1;const J=20;for(;c.hp>0&&D.hp>0&&Y<=J;){const re=c.destreza+(l==="thunder"?1:0)>=D.destreza+($==="thunder"?1:0),ee=1+Math.min(.1+Y*.06,2);if(D.name==="GuardiÃ£o de Pedra"&&(D.armor=Math.floor(D.armor*1.2)),D.name==="Rei Goblin"&&(D.destreza=Math.floor(D.destreza*1.15)),D.name==="Feiticeiro das Sombras"&&Y%3===0&&D.hp>0){const P=Math.floor(3+Math.random()*6);c.hp=Math.max(0,c.hp-P),D.hp=Math.min(D.maxHp,D.hp+P),r.push(`ğŸ©¸ ${D.name} drena ${P} HP do herÃ³i`)}if(D.name==="TitÃ£ de Gelo"&&Y%4===0){const P=c.destreza;c.destreza=Math.max(1,c.destreza-1),r.push(`â„ï¸ ${D.name} reduz a destreza do herÃ³i (${P}â†’${c.destreza})`)}if(D.name==="Draco EtÃ©reo"&&Y%3===0&&(D.weapon={...D.weapon||{name:"Garras",atk:10,critChance:.2},atk:(((h=D.weapon)==null?void 0:h.atk)||10)+1},r.push(`âš¡ ${D.name} acumula energia etÃ©rea`)),X>0&&D.hp>0&&(D.hp=Math.max(0,D.hp-X),r.push(`ğŸ”¥ Queimadura causa ${X} dano contÃ­nuo no inimigo`),X=0),Q>0&&c.hp>0&&(c.hp=Math.max(0,c.hp-Q),r.push(`ğŸ”¥ Queimadura causa ${Q} dano contÃ­nuo em ${c.name}`),Q=0),re){const P=a.skills&&a.skills.length>0&&Math.random()<.35;let M=!1;if(P){const A=a.skills.find(S=>S.type==="attack")||a.skills[0],O=Zr(a,D,A);D.hp=Math.max(0,D.hp-Math.floor(O.damage*ee)),r.push(`Turno ${Y}: ${O.message}`),O.healing&&O.healing>0&&(c.hp=Math.min(c.maxHp,c.hp+O.healing)),M=(O.effects||[]).some(S=>S.includes("freeze_stun")||S.includes("stun_1"))}else{const A=w&&k>0?w:l,O=ss(c,D,{ramp:ee,attackElement:A,defendElement:$,atkAffinity:A!=="physical"&&A===l?10:0,defResistance:0});if(D.hp=Math.max(0,D.hp-O.damage),r.push(`Turno ${Y}: ${O.message}`),O.damage>0&&A==="fire"&&(X=Math.floor(O.damage*.1)),D.name==="Arauto Ãgneo"&&O.damage>0&&(X=Math.max(X,Math.floor(O.damage*.15))),A==="dark"&&O.damage>0){const S=Math.floor(O.damage*.05);S>0&&(c.hp=Math.min(c.maxHp,c.hp+S),r.push(`ğŸ’€ ${c.name} rouba ${S} HP`))}}if(d!=null&&d.exclusiveSkill&&m>=6&&p<=0){let A=0,O=0,S=!1;const I=d.exclusiveSkill;let ae=8;if(I==="Instinto Feral"?(A=Math.floor(2+Math.random()*4),ae=8):I==="Pulso Arcano"?(A=Math.floor(3+(a.attributes.inteligencia||0)*.1),ae=10):I==="Aura Sagrada"?(O=Math.floor(2+Math.random()*4),ae=9):I==="Sussurro Sombrio"&&(S=Math.random()<.1,ae=12),m>=ae?(m-=ae,u+=ae):(A=0,O=0,S=!1),A>0&&D.hp>0){D.hp=Math.max(0,D.hp-A);const L=I==="Instinto Feral"?"ğŸ¾":I==="Pulso Arcano"?"ğŸ”®":I==="Aura Sagrada"?"âœ¨":"ğŸŒ‘";r.push(`${L} Companheiro (${I}) causa ${A} dano extra`),g+=A}if(O>0){let L=O;(l||"physical")==="water"&&(L=Math.floor(L*1.1)),(l||"physical")==="light"&&(L=Math.floor(L*1.05)),c.hp=Math.min(c.maxHp,c.hp+L),r.push(`âœ¨ Companheiro restaura ${L} HP`),v+=L}S&&(M=!0,r.push("ğŸŒ‘ Companheiro impede a aÃ§Ã£o do inimigo"),y+=1),p={"Instinto Feral":1,"Pulso Arcano":2,"Aura Sagrada":2,"Sussurro Sombrio":3}[I]||1;const R={"Instinto Feral":"earth","Pulso Arcano":"light","Aura Sagrada":"light","Sussurro Sombrio":"dark"}[I];if(R&&(w=R,k=1),R){E.add(R);const L=R==="earth"?"â›°ï¸":R==="light"?"âœ¨":R==="dark"?"ğŸŒ‘":"ğŸŒ€";r.push(`${L} Elemento do herÃ³i aplicado: ${R}`)}}const C=M;if(D.hp>0&&!C){const A=ss(D,c,{ramp:ee,attackElement:$,defendElement:l,atkAffinity:0,defResistance:0,isEnemyAttack:!0});if(c.hp=Math.max(0,c.hp-A.damage),r.push(`${A.message}`),A.damage>0&&$==="fire"&&(Q=Math.floor(A.damage*.1)),$==="dark"&&A.damage>0){const O=Math.floor(A.damage*.05);O>0&&(D.hp=Math.min(D.maxHp,D.hp+O),r.push(`ğŸ’€ ${D.name} rouba ${O} HP`))}}k>0&&(k=Math.max(0,k-1))}else{const P=ss(D,c,{ramp:ee,attackElement:$,defendElement:l,atkAffinity:0,defResistance:0,isEnemyAttack:!0});if(c.hp=Math.max(0,c.hp-P.damage),r.push(`Turno ${Y}: ${P.message}`),P.damage>0&&$==="fire"&&(Q=Math.floor(P.damage*.1)),$==="dark"&&P.damage>0){const M=Math.floor(P.damage*.05);M>0&&(D.hp=Math.min(D.maxHp,D.hp+M),r.push(`ğŸ’€ ${D.name} rouba ${M} HP`))}if(c.hp>0){if(a.skills&&a.skills.length>0&&Math.random()<.35){const C=a.skills.find(O=>O.type==="attack")||a.skills[0],A=Zr(a,D,C);D.hp=Math.max(0,D.hp-Math.floor(A.damage*ee)),r.push(`${A.message}`),A.healing&&A.healing>0&&(c.hp=Math.min(c.maxHp,c.hp+A.healing)),(A.effects||[]).some(O=>O.includes("freeze_stun")||O.includes("stun_1"))}else{const C=w&&k>0?w:l,A=ss(c,D,{ramp:ee,attackElement:C,defendElement:$,atkAffinity:C!=="physical"&&C===l?10:0,defResistance:0});if(D.hp=Math.max(0,D.hp-A.damage),r.push(`${A.message}`),A.damage>0&&C==="fire"&&(X=Math.floor(A.damage*.1)),D.name==="Arauto Ãgneo"&&A.damage>0&&(X=Math.max(X,Math.floor(A.damage*.15))),(a.alignment||"").includes("mal")&&A.damage>0){const O=Math.floor(A.damage*.2);O>0&&(c.hp=Math.min(c.maxHp,c.hp+O),r.push(`ğŸ©¸ ${c.name} drena ${O} HP`))}if(C==="dark"&&A.damage>0){const O=Math.floor(A.damage*.05);O>0&&(c.hp=Math.min(c.maxHp,c.hp+O),r.push(`ğŸ’€ ${c.name} rouba ${O} HP`))}}if(d!=null&&d.exclusiveSkill&&m>=6&&p<=0){let C=0,A=0,O=!1;const S=d.exclusiveSkill;let I=8;if(S==="Instinto Feral"?(C=Math.floor(2+Math.random()*4),I=8):S==="Pulso Arcano"?(C=Math.floor(3+(a.attributes.inteligencia||0)*.1),I=10):S==="Aura Sagrada"?(A=Math.floor(2+Math.random()*4),I=9):S==="Sussurro Sombrio"&&(O=Math.random()<.1,I=12),m>=I?(m-=I,u+=I):(C=0,A=0,O=!1),C>0&&D.hp>0){D.hp=Math.max(0,D.hp-C);const R=S==="Instinto Feral"?"ğŸ¾":S==="Pulso Arcano"?"ğŸ”®":S==="Aura Sagrada"?"âœ¨":"ğŸŒ‘";r.push(`${R} Companheiro (${S}) causa ${C} dano extra`),g+=C}A>0&&(c.hp=Math.min(c.maxHp,c.hp+A),r.push(`âœ¨ Companheiro restaura ${A} HP`),v+=A),O&&(r.push("ğŸŒ‘ Companheiro impede a aÃ§Ã£o do inimigo"),y+=1),p={"Instinto Feral":1,"Pulso Arcano":2,"Aura Sagrada":2,"Sussurro Sombrio":3}[S]||1;const U={"Instinto Feral":"earth","Pulso Arcano":"light","Aura Sagrada":"light","Sussurro Sombrio":"dark"}[S];if(U&&(w=U,k=1),U){E.add(U);const R=U==="earth"?"â›°ï¸":U==="light"?"âœ¨":U==="dark"?"ğŸŒ‘":"ğŸŒ€";r.push(`${R} Elemento do herÃ³i aplicado: ${U}`)}}}p>0&&(p=Math.max(0,p-1)),k>0&&(k=Math.max(0,k-1))}const fe=D.hp/D.maxHp<=.25,_=c.hp/c.maxHp>=.5;if(!G&&Y>=8&&fe&&_){let P=.5+.2*(c.destreza>D.destreza?1:0);if(Math.random()<P){G=!0,r.push(`${D.name} tenta fugir e consegue! Combate encerrado.`);break}}Y++}if(c.hp<=0)return r.push(`${c.name} foi derrotado!`),{victory:!1,damage:c.maxHp-c.hp,xpGained:0,goldGained:0,itemsGained:[],log:r};if(D.hp<=0){r.push(`${D.name} foi derrotado!`);const re=tr(D,a.progression.level),ee=Ji(D),fe=Xi(F.type),_=F.level||1;(_>=20?[{id:"nucleo-mana-raro",chance:.2},{id:"nucleo-ancestral",chance:.1}]:_>=10?[{id:"nucleo-mana",chance:.35},{id:"nucleo-mana-raro",chance:.1}]:[{id:"nucleo-mana-menor",chance:.4},{id:"nucleo-mana",chance:.15}]).forEach(({id:ae,chance:ne})=>{if(Math.random()<ne){const U=Ee.find(R=>R.id===ae);U&&fe.push(U)}});const M=t.floor||1,C=(na.rarityIncreasePerFloor||0)*M,A=t.partyBonusPercent||0,S=[(b=a.inventory)==null?void 0:b.equippedRingLeft,(f=a.inventory)==null?void 0:f.equippedRingRight,(j=a.inventory)==null?void 0:j.equippedNecklace,(N=a.inventory)==null?void 0:N.equippedEarringLeft,(T=a.inventory)==null?void 0:T.equippedEarringRight].filter(Boolean).some(ae=>/anel|ring/i.test(String(ae)))?2:0;let I=Math.min(.05+(C+A+S)/100,.35);if(Math.random()<I){const ae=new Set(["weapon","armor","accessory"]),ne=["comum","incomum","raro","epico","lendario"],U=C>=35?3:C>=20?2:C>=10?1:0,R=Ee.filter(L=>ae.has(L.type)&&ne.indexOf(L.rarity)>=U);if(R.length>0){const L=R[Math.floor(Math.random()*R.length)];fe.push(L)}}i+=re,n+=ee,o.push(...fe),r.push(`Recompensas: +${re} XP, +${ee} ouro`),fe.length>0&&r.push(`Itens encontrados: ${fe.map(ae=>ae.name).join(", ")}`)}else{const re=tr(D,a.progression.level),ee=Math.floor(re*.4);i+=ee,r.push(`Combate inconclusivo - ${D.name} foge! Recompensa reduzida: +${ee} XP`)}}return r.push(`
=== VITÃ“RIA! ===`),r.push(`Total: +${i} XP, +${n} ouro`),d&&(g>0||v>0||y>0)&&r.push(`ğŸ¾ ContribuiÃ§Ã£o do Companheiro: +${g} dano, +${v} cura, ${y} controle(s)`),{victory:!0,damage:c.maxHp-c.hp,xpGained:i,goldGained:n,itemsGained:o,log:r,petEnergyUsed:u,petDamage:g,petHealing:v,petStuns:y,petElementHighlights:Array.from(E)}}function Ki(a,s,t=!1){const r=Qi(a);let i=r.forca+r.destreza+r.constituicao;const n=(a.pets||[]).find(y=>y.id===a.activePetId);let o=0,c=0;s.forEach(y=>{const w=er(y.type,y.level||1);c+=(w.forca+w.destreza+w.constituicao)*y.count});let l=0;t&&(l=a.progression.level*30+40,console.log(`ğŸ° BÃ´nus de guilda aplicado: +${l} poder`));const d=i+l-c;let u=Math.max(25,Math.min(95,(t?75:50)+d*2));n!=null&&n.exclusiveSkill&&(n.energy||0)>=12&&(u=Math.min(95,u+7),o+=12),console.log(`âš”ï¸ Poder do herÃ³i: ${i} + ${l} = ${i+l}`),console.log(`ğŸ‘¹ Poder dos inimigos: ${c}`),console.log(`ğŸ² Chance de vitÃ³ria: ${u.toFixed(1)}%`);const p=Math.random()*100<u,v=((y,w,k)=>{const E=[],h=w.map(b=>`${b.count} ${b.type}${b.count>1?"s":""}`).join(", ");return E.push(`âš”ï¸ ${k.name} enfrenta ${h} em combate!`),t&&E.push(`ğŸ° O poder da guilda fortalece ${k.name} na batalha!`),y?(E.push(`ğŸ’ª ${k.name} luta com bravura e determinaÃ§Ã£o!`),E.push("âš¡ Seus golpes encontram o alvo com precisÃ£o mortal!"),w.forEach(b=>{b.count===1?E.push(`ğŸ—¡ï¸ O ${b.type} Ã© derrotado apÃ³s uma batalha intensa!`):E.push(`ğŸ—¡ï¸ Os ${b.count} ${b.type}s sÃ£o derrotados um por um!`)}),E.push(`ğŸ‰ VitÃ³ria! ${k.name} emerge triunfante do combate!`)):(E.push(`ğŸ˜° ${k.name} luta corajosamente, mas os inimigos sÃ£o muito poderosos!`),E.push(`ğŸ’¥ ApÃ³s uma batalha feroz, ${k.name} Ã© forÃ§ado a recuar!`),E.push(`ğŸ©¹ Ferido mas vivo, ${k.name} aprende com a derrota...`)),E})(p,s,a);if(p){let y=0,w=0,k=[];return s.forEach(E=>{var h,b,f,j,N;for(let T=0;T<E.count;T++){const F=er(E.type,E.level||1);y+=tr(F,a.progression.level),w+=Ji(F);const te=Xi(E.type),D=E.level||1;(D>=20?[{id:"nucleo-mana-raro",chance:.2},{id:"nucleo-ancestral",chance:.1}]:D>=10?[{id:"nucleo-mana",chance:.35},{id:"nucleo-mana-raro",chance:.1}]:[{id:"nucleo-mana-menor",chance:.4},{id:"nucleo-mana",chance:.15}]).forEach(({id:fe,chance:_})=>{if(Math.random()<_){const P=Ee.find(M=>M.id===fe);P&&te.push(P)}});const X=new Set(["weapon","armor","accessory"]),Q=["comum","incomum","raro","epico","lendario"],G=[(h=a.inventory)==null?void 0:h.equippedRingLeft,(b=a.inventory)==null?void 0:b.equippedRingRight,(f=a.inventory)==null?void 0:f.equippedNecklace,(j=a.inventory)==null?void 0:j.equippedEarringLeft,(N=a.inventory)==null?void 0:N.equippedEarringRight].filter(Boolean).some(fe=>/anel|ring/i.test(String(fe)))?2:0,J=na.rarityIncreasePerFloor||0,re=J>=20?2:J>=10?1:0,ee=Math.min(.03+(J+G)/100,.25);if(Math.random()<ee){const fe=Ee.filter(_=>X.has(_.type)&&Q.indexOf(_.rarity)>=re);fe.length>0&&te.push(fe[Math.floor(Math.random()*fe.length)])}k.push(...te)}}),v.push(`ğŸ’° Recompensas: ${y} XP, ${w} moedas de ouro`),k.length>0&&v.push(`ğŸ’ Itens encontrados: ${k.map(E=>E.name).join(", ")}`),{victory:!0,damage:Math.floor(Math.random()*10),xpGained:y,goldGained:w,itemsGained:k,log:v,petEnergyUsed:o,petDamage:0,petHealing:0,petStuns:0}}else{const y=Math.floor(r.maxHp*.3);return v.push(`ğŸ’” ${a.name} sofre ${y} pontos de dano na derrota`),{victory:!1,damage:y,xpGained:0,goldGained:0,itemsGained:[],log:v,petEnergyUsed:o,petDamage:0,petHealing:0,petStuns:0}}}class Jt{constructor(s,t,r){Ue(this,"id");Ue(this,"tipo");Ue(this,"cor");Ue(this,"nivel");Ue(this,"baseBonus");this.id=s,this.tipo=t,this.nivel=Math.max(1,Math.min(10,r)),this.cor=Jt.getColorForType(t),this.baseBonus=Jt.getBaseBonusForType(t)}static getColorForType(s){return s==="vermelha"?"#EF4444":s==="azul"?"#3B82F6":s==="verde"?"#10B981":s==="amarela"?"#F59E0B":"#8B5CF6"}static getBaseBonusForType(s){return s==="vermelha"?{forca:2}:s==="azul"?{inteligencia:2}:s==="verde"?{destreza:2}:s==="amarela"?{armorClass:1}:{constituicao:2}}getBonus(){const s=1+(this.nivel-1)*.2,t={};return this.baseBonus.forca&&(t.forca=Math.round(this.baseBonus.forca*s)),this.baseBonus.inteligencia&&(t.inteligencia=Math.round(this.baseBonus.inteligencia*s)),this.baseBonus.destreza&&(t.destreza=Math.round(this.baseBonus.destreza*s)),this.baseBonus.constituicao&&(t.constituicao=Math.round(this.baseBonus.constituicao*s)),this.baseBonus.armorClass&&(t.armorClass=Math.round(this.baseBonus.armorClass*s)),t}static canFuse(s,t){return s.tipo===t.tipo&&s.nivel===t.nivel&&s.nivel<10}static fuse(s,t){return Jt.canFuse(s,t)?new Jt(crypto.randomUUID(),s.tipo,s.nivel+1):null}static minHeroLevelToEquip(s){return Math.max(1,Math.min(99,s*3))}}const Na=[{id:"peitoral-cacador",name:"Peitoral do CaÃ§ador",inputs:[{id:"pele-lobo-sombrio",qty:3},{id:"colmilho-vampirico",qty:1}],output:{id:"armadura-cacador",qty:1},rankRequired:"D"},{id:"lamina-ritual",name:"LÃ¢mina Ritual do Alpha",inputs:[{id:"osso-antigo",qty:2},{id:"cristal-runico",qty:1}],output:{id:"lamina-alpha",qty:1},rankRequired:"B"},{id:"tunica-umbral",name:"TÃºnica Umbral",inputs:[{id:"essencia-lunar",qty:2},{id:"erva-sangue",qty:3}],output:{id:"manto-arcano",qty:1},rankRequired:"C"}];function tc(a){var i;const s=["F","E","D","C","B","A","S"],t=((i=a.rankData)==null?void 0:i.currentRank)||"F",r=s.indexOf(t);return Na.filter(n=>{const o=s.indexOf(n.rankRequired||"F");return r<o?!1:n.inputs.every(c=>(a.inventory.items[c.id]||0)>=c.qty)})}const Sa=class Sa{constructor(){Ue(this,"activities",[]);Ue(this,"maxActivities",1e3);this.loadActivities()}static getInstance(){return Sa.instance||(Sa.instance=new Sa),Sa.instance}createActivity(s,t,r=!0){const i={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:s,timestamp:new Date,data:t,message:this.generateActivityMessage(s,t),icon:this.getActivityIcon(s),color:this.getActivityColor(s),isPublic:r,likes:0,comments:[],shares:0};return this.activities.unshift(i),this.activities.length>this.maxActivities&&(this.activities=this.activities.slice(0,this.maxActivities)),this.saveActivities(),i}generateActivityMessage(s,t){var n,o;const{heroName:r,heroClass:i}=t;switch(s){case"quest-completed":return`${r} (${i}) completou a missÃ£o "${t.questName}"${t.questDifficulty?` (${t.questDifficulty})`:""}!`;case"epic-quest-completed":return`ğŸŒŸ ${r} (${i}) conquistou a missÃ£o Ã©pica "${t.questName}"! Uma verdadeira lenda!`;case"level-up":return`ğŸ‰ ${r} (${i}) subiu para o nÃ­vel ${t.heroLevel}!`;case"achievement-unlocked":return`ğŸ† ${r} (${i}) desbloqueou a conquista "${t.achievementUnlocked}"!`;case"title-earned":return`ğŸ‘‘ ${r} (${i}) conquistou o tÃ­tulo "${t.titleEarned}"!`;case"event-completed":return`ğŸª ${r} (${i}) completou o evento "${t.eventCompleted}"!`;case"daily-goal-completed":return`âœ… ${r} (${i}) completou a meta diÃ¡ria "${t.dailyGoalCompleted}"!`;case"combat-victory":const c=((n=t.enemiesDefeated)==null?void 0:n.length)===1?t.enemiesDefeated[0]:`${(o=t.enemiesDefeated)==null?void 0:o.length} inimigos`;return`âš”ï¸ ${r} (${i}) derrotou ${c} em combate!`;case"rank-promotion":return`ğŸ† ${r} (${i}) foi promovido para Rank ${t.newRank}! Uma conquista Ã©pica!`;case"tavern-rest":{const l=t.restType?` (${t.restType})`:"",d=typeof t.fatigueRecovered=="number"?t.fatigueRecovered:0,m=typeof t.goldSpent=="number"?t.goldSpent:0;return`ğŸ›ï¸ ${r} (${i}) descansou na taverna${l}, recuperou ${d} de Fadiga por ${m} ouro.`}case"item-used":{const l=[];typeof t.hpRecovered=="number"&&t.hpRecovered>0&&l.push(`+${t.hpRecovered} HP`),typeof t.mpRecovered=="number"&&t.mpRecovered>0&&l.push(`+${t.mpRecovered} MP`),typeof t.xpGained=="number"&&t.xpGained>0&&l.push(`+${t.xpGained} XP`),typeof t.fatigueRecovered=="number"&&t.fatigueRecovered>0&&l.push(`-${t.fatigueRecovered} Fadiga`);const d=l.length?` (${l.join(", ")})`:"",m=t.itemName?` ${t.itemName}`:"";return`ğŸ§ª ${r} (${i}) usou${m}${d}.`}case"pet-hatched":{const l=t.eggRarity?` (${String(t.eggRarity)})`:"",d=t.petName?` ${t.petName}`:"um mascote";return`ğŸ£ ${r} (${i}) chocou${l} e obteve${d}!`}case"guild-event-activated":{const l=typeof t.xpBuffPercent=="number"?`+${t.xpBuffPercent}% XP`:"",d=typeof t.trainingDiscountPercent=="number"?`-${t.trainingDiscountPercent}% treino`:"",m=l&&d?" â€¢ ":"",u=t.guildName?` na guilda ${t.guildName}`:"";return`ğŸ›ï¸ ${r} (${i}) ativou "${t.eventName||"Evento da Guilda"}"${u}: ${l}${m}${d}.`}case"tavern-dice":{const l=typeof t.roll=="number"?t.roll:0,d=!!t.critical,m=t.betAmount?` (aposta: ${t.betAmount} ğŸª™)`:"",u=t.opponentName?` contra ${t.opponentName}`:"";return`${d?"ğŸ²âœ¨":"ğŸ²"} ${r} (${i}) rolou ${l}${u}${m}${d?" â€” CRÃTICO!":""}`}default:return`${r} (${i}) realizou uma aÃ§Ã£o heroica!`}}getActivityIcon(s){return{"quest-completed":"ğŸ¯","epic-quest-completed":"ğŸŒŸ","level-up":"ğŸ“ˆ","achievement-unlocked":"ğŸ†","title-earned":"ğŸ‘‘","event-completed":"ğŸª","daily-goal-completed":"âœ…","combat-victory":"âš”ï¸","rank-promotion":"ğŸ†","tavern-rest":"ğŸ›ï¸","item-used":"ğŸ§ª","guild-event-activated":"ğŸ›ï¸","pet-hatched":"ğŸ£","tavern-dice":"ğŸ²"}[s]||"ğŸ®"}getActivityColor(s){return{"quest-completed":"from-blue-400 to-blue-600","epic-quest-completed":"from-purple-500 to-pink-600","level-up":"from-green-400 to-green-600","achievement-unlocked":"from-yellow-400 to-orange-500","title-earned":"from-purple-400 to-purple-600","event-completed":"from-pink-400 to-pink-600","daily-goal-completed":"from-teal-400 to-teal-600","combat-victory":"from-red-400 to-red-600","rank-promotion":"from-amber-400 to-yellow-600","tavern-rest":"from-amber-400 to-amber-600","item-used":"from-indigo-400 to-indigo-600","guild-event-activated":"from-indigo-500 to-indigo-700","pet-hatched":"from-amber-400 to-emerald-600","tavern-dice":"from-amber-400 to-purple-600"}[s]||"from-gray-400 to-gray-600"}getActivityFeed(s){let t=[...this.activities];return s&&(s.types&&s.types.length>0&&(t=t.filter(r=>s.types.includes(r.type))),s.heroIds&&s.heroIds.length>0&&(t=t.filter(r=>s.heroIds.includes(r.data.heroId))),s.showOnlyPublic&&(t=t.filter(r=>r.isPublic)),s.dateRange&&(t=t.filter(r=>r.timestamp>=s.dateRange.start&&r.timestamp<=s.dateRange.end))),{activities:t,lastUpdated:new Date,totalActivities:t.length}}getHeroActivities(s,t=50){return this.activities.filter(r=>r.data.heroId===s).slice(0,t)}getRecentActivities(s=20){return this.activities.slice(0,s)}likeActivity(s){const t=this.activities.find(r=>r.id===s);return t?(t.likes++,this.saveActivities(),!0):!1}addComment(s,t,r,i){const n=this.activities.find(o=>o.id===s);if(n){const o={id:`comment-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,authorId:t,authorName:r,content:i,timestamp:new Date};return n.comments.push(o),this.saveActivities(),!0}return!1}shareActivity(s){const t=this.activities.find(n=>n.id===s);if(!t)return null;t.shares++,this.saveActivities();const r=`${window.location.origin}/activity/${s}`,i=`Confira esta conquista Ã©pica no HeroForge: ${t.message}`;return{activity:t,shareUrl:r,shareText:i}}getActivityStats(s){var d;const t=s?this.activities.filter(m=>m.data.heroId===s):this.activities,r=new Date,i=new Date(r.getTime()-7*24*60*60*1e3),n=new Date(r.getTime()-30*24*60*60*1e3),o={},c={};t.forEach(m=>{o[m.type]=(o[m.type]||0)+1;const u=m.timestamp.toDateString();c[u]=(c[u]||0)+1});const l=((d=Object.entries(c).sort(([,m],[,u])=>u-m)[0])==null?void 0:d[0])||"Nenhum";return{totalActivities:t.length,activitiesByType:o,activitiesThisWeek:t.filter(m=>m.timestamp>=i).length,activitiesThisMonth:t.filter(m=>m.timestamp>=n).length,mostActiveDay:l}}cleanupOldActivities(s=90){const t=new Date;t.setDate(t.getDate()-s);const r=this.activities.length;this.activities=this.activities.filter(n=>n.timestamp>=t);const i=r-this.activities.length;return i>0&&this.saveActivities(),i}saveActivities(){try{const s={activities:this.activities,lastSaved:new Date().toISOString()};localStorage.setItem("heroforge-activities",JSON.stringify(s))}catch(s){console.error("Erro ao salvar atividades:",s)}}loadActivities(){try{const s=localStorage.getItem("heroforge-activities");if(s){const t=JSON.parse(s);this.activities=(t.activities||[]).map(r=>({...r,timestamp:new Date(r.timestamp),comments:(r.comments||[]).map(i=>({...i,timestamp:new Date(i.timestamp)}))}))}}catch(s){console.error("Erro ao carregar atividades:",s),this.activities=[]}}exportActivities(s){const t=s?this.getHeroActivities(s):this.getRecentActivities(),r={heroForgeActivities:t,exportedAt:new Date().toISOString(),totalActivities:t.length};return JSON.stringify(r,null,2)}};Ue(Sa,"instance");let ar=Sa;const vt=ar.getInstance(),gt={questCompleted:a=>vt.createActivity("quest-completed",a),epicQuestCompleted:a=>vt.createActivity("epic-quest-completed",a),levelUp:a=>vt.createActivity("level-up",a),achievementUnlocked:a=>vt.createActivity("achievement-unlocked",a),titleEarned:a=>vt.createActivity("title-earned",a),eventCompleted:a=>vt.createActivity("event-completed",a),dailyGoalCompleted:a=>vt.createActivity("daily-goal-completed",a),combatVictory:a=>vt.createActivity("combat-victory",a),rankPromotion:a=>vt.createActivity("rank-promotion",a),tavernRest:a=>vt.createActivity("tavern-rest",a),itemUsed:a=>vt.createActivity("item-used",a),guildEventActivated:a=>vt.createActivity("guild-event-activated",a),petHatched:a=>vt.createActivity("pet-hatched",a),tavernDice:a=>vt.createActivity("tavern-dice",a)},Ca=class Ca{constructor(){Ue(this,"celebrations",[])}static getInstance(){return Ca.instance||(Ca.instance=new Ca),Ca.instance}calculateRank(s){var r;let t="F";for(const i of Xt){const n=_a[i],o=s.progression.xp>=n.xp,c=(s.stats.questsCompleted||0)>=n.missions,l=!n.titles||(((r=s.titles)==null?void 0:r.length)||0)>=n.titles,d=this.checkSpecialRequirements(s,n.specialRequirements);if(o&&c&&l&&d)t=i;else break}return t}checkSpecialRequirements(s,t){if(!t)return!0;for(const r of t)switch(r){case"legendary_quest":if(!Array.isArray(s.achievements)||!s.achievements.some(i=>(i==null?void 0:i.rarity)==="lendario"||String((i==null?void 0:i.name)||"").toLowerCase().includes("lendÃ¡rio")||String((i==null?void 0:i.name)||"").toLowerCase().includes("lendario")||String((i==null?void 0:i.description)||"").toLowerCase().includes("lendÃ¡rio")||String((i==null?void 0:i.description)||"").toLowerCase().includes("lendario")))return!1;break;case"epic_achievement":if(!Array.isArray(s.achievements)||!s.achievements.some(i=>(i==null?void 0:i.rarity)==="epico"||String((i==null?void 0:i.name)||"").toLowerCase().includes("Ã©pico")||String((i==null?void 0:i.name)||"").toLowerCase().includes("epico")||String((i==null?void 0:i.description)||"").toLowerCase().includes("Ã©pico")||String((i==null?void 0:i.description)||"").toLowerCase().includes("epico")))return!1;break}return!0}calculateProgress(s){var u;const t=this.calculateRank(s),r=Xt.indexOf(t),i=r<Xt.length-1?Xt[r+1]:null;if(!i)return{currentRank:t,nextRank:null,currentXP:s.progression.xp,requiredXP:s.progression.xp,currentMissions:s.stats.questsCompleted||0,requiredMissions:s.stats.questsCompleted||0,progressPercentage:100,canPromote:!1};const n=_a[i],o=_a[t],c=Math.min(100,(s.progression.xp-o.xp)/(n.xp-o.xp)*100),l=Math.min(100,(s.stats.questsCompleted||0)/n.missions*100),d=Math.min(c,l),m=s.progression.xp>=n.xp&&(s.stats.questsCompleted||0)>=n.missions&&(!n.titles||(((u=s.titles)==null?void 0:u.length)||0)>=n.titles)&&this.checkSpecialRequirements(s,n.specialRequirements);return{currentRank:t,nextRank:i,currentXP:s.progression.xp,requiredXP:n.xp,currentMissions:s.stats.questsCompleted||0,requiredMissions:n.missions,progressPercentage:d,canPromote:m}}promoteHero(s,t){const r=this.calculateProgress(s);if(!r.canPromote||!r.nextRank)return{promoted:!1};const i=r.nextRank,n=this.createCelebration(i,s);return gt.rankPromotion({heroId:s.id,heroName:s.name,heroClass:s.class,previousRank:t.currentRank,newRank:i}),{promoted:!0,newRank:i,celebration:n}}createCelebration(s,t){const r=fa[s],i=Ga[s]||[];let n="ascension";return["S","SS","SSS"].includes(s)?n="legendary":["A","B"].includes(s)&&(n="epic"),{rank:s,title:`PromoÃ§Ã£o para ${r.name}!`,message:`ParabÃ©ns, ${t.name}! VocÃª alcanÃ§ou o rank ${s} - ${r.name}. ${r.description}`,rewards:[...i.map(o=>({...o,unlocked:!0}))],animationType:n,soundEffect:["S","SS","SSS"].includes(s)?"legendary_fanfare":"rank_up_trumpet",particleEffect:["S","SS","SSS"].includes(s)?"golden_explosion":"sparkle_burst"}}getNotableAchievement(s,t){const r=[`AlcanÃ§ou ${s.progression.xp} XP total`,`Completou ${s.stats.questsCompleted||0} missÃµes`,`NÃ­vel ${s.progression.level} conquistado`,`Classe ${s.class} dominada`];return s.achievements&&s.achievements.length>0&&r.push(s.achievements[s.achievements.length-1]),r[Math.floor(Math.random()*r.length)]}calculateRankPoints(s){var c,l;const t=s.progression.xp,r=(s.stats.questsCompleted||0)*50,i=s.progression.level*100,n=(((c=s.titles)==null?void 0:c.length)||0)*200,o=(((l=s.achievements)==null?void 0:l.length)||0)*150;return t+r+i+n+o}createComparison(s,t){return{heroId:s.id,heroName:s.name,rank:this.calculateRank(s),level:s.progression.level,totalXP:s.progression.xp,missionsCompleted:s.stats.questsCompleted||0,rankPoints:this.calculateRankPoints(s),position:t}}checkPendingRewards(s,t){const r=this.calculateRank(s),i=Ga[r]||[],n=t.unlockedRewards.map(o=>o.name);return i.filter(o=>!n.includes(o.name))}initializeRankData(s){var r;const t=this.calculateRank(s);return{currentRank:t,rankHistory:[{rank:t,achievedAt:new Date,heroLevel:s.progression.level,notableAchievement:"InÃ­cio da jornada Ã©pica",celebrationViewed:!0}],totalRankPoints:this.calculateRankPoints(s),rankProgress:this.calculateProgress(s),unlockedRewards:((r=Ga[t])==null?void 0:r.map(i=>({...i,unlocked:!0})))||[],pendingCelebrations:[],rankAchievements:{fastestPromotion:0,highestRankReached:t,totalPromotions:0,legendaryStoriesUnlocked:0}}}updateRankData(s,t){const r=this.calculateRank(s),i=this.calculateProgress(s),n=this.calculateRankPoints(s);if(r!==t.currentRank){const o=this.createCelebration(r,s),c={rank:r,achievedAt:new Date,heroLevel:s.progression.level,notableAchievement:this.getNotableAchievement(s,r),celebrationViewed:!1};try{gt.rankPromotion({heroId:s.id,heroName:s.name,heroClass:s.class,previousRank:t.currentRank,newRank:r})}catch{}const l=t.unlockedRewards||[],d=new Set(l.map(u=>u.name)),m=(Ga[r]||[]).filter(u=>!d.has(u.name)).map(u=>({...u,unlocked:!0}));return{...t,currentRank:r,rankHistory:[...t.rankHistory,c],totalRankPoints:n,rankProgress:i,unlockedRewards:[...l,...m],pendingCelebrations:[...t.pendingCelebrations,o],rankAchievements:{...t.rankAchievements,highestRankReached:r,totalPromotions:t.rankAchievements.totalPromotions+1}}}return{...t,totalRankPoints:n,rankProgress:i}}getRankInfo(s){return fa[s]}getRankRewards(s){return Ga[s]||[]}estimateTimeToNextRank(s){const t=this.calculateProgress(s);if(!t.nextRank)return{days:0,description:"Rank mÃ¡ximo alcanÃ§ado!"};const r=t.requiredXP-t.currentXP,i=t.requiredMissions-t.currentMissions,n=Math.ceil(r/100),c=Math.max(n,i);let l="";return c<=1?l="Muito prÃ³ximo da promoÃ§Ã£o!":c<=7?l=`Aproximadamente ${c} dias`:c<=30?l=`Cerca de ${Math.ceil(c/7)} semanas`:l=`Aproximadamente ${Math.ceil(c/30)} meses`,{days:c,description:l}}};Ue(Ca,"instance");let sr=Ca;const We=sr.getInstance(),ei=[{name:"Desprezado",threshold:-1e3,color:"text-red-500",description:"VocÃª Ã© visto como um inimigo desta facÃ§Ã£o",questModifiers:{goldBonus:-.5,xpBonus:-.3,specialQuestsUnlocked:[]}},{name:"Hostil",threshold:-500,color:"text-red-400",description:"Esta facÃ§Ã£o nÃ£o confia em vocÃª",questModifiers:{goldBonus:-.3,xpBonus:-.2,specialQuestsUnlocked:[]}},{name:"Desconfiado",threshold:-100,color:"text-orange-400",description:"VocÃª Ã© visto com suspeita",questModifiers:{goldBonus:-.1,xpBonus:0,specialQuestsUnlocked:[]}},{name:"Neutro",threshold:0,color:"text-gray-400",description:"VocÃª nÃ£o tem reputaÃ§Ã£o especial",questModifiers:{goldBonus:0,xpBonus:0,specialQuestsUnlocked:[]}},{name:"AmigÃ¡vel",threshold:100,color:"text-green-400",description:"Esta facÃ§Ã£o gosta de vocÃª",questModifiers:{goldBonus:.1,xpBonus:.1,specialQuestsUnlocked:["friendly_merchant","guild_favor"]}},{name:"Respeitado",threshold:500,color:"text-blue-400",description:"VocÃª Ã© respeitado por esta facÃ§Ã£o",questModifiers:{goldBonus:.25,xpBonus:.2,specialQuestsUnlocked:["elite_missions","faction_secrets"]}},{name:"Reverenciado",threshold:1e3,color:"text-purple-400",description:"VocÃª Ã© uma lenda para esta facÃ§Ã£o",questModifiers:{goldBonus:.5,xpBonus:.3,specialQuestsUnlocked:["legendary_quests","faction_champion"]}}],jr={"Guarda da Cidade":{description:"Defensores da lei e da ordem nas ruas",opposingFactions:["LadrÃµes","Cultistas"],allyFactions:["Clero","Comerciantes"],minRankRequirement:"E"},LadrÃµes:{description:"Guildas clandestinas e redes de contrabando",opposingFactions:["Guarda da Cidade","Comerciantes"],allyFactions:["Cultistas"],minRankRequirement:"D"},Clero:{description:"Ordens sagradas, templos e curandeiros",opposingFactions:["Cultistas"],allyFactions:["Guarda da Cidade"],minRankRequirement:"D"},Cultistas:{description:"Seitas profanas e rituais sombrios",opposingFactions:["Clero","Guarda da Cidade"],allyFactions:["LadrÃµes"],minRankRequirement:"B"},Comerciantes:{description:"Companhias de comÃ©rcio, caravanas e mercados",opposingFactions:["LadrÃµes"],allyFactions:["Guarda da Cidade","Exploradores"],minRankRequirement:"E"},Exploradores:{description:"CartÃ³grafos, aventureiros e descobridores de rotas",opposingFactions:[],allyFactions:["Comerciantes"],minRankRequirement:"D"}};function As(a){return[...ei].reverse().find(t=>a>=t.threshold)||ei[0]}function ac(a,s,t){const r=(a.reputationFactions||[]).map(i=>{if(i.name===s){const n=Math.max(-1e3,Math.min(1e3,i.reputation+t)),o=jr[s];return o&&t>0&&o.opposingFactions.forEach(c=>{const l=(a.reputationFactions||[]).findIndex(d=>d.name===c);l!==-1&&((a.reputationFactions||[])[l].reputation=Math.max(-1e3,(a.reputationFactions||[])[l].reputation-Math.floor(t*.3)))}),{...i,reputation:n}}return i});return{...a,reputationFactions:r}}function sc(a,s){const t=(a.reputationFactions||[]).find(c=>c.name===s);if(!t)return{goldBonus:0,xpBonus:0};const r=As(t.reputation),i=jr[s],n=We.calculateRank(a);return!(i!=null&&i.minRankRequirement)||Xt.indexOf(n)>=Xt.indexOf(i.minRankRequirement)?r.questModifiers:{goldBonus:0,xpBonus:0}}function rc(a){const s=As(a);return`${s.name}: ${s.description}`}function ic(a){const s=[];return(a.completedQuests||[]).length>0&&(s.push({factionName:"Guarda da Cidade",change:10,reason:"Apoiou a seguranÃ§a urbana"}),s.push({factionName:"LadrÃµes",change:-3,reason:"AÃ§Ãµes que atrapalham redes clandestinas"})),s}function nc(a){const s=`${a.title} ${a.description}`.toLowerCase(),r={rapida:1,facil:2,padrao:3,medio:5,dificil:8,epica:12}[a.difficulty]??3,i=[];if(a.isGuildQuest){const d={facil:5,medio:8,dificil:12,epica:20}[a.difficulty]??6;return i.push({factionName:"Guarda da Cidade",change:d,reason:"MissÃ£o de guilda"}),i}a.type==="exploracao"?i.push({factionName:"Exploradores",change:r,reason:"ExploraÃ§Ã£o e mapeamento"}):(a.type==="caca"||a.type==="contrato"||a.type==="historia")&&i.push({factionName:"Guarda da Cidade",change:r,reason:"ProteÃ§Ã£o e estabilidade"}),[{re:/(comerciante|mercador|rota|caravana)/,faction:"Comerciantes",delta:Math.max(1,Math.floor(r*.5)),reason:"Apoio ao comÃ©rcio"},{re:/(cultista|ritual|profano|blasfemo)/,faction:"Cultistas",delta:-Math.max(1,Math.floor(r*.4)),reason:"Combate a seitas profanas"},{re:/(ladrao|roubo|contrabando|clandestino|assassino)/,faction:"LadrÃµes",delta:-Math.max(1,Math.floor(r*.4)),reason:"RepressÃ£o ao crime"},{re:/(resgatar|defender|patrulha|guarda|protege|lei|ordem)/,faction:"Guarda da Cidade",delta:Math.max(1,Math.floor(r*.5)),reason:"AÃ§Ãµes de seguranÃ§a"},{re:/(igreja|templo|cura|sagrado)/,faction:"Clero",delta:Math.max(1,Math.floor(r*.4)),reason:"ServiÃ§o aos templos"},{re:/(mapear|explorar|ruÃ­nas|descobrir|cartografar)/,faction:"Exploradores",delta:Math.max(1,Math.floor(r*.4)),reason:"ExploraÃ§Ã£o e cartografia"}].forEach(l=>{l.re.test(s)&&i.push({factionName:l.faction,change:l.delta,reason:l.reason})});const o={};i.forEach(l=>{const d=l.factionName;o[d]=o[d]||{change:0,reason:[]},o[d].change+=l.change,l.reason&&o[d].reason.push(l.reason)});const c=Object.entries(o).map(([l,d])=>{var m;return{factionName:l,change:d.change,reason:(m=d.reason)==null?void 0:m.join("; ")}});return c.sort((l,d)=>Math.abs(d.change)-Math.abs(l.change)),c.slice(0,2)}const vs=[{id:"xp",name:"ExperiÃªncia Total",description:"HerÃ³is com mais experiÃªncia acumulada",type:"xp",icon:"â­",color:"text-yellow-400",getValue:a=>{var s;return((s=a.progression)==null?void 0:s.experience)||0},formatValue:a=>`${(a||0).toLocaleString()} XP`},{id:"level",name:"NÃ­vel Mais Alto",description:"HerÃ³is com o maior nÃ­vel alcanÃ§ado",type:"xp",icon:"ğŸ†",color:"text-amber-400",getValue:a=>{var s;return((s=a.progression)==null?void 0:s.level)||0},formatValue:a=>`NÃ­vel ${a||0}`},{id:"gold",name:"Riqueza",description:"HerÃ³is com mais ouro acumulado",type:"gold",icon:"ğŸ’°",color:"text-yellow-500",getValue:a=>{var s;return((s=a.progression)==null?void 0:s.gold)||0},formatValue:a=>`${(a||0).toLocaleString()} ğŸª™`},{id:"quests",name:"MissÃµes Completadas",description:"HerÃ³is que completaram mais missÃµes",type:"quests",icon:"ğŸ“œ",color:"text-blue-400",getValue:a=>(a.completedQuests||[]).length,formatValue:a=>`${a||0} missÃµes`},{id:"achievements",name:"Conquistas",description:"HerÃ³is com mais conquistas desbloqueadas",type:"achievements",icon:"ğŸ…",color:"text-purple-400",getValue:a=>(a.achievements||[]).filter(s=>s.unlockedAt).length,formatValue:a=>`${a||0} conquistas`},{id:"reputation",name:"ReputaÃ§Ã£o Total",description:"HerÃ³is com melhor reputaÃ§Ã£o geral",type:"reputation",icon:"â­",color:"text-green-400",getValue:a=>(a.reputationFactions||[]).reduce((s,t)=>s+Math.max(0,t.reputation),0),formatValue:a=>`${a||0} pontos`},{id:"playtime",name:"Tempo de Jogo",description:"HerÃ³is com mais tempo jogado",type:"playtime",icon:"â°",color:"text-indigo-400",getValue:a=>{var s;return((s=a.stats)==null?void 0:s.totalPlayTime)||0},formatValue:a=>{const s=a||0;return`${Math.floor(s/60)}h ${s%60}m`}}];function Yi(a,s,t=50){const r=a.filter(i=>i.progression.level>0).map(i=>{const n=s.getValue(i),o=typeof n=="number"&&!isNaN(n)?n:0;return{heroId:i.id,heroName:i.name,heroClass:i.class,heroRace:i.race,value:o,rank:0,change:0,lastUpdated:new Date,isNPC:i.origin==="npc"}}).sort((i,n)=>n.value-i.value).slice(0,t);return r.forEach((i,n)=>{i.rank=n+1}),{id:s.id,name:s.name,description:s.description,type:s.type,entries:r,lastUpdated:new Date}}function Ya(a){return vs.map(s=>Yi(a,s))}function Zi(a,s){const r=Ya(s).find(d=>d.id==="xp"),i=(r==null?void 0:r.entries.findIndex(d=>d.heroId===a.id))+1||0,n=s.filter(d=>d.class===a.class),c=Yi(n,vs[0]).entries.findIndex(d=>d.heroId===a.id)+1||0,l=en(a);return{globalRank:i,classRank:c,weeklyRank:0,achievements:(a.achievements||[]).filter(d=>d.unlockedAt).length,totalScore:l}}function en(a){var n,o,c,l;const s=(a.progression.xp||0)+(a.progression.gold||0)+(((n=a.stats)==null?void 0:n.achievementsUnlocked)||0)*100,t=a.inventory?Object.keys(a.inventory.items).length*5:0,r=((c=(o=a.worldState)==null?void 0:o.decisionLog)==null?void 0:c.length)||0,i=((l=a.stats)==null?void 0:l.loginStreak)||0;return s+t+r*10+i*20}function oc(a,s=10){return a.entries.slice(0,s)}function cc(a,s,t=5){const r=a.entries.findIndex(o=>o.heroId===s);if(r===-1)return[];const i=Math.max(0,r-t),n=Math.min(a.entries.length,r+t+1);return a.entries.slice(i,n)}function lc(a){return a>0?`â†—ï¸ +${a}`:a<0?`â†˜ï¸ ${a}`:"â¡ï¸ 0"}function dc(a){return a===1?"text-yellow-400":a===2?"text-gray-300":a===3?"text-orange-400":a<=10?"text-purple-400":a<=50?"text-blue-400":"text-gray-400"}function mc(a){return a===1?"ğŸ¥‡":a===2?"ğŸ¥ˆ":a===3?"ğŸ¥‰":a<=10?"ğŸ†":a<=50?"â­":"ğŸ“Š"}const rr=[{id:"complete-quest",name:"Aventureiro Ativo",description:"Complete 1 missÃ£o",category:"exploration",maxProgress:1,baseRewards:{xp:50,gold:25,glory:5},difficulty:"easy",levelRequirement:1},{id:"gain-xp",name:"Crescimento Constante",description:"Ganhe 100 XP",category:"progression",maxProgress:100,baseRewards:{xp:25,gold:15},difficulty:"easy",levelRequirement:1},{id:"earn-gold",name:"Coletor de Moedas",description:"Ganhe 50 moedas de ouro",category:"collection",maxProgress:50,baseRewards:{xp:30,gold:20},difficulty:"easy",levelRequirement:1},{id:"train-attribute",name:"Fortalecimento",description:"Treine qualquer atributo 1 vez",category:"progression",maxProgress:1,baseRewards:{xp:40,gold:30,arcaneEssence:1},difficulty:"easy",levelRequirement:1},{id:"hatch-pet",name:"Domador Iniciante",description:"Chocar 1 mascote",category:"collection",maxProgress:1,baseRewards:{xp:60,gold:40,arcaneEssence:1},difficulty:"easy",levelRequirement:1},{id:"train-pet",name:"Cuidar do Companheiro",description:"Treinar ou alimentar um mascote 1 vez",category:"progression",maxProgress:1,baseRewards:{xp:50,gold:30},difficulty:"easy",levelRequirement:1},{id:"complete-multiple-quests",name:"HerÃ³i Dedicado",description:"Complete 3 missÃµes",category:"exploration",maxProgress:3,baseRewards:{xp:100,gold:75,glory:10},difficulty:"medium",levelRequirement:3},{id:"defeat-enemies",name:"CaÃ§ador de Monstros",description:"Derrote 5 inimigos",category:"combat",maxProgress:5,baseRewards:{xp:80,gold:60,arcaneEssence:1},difficulty:"medium",levelRequirement:3},{id:"gain-large-xp",name:"Sede de Conhecimento",description:"Ganhe 300 XP",category:"progression",maxProgress:300,baseRewards:{xp:75,gold:50},difficulty:"medium",levelRequirement:3},{id:"social-interaction",name:"Diplomata",description:"Interaja com 3 NPCs diferentes",category:"social",maxProgress:3,baseRewards:{xp:60,gold:40},difficulty:"medium",levelRequirement:3},{id:"epic-quest",name:"Lenda em FormaÃ§Ã£o",description:"Complete 1 missÃ£o Ã©pica",category:"exploration",maxProgress:1,baseRewards:{xp:200,gold:150,glory:15},difficulty:"hard",levelRequirement:5},{id:"level-up",name:"EvoluÃ§Ã£o",description:"Suba 1 nÃ­vel",category:"progression",maxProgress:1,baseRewards:{xp:100,gold:100,glory:10},difficulty:"hard",levelRequirement:5},{id:"reputation-gain",name:"Construtor de ReputaÃ§Ã£o",description:"Ganhe 50 pontos de reputaÃ§Ã£o",category:"social",maxProgress:50,baseRewards:{xp:120,gold:80},difficulty:"hard",levelRequirement:5},{id:"perfect-day",name:"Dia Perfeito",description:"Complete todas as outras metas diÃ¡rias",category:"progression",maxProgress:1,baseRewards:{xp:300,gold:200,glory:20,arcaneEssence:2},difficulty:"hard",levelRequirement:3}];function ti(a){const s=rr.filter(n=>a.progression.level>=n.levelRequirement),t=[],r=new Date;r.setDate(r.getDate()+1),r.setHours(0,0,0,0);const i=s.filter(n=>n.difficulty==="easy");if(i.length>0){const n=i[Math.floor(Math.random()*i.length)];t.push(rs(n,r))}if(a.progression.level>=3){const n=s.filter(c=>c.difficulty==="medium"),o=Math.min(2,n.length);for(let c=0;c<o;c++){const l=n[Math.floor(Math.random()*n.length)];t.some(d=>d.id.includes(l.id))||t.push(rs(l,r))}}if(a.progression.level>=5){const n=s.filter(o=>o.difficulty==="hard"&&o.id!=="perfect-day");if(n.length>0){const o=n[Math.floor(Math.random()*n.length)];t.push(rs(o,r))}}if(t.length>=2&&a.progression.level>=3){const n=rr.find(o=>o.id==="perfect-day");if(n){const o=rs(n,r);o.maxProgress=t.length,o.description=`Complete todas as outras ${t.length} metas diÃ¡rias`,t.push(o)}}return t}function rs(a,s){return{id:`${a.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,description:a.description,progress:0,maxProgress:a.maxProgress,completed:!1,claimed:!1,rewards:{...a.baseRewards},expiresAt:s}}function uc(a,s,t=1){return a.map(r=>{if(r.completed)return r;let i=!1;switch(s){case"quest-completed":i=r.id.includes("complete-quest")||r.id.includes("complete-multiple-quests");break;case"epic-quest-completed":i=r.id.includes("epic-quest");break;case"xp-gained":i=r.id.includes("gain-xp")||r.id.includes("gain-large-xp");break;case"gold-earned":i=r.id.includes("earn-gold");break;case"enemy-defeated":i=r.id.includes("defeat-enemies");break;case"attribute-trained":i=r.id.includes("train-attribute");break;case"level-up":i=r.id.includes("level-up");break;case"reputation-gained":i=r.id.includes("reputation-gain");break;case"npc-interaction":i=r.id.includes("social-interaction");break;case"pet-hatched":i=r.id.includes("hatch-pet");break;case"pet-trained":i=r.id.includes("train-pet");break}if(i){const n=Math.min(r.maxProgress,r.progress+t);return{...r,progress:n,completed:n>=r.maxProgress}}return r})}function pc(a){const s=a.find(i=>i.id.includes("perfect-day"));if(!s||s.completed)return a;const r=a.filter(i=>!i.id.includes("perfect-day")).filter(i=>i.completed).length;return a.map(i=>i.id.includes("perfect-day")?{...i,progress:r,completed:r>=i.maxProgress}:i)}function Ds(a){const s=new Date;return a.filter(t=>(typeof t.expiresAt=="string"?new Date(t.expiresAt):t.expiresAt)>s)}function tn(a){const s=a.id.includes("perfect-day")?1.5:1;return{xp:Math.floor(a.rewards.xp*s),gold:Math.floor(a.rewards.gold*s),glory:a.rewards.glory?Math.floor(a.rewards.glory*s):void 0,arcaneEssence:a.rewards.arcaneEssence?Math.floor(a.rewards.arcaneEssence*s):void 0,items:a.rewards.items}}function gc(a){return a.includes("complete-quest")||a.includes("epic-quest")?"âš”ï¸":a.includes("gain-xp")||a.includes("level-up")?"â­":a.includes("earn-gold")?"ğŸ’°":a.includes("defeat-enemies")?"ğŸ—¡ï¸":a.includes("train-attribute")?"ğŸ’ª":a.includes("social-interaction")||a.includes("reputation-gain")?"ğŸ¤":a.includes("perfect-day")?"ğŸ†":"ğŸ¯"}function xc(a){if(a.includes("perfect-day"))return"text-purple-400";const s=rr.find(t=>a.includes(t.id));if(!s)return"text-gray-400";switch(s.difficulty){case"easy":return"text-green-400";case"medium":return"text-yellow-400";case"hard":return"text-red-400";default:return"text-gray-400"}}const It=[{id:"aprendiz",name:"Aprendiz",description:"AlcanÃ§ou o nÃ­vel 2",rarity:"comum",category:"achievement",badge:"â­",unlockedAt:new Date},{id:"veterano",name:"Veterano",description:"AlcanÃ§ou o nÃ­vel 5",rarity:"raro",category:"achievement",badge:"ğŸŒŸ",unlockedAt:new Date},{id:"campeao",name:"CampeÃ£o",description:"AlcanÃ§ou o nÃ­vel 10",rarity:"epico",category:"achievement",badge:"ğŸ†",unlockedAt:new Date},{id:"wolf-slayer",name:"CaÃ§ador de Lobos",description:"Derrotou 50 lobos em combate",rarity:"comum",category:"combat",badge:"ğŸº",unlockedAt:new Date},{id:"dragon-bane",name:"PerdiÃ§Ã£o dos DragÃµes",description:"Derrotou um dragÃ£o lendÃ¡rio",rarity:"lendario",category:"combat",badge:"ğŸ‰",unlockedAt:new Date},{id:"undead-hunter",name:"CaÃ§ador de Mortos-Vivos",description:"Derrotou 100 criaturas mortas-vivas",rarity:"raro",category:"combat",badge:"ğŸ’€",unlockedAt:new Date},{id:"berserker",name:"Berserker",description:"Venceu 10 combates consecutivos sem usar poÃ§Ãµes",rarity:"epico",category:"combat",badge:"âš”ï¸",unlockedAt:new Date},{id:"pathfinder",name:"Desbravador",description:"Completou 25 missÃµes de exploraÃ§Ã£o",rarity:"comum",category:"exploration",badge:"ğŸ—ºï¸",unlockedAt:new Date},{id:"treasure-hunter",name:"CaÃ§ador de Tesouros",description:"Encontrou 50 itens raros ou superiores",rarity:"raro",category:"exploration",badge:"ğŸ’",unlockedAt:new Date},{id:"master-explorer",name:"Explorador Mestre",description:"Visitou todas as regiÃµes conhecidas",rarity:"epico",category:"exploration",badge:"ğŸŒ",unlockedAt:new Date},{id:"guild-founder",name:"Fundador de Guilda",description:"Criou uma guilda prÃ³spera",rarity:"raro",category:"social",badge:"ğŸ°",unlockedAt:new Date},{id:"mentor",name:"Mentor",description:"Ajudou 10 novos herÃ³is em suas primeiras missÃµes",rarity:"comum",category:"social",badge:"ğŸ‘¨â€ğŸ«",unlockedAt:new Date},{id:"legend",name:"Lenda Viva",description:"AlcanÃ§ou reputaÃ§Ã£o mÃ¡xima com todas as facÃ§Ãµes",rarity:"lendario",category:"social",badge:"ğŸ‘‘",unlockedAt:new Date},{id:"completionist",name:"Completista",description:"Desbloqueou todos os achievements bÃ¡sicos",rarity:"epico",category:"achievement",badge:"ğŸ†",unlockedAt:new Date},{id:"wealthy",name:"Magnata",description:"Acumulou 10.000 moedas de ouro",rarity:"raro",category:"achievement",badge:"ğŸ’°",unlockedAt:new Date},{id:"beta-tester",name:"Testador Beta",description:"Participou dos testes iniciais do Hero Forge",rarity:"especial",category:"special",badge:"ğŸ§ª",unlockedAt:new Date},{id:"first-hero",name:"Primeiro HerÃ³i",description:"Criou o primeiro herÃ³i no Hero Forge",rarity:"especial",category:"special",badge:"ğŸ¥‡",unlockedAt:new Date},{id:"campeao-de-ferro",name:"CampeÃ£o de Ferro",description:"Guerreiro que alcanÃ§ou marcos de domÃ­nio",rarity:"raro",category:"achievement",badge:"ğŸ›¡ï¸",unlockedAt:new Date},{id:"portador-da-lamina-sagrada",name:"Portador da LÃ¢mina Sagrada",description:"Guerreiro celebrado por sua lÃ¢mina consagrada",rarity:"raro",category:"achievement",badge:"âš”ï¸",unlockedAt:new Date},{id:"teurgo-do-veu",name:"Teurgo do VÃ©u",description:"Mago que tocou os vÃ©us do arcano",rarity:"raro",category:"achievement",badge:"ğŸª„",unlockedAt:new Date},{id:"guardiao-dos-arcanos",name:"GuardiÃ£o dos Arcanos",description:"Mago que resguarda segredos antigos",rarity:"epico",category:"achievement",badge:"ğŸ“œ",unlockedAt:new Date},{id:"olho-de-falcao",name:"Olho de FalcÃ£o",description:"Arqueiro de mira impecÃ¡vel",rarity:"raro",category:"achievement",badge:"ğŸ¯",unlockedAt:new Date},{id:"cacador-das-sombras",name:"CaÃ§ador das Sombras",description:"Arqueiro que caÃ§a sem ser visto",rarity:"epico",category:"achievement",badge:"ğŸ¹",unlockedAt:new Date},{id:"mao-da-luz",name:"MÃ£o da Luz",description:"ClÃ©rigo de devoÃ§Ã£o e cura",rarity:"raro",category:"achievement",badge:"âœ¨",unlockedAt:new Date},{id:"protetor-das-almas",name:"Protetor das Almas",description:"ClÃ©rigo que guarda o bem-estar espiritual",rarity:"epico",category:"achievement",badge:"ğŸ•Šï¸",unlockedAt:new Date},{id:"explorador-do-desconhecido",name:"Explorador do Desconhecido",description:"Aventurou-se por territÃ³rios inexplorados",rarity:"raro",category:"exploration",badge:"ğŸ§­",unlockedAt:new Date},{id:"vencedor-das-profundezas",name:"Vencedor das Profundezas",description:"Concluiu uma masmorra completa",rarity:"epico",category:"exploration",badge:"ğŸ”±",unlockedAt:new Date},{id:"domador-da-fortuna",name:"Domador da Fortuna",description:"Encontrou vÃ¡rios tesouros raros",rarity:"raro",category:"exploration",badge:"ğŸ’°",unlockedAt:new Date},{id:"sombra-invicta",name:"Sombra Invicta",description:"Venceu batalhas consecutivas com maestria",rarity:"epico",category:"combat",badge:"ğŸ—¡ï¸",unlockedAt:new Date},{id:"o-persistente",name:"O Persistente",description:"NÃ£o desiste diante de falhas",rarity:"comum",category:"achievement",badge:"ğŸª¨",unlockedAt:new Date},{id:"o-iluminado",name:"O Iluminado",description:"Atingiu grandes patamares de sabedoria",rarity:"lendario",category:"special",badge:"ğŸ”†",unlockedAt:new Date},{id:"aventureiro-iniciante",name:"Aventureiro Iniciante",description:"Primeiros passos na aventura",rarity:"comum",category:"achievement",badge:"ğŸŒ±",unlockedAt:new Date},{id:"veterano-das-estradas",name:"Veterano das Estradas",description:"Longa jornada pelos caminhos do reino",rarity:"raro",category:"achievement",badge:"ğŸ›£ï¸",unlockedAt:new Date},{id:"heroi-local",name:"HerÃ³i Local",description:"Respeitado pelas pessoas da regiÃ£o",rarity:"raro",category:"social",badge:"ğŸ¡",unlockedAt:new Date},{id:"guardiao-do-reino",name:"GuardiÃ£o do Reino",description:"Defensor da paz e da ordem",rarity:"epico",category:"social",badge:"ğŸ›¡ï¸",unlockedAt:new Date},{id:"escolhido-pelo-destino",name:"O Escolhido pelo Destino",description:"Marcado por eventos Ãºnicos",rarity:"lendario",category:"special",badge:"â™¾ï¸",unlockedAt:new Date},{id:"andarilho-eterno",name:"Andarilho Eterno",description:"Explorou incontÃ¡veis lugares",rarity:"epico",category:"exploration",badge:"ğŸ§™â€â™‚ï¸",unlockedAt:new Date},{id:"coracao-de-dragao",name:"CoraÃ§Ã£o de DragÃ£o",description:"Provou coragem frente ao fogo dracÃ´nico",rarity:"lendario",category:"combat",badge:"â¤ï¸â€ğŸ”¥",unlockedAt:new Date},{id:"mente-da-eternidade",name:"Mente da Eternidade",description:"AlcanÃ§ou sabedoria transcendente",rarity:"epico",category:"achievement",badge:"ğŸ§ ",unlockedAt:new Date},{id:"o-insone",name:"O Insone",description:"Sempre presente nas vigÃ­lias noturnas",rarity:"raro",category:"special",badge:"ğŸŒ™",unlockedAt:new Date},{id:"o-generoso",name:"O Generoso",description:"Conhecido por ajudar outros herÃ³is",rarity:"comum",category:"social",badge:"ğŸ",unlockedAt:new Date},{id:"forjador-original",name:"O Forjador Original",description:"Fundador honrado do projeto",rarity:"epico",category:"special",badge:"ğŸ…",unlockedAt:new Date},{id:"lenda-do-povo",name:"A Lenda do Povo",description:"Amado e celebrado nas tavernas",rarity:"raro",category:"social",badge:"ğŸ»",unlockedAt:new Date},{id:"colecionador-de-reliquias",name:"Colecionador de RelÃ­quias",description:"Reuniu um acervo lendÃ¡rio",rarity:"epico",category:"achievement",badge:"ğŸº",unlockedAt:new Date},{id:"mestre-dos-herois",name:"Mestre dos HerÃ³is",description:"Criou herÃ³is memorÃ¡veis",rarity:"epico",category:"social",badge:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦",unlockedAt:new Date},{id:"estrategista-das-cartas",name:"Estrategista das Cartas",description:"Venceu 10 partidas no Jogo das Cartas",rarity:"raro",category:"special",badge:"ğŸƒ",unlockedAt:new Date},{id:"mestre-do-rps",name:"Mestre do RPS",description:"AlcanÃ§ou sequÃªncia de 5 vitÃ³rias em Pedraâ€‘Papelâ€‘Tesoura",rarity:"raro",category:"special",badge:"ğŸ¯",unlockedAt:new Date}],hc=[{id:"wolf-slayer-achievement",name:"CaÃ§ador de Lobos",description:"Derrote 50 lobos em combate",rarity:"comum",unlocked:!1,progress:0,maxProgress:50,rewards:{xp:500,gold:200,title:"wolf-slayer"}},{id:"dragon-bane-achievement",name:"PerdiÃ§Ã£o dos DragÃµes",description:"Derrote um dragÃ£o lendÃ¡rio",rarity:"lendario",unlocked:!1,progress:0,maxProgress:1,rewards:{xp:5e3,gold:2e3,title:"dragon-bane"}},{id:"pathfinder-achievement",name:"Desbravador",description:"Complete 25 missÃµes de exploraÃ§Ã£o",rarity:"comum",unlocked:!1,progress:0,maxProgress:25,rewards:{xp:750,gold:300,title:"pathfinder"}},{id:"treasure-hunter-achievement",name:"CaÃ§ador de Tesouros",description:"Encontre 50 itens raros ou superiores",rarity:"raro",unlocked:!1,progress:0,maxProgress:50,rewards:{xp:1e3,gold:500,title:"treasure-hunter"}},{id:"wealthy-achievement",name:"Magnata",description:"Acumule 10.000 moedas de ouro",rarity:"raro",unlocked:!1,progress:0,maxProgress:1e4,rewards:{xp:2e3,title:"wealthy"}},{id:"cards-champion-achievement",name:"CampeÃ£o das Cartas",description:"VenÃ§a 10 partidas no Jogo das Cartas",rarity:"raro",unlocked:!1,progress:0,maxProgress:10,rewards:{xp:500,gold:250,title:"estrategista-das-cartas"}},{id:"rps-master-achievement",name:"Mestre do RPS",description:"Alcance sequÃªncia de 5 vitÃ³rias em RPS",rarity:"raro",unlocked:!1,progress:0,maxProgress:5,rewards:{xp:400,gold:200,title:"mestre-do-rps"}}];function fc(a,s){return a.filter(t=>t.category===s)}function za(a,s){return a.filter(t=>t.rarity===s)}function an(a){return a.activeTitle&&a.titles.find(s=>s.id===a.activeTitle)||null}function Qa(a){const s=an(a);return s?`${s.badge} ${a.name}, ${s.name}`:a.name}function bc(a){return(a.achievements||[]).map(s=>{var i,n;if(s.unlocked)return s;let t=s.progress;switch(s.id){case"wolf-slayer-achievement":t=a.stats.enemiesDefeated;break;case"pathfinder-achievement":t=a.completedQuests.filter(o=>o.type==="exploration").length;break;case"treasure-hunter-achievement":t=a.stats.itemsFound;break;case"wealthy-achievement":t=a.progression.gold;break;case"cards-champion-achievement":t=Number(((i=a.stats)==null?void 0:i.miniCardsWins)||0);break;case"rps-master-achievement":t=Number(((n=a.stats)==null?void 0:n.miniRpsBestStreak)||0);break}const r=t>=s.maxProgress;return{...s,progress:Math.min(t,s.maxProgress),unlocked:r,unlockedAt:r&&!s.unlocked?new Date:s.unlockedAt}})}const vc={novato:{},aprendiz:{inteligencia:1},veterano:{constituicao:1},campeao:{carisma:1},"wolf-slayer":{forca:1},"dragon-bane":{forca:2,constituicao:2},"undead-hunter":{forca:1,sabedoria:1},berserker:{forca:2},pathfinder:{destreza:2},"treasure-hunter":{destreza:1,inteligencia:1},"master-explorer":{destreza:1,sabedoria:1},"guild-founder":{sabedoria:1,carisma:1},mentor:{carisma:1},legend:{forca:1,destreza:1,constituicao:1,inteligencia:1,sabedoria:1,carisma:1},completionist:{inteligencia:1,sabedoria:1},wealthy:{carisma:1},"beta-tester":{inteligencia:1},"first-hero":{constituicao:1},"campeao-de-ferro":{constituicao:2},"portador-da-lamina-sagrada":{forca:3},"teurgo-do-veu":{inteligencia:2},"guardiao-dos-arcanos":{inteligencia:1,sabedoria:1},"olho-de-falcao":{destreza:2},"cacador-das-sombras":{destreza:1,forca:1},"mao-da-luz":{sabedoria:2},"protetor-das-almas":{sabedoria:1,constituicao:1},"explorador-do-desconhecido":{inteligencia:1},"vencedor-das-profundezas":{sabedoria:1},"domador-da-fortuna":{carisma:1},"sombra-invicta":{destreza:1,forca:1},"o-persistente":{constituicao:1},"o-iluminado":{sabedoria:2},"aventureiro-iniciante":{},"veterano-das-estradas":{carisma:1},"heroi-local":{carisma:1},"guardiao-do-reino":{forca:1,destreza:1,constituicao:1,inteligencia:1,sabedoria:1,carisma:1},"escolhido-pelo-destino":{forca:1,destreza:1,constituicao:1,inteligencia:1,sabedoria:1,carisma:1},"andarilho-eterno":{inteligencia:1},"coracao-de-dragao":{constituicao:2},"mente-da-eternidade":{inteligencia:2},"o-insone":{},"o-generoso":{carisma:1},"forjador-original":{carisma:1},"lenda-do-povo":{carisma:2},"colecionador-de-reliquias":{inteligencia:1},"mestre-dos-herois":{carisma:1},"mestre-dos-dados":{carisma:2,sabedoria:1},"estrategista-das-cartas":{inteligencia:1,carisma:1},"mestre-do-rps":{destreza:1,sabedoria:1}};function ha(a){return a?vc[a]||{}:{}}function is(a){switch(a){case"comum":return"text-gray-400";case"raro":return"text-blue-400";case"epico":return"text-purple-400";case"lendario":return"text-yellow-400";case"especial":return"text-pink-400";default:return"text-gray-400"}}function yc(a){switch(a){case"comum":return"bg-gray-900/20";case"raro":return"bg-blue-900/20";case"epico":return"bg-purple-900/20";case"lendario":return"bg-yellow-900/20";case"especial":return"bg-pink-900/20";default:return"bg-gray-900/20"}}const Xa=[{id:"first-steps",name:"Primeiros Passos",description:"Aprenda o bÃ¡sico do HeroForge",category:"beginner",steps:[{id:"welcome",title:"Bem-vindo ao HeroForge! ğŸ®",description:"Vamos comeÃ§ar sua jornada Ã©pica!",content:"O HeroForge Ã© um sistema de gamificaÃ§Ã£o que transforma suas tarefas diÃ¡rias em aventuras Ã©picas. VocÃª criarÃ¡ herÃ³is, completarÃ¡ missÃµes e evoluirÃ¡ suas habilidades!",position:"center",skippable:!0,autoAdvance:!1},{id:"create-hero",title:"Crie seu Primeiro HerÃ³i",description:"Todo aventureiro precisa de um herÃ³i!",content:'Clique no botÃ£o "Criar HerÃ³i" para comeÃ§ar. Escolha um nome Ã©pico e uma classe que combine com vocÃª!',targetElement:'[data-testid="create-hero-button"]',position:"bottom",action:{type:"navigate",target:"/create"},validation:{type:"hero-created"},rewards:{xp:50,gold:100}},{id:"view-gallery",title:"Ver Galeria",description:"Veja e edite seus herÃ³is",content:"Abra a Galeria para visualizar e personalizar seus herÃ³is e avatares.",targetElement:'[data-testid="open-gallery-button"]',position:"bottom",action:{type:"navigate",target:"/gallery"}},{id:"first-quest",title:"Sua Primeira MissÃ£o",description:"Hora de comeÃ§ar a aventura!",content:"Abra o Quadro de MissÃµes e aceite sua primeira missÃ£o.",targetElement:'[data-testid="open-quests-button"]',position:"top",action:{type:"navigate",target:"/quests"}},{id:"accept-quest",title:"Aceite uma MissÃ£o",description:"Escolha uma missÃ£o adequada ao seu nÃ­vel",content:"Procure por missÃµes elegÃ­veis e aceite uma para comeÃ§ar a jogar.",position:"left",validation:{type:"quest-accepted"},rewards:{xp:25}},{id:"evolution-panel",title:"Evolua seu HerÃ³i",description:"Acompanhe nÃ­veis e ranks",content:"Acesse o painel de evoluÃ§Ã£o para ver seu progresso e conquistas.",targetElement:'[data-testid="open-evolution-button"]',position:"bottom",action:{type:"navigate",target:"/evolution"}},{id:"tutorial-complete",title:"Tutorial ConcluÃ­do! ğŸ‰",description:"VocÃª estÃ¡ pronto para a aventura!",content:"ParabÃ©ns! VocÃª aprendeu o bÃ¡sico do HeroForge. Continue completando missÃµes, evoluindo seu herÃ³i e desbloqueando novos recursos!",position:"center",rewards:{xp:100,gold:200,items:["potion_health","scroll_wisdom"]}}]},{id:"advanced-features",name:"Recursos AvanÃ§ados",description:"Explore funcionalidades avanÃ§adas",category:"intermediate",prerequisites:["first-steps"],steps:[{id:"guild-system",title:"Guilda dos Aventureiros",description:"Una-se a outros herÃ³is!",content:"A Guilda dos Aventureiros Ã© o hub para colaborar e competir em rankings especiais.",position:"top",action:{type:"navigate",target:"/guild-hub"}},{id:"equipment-system",title:"Sistema de Equipamentos",description:"Melhore suas estatÃ­sticas!",content:"Visite a loja para comprar armas, armaduras e acessÃ³rios. Equipamentos melhoram suas estatÃ­sticas e eficiÃªncia em missÃµes.",position:"right",action:{type:"navigate",target:"/shop"}},{id:"achievements",title:"Sistema de Conquistas",description:"Desbloqueie tÃ­tulos especiais!",content:"Complete desafios especÃ­ficos para ganhar conquistas e tÃ­tulos Ãºnicos. Alguns tÃ­tulos oferecem bÃ´nus permanentes!",position:"bottom",action:{type:"navigate",target:"/titles"}},{id:"leaderboards",title:"Rankings Globais",description:"Compete com outros herÃ³is!",content:"Veja como vocÃª se compara a outros jogadores em diferentes categorias: XP, ouro, missÃµes completadas e muito mais!",position:"top",action:{type:"navigate",target:"/leaderboards"}}]},{id:"power-user",name:"UsuÃ¡rio AvanÃ§ado",description:"Domine todas as funcionalidades",category:"advanced",prerequisites:["first-steps","advanced-features"],steps:[{id:"narrative-quests",title:"MissÃµes Narrativas",description:"ExperiÃªncias imersivas!",content:"As missÃµes narrativas oferecem histÃ³rias envolventes com mÃºltiplas escolhas e consequÃªncias. Cada decisÃ£o afeta o resultado!",targetElement:'[data-testid="narrative-quests-tab"]',position:"bottom"},{id:"reputation-system",title:"Sistema de ReputaÃ§Ã£o",description:"Construa relacionamentos!",content:"Sua reputaÃ§Ã£o com diferentes facÃ§Ãµes afeta as missÃµes disponÃ­veis e recompensas. Escolha suas alianÃ§as sabiamente!",targetElement:'[data-testid="reputation-tab"]',position:"right"},{id:"advanced-strategies",title:"EstratÃ©gias AvanÃ§adas",description:"Otimize sua progressÃ£o!",content:"Combine equipamentos, planeje suas missÃµes diÃ¡rias e use consumÃ­veis estrategicamente para maximizar seus ganhos!",position:"center"}]},{id:"unlock-hunting-basic",name:"MissÃµes de CaÃ§a BÃ¡sicas",description:"IntroduÃ§Ã£o Ã s missÃµes de caÃ§a",category:"beginner",steps:[{id:"go-hunting",title:"Nova funcionalidade desbloqueada!",description:"MissÃµes de caÃ§a bÃ¡sicas disponÃ­veis",content:"Abra o painel de CaÃ§a para aceitar sua primeira missÃ£o bÃ¡sica.",action:{type:"navigate",target:"/hunting"}}]},{id:"unlock-shop-basic",name:"Loja de Equipamentos BÃ¡sicos",description:"Aprenda a comprar e equipar itens",category:"beginner",steps:[{id:"go-shop",title:"Loja desbloqueada!",description:"Acesse a loja bÃ¡sica",content:"Visite a loja para comprar equipamentos iniciais.",action:{type:"navigate",target:"/shop"}}]},{id:"unlock-crafting-simple",name:"Craft Simples",description:"Como criar itens bÃ¡sicos",category:"beginner",steps:[{id:"go-forge",title:"Craft desbloqueado!",description:"Acesse a forja",content:"Abra a forja para ver receitas simples e criar um item.",action:{type:"navigate",target:"/hero-forge"}}]}],ka=class ka{constructor(){Ue(this,"currentFlow");Ue(this,"currentStepIndex",0);Ue(this,"completedFlows",new Set);Ue(this,"completedSteps",new Set);Ue(this,"isActive",!1);Ue(this,"callbacks",new Map);Ue(this,"validatedSteps",new Set)}static getInstance(){return ka.instance||(ka.instance=new ka),ka.instance}startFlow(s){const t=Xa.find(r=>r.id===s);return!t||t.prerequisites&&!t.prerequisites.every(i=>this.completedFlows.has(i))?!1:(this.currentFlow=t,this.currentStepIndex=0,this.isActive=!0,this.emit("flow-started",{flow:t}),this.emit("step-changed",{step:this.getCurrentStep()}),this.saveState(),!0)}getCurrentStep(){return!this.currentFlow||!this.isActive?null:this.currentFlow.steps[this.currentStepIndex]||null}nextStep(){if(!this.currentFlow||!this.isActive)return!1;const s=this.getCurrentStep();if(s){if(s.validation&&!this.isStepValidated(s.id))return this.emit("validation-required",{step:s}),!1;this.markStepCompleted(s.id),this.emit("step-completed",{step:s})}return this.currentStepIndex++,this.currentStepIndex>=this.currentFlow.steps.length?(this.completeFlow(),!1):(this.emit("step-changed",{step:this.getCurrentStep()}),this.saveState(),!0)}previousStep(){return!this.currentFlow||!this.isActive||this.currentStepIndex<=0?!1:(this.currentStepIndex--,this.emit("step-changed",{step:this.getCurrentStep()}),this.saveState(),!0)}skipStep(){const s=this.getCurrentStep();if(!s||!s.skippable)return!1;const t=this.nextStep();return t&&this.saveState(),t}completeFlow(){this.currentFlow&&(this.completedFlows.add(this.currentFlow.id),this.emit("flow-completed",{flow:this.currentFlow}),this.reset(),this.saveState())}reset(){this.currentFlow=void 0,this.currentStepIndex=0,this.isActive=!1,this.emit("onboarding-reset"),this.saveState()}markStepCompleted(s){this.completedSteps.add(s),this.saveState()}isStepCompleted(s){return this.completedSteps.has(s)}markStepValidated(s){this.validatedSteps.add(s),this.emit("step-validated",{stepId:s}),this.saveState()}isStepValidated(s){return this.validatedSteps.has(s)}isFlowCompleted(s){return this.completedFlows.has(s)}getAvailableFlows(){return Xa.filter(s=>this.isFlowCompleted(s.id)?!1:s.prerequisites?s.prerequisites.every(t=>this.isFlowCompleted(t)):!0)}getProgress(){const s=Xa.reduce((r,i)=>r+i.steps.length,0),t=this.completedSteps.size;return{completed:t,total:s,percentage:s>0?Math.round(t/s*100):0}}on(s,t){this.callbacks.has(s)||this.callbacks.set(s,[]),this.callbacks.get(s).push(t)}off(s,t){const r=this.callbacks.get(s);if(r){const i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(s,t){const r=this.callbacks.get(s);r&&r.forEach(i=>i(t))}saveState(){var t;const s={completedFlows:Array.from(this.completedFlows),completedSteps:Array.from(this.completedSteps),validatedSteps:Array.from(this.validatedSteps),currentFlow:(t=this.currentFlow)==null?void 0:t.id,currentStepIndex:this.currentStepIndex,isActive:this.isActive};localStorage.setItem("heroforge-onboarding",JSON.stringify(s))}loadState(){const s=localStorage.getItem("heroforge-onboarding");if(s)try{const t=JSON.parse(s);this.completedFlows=new Set(t.completedFlows||[]),this.completedSteps=new Set(t.completedSteps||[]),this.validatedSteps=new Set(t.validatedSteps||[]),this.currentStepIndex=t.currentStepIndex||0,this.isActive=t.isActive||!1,t.currentFlow&&this.isActive&&(this.currentFlow=Xa.find(r=>r.id===t.currentFlow))}catch(t){console.error("Failed to load onboarding state:",t)}}};Ue(ka,"instance");let ir=ka;const Ve=ir.getInstance(),jc=[{name:"CaÃ§ador de XP",description:"Ganhe experiÃªncia completando tarefas",type:"daily",objective:"Ganhar {target} pontos de experiÃªncia",targetValue:500,progressType:"xp-gained",rewards:[{type:"gold",amount:100},{type:"xp",amount:50}],icon:"âš¡",color:"from-yellow-400 to-orange-500",rarity:"common"},{name:"Completador de MissÃµes",description:"Complete missÃµes para ganhar recompensas",type:"daily",objective:"Completar {target} missÃµes",targetValue:3,progressType:"quests-completed",rewards:[{type:"gold",amount:150},{type:"xp",amount:100}],icon:"ğŸ¯",color:"from-blue-400 to-blue-600",rarity:"common"},{name:"Coletor de Ouro",description:"Acumule ouro atravÃ©s de suas aventuras",type:"daily",objective:"Ganhar {target} moedas de ouro",targetValue:300,progressType:"gold-earned",rewards:[{type:"xp",amount:200},{type:"gold",amount:50}],icon:"ğŸ’°",color:"from-yellow-500 to-yellow-600",rarity:"common"},{name:"AscensÃ£o Heroica",description:"Evolua seu herÃ³i subindo de nÃ­vel",type:"daily",objective:"Subir {target} nÃ­vel(is)",targetValue:1,progressType:"levels-gained",rewards:[{type:"gold",amount:300},{type:"xp",amount:150},{type:"title",titleId:"level-master"}],icon:"ğŸŒŸ",color:"from-purple-400 to-purple-600",rarity:"rare"}],wc=[{name:"Maratona Semanal",description:"Uma semana intensa de aventuras",type:"weekly",objective:"Ganhar {target} pontos de experiÃªncia",targetValue:2500,progressType:"xp-gained",rewards:[{type:"gold",amount:500},{type:"xp",amount:300},{type:"title",titleId:"weekly-champion"}],icon:"ğŸƒâ€â™‚ï¸",color:"from-green-400 to-green-600",rarity:"epic"},{name:"Mestre das MissÃµes",description:"Domine a arte de completar missÃµes",type:"weekly",objective:"Completar {target} missÃµes",targetValue:15,progressType:"quests-completed",rewards:[{type:"gold",amount:750},{type:"xp",amount:400},{type:"title",titleId:"quest-master"}],icon:"ğŸ—¡ï¸",color:"from-red-400 to-red-600",rarity:"epic"},{name:"Fortuna Dourada",description:"Acumule uma fortuna em ouro",type:"weekly",objective:"Ganhar {target} moedas de ouro",targetValue:1500,progressType:"gold-earned",rewards:[{type:"gold",amount:1e3},{type:"xp",amount:500},{type:"title",titleId:"gold-collector"}],icon:"ğŸ‘‘",color:"from-yellow-400 to-yellow-600",rarity:"legendary"}],Aa=class Aa{constructor(){Ue(this,"events",[]);Ue(this,"eventProgress",[]);Ue(this,"rotation");this.rotation=this.initializeRotation(),this.loadState()}static getInstance(){return Aa.instance||(Aa.instance=new Aa),Aa.instance}initializeRotation(){const s=new Date,t=new Date(s);t.setDate(t.getDate()+1),t.setHours(0,0,0,0);const r=new Date(s);return r.setDate(r.getDate()+(7-r.getDay())),r.setHours(0,0,0,0),{dailyEvents:[],weeklyEvents:[],specialEvents:[],lastRotation:s,nextRotation:t}}generateDailyEvents(){const s=new Date,t=new Date(s);return t.setHours(23,59,59,999),this.shuffleArray([...jc]).slice(0,Math.floor(Math.random()*2)+2).map((i,n)=>({...i,id:`daily-${s.getTime()}-${n}`,startDate:s,endDate:t,isActive:!0,currentProgress:0,objective:i.objective.replace("{target}",i.targetValue.toString())}))}generateWeeklyEvents(){const s=new Date,t=new Date(s);return t.setDate(t.getDate()+(7-t.getDay())),t.setHours(23,59,59,999),this.shuffleArray([...wc]).slice(0,Math.floor(Math.random()*2)+1).map((i,n)=>({...i,id:`weekly-${s.getTime()}-${n}`,startDate:s,endDate:t,isActive:!0,currentProgress:0,objective:i.objective.replace("{target}",i.targetValue.toString())}))}shuffleArray(s){const t=[...s];for(let r=t.length-1;r>0;r--){const i=Math.floor(Math.random()*(r+1));[t[r],t[i]]=[t[i],t[r]]}return t}checkAndRotateEvents(){const s=new Date;s>=this.rotation.nextRotation&&this.rotateDailyEvents(),s.getDay()===0&&this.rotation.weeklyEvents.length===0&&this.rotateWeeklyEvents(),this.events=this.events.filter(t=>t.endDate>s)}rotateDailyEvents(){const s=this.generateDailyEvents();this.events=this.events.filter(r=>r.type!=="daily"),this.events.push(...s);const t=new Date;t.setDate(t.getDate()+1),t.setHours(0,0,0,0),this.rotation.dailyEvents=s,this.rotation.lastRotation=new Date,this.rotation.nextRotation=t,this.saveState()}rotateWeeklyEvents(){const s=this.generateWeeklyEvents();this.events=this.events.filter(t=>t.type!=="weekly"),this.events.push(...s),this.rotation.weeklyEvents=s,this.saveState()}getActiveEvents(){return this.checkAndRotateEvents(),this.events.filter(s=>s.isActive&&s.endDate>new Date)}updateEventProgress(s,t,r=1){this.getActiveEvents().filter(n=>n.progressType===t).forEach(n=>{let o=this.eventProgress.find(c=>c.eventId===n.id&&c.heroId===s);o||(o={eventId:n.id,heroId:s,progress:0,completed:!1,rewardsClaimed:!1,startedAt:new Date},this.eventProgress.push(o)),o.completed||(o.progress=Math.min(o.progress+r,n.targetValue),o.progress>=n.targetValue&&(o.completed=!0,o.completedAt=new Date))}),this.saveState()}claimEventRewards(s,t){const r=this.eventProgress.find(n=>n.eventId===t&&n.heroId===s),i=this.events.find(n=>n.id===t);return!r||!i||!r.completed||r.rewardsClaimed?null:(r.rewardsClaimed=!0,this.saveState(),i.rewards)}getEventProgress(s){return this.eventProgress.filter(t=>t.heroId===s)}getTimeUntilNextRotation(){const s=new Date,t=this.rotation.nextRotation.getTime()-s.getTime(),r=Math.floor(t/(1e3*60*60)),i=Math.floor(t%(1e3*60*60)/(1e3*60));return{hours:r,minutes:i}}saveState(){const s={events:this.events,eventProgress:this.eventProgress,rotation:this.rotation};localStorage.setItem("heroforge-events",JSON.stringify(s))}loadState(){var t,r;const s=localStorage.getItem("heroforge-events");if(s)try{const i=JSON.parse(s);this.events=((t=i.events)==null?void 0:t.map(n=>({...n,startDate:new Date(n.startDate),endDate:new Date(n.endDate)})))||[],this.eventProgress=((r=i.eventProgress)==null?void 0:r.map(n=>({...n,startedAt:new Date(n.startedAt),completedAt:n.completedAt?new Date(n.completedAt):void 0})))||[],this.rotation=i.rotation?{...i.rotation,lastRotation:new Date(i.rotation.lastRotation),nextRotation:new Date(i.rotation.nextRotation)}:this.initializeRotation()}catch(i){console.error("Error loading event state:",i),this.initializeEvents()}else this.initializeEvents()}initializeEvents(){if(this.events.length===0){const s=this.generateDailyEvents(),t=this.generateWeeklyEvents();this.events=[...s,...t],this.rotation.dailyEvents=s,this.rotation.weeklyEvents=t,this.saveState()}}};Ue(Aa,"instance");let nr=Aa;const ia=nr.getInstance(),Ma=class Ma{constructor(){Ue(this,"metrics",[]);Ue(this,"sessions",[]);Ue(this,"currentSession",null);Ue(this,"alertRules",[]);Ue(this,"alerts",[]);Ue(this,"maxMetrics",1e4);this.loadMetrics(),this.initializeSession(),this.setupPerformanceMonitoring()}static getInstance(){return Ma.instance||(Ma.instance=new Ma),Ma.instance}trackEvent(s,t,r={}){var n;const i={id:`metric-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date,heroId:t,eventType:s,data:r,sessionId:((n=this.currentSession)==null?void 0:n.sessionId)||"unknown",userId:this.getUserId()};this.metrics.unshift(i),this.metrics.length>this.maxMetrics&&(this.metrics=this.metrics.slice(0,this.maxMetrics)),this.currentSession&&this.updateCurrentSession(s,r),this.checkAlerts(i),this.saveMetrics();try{const o=window.gtag;if(o){const l={"purchase-initiated":"begin_checkout","purchase-completed":"purchase","ad-impression":"ad_impression","ad-click":"ad_click","rewarded-ad-completed":"earn_virtual_currency","page-visited":"page_view","hero-created":"hero_created","level-up":"level_up","xp-gained":"xp_gained","gold-gained":"gold_gained","attribute-increased":"attribute_increased","quest-started":"quest_started","quest-completed":"quest_completed","quest-failed":"quest_failed","epic-quest-completed":"epic_quest_completed","combat-started":"combat_started","combat-won":"combat_won","combat-lost":"combat_lost","enemy-defeated":"enemy_defeated","achievement-unlocked":"achievement_unlocked","title-earned":"title_earned","daily-goal-completed":"daily_goal_completed","event-completed":"event_completed","item-acquired":"item_acquired","item-used":"item_used","session-started":"session_started","session-ended":"session_ended","feature-used":"feature_used","tutorial-started":"tutorial_started","tutorial-completed":"tutorial_completed","onboarding-completed":"onboarding_completed","activity-liked":"activity_liked","activity-commented":"activity_commented","activity-shared":"activity_shared","guild-joined":"guild_joined","guild-left":"guild_left"}[s];if(l){const d={hero_id:t,session_id:i.sessionId,user_id:i.userId,...r};s==="purchase-completed"&&(d.transaction_id=r.receiptId||`txn-${Date.now()}`,d.items=[{item_id:r.productId}]),o("event",l,d)}}}catch{}}initializeSession(){this.currentSession={sessionId:`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,startTime:new Date,pagesVisited:[window.location.pathname],actionsPerformed:0,questsCompleted:0,xpGained:0,goldGained:0,achievementsUnlocked:0},this.trackEvent("session-started","system",{userAgent:navigator.userAgent,screenResolution:`${screen.width}x${screen.height}`,language:navigator.language})}endSession(){if(!this.currentSession)return;const s=new Date,t=Math.floor((s.getTime()-this.currentSession.startTime.getTime())/1e3);this.currentSession.endTime=s,this.currentSession.duration=t,this.sessions.unshift(this.currentSession),this.sessions.length>1e3&&(this.sessions=this.sessions.slice(0,1e3)),this.trackEvent("session-ended","system",{duration:t,actionsPerformed:this.currentSession.actionsPerformed,pagesVisited:this.currentSession.pagesVisited.length}),this.saveSessions(),this.currentSession=null}updateCurrentSession(s,t){if(this.currentSession)switch(this.currentSession.actionsPerformed++,s){case"quest-completed":this.currentSession.questsCompleted++;break;case"xp-gained":this.currentSession.xpGained+=t.amount||0;break;case"gold-gained":this.currentSession.goldGained+=t.amount||0;break;case"achievement-unlocked":this.currentSession.achievementsUnlocked++;break;case"page-visited":this.currentSession.pagesVisited.includes(t.page)||this.currentSession.pagesVisited.push(t.page);break}}getEngagementMetrics(s=30){const t=new Date,r=new Date(t.getTime()-s*24*60*60*1e3),i=this.sessions.filter(p=>p.startTime>=r),n=this.getUniqueUsersInPeriod(1),o=this.getUniqueUsersInPeriod(7),c=this.getUniqueUsersInPeriod(30),l=i.reduce((p,g)=>p+(g.duration||0),0),d=i.length>0?l/i.length:0,m=i.reduce((p,g)=>p+g.actionsPerformed,0),u=i.length>0?m/i.length:0;return{dailyActiveUsers:n,weeklyActiveUsers:o,monthlyActiveUsers:c,averageSessionDuration:d,averageActionsPerSession:u,retentionRate:this.calculateRetentionRates(),churnRate:this.calculateChurnRate()}}getGameplayAnalytics(){var u,p;const s=this.metrics.filter(g=>g.eventType==="hero-created"),t=this.metrics.filter(g=>g.eventType==="quest-completed"),r=this.metrics.filter(g=>g.eventType==="xp-gained"),i=this.metrics.filter(g=>g.eventType==="gold-gained"),n={};s.forEach(g=>{const v=g.data.class;n[v]=(n[v]||0)+1});const o=((u=Object.entries(n).sort(([,g],[,v])=>v-g)[0])==null?void 0:u[0])||"Nenhuma",c={};t.forEach(g=>{const v=g.data.questName;c[v]=(c[v]||0)+1});const l=((p=Object.entries(c).sort(([,g],[,v])=>v-g)[0])==null?void 0:p[0])||"Nenhuma",d=r.reduce((g,v)=>g+(v.data.amount||0),0),m=i.reduce((g,v)=>g+(v.data.amount||0),0);return{totalHeroes:s.length,averageHeroLevel:this.calculateAverageHeroLevel(),totalQuestsCompleted:t.length,totalXpGained:d,totalGoldEarned:m,mostPopularClass:o,mostCompletedQuest:l,averageSessionsPerUser:this.calculateAverageSessionsPerUser(),conversionFunnels:this.calculateConversionFunnels()}}getPerformanceMetrics(){var r,i;const s=performance.getEntriesByType("navigation");return{pageLoadTime:((r=s[0])==null?void 0:r.loadEventEnd)-((i=s[0])==null?void 0:i.navigationStart)||0,componentRenderTime:this.getAverageRenderTime(),apiResponseTime:this.getAverageApiResponseTime(),errorRate:this.calculateErrorRate(),crashRate:this.calculateCrashRate(),memoryUsage:this.getMemoryUsage()}}getKPIDashboard(){const s=this.getEngagementMetrics(),t=this.getGameplayAnalytics(),r=this.getPerformanceMetrics();return{overview:{totalUsers:this.getTotalUsers(),activeUsers:s.dailyActiveUsers,totalSessions:this.sessions.length,averageSessionDuration:s.averageSessionDuration},engagement:s,gameplay:t,performance:r,trends:{userGrowth:this.getUserGrowthTrend(),engagementTrend:this.getEngagementTrend(),gameplayTrend:this.getGameplayTrend()}}}getUniqueUsersInPeriod(s){const t=new Date(Date.now()-s*24*60*60*1e3),r=this.sessions.filter(i=>i.startTime>=t);return new Set(r.map(i=>i.heroId).filter(Boolean)).size}calculateRetentionRates(){const s=this.getTotalUsers();return s===0?{day1:0,day7:0,day30:0}:{day1:Math.min(this.getUniqueUsersInPeriod(1)/s,1),day7:Math.min(this.getUniqueUsersInPeriod(7)/s,1),day30:Math.min(this.getUniqueUsersInPeriod(30)/s,1)}}calculateChurnRate(){const s=this.getUniqueUsersInPeriod(30),t=this.getTotalUsers();return t>0?Math.max(0,(t-s)/t):0}calculateAverageHeroLevel(){const s=this.metrics.filter(r=>r.eventType==="level-up");if(s.length===0)return 1;const t=s.map(r=>r.data.newLevel||1);return t.reduce((r,i)=>r+i,0)/t.length}calculateAverageSessionsPerUser(){const s=new Set(this.sessions.map(t=>t.heroId).filter(Boolean));return s.size>0?this.sessions.length/s.size:0}calculateConversionFunnels(){const s=this.metrics.filter(n=>n.eventType==="hero-created").length,t=this.metrics.filter(n=>n.eventType==="quest-completed").length,r=this.metrics.filter(n=>n.eventType==="level-up").length,i=this.metrics.filter(n=>n.eventType==="achievement-unlocked").length;return{heroCreation:s,firstQuest:s>0?t/s:0,firstLevelUp:s>0?r/s:0,firstAchievement:s>0?i/s:0,retention7Days:this.getUniqueUsersInPeriod(7)/Math.max(s,1)}}getTotalUsers(){return new Set(this.sessions.map(t=>t.heroId).filter(Boolean)).size}getUserGrowthTrend(){return Array.from({length:30},(t,r)=>{const i=new Date;return i.setDate(i.getDate()-(29-r)),i.toISOString().split("T")[0]}).map(t=>{const r=new Date(t),i=new Date(r.getTime()+24*60*60*1e3),n=this.metrics.filter(o=>o.eventType==="hero-created"&&o.timestamp>=r&&o.timestamp<i).length;return{date:t,count:n}})}getEngagementTrend(){return Array.from({length:30},(t,r)=>{const i=new Date;return i.setDate(i.getDate()-(29-r)),i.toISOString().split("T")[0]}).map(t=>{const r=new Date(t),i=new Date(r.getTime()+24*60*60*1e3),n=this.sessions.filter(l=>l.startTime>=r&&l.startTime<i),o=n.reduce((l,d)=>l+(d.duration||0),0),c=n.length>0?o/n.length:0;return{date:t,sessions:n.length,duration:c}})}getGameplayTrend(){return Array.from({length:30},(t,r)=>{const i=new Date;return i.setDate(i.getDate()-(29-r)),i.toISOString().split("T")[0]}).map(t=>{const r=new Date(t),i=new Date(r.getTime()+24*60*60*1e3),n=this.metrics.filter(c=>c.eventType==="quest-completed"&&c.timestamp>=r&&c.timestamp<i).length,o=this.metrics.filter(c=>c.eventType==="xp-gained"&&c.timestamp>=r&&c.timestamp<i).reduce((c,l)=>c+(l.data.amount||0),0);return{date:t,quests:n,xp:o}})}setupPerformanceMonitoring(){window.addEventListener("error",s=>{this.trackEvent("error-occurred","system",{message:s.message,filename:s.filename,lineno:s.lineno,colno:s.colno})}),window.addEventListener("unhandledrejection",s=>{var t;this.trackEvent("promise-rejection","system",{reason:((t=s.reason)==null?void 0:t.toString())||"Unknown"})}),"PerformanceObserver"in window&&new PerformanceObserver(t=>{t.getEntries().forEach(r=>{r.entryType==="measure"&&this.trackEvent("performance-measure","system",{name:r.name,duration:r.duration})})}).observe({entryTypes:["measure"]})}getAverageRenderTime(){const s=this.metrics.filter(r=>{var i;return r.eventType==="performance-measure"&&((i=r.data.name)==null?void 0:i.includes("render"))});return s.length===0?0:s.reduce((r,i)=>r+(i.data.duration||0),0)/s.length}getAverageApiResponseTime(){return Math.random()*200+50}calculateErrorRate(){const s=this.metrics.length,t=this.metrics.filter(r=>r.eventType==="error-occurred"||r.eventType==="promise-rejection").length;return s>0?t/s:0}calculateCrashRate(){return .001}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize/1024/1024:0}checkAlerts(s){this.alertRules.forEach(t=>{if(!t.enabled)return;const r=this.extractMetricValue(s,t.metric);if(r===null)return;this.evaluateCondition(r,t.condition,t.threshold)&&this.createAlert(t,s,r)})}extractMetricValue(s,t){var r;switch(t){case"session_duration":return((r=this.currentSession)==null?void 0:r.duration)||0;case"error_rate":return this.calculateErrorRate();case"memory_usage":return this.getMemoryUsage();default:return s.data[t]||null}}evaluateCondition(s,t,r){switch(t){case"greater_than":return s>r;case"less_than":return s<r;case"equals":return s===r;case"not_equals":return s!==r;default:return!1}}createAlert(s,t,r){const i={id:`alert-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,ruleId:s.id,timestamp:new Date,metric:s.metric,value:r,threshold:s.threshold,message:`Alert: ${s.name} - ${s.metric} is ${r} (threshold: ${s.threshold})`,severity:this.calculateSeverity(r,s.threshold),acknowledged:!1};this.alerts.unshift(i),console.warn("Metric Alert:",i.message)}calculateSeverity(s,t){const r=Math.abs(s-t)/t;return r>2?"critical":r>1?"high":r>.5?"medium":"low"}addAlertRule(s){this.alertRules.some(r=>r.id===s.id)?this.alertRules=this.alertRules.map(r=>r.id===s.id?s:r):this.alertRules.unshift(s)}removeAlertRule(s){this.alertRules=this.alertRules.filter(t=>t.id!==s)}getAlertRules(){return[...this.alertRules]}getAlerts(){return[...this.alerts]}acknowledgeAlert(s){this.alerts=this.alerts.map(t=>t.id===s?{...t,acknowledged:!0}:t)}clearAlerts(){this.alerts=[]}getEvents(){return[...this.metrics]}getSessions(){return[...this.sessions]}getUserId(){return localStorage.getItem("heroforge-user-id")||"anonymous"}saveMetrics(){try{const s={metrics:this.metrics.slice(0,1e3),lastSaved:new Date().toISOString()};localStorage.setItem("heroforge-metrics",JSON.stringify(s))}catch(s){console.error("Erro ao salvar mÃ©tricas:",s)}}loadMetrics(){try{const s=localStorage.getItem("heroforge-metrics");if(s){const t=JSON.parse(s);this.metrics=(t.metrics||[]).map(r=>({...r,timestamp:new Date(r.timestamp)}))}}catch(s){console.error("Erro ao carregar mÃ©tricas:",s),this.metrics=[]}}saveSessions(){try{const s={sessions:this.sessions.slice(0,500),lastSaved:new Date().toISOString()};localStorage.setItem("heroforge-sessions",JSON.stringify(s))}catch(s){console.error("Erro ao salvar sessÃµes:",s)}}loadSessions(){try{const s=localStorage.getItem("heroforge-sessions");if(s){const t=JSON.parse(s);this.sessions=(t.sessions||[]).map(r=>({...r,startTime:new Date(r.startTime),endTime:r.endTime?new Date(r.endTime):void 0}))}}catch(s){console.error("Erro ao carregar sessÃµes:",s),this.sessions=[]}}cleanupOldData(s=90){const t=new Date;t.setDate(t.getDate()-s),this.metrics=this.metrics.filter(r=>r.timestamp>=t),this.sessions=this.sessions.filter(r=>r.startTime>=t),this.alerts=this.alerts.filter(r=>r.timestamp>=t),this.saveMetrics(),this.saveSessions()}};Ue(Ma,"instance");let or=Ma;const pt=or.getInstance(),je={heroCreated:(a,s)=>pt.trackEvent("hero-created",a,s),levelUp:(a,s)=>pt.trackEvent("level-up",a,s),questCompleted:(a,s)=>pt.trackEvent("quest-completed",a,s),xpGained:(a,s)=>pt.trackEvent("xp-gained",a,{amount:s}),goldGained:(a,s)=>pt.trackEvent("gold-gained",a,{amount:s}),achievementUnlocked:(a,s)=>pt.trackEvent("achievement-unlocked",a,s),pageVisited:(a,s)=>pt.trackEvent("page-visited",a,{page:s}),featureUsed:(a,s)=>pt.trackEvent("feature-used",a,{feature:s}),featureUsedData:(a,s,t)=>pt.trackEvent("feature-used",a,{feature:s,...t}),attributePointsAllocated:(a,s)=>pt.trackEvent("attribute-increased",a,s),purchaseInitiated:(a,s)=>pt.trackEvent("purchase-initiated",a,{productId:s}),purchaseCompleted:(a,s,t)=>pt.trackEvent("purchase-completed",a,{productId:s,receiptId:t}),adImpression:(a,s)=>pt.trackEvent("ad-impression",a,{placement:s}),adClick:(a,s)=>pt.trackEvent("ad-click",a,{placement:s}),itemAcquired:(a,s)=>pt.trackEvent("item-acquired",a,s),rewardedAdCompleted:(a,s)=>pt.trackEvent("rewarded-ad-completed",a,{reward:s})};window.addEventListener("beforeunload",()=>{var a,s;pt.endSession();try{const t=pt.getKPIDashboard(),r=pt.getEvents(),i=r.filter(p=>p.eventType==="feature-used"),n=i.filter(p=>{var g;return String((g=p.data)==null?void 0:g.feature)==="pwa-installed"}).length,o=r.filter(p=>p.eventType==="purchase-completed").length,c=i.filter(p=>{var g;return String((g=p.data)==null?void 0:g.feature)==="theme-switch"}).length,l=i.filter(p=>{var g;return String((g=p.data)==null?void 0:g.feature)==="frame-switch"}).length,d={kpi:t,installs:n,purchases:o};if(d.customizations={themeSwitches:c,frameSwitches:l},!!((s=(a=import.meta)==null?void 0:a.env)!=null&&s.DEV))return;const u="http://localhost:3001/api/metrics/ingest";try{if(navigator&&typeof navigator.sendBeacon=="function"){const p=new Blob([JSON.stringify(d)],{type:"application/json"});navigator.sendBeacon(u,p)}}catch{}}catch{}});const sn={}.VITE_SUPABASE_URL,rn={}.VITE_SUPABASE_ANON_KEY,nn=String({}.VITE_SUPABASE_DISABLE||"").toLowerCase()==="true",_t=!!(sn&&rn)&&!nn;async function Nc(a,s,t=2,r=300){let i=0;for(;;)try{const n=await fetch(a,s);if(n.status>=500&&i<t){i++,await new Promise(o=>setTimeout(o,r*i));continue}return n}catch(n){if(((n==null?void 0:n.name)==="AbortError"||n instanceof TypeError)&&i<t){i++,await new Promise(c=>setTimeout(c,r*i));continue}throw n}}let ai=!1;function Sc(){var i,n;const a={data:null,error:{message:"Supabase nÃ£o configurado: defina VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY",code:"ENV_MISSING"}},t={select(){return t},insert(){return t},update(){return t},upsert(){return t},delete(){return t},eq(){return t},order(){return t},limit(){return t},then:{then(o){return o(a),Promise.resolve(a)}}.then},r={from(){return t},auth:{onAuthStateChange(o){return{data:{subscription:{unsubscribe(){}}},error:{message:"Supabase nÃ£o configurado",code:"ENV_MISSING"}}},async getUser(){return{data:{user:null},error:{message:"Supabase nÃ£o configurado",code:"ENV_MISSING"}}},async getSession(){return{data:{session:null},error:{message:"Supabase nÃ£o configurado",code:"ENV_MISSING"}}},async signOut(){return{data:{},error:{message:"Supabase nÃ£o configurado",code:"ENV_MISSING"}}},async signInWithOAuth(){return{data:null,error:{message:"Supabase nÃ£o configurado",code:"ENV_MISSING"}}}}};try{!!((n=(i=import.meta)==null?void 0:i.env)!=null&&n.PROD)&&!nn&&!ai&&(console.warn("[Supabase] VariÃ¡veis de ambiente ausentes. Configure .env.local com VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY"),ai=!0)}catch{}return r}const Ze=_t?Yn(sn,rn,{global:{fetch:Nc}}):Sc(),Cc=1;function wu(a){const s=a!=null&&a.hero?a.hero:a,t=s==null?void 0:s.__schema_version;return typeof t=="number"?t:0}function kc(a){const s=a!=null&&a.hero?a.hero:a,{__schema_version:t,...r}=s||{};return r}async function Bt(a,s){if(!a||!(s!=null&&s.id))return null;const t=(s==null?void 0:s.name)||(s==null?void 0:s.id)||"Unknown",r=(s==null?void 0:s.class)||"Unknown",i={id:s.id,user_id:a,name:t,class:r,data:{...s,__schema_version:Cc}},{data:n,error:o}=await Ze.from("heroes").upsert(i,{onConflict:"id"}).select("*").limit(1);return o?(console.error("saveHero error",{code:o==null?void 0:o.code,message:o==null?void 0:o.message,details:o==null?void 0:o.details,hint:o==null?void 0:o.hint,payload:i}),null):n&&n[0]}async function Ac(a){if(!a)return[];const{data:s,error:t}=await Ze.from("heroes").select("*").eq("user_id",a).order("updated_at",{ascending:!1});return t?(console.error("listHeroesByUser error",{code:t==null?void 0:t.code,message:t==null?void 0:t.message,details:t==null?void 0:t.details,hint:t==null?void 0:t.hint,userId:a}),[]):Array.isArray(s)?s:[]}async function $s(a,s){const t=await fetch(`/api/hero/${encodeURIComponent(a)}/can-perform`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({actionType:s})});if(!t.ok)throw new Error("can_perform_error");return t.json()}async function _s(a,s,t={}){const r=await fetch(`/api/hero/${encodeURIComponent(a)}/perform-action`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({actionType:s,payload:t})});if(!r.ok)throw new Error("perform_error");return r.json()}const Mc=({notification:a,onRemove:s})=>{x.useEffect(()=>{const i=setTimeout(()=>{s(a.id)},a.duration||4e3);return()=>clearTimeout(i)},[a.id,a.duration,s]);const t=i=>{switch(i){case"xp":return"bg-blue-600 border-blue-500";case"levelup":return"bg-purple-600 border-purple-500";case"gold":return"bg-yellow-600 border-yellow-500";case"item":return"bg-green-600 border-green-500";case"achievement":return"bg-amber-600 border-amber-500";case"quest":return"bg-indigo-600 border-indigo-500";case"stamina":return"bg-red-600 border-red-500";default:return"bg-gray-600 border-gray-500"}},r=(i,n)=>{if(n)return n;switch(i){case"xp":return"â­";case"levelup":return"ğŸ‰";case"gold":return"ğŸª™";case"item":return"ğŸ“¦";case"achievement":return"ğŸ†";case"quest":return"âš”ï¸";case"stamina":return"ğŸ’¤";default:return"ğŸ“¢"}};return e.jsx("div",{className:`${t(a.type)} border-l-4 p-4 rounded-r-lg shadow-lg transform transition-all duration-300 animate-slide-in-right mb-2`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-2xl mr-3",children:r(a.type,a.icon)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-white font-semibold text-sm",children:[a.title,a.value&&e.jsxs("span",{className:"ml-2 text-lg font-bold",children:["+",a.value]})]}),e.jsx("div",{className:"text-gray-200 text-xs mt-1",children:a.message})]}),e.jsx("button",{onClick:()=>s(a.id),className:"text-white hover:text-gray-300 ml-2 text-lg",children:"Ã—"})]})})},Ec=({notifications:a,onRemove:s})=>e.jsx("div",{className:"fixed top-20 right-4 z-40 max-w-sm space-y-2",children:a.map(t=>e.jsx(Mc,{notification:t,onRemove:s},t.id))}),Rc=()=>{const[a,s]=x.useState([]),t=p=>{const g=Date.now().toString()+Math.random().toString(36).substr(2,9);s(v=>[...v,{...p,id:g}])};return{notifications:a,addNotification:t,removeNotification:p=>{s(g=>g.filter(v=>v.id!==p))},clearAllNotifications:()=>{s([])},notifyXPGain:(p,g)=>{t({type:"xp",title:"XP Ganho!",message:`VocÃª ganhou experiÃªncia de ${g}`,value:p,duration:3e3})},notifyLevelUp:p=>{t({type:"levelup",title:"Level Up!",message:`ParabÃ©ns! VocÃª alcanÃ§ou o nÃ­vel ${p}!`,duration:5e3})},notifyGoldGain:(p,g)=>{t({type:"gold",title:"Ouro Ganho!",message:`VocÃª ganhou ouro de ${g}`,value:p,duration:3e3})},notifyItemReceived:p=>{t({type:"item",title:"Item Recebido!",message:`VocÃª recebeu: ${p}`,duration:4e3})},notifyAchievement:p=>{t({type:"achievement",title:"Conquista Desbloqueada!",message:p,duration:5e3})},notifyQuestComplete:p=>{t({type:"quest",title:"MissÃ£o Completa!",message:`VocÃª completou: ${p}`,duration:4e3})},notifyStaminaLow:()=>{t({type:"stamina",title:"Fadiga Alta!",message:"Descanse para reduzir sua fadiga",duration:3e3})}}};class Pc{constructor(){Ue(this,"listeners",new Set);Ue(this,"recent",new Map);Ue(this,"minIntervalMs",3e4);Ue(this,"recentByType",new Map);Ue(this,"lastAnyTs",0);Ue(this,"globalMinSpacingMs",6e3);Ue(this,"maxPerMinuteByType",{achievement:3,quest:3})}subscribe(s){return this.listeners.add(s),()=>{this.listeners.delete(s)}}emit(s){const t=`${s.type}|${s.title}|${s.message}`,r=Date.now(),i=this.recent.get(t)||0;if(r-i<this.minIntervalMs)return;if(this.recent.set(t,r),this.recent.size>200){const l=r-this.minIntervalMs*2;this.recent.forEach((d,m)=>{d<l&&this.recent.delete(m)})}if(r-this.lastAnyTs<this.globalMinSpacingMs)return;const n=s.type,o=this.maxPerMinuteByType[n]||9999,c=(this.recentByType.get(n)||[]).filter(l=>r-l<6e4);c.length>=o||(c.push(r),this.recentByType.set(n,c),this.lastAnyTs=r,this.listeners.forEach(l=>l(s)))}}const ge=new Pc,Qt={guerreiro:{id:"guerreiro",name:"Guerreiro",icon:"âš”ï¸",description:"Combatente corpo a corpo versÃ¡til com alta durabilidade.",baseAttributes:{forca:4,destreza:3,constituicao:4,inteligencia:2,sabedoria:2,carisma:2},advantages:["Alta sobrevivÃªncia","Dano consistente"],disadvantages:["Pouca mobilidade","Baixo dano mÃ¡gico"],suggestedRaces:["humano","orc","anao"]},mago:{id:"mago",name:"Mago",icon:"ğŸ”®",description:"Especialista em magias ofensivas e controle do campo.",baseAttributes:{forca:1,destreza:2,constituicao:2,inteligencia:5,sabedoria:4,carisma:2},advantages:["Alto dano mÃ¡gico","Controle de Ã¡rea"],disadvantages:["FrÃ¡gil fisicamente","Dependente de energia"],suggestedRaces:["elfo","humano"]},ladino:{id:"ladino",name:"Ladino",icon:"ğŸ—¡ï¸",description:"Ãgil e furtivo, focado em golpes crÃ­ticos e evasÃ£o.",baseAttributes:{forca:2,destreza:5,constituicao:2,inteligencia:3,sabedoria:2,carisma:2},advantages:["Alta evasÃ£o","CrÃ­ticos frequentes"],disadvantages:["FrÃ¡gil contra dano em Ã¡rea"],suggestedRaces:["humano","halfling"]},clerigo:{id:"clerigo",name:"ClÃ©rigo",icon:"âœ¨",description:"GuardiÃ£o da luz, forte em cura e suporte.",baseAttributes:{forca:2,destreza:2,constituicao:3,inteligencia:3,sabedoria:5,carisma:3},advantages:["Curas e purificaÃ§Ãµes","Suporte poderoso"],disadvantages:["Baixo dano fÃ­sico"],suggestedRaces:["humano","elfo"]},patrulheiro:{id:"patrulheiro",name:"Patrulheiro",icon:"ğŸ¹",description:"CaÃ§ador e explorador, equilibrado entre precisÃ£o e utilidade.",baseAttributes:{forca:3,destreza:4,constituicao:3,inteligencia:2,sabedoria:3,carisma:2},advantages:["VersÃ¡til","Bom em ambientes selvagens"],disadvantages:["Menos explosivo que classes especializadas"],suggestedRaces:["elfo","humano"]},paladino:{id:"paladino",name:"Paladino",icon:"ğŸ›¡ï¸",description:"Cavaleiro sagrado com defesa excepcional e suporte divino.",baseAttributes:{forca:4,destreza:2,constituicao:4,inteligencia:2,sabedoria:4,carisma:3},advantages:["Defesa e controle","Suporte luminoso"],disadvantages:["Menos flexÃ­vel ofensivamente"],suggestedRaces:["humano","anao"]},arqueiro:{id:"arqueiro",name:"Arqueiro",icon:"ğŸ¹",description:"Atirador preciso com vantagem Ã  distÃ¢ncia.",baseAttributes:{forca:2,destreza:5,constituicao:2,inteligencia:2,sabedoria:3,carisma:2},advantages:["Alto alcance","CrÃ­ticos"],disadvantages:["FrÃ¡gil em curta distÃ¢ncia"],suggestedRaces:["elfo","halfling"]},bardo:{id:"bardo",name:"Bardo",icon:"ğŸ»",description:"Artista do campo de batalha, mistura de suporte e controle.",baseAttributes:{forca:2,destreza:3,constituicao:2,inteligencia:3,sabedoria:3,carisma:5},advantages:["Buffs de grupo","Ferramentas de controle"],disadvantages:["Dano direto limitado"],suggestedRaces:["humano","elfo"]},monge:{id:"monge",name:"Monge",icon:"ğŸ¥‹",description:"Marcial disciplinado, defesa e regeneraÃ§Ã£o interna.",baseAttributes:{forca:3,destreza:3,constituicao:4,inteligencia:2,sabedoria:3,carisma:2},advantages:["ResistÃªncia e mobilidade"],disadvantages:["Dependente de posicionamento"],requirements:({attributes:a})=>(a.constituicao||0)<3?{ok:!1,message:"Monge requer ConstituiÃ§Ã£o â‰¥ 3."}:{ok:!0},suggestedRaces:["humano"]},assassino:{id:"assassino",name:"Assassino",icon:"ğŸ—¡ï¸",description:"Eliminador furtivo com foco em explosÃ£o e evasÃ£o.",baseAttributes:{forca:2,destreza:5,constituicao:2,inteligencia:3,sabedoria:2,carisma:2},advantages:["ExplosÃ£o e furtividade"],disadvantages:["FrÃ¡gil se revelado"],requirements:({attributes:a})=>(a.destreza||0)<3?{ok:!1,message:"Assassino requer Destreza â‰¥ 3."}:{ok:!0},suggestedRaces:["humano","halfling"]},barbaro:{id:"barbaro",name:"BÃ¡rbaro",icon:"ğŸª“",description:"Bruto indomÃ¡vel com dano fÃ­sico massivo.",baseAttributes:{forca:5,destreza:2,constituicao:4,inteligencia:1,sabedoria:2,carisma:2},advantages:["Dano fÃ­sico alto"],disadvantages:["Baixa defesa mÃ¡gica"],suggestedRaces:["orc","humano"]},lanceiro:{id:"lanceiro",name:"Lanceiro (Dragoon)",icon:"ğŸ‰",description:"Especialista em alcance e controle aÃ©reo.",baseAttributes:{forca:4,destreza:4,constituicao:3,inteligencia:2,sabedoria:2,carisma:2},advantages:["PerfuraÃ§Ã£o e salto"],disadvantages:["Custo alto de energia"],requirements:({attributes:a})=>(a.destreza||0)<3?{ok:!1,message:"Lanceiro requer Destreza â‰¥ 3."}:{ok:!0},suggestedRaces:["elfo","humano"]},druida:{id:"druida",name:"Druida",icon:"ğŸŒ¿",description:"GuardiÃ£o da natureza com curas e transformaÃ§Ãµes.",baseAttributes:{forca:2,destreza:3,constituicao:3,inteligencia:3,sabedoria:4,carisma:2},advantages:["Suporte flexÃ­vel","Controle ambiental"],disadvantages:["Dano direto menor"],suggestedRaces:["elfo","humano"]},feiticeiro:{id:"feiticeiro",name:"Feiticeiro das Trevas",icon:"âœ¨",description:"Manipulador de trevas com debuffs potentes.",baseAttributes:{forca:1,destreza:2,constituicao:2,inteligencia:5,sabedoria:3,carisma:3},advantages:["Debuffs fortes","InvocaÃ§Ãµes"],disadvantages:["FrÃ¡gil, dependente de mana"],suggestedRaces:["humano","orc"]}};function Ic(a){var o;const s=Qt[a.class];if(!s)return 0;const t=(o=s.suggestedRaces)!=null&&o.includes(a.race)?1:0,i=da(a.class,a.race).includes(a.element)?1:0,n=t+i;return n===2?.1:n===1?.05:0}const Tc={guerreiro:[{id:"golpe-poderoso",name:"Golpe Poderoso",description:"Um ataque devastador que causa alto dano fÃ­sico",type:"attack",cost:5,basePower:18,element:"earth",target:"single",cooldown:2},{id:"postura-defensiva",name:"Postura Defensiva",description:"Aumenta a defesa por alguns turnos",type:"buff",cost:3,duration:2,target:"self",effects:{buff:{attribute:"constituicao",percentage:30}}},{id:"grito-guerra",name:"Grito de Guerra",description:"Inspira aliados prÃ³ximos, aumentando seu ataque",type:"support",cost:4,duration:2,target:"ally",effects:{buff:{attribute:"forca",percentage:15}}},{id:"investida-feroz",name:"Investida Feroz",description:"AvanÃ§a rapidamente causando dano e empurrando o alvo",type:"attack",cost:4,basePower:14,element:"physical",target:"single",effects:{special:"knockback_small"}}],mago:[{id:"bola-fogo",name:"Bola de Fogo",description:"LanÃ§a uma esfera flamejante que atinge mÃºltiplos inimigos",type:"attack",cost:6,basePower:20,element:"fire",target:"aoe",cooldown:3},{id:"escudo-arcano",name:"Escudo Arcano",description:"Cria uma barreira mÃ¡gica que reduz dano mÃ¡gico",type:"buff",cost:4,duration:2,target:"self",effects:{special:"magic_resistance_40"}},{id:"sussurros-mente",name:"Sussurros da Mente",description:"Reduz o cooldown das habilidades dos aliados",type:"support",cost:5,target:"ally",effects:{special:"reduce_cooldown_1"}},{id:"rajada-gelo",name:"Rajada de Gelo",description:"Ataque de gelo com chance de reduzir velocidade",type:"attack",cost:5,basePower:16,element:"ice",target:"single",effects:{debuff:{special:"slow"}}}],arqueiro:[{id:"tiro-preciso",name:"Tiro Preciso",description:"Um tiro certeiro com alta chance de crÃ­tico",type:"attack",cost:4,basePower:15,element:"physical",target:"single",effects:{special:"high_crit_chance"}},{id:"passo-silencioso",name:"Passo Silencioso",description:"Aumenta a chance de esquiva por alguns turnos",type:"buff",cost:3,duration:2,target:"self",effects:{buff:{attribute:"destreza",percentage:25}}},{id:"chuva-flechas",name:"Chuva de Flechas",description:"Dispara mÃºltiplas flechas atingindo vÃ¡rios inimigos",type:"attack",cost:6,basePower:12,element:"physical",target:"aoe",cooldown:4},{id:"disparo-penetrante",name:"Disparo Penetrante",description:"Ataque que ignora parte da armadura",type:"attack",cost:5,basePower:13,element:"physical",target:"single",effects:{special:"ignore_armor_small"}}],clerigo:[{id:"luz-curativa",name:"Luz Curativa",description:"Canaliza energia divina para curar ferimentos",type:"support",cost:5,target:"ally",effects:{heal:20}},{id:"bencao",name:"BÃªnÃ§Ã£o",description:"AbenÃ§oa um aliado, aumentando a cura recebida",type:"buff",cost:4,duration:3,target:"ally",effects:{special:"healing_bonus_10"}},{id:"exorcismo",name:"Exorcismo",description:"Ataque sagrado especialmente efetivo contra mortos-vivos",type:"attack",cost:6,basePower:14,element:"light",target:"single",effects:{special:"extra_vs_undead"}}],ladino:[{id:"estocada",name:"Estocada",description:"Ataque furtivo que causa dano extra em alvos desprevenidos",type:"attack",cost:4,basePower:16,element:"physical",target:"single",effects:{special:"sneak_attack_bonus"}},{id:"fuga-sombria",name:"Fuga Sombria",description:"Teleporta para as sombras, ganhando invulnerabilidade temporÃ¡ria",type:"support",cost:3,target:"self",effects:{special:"teleport_invulnerable_1_turn"}},{id:"manobra-enganosa",name:"Manobra Enganosa",description:"Confunde inimigos, fazendo-os errar seus ataques",type:"buff",cost:4,duration:2,target:"single",effects:{debuff:{special:"confusion_miss_chance"}}}],patrulheiro:[{id:"tiro-rastreador",name:"Tiro Rastreador",description:"Marca o alvo e causa dano contÃ­nuo",type:"attack",cost:4,basePower:14,element:"physical",target:"single",effects:{special:"mark_target_dot"}},{id:"camuflagem",name:"Camuflagem",description:"Torna-se invisÃ­vel por alguns turnos",type:"buff",cost:5,duration:2,target:"self",effects:{special:"invisibility"}},{id:"chamado-natureza",name:"Chamado da Natureza",description:"Invoca a ajuda de animais selvagens",type:"support",cost:6,target:"ally",effects:{special:"summon_animal_companion"}}],paladino:[{id:"golpe-sagrado",name:"Golpe Sagrado",description:"Ataque imbuÃ­do com poder divino",type:"attack",cost:5,basePower:16,element:"light",target:"single",cooldown:2},{id:"aura-protecao",name:"Aura de ProteÃ§Ã£o",description:"Protege aliados prÃ³ximos com energia sagrada",type:"buff",cost:6,duration:3,target:"ally",effects:{buff:{attribute:"constituicao",percentage:20}}},{id:"cura-divina",name:"Cura Divina",description:"Canaliza poder divino para curar ferimentos graves",type:"support",cost:7,target:"ally",effects:{heal:25}}],bardo:[{id:"melodia-inspiradora",name:"Melodia Inspiradora",description:"Inspira o grupo, aumentando atributos por alguns turnos",type:"buff",cost:3,duration:2,target:"ally",effects:{buff:{attribute:"carisma",percentage:15}}},{id:"nota-cortante",name:"Nota Cortante",description:"Ataque sonoro rÃ¡pido contra um alvo",type:"attack",cost:4,basePower:12,element:"physical",target:"single"},{id:"bencao-alaude",name:"BÃªnÃ§Ã£o do AlaÃºde",description:"Suporte leve que melhora recuperaÃ§Ã£o",type:"support",cost:5,target:"ally",effects:{special:"recovery_bonus_10"}}],monge:[{id:"golpe-chi",name:"Golpe Chi",description:"Ataque concentrado de energia fÃ­sica",type:"attack",cost:4,basePower:14,element:"physical",target:"single"},{id:"respiracao-interna",name:"RespiraÃ§Ã£o Interna",description:"Aumenta defesa e regenera levemente",type:"buff",cost:3,duration:2,target:"self",effects:{special:"minor_regen",buff:{attribute:"constituicao",percentage:15}}},{id:"chute-giratorio",name:"Chute GiratÃ³rio",description:"Controla o inimigo e reduz sua aÃ§Ã£o",type:"buff",cost:5,duration:1,target:"single",effects:{debuff:{special:"knockdown"}}}],assassino:[{id:"ataque-sombrio",name:"Ataque Sombrio",description:"Golpe das sombras com dano de trevas",type:"attack",cost:4,basePower:15,element:"dark",target:"single"},{id:"golpe-duplo",name:"Golpe Duplo",description:"Dois ataques rÃ¡pidos em sequÃªncia",type:"attack",cost:5,basePower:10,element:"physical",target:"single",effects:{special:"double_strike"}},{id:"fumaca-oculta",name:"FumaÃ§a Oculta",description:"Evade e escapa de perigo por um turno",type:"support",cost:3,target:"self",effects:{special:"escape"}}],barbaro:[{id:"corte-brutal",name:"Corte Brutal",description:"Ataque fÃ­sico poderoso",type:"attack",cost:5,basePower:18,element:"physical",target:"single"},{id:"frenesi",name:"Frenesi",description:"Aumenta ataque por alguns turnos",type:"buff",cost:4,duration:2,target:"self",effects:{buff:{attribute:"forca",percentage:20}}},{id:"rugido-selvagem",name:"Rugido Selvagem",description:"Debuff que reduz a defesa do inimigo",type:"buff",cost:3,duration:2,target:"single",effects:{debuff:{attribute:"constituicao",percentage:15}}}],lanceiro:[{id:"investida-perfurante",name:"Investida Perfurante",description:"Ataque fÃ­sico com perfuraÃ§Ã£o",type:"attack",cost:5,basePower:16,element:"physical",target:"single"},{id:"postura-longa",name:"Postura Longa",description:"Aumenta alcance e defesa",type:"buff",cost:3,duration:2,target:"self",effects:{buff:{attribute:"constituicao",percentage:15}}},{id:"salto-dragao",name:"Salto do DragÃ£o",description:"Controle com salto que atrapalha o inimigo",type:"buff",cost:5,duration:1,target:"single",effects:{debuff:{special:"airborne_control"}}}],druida:[{id:"raiz-aprisionadora",name:"Raiz Aprisionadora",description:"Controla o inimigo com raÃ­zes",type:"buff",cost:4,duration:1,target:"single",effects:{debuff:{special:"root"}}},{id:"cura-natural",name:"Cura Natural",description:"Cura leve de energia da natureza",type:"support",cost:4,target:"ally",effects:{heal:15}},{id:"chamado-fauna",name:"Chamado da Fauna",description:"Invoca um pet temporÃ¡rio",type:"support",cost:5,target:"ally",effects:{special:"summon_pet"}}],feiticeiro:[{id:"seta-sombria",name:"Seta Sombria",description:"Ataque de trevas contra um alvo",type:"attack",cost:5,basePower:16,element:"dark",target:"single"},{id:"corrente-maldita",name:"Corrente Maldita",description:"Debuff que reduz atributos do inimigo",type:"buff",cost:4,duration:2,target:"single",effects:{debuff:{attribute:"forca",percentage:15}}},{id:"drenar-vida",name:"Drenar Vida",description:"Rouba vida do inimigo e recupera o usuÃ¡rio",type:"support",cost:6,target:"single",effects:{special:"lifesteal_small"}}]};function va(a){return Tc[a]||[]}const wr={mago:[{level:3,skills:[{id:"tempestade-arcana",name:"Tempestade Arcana",description:"Dano em Ã¡rea arcano",type:"attack",cost:6,basePower:18,element:"light",target:"aoe",cooldown:3}]},{level:5,skills:[{id:"congelar",name:"Congelar",description:"Stun de gelo por 1 turno",type:"buff",cost:5,duration:1,target:"single",effects:{debuff:{special:"freeze_stun"}}}]},{level:7,skills:[{id:"amplificar-magia",name:"Amplificar Magia",description:"Buff mÃ¡gico avanÃ§ado",type:"buff",cost:5,duration:2,target:"ally",effects:{buff:{attribute:"inteligencia",percentage:20}}}]},{level:10,skills:[{id:"cometa-arcano",name:"Cometa Arcano",description:"Ultimate de alto dano arcano em Ã¡rea",type:"attack",cost:8,basePower:30,element:"light",target:"aoe",cooldown:4}]},{level:12,skills:[{id:"campo-anti-magia",name:"Campo Anti-Magia",description:"Reduz efeitos mÃ¡gicos inimigos",type:"support",cost:6,target:"aoe",effects:{special:"anti_magic_field"}}]},{level:15,skills:[{id:"chama-eterea",name:"Chama EtÃ©rea",description:"Ataque contÃ­nuo de fogo",type:"attack",cost:7,basePower:24,element:"fire",target:"single",effects:{debuff:{special:"burn_dot"}}}]},{level:18,skills:[{id:"tempestade-gelo",name:"Tempestade de Gelo",description:"Ãrea com slow forte",type:"attack",cost:8,basePower:26,element:"ice",target:"aoe",cooldown:4}]},{level:20,skills:[{id:"apoteose-arcana",name:"Apoteose Arcana",description:"Ultimate final: grande poder arcano",type:"attack",cost:10,basePower:38,element:"light",target:"aoe",cooldown:5}]}],bardo:[{level:3,skills:[{id:"cancao-coragem",name:"CanÃ§Ã£o da Coragem",description:"Aumenta ataque do grupo",type:"buff",cost:4,duration:2,target:"ally",effects:{buff:{attribute:"forca",percentage:15}}}]},{level:5,skills:[{id:"balada-cura",name:"Balada da Cura",description:"Cura leve por 3 turnos",type:"support",cost:5,duration:3,target:"ally",effects:{heal:10}}]},{level:7,skills:[{id:"grito-multidao",name:"Grito da MultidÃ£o",description:"Debuff inimigos em Ã¡rea",type:"buff",cost:5,duration:2,target:"aoe",effects:{debuff:{attribute:"destreza",percentage:10}}}]},{level:10,skills:[{id:"sinfonia-final",name:"Sinfonia Final",description:"Ultimate: buff + dano em Ã¡rea",type:"attack",cost:7,basePower:20,element:"physical",target:"aoe",cooldown:4}]},{level:12,skills:[{id:"harmonia-guardia",name:"Harmonia do GuardiÃ£o",description:"Reduz dano recebido",type:"buff",cost:4,duration:2,target:"ally",effects:{special:"damage_reduction_10"}}]},{level:15,skills:[{id:"coro-heroico",name:"Coro Heroico",description:"Aumenta todos atributos por curto perÃ­odo",type:"buff",cost:6,duration:2,target:"ally",effects:{buff:{attribute:"carisma",percentage:20}}}]},{level:18,skills:[{id:"ritmo-desorientador",name:"Ritmo Desorientador",description:"Debuff forte de precisÃ£o inimiga",type:"buff",cost:5,duration:2,target:"aoe",effects:{debuff:{special:"accuracy_down"}}}]},{level:20,skills:[{id:"orquestra-epica",name:"Orquestra Ã‰pica",description:"Ultimate final: grande suporte + dano",type:"attack",cost:9,basePower:28,element:"physical",target:"aoe",cooldown:5}]}],monge:[{level:3,skills:[{id:"punhos-elementais",name:"Punhos Elementais",description:"Ataques com fogo/terra",type:"attack",cost:5,basePower:16,element:"earth",target:"single"}]},{level:5,skills:[{id:"passo-vento",name:"Passo do Vento",description:"Velocidade + esquiva",type:"buff",cost:4,duration:2,target:"self",effects:{special:"evasion_up"}}]},{level:7,skills:[{id:"palma-sagrada",name:"Palma Sagrada",description:"Dano de luz",type:"attack",cost:5,basePower:18,element:"light",target:"single"}]},{level:10,skills:[{id:"punho-dragao",name:"Punho do DragÃ£o",description:"Ultimate fÃ­sico poderoso",type:"attack",cost:8,basePower:28,element:"physical",target:"single",cooldown:4}]},{level:12,skills:[{id:"muralha-chi",name:"Muralha de Chi",description:"Escudo que absorve dano",type:"buff",cost:5,duration:2,target:"self",effects:{special:"shield_medium"}}]},{level:15,skills:[{id:"sequencia-lotus",name:"SequÃªncia de LÃ³tus",description:"Combo multi-golpes",type:"attack",cost:7,basePower:22,element:"physical",target:"single",effects:{special:"multi_hit"}}]},{level:18,skills:[{id:"serenidade-plena",name:"Serenidade Plena",description:"Reduz cooldowns e regenera",type:"support",cost:6,target:"self",effects:{special:"reduce_cd_regen"}}]},{level:20,skills:[{id:"ascese",name:"Ascese",description:"Ultimate: grande buff pessoal",type:"buff",cost:9,duration:3,target:"self",effects:{buff:{attribute:"constituicao",percentage:30}}}]}],assassino:[{level:3,skills:[{id:"veneno-mortal",name:"Veneno Mortal",description:"Dano contÃ­nuo",type:"buff",cost:4,duration:3,target:"single",effects:{debuff:{special:"poison_dot"}}}]},{level:5,skills:[{id:"surpresa-fatal",name:"Surpresa Fatal",description:"CrÃ­tico garantido prÃ³ximo ataque",type:"buff",cost:4,duration:1,target:"self",effects:{special:"guaranteed_crit"}}]},{level:7,skills:[{id:"sombra-replicante",name:"Sombra Replicante",description:"Cria clone que distrai",type:"support",cost:5,target:"ally",effects:{special:"decoy_clone"}}]},{level:10,skills:[{id:"execucao-perfeita",name:"ExecuÃ§Ã£o Perfeita",description:"Ultimate: alto dano single",type:"attack",cost:8,basePower:30,element:"dark",target:"single",cooldown:4}]},{level:12,skills:[{id:"lÃ¢mina-silenciosa",name:"LÃ¢mina Silenciosa",description:"Ataque com bleed",type:"attack",cost:6,basePower:20,element:"physical",target:"single",effects:{debuff:{special:"bleed_dot"}}}]},{level:15,skills:[{id:"passo-sombra",name:"Passo da Sombra",description:"Teleporta e ganha dano bÃ´nus",type:"support",cost:5,target:"self",effects:{special:"shadow_step"}}]},{level:18,skills:[{id:"cadeia-golpes",name:"Cadeia de Golpes",description:"Combo com chance de reset",type:"attack",cost:7,basePower:24,element:"physical",target:"single",effects:{special:"combo_reset_chance"}}]},{level:20,skills:[{id:"matanÃ§a-precisa",name:"MatanÃ§a Precisa",description:"Ultimate final: crÃ­tico massivo",type:"attack",cost:9,basePower:36,element:"dark",target:"single",cooldown:5}]}],paladino:[{level:3,skills:[{id:"martelo-divino",name:"Martelo Divino",description:"Dano + stun",type:"attack",cost:6,basePower:18,element:"light",target:"single",effects:{special:"stun_1"}}]},{level:5,skills:[{id:"lagrima-luz",name:"LÃ¡grima da Luz",description:"Cura mÃ©dia",type:"support",cost:5,target:"ally",effects:{heal:20}}]},{level:7,skills:[{id:"protecao-guardiao",name:"ProteÃ§Ã£o do GuardiÃ£o",description:"Escudo forte",type:"buff",cost:5,duration:2,target:"ally",effects:{special:"strong_shield"}}]},{level:10,skills:[{id:"ascensao-divina",name:"AscensÃ£o Divina",description:"Ultimate sagrado",type:"attack",cost:8,basePower:28,element:"light",target:"aoe",cooldown:4}]},{level:12,skills:[{id:"benÃ§Ã£o-paladina",name:"BenÃ§Ã£o Paladina",description:"Buff de defesa forte",type:"buff",cost:6,duration:2,target:"ally",effects:{buff:{attribute:"constituicao",percentage:25}}}]},{level:15,skills:[{id:"julgar",name:"Julgar",description:"Ataque que reduz dano inimigo",type:"attack",cost:6,basePower:22,element:"light",target:"single",effects:{debuff:{special:"damage_down"}}}]},{level:18,skills:[{id:"voto-guardiÃ£o",name:"Voto do GuardiÃ£o",description:"Protege aliado com escudo",type:"support",cost:6,target:"ally",effects:{special:"link_shield"}}]},{level:20,skills:[{id:"luz-redentora",name:"Luz Redentora",description:"Ultimate final: cura + dano sagrado",type:"attack",cost:10,basePower:34,element:"light",target:"aoe",cooldown:5}]}],clerigo:[{level:3,skills:[{id:"aura-fe",name:"Aura de FÃ©",description:"Buff de grupo",type:"buff",cost:4,duration:2,target:"ally",effects:{special:"group_buff"}}]},{level:5,skills:[{id:"bencao-ancestrais",name:"BenÃ§Ã£o dos Ancestrais",description:"Aumenta XP ganho",type:"support",cost:4,target:"ally",effects:{special:"xp_bonus_10"}}]},{level:7,skills:[{id:"escudo-purificador",name:"Escudo Purificador",description:"Remove debuffs",type:"support",cost:4,target:"ally",effects:{special:"cleanse"}}]},{level:10,skills:[{id:"milagre-supremo",name:"Milagre Supremo",description:"Ultimate: grande cura",type:"support",cost:8,target:"ally",effects:{heal:40}}]},{level:12,skills:[{id:"prece-salvaÃ§Ã£o",name:"Prece da SalvaÃ§Ã£o",description:"Ressuscita aliado caÃ­do (limitaÃ§Ãµes)",type:"support",cost:9,target:"ally",effects:{special:"revive_weak"}}]},{level:15,skills:[{id:"luz-serena",name:"Luz Serena",description:"Cura em Ã¡rea moderada",type:"support",cost:6,target:"aoe",effects:{heal:18}}]},{level:18,skills:[{id:"selo-purificaÃ§Ã£o",name:"Selo de PurificaÃ§Ã£o",description:"Remove debuffs em Ã¡rea",type:"support",cost:6,target:"aoe",effects:{special:"mass_cleanse"}}]},{level:20,skills:[{id:"milagre-apoteose",name:"Milagre da Apoteose",description:"Ultimate final: grande cura + buff",type:"support",cost:10,target:"aoe",effects:{heal:45,buff:{attribute:"sabedoria",percentage:20}}}]}],barbaro:[{level:3,skills:[{id:"furia-totemica",name:"FÃºria TotÃªmica",description:"Aumenta dano em Ã¡rea",type:"buff",cost:5,duration:2,target:"self",effects:{special:"aoe_damage_up"}}]},{level:5,skills:[{id:"sangue-berserker",name:"Sangue do Berserker",description:"Aumenta crit + dodge",type:"buff",cost:4,duration:2,target:"self",effects:{special:"crit_dodge_up"}}]},{level:7,skills:[{id:"cortar-esmagar",name:"Cortar e Esmagar",description:"Ataque em Ã¡rea",type:"attack",cost:6,basePower:20,element:"physical",target:"aoe"}]},{level:10,skills:[{id:"ira-tita",name:"Ira do TitÃ£",description:"Ultimate fÃ­sico",type:"attack",cost:8,basePower:30,element:"physical",target:"aoe",cooldown:4}]},{level:12,skills:[{id:"rasgar-armadura",name:"Rasgar Armadura",description:"Reduz armadura inimiga",type:"attack",cost:6,basePower:22,element:"physical",target:"single",effects:{debuff:{special:"armor_break"}}}]},{level:15,skills:[{id:"grito-intimidador",name:"Grito Intimidador",description:"Debuff de dano em Ã¡rea",type:"buff",cost:5,duration:2,target:"aoe",effects:{debuff:{special:"damage_down"}}}]},{level:18,skills:[{id:"frenesi-sangrento",name:"Frenesi Sangrento",description:"Buff de dano com risco",type:"buff",cost:6,duration:2,target:"self",effects:{special:"damage_up_taken_up"}}]},{level:20,skills:[{id:"terremoto-selvagem",name:"Terremoto Selvagem",description:"Ultimate final: Ã¡rea muito forte",type:"attack",cost:10,basePower:36,element:"earth",target:"aoe",cooldown:5}]}],lanceiro:[{level:3,skills:[{id:"lanca-elemental",name:"LanÃ§a Elemental",description:"Ataque elemental",type:"attack",cost:5,basePower:18,element:"thunder",target:"single"}]},{level:5,skills:[{id:"perfuracao-tripla",name:"PerfuraÃ§Ã£o Tripla",description:"TrÃªs golpes rÃ¡pidos",type:"attack",cost:6,basePower:8,element:"physical",target:"single",effects:{special:"triple_strike"}}]},{level:7,skills:[{id:"posicionamento-perfeito",name:"Posicionamento Perfeito",description:"Buff de precisÃ£o",type:"buff",cost:4,duration:2,target:"self",effects:{special:"precision_up"}}]},{level:10,skills:[{id:"impacto-celeste",name:"Impacto Celeste",description:"Ultimate de salto",type:"attack",cost:8,basePower:28,element:"physical",target:"aoe",cooldown:4}]},{level:12,skills:[{id:"investida-raio",name:"Investida do Raio",description:"Ataque de trovÃ£o veloz",type:"attack",cost:6,basePower:22,element:"thunder",target:"single"}]},{level:15,skills:[{id:"postura-fortificada",name:"Postura Fortificada",description:"Grande defesa temporÃ¡ria",type:"buff",cost:6,duration:2,target:"self",effects:{buff:{attribute:"constituicao",percentage:25}}}]},{level:18,skills:[{id:"lanÃ§a-eterna",name:"LanÃ§a EtÃ©rea",description:"Ataque que atravessa mÃºltiplos",type:"attack",cost:7,basePower:24,element:"physical",target:"aoe"}]},{level:20,skills:[{id:"juÃ­zo-do-cÃ©u",name:"JuÃ­zo do CÃ©u",description:"Ultimate final: trovÃ£o em Ã¡rea",type:"attack",cost:10,basePower:35,element:"thunder",target:"aoe",cooldown:5}]}],druida:[{level:3,skills:[{id:"transformacao-parcial",name:"TransformaÃ§Ã£o Parcial",description:"Buff de forÃ§a",type:"buff",cost:4,duration:2,target:"self",effects:{buff:{attribute:"forca",percentage:20}}}]},{level:5,skills:[{id:"erupcao-espinhos",name:"ErupÃ§Ã£o de Espinhos",description:"Ataque em Ã¡rea de terra",type:"attack",cost:5,basePower:18,element:"earth",target:"aoe"}]},{level:7,skills:[{id:"semente-vida",name:"Semente de Vida",description:"Cura contÃ­nua",type:"support",cost:5,duration:3,target:"ally",effects:{special:"heal_over_time"}}]},{level:10,skills:[{id:"forma-primordial",name:"Forma Primordial",description:"Ultimate de transformaÃ§Ã£o",type:"buff",cost:8,duration:3,target:"self",effects:{special:"primal_form"}}]},{level:12,skills:[{id:"pele-casca",name:"Pele de Casca",description:"Buff de armadura natural",type:"buff",cost:5,duration:2,target:"self",effects:{special:"natural_armor"}}]},{level:15,skills:[{id:"chamado-anciÃ£o",name:"Chamado do AnciÃ£o",description:"Invoca entidade poderosa",type:"support",cost:7,target:"ally",effects:{special:"summon_ancient"}}]},{level:18,skills:[{id:"tempestade-folhas",name:"Tempestade de Folhas",description:"Ataque em Ã¡rea de natureza",type:"attack",cost:7,basePower:24,element:"earth",target:"aoe"}]},{level:20,skills:[{id:"equilibrio-primordial",name:"EquilÃ­brio Primordial",description:"Ultimate final: cura + controle",type:"support",cost:10,target:"aoe",effects:{heal:30,debuff:{special:"root"}}}]}],feiticeiro:[{level:3,skills:[{id:"explosao-abissal",name:"ExplosÃ£o Abissal",description:"Ataque de trevas em Ã¡rea",type:"attack",cost:6,basePower:18,element:"dark",target:"aoe"}]},{level:5,skills:[{id:"servos-escuridao",name:"Servos da EscuridÃ£o",description:"Invoca servos",type:"support",cost:6,target:"ally",effects:{special:"summon_servants"}}]},{level:7,skills:[{id:"marca-negra",name:"Marca Negra",description:"Debuff forte",type:"buff",cost:5,duration:2,target:"single",effects:{debuff:{special:"strong_debuff"}}}]},{level:10,skills:[{id:"circulo-profano",name:"CÃ­rculo Profano",description:"Ultimate de trevas",type:"attack",cost:8,basePower:30,element:"dark",target:"aoe",cooldown:4}]},{level:12,skills:[{id:"correntes-umbras",name:"Correntes Umbras",description:"Controle em Ã¡rea",type:"buff",cost:6,duration:1,target:"aoe",effects:{debuff:{special:"bind_area"}}}]},{level:15,skills:[{id:"pacto-sombra",name:"Pacto da Sombra",description:"Buff de poder com custo",type:"buff",cost:6,duration:2,target:"self",effects:{special:"power_up_health_down"}}]},{level:18,skills:[{id:"colheita-almas",name:"Colheita de Almas",description:"Roubo de vida em Ã¡rea",type:"attack",cost:8,basePower:26,element:"dark",target:"aoe"}]},{level:20,skills:[{id:"apoteose-profana",name:"Apoteose Profana",description:"Ultimate final: trevas supremas",type:"attack",cost:10,basePower:38,element:"dark",target:"aoe",cooldown:5}]}]};function Dc(a,s,t){return(wr[a]||[]).filter(n=>n.level>s&&n.level<=t).flatMap(n=>n.skills)}async function cr(a){var s;try{const{data:t}=await Ze.auth.getUser(),r=((s=t==null?void 0:t.user)==null?void 0:s.id)||null;if(!r)return;await fetch("/api/player-progress?action=delta",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:r,missionsCompleted:a.missionsCompleted||0,achievementsUnlocked:a.achievementsUnlocked||0,playtimeMinutes:a.playtimeMinutes||0,lastLogin:a.lastLogin||null})})}catch{}}let ps=null;function si(a=1){lr();const s=Math.max(1,a)*60*1e3;ps=setInterval(()=>{cr({playtimeMinutes:a})},s)}function lr(){if(ps){try{clearInterval(ps)}catch{}ps=null}}const Ea=class Ea{static getInstance(){return Ea.instance||(Ea.instance=new Ea),Ea.instance}initializeWorldState(){return{factions:{guarda:{reputation:0,alliances:["clero","comerciantes"],enemies:["ladroes","cultistas"],influence:60},ladroes:{reputation:0,alliances:["cultistas"],enemies:["guarda","comerciantes"],influence:30},clero:{reputation:0,alliances:["guarda"],enemies:["cultistas"],influence:50},cultistas:{reputation:0,alliances:["ladroes"],enemies:["clero","guarda"],influence:25},comerciantes:{reputation:0,alliances:["guarda","exploradores"],enemies:["ladroes"],influence:45},exploradores:{reputation:0,alliances:["comerciantes"],enemies:[],influence:40}},activeEvents:[],npcStatus:{"CapitÃ£o da Guarda":{alive:!0,relationToPlayer:Math.random()<.45?-5-Math.floor(Math.random()*10):Math.floor(Math.random()*6),currentLocation:"Quartel"},"Mercador Aldric":{alive:!0,relationToPlayer:Math.random()<.35?-5-Math.floor(Math.random()*10):5,currentLocation:"Mercado"},"SÃ¡bia Elara":{alive:!0,relationToPlayer:Math.random()<.4?-5-Math.floor(Math.random()*10):Math.floor(Math.random()*4),currentLocation:"Biblioteca"},"Ferreiro Gorin":{alive:!0,relationToPlayer:Math.random()<.3?-5-Math.floor(Math.random()*10):Math.floor(Math.random()*4),currentLocation:"Forja"}},decisionLog:[],worldEvents:[],locations:{"Vila do Vale":{discovered:!0,reputation:0,questsCompleted:0},"Bosque Sombrio":{discovered:!1,reputation:0,questsCompleted:0},"Montanhas Geladas":{discovered:!1,reputation:0,questsCompleted:0}}}}executeRoll(s,t){const r=Math.floor(Math.random()*100)+1;let i=0;if(t){if(t.attribute){const o=s.attributes[t.attribute];i+=o*(t.multiplier||2)}t.bonus&&(i+=t.bonus);const n=s.luck||0;i+=n}return{roll:r,modifiers:i,total:r+i}}processChoice(s,t,r,i,n,o=[],c=50,l){const d=this.executeRoll(s,l),m=d.total>=c;let u=m?n:o;try{const k={};u.forEach(h=>{h.type==="reputation"&&h.target&&(k[h.target]=(k[h.target]||0)+Math.abs(h.value||0))});const E=Object.entries(k).sort((h,b)=>b[1]-h[1]).slice(0,2).map(([h])=>h);u=u.filter(h=>h.type!=="reputation"||!h.target||E.includes(h.target))}catch{}const p=[],g={},v={},y={Comerciantes:"Livre","Guarda da Cidade":"Ordem",Bandidos:"Sombra",Diplomatas:"Ordem",Aventureiros:"Livre"};u.forEach(k=>{var E,h;if(!(k.probability&&Math.random()>k.probability))switch(p.push(k),k.type){case"gold":g.gold=(g.gold||0)+(k.value||0);break;case"xp":g.xp=(g.xp||0)+(k.value||0);break;case"reputation":if(k.target){const b=y[k.target]||k.target;g.reputation||(g.reputation={}),g.reputation[b]=k.value||0,(E=s.worldState)!=null&&E.factions[b]&&(s.worldState.factions[b].reputation+=k.value||0)}break;case"item":k.target&&(g.items||(g.items=[]),g.items.push(k.target));break;case"npc_relation":k.target&&((h=s.worldState)!=null&&h.npcStatus[k.target])&&(s.worldState.npcStatus[k.target].relationToPlayer+=k.value||0,v.npcRelations||(v.npcRelations={}),v.npcRelations[k.target]=k.value||0);break;case"world_event":k.target&&(v.worldEvents||(v.worldEvents=[]),v.worldEvents.push(k.target));break;case"spawn_enemy":k.target&&(v.worldEvents||(v.worldEvents=[]),v.worldEvents.push(`spawn_enemy:${k.target}`),s.worldState&&s.worldState.activeEvents.push(`spawn_enemy:${k.target}`));break}}),Math.random()<.15&&(v.worldEvents||(v.worldEvents=[]),v.worldEvents.push("luck_blessing"),s.worldState&&s.worldState.activeEvents.push("luck_blessing"));const w={id:`decision_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,heroId:s.id,questId:t,choiceId:r,choiceText:i,timestamp:new Date().toISOString(),impact:{immediate:g,longTerm:v},rollResult:{roll:d.roll,modifiers:d.modifiers,threshold:c,success:m}};return s.worldState&&s.worldState.decisionLog.push(w),{success:m,rollResult:{...d,threshold:c},appliedEffects:p,logEntry:w}}checkWorldStateRequirements(s,t){var r;if(!s.worldState||!t)return!0;if(t.factionReputation){const i={Aventureiros:"Livre",Comerciantes:"Livre","Guarda da Cidade":"Ordem",Bandidos:"Sombra",Diplomatas:"Ordem"};for(const[n,o]of Object.entries(t.factionReputation)){const c=i[n]||n;if((((r=s.worldState.factions[c])==null?void 0:r.reputation)||0)<o)return!1}}if(t.npcStatus)for(const[i,n]of Object.entries(t.npcStatus)){const o=s.worldState.npcStatus[i];if(!o||o.alive!==n)return!1}return!0}generateStorySeeds(s){const t=s.worldState;if(!t)return{context:`HerÃ³i ${s.name}, classe ${s.class}, nÃ­vel ${s.progression.level}`,tone:"heroic",previousDecisions:[]};const r=Object.values(t.factions).reduce((l,d)=>l+d.reputation,0)/Object.keys(t.factions).length;let i="neutral";r>20?i="heroic":r<-20?i="dark":r>0?i="hopeful":i="melancholic";const n=t.decisionLog.slice(-5).map(l=>l.choiceText),o=Object.entries(t.factions).filter(([l,d])=>Math.abs(d.reputation)>10).map(([l,d])=>`${l}: ${d.reputation>0?"aliado":"inimigo"}`).join(", ");return{context:`HerÃ³i ${s.name}, ${s.class} nÃ­vel ${s.progression.level}. ReputaÃ§Ã£o: ${o||"neutro"}. DecisÃµes recentes afetaram o mundo.`,tone:i,previousDecisions:n}}updateStamina(s){const t=new Date;if(!s.stamina||typeof s.stamina=="number"){const r=typeof s.stamina=="number"?s.stamina:100;s.stamina={current:Math.max(0,Math.min(100,r)),max:100,lastRecovery:t.toISOString(),recoveryRate:0};return}s.stamina.lastRecovery=s.stamina.lastRecovery||t.toISOString()}updateVitals(s){var n;const t=new Date;s.derivedAttributes.currentHp||(s.derivedAttributes.currentHp=s.derivedAttributes.hp),s.derivedAttributes.currentMp||(s.derivedAttributes.currentMp=s.derivedAttributes.mp);const r=(n=s.stats)!=null&&n.lastActiveAt?new Date(s.stats.lastActiveAt):t,i=(t.getTime()-r.getTime())/(1e3*60);if(i>=1){const o=Math.min(5,Math.floor(i)),c=ft();let l=(c==null?void 0:c.regenHpPerMin)??5,d=(c==null?void 0:c.regenMpPerMin)??5;const m=s.stats||{},u=m.restBuffActiveUntil?new Date(m.restBuffActiveUntil).getTime():0,p=!!m.inDungeon,g=m.meditationBuffActiveUntil?new Date(m.meditationBuffActiveUntil).getTime():0;u&&Date.now()<u&&(l=Math.round(l*((c==null?void 0:c.restBuffHpMpMultiplier)??1.5)),d=Math.round(d*((c==null?void 0:c.restBuffHpMpMultiplier)??1.5))),p&&(l=Math.max(1,Math.floor(l*((c==null?void 0:c.dungeonRegenMultiplier)??.5))),d=Math.max(1,Math.floor(d*((c==null?void 0:c.dungeonRegenMultiplier)??.5)))),g&&Date.now()<g&&(d=d+((c==null?void 0:c.meditationMpBonusPerMin)??8));const v=Math.max(l,o*l),y=Math.max(d,o*d);s.derivedAttributes.currentHp<s.derivedAttributes.hp&&(s.derivedAttributes.currentHp=Math.min(s.derivedAttributes.hp,(s.derivedAttributes.currentHp||0)+v)),s.derivedAttributes.currentMp<s.derivedAttributes.mp&&(s.derivedAttributes.currentMp=Math.min(s.derivedAttributes.mp,(s.derivedAttributes.currentMp||0)+y)),s.stats&&(s.stats.lastActiveAt=t.toISOString())}}canAcceptQuest(s,t){var n;const r=this.computeEffectiveStaminaCost(s,t);return Math.max(0,Number(((n=s.progression)==null?void 0:n.fatigue)||0))+r<=100}consumeStamina(s,t){var n;const r=this.computeEffectiveStaminaCost(s,t),i=Math.max(0,Number(((n=s.progression)==null?void 0:n.fatigue)||0));return i+r>100?!1:(s.progression={...s.progression||{},fatigue:i+r},!0)}getMountStaminaReduction(s){try{const t=(s.mounts||[]).find(d=>d.id===s.activeMountId);if(!t)return 0;const r=Math.max(0,t.speedBonus||0),i=(()=>{const d=s.mountBuff;return!(d!=null&&d.speedBonus)||d.expiresAt&&Date.now()>new Date(d.expiresAt).getTime()?0:Math.max(0,d.speedBonus||0)})(),n=Math.max(0,t.refineLevel||0),o=Math.max(0,t.mastery||0),c=Math.floor(o/10),l=(r+i)*.01+n*.005+c*.02;return Math.max(0,Math.min(.4,l))}catch{return 0}}computeEffectiveStaminaCost(s,t){const r=this.getMountStaminaReduction(s),i=Math.round(t*(1-r));return Math.max(1,i)}getQuestBaseStaminaCost(s){const t=String((s==null?void 0:s.difficulty)||"").toLowerCase();return t==="facil"?20:t==="medio"||t==="padrao"?40:t==="dificil"?60:t==="epica"||t==="Ã©pica"?80:30}rest(s,t,r){var o;const i=new Date().toISOString(),n=new Date().toDateString();if(t==="item"){const c=s.stats||{};if(c.energyPotionDay===n)return;c.energyPotionDay=n;const l=Math.max(0,Number(((o=s.progression)==null?void 0:o.fatigue)||0)),d=Math.max(1,r||50),m=Math.max(0,l-d);s.progression={...s.progression||{},fatigue:m},s.stats={...s.stats||{},...c}}else{const c=s.stats||{};s.progression={...s.progression||{},fatigue:0},c.lastRestAt=i,c.daysAdvanced=Math.max(0,Number(c.daysAdvanced||0))+1,t==="inn"&&(c.innBuffXpPercent=Math.max(0,Number(c.innBuffXpPercent||5)),c.innBuffUsesRemaining=1),s.stats={...s.stats||{},...c};try{this.rotateDailyWorld(s)}catch{}}}rotateDailyWorld(s){const t=s.worldState||this.initializeWorldState();t.worldEvents=t.worldEvents||[],t.worldEvents.push({type:"day_advanced",ts:new Date().toISOString()}),s.worldState=t}};Ue(Ea,"instance");let dr=Ea;const ut=dr.getInstance();function $c(){return new Date().toISOString()}function _c(a,s){var E;const t=ft();if(t.randomEventsEnabled===!1)return;const r=(a.socialRelations||{})[s.id]||0,i=Li(r),n=a.npcMemory||{interactions:[],preferences:{},scoreByAction:{},lastInteractionByType:{}},o=(E=n.lastInteractionByType)==null?void 0:E.special_event,c=Math.max(2,t.eventsCooldownDaysMin??2);if(Math.max(c,t.eventsCooldownDaysMax??4),(o?(Date.now()-new Date(o).getTime())/(24*60*60*1e3):999)<c)return;const d=Math.max(1,Math.min(5,t.eventsCascadePerDay??2)),m=Math.min(.9,d/10),u=Math.max(.15,Math.min(.3,t.rivalEncounterChance??.2)),p=[3,5,7],g=i==="conhecido"?1:i==="amigo"?3:i==="melhor_amigo"?5:i==="aliado"?7:0,v=p.includes(g);if(!v&&Math.random()>=m)return;const y=i==="rival"&&Math.random()<u?"rival_encounter":v?"celebration":"welcome",w=y==="celebration"?`${a.name} celebra o novo nÃ­vel de relaÃ§Ã£o (${i}).`:y==="welcome"?`${a.name} dÃ¡ boas-vindas ao novo vÃ­nculo (${i}).`:`${a.name} rival apareceu para testar seu vÃ­nculo!`;ge.emit({type:"quest",title:"Evento Especial",message:w,icon:y==="celebration"?"ğŸ‰":y==="welcome"?"ğŸ¥‚":"âš”ï¸",duration:3500});const k={...n.lastInteractionByType||{}};k.special_event=$c(),a.npcMemory={...n,lastInteractionByType:k}}const ra=()=>Math.random();function qa(a){return a[Math.floor(ra()*a.length)]}function qc(a){const s=["competitivo","colaborativo","mercador","explorador","sabio","caotico"],t=["amigavel","sarcastico","formal","quieto"],r=["impulsivo","estrategista","generoso","ambicioso","curioso","desconfiado","leal","astuto","honrado"],i={archetype:qa(s),traits:Array.from({length:3},()=>qa(r)),riskAffinity:Math.floor(ra()*100),chatStyle:qa(t),prefersParty:ra()<.6},n=[{start:"06:00",end:"09:00",activity:"treino",location:"sala_treino"},{start:"09:00",end:"12:00",activity:"missao",location:"campo"},{start:"12:00",end:"13:00",activity:"taverna",location:"taverna"},{start:"13:00",end:"18:00",activity:"exploracao",location:"periferia"},{start:"18:00",end:"22:00",activity:"social",location:"foja"}];a.npcPersonality=i,a.npcRoutine=n,a.npcMemory=a.npcMemory||{interactions:[],preferences:{},scoreByAction:{}}}function mr(a,s,t){return Math.max(s,Math.min(t,a))}function Fc(a,s){const t={...a.attributes},i=qa(["forca","destreza","constituicao","inteligencia","sabedoria","carisma"]);return t[i]=mr(t[i]+Math.round(1*s),0,10),t}function on(a,s,t){var m,u;const i=new Date().getHours(),n=ft(),o=[];if(s.forEach(p=>{var te,D,$,X,Q,Y;const g=p.npcNeeds||{fadiga:20,fome:20,social:50,aventura:40,tarefa:40};g.fadiga=Math.min(100,g.fadiga+1),g.fome=Math.min(100,g.fome+(ra()<.5?0:1)),g.social=Math.max(0,g.social-(ra()<.5?0:1)),g.aventura=Math.min(100,g.aventura+(Math.random()<.3?2:0)),g.tarefa=Math.max(0,g.tarefa-(Math.random()<.2?1:0)),p.npcNeeds=g;const v=g.fadiga>70,y=g.fome>70,w=g.social<30,k=y?"irritado":v?"cansado":w?"triste":"neutro";p.npcMood=k;const h=(p.npcRoutine||[]).find(G=>{const[J,re]=(G.start||"00:00").split(":").map(Number),[ee,fe]=(G.end||"23:59").split(":").map(Number),_=i;return _>=J&&_<ee}),b=(h==null?void 0:h.activity)||"exploracao";if(a){const G=(p.socialRelations||{})[a.id]||0;G>=40?p.npcMood="feliz":G>=20&&p.npcMood!=="irritado"&&p.npcMood!=="cansado"&&(p.npcMood="tranquilo")}b==="taverna"&&(g.fome=Math.max(0,g.fome-15),g.fadiga=Math.max(0,g.fadiga-10),g.social=Math.min(100,g.social+10));const f=b==="treino"?["treino","treino","social","mercado"]:b==="missao"?["missao","missao","exploracao","social"]:b==="social"?["social","social","mercado","treino"]:["exploracao","missao","treino","mercado"],j=(te=p.npcPersonality)!=null&&te.prefersParty?["social",...f]:f,N=qa(j);if(N==="treino"){const G=Fc(p,1);p.attributes=G,p.stats.totalPlayTime=(p.stats.totalPlayTime||0)+1,(D=p.npcMemory)==null||D.interactions.push({heroId:p.id,ts:new Date().toISOString(),summary:"treino",impact:1}),o.push({type:"xp",title:"Treino de NPC",message:`${p.name} aprimorou seus atributos`,icon:"ğŸ‹ï¸",duration:2500}),g.fome=Math.min(100,g.fome+2)}if(N==="missao"){const G=Math.floor(10+ra()*40),J=Math.floor(5+ra()*30);p.progression.xp+=G,p.progression.gold+=J,p.stats.questsCompleted+=1,p.completedQuests=[...p.completedQuests,`npc-${Date.now()}`].slice(-50),($=p.npcMemory)==null||$.interactions.push({heroId:p.id,ts:new Date().toISOString(),summary:"missao",impact:2});const re=Math.max(0,((X=p.npcPersonality)==null?void 0:X.riskAffinity)||0),ee=G>30?2:-1;p.npcPersonality={...p.npcPersonality||{archetype:"explorador",traits:[],riskAffinity:50,chatStyle:"amigavel"},riskAffinity:mr(re+ee,0,100)},o.push({type:"quest",title:"MissÃ£o de NPC",message:`${p.name} concluiu uma missÃ£o (+${G} XP, +${J} ouro)`,icon:"ğŸ“œ",duration:2800})}if(N==="social"&&a){const G=Math.floor(-1+ra()*5),J=Math.floor((a.reputationFactions||[]).reduce((K,xe)=>K+Math.max(0,xe.reputation),0)/500),re=mr(G+J,-5,5),ee=re>=2?"amigÃ¡vel":re<=-2?"hostil":"neutro";vr(p,a,ee),(Q=p.npcMemory)==null||Q.interactions.push({heroId:a.id,ts:new Date().toISOString(),summary:`social_${ee}`,impact:re}),o.push({type:"achievement",title:"InteraÃ§Ã£o Social",message:`${p.name} interagiu com vocÃª (${ee})`,icon:"ğŸ’¬",duration:2500});const fe=((Y=p.npcMemory)==null?void 0:Y.socialNotesByHeroId)||{},_=fe[a.id]||[];fe[a.id]=[..._,`${new Date().toLocaleString()} â€¢ ${ee}`].slice(-20),p.npcMemory={...p.npcMemory||{},socialNotesByHeroId:fe};try{_c(p,a)}catch{}const P=p.npcMemory||{interactions:[],preferences:{},scoreByAction:{}};P.lastContactByHeroId={...P.lastContactByHeroId||{},[a.id]:new Date().toISOString()};const M=n.npcInteractionCooldownSeconds??90,C=new Date().toISOString(),A=K=>{const xe=(P.lastInteractionByType||{})[K];return xe?(Date.now()-new Date(xe).getTime())/1e3>=M:!0};P.lastInteractionByType=P.lastInteractionByType||{},A("social")?P.lastInteractionByType.social=C:o.pop();const O=(p.socialRelations||{})[a.id]||0,S=(P.interactions||[]).filter(K=>K.heroId===a.id&&(K.summary.includes("amigÃ¡vel")||K.summary.includes("missao"))).length,I=(P.lastContactByHeroId||{})[a.id],ae=I?new Date(I).getTime():0,ne=ae?Math.floor((Date.now()-ae)/6e4):999,U=n.npcRelationKnownThreshold??10,R=n.npcRelationFriendThreshold??40,L=n.npcRelationBestFriendThreshold??75;let oe;if(O>=L&&S>=3&&ne<=180?oe="melhor_amigo":O>=R&&S>=2&&ne<=360?oe="amigo":O>=U&&(oe="conhecido"),oe){P.friendStatusByHeroId={...P.friendStatusByHeroId||{},[a.id]:oe},p.npcMemory=P;const K=Array.isArray(a.friends)?a.friends:[],xe=Array.isArray(a.bestFriends)?a.bestFriends:[],W={};oe==="amigo"&&!K.includes(p.id)&&(W.friends=[...K,p.id]),oe==="melhor_amigo"&&!xe.includes(p.id)&&(W.bestFriends=[...xe,p.id]),Object.keys(W).length&&o.push({type:"achievement",title:"Nova RelaÃ§Ã£o",message:`${p.name} agora Ã© seu ${oe.replace("_"," ")}`,icon:"ğŸ¤",duration:2600})}}if(N==="mercado"){const G=Math.floor(3+ra()*20);p.progression.gold+=G;const J=p.npcMemory||{interactions:[],preferences:{},scoreByAction:{}},re=new Date().toISOString(),ee=n.npcInteractionCooldownSeconds??90,fe=(J.lastInteractionByType||{}).mercado;(!fe||(Date.now()-new Date(fe).getTime())/1e3>=ee)&&(o.push({type:"item",title:"Trocas de NPC",message:`${p.name} negociou no mercado (+${G} ouro)`,icon:"ğŸª™",duration:2200}),J.lastInteractionByType={...J.lastInteractionByType||{},mercado:re}),p.npcMemory=J,g.fome=Math.max(0,g.fome-2)}if(N==="exploracao"){const G=ra()<.3;p.stats.itemsFound+=G?1:0;const J=p.npcMemory||{interactions:[],preferences:{},scoreByAction:{}},re=new Date().toISOString(),ee=n.npcInteractionCooldownSeconds??90,fe=(J.lastInteractionByType||{}).exploracao;(!fe||(Date.now()-new Date(fe).getTime())/1e3>=ee)&&(o.push({type:"quest",title:"ExploraÃ§Ã£o de NPC",message:G?`${p.name} encontrou um item raro`:`${p.name} explorou Ã¡reas prÃ³ximas`,icon:G?"âœ¨":"ğŸ§­",duration:2200}),J.lastInteractionByType={...J.lastInteractionByType||{},exploracao:re}),p.npcMemory=J,g.fome=Math.min(100,g.fome+1)}const T=p.npcMemory||{interactions:[],preferences:{},scoreByAction:{}},F=T.scoreByAction||{};F[N]=(F[N]||0)+1,T.scoreByAction=F,p.npcMemory=T}),s.length>1){const p=Po(s);p&&o.push({type:"quest",title:"InteraÃ§Ã£o entre NPCs",message:`${p.a.name} e ${p.b.name} interagiram (${p.delta>=2?"amizade":p.delta<=-2?"rivalidade":"neutro"})`,icon:p.delta>=2?"ğŸ¤":p.delta<=-2?"âš”ï¸":"ğŸ‘‹",duration:2500})}if(a&&Math.random()<.2&&Ro(a,s),a){const p=n.npcInteractionDifficulty==="high"?.5:n.npcInteractionDifficulty==="low"?.2:.35,g=n.npcDuelRivalryModerate??-30,v=n.npcDuelRivalryHigh??-60,y=n.npcDuelLevelDiffMax??5,w=s.filter(f=>{var T,F;const j=(f.socialRelations||{})[a.id]||0,N=Math.abs((((T=f.progression)==null?void 0:T.level)||f.level||1)-(((F=a.progression)==null?void 0:F.level)||a.level||1));return j<=g&&N<=y}),k=.15,E=s.filter(f=>{var T,F;const j=(f.socialRelations||{})[a.id]||0,N=Math.abs((((T=f.progression)==null?void 0:T.level)||f.level||1)-(((F=a.progression)==null?void 0:F.level)||a.level||1));return j>g&&N<=y}),h=E.length>0&&Math.random()<k,b=w.length?w:h?E:[];if(b.length&&Math.random()<p){const f=qa(b),j=(f.socialRelations||{})[a.id]||0,N=Math.abs((((m=f.progression)==null?void 0:m.level)||1)-(((u=a.progression)==null?void 0:u.level)||1)),T=w.includes(f)&&j<=v?"honra":"treino",F={npcId:f.id,type:T,expiresAt:new Date(Date.now()+15*60*1e3).toISOString(),levelDiff:N},te=Array.isArray(a.duelInvites)?a.duelInvites:[];a.duelInvites=[...te,F],o.push({type:"quest",title:"Desafio de Duelo",message:`${f.name} desafiou vocÃª para um duelo (${T})`,icon:"âš”ï¸",duration:3e3})}}const c=new Set(["InteraÃ§Ã£o Social","Nova RelaÃ§Ã£o"]),l=o.filter(p=>c.has(p.title)),d=1;for(let p=0;p<Math.min(d,l.length);p++){const g=Math.floor(Math.random()*l.length),v=l.splice(g,1)[0];t(v)}}function ri(a,s){return Math.floor(Math.random()*(s-a+1))+a}function Bc(a,s,t){const r=[];let i=a.derivedAttributes.currentHp||a.derivedAttributes.hp,n=s.derivedAttributes.currentHp||s.derivedAttributes.hp,o=a.derivedAttributes.currentMp||a.derivedAttributes.mp,c=s.derivedAttributes.currentMp||s.derivedAttributes.mp;const l=[],d=Math.max(1,Math.floor((a.attributes.forca+a.attributes.destreza)*1.2)),m=Math.max(1,Math.floor((s.attributes.forca+s.attributes.destreza)*1.2)),u=Math.max(0,Math.floor(a.derivedAttributes.armorClass/2)),p=Math.max(0,Math.floor(s.derivedAttributes.armorClass/2)),g=Math.max(0,a.derivedAttributes.initiative),v=Math.max(0,s.derivedAttributes.initiative),y=Math.max(0,Math.floor(a.attributes.inteligencia*.8)),w=Math.max(0,Math.floor(s.attributes.inteligencia*.8)),k=Math.max(0,a.derivedAttributes.luck||0),E=Math.max(0,s.derivedAttributes.luck||0);let h=g>=v?"a":"b",b=0;for(;i>0&&n>0&&b<20;){b++;const $=h==="a",X=$?d:m,Q=$?y:w,Y=$?p:u,G=$?k:E,J=Math.random()<Math.min(.25,G/100);let re=Math.random()<.35;re&&($&&o<5&&(re=!1),!$&&c<5&&(re=!1));const ee=re?X+Q+ri(0,6):X+ri(0,10);let fe=Math.max(1,ee-Y);J&&(fe=Math.floor(fe*1.5)),$?(n=Math.max(0,n-fe),re&&(o=Math.max(0,o-5)),r.push(`${a.name} ${re?"lanÃ§ou magia":"atacou"} e causou ${fe} dano${J?" (crÃ­tico)":""}.`)):(i=Math.max(0,i-fe),re&&(c=Math.max(0,c-5)),r.push(`${s.name} ${re?"lanÃ§ou magia":"atacou"} e causou ${fe} dano${J?" (crÃ­tico)":""}.`)),l.push({attacker:$?"a":"b",damage:fe,crit:J,magic:re,aHp:i,bHp:n,aMp:o,bMp:c}),h=h==="a"?"b":"a"}const f=n<=0||i>n,j=f?a:s,N=f?s:a,T=30+Math.max(0,(N.progression.level||1)-(j.progression.level||1))*2,F=20+Math.max(0,N.derivedAttributes.power-j.derivedAttributes.power)*.05;let te=Math.floor(T),D=Math.floor(F);return t==="honra"&&(te=Math.floor(te*1.2)),t==="recompensas"&&(D=Math.floor(D*1.5)),r.push(`${j.name} venceu o duelo apÃ³s ${b} turnos.`),{winnerId:j.id,loserId:N.id,turns:b,log:r,rewards:{xp:te,gold:D},frames:l,initial:{aHp:a.derivedAttributes.currentHp||a.derivedAttributes.hp,bHp:s.derivedAttributes.currentHp||s.derivedAttributes.hp,aMp:a.derivedAttributes.currentMp||a.derivedAttributes.mp,bMp:s.derivedAttributes.currentMp||s.derivedAttributes.mp}}}function Oc(a=.05){try{const s=new(window.AudioContext||window.webkitAudioContext),t=s.createOscillator(),r=s.createGain();t.type="sine",t.frequency.value=220,r.gain.value=a,t.connect(r),r.connect(s.destination),t.start(),setTimeout(()=>{t.stop(),s.close()},400)}catch{}}function Lc(a=440,s=250){try{const t=new(window.AudioContext||window.webkitAudioContext),r=t.createOscillator(),i=t.createGain();r.type="triangle",r.frequency.value=a,i.gain.value=.08,r.connect(i),i.connect(t.destination),r.start(),setTimeout(()=>{r.stop(),t.close()},Math.max(50,s))}catch{}}const Qe=Za()(ks((a,s)=>({adsEnabled:!0,adsRemoved:!1,adSenseClientId:void 0,adSlotBannerTop:void 0,adSlotInterstitial:void 0,interstitialVisible:!1,lastInterstitialAt:void 0,interstitialMinIntervalMinutes:15,interstitialOnChapterMilestones:!0,ownedProducts:{},receipts:{},ownedFrames:[],activeFrameId:void 0,ownedThemes:[],activeThemeId:void 0,ownedDLCs:[],seasonPassActive:{active:!1},tipJarLevel:"none",seasonalAutoEnabled:!0,setConfig:t=>a({...s(),...t}),setAdSenseClient:t=>a({adSenseClientId:t}),triggerInterstitial:t=>{const r=s();if(!r.adsEnabled||r.adsRemoved)return;const i=Date.now(),n=r.lastInterstitialAt||0,o=Math.max(1,r.interstitialMinIntervalMinutes)*6e4;i-n<o||a({interstitialVisible:!0,lastInterstitialAt:i})},hideInterstitial:()=>a({interstitialVisible:!1}),markPurchase:(t,r)=>{const i={...s().ownedProducts},n={...s().receipts};i[t]={purchasedAt:new Date().toISOString()},n[t]={id:r.id,purchasedAt:new Date().toISOString(),payload:r.payload};const o={ownedProducts:i,receipts:n};if(t.startsWith("frame-")){const c=t.replace("frame-",""),l=new Set([...s().ownedFrames||[]]);l.add(c),o.ownedFrames=Array.from(l)}else if(t.startsWith("theme-")){const c=t.replace("theme-",""),l=new Set([...s().ownedThemes||[]]);l.add(c),o.ownedThemes=Array.from(l)}else t==="remove-ads"?(o.adsRemoved=!0,o.adsEnabled=!1,o.interstitialVisible=!1):t==="season-pass"&&(o.seasonPassActive={active:!0});a(o)},removeAdsForever:()=>a({adsRemoved:!0,adsEnabled:!1,interstitialVisible:!1}),setActiveFrame:t=>a({activeFrameId:t}),setActiveTheme:t=>a({activeThemeId:t}),setActiveSeasonalTheme:t=>a({activeSeasonalTheme:t}),autoApplySeasonal:()=>{const t=new Date,r=t.getMonth(),i=t.getDate();let n;r===11&&i>=1?n="natal":r===3&&i>=1||r===4&&i<=30?n="pascoa":r===0&&i<=7?n="ano_novo":r===1&&i>=10&&i<=28&&(n="carnaval"),n&&a({activeSeasonalTheme:n})}}),{name:"heroforge-monetization",version:1,partialize:a=>({adsEnabled:a.adsEnabled,adsRemoved:a.adsRemoved,adSenseClientId:a.adSenseClientId,adSlotBannerTop:a.adSlotBannerTop,adSlotInterstitial:a.adSlotInterstitial,interstitialMinIntervalMinutes:a.interstitialMinIntervalMinutes,interstitialOnChapterMilestones:a.interstitialOnChapterMilestones,ownedProducts:a.ownedProducts,receipts:a.receipts,ownedFrames:a.ownedFrames,activeFrameId:a.activeFrameId,ownedThemes:a.ownedThemes,activeThemeId:a.activeThemeId,ownedDLCs:a.ownedDLCs,seasonPassActive:a.seasonPassActive,tipJarLevel:a.tipJarLevel,activeSeasonalTheme:a.activeSeasonalTheme,seasonalAutoEnabled:a.seasonalAutoEnabled})})),Ua=()=>Qe.getState(),Hc={training_basic:!0,hunting_basic:!1,shop_basic:!1,crafting_simple:!1,stable_basic:!1},Ba=Za()(ks((a,s)=>({featuresUnlocked:Hc,basicTrainingOnly:!0,unlockLog:[],requirements:{hunting_basic:{minLevel:2,minCompletedQuests:0},shop_basic:{minRank:"E",minColetaQuests:5},crafting_simple:{minRank:"E",minCompletedQuests:1},stable_basic:{minLevel:5,requiresGuildQuestId:"guild-ovo-basico"}},isFeatureEnabled:(t,r)=>{const i=s().featuresUnlocked;if(t==="training_basic")return!0;const n=!!i[t];return n?t==="hunting_basic"||t==="shop_basic"||t==="crafting_simple"||t==="stable_basic"?!0:n:!1},getGateStatus:(t,r)=>{const i=s().isFeatureEnabled(t,r);if(i)return{enabled:i};if(!r)return{enabled:!1};if(t==="hunting_basic"){const n=s().requirements.hunting_basic,o=r.progression.level,c=r.stats.questsCompleted||0,l=o<n.minLevel,d=(n.minCompletedQuests||0)>0&&c<(n.minCompletedQuests||0),m=l?`Requer nÃ­vel ${n.minLevel}`:d?`Requer ${n.minCompletedQuests} missÃµes concluÃ­das`:"Progresso insuficiente",u=l?`NÃ­vel atual ${o}`:d?`MissÃµes concluÃ­das ${c}`:`NÃ­vel ${o}, Rank ${We.calculateRank(r)}`;return{enabled:!1,reason:m,nextHint:u}}if(t==="shop_basic"||t==="crafting_simple"){const n=t==="shop_basic"?s().requirements.shop_basic:s().requirements.crafting_simple,o=We.calculateRank(r),c=["F","E","D","C","B","A","S","SS","SSS"],l=c.indexOf(o)>=c.indexOf(n.minRank),d=r.stats.collectionQuestsCompleted||0,m=r.stats.questsCompleted||0,u=t==="shop_basic"?d>=(n.minColetaQuests||0):m>=(n.minCompletedQuests||0),p=l?u?"Progresso insuficiente":t==="shop_basic"?`Requer ${n.minColetaQuests} missÃµes de coleta concluÃ­das`:`Requer ${n.minCompletedQuests} missÃµes concluÃ­das`:`Requer rank ${n.minRank}`,g=l?u?`Rank ${o}, NÃ­vel ${r.progression.level}`:t==="shop_basic"?`Coletas concluÃ­das ${d}`:`MissÃµes concluÃ­das ${m}`:`Rank atual ${o}`;return{enabled:!1,reason:p,nextHint:g}}if(t==="stable_basic"){const n=s().requirements.stable_basic,o=r.progression.level,c=o>=n.minLevel,l=r.stats.stableUnlockQuestCompleted===!0,d=c?l?"Progresso insuficiente":"Concluir missÃ£o da guilda para liberar o EstÃ¡bulo":`Requer nÃ­vel ${n.minLevel}`,m=c?l?`NÃ­vel ${o}`:`MissÃ£o pendente: ${n.requiresGuildQuestId}`:`NÃ­vel atual ${o}`;return{enabled:!1,reason:d,nextHint:m}}return{enabled:!1}},setFeatureUnlocked:(t,r,i)=>{const n=Date.now(),o={...s().featuresUnlocked,[t]:!0},c={id:`${t}-${n}`,feature:t,heroId:r==null?void 0:r.id,details:i,ts:n};a({featuresUnlocked:o,unlockLog:[...s().unlockLog,c]}),ge.emit({type:"achievement",title:"Nova funcionalidade desbloqueada!",message:t.replace("_"," ")})},evaluateUnlocks:(t,r)=>{const i=s().featuresUnlocked,n=(r==null?void 0:r.progression.level)??t.progression.level,o=r?We.calculateRank(r):We.calculateRank(t),c=t.progression.level,l=We.calculateRank(t);if(!i.hunting_basic){const p=s().requirements.hunting_basic,g=t.stats.questsCompleted||0;if(n<p.minLevel&&c>=p.minLevel&&g>=(p.minCompletedQuests||0)){s().setFeatureUnlocked("hunting_basic",t,"AlcanÃ§ou requisitos de caÃ§a bÃ¡sica");try{Ve.startFlow("unlock-hunting-basic")}catch{}a({basicTrainingOnly:!1})}}const d=["F","E","D","C","B","A","S","SS","SSS"],m=d.indexOf(o),u=d.indexOf(l);if(m<1&&u>=1){const p=t.stats.questsCompleted||0,g=s().requirements.shop_basic,v=s().requirements.crafting_simple,y=t.stats.collectionQuestsCompleted||0;if(!i.shop_basic&&y>=(g.minColetaQuests||0)){s().setFeatureUnlocked("shop_basic",t,"AlcanÃ§ou requisitos da loja bÃ¡sica");try{Ve.startFlow("unlock-shop-basic")}catch{}}if(!i.crafting_simple&&p>=(v.minCompletedQuests||0)){s().setFeatureUnlocked("crafting_simple",t,"AlcanÃ§ou requisitos de craft simples");try{Ve.startFlow("unlock-crafting-simple")}catch{}}}if(!i.stable_basic){const p=s().requirements.stable_basic,g=t.progression.level>=p.minLevel,v=t.stats.stableUnlockQuestCompleted===!0;g&&v&&s().setFeatureUnlocked("stable_basic",t,"MissÃ£o da guilda concluÃ­da e nÃ­vel alcanÃ§ado")}},setBasicTrainingOnly:t=>a({basicTrainingOnly:t})}),{name:"hfn-progression-store"})),cn={comum:{min:50,max:80},incomum:{min:80,max:150},raro:{min:150,max:300},epico:{min:300,max:500},lendario:{min:400,max:800},mistico:{min:600,max:1200}},ln={comum:5*60*1e3,incomum:15*60*1e3,raro:60*60*1e3,epico:3*60*60*1e3,lendario:6*60*60*1e3,mistico:12*60*60*1e3};function Va(a){const s=Math.random(),t=a||(s>.98?"lendario":s>.9?"epico":s>.7?"raro":s>.4?"incomum":"comum"),r=[{name:"Ovo Feral Lacrado",type:"feral",rarity:"raro"},{name:"Ovo Arcano Reluzente",type:"arcano",rarity:"epico"},{name:"Ovo Sagrado Ancestral",type:"sagrado",rarity:"lendario"},{name:"Ovo Sombrio Profano",type:"sombrio",rarity:"epico"},{name:"Ovo MÃ­stico do VÃ©u",type:"arcano",rarity:"mistico"}];let i="Ovo Misterioso";if(t==="raro"||t==="epico"||t==="lendario"){const n=r.filter(o=>o.rarity===t);n.length&&Math.random()<.6&&(i=n[Math.floor(Math.random()*n.length)].name)}return{id:la(),name:i,status:"misterioso",baseRarity:t,description:"Um ovo encontrado em locais perigosos. SÃ³ a Guilda pode dizer o que hÃ¡ dentro.",createdAt:new Date().toISOString()}}const ii=["feral","arcano","sagrado","sombrio"],ni=["coleta","combate","suporte"];function Gc(a){let s=ii[Math.floor(Math.random()*ii.length)];const t=ni[Math.floor(Math.random()*ni.length)],r=a.baseRarity,i=r==="comum"?5:r==="incomum"?8:r==="raro"?12:r==="epico"?16:r==="lendario"?22:28,n=t==="combate"?{forca:2}:t==="suporte"?{sabedoria:2}:{destreza:2};let o;a.name==="Ovo Feral Lacrado"&&(s="feral",o=["Lobinho Cinzento","Javali Espinhoso","Raposa de Cinzas"]),a.name==="Ovo Arcano Reluzente"&&(s="arcano",o=["Espectro de Mana","Fada Celeste","ArcanÃ­deo"]),a.name==="Ovo Sagrado Ancestral"&&(s="sagrado",o=["EspÃ­rito GuardiÃ£o","Grifo Jovem","Fenrir Branco"]),a.name==="Ovo Sombrio Profano"&&(s="sombrio",o=["Corvo Sombrio","Shade Menor","Hiena Macabra"]),a.name==="Ovo MÃ­stico do VÃ©u"&&(s="arcano",o=["Silfo do VÃ©u","Serafim Menor","Arconte Luminal"]);const c=a.name.startsWith("Ovo ")?a.name:`Ovo ${ur(s)} ${ur(r)}`;return{type:s,petClass:t,rarity:r,initialBonus:n,skillChancePercent:i,revealedName:c,candidates:o}}function zc(a){var t;const s=ln[((t=a.identified)==null?void 0:t.rarity)||a.baseRarity];return{...a,status:"incubando",incubationEndsAt:new Date(Date.now()+s).toISOString()}}function dn(a){return a.incubationEndsAt?Date.now()>=new Date(a.incubationEndsAt).getTime():!1}function mn(a){return a.incubationEndsAt&&dn(a)?{...a,status:"pronto_para_chocar"}:a}function Uc(a){const s=a==="raro"?.02:a==="epico"?.04:a==="lendario"?.07:a==="mistico"?.1:0;if(Math.random()>s)return;const t=["albino","sombrio_corrupto","arcano_puro","feral_brutal","sagrado"],r=t[Math.floor(Math.random()*t.length)];return{variant:r,visualBadge:r==="albino"?"ğŸŒŸ":r==="sombrio_corrupto"?"ğŸŒ‘":r==="arcano_puro"?"ğŸ”®":r==="feral_brutal"?"ğŸ¾":"âœ¨"}}const Vc={feral:["Lobinho Cinzento","Javali Espinhoso","Raposa de Cinzas"],arcano:["Espectro de Mana","Fada Celeste","Fada Silvestre","Golem Pequeno","ArcanÃ­deo"],sagrado:["EspÃ­rito GuardiÃ£o","Grifo Jovem","Fenrir Branco"],sombrio:["Corvo Sombrio","Shade Menor","Hiena Macabra"]};function Qc(a){const s=a.identified,t=(s.candidates&&s.candidates.length?s.candidates:Vc[s.type])||["Companheiro Misterioso"],r=t[Math.floor(Math.random()*t.length)],i=Math.floor(Math.random()*100),n=Uc(s.rarity);let o;const c={...s.initialBonus||{}},l={feral:"Instinto Feral",arcano:"Pulso Arcano",sagrado:"Aura Sagrada",sombrio:"Sussurro Sombrio"};return Math.random()*100<(s.skillChancePercent||0)&&(o=l[s.type]),(n==null?void 0:n.variant)==="albino"&&(c.carisma=(c.carisma||0)+1),(n==null?void 0:n.variant)==="sombrio_corrupto"&&(c.inteligencia=(c.inteligencia||0)+1),(n==null?void 0:n.variant)==="arcano_puro"&&(c.inteligencia=(c.inteligencia||0)+1,c.sabedoria=(c.sabedoria||0)+1),(n==null?void 0:n.variant)==="feral_brutal"&&(c.forca=(c.forca||0)+1),(n==null?void 0:n.variant)==="sagrado"&&(c.sabedoria=(c.sabedoria||0)+1),{id:la(),name:r,type:s.type,petClass:s.petClass,rarity:s.rarity,qualityRoll:i,level:1,stage:"bebe",mutation:n,attributes:c,exclusiveSkill:o,energy:100,createdAt:new Date().toISOString()}}function Xc(a){return a>=30?"forma_final":a>=20?"adulto":a>=10?"jovem":"bebe"}function oi(a,s){const t=Math.max(0,Math.floor(s/100)),r=Math.min(30,a.level+t),i=Xc(r);let n=a.exclusiveSkill;return!n&&i==="forma_final"&&(n={"Lobinho Cinzento":"Instinto Feral","Fada Silvestre":"Aura Sagrada","Fada Celeste":"Aura Sagrada","Golem Pequeno":"Sussurro Sombrio","Espectro de Mana":"Pulso Arcano"}[a.name]||`${ur(a.type)} Ascendente`),{...a,level:r,stage:i,exclusiveSkill:n}}function Jc(a,s){if(!a.incubationEndsAt)return a;const t=new Date(a.incubationEndsAt).getTime(),r=Math.max(Date.now(),t-s),i={...a,incubationEndsAt:new Date(r).toISOString()};return mn(i)}function ur(a){return a.charAt(0).toUpperCase()+a.slice(1)}const un="hero_slots_state";function Nr(){try{const a=localStorage.getItem(un);if(a)return JSON.parse(a)}catch{}return{baseSlots:3,purchasedSlots:0,purchases:[],basePrice:100,incrementPercent:.25}}function Wc(a){try{localStorage.setItem(un,JSON.stringify(a))}catch{}}function Kc(a){const s=(a||[]).map(n=>{var o;return((o=n==null?void 0:n.rankData)==null?void 0:o.currentRank)||"F"}),t=s.some(n=>n>="B"),r=s.some(n=>n>="S");let i=0;return t&&(i+=1),r&&(i+=1),i}function ys(a){const s=Nr(),t=s.baseSlots+Kc(a)+Math.min(5,s.purchasedSlots);return Math.min(10,t)}function js(a){return(a||[]).filter(s=>s.origin!=="npc").length}function Yc(a){return js(a)<ys(a)}function Sr(){const a=Nr(),s=Math.min(5,a.purchasedSlots);return Math.round(a.basePrice*Math.pow(1+a.incrementPercent,s))}function Zc(a){const s=Nr();if(s.purchasedSlots>=5)return!1;const t=Sr();return a(t)?(s.purchasedSlots+=1,s.purchases.push({ts:Date.now(),price:t}),Wc(s),!0):!1}const Tt={MIN_ATTRIBUTE:1,MAX_ATTRIBUTE:10,STARTING_POINTS_PER_ATTRIBUTE:1};function Cr(a){const s=Math.max(0,Xt.indexOf(a));return Tt.MAX_ATTRIBUTE+s*10}function el(a){const s=Math.max(0,Xt.indexOf(a));return(Tt.MAX_ATTRIBUTE+s*10)*6}const ws={forca:{name:"ForÃ§a",icon:"ğŸ’ª",description:"Determina o dano fÃ­sico e capacidade de carregar equipamentos pesados"},destreza:{name:"Destreza",icon:"ğŸƒ",description:"Afeta precisÃ£o, esquiva e velocidade de movimento"},constituicao:{name:"ConstituiÃ§Ã£o",icon:"â¤ï¸",description:"Determina pontos de vida e resistÃªncia a doenÃ§as"},inteligencia:{name:"InteligÃªncia",icon:"ğŸ§ ",description:"Afeta dano mÃ¡gico, mana e habilidades de conhecimento"},sabedoria:{name:"Sabedoria",icon:"ğŸ¦‰",description:"Influencia percepÃ§Ã£o, intuiÃ§Ã£o e resistÃªncia mental"},carisma:{name:"Carisma",icon:"âœ¨",description:"Determina habilidades sociais e lideranÃ§a"}};function kr(){return{forca:Tt.STARTING_POINTS_PER_ATTRIBUTE,destreza:Tt.STARTING_POINTS_PER_ATTRIBUTE,constituicao:Tt.STARTING_POINTS_PER_ATTRIBUTE,inteligencia:Tt.STARTING_POINTS_PER_ATTRIBUTE,sabedoria:Tt.STARTING_POINTS_PER_ATTRIBUTE,carisma:Tt.STARTING_POINTS_PER_ATTRIBUTE}}function Ns(a){return 0}function ci(a){const s=[];Object.entries(a).forEach(([r,i])=>{i<Tt.MIN_ATTRIBUTE&&s.push(`${ws[r].name} deve ter pelo menos ${Tt.MIN_ATTRIBUTE} ponto`),i>Tt.MAX_ATTRIBUTE&&s.push(`${ws[r].name} nÃ£o pode ter mais que ${Tt.MAX_ATTRIBUTE} pontos`)});const t=Object.values(a).reduce((r,i)=>r+i,0);return{valid:s.length===0,errors:s,totalPoints:t,remainingPoints:0}}function pr(a,s){return a[s]<Tt.MAX_ATTRIBUTE}function gr(a,s){return a[s]>Tt.MIN_ATTRIBUTE}function tl(a,s){return pr(a,s)?{...a,[s]:a[s]+1}:a}function al(a,s){return gr(a,s)?{...a,[s]:a[s]-1}:a}function sl(a){const s=kr();return a&&Object.entries(a).forEach(([t,r])=>{const i=t,n=Math.min(r||0,Tt.MAX_ATTRIBUTE-s[i]);s[i]+=n}),s}const pn=20,rl=3;function xr(a){return a<=1?0:a===2?150:a*100+(a-1)*50}function li(a,s){let t=s;for(;t<pn&&a>=xr(t+1);)t++;return t}const il=a=>{const s=[],t=Object.values(a).reduce((r,i)=>r+i,0);return t>18&&s.push(`Total de pontos (${t}) excede o mÃ¡ximo de 18`),Object.entries(a).forEach(([r,i])=>{i<0&&s.push(`${r} nÃ£o pode ser negativo`),i>10&&s.push(`${r} nÃ£o pode exceder 10 pontos`)}),{isValid:s.length===0,errors:s}},nl=(a,s)=>{const t={...a};[s.equippedMainHand,s.equippedOffHand,s.equippedHelm,s.equippedChest,s.equippedBelt,s.equippedGloves,s.equippedBoots,s.equippedCape,s.equippedRingLeft,s.equippedRingRight,s.equippedNecklace,s.equippedEarringLeft,s.equippedEarringRight,...Array.isArray(s.equippedWeapons)?s.equippedWeapons:[s.equippedWeapon].filter(Boolean),...Array.isArray(s.equippedArmorSlots)?s.equippedArmorSlots:[s.equippedArmor].filter(Boolean),...Array.isArray(s.equippedAccessories)?s.equippedAccessories:[s.equippedAccessory].filter(Boolean)].filter(Boolean).forEach(c=>{var u;const l=Ee.find(p=>p.id===c)||(s.customItems?s.customItems[c]:void 0),d=((u=s.upgrades)==null?void 0:u[c])??0;l!=null&&l.bonus&&Object.entries(l.bonus).forEach(([p,g])=>{if(!g)return;const v=1+Math.max(0,d)*.1,y=Math.round(g*v),w=p==="sabedoria"?"inteligencia":p==="carisma"?"destreza":p;w in t&&(t[w]+=y)});const m=(s.equippedJewelsByItemId||{})[c];if(Array.isArray(m)&&m.length>0){const p=(l==null?void 0:l.type)==="weapon"?10:(l==null?void 0:l.type)==="armor"?15:(l==null?void 0:l.type)==="accessory"?8:0;let g={},v=0;m.forEach(w=>{const k=w.split(":");if(k.length===3){const E=k[1],h=Number(k[2]),f=new Jt(crypto.randomUUID(),E,h).getBonus();f.forca&&(g.forca=(g.forca||0)+f.forca,v+=f.forca),f.inteligencia&&(g.inteligencia=(g.inteligencia||0)+f.inteligencia,v+=f.inteligencia),f.destreza&&(g.destreza=(g.destreza||0)+f.destreza,v+=f.destreza),f.constituicao&&(g.constituicao=(g.constituicao||0)+f.constituicao,v+=f.constituicao)}});const y=p>0&&v>p?p/v:1;Object.entries(g).forEach(([w,k])=>{if(!k)return;const E=w==="sabedoria"?"inteligencia":w==="carisma"?"destreza":w;if(E in t){const h=Math.max(0,Math.floor(k*y));t[E]+=h}})}});const i=[s.equippedMainHand,s.equippedOffHand].filter(Boolean).map(c=>{var m;const l=c?Ee.find(u=>u.id===c):void 0,d=c&&s.customItems?s.customItems[c]:void 0;return(m=l||d)==null?void 0:m.setId}).filter(c=>!!c),n=[s.equippedHelm,s.equippedChest,s.equippedBelt,s.equippedGloves,s.equippedBoots,s.equippedCape].filter(Boolean).map(c=>{var m;const l=c?Ee.find(u=>u.id===c):void 0,d=c&&s.customItems?s.customItems[c]:void 0;return(m=l||d)==null?void 0:m.setId}).filter(c=>!!c),o=[s.equippedRingLeft,s.equippedRingRight,s.equippedNecklace,s.equippedEarringLeft,s.equippedEarringRight].filter(Boolean).map(c=>{var m;const l=c?Ee.find(u=>u.id===c):void 0,d=c&&s.customItems?s.customItems[c]:void 0;return(m=l||d)==null?void 0:m.setId}).filter(c=>!!c);for(const c of i)if(n.includes(c)&&o.includes(c)){const l=$o[c];l!=null&&l.bonus&&Object.entries(l.bonus).forEach(([d,m])=>{if(!m)return;const u=d==="sabedoria"?"inteligencia":d==="carisma"?"destreza":d;u in t&&(t[u]+=m)});break}return t},ht=(a,s,t,r,i,n)=>{const c=[s,String(t),JSON.stringify(a),r?JSON.stringify({ew:[r.equippedMainHand,r.equippedOffHand,...Array.isArray(r.equippedWeapons)?r.equippedWeapons:[]].filter(Boolean).join(","),ea:[r.equippedHelm,r.equippedChest,r.equippedBelt,r.equippedGloves,r.equippedBoots,r.equippedCape,...Array.isArray(r.equippedArmorSlots)?r.equippedArmorSlots:[]].filter(Boolean).join(","),ex:[r.equippedRingLeft,r.equippedRingRight,r.equippedNecklace,r.equippedEarringLeft,r.equippedEarringRight,...Array.isArray(r.equippedAccessories)?r.equippedAccessories:[]].filter(Boolean).join(","),ic:Object.keys(r.items||{}).length}):"noinv",i||"",n?JSON.stringify(n):"nocomp"].join("|"),l=ht;l._cache||(l._cache=new Map);const d=l._cache.get(c);if(d)return d;const m=r?nl(a,r):a,u=ha(i),p={...m};Object.entries(u).forEach(([Q,Y])=>{if(!Y)return;const G=Q==="sabedoria"?"inteligencia":Q==="carisma"?"destreza":Q;G in p&&(p[G]+=Y)}),n&&Object.entries(n).forEach(([Q,Y])=>{if(!Y)return;const G=Q==="sabedoria"?"inteligencia":Q==="carisma"?"destreza":Q;G in p&&(p[G]+=Y)});let g=0,v=0;switch(s){case"guerreiro":g=10,v=3;break;case"mago":g=6,v=10;break;case"ladino":g=8,v=6;break;case"clerigo":g=8,v=8;break;case"patrulheiro":g=8,v=6;break;case"paladino":g=10,v=5;break;default:g=8,v=6}const y=g+Math.floor(p.constituicao/2)*t,w=v+Math.floor(p.inteligencia/2)*t,k=Math.floor(p.destreza/2);let E=10+Math.floor(p.destreza/4);if(r){const Q=r.equippedJewelsByItemId||{};let Y=0;Object.entries(Q).forEach(([G,J])=>{const re=Ee.find(_=>_.id===G)||(r.customItems?r.customItems[G]:void 0),ee=(re==null?void 0:re.type)==="armor"?6:(re==null?void 0:re.type)==="weapon"||(re==null?void 0:re.type)==="accessory"?2:0;let fe=0;J.forEach(_=>{const P=_.split(":");if(P.length===3){const M=P[1],C=Number(P[2]),O=new Jt(crypto.randomUUID(),M,C).getBonus();O.armorClass&&(fe+=O.armorClass)}}),Y+=Math.min(ee,fe)}),E+=Math.max(0,Math.floor(Y))}const h=Math.max(0,Math.floor((p.destreza+p.inteligencia)/2)),b=(()=>{try{const Q=get().getSelectedHero();if(Q!=null&&Q.activeMountId&&Array.isArray(Q.mounts)){const Y=Q.mounts.find(re=>re.id===Q.activeMountId),G=Math.max(0,(Y==null?void 0:Y.speedBonus)||0),J=(()=>{const re=Q.mountBuff;return!(re!=null&&re.speedBonus)||re.expiresAt&&Date.now()>new Date(re.expiresAt).getTime()?0:Math.max(0,re.speedBonus||0)})();return G+J}}catch{}return 0})(),f=k+b,j=Math.max(0,(p.forca||0)+(p.destreza||0)),N=Math.max(0,p.inteligencia||0),T=Math.max(0,(p.constituicao||0)+Math.floor(E/2));let F=1,te=1,D=1;switch(s){case"guerreiro":case"barbaro":case"lanceiro":case"paladino":F=1.4,te=.8,D=1.2;break;case"mago":case"feiticeiro":case"druida":F=.8,te=1.5,D=1;break;case"ladino":case"assassino":case"arqueiro":case"patrulheiro":case"monge":F=1.3,te=.9,D=1;break;case"clerigo":case"bardo":F=1,te=1.2,D=1.1;break;default:F=1.1,te=1.1,D=1;break}const $=Math.max(0,Math.round(F*j+te*N+D*T+y*.2+w*.2+f*.5+E*.5+(h||0)*.3+t*2)),X={hp:y,mp:w,initiative:f,armorClass:E,currentHp:y,currentMp:w,luck:h,power:$};if(l._cache.set(c,X),l._cache.size>200){const Q=l._cache.keys().next().value;Q&&l._cache.delete(Q)}return X},Ct=a=>{const s={};if(a.activePetId&&Array.isArray(a.pets)){const t=a.pets.find(r=>r.id===a.activePetId);if(t&&t.attributes){const r=1+Math.max(0,t.refineLevel||0)*.01;Object.entries(t.attributes).forEach(([i,n])=>{if(typeof n=="number"){const o=Math.round(n*r);s[i]=(s[i]||0)+o}})}}if(a.activeMountId&&Array.isArray(a.mounts)){const t=a.mounts.find(r=>r.id===a.activeMountId);if(t&&t.attributes){const r=1+Math.max(0,t.refineLevel||0)*.01;Object.entries(t.attributes).forEach(([o,c])=>{if(typeof c=="number"){const l=Math.round(c*r);s[o]=(s[o]||0)+l}});const i=Math.max(0,t.mastery||0),n=Math.floor(i/10);if(n>0){const o=["grifo","hipogrifo","felino","wyvern","cavalo","lagarto","cervo","alce"],c=["lobo","urso","rinoceronte","javali"];o.includes(t.type)?s.destreza=(s.destreza||0)+n:c.includes(t.type)?s.forca=(s.forca||0)+n:t.type==="draconiano"&&(s.inteligencia=(s.inteligencia||0)+n)}}}return s},Z=Za()(ks((a,s)=>({heroes:[],selectedHeroId:null,availableQuests:[],questCatalog:{},guilds:[],parties:[],referralInvites:[],staminaModal:void 0,dmOverrideLine:void 0,createHero:t=>{const r=new Date().toISOString(),i=s().heroes.filter(l=>l.origin!=="npc");if(!Yc(i)){try{ge.emit({type:"quest",title:"Limite de herÃ³is",message:`Slots usados ${js(i)}/${ys(i)}. Compre ou desbloqueie mais slots.`,icon:"âš ï¸",duration:3500})}catch{}throw new Error("Limite de criaÃ§Ã£o atingido")}const n=il(t.attributes);if(!n.isValid)throw new Error(`Atributos invÃ¡lidos: ${n.errors.join(", ")}`);const o={items:{"pocao-pequena":2,"espada-aprendiz":1,"armadura-novato":1,"capacete-ferro":1,"cinto-couro":1,"luvas-couro":1,"botas-caminhante":1,"capa-iniciante":1,"anel-bronze":1,"anel-vitalidade":1,"colar-madeira":1},equippedMainHand:"espada-aprendiz",equippedOffHand:void 0,equippedHelm:"capacete-ferro",equippedChest:"armadura-novato",equippedBelt:"cinto-couro",equippedGloves:"luvas-couro",equippedBoots:"botas-caminhante",equippedCape:"capa-iniciante",equippedRingLeft:"anel-bronze",equippedRingRight:"anel-vitalidade",equippedNecklace:"colar-madeira",equippedEarringLeft:void 0,equippedEarringRight:void 0,upgrades:{},jewels:{"jewel:vermelha:1":2,"jewel:azul:1":2,"jewel:verde:1":2,"jewel:amarela:1":2,"jewel:roxa:1":2},equippedJewelsByItemId:{}},c={id:la(),...t,level:1,attributePoints:0,derivedAttributes:ht(t.attributes,t.class,1,o,"novato"),element:t.element,skills:t.skills,image:t.image,battleQuote:t.battleQuote,progression:{xp:0,level:1,gold:100,glory:0,arcaneEssence:0,fatigue:0,reputation:0,titles:[],achievements:[],stars:0},journeyChapters:[],titles:[{id:"novato",name:"Novato",description:"Primeiro passo na jornada Ã©pica",badge:"ğŸŒ±",category:"achievement",rarity:"comum",unlockedAt:r}],activeTitle:"novato",inventory:o,activeQuests:[],completedQuests:[],reputationFactions:[{id:"guarda",name:"Guarda da Cidade",reputation:0,level:"neutral"},{id:"ladroes",name:"LadrÃµes",reputation:0,level:"neutral"},{id:"clero",name:"Clero",reputation:0,level:"neutral"},{id:"cultistas",name:"Cultistas",reputation:0,level:"neutral"},{id:"comerciantes",name:"Comerciantes",reputation:0,level:"neutral"},{id:"exploradores",name:"Exploradores",reputation:0,level:"neutral"}],dailyGoals:[],achievements:hc.map(l=>({...l})),stats:{questsCompleted:0,totalCombats:0,totalPlayTime:0,lastActiveAt:r,trainingsToday:0,lastTrainingDate:r,trainingDailyLimit:10,trainingAttemptsByStatus:{}},createdAt:r,updatedAt:r};c.rankData=We.initializeRankData(c),c.worldState=ut.initializeWorldState(),c.stamina={current:100,max:100,lastRecovery:r,recoveryRate:5},c.dungeon={stamina:{current:50,max:50,lastRecovery:r,recoveryRate:5},maxFloor:0,eternalBuffs:[],rareItemBonusPercent:0,specialSkills:[],permanentBonusAttributes:{}},a(l=>({heroes:[...l.heroes,c],selectedHeroId:c.id})),je.heroCreated(c.id,{class:c.class,attributes:c.attributes,timestamp:r}),s().ensureDefaultGuildExists(),s().refreshQuests(1);try{Ve.markStepValidated("create-hero")}catch{}try{Ve.saveState()}catch{}return c},purchaseHeroSlotForSelected:()=>{const t=s().getSelectedHero();if(!t)return!1;const i=Zc(n=>{const o={...t.progression||{}},c=Math.max(0,o.gold||0);return c<n?!1:(o.gold=c-n,s().updateHero(t.id,{progression:o}),!0)});if(i)try{ge.emit({type:"achievement",title:"Slot comprado",message:`Novo slot de herÃ³i desbloqueado. Agora: ${js(s().heroes.filter(n=>n.origin!=="npc"))}/${ys(s().heroes.filter(n=>n.origin!=="npc"))}.`,icon:"â­",duration:3500})}catch{}else try{ge.emit({type:"item",title:"Compra falhou",message:`PreÃ§o atual: ${Sr()} ouro`,icon:"ğŸª™",duration:3e3})}catch{}return i},createNPCAdventurer:t=>{const r=["humano","elfo","anao","orc","halfling"],i=["guerreiro","mago","ladino","clerigo","patrulheiro","paladino","arqueiro","bardo","monge","assassino","barbaro","lanceiro","druida","feiticeiro"],n=["fire","water","earth","air","thunder","light","dark","physical"],o=["Alenna","Borin","Calyra","Darius","Eldric","Fiora","Garruk","Hellan","Ilyon","Jorvik","Kaelis","Lyra","Morth","Nerion","Orla","Peren","Quen","Ragna","Sylas","Thorin"],c=y=>y[Math.floor(Math.random()*y.length)];let l={forca:3,destreza:3,constituicao:3,inteligencia:3,sabedoria:3,carisma:3};t!=null&&t.attributes&&(l={...l,...t.attributes});const d={name:(t==null?void 0:t.name)||c(o),race:(t==null?void 0:t.race)||c(r),class:(t==null?void 0:t.class)||c(i),attributes:l,element:(t==null?void 0:t.element)||c(n),skills:(t==null?void 0:t.skills)||[]},m=s().createHero(d);qc(m);const u=s().getSelectedHero(),p=m.npcPersonality||{archetype:"explorador",traits:[],chatStyle:"amigavel"};let g=Math.floor(-20+Math.random()*40);((p.traits||[]).includes("generoso")||p.chatStyle==="amigavel")&&(g+=8),((p.traits||[]).includes("desconfiado")||p.archetype==="competitivo")&&(g-=12),g=Math.max(-60,Math.min(25,g));const v=u&&u.origin!=="npc"?{[u.id]:g}:{};return s().updateHero(m.id,{origin:"npc",controlledByAI:!0,npcPersonality:m.npcPersonality,npcRoutine:m.npcRoutine,npcMemory:m.npcMemory,socialRelations:v}),s().heroes.find(y=>y.id===m.id)},ensureNPCAdventurersSeedExists:(t=5)=>{const r=s().heroes.filter(n=>n.origin==="npc").length,i=Math.max(0,t-r);for(let n=0;n<i;n++)s().createNPCAdventurer({});try{s().dedupeNPCs()}catch{}},seedRandomHatred:(t=3)=>{const r=s().getSelectedHero();if(!r)return;s().ensureNPCAdventurersSeedExists(Math.max(t,5));const i=s().heroes.filter(d=>d.origin==="npc");if(i.length===0)return;const n=Math.min(t,i.length),o=i.slice(),c=[];for(let d=0;d<n;d++){const m=Math.floor(Math.random()*o.length);c.push(o.splice(m,1)[0])}const l=r.worldState||require("../utils/worldState").worldStateManager.initializeWorldState();l.npcStatus=l.npcStatus||{},c.forEach(d=>{const m={...d.socialRelations||{}},u=Math.max(-100,Math.min(-60,-60-Math.floor(Math.random()*40)));m[r.id]=u,d.socialRelations=m;try{s().updateHero(d.id,{socialRelations:m,npcMood:"irritado"})}catch{}l.npcStatus[d.id]={alive:!0,relationToPlayer:u,lastInteraction:new Date().toISOString(),currentLocation:"taverna"}});try{s().updateHero(r.id,{worldState:l})}catch{}try{ge.emit({type:"quest",title:"Rivalidades",message:`${c.length} NPC(s) agora te odeiam`,icon:"âš ï¸",duration:2500})}catch{}},startNPCSimulation:()=>{const t=Z;if(t._npcTimer)return;const r=()=>{var c;const i=s().getSelectedHero(),n=s().heroes.filter(l=>l.origin==="npc");on(i,n,l=>ge.emit(l)),Oc(.02),Math.random()<.4&&Lc(420+Math.floor(Math.random()*80),180),n.forEach(l=>{const d=Ct(l),m=ht(l.attributes,l.class,l.progression.level,l.inventory,l.activeTitle,d);s().updateHero(l.id,{attributes:l.attributes,progression:l.progression,stats:l.stats,completedQuests:l.completedQuests,derivedAttributes:m,socialRelations:l.socialRelations,npcMemory:l.npcMemory})});const o=s().heroes;Ya(o),(c=je.custom)==null||c.call(je,"npc_tick",{npcs:n.length,ts:Date.now()})};t._npcTimer=setInterval(r,3e4)},stopNPCSimulation:()=>{const t=Z;t._npcTimer&&(clearInterval(t._npcTimer),t._npcTimer=void 0)},setDuelOverlay:t=>{a({duelOverlay:t})},setNPCInteractionOverlay:t=>{a({npcInteractionOverlay:t})},setStaminaModal:t=>{a({staminaModal:t})},respondToNPCInteraction:async t=>{const r=s().npcInteractionOverlay;if(!r)return;const i=s().getSelectedHero(),n=s().heroes.find(c=>c.id===r.npcId);if(!i||!n){a({npcInteractionOverlay:void 0});return}if(t==="accept")try{const c=await $s(i.id,"SOCIAL_DEEP");if(!c.ok){try{ge.emit({type:"stamina",title:"Fadiga alta",message:`InteraÃ§Ã£o profunda requer ${c.cost} âš¡. Descanse para reduzir fadiga.`,duration:2500,icon:"ğŸ’¤"})}catch{}a({npcInteractionOverlay:void 0}),a({staminaModal:{required:c.cost,actionType:"SOCIAL_DEEP"}});return}const l=await _s(i.id,"SOCIAL_DEEP",{npcId:n.id}),d=i.stamina||{current:100,max:100};s().updateHero(i.id,{stamina:{...d,current:l.newStamina}})}catch{}let o="neutro";t==="accept"?o="amigÃ¡vel":t==="decline"&&(o="hostil"),vr(n,i,o),ge.emit({type:t==="accept"?"achievement":"stamina",title:"InteraÃ§Ã£o com NPC",message:`${n.name}: ${t==="accept"?"AgradeÃ§o!":t==="decline"?"Talvez outra hora...":"Certo, conversamos depois."}`,icon:"ğŸ’¬",duration:2500}),a({npcInteractionOverlay:void 0})},recordActivity:t=>{const r=s(),n=[{ts:new Date().toISOString(),...t},...r.activitiesLog].slice(0,500);a({activitiesLog:n});try{const o=require("../store/gameSettingsStore").getGameSettings(),c=o.notifPriorityMode||"important_first",l=o.notifFrequency||"normal";if(t.importance==="high"||c==="normal"){const m=t.type==="dialogue"?"ğŸ’¬":t.type==="rumor"?"ğŸ—£ï¸":t.type==="tip"?"ğŸ“œ":"â­";ge.emit({type:"quest",title:"Atividade",message:t.text,icon:m,duration:l==="low"?2e3:l==="high"?4e3:3e3}),(o.notifSoundEnabled??!0)&&require("../utils/audio").playVoiceCue(430+Math.floor(Math.random()*60),180)}}catch{}},triggerAutoInteraction:t=>{try{const r=require("../store/gameSettingsStore").getGameSettings();if(!r.autoInteractionEnabled)return;const i=Math.max(0,r.autoChanceMinPercent??30),n=Math.max(i,r.autoChanceMaxPercent??70),o=(i+Math.random()*(n-i))/100,c=s().lastAutoInteractionAt,l=r.interactionsCooldownMinutes??Math.round((r.npcInteractionCooldownSeconds??900)/60);if(!(!c||(Date.now()-new Date(c).getTime())/6e4>=l))return;if(Math.random()<o){const m=s().getSelectedHero(),u=s().heroes.find(v=>v.origin==="npc");if(!m||!u)return;const g=require("../utils/dialogueEngine").generateMixed(u,m,2);a({npcInteractionOverlay:{npcId:u.id,npcName:u.name,lines:g},lastAutoInteractionAt:new Date().toISOString()}),s().recordActivity({type:"dialogue",location:t,npcId:u.id,text:`${u.name}: ${g[0]}`,importance:"normal"})}}catch{}},dedupeNPCs:()=>{const t=s(),r=t.heroes.filter(d=>d.origin==="npc"),i=d=>`${(d.name||"").toLowerCase()}::${d.class||""}`,n=new Map;r.forEach(d=>{const m=i(d),u=n.get(m)||[];u.push(d),n.set(m,u)});let o=0;const c=[],l={};if(n.forEach((d,m)=>{if(d.length<=1)return;const u=d.slice().sort((v,y)=>{var w,k,E,h;return(((w=y.progression)==null?void 0:w.level)||0)-(((k=v.progression)==null?void 0:k.level)||0)||(((E=y.progression)==null?void 0:E.xp)||0)-(((h=v.progression)==null?void 0:h.xp)||0)})[0],p=d.filter(v=>v.id!==u.id),g={...u};p.forEach(v=>{var k,E,h,b,f,j,N,T,F,te,D,$,X,Q,Y,G;g.progression={...g.progression,xp:Math.max(((k=g.progression)==null?void 0:k.xp)||0,((E=v.progression)==null?void 0:E.xp)||0),gold:Math.max(((h=g.progression)==null?void 0:h.gold)||0,((b=v.progression)==null?void 0:b.gold)||0),level:Math.max(((f=g.progression)==null?void 0:f.level)||1,((j=v.progression)==null?void 0:j.level)||1)},g.stats={...g.stats,questsCompleted:(((N=g.stats)==null?void 0:N.questsCompleted)||0)+(((T=v.stats)==null?void 0:T.questsCompleted)||0),enemiesDefeated:(((F=g.stats)==null?void 0:F.enemiesDefeated)||0)+(((te=v.stats)==null?void 0:te.enemiesDefeated)||0),itemsFound:(((D=g.stats)==null?void 0:D.itemsFound)||0)+((($=v.stats)==null?void 0:$.itemsFound)||0),totalCombats:(((X=g.stats)==null?void 0:X.totalCombats)||0)+(((Q=v.stats)==null?void 0:Q.totalCombats)||0),totalPlayTime:(((Y=g.stats)==null?void 0:Y.totalPlayTime)||0)+(((G=v.stats)==null?void 0:G.totalPlayTime)||0)};const y=g.npcMemory||{interactions:[],preferences:{},scoreByAction:{},socialNotesByHeroId:{}},w=v.npcMemory||{interactions:[],preferences:{},scoreByAction:{},socialNotesByHeroId:{}};g.npcMemory={interactions:[...y.interactions,...w.interactions].slice(-50),preferences:{...y.preferences||{},...w.preferences||{}},scoreByAction:{...y.scoreByAction||{},...w.scoreByAction||{}},friendStatusByHeroId:{...y.friendStatusByHeroId||{},...w.friendStatusByHeroId||{}},lastContactByHeroId:{...y.lastContactByHeroId||{},...w.lastContactByHeroId||{}},lastInteractionByType:{...y.lastInteractionByType||{},...w.lastInteractionByType||{}},socialNotesByHeroId:{...y.socialNotesByHeroId||{},...w.socialNotesByHeroId||{}}},o++,c.push(v.id)}),l[u.id]=g}),o>0){const d=t.heroes.filter(m=>!c.includes(m.id)).map(m=>l[m.id]?l[m.id]:m);a({heroes:d});try{ge.emit({type:"item",title:"NPCs Deduplicados",message:`Atualizados ${o} duplicados`,icon:"ğŸ§¹",duration:2500})}catch{}}return{checked:r.length,removed:o}},setPartyInviteTerms:(t,r,i)=>{var g,v;const n=s().parties.find(y=>y.id===t);if(!n)return;const o=["F","E","D","C","B","A","S"],c=y=>Math.max(0,o.indexOf((y||"F").toUpperCase())),l=s().heroes.find(y=>y.id===n.leaderId),d=s().heroes.find(y=>y.id===r);let m={...i};if(l&&d&&Math.abs(c(((g=l.rankData)==null?void 0:g.currentRank)||"F")-c(((v=d.rankData)==null?void 0:v.currentRank)||"F"))===2){m.rewardShare=Math.max(5,Math.floor((m.rewardShare||10)*.5));try{ge.emit({type:"item",title:"Ajuste de contrato",message:"DiferenÃ§a de 2 ranks: recompensa reduzida em 50%.",icon:"âš–ï¸",duration:2500})}catch{}}const u={...n.inviteTerms||{}};u[r]=m;const p={...n,inviteTerms:u};a(y=>({parties:y.parties.map(w=>w.id===t?p:w)}))},getDuelInvitesForHero:t=>{const r=s().heroes.find(i=>i.id===t);return Array.isArray(r==null?void 0:r.duelInvites)?r.duelInvites:[]},acceptDuelInvite:(t,r)=>{var v,y;const i=s().heroes.find(w=>w.id===t);if(!i)return!1;const n=Array.isArray(i.duelInvites)?i.duelInvites:[],o=n.findIndex(w=>w.npcId===r);if(o===-1)return!1;const c=n[o],l=n.filter(w=>w.npcId!==r),d=s().heroes.find(w=>w.id===r),m=d?Bc(i,d,c.type):null,u={duelInvites:l},p={...i.stats};p.duelsPlayed=(p.duelsPlayed||0)+1,m&&m.winnerId===i.id&&(p.duelsWon=(p.duelsWon||0)+1),u.stats=p;const g={...i.progression};if(m&&(g.xp=(g.xp||0)+m.rewards.xp,g.gold=(g.gold||0)+m.rewards.gold),u.progression=g,d&&m){const w={...d.socialRelations||{}};w[t]=(w[t]||0)+(c.type==="honra"?m.winnerId===i.id?10:5:2),s().updateHero(d.id,{socialRelations:w})}s().updateHero(t,u);try{const w=m?m.winnerId===i.id:!1;ge.emit({type:w?"achievement":"stamina",title:"Duelo",message:`${(d==null?void 0:d.name)||"NPC"} ${w?"foi derrotado":"venceu"} no duelo (${c.type}).`,icon:"âš”ï¸",duration:3e3}),a({duelOverlay:m?{...m,aName:i.name,bName:(d==null?void 0:d.name)||"NPC",aClass:i.class,bClass:(d==null?void 0:d.class)||"guerreiro",aWeaponId:(v=i.inventory)==null?void 0:v.equippedMainHand,bWeaponId:(y=d==null?void 0:d.inventory)==null?void 0:y.equippedMainHand}:void 0})}catch{}return!0},declineDuelInvite:(t,r)=>{const i=s().heroes.find(c=>c.id===t);if(!i)return!1;const n=Array.isArray(i.duelInvites)?i.duelInvites:[];if(!n.some(c=>c.npcId===r))return!1;const o=n.filter(c=>c.npcId!==r);s().updateHero(t,{duelInvites:o});try{ge.emit({type:"item",title:"Duelo recusado",message:"Convite removido.",icon:"âš”ï¸",duration:2e3})}catch{}return!0},acceptPartyInvite:(t,r)=>{const i=s().parties.find(p=>p.id===r);if(!i||!(i.invites||[]).includes(t))return!1;const n=[...i.members,t],o=(i.invites||[]).filter(p=>p!==t),c={...i.inviteTerms||{}},l=c[t],d={...i.contractByHeroId||{}};l&&(d[t]={duration:l.duration||"one_mission",days:l.days,rewardShare:Math.max(5,Math.min(50,l.rewardShare||10)),leaderPref:l.leaderPref}),delete c[t];const m={...i,members:n,invites:o,inviteTerms:c,contractByHeroId:d};a(p=>({parties:p.parties.map(g=>g.id===r?m:g)}));const u=s().heroes.find(p=>p.id===t);if(u&&l){const p=Math.round(10+(l.rewardShare||10)),g=Math.round((l.rewardShare||10)*2),v={...u.progression,xp:(u.progression.xp||0)+p,gold:(u.progression.gold||0)+g};s().updateHero(t,{progression:v});try{ge.emit({type:"achievement",title:"Apoio Ã  Party",message:`VocÃª recebeu +${p} XP e +${g} ouro pelo acordo`,icon:"ğŸ–ï¸",duration:3500})}catch{}}else try{ge.emit({type:"achievement",title:"Convite aceito",message:"VocÃª agora faz parte da party.",icon:"âœ…",duration:3500})}catch{}return!0},declinePartyInvite:(t,r)=>{var l;const i=s().parties.find(d=>d.id===r);if(!i||!(i.invites||[]).includes(t))return!1;const n=(l=i.invites||[])==null?void 0:l.filter(d=>d!==t),o={...i.inviteTerms||{}};delete o[t];const c={...i,invites:n,inviteTerms:o};a(d=>({parties:d.parties.map(m=>m.id===r?c:m)}));try{ge.emit({type:"stamina",title:"Convite recusado",message:"Convite removido.",icon:"ğŸšª",duration:2500})}catch{}return!0},getHeroParty:t=>{const r=s();return(Array.isArray(r.parties)?r.parties:[]).find(n=>Array.isArray(n.members)&&n.members.includes(t))},createParty:(t,r)=>{const n=s().parties.find(c=>Array.isArray(c.members)&&c.members.includes(t));if(n)return n;const o={id:`party-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:String(r).slice(0,40),leaderId:t,members:[t],invites:[],createdAt:new Date().toISOString(),sharedLoot:!0,sharedXP:!0};return a(c=>({parties:[...Array.isArray(c.parties)?c.parties:[],o]})),o},inviteHeroToParty:(t,r,i)=>{var d,m;const n=s(),o=(Array.isArray(n.parties)?n.parties:[]).find(u=>u.id===t);if(!o||o.leaderId!==r&&!o.members.includes(r))return!1;const c=s().heroes.find(u=>u.id===r),l=s().heroes.find(u=>u.id===i);if(c&&l){const u=((d=c.rankData)==null?void 0:d.currentRank)||"F",p=((m=l.rankData)==null?void 0:m.currentRank)||"F";if(u!==p)return!1}return o.invites=Array.isArray(o.invites)?o.invites:[],!o.invites.includes(i)&&!o.members.includes(i)?(o.invites.push(i),a(u=>({parties:u.parties.map(p=>p.id===t?o:p)})),!0):!1},leaveParty:t=>{const r=s(),i=(Array.isArray(r.parties)?r.parties:[]).find(o=>Array.isArray(o.members)&&o.members.includes(t));if(!i)return!1;i.members=i.members.filter(o=>o!==t),i.leaderId===t&&(i.leaderId=i.members[0]||i.leaderId);const n=i.members.length?r.parties.map(o=>o.id===i.id?i:o):r.parties.filter(o=>o.id!==i.id);return a({parties:n}),!0},generateEggForSelected:t=>{const r=s().getSelectedHero();if(!r)return!1;const i=30;if((r.eggs||[]).length>=i){try{ge.emit({type:"item",title:"InventÃ¡rio de Ovos Cheio",message:"Libere espaÃ§o antes de obter novos ovos.",duration:5e3})}catch{}return!1}const n=Va(t),o=[...r.eggs||[],n];s().updateHero(r.id,{eggs:o});try{Ze.auth.getUser().then(({data:c})=>{var d;const l=(d=c==null?void 0:c.user)==null?void 0:d.id;l&&Bt(l,Z.getState().heroes.find(m=>m.id===r.id))})}catch{}return!0},identifyEggForSelected:t=>{const r=s().getSelectedHero();if(!r)return!1;const i=(r.eggs||[]).findIndex(u=>u.id===t);if(i===-1)return!1;const n=r.eggs[i];if(n.status!=="misterioso")return!1;const o=cn[n.baseRarity],c=Math.floor(o.min+Math.random()*(o.max-o.min));if((r.progression.gold||0)<c)return!1;const l=Gc(n),d={...n,status:"identificado",identified:l,name:l.revealedName||n.name},m=[...r.eggs];m[i]=d,s().updateHero(r.id,{eggs:m,progression:{...r.progression,gold:Math.max(0,(r.progression.gold||0)-c)}});try{Ze.auth.getUser().then(({data:u})=>{var g;const p=(g=u==null?void 0:u.user)==null?void 0:g.id;p&&Bt(p,Z.getState().heroes.find(v=>v.id===r.id))})}catch{}return!0},startIncubationForSelected:(t,r=0)=>{const i=s().getSelectedHero();if(!i)return!1;const n=i.eggs||[],o=n.findIndex(g=>g.id===t);if(o===-1)return!1;const c=n.filter(g=>g.status==="incubando"&&typeof g.incubatingSlot=="number").map(g=>g.incubatingSlot);if(c.length>=3)return!1;let l=r;for(let g=0;g<3;g++)if(!c.includes(g)){l=g;break}const d=n[o];if(d.status!=="identificado")return!1;const u={...zc(d),incubatingSlot:l},p=[...n];p[o]=u,s().updateHero(i.id,{eggs:p});try{Ze.auth.getUser().then(({data:g})=>{var y;const v=(y=g==null?void 0:g.user)==null?void 0:y.id;v&&Bt(v,Z.getState().heroes.find(w=>w.id===i.id))})}catch{}return!0},accelerateIncubationForSelected:(t,r,i)=>{var p;const n=s().getSelectedHero();if(!n)return!1;const o=n.eggs||[],c=o.findIndex(g=>g.id===t);if(c===-1)return!1;const l=o[c];if(l.status!=="incubando")return!1;let d=0;if(r==="essencia"&&(d=15*60*1e3),r==="brasas"&&(d=60*60*1e3),r==="ouro"){const g=Math.max(0,i||0);if((n.progression.gold||0)<g)return!1;d=Math.min(ln[((p=l.identified)==null?void 0:p.rarity)||l.baseRarity],g*60*1e3/10),s().updateHero(n.id,{progression:{...n.progression,gold:Math.max(0,(n.progression.gold||0)-g)}})}const m=Jc(l,d),u=[...o];u[c]=m,s().updateHero(n.id,{eggs:u});try{Ze.auth.getUser().then(({data:g})=>{var y;const v=(y=g==null?void 0:g.user)==null?void 0:y.id;v&&Bt(v,Z.getState().heroes.find(w=>w.id===n.id))})}catch{}return!0},updateIncubationTick:()=>{const t=s().getSelectedHero();if(!t)return;const i=(t.eggs||[]).map(n=>mn(n));s().updateHero(t.id,{eggs:i})},hatchEggForSelected:t=>{var w,k,E;const r=s().getSelectedHero();if(!r)return!1;const i=50;if((r.pets||[]).length>=i){try{ge.emit({type:"item",title:"Limite de Mascotes",message:"VocÃª atingiu o limite de mascotes. Libere espaÃ§o antes de chocar.",duration:5e3})}catch{}return!1}if(r.hatchCooldownEndsAt){const h=new Date(r.hatchCooldownEndsAt).getTime();if(Date.now()<h){try{ge.emit({type:"item",title:"Cooldown de Chocagem",message:"Aguarde o fim do cooldown para chocar outro ovo.",duration:4e3})}catch{}return!1}}const n=r.eggs||[],o=n.findIndex(h=>h.id===t);if(o===-1)return!1;const c=n[o];if(!(c.status==="pronto_para_chocar"||c.status==="incubando"&&dn(c)))return!1;const d={comum:5,incomum:10,raro:20,epico:50,lendario:100,mistico:200}[((w=c.identified)==null?void 0:w.rarity)||c.baseRarity];if((r.progression.gold||0)<d){try{ge.emit({type:"gold",title:"Ouro insuficiente",message:`Chocar este ovo requer ${d} ouro.`,duration:4e3})}catch{}return!1}const m=Qc(c),u=n.filter(h=>h.id!==t),p=[...r.pets||[],m],g=[...r.hatchHistory||[],{eggId:c.id,petId:m.id,timestamp:new Date().toISOString(),rarity:((k=c.identified)==null?void 0:k.rarity)||c.baseRarity,hatchCost:d}],v=30*1e3,y={...r.progression,gold:Math.max(0,(r.progression.gold||0)-d)};s().updateHero(r.id,{eggs:u,pets:p,hatchHistory:g,hatchCooldownEndsAt:new Date(Date.now()+v).toISOString(),progression:y});try{ge.emit({type:"item",title:"Mascote Obtido",message:`VocÃª obteve ${m.name}!`,duration:4e3,icon:"ğŸ¾"})}catch{}try{ge.emit({type:"item",title:"Ovo Chocado",message:"O ovo foi consumido e removido do inventÃ¡rio.",duration:3e3,icon:"ğŸ¥š"})}catch{}try{gt.petHatched({heroId:r.id,heroName:r.name,heroClass:r.class,heroLevel:r.progression.level,petName:m.name,petType:m.type,eggRarity:((E=c.identified)==null?void 0:E.rarity)||c.baseRarity,costGold:d})}catch{}try{Ze.auth.getUser().then(({data:h})=>{var f;const b=(f=h==null?void 0:h.user)==null?void 0:f.id;b&&Bt(b,Z.getState().heroes.find(j=>j.id===r.id))})}catch{}try{s().updateDailyGoalProgress(r.id,"pet-hatched",1)}catch{}return!0},accelerateHatchCooldownForSelected:t=>{const r=s().getSelectedHero();if(!r||!r.hatchCooldownEndsAt)return!1;const i=Math.max(0,t||0);if((r.progression.gold||0)<i)return!1;const n=new Date(r.hatchCooldownEndsAt).getTime(),o=Math.floor(i/10*60*1e3),c=Math.max(Date.now(),n-o),l={...r.progression,gold:Math.max(0,(r.progression.gold||0)-i)};s().updateHero(r.id,{hatchCooldownEndsAt:new Date(c).toISOString(),progression:l});try{const d=Math.floor(o/6e4);ge.emit({type:"item",title:"Cooldown reduzido",message:`- ${d} min no cooldown de chocagem`,duration:3e3,icon:"â±ï¸"})}catch{}try{Ze.auth.getUser().then(({data:d})=>{var u;const m=(u=d==null?void 0:d.user)==null?void 0:u.id;m&&Bt(m,Z.getState().heroes.find(p=>p.id===r.id))})}catch{}return!0},consumeInventoryItem:(t,r,i=1)=>{const n=s().heroes.find(l=>l.id===t);if(!n)return!1;const o=n.inventory.items[r]||0;if(o<i)return!1;const c={...n.inventory.items,[r]:Math.max(0,o-i)};return c[r]<=0&&delete c[r],s().updateHero(t,{inventory:{...n.inventory,items:c}}),!0},addPetXPForSelected:(t,r)=>{const i=s().getSelectedHero();if(!i)return!1;const n=i.pets||[],o=n.findIndex(d=>d.id===t);if(o===-1)return!1;const c=oi(n[o],r),l=[...n];l[o]=c,s().updateHero(i.id,{pets:l});try{s().updateDailyGoalProgress(i.id,"pet-trained",1)}catch{}return!0},sellPetForSelected:t=>{var k;const r=s().getSelectedHero();if(!r)return!1;const i=r.pets||[],n=i.findIndex(E=>E.id===t);if(n===-1)return!1;const o=i[n],l={comum:100,incomum:200,raro:400,epico:800,lendario:1600,mistico:3e3}[o.rarity]||100,d=Math.max(0,o.level||1)*20,m=Math.max(0,o.refineLevel||0)*50,u=(k=o.mutation)!=null&&k.variant?200:0,p=l+d+m+u,g=i.filter(E=>E.id!==t),v={pets:g,progression:{...r.progression,gold:(r.progression.gold||0)+p}};r.activePetId===t&&(v.activePetId=void 0);const y=Ct({...r,pets:g,activePetId:v.activePetId}),w=ht(r.attributes,r.class,r.progression.level,r.inventory,r.activeTitle,y);v.derivedAttributes=w,s().updateHero(r.id,v);try{ge.emit({type:"gold",title:"Mascote vendido",message:`Recebido ${p} ouro por ${o.name}.`,duration:3500,icon:"ğŸ’°"})}catch{}try{Ze.auth.getUser().then(({data:E})=>{var b;const h=(b=E==null?void 0:E.user)==null?void 0:b.id;h&&Bt(h,Z.getState().heroes.find(f=>f.id===r.id))})}catch{}return!0},setActivePet:t=>{const r=s().getSelectedHero();if(!r)return;const n=(r.pets||[]).some(l=>l.id===t)?t:void 0,o=Ct({...r,activePetId:n}),c=ht(r.attributes,r.class,r.progression.level,r.inventory,r.activeTitle,o);s().updateHero(r.id,{activePetId:n,derivedAttributes:c})},setActiveMount:t=>{var l;const r=s().getSelectedHero();if(!r)return;const i=(r.mounts||[]).some(d=>d.id===t),n=i?t:void 0;if(i){const d=r.mounts||[],m=d.findIndex(u=>u.id===t);if(m>=0){const u=d[m],p=[{ts:new Date().toISOString(),action:"activate",details:""},...u.history||[]].slice(0,50),g=[...d];g[m]={...u,history:p},r.mounts=g}}const o=Ct({...r,activeMountId:n}),c=ht(r.attributes,r.class,r.progression.level,r.inventory,r.activeTitle,o);s().updateHero(r.id,{activeMountId:n,derivedAttributes:c});try{ge.emit({type:"item",title:n?"Montaria Ativada":"Montaria Desativada",message:n?"Sua montaria estÃ¡ ativa e concedendo bÃ´nus.":"VocÃª desativou sua montaria.",duration:3e3,icon:n?"ğŸ‡":"ğŸ›‘"})}catch{}try{(l=je.custom)==null||l.call(je,"mount_activated",{heroId:r.id,mountId:n})}catch{}},setFavoriteMount:t=>{var o;const r=s().getSelectedHero();if(!r)return;const i=(r.mounts||[]).some(c=>c.id===t),n=i?t:void 0;if(i){const c=r.mounts||[],l=c.findIndex(d=>d.id===t);if(l>=0){const d=c[l],m=[{ts:new Date().toISOString(),action:n?"favorite_set":"favorite_removed",details:""},...d.history||[]].slice(0,50),u=[...c];u[l]={...d,history:m},r.mounts=u}}s().updateHero(r.id,{favoriteMountId:n});try{ge.emit({type:"item",title:n?"Favorita definida":"Favorita removida",message:n?"Sua montaria favorita foi definida.":"VocÃª removeu a favorita.",duration:3e3,icon:"â­"})}catch{}try{(o=je.custom)==null||o.call(je,"mount_favorite_set",{heroId:r.id,mountId:n})}catch{}},setMountNoteForSelected:(t,r)=>{const i=s().getSelectedHero();if(!i)return!1;const n=i.mounts||[],o=n.findIndex(l=>l.id===t);if(o===-1)return!1;const c=[...n];c[o]={...c[o],note:r},s().updateHero(i.id,{mounts:c});try{ge.emit({type:"item",title:"Nota salva",message:"Sua nota foi atualizada.",duration:2500,icon:"ğŸ“"})}catch{}return!0},toggleFavoriteMount:t=>{var d;const r=s().getSelectedHero();if(!r||!(r.mounts||[]).some(m=>m.id===t))return;let o=[...r.favoriteMountIds||[]];o.includes(t)?o=o.filter(m=>m!==t):o.length<3&&o.push(t);const c=r.mounts||[],l=c.findIndex(m=>m.id===t);if(l>=0){const m=c[l],u=[{ts:new Date().toISOString(),action:o.includes(t)?"favorite_set":"favorite_removed",details:"multi"},...m.history||[]].slice(0,50),p=[...c];p[l]={...m,history:u},s().updateHero(r.id,{favoriteMountIds:o,mounts:p})}else s().updateHero(r.id,{favoriteMountIds:o});try{ge.emit({type:"item",title:o.includes(t)?"Favorito adicionado":"Favorito removido",message:`Slots: ${o.length}/3`,duration:3e3,icon:"â­"})}catch{}try{(d=je.custom)==null||d.call(je,"mount_favorite_toggle",{heroId:r.id,mountId:t,count:o.length})}catch{}},toggleLockMount:t=>{const r=s().getSelectedHero();if(!r)return!1;const i=r.mounts||[],n=i.findIndex(l=>l.id===t);if(n===-1)return!1;const o=i[n],c=[...i];c[n]={...o,locked:!o.locked},s().updateHero(r.id,{mounts:c});try{ge.emit({type:"item",title:o.locked?"Montaria Destravada":"Montaria Travada",message:o.locked?"Agora pode ser liberada.":"Protegida contra liberaÃ§Ã£o em lote.",duration:3e3,icon:o.locked?"ğŸ”“":"ğŸ”’"})}catch{}return!0},generateMountForSelected:(t,r)=>{var b,f;const i=s().getSelectedHero();if(!i)return!1;const n=i.stableCapacity||50;if((i.mounts||[]).length>=n){try{ge.emit({type:"item",title:"Limite de Montarias",message:"VocÃª atingiu o limite de montarias. Libere espaÃ§o antes de recrutar.",duration:5e3})}catch{}return!1}const o=new Date().toISOString(),c=["cavalo","lobo","grifo","javali","lagarto","draconiano","urso","felino","cervo","alce","hipogrifo","rinoceronte","wyvern"],l=t&&c.includes(t)?t:c[Math.floor(Math.random()*c.length)],m=r&&["comum","incomum","raro","epico","lendario","mistico"].includes(r)?r:Math.random()>.97?"epico":Math.random()>.9?"raro":"comum",u={cavalo:["Corcel Ãgil","Corcel da Brisa","Cavalo de Estepes"],lobo:["Alcateiro","Lobo da Neve","Lobo das Sombras"],grifo:["Grifo Nobre","Asa Solar","Sentinela Alada"],javali:["Javali Robusto","Dente de Ferro","Batedor da Mata"],lagarto:["Lagarto RÃ¡pido","Corre-Folhas","Cauda Veloz"],draconiano:["Draconiano Jovem","Escama Rubra","Enguia Arcana"],urso:["Urso MontanhÃªs","Urso das Rochas","Urso das Neves"],felino:["Felino Ãgil","Garra de Vento","Sombra Silenciosa"],cervo:["Cervo Celeste","Cervo das Auroras","Cervo EtÃ©reo"],alce:["Alce Majestoso","Alce do Vale","Chifre Antigo"],hipogrifo:["Hipogrifo Jovem","Hipogrifo do CrepÃºsculo","Asa de Prata"],rinoceronte:["Rinoceronte de Guerra","Casco de Pedra","Chifre Tirano"],wyvern:["Wyvern Veloz","Wyvern do TrovÃ£o","Rasga-CÃ©us"]},p={cavalo:1,lobo:0,grifo:1,javali:0,lagarto:0,draconiano:1,urso:0,felino:1,cervo:1,alce:1,hipogrifo:1,rinoceronte:0,wyvern:1},g={cavalo:{destreza:1},lobo:{forca:2},grifo:{destreza:1},javali:{constituicao:2},lagarto:{destreza:1},draconiano:{inteligencia:1},urso:{forca:2},felino:{destreza:2},cervo:{destreza:1},alce:{constituicao:2},hipogrifo:{destreza:2},rinoceronte:{forca:3,constituicao:1},wyvern:{destreza:2}},v=u[l]||[l],y=v[Math.floor(Math.random()*v.length)],w=p[l]||0,k=g[l]||{};conf.speed+(m==="raro"?1:m==="epico"||m==="lendario"?2:0);const E={id:la(),name:y,type:l,rarity:m,stage:"comum",speedBonus:w+(m==="raro"?1:m==="epico"||m==="lendario"?2:0),attributes:{...k},createdAt:o},h=[...i.mounts||[],E];s().updateHero(i.id,{mounts:h});try{if(localStorage.getItem("auto_activate_recommended_mount")==="1"){const N={comum:0,encantada:1,lendaria:2},T={comum:0,incomum:1,raro:2,epico:3,lendario:4,mistico:5},F=D=>{const $=Object.values(D.attributes||{}).reduce((X,Q)=>X+(typeof Q=="number"?Q:0),0);return(D.speedBonus||0)*3+$+(N[D.stage]||0)*2+(T[D.rarity]||0)},te=(b=h.slice().sort((D,$)=>F($)-F(D))[0])==null?void 0:b.id;if(te){const D=Ct({...i,activeMountId:te,mounts:h}),$=ht(i.attributes,i.class,i.progression.level,i.inventory,i.activeTitle,D);s().updateHero(i.id,{activeMountId:te,derivedAttributes:$}),ge.emit({type:"item",title:"Recomendada ativada",message:"Auto ativaÃ§Ã£o da melhor montaria.",duration:3e3,icon:"â­"})}}}catch{}try{ge.emit({type:"item",title:"Montaria Obtida",message:`VocÃª obteve ${E.name}!`,duration:4e3,icon:"ğŸ‡"})}catch{}try{(f=je.custom)==null||f.call(je,"mount_generated",{heroId:i.id,type:l,rarity:m})}catch{}return!0},renameMountForSelected:(t,r)=>{const i=s().getSelectedHero();if(!i)return!1;const n=i.mounts||[],o=n.findIndex(l=>l.id===t);if(o===-1)return!1;const c=[...n];c[o]={...c[o],name:r},s().updateHero(i.id,{mounts:c});try{ge.emit({type:"item",title:"Montaria Renomeada",message:`Agora: ${r}`,duration:3e3,icon:"âœï¸"})}catch{}return!0},buyMountOffer:(t,r,i,n)=>{var m,u;const o=s().heroes.find(p=>p.id===t);if(!o)return!1;let c=o.progression.gold||0,l=n;try{(m=Ua().seasonPassActive)!=null&&m.active&&(l=Math.ceil(n*.9))}catch{}if(c<l||!s().generateMountForSelected(r,i))return!1;s().updateHero(t,{progression:{...o.progression,gold:Math.max(0,c-l)}});try{ge.emit({type:"item",title:"Compra de Montaria",message:`Oferta adquirida (${r}, ${i}).`,duration:3500,icon:"ğŸ‡"})}catch{}try{(u=je.custom)==null||u.call(je,"mount_offer_bought",{heroId:t,type:r,rarity:i,price:l})}catch{}return!0},importMountsForSelected:t=>{var g;const r=s().getSelectedHero();if(!r)return!1;let i=[];try{const v=JSON.parse(t);if(Array.isArray(v))i=v;else return!1}catch{return!1}const n=r.stableCapacity||50,o=Math.max(0,n-(((g=r.mounts)==null?void 0:g.length)||0));if(o<=0)return!1;const c=i.slice(0,o),l=["cavalo","lobo","grifo","javali","lagarto","draconiano","urso","felino","cervo","alce","hipogrifo","rinoceronte","wyvern"],d=["comum","incomum","raro","epico","lendario","mistico"],m=new Date().toISOString(),u=c.map(v=>({id:la(),name:String(v.name||"Montaria"),type:l.includes(String(v.type))?v.type:"cavalo",rarity:d.includes(String(v.rarity))?v.rarity:"comum",stage:["comum","encantada","lendaria"].includes(String(v.stage))?v.stage:"comum",speedBonus:Math.max(0,Number(v.speedBonus||0)),attributes:typeof v.attributes=="object"?v.attributes:{},refineLevel:Math.max(0,Number(v.refineLevel||0)),mastery:Math.max(0,Number(v.mastery||0)),history:[{ts:m,action:"obtain",details:"import"}],createdAt:m})),p=[...r.mounts||[],...u];s().updateHero(r.id,{mounts:p});try{ge.emit({type:"item",title:"Montarias Importadas",message:`Importadas ${u.length} montarias.`,duration:3500,icon:"ğŸ‡"})}catch{}return!0},releaseCommonMounts:()=>{const t=s().getSelectedHero();if(!t)return!1;const r=new Set(t.favoriteMountIds||[]),i=(t.mounts||[]).filter(o=>!(o.rarity==="comum"&&o.id!==t.activeMountId&&!r.has(o.id)&&!o.locked));if(i.length===(t.mounts||[]).length)return!1;const n={mounts:i};t.activeMountId&&!i.some(o=>o.id===t.activeMountId)&&(n.activeMountId=void 0),s().updateHero(t.id,n);try{ge.emit({type:"item",title:"Montarias Comuns Liberadas",message:"Liberadas montarias comuns nÃ£o favoritas.",duration:3500,icon:"ğŸ‡"})}catch{}return!0},upgradeStableForSelected:(t=500,r=10,i=100)=>{var u,p;const n=s().getSelectedHero();if(!n)return!1;const o=n.stableCapacity||50;if(o>=i)return!1;let c=n.progression.gold||0,l=r,d=t;try{(u=Ua().seasonPassActive)!=null&&u.active&&(d=Math.ceil(t*.8),l=r+5)}catch{}if(c<d)return!1;const m=Math.min(i,o+l);s().updateHero(n.id,{stableCapacity:m,progression:{...n.progression,gold:Math.max(0,c-d)}});try{ge.emit({type:"item",title:"EstÃ¡bulo Expandido",message:`Capacidade aumentada para ${m}.`,duration:3500,icon:"ğŸ›ï¸"})}catch{}try{(p=je.custom)==null||p.call(je,"stable_upgraded",{heroId:n.id,newCapacity:m})}catch{}return!0},trainMountForSelected:async(t=150,r=1,i=30)=>{var y;const n=s().getSelectedHero();if(!n)return!1;try{const w=await $s(n.id,"TRAIN");if(!w.ok){try{ge.emit({type:"stamina",title:"Fadiga alta",message:`Treino requer ${w.cost} âš¡. Descanse para reduzir fadiga.`,duration:2500,icon:"ğŸ’¤"})}catch{}return a({staminaModal:{required:w.cost,actionType:"TRAIN"}}),!1}const k=await _s(n.id,"TRAIN",{}),E=n.stamina||{current:100,max:100};s().updateHero(n.id,{stamina:{...E,current:k.newStamina}})}catch{}let o=n.progression.gold||0,c=i,l=t;try{(y=Ua().seasonPassActive)!=null&&y.active&&(l=Math.ceil(t*.7),c=Math.ceil(i*1.5))}catch{}if(o<l)return!1;const d=new Date(Date.now()+c*60*1e3).toISOString(),m={speedBonus:Math.max(0,r),expiresAt:d};let u=n.mounts||[];const p=u.findIndex(w=>w.id===n.activeMountId);if(p>=0){const w=u[p],k=Math.max(0,(w.mastery||0)+1),E=k>=30?3:k>=20?2:k>=10?1:0,h=Math.max(0,w.rewardTier||0);let b={...n.inventory.items};if(E>h){E===1&&(b["pergaminho-montaria"]=(b["pergaminho-montaria"]||0)+1),E===2&&(b["pedra-magica"]=(b["pedra-magica"]||0)+1),E===3&&(b["essencia-bestial"]=(b["essencia-bestial"]||0)+1),n.inventory={...n.inventory,items:b};try{ge.emit({type:"item",title:"Marco de Maestria",message:`Recompensa recebida: ${E===1?"ğŸ“œ Pergaminho":E===2?"ğŸ”· Pedra MÃ¡gica":"ğŸ§¬ EssÃªncia Bestial"}.`,duration:4e3,icon:"ğŸ–ï¸"})}catch{}}u=[...u],u[p]={...w,mastery:k,rewardTier:Math.max(h,E)}}const g=Ct({...n,mounts:u}),v=ht(n.attributes,n.class,n.progression.level,n.inventory,n.activeTitle,g);s().updateHero(n.id,{mountBuff:m,mounts:u,derivedAttributes:v,progression:{...n.progression,gold:Math.max(0,o-l)}});try{ge.emit({type:"item",title:"Treino de Montaria",message:`Velocidade +${r} por ${c} min. Maestria +1.`,duration:3500,icon:"ğŸ‡"})}catch{}try{s().updateDailyGoalProgress(n.id,"mount-trained",1)}catch{}return!0},removeMountForSelected:t=>{const r=s().getSelectedHero();if(!r)return!1;const i=r.mounts||[];if(!i.some(l=>l.id===t))return!1;const n=i.find(l=>l.id===t);if(n!=null&&n.locked){try{ge.emit({type:"item",title:"Montaria Travada",message:"Destrave para poder liberar.",duration:3e3,icon:"ğŸ”’"})}catch{}return!1}try{const l=i.findIndex(d=>d.id===t);if(l>=0){const d=i[l],m=[{ts:new Date().toISOString(),action:"release",details:""},...d.history||[]].slice(0,50),u=[...i];u[l]={...d,history:m},r.mounts=u}}catch{}const c={mounts:i.filter(l=>l.id!==t)};r.activeMountId===t&&(c.activeMountId=void 0),r.favoriteMountId===t&&(c.favoriteMountId=void 0),s().updateHero(r.id,c);try{ge.emit({type:"item",title:"Montaria Liberada",message:"A montaria foi removida do seu estÃ¡bulo.",duration:3e3,icon:"ğŸ‡"})}catch{}return!0},addMountToSelected:t=>{const r=s().getSelectedHero();if(!r)return!1;const i=[...r.mounts||[],t];return s().updateHero(r.id,{mounts:i}),!0},evolveMountForSelected:t=>{var f,j;const r=s().getSelectedHero();if(!r)return!1;const i=r.mounts||[],n=i.findIndex(N=>N.id===t);if(n===-1)return!1;const o=i[n];let c;if(o.stage==="comum")c="encantada";else if(o.stage==="encantada")c="lendaria";else{try{ge.emit({type:"item",title:"EstÃ¡gio MÃ¡ximo",message:"Esta montaria jÃ¡ Ã© LendÃ¡ria.",duration:3500,icon:"âš ï¸"})}catch{}return!1}const l=(r.inventory.items["pergaminho-montaria"]||0)>0,d=c==="lendaria",m=(r.inventory.items["essencia-bestial"]||0)>0,u=o.stage==="comum"?200:700;if(!l){try{ge.emit({type:"item",title:"Pergaminho insuficiente",message:"Falta ğŸ“œ Pergaminho de Montaria para evoluir.",duration:3500,icon:"ğŸ“œ"})}catch{}return!1}if((r.progression.gold||0)<u){try{ge.emit({type:"gold",title:"Ouro insuficiente",message:`EvoluÃ§Ã£o requer ${u} ouro.`,duration:3500})}catch{}return!1}if(d&&!m){try{ge.emit({type:"item",title:"EssÃªncia necessÃ¡ria",message:"Para LendÃ¡ria, vocÃª precisa de ğŸ§¬ EssÃªncia Bestial.",duration:4e3,icon:"ğŸ§¬"})}catch{}return!1}const p=(o.speedBonus||0)+(c==="encantada"?1:2),g=(()=>c==="encantada"?(()=>{switch(o.type){case"lobo":case"urso":case"rinoceronte":case"javali":return{forca:1};case"grifo":case"hipogrifo":case"felino":case"cervo":case"alce":case"lagarto":case"wyvern":case"cavalo":return{destreza:1};case"draconiano":return{inteligencia:1};default:return{destreza:1}}})():(()=>{switch(o.type){case"grifo":case"hipogrifo":case"felino":case"wyvern":case"cavalo":case"lagarto":case"cervo":case"alce":return{destreza:2};case"lobo":case"urso":case"rinoceronte":case"javali":return{forca:2};case"draconiano":return{inteligencia:2};default:return{forca:2}}})())(),v={...o.attributes||{}};Object.entries(g).forEach(([N,T])=>{v[N]=(v[N]||0)+T});const y=[{ts:new Date().toISOString(),action:"evolve",details:`â†’ ${c}`},...o.history||[]].slice(0,50),w={...o,stage:c,speedBonus:p,attributes:v,history:y},k=[...i];k[n]=w;const E={...r.inventory.items};E["pergaminho-montaria"]=(E["pergaminho-montaria"]||1)-1,E["pergaminho-montaria"]<=0&&delete E["pergaminho-montaria"],d&&(E["essencia-bestial"]=(E["essencia-bestial"]||1)-1,E["essencia-bestial"]<=0&&delete E["essencia-bestial"]);const h=Ct({...r,mounts:k}),b=ht(r.attributes,r.class,r.progression.level,r.inventory,r.activeTitle,h);s().updateHero(r.id,{mounts:k,inventory:{...r.inventory,items:E},progression:{...r.progression,gold:Math.max(0,(r.progression.gold||0)-u)},derivedAttributes:b});try{if(localStorage.getItem("auto_activate_recommended_mount")==="1"){const T={comum:0,encantada:1,lendaria:2},F={comum:0,incomum:1,raro:2,epico:3,lendario:4,mistico:5},te=$=>{const X=Object.values($.attributes||{}).reduce((Q,Y)=>Q+(typeof Y=="number"?Y:0),0);return($.speedBonus||0)*3+X+(T[$.stage]||0)*2+(F[$.rarity]||0)},D=(f=k.slice().sort(($,X)=>te(X)-te($))[0])==null?void 0:f.id;if(D){const $=Ct({...r,activeMountId:D,mounts:k}),X=ht(r.attributes,r.class,r.progression.level,r.inventory,r.activeTitle,$);s().updateHero(r.id,{activeMountId:D,derivedAttributes:X}),ge.emit({type:"item",title:"Recomendada ativada",message:"Auto ativaÃ§Ã£o da melhor montaria.",duration:3e3,icon:"â­"})}}}catch{}try{ge.emit({type:"item",title:"Montaria EvoluÃ­da",message:`${o.name} agora Ã© ${c}. Velocidade +${p-(o.speedBonus||0)}.`,duration:4e3,icon:"âœ¨"})}catch{}try{s().updateDailyGoalProgress(r.id,"mount-evolved",1)}catch{}try{(j=je.custom)==null||j.call(je,"mount_evolved",{heroId:r.id,mountId:t,stage:c})}catch{}return!0},refineCompanion:(t,r,i)=>{var v;const n=s().heroes.find(y=>y.id===t);if(!n)return!1;const o=n.inventory.items["pedra-magica"]||0,c=n.inventory.items["essencia-vinculo"]||0;if(o+c<=0){try{ge.emit({type:"item",title:"Materiais insuficientes",message:"VocÃª precisa de Pedra MÃ¡gica ou EssÃªncia de VÃ­nculo.",duration:3500,icon:"ğŸ”·"})}catch{}return!1}const d=y=>{const w=Math.min(10,y+1),k=w<=3?1:w<=6?.75:.45;return Math.random()<=k?w:y};let m=!1;if(r==="pet"){const y=n.pets||[],w=y.findIndex(h=>h.id===i);if(w===-1)return!1;const k=y[w],E=d(k.refineLevel||0);if(E!==(k.refineLevel||0)){const h=[...y];h[w]={...k,refineLevel:E},n.pets=h,m=!0}}else{const y=n.mounts||[],w=y.findIndex(h=>h.id===i);if(w===-1)return!1;const k=y[w],E=d(k.refineLevel||0);if(E!==(k.refineLevel||0)){const h=[...y],b=[{ts:new Date().toISOString(),action:"refine",details:`â†’ ${E}`},...k.history||[]].slice(0,50);h[w]={...k,refineLevel:E,history:b},n.mounts=h,m=!0}}if(!m){try{ge.emit({type:"item",title:"Refino falhou",message:"A tentativa de refino nÃ£o teve efeito desta vez.",duration:3e3,icon:"âš ï¸"})}catch{}return!1}const u={...n.inventory.items};o>0?(u["pedra-magica"]=o-1,u["pedra-magica"]<=0&&delete u["pedra-magica"]):c>0&&(u["essencia-vinculo"]=c-1,u["essencia-vinculo"]<=0&&delete u["essencia-vinculo"]);const p=Ct(n),g=ht(n.attributes,n.class,n.progression.level,n.inventory,n.activeTitle,p);s().updateHero(n.id,{inventory:{...n.inventory,items:u},derivedAttributes:g});try{ge.emit({type:"item",title:r==="mount"?"Montaria Refinada":"Mascote Refinado",message:"BÃ´nus do companheiro aumentados em +1% por nÃ­vel de refino.",duration:3500,icon:r==="mount"?"ğŸ‡":"ğŸ¾"})}catch{}try{r==="mount"&&s().updateDailyGoalProgress(n.id,"mount-refined",1)}catch{}try{r==="mount"&&((v=je.custom)==null||v.call(je,"mount_refined",{heroId:n.id,mountId:i}))}catch{}return!0},refinePetForSelected:t=>{const r=s().getSelectedHero();return r?s().refineCompanion(r.id,"pet",t):!1},refineMountForSelected:t=>{const r=s().getSelectedHero();return r?s().refineCompanion(r.id,"mount",t):!1},suggestCompanionQuestForSelected:()=>{var d;const t=s().getSelectedHero();if(!t)return!1;const r=t.inventory.items||{},i=[],n=(t.mounts||[]).find(m=>m.id===t.activeMountId);n&&(n.stage==="comum"&&(r["pergaminho-montaria"]||0)<1&&i.push("pergaminho-montaria"),n.stage==="encantada"&&((r["pergaminho-montaria"]||0)<1&&i.push("pergaminho-montaria"),(r["essencia-bestial"]||0)<1&&i.push("essencia-bestial")));const o=(t.pets||[]).find(m=>m.id===t.activePetId);if(o&&(o.refineLevel||0)<10&&(r["pedra-magica"]||0)<1&&(r["essencia-vinculo"]||0)<1&&i.push("pedra-magica"),i.length===0)return!1;const c=i[0],l={id:`companion-${c}-${Date.now()}`,title:c==="essencia-bestial"?"Encontrar a EssÃªncia Bestial":c==="pergaminho-montaria"?"Conseguir Pergaminho de Montaria":"Refinar VÃ­nculo do Mascote",description:c==="essencia-bestial"?"Explore ruÃ­nas ou derrote um boss para coletar a EssÃªncia Bestial.":c==="pergaminho-montaria"?"Complete tarefas da guilda para obter um Pergaminho de Montaria.":"Participe de treinos e rituais para fortalecer o vÃ­nculo com seu mascote.",type:c==="essencia-bestial"?"exploracao":"caca",difficulty:"padrao",levelRequirement:Math.max(1,t.progression.level),rewards:{gold:50,xp:40,items:[{id:c,qty:1}]},repeatable:!1,isGuildQuest:!0,sticky:!0};a(m=>({availableQuests:[l,...m.availableQuests]}));try{const m=((d=t.stats)==null?void 0:d.suggestedCompanionMissions)||0;s().updateHero(t.id,{stats:{...t.stats,suggestedCompanionMissions:m+1}})}catch{}try{localStorage.getItem("auto_accept_companion_mission")==="1"&&s().acceptQuest(t.id,l.id)}catch{}return!0},createReferralInvite:t=>{var u;const i=s().heroes.find(p=>p.id===t);if(!i)return null;const n=la().slice(0,8),o=Math.max(1,ft().inviteLinkValidityDays||7),c=new Date(Date.now()+o*24*3600*1e3).toISOString(),l=String(i.name||"heroi"),d=`${l.toLowerCase().replace(/[^a-z0-9]+/g,"-")}-${n}`,m={id:la(),code:n,inviterHeroId:t,createdAt:new Date().toISOString(),status:"pending",rewardGranted:!1,expiresAt:c,inviterTag:l,personalizedSlug:d,activity:[{ts:new Date().toISOString(),action:"created"}]};return a(p=>({referralInvites:[...p.referralInvites||[],m]})),(u=je.custom)==null||u.call(je,"referral_created",{inviterHeroId:t,code:n}),m},getReferralInvitesForHero:t=>(s().referralInvites||[]).filter(i=>i.inviterHeroId===t),acceptReferralInvite:(t,r)=>{var p;const i=s(),n=(i.referralInvites||[]).findIndex(g=>g.code===t&&g.status==="pending");if(n===-1)return!1;const o=i.referralInvites[n];if(o.expiresAt&&new Date(o.expiresAt).getTime()<Date.now()){const g={...o,status:"expired",activity:[...o.activity||[],{ts:new Date().toISOString(),action:"expired"}]};return a(v=>({referralInvites:v.referralInvites.map((y,w)=>w===n?g:y)})),!1}const c=i.heroes.find(g=>g.id===o.inviterHeroId),l=i.heroes.find(g=>g.id===r);if(!c||!l)return!1;const d={...o,status:"accepted",acceptedHeroId:r,acceptedAt:new Date().toISOString()};a(g=>({referralInvites:g.referralInvites.map((v,y)=>y===n?{...d,activity:[...d.activity||o.activity||[],{ts:new Date().toISOString(),action:"accepted",details:r}]}:v)}));const m=Math.max(0,ft().inviteRewardGold||0),u=Math.max(0,ft().inviteRewardXP||0);s().gainGold(c.id,m),s().gainXP(c.id,u);try{const g=(s().getReferralInvitesForHero(c.id)||[]).filter(v=>v.status==="accepted").length;(g===1||g===5||g===10)&&(ge.emit({type:"achievement",title:"Convite bem-sucedido!",message:`Marcos atingidos: ${g} aceites`,icon:"ğŸ‰",duration:4e3}),g===5&&s().gainGold(c.id,Math.floor(m*2)),g===10&&s().gainXP(c.id,Math.floor(u*2)))}catch{}return a(g=>({referralInvites:g.referralInvites.map(v=>v.id===d.id?{...v,rewardGranted:!0}:v)})),(p=je.custom)==null||p.call(je,"referral_accepted",{inviterHeroId:c.id,newHeroId:r,code:t,bonusGold:m,bonusXP:u}),!0},revokeReferralInvite:t=>{const r=s(),i=(r.referralInvites||[]).findIndex(c=>c.id===t&&c.status==="pending");if(i===-1)return!1;const n=r.referralInvites[i],o={...n,status:"expired",activity:[...n.activity||[],{ts:new Date().toISOString(),action:"revoked"}]};return a(c=>({referralInvites:c.referralInvites.map((l,d)=>d===i?o:l)})),!0},expireOldInvites:()=>{const t=s(),r=Date.now(),i=(t.referralInvites||[]).map(n=>n.status!=="pending"?n:n.expiresAt&&new Date(n.expiresAt).getTime()<r?{...n,status:"expired",activity:[...n.activity||[],{ts:new Date().toISOString(),action:"expired"}]}:n);a({referralInvites:i})},getReferralStatsForHero:t=>{const r=s().getReferralInvitesForHero(t),i=r.length,n=r.filter(d=>d.status==="pending").length,o=r.filter(d=>d.status==="accepted").length,c=r.filter(d=>d.status==="expired").length,l=r.filter(d=>d.rewardGranted).length;return{total:i,pending:n,accepted:o,expired:c,rewardsGranted:l}},logReferralActivity:(t,r,i)=>{a(n=>({referralInvites:(n.referralInvites||[]).map(o=>o.id===t?{...o,activity:[...o.activity||[],{ts:new Date().toISOString(),action:r,details:i}]}:o)}))},updateReferralInvite:(t,r)=>{let i=!1;return a(n=>({referralInvites:(n.referralInvites||[]).map(o=>o.id!==t?o:(i=!0,{...o,...r}))})),i},renewReferralInvite:(t,r=Math.max(1,ft().inviteLinkValidityDays||7))=>{const i=s().referralInvites.find(c=>c.id===t);if(!i)return!1;const n=i.expiresAt?new Date(i.expiresAt).getTime():Date.now(),o=new Date(n+r*24*3600*1e3).toISOString();return a(c=>({referralInvites:(c.referralInvites||[]).map(l=>l.id===t?{...l,expiresAt:o,status:l.status==="expired"?"pending":l.status,activity:[...l.activity||[],{ts:new Date().toISOString(),action:"renewed"}]}:l)})),!0},getReferralInviteByCode:t=>(s().referralInvites||[]).find(i=>i.code===t),updateHero:(t,r)=>{a(i=>({heroes:i.heroes.map(n=>{var p,g;if(n.id!==t)return n;const o=new Date().toISOString(),c={...n,...r,updatedAt:o};if(r.stats&&(c.stats={...n.stats,...r.stats}),r.stamina&&(c.stamina={...n.stamina,...r.stamina}),r.progression&&(c.progression={...n.progression,...r.progression}),r.attributes||r.class||r.level||r.inventory||r.activeTitle!==void 0||r.activePetId!==void 0||r.activeMountId!==void 0||r.pets||r.mounts){const v=r.attributes?{...n.attributes,...r.attributes}:n.attributes,y=r.class||n.class,w=r.level||n.progression.level,k=r.inventory||n.inventory,E=r.activeTitle!==void 0?r.activeTitle:n.activeTitle,h=Ct({...n,...r});c.derivedAttributes=ht(v,y,w,k,E,h)}const l=Array.isArray(n.completedQuests)?n.completedQuests.length:0,d=Array.isArray(c.completedQuests)?c.completedQuests.length:l,m=((p=n.stats)==null?void 0:p.questsCompleted)||0,u=((g=c.stats)==null?void 0:g.questsCompleted)??m;if(d<l||u<m){try{je.featureUsed(t,`mission-reset-detected:${m}->${u}`)}catch{}try{console.warn("mission reset detected",{heroId:t,beforeMissions:m,afterMissions:u,beforeCompleted:l,afterCompleted:d,ts:o})}catch{}}return c})}))},exportHeroJson:t=>{const r=s().heroes.find(i=>i.id===t);if(!r)return"";try{return JSON.stringify(r,null,2)}catch{return""}},importHero:(t,r=!0)=>{var c;if(!(t!=null&&t.id))return!1;const i=new Date().toISOString(),n=ht(t.attributes,t.class,((c=t.progression)==null?void 0:c.level)||t.level||1,t.inventory,t.activeTitle,Ct(t)),o={...t,derivedAttributes:n,updatedAt:i,createdAt:t.createdAt||i};return a(l=>{const d=l.heroes.findIndex(u=>u.id===o.id),m=[...l.heroes];return d>=0?m[d]={...m[d],...o}:m.push(o),{heroes:m,selectedHeroId:r?o.id:l.selectedHeroId}}),!0},deleteHero:t=>{a(r=>({heroes:r.heroes.filter(i=>i.id!==t),selectedHeroId:r.selectedHeroId===t?null:r.selectedHeroId}))},selectHero:t=>{const r=s().heroes.find(i=>i.id===t);!r||r.origin==="npc"||a({selectedHeroId:t})},setDMOverrideLine:t=>{a({dmOverrideLine:t})},appendJourneyNarrativeForSelected:(t,r)=>{var d;const i=s().getSelectedHero();if(!i)return!1;const n=new Date().toISOString(),o=i.journeyChapters||[],c=(o.length||0)+1,l={id:`custom-${i.id}-${c}-${Math.random().toString(36).slice(2)}`,index:c,title:r||`CrÃ´nica ${c}`,summary:t,createdAt:n,levelMilestone:((d=i.progression)==null?void 0:d.level)||1,locked:!1,relatedQuests:i.completedQuests||[]};return s().updateHero(i.id,{journeyChapters:[...o,l]}),!0},refreshQuests:(t=1)=>{var h;const r=s(),i=r.getSelectedHero();let n=0;const o=r.guilds.find(b=>b.name==="Foja dos Herois");if(o){const b=f=>Math.max(1,Math.floor(f/250)+1);n=o.level??b(o.guildXP),o.level!==n&&a(f=>({guilds:f.guilds.map(j=>j.id===o.id?{...j,level:n}:j)})),console.log("ğŸ° Hub da Guilda encontrado:",o.name,"NÃ­vel:",n)}console.log("ğŸ”„ Gerando missÃµes - HerÃ³i Level:",t,"Guilda Level:",n);const c=i?We.calculateRank(i):"F",l=Eo(t,n,c),d={...r.questCatalog},m=r.availableQuests.filter(b=>b.sticky).slice(0,3),u=new Set(m.map(b=>b.id)),p=new Set(r.heroes.flatMap(b=>b.activeQuests||[])),g=r.availableQuests.filter(b=>p.has(b.id));if(i){const b=We.calculateProgress(i);if(b.canPromote&&b.nextRank){const f=`guild-promotion-${Date.now()}`,j=(h=We.getRankInfo)==null?void 0:h.call(We,b.nextRank),N=j?`Desafio de PromoÃ§Ã£o: ${j.name}`:`Desafio de PromoÃ§Ã£o de Rank ${b.nextRank}`,T=j?`A guilda convoca ${i.name} para provar seu valor e ascender ao rank ${b.nextRank} - ${j.description}`:`Prove seu valor para ascender ao rank ${b.nextRank}. Complete objetivos desafiadores sob avaliaÃ§Ã£o da guilda.`,F={id:f,title:N,description:T,type:"historia",difficulty:"epica",levelRequirement:Math.max(1,i.progression.level),timeLimit:Math.floor(Math.random()*61)+120,enemies:[{type:"CampeÃ£o da Guilda",count:1,level:i.progression.level}],rewards:{gold:200,xp:150,items:[{id:"pergaminho-xp",qty:1}]},repeatable:!1,isGuildQuest:!0,sticky:!0,failurePenalty:{gold:50,reputation:-10}};l.push(F),d[F.id]=F,console.log("ğŸ° MissÃ£o de promoÃ§Ã£o de rank inserida:",N)}}m.forEach(b=>{u.has(b.id)||(l.push(b),d[b.id]=b)});const v=new Set(l.map(b=>b.id));g.forEach(b=>{v.has(b.id)||(l.push(b),d[b.id]=b)}),console.log("ğŸ“‹ MissÃµes geradas:",l.length,"total,",l.filter(b=>b.isGuildQuest).length,"de guilda");const y=l.some(b=>b.type==="caca"),w=l.some(b=>b.type==="exploracao");if(!y)for(let b=0;b<5;b++){const f=aa("padrao",t,!1);if(f.type==="caca"){l.push(f),d[f.id]=f;break}}if(!w)for(let b=0;b<5;b++){const f=aa("padrao",t,!1);if(f.type==="exploracao"){l.push(f),d[f.id]=f;break}}const k=new Set((i==null?void 0:i.completedQuests)||[]);l.forEach(b=>{d[b.id]=b});const E=l.filter(b=>!k.has(b.id));a({availableQuests:E,questCatalog:d})},acceptQuest:async(t,r)=>{console.log("ğŸ” acceptQuest chamada:",{heroId:t,questId:r});const i=s(),n=i.heroes.find(c=>c.id===t),o=i.availableQuests.find(c=>c.id===r);if(console.log("ğŸ‘¤ HerÃ³i encontrado:",n?`${n.name} (Level ${n.progression.level})`:"NÃ£o encontrado"),console.log("ğŸ“‹ MissÃ£o encontrada:",o?`${o.title} (Level ${o.levelRequirement})`:"NÃ£o encontrada"),!n||!o){console.log("âŒ HerÃ³i ou missÃ£o nÃ£o encontrados");try{ge.emit({type:"quest",title:"MissÃ£o indisponÃ­vel",message:"NÃ£o foi possÃ­vel localizar esta missÃ£o.",duration:2500,icon:"â„¹ï¸"})}catch{}return!1}if(n.progression.level<o.levelRequirement){console.log("âŒ NÃ­vel insuficiente:",n.progression.level,"<",o.levelRequirement);try{ge.emit({type:"quest",title:"NÃ­vel insuficiente",message:`Requer nÃ­vel ${o.levelRequirement}.`,duration:2500,icon:"âš ï¸"})}catch{}return!1}if(n.activeQuests.includes(r)){console.log("â„¹ï¸ MissÃ£o jÃ¡ ativa:",r);try{ge.emit({type:"quest",title:"MissÃ£o jÃ¡ ativa",message:`${o.title}`,duration:2e3,icon:"ğŸ¾"})}catch{}return!0}if((n.completedQuests||[]).includes(r)){console.log("â„¹ï¸ MissÃ£o jÃ¡ concluÃ­da anteriormente:",r);try{ge.emit({type:"quest",title:"JÃ¡ concluÃ­da",message:`${o.title}`,duration:2e3,icon:"âœ…"})}catch{}return!1}if(n.activeQuests.length>=3){console.log("âŒ MÃ¡ximo de missÃµes ativas atingido:",n.activeQuests.length);try{ge.emit({type:"quest",title:"Limite de missÃµes",message:"MÃ¡ximo de 3 missÃµes ativas.",duration:2500,icon:"â›”"})}catch{}return!1}try{const c=String(o.difficulty||"").toLowerCase(),l=c==="facil"?"MISSION_SHORT":c==="medio"||c==="padrao"?"MISSION_MEDIUM":c==="dificil"?"MISSION_LONG":"MISSION_MEDIUM",d=await $s(t,l);if(!d.ok){try{ge.emit({type:"stamina",title:"Fadiga alta",message:`Custo: ${d.cost} âš¡ â€” descanse para reduzir fadiga.`,duration:3e3,icon:"ğŸ’¤"})}catch{}return a({staminaModal:{required:d.cost,actionType:l}}),!1}const m=await _s(t,l,{questId:r}),u=n.stamina||{current:100,max:100};s().updateHero(t,{stamina:{...u,current:m.newStamina}})}catch{}console.log("âœ… Todos os requisitos atendidos, adicionando missÃ£o Ã s ativas"),s().updateHero(t,{activeQuests:[...n.activeQuests,r]}),a(c=>({questCatalog:{...c.questCatalog,[r]:o}}));try{ge.emit({type:"quest",title:"MissÃ£o aceita",message:`${o.title}`,duration:2500,icon:"âœ…"})}catch{}console.log("ğŸ‰ MissÃ£o aceita com sucesso!");try{Ve.markStepValidated("accept-quest"),Ve.saveState()}catch{}return!0},completeQuest:(t,r,i=!1)=>{var g,v,y,w,k,E,h,b;console.log("ğŸ¯ completeQuest chamada:",{heroId:t,questId:r,autoResolve:i});const n=s(),o=n.heroes.find(f=>f.id===t),c=n.availableQuests.find(f=>f.id===r);if(console.log("ğŸ‘¤ HerÃ³i encontrado:",o?`${o.name} (Level ${o.progression.level})`:"NÃ£o encontrado"),console.log("ğŸ“‹ MissÃ£o encontrada:",c?`${c.title} (Level ${c.levelRequirement})`:"NÃ£o encontrada"),console.log("ğŸ” MissÃ£o estÃ¡ ativa?",o==null?void 0:o.activeQuests.includes(r)),!o||!c)return console.log("âŒ Falha na validaÃ§Ã£o inicial"),null;let l=null;if(c.enemies&&c.enemies.length>0){const f=c.isGuildQuest||!1;if(l=i?Ki(o,c.enemies,f):Wi(o,c.enemies),!l.victory&&c.failurePenalty&&(c.failurePenalty.gold&&s().gainGold(t,-c.failurePenalty.gold),c.failurePenalty.reputation)){const j=c.isGuildQuest?"Guarda da Cidade":c.type==="exploracao"?"Exploradores":"Guarda da Cidade";n.updateReputation(j,c.failurePenalty.reputation)}}console.log("ğŸ‰ MissÃ£o completada com sucesso! Aplicando recompensas..."),console.log("ğŸ’° Recompensas:",c.rewards),console.log("âš”ï¸ Resultado do combate:",l);try{const f=o.stats||{},j=c.categoryHint==="coleta"||c.type==="exploracao",N=(f.collectionQuestsCompleted||0)+(j?1:0),T=c.isGuildQuest&&c.templateId==="guild-ovo-basico"?!0:f.stableUnlockQuestCompleted===!0;s().updateHero(t,{stats:{...o.stats,collectionQuestsCompleted:N,stableUnlockQuestCompleted:T}})}catch{}const d={...o};if(s().gainXP(t,(((g=c.rewards)==null?void 0:g.xp)||0)+((l==null?void 0:l.xpGained)||0)),s().gainGold(t,(((v=c.rewards)==null?void 0:v.gold)||0)+((l==null?void 0:l.goldGained)||0)),(y=c.rewards)!=null&&y.glory&&s().gainGlory(t,c.rewards.glory),(w=c.rewards)!=null&&w.arcaneEssence&&s().gainArcaneEssence(t,c.rewards.arcaneEssence),(k=c.rewards)!=null&&k.items&&c.rewards.items.forEach(f=>{if(typeof f=="string"){const j=f;if(j==="reward-egg-basico"){const N=Va("comum"),T=s().heroes.find(F=>F.id===t);s().updateHero(t,{eggs:[...T.eggs||[],N]});try{ge.emit({type:"item",title:"Ovo Obtido",message:"VocÃª recebeu um Ovo Comum da Guilda.",duration:3500,icon:"ğŸ¥š"})}catch{}return}s().addItemToInventory(t,j,1);try{const N=s().heroes.find(T=>T.id===t).stats;j==="essencia-bestial"?s().updateHero(t,{stats:{...N,beastEssenceCollected:(N.beastEssenceCollected||0)+1}}):j==="pergaminho-montaria"&&s().updateHero(t,{stats:{...N,mountScrollsFound:(N.mountScrollsFound||0)+1}})}catch{}}else{const j=f;if(j.id==="reward-egg-basico"){const N=j.qty??1;for(let T=0;T<N;T++){const F=Va("comum"),te=s().heroes.find(D=>D.id===t);s().updateHero(t,{eggs:[...te.eggs||[],F]})}try{ge.emit({type:"item",title:"Ovo Obtido",message:"VocÃª recebeu um Ovo Comum da Guilda.",duration:3500,icon:"ğŸ¥š"})}catch{}return}s().addItemToInventory(t,j.id,j.qty??1);try{const N=s().heroes.find(T=>T.id===t).stats;j.id==="essencia-bestial"?s().updateHero(t,{stats:{...N,beastEssenceCollected:(N.beastEssenceCollected||0)+(j.qty??1)}}):j.id==="pergaminho-montaria"&&s().updateHero(t,{stats:{...N,mountScrollsFound:(N.mountScrollsFound||0)+(j.qty??1)}})}catch{}}}),l!=null&&l.itemsGained&&l.itemsGained.forEach(f=>{s().addItemToInventory(t,f.id,1)}),l!=null&&l.petEnergyUsed&&l.petEnergyUsed>0){const f=s().heroes.find(j=>j.id===t);if(f&&f.activePetId){const j=f.pets||[],N=j.findIndex(T=>T.id===f.activePetId);if(N>=0){const T=j[N],F={...T,energy:Math.max(0,(T.energy||0)-l.petEnergyUsed)},te=[...j];te[N]=F,s().updateHero(t,{pets:te})}}}if(c.type==="caca"||c.type==="exploracao"){const f=c.difficulty==="epica"?.2:c.difficulty==="dificil"?.12:.08;if(Math.random()<f){const j=Va(),N=s().heroes.find(T=>T.id===t);s().updateHero(t,{eggs:[...N.eggs||[],j]}),console.log("ğŸ¥š Ovo misterioso obtido como recompensa de missÃ£o!")}}try{const f=c.type==="caca"?.1:c.type==="exploracao"?.06:c.type==="historia"?.03:.04,j=c.difficulty==="epica"?.05:c.difficulty==="dificil"?.03:c.difficulty==="medio"?.01:0,N=Math.max(0,Math.min(.25,f+j));if(Math.random()<N){const T=Math.random(),F=T>.98?"lendario":T>.9?"epico":T>.6?"raro":T>.35?"incomum":"comum";if((o.eggs||[]).length<30){const te=Va(F),D=[...o.eggs||[],te];s().updateHero(t,{eggs:D});try{ge.emit({type:"item",title:"Ovo Encontrado",message:`${te.name}`,duration:3e3,icon:"ğŸ¥š"})}catch{}}else try{ge.emit({type:"item",title:"InventÃ¡rio de Ovos Cheio",message:"VocÃª nÃ£o tem espaÃ§o para novos ovos.",duration:4e3})}catch{}}}catch{}if(c.isGuildQuest){const j={facil:5,medio:8,dificil:12,epica:20}[c.difficulty]??6;n.updateReputation("Guarda da Cidade",j);try{const T=((o.stats||{}).companionQuestsCompleted||0)+1;s().updateHero(t,{stats:{...o.stats,companionQuestsCompleted:T}})}catch{}}else nc(c).forEach(({factionName:j,change:N})=>n.updateReputation(j,N));const m=s().heroes.find(f=>f.id===t),u={...m.stats};if(u.missionRunState)try{delete u.missionRunState[String(r)]}catch{}s().updateHero(t,{activeQuests:m.activeQuests.filter(f=>f!==r),completedQuests:[...m.completedQuests,r],stats:{...m.stats,questsCompleted:m.stats.questsCompleted+1,totalCombats:m.stats.totalCombats+(((E=c.enemies)==null?void 0:E.length)||0),lastActiveAt:new Date().toISOString(),missionRunState:u.missionRunState}});try{cr({missionsCompleted:1})}catch{}try{gt({type:"mission_completed",heroId:t,questId:r}).catch(()=>{})}catch{}a(f=>({availableQuests:f.availableQuests.filter(j=>j.id!==r)})),s().checkAchievements(t);const p=s().heroes.find(f=>f.id===t);if(p){if(!p.rankData){const j=We.initializeRankData(p);s().updateHero(t,{rankData:j}),p.rankData=j}const f=We.updateRankData(p,p.rankData);s().updateHero(t,{rankData:f});try{Ba.getState().evaluateUnlocks(p,d)}catch{}}s().updateDailyGoalProgress(t,"quest-completed",1),c.difficulty==="Ã©pica"&&s().updateDailyGoalProgress(t,"epic-quest-completed",1),c.enemies&&c.enemies.length>0&&s().updateDailyGoalProgress(t,"enemy-defeated",c.enemies.length);try{const f=o.pets||[];if(f.length>0){const j=c.type==="caca"?100:c.type==="exploracao"?60:40,N=f.map(T=>oi(T,j));s().updateHero(t,{pets:N})}}catch{}return ia.updateEventProgress(t,"quests-completed",1),c.difficulty==="epica"?gt.epicQuestCompleted({heroId:t,heroName:o.name,heroClass:o.class,questName:c.title,questDifficulty:c.difficulty,questReward:c.rewards}):gt.questCompleted({heroId:t,heroName:o.name,heroClass:o.class,questName:c.title,questDifficulty:c.difficulty,questReward:c.rewards}),je.questCompleted(t,{questName:c.title,questDifficulty:c.difficulty,questType:c.type,xpReward:((h=c.rewards)==null?void 0:h.xp)||0,goldReward:((b=c.rewards)==null?void 0:b.gold)||0}),console.log("âœ… completeQuest finalizada com sucesso!"),l},abandonQuest:(t,r)=>{try{const n=s().heroes.find(c=>c.id===t);if(!n||!n.activeQuests.includes(r))return!1;const o=n.activeQuests.filter(c=>c!==r);s().updateHero(t,{activeQuests:o});try{ge.emit({type:"quest",title:"MissÃ£o abandonada",message:`${r}`,duration:2e3,icon:"ğŸ—‘ï¸"})}catch{}return!0}catch{return!1}},getQuestById:t=>{const r=s().questCatalog[t];return r||s().availableQuests.find(i=>i.id===t)},clearActiveQuests:t=>{try{const i=s().heroes.find(n=>n.id===t);if(!i)return!1;if(!(i.activeQuests||[]).length)return!0;s().updateHero(t,{activeQuests:[]});try{ge.emit({type:"quest",title:"MissÃµes removidas",message:"Limpeza de missÃµes ativas concluÃ­da",duration:2500,icon:"ğŸ§¹"})}catch{}return!0}catch{return!1}},gainXP:(t,r)=>{var F;const i=s().heroes.find(te=>te.id===t);if(!i)return;const n=ft(),o=Math.max(0,Math.min(100,n.guildXpBuffPercent||0)),c=Ic(i)*100,l=We.calculateRank(i),d=Xr[l]||0;let m=0;const u=i.stats||{};(u.innBuffUsesRemaining||0)>0&&(u.innBuffXpPercent||0)>0&&(m+=Math.max(0,Number(u.innBuffXpPercent||0)),u.innBuffUsesRemaining=Math.max(0,Number(u.innBuffUsesRemaining||1)-1),s().updateHero(t,{stats:{...i.stats,...u}}));const p=Math.floor(r*(1+(o+c+d+m)/100)),g=Math.max(0,i.progression.xp+p),v=li(g,i.progression.level),y=i.progression.level,w=Math.max(0,v-y),k=i.progression.stars||0,h=[{level:2,id:"aprendiz"},{level:5,id:"veterano"},{level:10,id:"campeao"}].filter(te=>y<te.level&&v>=te.level),b=h.length>0?h[h.length-1].id:void 0,f={...i.progression,xp:g,level:v,stars:k+w,titles:i.progression.titles||[]};let j=i.titles?[...i.titles]:[];if(b){if(!j.some(D=>D.id===b)){const D=It.find(X=>X.id===b),$=D?{...D,unlockedAt:new Date}:{id:b,name:b==="aprendiz"?"Aprendiz":b==="veterano"?"Veterano":"CampeÃ£o",description:"Recompensa por subir de nÃ­vel",rarity:"comum",category:"achievement",badge:b==="aprendiz"?"â­":b==="veterano"?"ğŸŒŸ":"ğŸ†",unlockedAt:new Date};j=[...j,$]}(f.titles||[]).includes(b)||(f.titles=[...f.titles||[],b])}const N={progression:f,titles:j};if(v>i.progression.level){N.level=v,b&&(N.activeTitle=b),N.attributePoints=(i.attributePoints||0)+w*rl,N.derivedAttributes=ht(i.attributes,i.class,v,i.inventory,b||i.activeTitle,Ct(i));const te=Dc(i.class,i.progression.level,v);if(te.length){const Q=[...i.skills||[]];te.forEach(G=>{Q.find(J=>J.id===G.id)||Q.push(G)}),N.skills=Q;const Y=i.plannedTalents||[];if(Y.length){te.map(J=>J.id);const G=Y.filter(J=>Q.find(re=>re.id===J)).length;N.stats={...i.stats,talentsUnlockedPlanned:G}}}const $=[4,8,12,16,20].filter(X=>y<X&&v>=X);if($.length>0){const X=new Date().toISOString(),Q=i.journeyChapters||[];let Y=[];if($.forEach(G=>{if(!Q.some(re=>re.levelMilestone===G)){const re=Q.length+Y.length+1,ee=(i.completedQuests||[]).map(_=>{var P;return(P=s().availableQuests.find(M=>M.id===_))==null?void 0:P.title}).filter(Boolean),fe=`No marco de nÃ­vel ${G}, ${i.name} consolidou sua jornada como ${i.class}. Conquistas recentes incluem: ${ee.slice(-3).join("; ")||"missÃµes iniciais da guilda"}. Combates: ${i.stats.totalCombats||0}, inimigos derrotados: ${i.stats.enemiesDefeated||0}, itens obtidos: ${i.stats.itemsFound||0}.`;Y.push({id:`chapter-${i.id}-${G}`,index:re,title:`CapÃ­tulo ${re}: Marco de NÃ­vel ${G}`,summary:fe,createdAt:X,levelMilestone:G,locked:!0,relatedQuests:i.completedQuests||[]})}}),Y.length>0){N.journeyChapters=[...Q,...Y];try{if((F=Ua().seasonPassActive)!=null&&F.active){const J=new Date().toISOString(),re={id:`season-${i.id}-${v}`,index:(N.journeyChapters.length||0)+1,title:"CrÃ´nica da Temporada",summary:"Um arco narrativo exclusivo da temporada foi revelado.",createdAt:J,levelMilestone:v,locked:!1,relatedQuests:i.completedQuests||[]};N.journeyChapters=[...N.journeyChapters,re]}}catch{}try{const G=Ua();G.adsEnabled&&!G.adsRemoved&&G.interstitialOnChapterMilestones&&G.triggerInterstitial("chapter")}catch{}}}}s().updateHero(t,N);const T=s().heroes.find(te=>te.id===t);if(T){if(!T.rankData){const Q=We.initializeRankData(T);s().updateHero(t,{rankData:Q}),T.rankData=Q}const te=T.rankData,D=te.currentRank,$=new Set((te.unlockedRewards||[]).map(Q=>Q.name)),X=We.updateRankData(T,te);if(s().updateHero(t,{rankData:X}),X.currentRank!==D){const Q=(X.unlockedRewards||[]).filter(re=>!$.has(re.name));let Y=T.inventory||{items:{}},G=T.stats||{};const J=(re,ee,fe,_="comum",P,M)=>{var A;const C={id:re,name:ee,description:P||ee,type:"cosmetic",rarity:_,icon:M||"ğŸ",slot:fe};Y.customItems={...Y.customItems||{},[re]:C},Y.items={...Y.items||{},[re]:Math.max(0,((A=Y.items)==null?void 0:A[re])||0)+1},fe==="cape"&&(Y.equippedCape=Y.equippedCape||re),fe==="chest"&&(Y.equippedChest=Y.equippedChest||re),fe==="helm"&&(Y.equippedHelm=Y.equippedHelm||re)};Q.forEach(re=>{var fe;const ee=re.name.toLowerCase();if(ee==="capa verde"&&J("capa-verde","Capa Verde","cape","comum","Capa do rank E","ğŸ§¥"),ee==="armadura roxa"&&J("armadura-roxa","Armadura Roxa","chest","raro","Armadura do rank C","âš”ï¸"),ee==="capa de campeÃ£o"&&J("capa-campeao","Capa de CampeÃ£o","cape","raro","Capa do rank A","ğŸ­"),(ee==="traje Ã­cone imortal"||ee==="traje icone imortal")&&J("traje-icone-imortal","Traje Ãcone Imortal","chest","Ã©pico","Traje do rank SS","ğŸ‘—"),ee==="coroa do mito absoluto"&&J("coroa-mito-absoluto","Coroa do Mito Absoluto","helm","lendÃ¡rio","Coroa do rank SSS","ğŸ‘‘"),ee.includes("xp bonus")){const _=Xr[X.currentRank]||0;G.rankXpBonusPercent=_}if(ee.includes("gold bonus")){const _=Number(((fe=ee.match(/\+?(\d+)%/))==null?void 0:fe[1])||10);G.rankGoldBonusPercent=Math.max(Number(G.rankGoldBonusPercent||0),_)}if(ee==="tÃ­tulo de guardiÃ£o"||ee==="titulo de guardiao"){const _=T.progression.titles||[],P="guardiao";_.includes(P)||s().updateHero(t,{progression:{...T.progression,titles:[..._,P]}})}if(ee==="efeito lendÃ¡rio"){const _=Array.isArray(G.rankVisualAuras)?G.rankVisualAuras:[];G.rankVisualAuras=Array.from(new Set([..._,"legendary"]))}if(ee==="aura dourada"){const _=Array.isArray(G.rankVisualAuras)?G.rankVisualAuras:[];G.rankVisualAuras=Array.from(new Set([..._,"gold"]))}if(ee==="aura mÃ­tica"){const _=Array.isArray(G.rankVisualAuras)?G.rankVisualAuras:[];G.rankVisualAuras=Array.from(new Set([..._,"mythic"]))}(ee==="missÃµes especiais"||ee==="missoes especiais")&&(G.rankAccessSpecialMissions=!0),ee==="acesso total"&&(G.rankAccessTotal=!0),(ee==="convite para missÃµes mÃ­ticas"||ee==="convite para missoes miticas")&&(G.rankAccessMythicMissions=!0),(ee==="histÃ³ria Ã©pica ia"||ee==="historia epica ia"||ee==="lenda personalizada")&&(G.rankLegendUnlocked=!0)}),s().updateHero(t,{inventory:Y,stats:G});try{ge.emit({type:"achievement",title:"Recompensas de Rank aplicadas",message:`Itens e bÃ´nus liberados para rank ${X.currentRank}`,duration:3e3,icon:"ğŸ"})}catch{}}try{Ba.getState().evaluateUnlocks(T,i)}catch{}}s().updateDailyGoalProgress(t,"xp-gained",p),v>i.progression.level&&s().updateDailyGoalProgress(t,"level-up",1),ia.updateEventProgress(t,"xp-gained",p),v>i.progression.level&&(ia.updateEventProgress(t,"levels-gained",v-i.progression.level),gt.levelUp({heroId:t,heroName:i.name,heroClass:i.class,heroLevel:v,previousLevel:i.progression.level}),je.levelUp(t,{newLevel:v,previousLevel:i.progression.level,heroClass:i.class})),je.xpGained(t,p)},gainGold:(t,r)=>{var l;const i=s().heroes.find(d=>d.id===t);if(!i)return;const n=Number(((l=i.stats)==null?void 0:l.rankGoldBonusPercent)||0),o=Math.floor(r*(1+n/100));s().updateHero(t,{progression:{...i.progression,gold:Math.max(0,i.progression.gold+o)}});const c=s().heroes.find(d=>d.id===t);if(c){if(!c.rankData){const m=We.initializeRankData(c);s().updateHero(t,{rankData:m}),c.rankData=m}const d=We.updateRankData(c,c.rankData);s().updateHero(t,{rankData:d})}o>0&&s().updateDailyGoalProgress(t,"gold-earned",o),o>0&&ia.updateEventProgress(t,"gold-earned",o),o>0&&je.goldGained(t,o)},gainGlory:(t,r)=>{const i=s().heroes.find(n=>n.id===t);if(i&&(s().updateHero(t,{progression:{...i.progression,glory:Math.max(0,(i.progression.glory||0)+r)}}),r>0))try{ia.updateEventProgress(t,"glory-earned",r)}catch{}},gainArcaneEssence:(t,r)=>{const i=s().heroes.find(n=>n.id===t);if(i&&(s().updateHero(t,{progression:{...i.progression,arcaneEssence:Math.max(0,(i.progression.arcaneEssence||0)+r)}}),r>0))try{ia.updateEventProgress(t,"arcane-essence-earned",r)}catch{}},addItemToInventory:(t,r,i=1)=>{const n=s().heroes.find(c=>c.id===t);if(!n)return;const o=n.inventory.items[r]||0;s().updateHero(t,{inventory:{...n.inventory,items:{...n.inventory.items,[r]:o+i}}});try{if(r==="pergaminho-montaria"){const l=((n.stats||{}).mountScrollsFound||0)+i;s().updateHero(t,{stats:{...n.stats,mountScrollsFound:l}}),ge.emit({type:"item",title:"Pergaminho de Montaria",message:`VocÃª obteve ğŸ“œ x${i}.`,duration:3500,icon:"ğŸ“œ"})}if(r==="essencia-bestial"){const l=((n.stats||{}).beastEssenceCollected||0)+i;s().updateHero(t,{stats:{...n.stats,beastEssenceCollected:l}}),ge.emit({type:"item",title:"EssÃªncia Bestial",message:`VocÃª obteve ğŸ§¬ x${i}.`,duration:3500,icon:"ğŸ§¬"})}}catch{}},checkAchievements:t=>{const r=s().heroes.find(n=>n.id===t);if(!r)return[];const i=[];if(Oi.forEach(n=>{if(r.progression.achievements.some(l=>l.id===n.id))return;let c=0;switch(n.id){case"primeira-missao":c=r.stats.questsCompleted>=1?1:0;break;case"heroi-da-vila":c=r.stats.questsCompleted;break;case"cacador-experiente":c=Math.min(n.maxProgress,Math.floor(r.stats.questsCompleted*.4));break;case"explorador-corajoso":c=Math.min(n.maxProgress,Math.floor(r.stats.questsCompleted*.3));break;case"lenda-epica":c=Math.min(n.maxProgress,Math.floor(r.stats.questsCompleted*.1));break;case"amigo-dos-animais":c=Math.min(n.maxProgress,r.stats.companionQuestsCompleted||0);break;case"domador-de-feras":c=Math.min(n.maxProgress,r.stats.beastEssenceCollected||0);break;case"cavaleiro-mitico":c=Math.min(n.maxProgress,r.stats.mountScrollsFound||0);break}if(c>=n.maxProgress){const l={...n,unlockedAt:new Date().toISOString(),progress:n.maxProgress};i.push(l)}}),i.length>0){s().updateHero(t,{progression:{...r.progression,achievements:[...r.progression.achievements,...i]}});try{cr({achievementsUnlocked:i.length})}catch{}try{gt({type:"achievement_unlocked",heroId:t,count:i.length}).catch(()=>{})}catch{}}return i},buyItem:(t,r)=>{const i=s().heroes.find(o=>o.id===t);if(!i)return!1;const n=bs(i,r);if(n.success&&n.item){if(n.currency&&n.newBalance!==void 0){const o={...i.progression};n.currency==="gold"&&(o.gold=n.newBalance),n.currency==="glory"&&(o.glory=n.newBalance),n.currency==="arcaneEssence"&&(o.arcaneEssence=n.newBalance),s().updateHero(t,{progression:o})}else n.newGold!==void 0&&s().updateHero(t,{progression:{...i.progression,gold:n.newGold}});s().addItemToInventory(t,r,1)}return n.success},sellItem:(t,r,i=1)=>{const n=s().heroes.find(c=>c.id===t);if(!n)return!1;const o=_o(n,r,i);if(o.success){s().updateHero(t,{progression:{...n.progression,gold:o.newGold}});const c=n.inventory.items[r]||0;s().updateHero(t,{inventory:{...n.inventory,items:{...n.inventory.items,[r]:Math.max(0,c-i)}}})}return o.success},equipItem:(t,r)=>{const i=s().heroes.find(o=>o.id===t);if(!i)return!1;const n=qo(i,r);if(n.success){const o=Ee.find(d=>d.id===r);if(!o)return!1;const c={...i.inventory};if(o.type==="weapon"){if((o.slot==="offHand"?"offHand":"mainHand")==="mainHand")if(!c.equippedMainHand)c.equippedMainHand=r;else if(!c.equippedOffHand)c.equippedOffHand=r;else return!1;else if(!c.equippedOffHand)c.equippedOffHand=r;else if(!c.equippedMainHand)c.equippedMainHand=r;else return!1;c.equippedWeapon=void 0,c.equippedWeapons=[]}else if(o.type==="armor"){const d=o.slot;if(d){if(d==="helm")if(!c.equippedHelm)c.equippedHelm=r;else return!1;else if(d==="chest")if(!c.equippedChest)c.equippedChest=r;else return!1;else if(d==="belt")if(!c.equippedBelt)c.equippedBelt=r;else return!1;else if(d==="gloves")if(!c.equippedGloves)c.equippedGloves=r;else return!1;else if(d==="boots")if(!c.equippedBoots)c.equippedBoots=r;else return!1;else if(d==="cape")if(!c.equippedCape)c.equippedCape=r;else return!1}else if(!c.equippedChest)c.equippedChest=r;else return!1;c.equippedArmor=void 0,c.equippedArmorSlots=[]}else if(o.type==="accessory"){const d=o.slot;if(d){if(d==="necklace")if(!c.equippedNecklace)c.equippedNecklace=r;else return!1;else if(d==="ring")if(!c.equippedRingLeft)c.equippedRingLeft=r;else if(!c.equippedRingRight)c.equippedRingRight=r;else return!1;else if(d==="earring")if(!c.equippedEarringLeft)c.equippedEarringLeft=r;else if(!c.equippedEarringRight)c.equippedEarringRight=r;else return!1}else if(!c.equippedRingLeft)c.equippedRingLeft=r;else if(!c.equippedRingRight)c.equippedRingRight=r;else if(!c.equippedNecklace)c.equippedNecklace=r;else if(!c.equippedEarringLeft)c.equippedEarringLeft=r;else if(!c.equippedEarringRight)c.equippedEarringRight=r;else return!1;c.equippedAccessory=void 0,c.equippedAccessories=[]}const l=ht(i.attributes,i.class,i.progression.level,c,i.activeTitle,Ct(i));s().updateHero(t,{inventory:c,derivedAttributes:l});try{Ze.auth.getUser().then(({data:d})=>{var u;const m=(u=d==null?void 0:d.user)==null?void 0:u.id;m&&Bt(m,Z.getState().heroes.find(p=>p.id===i.id))})}catch{}try{const d={weapons:c.equippedWeapons||[],armor:c.equippedArmorSlots||[],accessories:c.equippedAccessories||[],updatedAt:new Date().toISOString()};localStorage.setItem(`hfn:equipmentBackup:${i.id}`,JSON.stringify(d))}catch{}}return n.success},upgradeItem:(t,r)=>{var v,y;const i=s().heroes.find(w=>w.id===t);if(!i)return!1;const n=Ee.find(w=>w.id===r);if(!n||!(n.type==="weapon"||n.type==="armor"||n.type==="accessory"))return!1;const o=((v=i.inventory.upgrades)==null?void 0:v[r])??0,c={comum:.25,raro:.4,epico:.6,lendario:.8},l=Math.ceil(n.price*c[n.rarity]*(o+1)),d=((y=i.rankData)==null?void 0:y.currentRank)??"F",u=Math.max(1,Math.ceil(l*(1-{F:0,E:.03,D:.05,C:.07,B:.1,A:.12,S:.15}[d])));if((i.progression.gold||0)<u)return!1;const p={...i.inventory,upgrades:{...i.inventory.upgrades||{}}};p.upgrades[r]=o+1;const g=ht(i.attributes,i.class,i.progression.level,p,i.activeTitle,Ct(i));return s().updateHero(t,{progression:{...i.progression,gold:Math.max(0,(i.progression.gold||0)-u)},inventory:p,derivedAttributes:g}),!0},craftItem:(t,r)=>{var p;const n=s().heroes.find(g=>g.id===t);if(!n)return!1;const o=Na.find(g=>g.id===r);if(!o)return!1;const c=["F","E","D","C","B","A","S"],l=((p=n.rankData)==null?void 0:p.currentRank)||"F",d=c.indexOf(l),m=c.indexOf(o.rankRequired||"F");if(d<m)return!1;for(const g of o.inputs)if((n.inventory.items[g.id]||0)<g.qty)return!1;const u={...n.inventory.items};return o.inputs.forEach(g=>{u[g.id]=Math.max(0,(u[g.id]||0)-g.qty)}),u[o.output.id]=(u[o.output.id]||0)+o.output.qty,s().updateHero(t,{inventory:{...n.inventory,items:u}}),!0},refineEquippedItem:(t,r)=>{var h;const i=s(),n=i.heroes.find(b=>b.id===t);if(!n)return!1;const o=n.inventory,c=(()=>r==="weapon"?o.equippedMainHand||o.equippedOffHand||o.equippedWeapon||(o.equippedWeapons||[])[0]:r==="armor"?o.equippedChest||o.equippedArmor||(o.equippedArmorSlots||[])[0]:o.equippedNecklace||o.equippedRingLeft||o.equippedRingRight||o.equippedAccessory||(o.equippedAccessories||[])[0])();if(!c)return!1;const l=Ee.find(b=>b.id===c)||(o.customItems?o.customItems[c]:void 0);if(!l)return!1;const d=((h=o.refined)==null?void 0:h[c])||l.rarity,m=["comum","incomum","raro","epico","lendario"],u=m.indexOf(d);if(u<0||u===m.length-1)return!1;const p=m[u+1],g={"comum->incomum":{gold:100,essence:10,chance:.7},"incomum->raro":{gold:200,essence:20,chance:.5},"raro->epico":{gold:400,essence:40,chance:.3},"epico->lendario":{gold:1e3,essence:100,chance:.1}},v=`${d}->${p}`,y=g[v];if(!y)return!1;const w=n.progression.gold||0,k=n.progression.arcaneEssence||0;if(w<y.gold||k<y.essence)return!1;n.progression.gold=w-y.gold,n.progression.arcaneEssence=k-y.essence;const E=Math.random()<=y.chance;if(E){const b={...o.refined||{}};b[c]=p,n.inventory.refined=b}return a({heroes:i.heroes.map(b=>b.id===t?{...n,updatedAt:new Date().toISOString()}:b)}),E},fuseItems:(t,r,i)=>{const n=s(),o=n.heroes.find(h=>h.id===t);if(!o)return!1;const c=o.inventory,l=c.items[r]||0,d=c.items[i]||0;if(l<1||d<1)return!1;const m=Ee.find(h=>h.id===r),u=Ee.find(h=>h.id===i);if(!m||!u||m.type!==u.type)return!1;c.items[r]=l-1,c.items[i]=d-1,c.items[r]<=0&&delete c.items[r],c.items[i]<=0&&delete c.items[i];const p=(r+i).split("").reduce((h,b)=>h+b.charCodeAt(0),0),g=o.derivedAttributes.luck||0,v=zo(p,g),y={espada:"ğŸ—¡ï¸",arco:"ğŸ¹",cajado:"ğŸª„",machado:"ğŸª“"},w=v.id,k={id:w,name:v.name,description:"Item forjado por fusÃ£o, Ãºnico ao herÃ³i.",type:m.type,rarity:v.rarity,level:o.progression.level,price:100,icon:y[v.baseType]||"âš’ï¸",bonus:v.bonus},E={...c.customItems||{}};return E[w]=k,o.inventory.customItems=E,o.inventory.items[w]=(o.inventory.items[w]||0)+1,a({heroes:n.heroes.map(h=>h.id===t?{...o,updatedAt:new Date().toISOString()}:h)}),!0},addJewel:(t,r,i,n=1)=>{const o=s(),c=o.heroes.find(u=>u.id===t);if(!c)return!1;const l=`jewel:${r}:${Math.max(1,Math.min(10,i))}`,m={...c.inventory.jewels||{}};return m[l]=(m[l]||0)+Math.max(1,n),c.inventory.jewels=m,a({heroes:o.heroes.map(u=>u.id===t?{...c,updatedAt:new Date().toISOString()}:u)}),!0},socketJewel:(t,r,i)=>{var h;const n=s(),o=n.heroes.find(b=>b.id===t);if(!o)return!1;const c=o.inventory;if((((h=c.jewels)==null?void 0:h[i])||0)<=0)return!1;const d=Ee.find(b=>b.id===r)||(c.customItems?c.customItems[r]:void 0);if(!d)return!1;const m=d.type==="weapon"?2:d.type==="armor"?3:d.type==="accessory"?1:0;if(m<=0)return!1;const u=i.split(":");if(u.length!==3)return!1;u[1];const p=Number(u[2]),g=Jt.minHeroLevelToEquip(p);if((o.progression.level||o.level||1)<g)return!1;const y={...c.equippedJewelsByItemId||{}},w=[...y[r]||[]];if(w.length>=m)return!1;w.push(i),y[r]=w;const k={...c.jewels||{}};k[i]=Math.max(0,(k[i]||0)-1),o.inventory.equippedJewelsByItemId=y,o.inventory.jewels=k;const E=ht(o.attributes,o.class,o.progression.level,o.inventory,o.activeTitle,Ct(o));a({heroes:n.heroes.map(b=>b.id===t?{...o,derivedAttributes:E,updatedAt:new Date().toISOString()}:b)});try{const b={jewels:o.inventory.jewels,equippedJewels:o.inventory.equippedJewelsByItemId,updatedAt:new Date().toISOString()};localStorage.setItem(`hfn:jewelState:${o.id}`,JSON.stringify(b))}catch{}try{Ze.auth.getUser().then(({data:b})=>{var j;const f=(j=b==null?void 0:b.user)==null?void 0:j.id;f&&Bt(f,Z.getState().heroes.find(N=>N.id===o.id))})}catch{}return!0},removeJewel:(t,r,i)=>{const n=s(),o=n.heroes.find(g=>g.id===t);if(!o)return!1;const c=o.inventory,l={...c.equippedJewelsByItemId||{}},d=[...l[r]||[]];if(i<0||i>=d.length)return!1;const m=d[i];d.splice(i,1),l[r]=d;const u={...c.jewels||{}};u[m]=(u[m]||0)+1,o.inventory.equippedJewelsByItemId=l,o.inventory.jewels=u;const p=ht(o.attributes,o.class,o.progression.level,o.inventory,o.activeTitle,Ct(o));a({heroes:n.heroes.map(g=>g.id===t?{...o,derivedAttributes:p,updatedAt:new Date().toISOString()}:g)});try{const g={jewels:o.inventory.jewels,equippedJewels:o.inventory.equippedJewelsByItemId,updatedAt:new Date().toISOString()};localStorage.setItem(`hfn:jewelState:${o.id}`,JSON.stringify(g))}catch{}try{Ze.auth.getUser().then(({data:g})=>{var y;const v=(y=g==null?void 0:g.user)==null?void 0:y.id;v&&Bt(v,Z.getState().heroes.find(w=>w.id===o.id))})}catch{}return!0},fuseJewels:(t,r)=>{var w;const i=s(),n=i.heroes.find(k=>k.id===t);if(!n)return!1;const o=n.inventory,c=((w=o.jewels)==null?void 0:w[r])||0;if(c<2)return!1;const l=r.split(":");if(l.length!==3)return!1;const d=l[1],m=Number(l[2]);if(m>=10)return!1;const u=new Jt(crypto.randomUUID(),d,m),p=new Jt(crypto.randomUUID(),d,m);if(!Jt.fuse(u,p))return!1;const v=`jewel:${d}:${m+1}`,y={...o.jewels||{}};y[r]=Math.max(0,c-2),y[v]=(y[v]||0)+1,n.inventory.jewels=y,a({heroes:i.heroes.map(k=>k.id===t?{...n,updatedAt:new Date().toISOString()}:k)});try{const k={ts:new Date().toISOString(),from:r,to:v},E={jewels:n.inventory.jewels,lastFusion:k,updatedAt:new Date().toISOString()};localStorage.setItem(`hfn:jewelState:${n.id}`,JSON.stringify(E))}catch{}try{Ze.auth.getUser().then(({data:k})=>{var h;const E=(h=k==null?void 0:k.user)==null?void 0:h.id;E&&Bt(E,Z.getState().heroes.find(b=>b.id===n.id))})}catch{}return!0},enchantEquippedItem:(t,r,i)=>{const n=s(),o=n.heroes.find(p=>p.id===t);if(!o)return!1;const c=o.inventory,l=(()=>r==="weapon"?c.equippedMainHand||c.equippedOffHand||c.equippedWeapon||(c.equippedWeapons||[])[0]:r==="armor"?c.equippedChest||c.equippedArmor||(c.equippedArmorSlots||[])[0]:c.equippedNecklace||c.equippedRingLeft||c.equippedRingRight||c.equippedAccessory||(c.equippedAccessories||[])[0])();if(!l)return!1;const d=50,m=o.progression.arcaneEssence||0;if(m<d)return!1;o.progression.arcaneEssence=m-d;const u={...c.enchantments||{}};return u[l]={special:i},o.inventory.enchantments=u,a({heroes:n.heroes.map(p=>p.id===t?{...o,updatedAt:new Date().toISOString()}:p)}),!0},unequipItem:(t,r)=>{const i=s().heroes.find(d=>d.id===t);if(!i)return!1;const n=Ee.find(d=>d.id===r);if(!n)return!1;const o={...i.inventory};let c=!1;if(n.type==="weapon")o.equippedMainHand===r&&(o.equippedMainHand=void 0,c=!0),o.equippedOffHand===r&&(o.equippedOffHand=void 0,c=!0),o.equippedWeapon=void 0,o.equippedWeapons=[];else if(n.type==="armor")o.equippedHelm===r&&(o.equippedHelm=void 0,c=!0),o.equippedChest===r&&(o.equippedChest=void 0,c=!0),o.equippedBelt===r&&(o.equippedBelt=void 0,c=!0),o.equippedGloves===r&&(o.equippedGloves=void 0,c=!0),o.equippedBoots===r&&(o.equippedBoots=void 0,c=!0),o.equippedCape===r&&(o.equippedCape=void 0,c=!0),o.equippedArmor=void 0,o.equippedArmorSlots=[];else if(n.type==="accessory")o.equippedRingLeft===r&&(o.equippedRingLeft=void 0,c=!0),o.equippedRingRight===r&&(o.equippedRingRight=void 0,c=!0),o.equippedNecklace===r&&(o.equippedNecklace=void 0,c=!0),o.equippedEarringLeft===r&&(o.equippedEarringLeft=void 0,c=!0),o.equippedEarringRight===r&&(o.equippedEarringRight=void 0,c=!0),o.equippedAccessory=void 0,o.equippedAccessories=[];else return!1;if(!c)return!1;const l=ht(i.attributes,i.class,i.progression.level,o,i.activeTitle,Ct(i));s().updateHero(t,{inventory:o,derivedAttributes:l});try{Ze.auth.getUser().then(({data:d})=>{var u;const m=(u=d==null?void 0:d.user)==null?void 0:u.id;m&&Bt(m,Z.getState().heroes.find(p=>p.id===i.id))})}catch{}try{const d={weapons:o.equippedWeapons||[],armor:o.equippedArmorSlots||[],accessories:o.equippedAccessories||[],updatedAt:new Date().toISOString()};localStorage.setItem(`hfn:equipmentBackup:${i.id}`,JSON.stringify(d))}catch{}return!0},useItem:(t,r)=>{const i=s().heroes.find(d=>d.id===t);if(!i)return!1;const n=i.derivedAttributes.currentHp??i.derivedAttributes.hp,o=i.derivedAttributes.currentMp??i.derivedAttributes.mp,c=i.progression.fatigue??0;if(r==="contrato-montaria"){if(!s().generateMountForSelected())return!1;const m=i.inventory.items[r]||0;return s().updateHero(t,{inventory:{...i.inventory,items:{...i.inventory.items,[r]:Math.max(0,m-1)}}}),!0}if(r==="kit-montaria"){const m={...i.inventory.items||{}};m["contrato-montaria"]=(m["contrato-montaria"]||0)+1,m["pergaminho-montaria"]=(m["pergaminho-montaria"]||0)+1,m["essencia-bestial"]=(m["essencia-bestial"]||0)+1,m["pedra-magica"]=(m["pedra-magica"]||0)+1;const u=i.inventory.items[r]||0;s().updateHero(t,{inventory:{...i.inventory,items:{...m,[r]:Math.max(0,u-1)}}});try{ge.emit({type:"item",title:"Kit de Montaria",message:"Itens adicionados: ğŸ“œ, ğŸ§¬, ğŸ”· e Contrato.",duration:3500,icon:"ğŸ"})}catch{}return!0}const l=Fo(i,r);if(l.success){const d=i.inventory.items[r]||0;if(s().updateHero(t,{inventory:{...i.inventory,items:{...i.inventory.items,[r]:Math.max(0,d-1)}}}),l.effects){const m={};l.effects.hp!==void 0&&(m.derivedAttributes={...i.derivedAttributes,currentHp:l.effects.hp}),l.effects.mp!==void 0&&(m.derivedAttributes={...m.derivedAttributes||i.derivedAttributes,currentMp:l.effects.mp}),l.effects.fatigue!==void 0&&(m.progression={...i.progression,fatigue:l.effects.fatigue}),l.effects.xp!==void 0&&s().gainXP(t,l.effects.xp),Object.keys(m).length>0&&s().updateHero(t,m);try{const u=Ee.find(h=>h.id===r),p=s().heroes.find(h=>h.id===t),g=p.derivedAttributes.currentHp??p.derivedAttributes.hp,v=p.derivedAttributes.currentMp??p.derivedAttributes.mp,y=p.progression.fatigue??0,w=Math.max(0,(g??0)-(n??0)),k=Math.max(0,(v??0)-(o??0)),E=Math.max(0,(c??0)-(y??0));gt.itemUsed({heroId:i.id,heroName:i.name,heroClass:i.class,heroLevel:i.progression.level,itemId:r,itemName:u==null?void 0:u.name,itemType:u==null?void 0:u.type,hpRecovered:w,mpRecovered:k,fatigueRecovered:E,xpGained:l.effects.xp??0})}catch{}}}return l.success},restAtTavern:(t,r,i,n)=>{const o=s().heroes.find(u=>u.id===t);if(!o)return!1;const c=o.progression.gold??0,l=o.progression.fatigue??0;if(c<r||l<=0)return!1;const d=Math.min(i,l),m={...o.progression,gold:c-r,fatigue:l-d};s().updateHero(t,{progression:m});try{gt.tavernRest({heroId:o.id,heroName:o.name,heroClass:o.class,heroLevel:o.progression.level,restType:n,goldSpent:r,fatigueBefore:l,fatigueRecovered:d,fatigueAfter:m.fatigue})}catch{}return!0},createGuild:(t,r,i)=>{const n=s().heroes.find(c=>c.id===t);if(!n||n.progression.guildId)return null;const o={id:la(),name:r,description:i,members:[t],guildXP:0,bankGold:0,createdAt:new Date().toISOString(),quests:[],level:1,roles:{[t]:"lider"},councilMembers:[],policies:{},pendingAlliances:[]};return a(c=>({guilds:[...c.guilds,o]})),s().updateHero(t,{progression:{...n.progression,guildId:o.id}}),o},joinGuild:(t,r)=>{const i=s(),n=i.heroes.find(c=>c.id===t),o=i.guilds.find(c=>c.id===r);return!n||!o||n.progression.guildId?!1:(a(c=>({guilds:c.guilds.map(l=>{var p;if(l.id!==r)return l;const d=((p=n.rankData)==null?void 0:p.currentRank)==="S",m=l.councilMembers||[],u=d&&!m.includes(t)?[...m,t]:m;return{...l,members:[...l.members,t],roles:{...l.roles||{},[t]:"membro"},councilMembers:u}})})),s().updateHero(t,{progression:{...n.progression,guildId:r}}),!0)},leaveGuild:t=>{const r=s().heroes.find(i=>i.id===t);return!r||!r.progression.guildId?!1:(a(i=>({guilds:i.guilds.map(n=>n.id===r.progression.guildId?{...n,members:n.members.filter(o=>o!==t),roles:(()=>{const o={...n.roles||{}};if(delete o[t],Object.values(o).includes("lider")===!1&&n.members.length>0){const c=n.members.find(l=>l!==t);c&&(o[c]="lider")}return o})()}:n)})),s().updateHero(t,{progression:{...r.progression,guildId:void 0}}),!0)},depositGoldToGuild:(t,r)=>{if(r<=0)return!1;const n=s().heroes.find(c=>c.id===t);if(!n||!n.progression.guildId||n.progression.gold<r)return!1;const o=n.progression.guildId;return a(c=>({guilds:c.guilds.map(l=>l.id===o?{...l,bankGold:l.bankGold+r}:l)})),s().updateHero(t,{progression:{...n.progression,gold:n.progression.gold-r}}),!0},withdrawGoldFromGuild:(t,r)=>{var l;if(r<=0)return!1;const i=s(),n=i.heroes.find(d=>d.id===t);if(!n||!n.progression.guildId)return!1;const o=i.guilds.find(d=>d.id===n.progression.guildId);return!o||(((l=o.roles)==null?void 0:l[t])||"membro")==="membro"||o.bankGold<r?!1:(a(d=>({guilds:d.guilds.map(m=>m.id===o.id?{...m,bankGold:m.bankGold-r}:m)})),s().updateHero(t,{progression:{...n.progression,gold:n.progression.gold+r}}),!0)},contributeXPToGuild:(t,r)=>{if(r<=0)return!1;const n=s().heroes.find(d=>d.id===t);if(!n||!n.progression.guildId)return!1;const o=n.progression.guildId,c=d=>Math.max(1,Math.floor(d/250)+1);let l=0;return a(d=>({guilds:d.guilds.map(m=>{if(m.id!==o)return m;const u=m.guildXP+r;return l=c(u),{...m,guildXP:u,level:l}})})),!0},setGuildRole:(t,r,i,n)=>{var d;const c=s().guilds.find(m=>m.id===t);return!c||(((d=c.roles)==null?void 0:d[r])||"membro")!=="lider"?!1:(a(m=>({guilds:m.guilds.map(u=>u.id===t?{...u,roles:{...u.roles||{},[i]:n}}:u)})),!0)},transferGuildLeadership:(t,r,i)=>{var l;const o=s().guilds.find(d=>d.id===t);return!o||(((l=o.roles)==null?void 0:l[r])||"membro")!=="lider"||!o.members.includes(i)?!1:(a(d=>({guilds:d.guilds.map(m=>{if(m.id!==t)return m;const u={...m.roles||{}};return Object.entries(u).forEach(([p,g])=>{g==="lider"&&(u[p]="oficial")}),u[i]="lider",{...m,roles:u}})})),!0)},ensureDefaultGuildExists:()=>{if(s().guilds.some(i=>i.name==="Foja dos Herois"))return;const r={id:la(),name:"Foja dos Herois",description:"A casa acolhedora de todos os herÃ³is iniciantes. Cooperativa, social e focada em aprender e evoluir juntos.",members:[],guildXP:0,bankGold:0,createdAt:new Date().toISOString(),quests:[],level:1,roles:{},councilMembers:[],policies:{},pendingAlliances:[]};a(i=>({guilds:[...i.guilds,r]}))},activateGuildEvent:(t,r,i)=>{var b,f,j;const n=s(),o=n.guilds.find(N=>N.id===t),c=n.heroes.find(N=>N.id===r);if(!o||!c)return!1;const l=(o.councilMembers||[]).includes(r)||((b=o.roles)==null?void 0:b[r])==="lider",d=((f=c.rankData)==null?void 0:f.currentRank)==="S";if(!l||!d)return!1;const m=(i.durationHours??24)*60*60*1e3,u=new Date(Date.now()+m).toISOString(),p=i.eventName||"Evento da Guilda",g=Math.max(0,Math.min(30,i.xpBuffPercent??0)),v=Math.max(0,Math.min(25,i.trainingDiscountPercent??0)),w=(i.costGold??100)+g*10+v*5;if(o.bankGold<w)return!1;const k=(j=o.policies)==null?void 0:j.lastEventActivatedAt,E=Date.now(),h=12*60*60*1e3;if(k){const N=new Date(k).getTime();if(E-N<h)return!1}return a(N=>({guilds:N.guilds.map(T=>T.id===t?{...T,bankGold:T.bankGold-w,policies:{...T.policies||{},xpBuffPercent:g,trainingDiscountPercent:v,activeEventName:p,eventExpiresAt:u,lastEventActivatedAt:new Date().toISOString()}}:T)})),ft(),Pa.getState().applyGuildBuffs({xpBuffPercent:g,trainingDiscountPercent:v,eventName:p,expiresAt:u,sourceGuildId:t}),gt.guildEventActivated({heroId:c.id,heroName:c.name,heroClass:c.class,heroLevel:c.level,guildName:o.name,eventName:p,xpBuffPercent:g,trainingDiscountPercent:v,eventExpiresAt:u,costGold:w}),!0},clearGuildEvent:(t,r)=>{var l;const i=s(),n=i.guilds.find(d=>d.id===t),o=i.heroes.find(d=>d.id===r);return!n||!o||!((n.councilMembers||[]).includes(r)||((l=n.roles)==null?void 0:l[r])==="lider")?!1:(a(d=>({guilds:d.guilds.map(m=>m.id===t?{...m,policies:{...m.policies||{},xpBuffPercent:0,trainingDiscountPercent:0,activeEventName:void 0,eventExpiresAt:void 0}}:m)})),Pa.getState().clearGuildBuffs(),!0)},approvePartyAlliance:(t,r,i)=>{var d;const n=s(),o=n.guilds.find(m=>m.id===t),c=n.heroes.find(m=>m.id===r);return!o||!c||!((o.councilMembers||[]).includes(r)||((d=o.roles)==null?void 0:d[r])==="lider")?!1:(a(m=>({guilds:m.guilds.map(u=>{if(u.id!==t)return u;const p=(u.pendingAlliances||[]).map(g=>g.id===i?{...g,status:"approved",decidedAt:new Date().toISOString(),decidedBy:r}:g);return{...u,pendingAlliances:p}})})),!0)},rejectPartyAlliance:(t,r,i)=>{var d;const n=s(),o=n.guilds.find(m=>m.id===t),c=n.heroes.find(m=>m.id===r);return!o||!c||!((o.councilMembers||[]).includes(r)||((d=o.roles)==null?void 0:d[r])==="lider")?!1:(a(m=>({guilds:m.guilds.map(u=>{if(u.id!==t)return u;const p=(u.pendingAlliances||[]).map(g=>g.id===i?{...g,status:"rejected",decidedAt:new Date().toISOString(),decidedBy:r}:g);return{...u,pendingAlliances:p}})})),!0)},setActiveTitle:t=>{const r=s().getSelectedHero();if(r){if(t&&!r.titles.find(i=>i.id===t)){console.warn("TÃ­tulo nÃ£o encontrado nos tÃ­tulos do herÃ³i");return}s().updateHero(r.id,{activeTitle:t})}},addTitleToSelectedHero:(t,r=!1)=>{const i=s().getSelectedHero();if(!i)return;const n=i.titles.some(l=>l.id===t.id),c={titles:n?i.titles:[...i.titles,t]};r&&(c.activeTitle=t.id),s().updateHero(i.id,c),n||gt.titleEarned({heroId:i.id,heroName:i.name,heroClass:i.class,heroLevel:i.progression.level,titleEarned:t.name})},toggleFavoriteTitle:(t,r)=>{const i=s().getSelectedHero();if(!i)return;const n=i.titles.map(o=>o.id===t?{...o,favorite:r??!o.favorite}:o);s().updateHero(i.id,{titles:n})},updateAchievementProgress:()=>{const t=s().getSelectedHero();if(!t)return;const r=t.achievements||[],i=bc(t),n=i.filter(m=>{const u=r.find(p=>p.id===m.id);return m.unlocked&&(!u||!u.unlocked)});let o=[...t.titles];n.forEach(m=>{var v;const u=(v=m.rewards)==null?void 0:v.title;if(!u)return;const p=It.find(y=>y.id===u);if(!p)return;o.some(y=>y.id===u)||(o.push({...p,unlockedAt:new Date}),gt.titleEarned({heroId:t.id,heroName:t.name,heroClass:t.class,heroLevel:t.progression.level,titleEarned:p.name}))});const c=n.reduce((m,u)=>{var p,g;return m.xp+=Number(((p=u.rewards)==null?void 0:p.xp)||0),m.gold+=Number(((g=u.rewards)==null?void 0:g.gold)||0),m},{xp:0,gold:0}),l=t.progression.level;switch(t.class){case"guerreiro":if(l>=5&&!o.some(m=>m.id==="campeao-de-ferro")){const m=It.find(u=>u.id==="campeao-de-ferro");m&&o.push({...m,unlockedAt:new Date})}if(l>=10&&!o.some(m=>m.id==="portador-da-lamina-sagrada")){const m=It.find(u=>u.id==="portador-da-lamina-sagrada");m&&o.push({...m,unlockedAt:new Date})}break;case"mago":if(l>=5&&!o.some(m=>m.id==="teurgo-do-veu")){const m=It.find(u=>u.id==="teurgo-do-veu");m&&o.push({...m,unlockedAt:new Date})}if(l>=10&&!o.some(m=>m.id==="guardiao-dos-arcanos")){const m=It.find(u=>u.id==="guardiao-dos-arcanos");m&&o.push({...m,unlockedAt:new Date})}break;case"arqueiro":if(l>=5&&!o.some(m=>m.id==="olho-de-falcao")){const m=It.find(u=>u.id==="olho-de-falcao");m&&o.push({...m,unlockedAt:new Date})}if(l>=10&&!o.some(m=>m.id==="cacador-das-sombras")){const m=It.find(u=>u.id==="cacador-das-sombras");m&&o.push({...m,unlockedAt:new Date})}break;case"clerigo":if(l>=5&&!o.some(m=>m.id==="mao-da-luz")){const m=It.find(u=>u.id==="mao-da-luz");m&&o.push({...m,unlockedAt:new Date})}if(l>=10&&!o.some(m=>m.id==="protetor-das-almas")){const m=It.find(u=>u.id==="protetor-das-almas");m&&o.push({...m,unlockedAt:new Date})}break}if(t.stats.itemsFound>=50&&!o.some(m=>m.id==="domador-da-fortuna")){const m=It.find(u=>u.id==="domador-da-fortuna");m&&o.push({...m,unlockedAt:new Date})}if(t.stats.totalCombats>=50&&!o.some(m=>m.id==="sombra-invicta")){const m=It.find(u=>u.id==="sombra-invicta");m&&o.push({...m,unlockedAt:new Date})}if(t.stats.questsCompleted>=25&&!o.some(m=>m.id==="explorador-do-desconhecido")){const m=It.find(u=>u.id==="explorador-do-desconhecido");m&&o.push({...m,unlockedAt:new Date})}const d={...t.progression,xp:(t.progression.xp||0)+c.xp,gold:(t.progression.gold||0)+c.gold};s().updateHero(t.id,{achievements:i,titles:o,progression:d})},updateReputation:(t,r)=>{var c;const i=s().getSelectedHero();if(!i)return;const n=ac(i,t,r),o=s().heroes.find(l=>l.id===i.id)||i;s().updateHero(i.id,{reputationFactions:n.reputationFactions,progression:{...o.progression,reputation:(((c=o.progression)==null?void 0:c.reputation)||0)+r}})},processReputationEvents:()=>{const t=s().getSelectedHero();if(!t)return;ic(t).forEach(d=>{console.log("Evento de reputaÃ§Ã£o:",d)});const i=t.reputationFactions||[],n=i.length>0&&i.every(d=>d.level==="revered"),o=i.some(d=>d.level==="honored"||d.level==="revered"),c=i.length>0&&i.every(d=>d.level==="honored"||d.level==="revered"),l=[];if(o&&!t.titles.some(d=>d.id==="heroi-local")&&l.push("heroi-local"),c&&!t.titles.some(d=>d.id==="guardiao-do-reino")&&l.push("guardiao-do-reino"),n&&!t.titles.some(d=>d.id==="legend")&&l.push("legend"),l.length){const d=l.map(m=>It.find(u=>u.id===m)).filter(Boolean).map(m=>({...m,unlockedAt:new Date}));s().updateHero(t.id,{titles:[...t.titles,...d]}),d.forEach(m=>{gt.titleEarned({heroId:t.id,heroName:t.name,heroClass:t.class,heroLevel:t.progression.level,titleEarned:m.name})})}},getLeaderboards:()=>{const t=s().heroes;return Ya(t)},getHeroRanking:t=>{const r=s().heroes,i=r.find(n=>n.id===t);return i?Zi(i,r):null},calculateHeroScore:t=>{const r=s().heroes.find(i=>i.id===t);return r?en(r):0},getSelectedHero:()=>{const{heroes:t,selectedHeroId:r}=s(),i=t.find(o=>o.id===r&&o.origin!=="npc");return i||t.find(o=>o.origin!=="npc")||t[0]},getHeroQuests:t=>{const r=s(),i=r.heroes.find(n=>n.id===t);return i?r.availableQuests.filter(n=>i.activeQuests.includes(n.id)):[]},getHeroGuild:t=>{const r=s(),i=r.heroes.find(n=>n.id===t);if(!(!i||!i.progression.guildId))return r.guilds.find(n=>n.id===i.progression.guildId)},generateDailyGoalsForHero:t=>{a(r=>{const i=r.heroes.findIndex(l=>l.id===t);if(i===-1)return r;const n=r.heroes[i],o=ti(n),c=[...r.heroes];return c[i]={...n,dailyGoals:o},{...r,heroes:c}})},updateDailyGoalProgress:(t,r,i=1)=>{a(n=>{var y;const o=n.heroes.findIndex(w=>w.id===t);if(o===-1)return n;const c=n.heroes[o];let l=c.dailyGoals&&c.dailyGoals.length>0?c.dailyGoals:ti(c);const d=Ds(l),m=d.filter(w=>w.completed).length;let u=uc(d,r,i);u=pc(u);const p=u.filter(w=>w.completed).length;let g={...c.stats};if(p>m){const w=new Date;new Date(w).setHours(0,0,0,0);const E=(y=c.stats)==null?void 0:y.lastDailyCompletion,h=E?new Date(E):void 0;if(!(h&&h.getFullYear()===w.getFullYear()&&h.getMonth()===w.getMonth()&&h.getDate()===w.getDate())){const f=new Date(w);f.setDate(f.getDate()-1);const j=h&&h.getFullYear()===f.getFullYear()&&h.getMonth()===f.getMonth()&&h.getDate()===f.getDate(),N=g.dailyCompletionStreak||0;g.dailyCompletionStreak=j?N+1:1,g.lastDailyCompletion=w.toISOString()}}const v=[...n.heroes];return v[o]={...c,dailyGoals:u,stats:g},{...n,heroes:v}})},allocateAttributePoints:(t,r)=>{var v;const i=s().heroes.find(y=>y.id===t);if(!i)return!1;const n=i.attributePoints||0,o=Object.entries(r).filter(([y,w])=>typeof w=="number"&&w>0).map(([y,w])=>({key:y,inc:w})),c=o.reduce((y,w)=>y+w.inc,0);if(c<=0||c>n)return!1;const l=((v=i.rankData)==null?void 0:v.currentRank)||We.calculateRank(i),d=Cr(l);el(l);const m={...i.attributes};for(const{key:y,inc:w}of o){const E=m[y]+w;if(E>d)return!1;m[y]=E}Object.values(m).reduce((y,w)=>y+w,0);const u=Math.max(0,n-c),p=ht(m,i.class,i.progression.level,i.inventory,i.activeTitle,Ct(i));s().updateHero(t,{attributes:m,attributePoints:u,derivedAttributes:p}),je.featureUsed(t,"attribute-allocation");const g=o.reduce((y,{key:w,inc:k})=>(y[w]=k,y),{});return je.attributePointsAllocated(t,{totalSpent:c,allocations:g}),!0},completeDailyGoal:(t,r)=>{a(i=>{const n=i.heroes.findIndex(w=>w.id===t);if(n===-1)return i;const o=i.heroes[n];if(!o.dailyGoals)return i;const c=o.dailyGoals.findIndex(w=>w.id===r);if(c===-1)return i;const l=o.dailyGoals[c];if(!l||!l.completed||l.claimed)return i;const d=tn(l),m={...o,progression:{...o.progression,xp:o.progression.xp+d.xp,gold:o.progression.gold+d.gold,glory:(o.progression.glory||0)+d.glory||o.progression.glory||0,arcaneEssence:(o.progression.arcaneEssence||0)+d.arcaneEssence||o.progression.arcaneEssence||0},dailyGoals:o.dailyGoals.map((w,k)=>k===c?{...w,claimed:!0}:w)},u=li(m.progression.xp,m.progression.level);u>m.progression.level&&(m.level=u,m.progression.level=u,m.derivedAttributes=ht(m.attributes,m.class,u,m.inventory,m.activeTitle,Ct(m))),d.items&&d.items.forEach(w=>{const k=m.inventory.items[w.id]||0;m.inventory.items[w.id]=k+1});const p=new Date,g=Ds(m.dailyGoals||[]);if(g.length>0&&g.every(w=>w.completed&&w.claimed)){const w=m.stats.lastDailyCompletion?new Date(m.stats.lastDailyCompletion):null,k=p.toDateString(),E=w?w.toDateString():"",h=m.stats.dailyCompletionStreak||0,b=E===k?h:h+1;m.stats={...m.stats,dailyCompletionStreak:b,lastDailyCompletion:p.toISOString()}}const y=[...i.heroes];return y[n]=m,{...i,heroes:y}})},cleanupExpiredGoals:t=>{a(r=>{const i=r.heroes.findIndex(l=>l.id===t);if(i===-1)return r;const n=r.heroes[i];if(!n.dailyGoals)return r;const o=Ds(n.dailyGoals),c=[...r.heroes];return c[i]={...n,dailyGoals:o},{...r,heroes:c}})},shouldShowOnboarding:()=>{const t=s();return!localStorage.getItem("heroforge-onboarding-shown")&&t.heroes.length===0},markOnboardingShown:()=>{localStorage.setItem("heroforge-onboarding-shown","true")},triggerOnboardingForNewUser:()=>{const t=s();t.shouldShowOnboarding()&&(Ve.loadState(),Ve.getAvailableFlows().length>0&&!Ve.getCurrentStep()&&Ve.startFlow("first-steps"),t.markOnboardingShown())},promoteHero:t=>{const r=s().heroes.find(o=>o.id===t);if(!r)return!1;if(!r.rankData){const o=We.initializeRankData(r);s().updateHero(t,{rankData:o}),r.rankData=o}const i=We.calculateProgress(r);if(!i.canPromote)return!1;const n=We.promoteHero(r,r.rankData);if(n.promoted&&n.newRank&&n.celebration){const o=We.updateRankData(r,r.rankData);return s().updateHero(t,{rankData:o}),gt.rankPromotion({heroId:t,heroName:r.name,heroClass:r.class,newRank:n.newRank,previousRank:i.currentRank}),!0}return!1},getHeroRankProgress:t=>{const r=s().heroes.find(i=>i.id===t);if(!r)return null;if(!r.rankData){const i=We.initializeRankData(r);s().updateHero(t,{rankData:i}),r.rankData=i}return{progress:We.calculateProgress(r),rankData:r.rankData,estimate:We.estimateTimeToNextRank(r)}},getRankLeaderboard:()=>s().heroes.map(r=>We.createComparison(r,0)).sort((r,i)=>{const n=["SSS","SS","S","A","B","C","D","E","F"],o=n.indexOf(r.rank),c=n.indexOf(i.rank);return o!==c?o-c:i.rankPoints-r.rankPoints}).map((r,i)=>({...r,position:i+1})),markCelebrationViewed:(t,r)=>{var o,c,l;const i=s().heroes.find(d=>d.id===t);if(!i||!((c=(o=i.rankData)==null?void 0:o.pendingCelebrations)!=null&&c[r]))return;const n=[...((l=i.rankData)==null?void 0:l.pendingCelebrations)||[]];n.splice(r,1),s().updateHero(t,{rankData:{...i.rankData,pendingCelebrations:n}})}}),{name:"hero-forge-epic-storage",partialize:a=>({heroes:a.heroes,selectedHeroId:a.selectedHeroId,availableQuests:a.availableQuests,guilds:a.guilds,referralInvites:a.referralInvites}),migrate:(a,s)=>(a!=null&&a.heroes&&(a.heroes=a.heroes.map(t=>{var i,n,o;const r={...t,reputationFactions:t.reputationFactions||[{id:"guarda",name:"Guarda da Cidade",reputation:0,level:"neutral"},{id:"ladroes",name:"LadrÃµes",reputation:0,level:"neutral"},{id:"clero",name:"Clero",reputation:0,level:"neutral"},{id:"cultistas",name:"Cultistas",reputation:0,level:"neutral"},{id:"comerciantes",name:"Comerciantes",reputation:0,level:"neutral"},{id:"exploradores",name:"Exploradores",reputation:0,level:"neutral"}],dailyGoals:t.dailyGoals||[],achievements:t.achievements||[],stats:t.stats||{questsCompleted:0,totalCombats:0,totalPlayTime:0,lastActiveAt:new Date().toISOString(),enemiesDefeated:0,goldEarned:0,itemsFound:0,achievementsUnlocked:0,loginStreak:0,lastLogin:new Date,dailyCompletionStreak:0}};return t.rankData||(r.rankData=We.initializeRankData(r)),r.progression={...r.progression,glory:((i=r.progression)==null?void 0:i.glory)??0,arcaneEssence:((n=r.progression)==null?void 0:n.arcaneEssence)??0,fatigue:((o=r.progression)==null?void 0:o.fatigue)??0},r})),a!=null&&a.referralInvites||(a.referralInvites=[]),a)})),et={colors:{gold:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f"},bronze:{50:"#fdf8f6",100:"#f2e8e5",200:"#eaddd7",300:"#e0cfc5",400:"#d2bab0",500:"#bfa094",600:"#a18072",700:"#8b6f47",800:"#734a2e",900:"#5c3317"},silver:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},royal:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87"},crimson:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b"},background:{primary:"#0f172a",secondary:"#1e293b"},text:{primary:"#f8fafc",secondary:"#cbd5e1"},accent:{gold:"#f59e0b",silver:"#64748b",crimson:"#ef4444"}},gradients:{ranks:{F:"from-gray-400 to-gray-600",E:"from-emerald-400 to-emerald-600",D:"from-blue-400 to-blue-600",C:"from-purple-400 to-purple-600",B:"from-amber-400 to-amber-600",A:"from-red-400 to-red-600",S:"from-yellow-300 via-yellow-400 to-amber-500"},backgrounds:{primary:"from-slate-900 via-slate-800 to-slate-900",secondary:"from-slate-800 via-slate-700 to-slate-800",accent:"from-gold-900/20 via-gold-800/10 to-transparent",hero:"from-royal-900/30 via-royal-800/20 to-transparent",quest:"from-emerald-900/30 via-emerald-800/20 to-transparent",combat:"from-crimson-900/30 via-crimson-800/20 to-transparent"},buttons:{primary:"from-gold-500 via-gold-600 to-gold-700",secondary:"from-silver-500 via-silver-600 to-silver-700",success:"from-emerald-500 via-emerald-600 to-emerald-700",danger:"from-crimson-500 via-crimson-600 to-crimson-700",royal:"from-royal-500 via-royal-600 to-royal-700"}},icons:{ranks:{F:"âšª",E:"ğŸŸ¢",D:"ğŸ”µ",C:"ğŸŸ£",B:"ğŸŸ¡",A:"ğŸ”´",S:"â­"},classes:{Guerreiro:"âš”ï¸",Mago:"ğŸ”®",Arqueiro:"ğŸ¹",Ladino:"ğŸ—¡ï¸",Paladino:"ğŸ›¡ï¸",BÃ¡rbaro:"ğŸª“",Druida:"ğŸŒ¿",Feiticeiro:"âœ¨",Bardo:"ğŸ»",Monge:"ğŸ¥‹",Assassino:"ğŸ—¡ï¸",Lanceiro:"ğŸ‰"},activities:{"quest-completed":"ğŸ¯","epic-quest-completed":"ğŸŒŸ","level-up":"ğŸ“ˆ","achievement-unlocked":"ğŸ†","title-earned":"ğŸ‘‘","event-completed":"ğŸª","daily-goal-completed":"âœ…","combat-victory":"âš”ï¸","rank-promotion":"ğŸ†"},ui:{close:"âœ•",menu:"â˜°",settings:"âš™ï¸",profile:"ğŸ‘¤",stats:"ğŸ“Š",inventory:"ğŸ’",guild:"ğŸ°",leaderboard:"ğŸ†",calendar:"ğŸ“…",notification:"ğŸ””"}},effects:{shadows:{small:"shadow-lg shadow-black/25",medium:"shadow-xl shadow-black/30",large:"shadow-2xl shadow-black/40",glow:"shadow-2xl shadow-gold-500/20",royal:"shadow-2xl shadow-royal-500/20",crimson:"shadow-2xl shadow-crimson-500/20"},borders:{gold:"border border-gold-500/30",silver:"border border-silver-500/30",royal:"border border-royal-500/30",crimson:"border border-crimson-500/30",emerald:"border border-emerald-500/30"},animations:{float:"animate-bounce",pulse:"animate-pulse",spin:"animate-spin",ping:"animate-ping"}},typography:{fonts:{heading:"font-bold tracking-wide",body:"font-medium",accent:"font-semibold tracking-wider uppercase"},sizes:{xs:"text-xs",sm:"text-sm",base:"text-base",lg:"text-lg",xl:"text-xl","2xl":"text-2xl","3xl":"text-3xl","4xl":"text-4xl"}},layout:{spacing:{xs:"p-2",sm:"p-4",md:"p-6",lg:"p-8",xl:"p-12"},rounded:{sm:"rounded-md",md:"rounded-lg",lg:"rounded-xl",full:"rounded-full"},containers:{card:"bg-slate-800 rounded-lg border border-slate-700 shadow-xl",panel:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-600 shadow-2xl",modal:"bg-gradient-to-br from-slate-900 to-black rounded-2xl border border-slate-600 shadow-2xl"}}},Ss=a=>et.gradients.ranks[a]||"from-gray-400 to-gray-600",Ms=a=>et.icons.ranks[a]||"ğŸ–ï¸",gn=a=>et.icons.classes[a]||"âš”ï¸",Ke={natal:{banner:"from-emerald-900/40 via-emerald-700/30 to-transparent",accents:["ğŸ","ğŸ•¯ï¸","ğŸŒ¿"],border:"border-emerald-500/40",buttonGradient:"from-emerald-600 to-emerald-700",messages:["As velas do inverno iluminam as tavernas do reino.","Guirlandas de azevinho adornam os salÃµes do castelo.","Presentes embrulhados em couro aguardam sob o pinheiro encantado."]},pascoa:{banner:"from-purple-900/30 via-purple-700/20 to-transparent",accents:["ğŸ¥š","ğŸ‡","ğŸ”®"],border:"border-purple-500/40",buttonGradient:"from-purple-600 to-purple-700",messages:["Ovos gravados com runas reaparecem nos bosques antigos.","Coelhos mÃ¡gicos guiam herÃ³is por trilhas de renascimento.","Os bardos cantam lendas de retorno e esperanÃ§a."]},ano_novo:{banner:"from-amber-900/30 via-amber-700/20 to-transparent",accents:["ğŸ†","ğŸ—","ğŸ“œ"],border:"border-amber-500/40",buttonGradient:"from-amber-600 to-yellow-600",messages:["Fogos encantados riscam o cÃ©u sobre muralhas antigas.","Banquetes reais celebram pactos e bons pressÃ¡gios.","Profetas desenham novas rotas nos mapas do destino."]},carnaval:{banner:"from-rose-900/30 via-violet-800/20 to-transparent",accents:["ğŸ­","ğŸ¶","ğŸ›¡ï¸"],border:"border-rose-500/40",buttonGradient:"from-rose-600 to-violet-600",messages:["MÃ¡scaras de criaturas mÃ­sticas enfeitam as praÃ§as.","Festivais de bardos ecoam pelos becos da capital.","Torneios de disfarces premiam astÃºcia e coragem."]}},yt=a=>{const s=a?Ke[a]:void 0;return(s==null?void 0:s.buttonGradient)||"from-amber-600 to-yellow-600"},Nu=a=>{switch(a){case"natal":return{from:"#10b981",to:"#059669"};case"pascoa":return{from:"#9333ea",to:"#7e22ce"};case"ano_novo":return{from:"#f59e0b",to:"#d97706"};case"carnaval":return{from:"#e11d48",to:"#7c3aed"};default:return{from:"#f59e0b",to:"#d97706"}}},ol=()=>{var b;const[a,s]=x.useState(!1),[t,r]=x.useState(null),[i,n]=x.useState("center"),[o,c]=x.useState(""),[l,d]=x.useState(""),[m,u]=x.useState(!1),p=Wt(),{activeSeasonalTheme:g}=Qe(),v=yt(g),y=((b=Ke[g||""])==null?void 0:b.accents)||[],w=()=>{const f=Ve.getCurrentStep();if(!f){s(!1),r(null);return}c(f.title||""),d(f.description||""),u(!!f.skippable);const j=f.position||"center";if(n(j),f.targetElement)try{const N=document.querySelector(f.targetElement);if(N){try{N.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}catch{}const T=N.getBoundingClientRect();r(T),s(!0)}else r(null),s(!0)}catch{r(null),s(!0)}else r(null),s(!0)};x.useEffect(()=>{w();const f=()=>w();Ve.on("step-changed",f),Ve.on("step-completed",f),Ve.on("flow-completed",()=>s(!1));const j=()=>w();return window.addEventListener("resize",j),window.addEventListener("scroll",j,!0),()=>{Ve.off("step-changed",f),Ve.off("step-completed",f),window.removeEventListener("resize",j),window.removeEventListener("scroll",j,!0)}},[]);const k=x.useMemo(()=>t?{left:`${t.left+window.scrollX}px`,top:`${t.top+window.scrollY}px`,width:`${t.width}px`,height:`${t.height}px`}:{left:"50%",top:"20%",width:0,height:0},[t]),E=x.useMemo(()=>{if(!t)return{left:0,top:0,width:0,height:0};const f=12;return{left:`${t.left+window.scrollX-f}px`,top:`${t.top+window.scrollY-f}px`,width:`${t.width+f*2}px`,height:`${t.height+f*2}px`}},[t]),h=x.useMemo(()=>{if(!t)return{left:"50%",top:"50%"};const f=t.left+window.scrollX+t.width/2,j=t.top+window.scrollY+t.height/2;return i==="top"?{left:`${f}px`,top:`${t.top+window.scrollY-12}px`}:i==="bottom"?{left:`${f}px`,top:`${t.bottom+window.scrollY+4}px`}:i==="left"?{left:`${t.left+window.scrollX-12}px`,top:`${j}px`}:i==="right"?{left:`${t.right+window.scrollX+4}px`,top:`${j}px`}:{left:`${f}px`,top:`${t.bottom+window.scrollY+4}px`}},[t,i]);return a?e.jsxs("div",{className:"fixed inset-0 z-[1000] pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50"}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute rounded-xl bg-amber-400/10 blur-sm animate-pulse",style:E}),e.jsx("div",{className:"absolute border-2 border-amber-400 rounded-lg shadow-lg animate-pulse",style:k})]}),t&&e.jsxs("div",{className:"absolute -translate-x-1/2 -translate-y-1/2",style:h,children:[i==="top"&&e.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-b-8 border-l-transparent border-r-transparent border-b-amber-400"}),i==="bottom"&&e.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-amber-400"}),i==="left"&&e.jsx("div",{className:"w-0 h-0 border-t-8 border-b-8 border-r-8 border-t-transparent border-b-transparent border-r-amber-400"}),i==="right"&&e.jsx("div",{className:"w-0 h-0 border-t-8 border-b-8 border-l-8 border-t-transparent border-b-transparent border-l-amber-400"})]}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2",style:{top:i==="top"?t?t.top+window.scrollY-80:80:i==="bottom"?t?t.bottom+window.scrollY+20:140:i==="left"||i==="right"?t?t.top+window.scrollY:160:140},children:e.jsxs("div",{className:"pointer-events-auto max-w-[90vw] sm:max-w-lg px-4 py-3 rounded-xl bg-slate-800 border border-white/20 shadow-xl",children:[e.jsx("div",{className:"text-white font-semibold text-sm mb-1",children:o}),e.jsx("div",{className:"text-xs text-gray-300 mb-3",children:l}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{var j;const f=Ve.getCurrentStep();((j=f==null?void 0:f.action)==null?void 0:j.type)==="navigate"&&f.action.target&&p(f.action.target)},className:`px-3 py-1 rounded bg-gradient-to-r ${v} text-white text-xs`,children:[y[0]||""," Ir"]}),e.jsx("button",{onClick:()=>{Ve.nextStep()},className:"px-3 py-1 rounded bg-gray-800 text-white text-xs",children:"AvanÃ§ar"}),m&&e.jsx("button",{onClick:()=>{Ve.skipStep()},className:"px-3 py-1 rounded bg-gray-700 text-white text-xs",children:"Pular"}),e.jsx("button",{onClick:()=>{Ve.reset()},className:"ml-auto px-3 py-1 rounded bg-gray-700 text-white text-xs",children:"Fechar"})]})]})})]}):null},gs=Za(a=>({user:null,token:null,isAuthenticated:!1,login:(s,t)=>{try{sessionStorage.setItem("hf_user",JSON.stringify({user:s}))}catch{}a({user:s,token:null,isAuthenticated:!0})},logout:()=>{try{sessionStorage.removeItem("hf_user")}catch{}a({user:null,token:null,isAuthenticated:!1})}}));try{const a=sessionStorage.getItem("hf_user");if(a){const{user:s}=JSON.parse(a);gs.setState({user:s,token:null,isAuthenticated:!0})}}catch{}async function cl(a){const s=await fetch("/api/login-google",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:a})}),t=await s.json();if(!s.ok)throw new Error((t==null?void 0:t.error)||"Falha no login com Google");return t.user}const ll="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'><rect width='64' height='64' rx='8' fill='%23e5e7eb'/><circle cx='32' cy='24' r='12' fill='%239ca3af'/><rect x='14' y='40' width='36' height='18' rx='9' fill='%239ca3af'/></svg>",dl=()=>{const a=x.useRef(null),s=x.useRef(!1),t=x.useRef(!1),r=x.useRef(!1),i=gs(p=>p.login),n=gs(p=>p.isAuthenticated),o=gs(p=>p.user),[c,l]=x.useState(!1);if(x.useEffect(()=>{const p={}.VITE_GOOGLE_CLIENT_ID;if(!(p&&p.includes(".apps.googleusercontent.com"))||n)return;const v=()=>{if(!(!window.google||!a.current))try{s.current||(window.google.accounts.id.initialize({client_id:p,callback:async y=>{try{l(!0);const w=await cl(y.credential);i(w,y.credential);try{ge.emit({type:"achievement",title:"Login Google",message:"Autenticado com sucesso",icon:"âœ…",duration:2500})}catch{}}catch(w){console.error("Login Google falhou",w);try{ge.emit({type:"error",title:"Falha no Login Google",message:"Verifique configuraÃ§Ã£o e tente novamente",duration:3500})}catch{}}finally{l(!1)}}}),s.current=!0),!r.current&&a.current.childElementCount===0&&(window.google.accounts.id.renderButton(a.current,{theme:"outline",size:"large"}),r.current=!0)}catch(y){console.error("Erro inicializando Google Identity",y)}};if(window.google)v();else if(!t.current&&!document.querySelector('script[src="https://accounts.google.com/gsi/client"]')){const y=document.createElement("script");y.src="https://accounts.google.com/gsi/client",y.async=!0,y.defer=!0,y.onload=v,y.onerror=()=>{},document.head.appendChild(y),t.current=!0}},[n]),n)return e.jsxs("div",{className:"flex items-center space-x-2",children:[(o==null?void 0:o.picture)&&e.jsx("img",{src:`/api/proxy-image?url=${encodeURIComponent(o.picture||"")}`,alt:"avatar",className:"w-8 h-8 rounded-full",onError:p=>{p.currentTarget.src=ll}}),e.jsxs("span",{className:"text-sm",children:["OlÃ¡, ",(o==null?void 0:o.name)||(o==null?void 0:o.email)]})]});const d={}.VITE_GOOGLE_CLIENT_ID,m=d&&d.includes(".apps.googleusercontent.com"),u=String({}.VITE_SUPABASE_OAUTH_GOOGLE_ENABLED||"").toLowerCase()==="true";return m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{ref:a}),_t&&u&&e.jsx("button",{onClick:async()=>{try{l(!0),await Ze.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}})}catch{try{ge.emit({type:"error",title:"OAuth Google (Supabase)",message:"Falha ao redirecionar",duration:3e3})}catch{}}finally{l(!1)}},className:`px-2 py-1 rounded ${c?"bg-gray-600 opacity-60":"bg-gray-700 hover:bg-gray-600"} text-white text-xs`,disabled:c,children:"Supabase"})]}):null},xn=[{label:"InÃ­cio",path:"/journey"},{label:"Criar HerÃ³i",path:"/create"},{label:"Ver Galeria",path:"/gallery"},{label:"MissÃµes",path:"/quests"},{label:"EvoluÃ§Ã£o",path:"/evolution"}],ml=a=>{const s=xn.findIndex(t=>a.startsWith(t.path));return s>=0?s:0};async function ul(a,s){if(!a)return null;const t=s||null,{data:r,error:i}=await Ze.from("players").select("*").eq("id",a).limit(1);if(i)return null;if(r&&r.length>0){const{data:c,error:l}=await Ze.from("players").update({username:t}).eq("id",a).select("*").limit(1);return l?r[0]:c&&c[0]}const{data:n,error:o}=await Ze.from("players").insert({id:a,username:t}).select("*").limit(1);return o?null:n&&n[0]}async function pl(){return await(await fetch("/api/monetization/config")).json()}async function gl(a,s,t,r="active"){if(!a||!s||!(t!=null&&t.id))return null;const i={id:t.id,user_id:a,hero_id:s,data:t,status:r},{data:n,error:o}=await Ze.from("quests").upsert(i,{onConflict:"id"}).select("*").limit(1);return o?(console.error("saveQuest error",{code:o==null?void 0:o.code,message:o==null?void 0:o.message,details:o==null?void 0:o.details,hint:o==null?void 0:o.hint,payload:i}),null):n&&n[0]}async function xl(a,s){if(!a||!s)return[];const{data:t,error:r}=await Ze.from("quests").select("*").eq("user_id",a).eq("hero_id",s).order("updated_at",{ascending:!1});return r?(console.error("listQuestsByHero error",{code:r==null?void 0:r.code,message:r==null?void 0:r.message,details:r==null?void 0:r.details,hint:r==null?void 0:r.hint,userId:a,heroId:s}),[]):Array.isArray(t)?t:[]}async function Ar(a){const s=new URLSearchParams;s.set("userId",a);const t=await fetch(`/api/users/friends?${s.toString()}`);if(!t.ok)throw new Error(`Falha ao listar amigos: ${t.status}`);const r=await t.json();return Array.isArray(r==null?void 0:r.friends)?r.friends:[]}async function hl(a,s){const t=await fetch("/api/users/friends/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,targetId:s})});if(!t.ok)throw new Error(`Falha ao adicionar amigo: ${t.status}`);const r=await t.json();return!!(r!=null&&r.ok)}async function fl(a,s){const t=await fetch("/api/users/friends/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,targetId:s})});if(!t.ok)throw new Error(`Falha ao remover amigo: ${t.status}`);const r=await t.json();return!!(r!=null&&r.ok)}async function hn(a){try{const s=(typeof import.meta<"u"?{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}:void 0)||{},t=s.VITE_API_BASE_URL||s.VITE_API_BASE||"";if(!t)return[];const r=new URLSearchParams;r.set("viewerId",a);const i=t||(typeof window<"u"?window.location.origin:""),n=new URL("/api/notifications/list",i);n.search=r.toString();const o=await fetch(n.toString());if(!o.ok)return[];const c=await o.json();return Array.isArray(c==null?void 0:c.notifications)?c.notifications:[]}catch{return[]}}async function bl(a){try{const s=(typeof import.meta<"u"?{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}:void 0)||{},t=s.VITE_API_BASE_URL||s.VITE_API_BASE||"";if(!t)return[];const r=new URLSearchParams;r.set("viewerId",a);const i=t||(typeof window<"u"?window.location.origin:""),n=new URL("/api/events/history",i);n.search=r.toString();const o=await fetch(n.toString());if(!o.ok)return[];const c=await o.json();return Array.isArray(c==null?void 0:c.events)?c.events:[]}catch{return[]}}async function vl(a){const s=new URLSearchParams;s.set("userId",a);try{const t=await fetch(`/api/users/profile?${s.toString()}`);if(t.status===404)return null;if(!t.ok)throw new Error(`Falha ao obter perfil: ${t.status}`);const r=await t.json(),i=(r==null?void 0:r.profile)||r;return!i||typeof i!="object"?null:{userId:String(i.userId||a),displayName:i.displayName,avatarUrl:i.avatarUrl,bio:i.bio,settings:i.settings}}catch{return null}}const Mr=typeof import.meta<"u"&&{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_API_BASE_URL||(()=>{try{if((typeof window<"u"?window.location.port:"")==="4174")return"http://localhost:3001"}catch{}return""})();function qt(a,s){try{const t=Mr||(typeof window<"u"?window.location.origin:""),r=new URL(a,t);return s&&(r.search=s.toString()),r.toString()}catch{return s?`${a}?${s.toString()}`:a}}async function Kt(a){var t;const s={};try{const{data:r}=await Ze.auth.getSession(),i=(t=r==null?void 0:r.session)==null?void 0:t.access_token;i&&(s.Authorization=`Bearer ${i}`)}catch{}return!s.Authorization&&a&&!_t&&(s["X-User-Id"]=a),s}async function ca(a){if(a.status===409)throw new Error("Limite de participantes atingido");try{const s=await a.json(),t=(s==null?void 0:s.code)||`HTTP_${a.status}`,r=(s==null?void 0:s.message)||(s==null?void 0:s.error)||(a.status===409?"Limite de participantes atingido":`Falha HTTP ${a.status}`),i=new Error(r);throw i.code=t,i.details=s==null?void 0:s.details,i}catch{throw new Error(`Falha HTTP ${a.status}`)}}async function fn(a,s={}){try{if(!Mr)return[];const t=new URLSearchParams;a&&t.set("viewerId",a),s.tag&&t.set("tag",s.tag),s.ownerId&&t.set("ownerId",s.ownerId),typeof s.limit=="number"&&t.set("limit",String(s.limit)),typeof s.offset=="number"&&t.set("offset",String(s.offset));const r=await Kt(a),i=await fetch(qt("/api/events/list",t),{headers:r});if(!i.ok)return[];const n=await i.json();return Array.isArray(n==null?void 0:n.events)?n.events:[]}catch{return[]}}async function hr(a,s={}){try{if(!Mr)return{items:[],pagination:{total:0,offset:Number(s.offset||0),limit:Number(s.limit||0),hasMore:!1}};const t=new URLSearchParams;a&&t.set("viewerId",a),s.tag&&t.set("tag",s.tag),s.ownerId&&t.set("ownerId",s.ownerId),typeof s.limit=="number"&&t.set("limit",String(s.limit)),typeof s.offset=="number"&&t.set("offset",String(s.offset));const r=await Kt(a),i=await fetch(qt("/api/events/list",t),{headers:r});if(!i.ok)return{items:[],pagination:{total:0,offset:Number(s.offset||0),limit:Number(s.limit||0),hasMore:!1}};const n=await i.json(),o=Array.isArray(n==null?void 0:n.events)?n.events:[],c=(n==null?void 0:n.pagination)||{total:o.length,offset:Number(s.offset||0),limit:Number(s.limit||o.length||0),hasMore:!1};return{items:o,pagination:c}}catch{return{items:[],pagination:{total:0,offset:Number(s.offset||0),limit:Number(s.limit||0),hasMore:!1}}}}async function yl(a){const s={"Content-Type":"application/json",...await Kt(a.ownerId)},t=await fetch(qt("/api/events/create"),{method:"POST",headers:s,body:JSON.stringify(a)});if(!t.ok)return ca(t);const r=await t.json();return r==null?void 0:r.event}async function jl(a,s){const t=new URLSearchParams;s&&t.set("viewerId",s);const r=await Kt(s),i=await fetch(qt(`/api/events/${encodeURIComponent(a)}`,t),{headers:r});if(i.status===404)return null;if(!i.ok)return ca(i);const n=await i.json();return n==null?void 0:n.event}async function bn(a,s,t){const r={"Content-Type":"application/json",...await Kt(s)},i=await fetch(qt(`/api/events/${encodeURIComponent(a)}/update`),{method:"POST",headers:r,body:JSON.stringify({actorId:s,updates:t})});if(!i.ok)return ca(i);const n=await i.json();return n==null?void 0:n.event}async function wl(a,s){const t={"Content-Type":"application/json",...await Kt(s)},r=await fetch(qt(`/api/events/${encodeURIComponent(a)}/delete`),{method:"POST",headers:t,body:JSON.stringify({actorId:s})});if(!r.ok)return ca(r);const i=await r.json();return!!(i!=null&&i.ok)}async function Nl(a,s,t){const r={"Content-Type":"application/json",...await Kt(s)},i=await fetch(qt(`/api/events/${encodeURIComponent(a)}/attend`),{method:"POST",headers:r,body:JSON.stringify({viewerId:s,status:t})});if(!i.ok)return ca(i);const n=await i.json();return n==null?void 0:n.event}async function di(a,s){const t=await fetch(qt(`/api/events/${encodeURIComponent(a)}/chat`),{signal:s});if(!t.ok)return ca(t);const r=await t.json();return Array.isArray(r==null?void 0:r.messages)?r.messages:[]}async function Sl(a,s,t){const r={"Content-Type":"application/json",...await Kt(s)},i=await fetch(qt(`/api/events/${encodeURIComponent(a)}/chat`),{method:"POST",headers:r,body:JSON.stringify({viewerId:s,text:t})});if(!i.ok)return ca(i);const n=await i.json();return n==null?void 0:n.message}async function Cl(a,s,t,r){const i={"Content-Type":"application/json",...await Kt(s)},n=await fetch(qt(`/api/events/${encodeURIComponent(a)}/media`),{method:"POST",headers:i,body:JSON.stringify({viewerId:s,url:t,caption:r})});if(!n.ok)return ca(n);const o=await n.json();return o==null?void 0:o.media}async function qs(a,s){const t=await fetch(qt(`/api/events/${encodeURIComponent(a)}/media`),{signal:s});if(!t.ok)return ca(t);const r=await t.json();return Array.isArray(r==null?void 0:r.media)?r.media:[]}async function kl(a,s,t,r){const i={"Content-Type":"application/json",...await Kt(s)},n=await fetch(qt(`/api/events/${encodeURIComponent(a)}/rate`),{method:"POST",headers:i,body:JSON.stringify({viewerId:s,stars:t,comment:r})});if(!n.ok)return ca(n);const o=await n.json();return!!(o!=null&&o.ok)}async function Al(a,s,t={}){try{const r=new URLSearchParams;a&&r.set("viewerId",a),s&&r.set("interests",s),typeof t.limit=="number"&&r.set("limit",String(t.limit)),typeof t.offset=="number"&&r.set("offset",String(t.offset));const i=await Kt(a),n=await fetch(qt("/api/events/recommendations",r),{headers:i});if(!n.ok)return[];const o=await n.json();return Array.isArray(o==null?void 0:o.events)?o.events:[]}catch{return[]}}async function mi(a,s,t={}){try{const r=new URLSearchParams;a&&r.set("viewerId",a),s&&r.set("interests",s),typeof t.limit=="number"&&r.set("limit",String(t.limit)),typeof t.offset=="number"&&r.set("offset",String(t.offset));const i=await Kt(a),n=await fetch(qt("/api/events/recommendations",r),{headers:i});if(!n.ok)return{items:[],pagination:{total:0,offset:Number(t.offset||0),limit:Number(t.limit||0),hasMore:!1}};const o=await n.json(),c=Array.isArray(o==null?void 0:o.events)?o.events:[],l=(o==null?void 0:o.pagination)||{total:c.length,offset:Number(t.offset||0),limit:Number(t.limit||c.length||0),hasMore:!1};return{items:c,pagination:l}}catch{return{items:[],pagination:{total:0,offset:Number(t.offset||0),limit:Number(t.limit||0),hasMore:!1}}}}function vn(a){return Object.values(a||{}).filter(s=>s==="yes").length}function Lt(a,s){const t=Math.max(1,Number(a||1)),r=vn(s);return Math.min(100,Math.round(r/t*100))}function ta(a,s,t=.9){const r=Math.max(1,Number(a||1));return vn(s)/r>=t}const Ml=at.lazy(()=>wt(()=>import("./EnhancedHUD-fff0f1be.js"),["assets/EnhancedHUD-fff0f1be.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),El=at.lazy(()=>wt(()=>import("./QuickNavigation-d2540682.js"),["assets/QuickNavigation-d2540682.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Rl=at.lazy(()=>wt(()=>import("./AdBanner-aad9ac35.js"),["assets/AdBanner-aad9ac35.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/adsenseLoader-aaae3e06.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Pl=at.lazy(()=>wt(()=>import("./InterstitialAd-40e9c70f.js"),["assets/InterstitialAd-40e9c70f.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/adsenseLoader-aaae3e06.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Il=at.lazy(()=>wt(()=>import("./SeasonalDecor-589e735c.js"),["assets/SeasonalDecor-589e735c.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Tl=()=>{var ae,ne;const a=ua(),[s,t]=x.useState(!0),{getSelectedHero:r,heroes:i,updateHero:n,importHero:o,getHeroQuests:c,availableQuests:l}=Z(),d=r(),{notifications:m,removeNotification:u,addNotification:p}=Rc(),g=ml(a.pathname),[v,y]=x.useState(null),[w,k]=x.useState(null),[E,h]=x.useState(!1),[b,f]=x.useState(null),{setConfig:j,activeThemeId:N}=Qe(),[T,F]=x.useState(0),[te,D]=x.useState(0),[$,X]=x.useState(null),[Q,Y]=x.useState(!1),[G,J]=x.useState(!1),[re,ee]=x.useState(null),[fe,_]=x.useState(0);x.useEffect(()=>{let U=!0;async function R(){var K,xe,W;const{data:oe}=await Ze.auth.getUser();if(U){y(((K=oe==null?void 0:oe.user)==null?void 0:K.email)||null),k(((xe=oe==null?void 0:oe.user)==null?void 0:xe.id)||null);try{const B=(W=oe==null?void 0:oe.user)==null?void 0:W.id;B&&await fetch(`/api/users?action=touch-login&id=${encodeURIComponent(B)}`)}catch{}}}R();const{data:L}=Ze.auth.onAuthStateChange((oe,K)=>{var xe,W;y(((xe=K==null?void 0:K.user)==null?void 0:xe.email)||null),k(((W=K==null?void 0:K.user)==null?void 0:W.id)||null)});return()=>{U=!1,L==null||L.subscription.unsubscribe()}},[]),x.useEffect(()=>{if(!("serviceWorker"in navigator))return;const U=()=>{try{p({id:`upd-${Date.now()}`,type:"info",title:"App atualizado",message:"Uma nova versÃ£o foi instalada.",timeoutMs:5e3}),je.featureUsed("system","app-updated")}catch{}};return navigator.serviceWorker.addEventListener("controllerchange",U),()=>{navigator.serviceWorker.removeEventListener("controllerchange",U)}},[p]),x.useEffect(()=>{let U=null;const R=async()=>{try{const L=r(),oe=(L==null?void 0:L.id)||"";if(!oe){F(0);return}const K=await hn(oe);F(Array.isArray(K)?K.length:0)}catch{}};return R(),U=setInterval(R,6e4),()=>{U&&clearInterval(U)}},[i.length,d==null?void 0:d.id]),x.useEffect(()=>{let U=null;const R=async()=>{try{const L=r(),oe=(L==null?void 0:L.id)||"";if(!oe){D(0);return}const xe=(await hr(oe,{ownerId:oe,limit:50,offset:0})).items.filter(W=>ta(W.capacity,W.attendees)).length;D(xe)}catch{}};return R(),U=setInterval(R,6e4),()=>{U&&clearInterval(U)}},[d==null?void 0:d.id]),x.useEffect(()=>{const U=()=>{try{const L=r(),oe=(L==null?void 0:L.id)||"";if(!oe){_(0);return}const xe=(Z.getState().parties||[]).filter(W=>Array.isArray(W==null?void 0:W.invites)&&W.invites.includes(oe)).length;_(xe)}catch{_(0)}};U();const R=setInterval(U,3e4);return()=>clearInterval(R)},[d==null?void 0:d.id]),x.useEffect(()=>{(async()=>{try{const U=await pl();j({adSenseClientId:U.adsenseClientId,adSlotBannerTop:U.adSlotBannerTop,adSlotInterstitial:U.adSlotInterstitial})}catch{}})()},[]),x.useEffect(()=>{try{const U=Qe.getState();U.seasonalAutoEnabled&&!U.activeSeasonalTheme&&U.autoApplySeasonal()}catch{}},[]),x.useEffect(()=>{async function U(R){try{h(!0),await ul(R,v||null),(await Ac(R)).forEach(K=>{try{const xe=kc(K.data);o(xe,!1)}catch{}});for(const K of i)await Bt(R,K);const oe=[];for(const K of i)try{const xe=await xl(R,K.id),W=xe.filter(H=>{var me;return(H.status||"").toLowerCase()==="active"&&((me=H==null?void 0:H.data)==null?void 0:me.id)}).map(H=>String(H.data.id));xe.filter(H=>{var me;return(H.status||"").toLowerCase()==="active"&&((me=H==null?void 0:H.data)==null?void 0:me.id)}).forEach(H=>{const me={...H.data,sticky:!0};oe.push(me)});const B=c(K.id),se=B.map(H=>H.id),z=Array.isArray(W)?W:[],V=Array.isArray(se)?se:[],ie=Array.from(new Set([...z,...V]));ie.join(",")!==(K.activeQuests||[]).join(",")&&n(K.id,{activeQuests:ie});const he=se.filter(H=>!W.includes(H));if(he.length>0){const H=new Map(B.map(me=>[me.id,me]));for(const me of he){const de=H.get(me);de&&await gl(R,K.id,de,"active")}}}catch{}try{const K=Z.getState().availableQuests||[],xe=new Map;for(const B of K)xe.set(String(B.id),B);for(const B of oe){const se=String(B.id);xe.has(se)||xe.set(se,B)}const W=Array.from(xe.values());Z.setState({availableQuests:W})}catch{}f(R),p({id:`sync-${Date.now()}`,type:"info",title:"SincronizaÃ§Ã£o concluÃ­da",message:"HerÃ³is e missÃµes ativos foram sincronizados com sua conta Supabase.",timeoutMs:4e3})}catch(L){p({id:`sync-error-${Date.now()}`,type:"error",title:"Falha ao sincronizar",message:(L==null?void 0:L.message)||"Verifique sua conexÃ£o e tente novamente.",timeoutMs:5e3})}finally{h(!1)}}w&&!E&&b!==w&&U(w)},[w]),x.useEffect(()=>{const U=L=>{L.preventDefault(),X(L),Y(!0);try{je.featureUsedData("system","pwa-install-available",{device:navigator.userAgent})}catch{}},R=()=>{try{je.featureUsedData("system","pwa-installed",{device:navigator.userAgent})}catch{}Y(!1),X(null)};return window.addEventListener("beforeinstallprompt",U),window.addEventListener("appinstalled",R),()=>{window.removeEventListener("beforeinstallprompt",U),window.removeEventListener("appinstalled",R)}},[]),x.useEffect(()=>ge.subscribe(R=>{p(R)}),[p]),x.useEffect(()=>{if(!d)return;const U=setInterval(()=>{var R;try{const L={...d,derivedAttributes:{...d.derivedAttributes},stats:{...d.stats}};try{(R=ut.updateVitals)==null||R.call(ut,L)}catch{}try{if(L.activePetId&&Array.isArray(L.pets)){const xe=L.pets.findIndex(W=>W.id===L.activePetId);if(xe>=0){const W={...L.pets[xe]},B=Math.min(100,Math.max(0,(W.energy||0)+5));if(B!==(W.energy||0)){W.energy=B;const se=[...L.pets];se[xe]=W,n(L.id,{pets:se})}}}}catch{}const oe=(Z.getState().heroes||[]).find(xe=>xe.id===L.id),K={...(oe==null?void 0:oe.stats)||{},lastActiveAt:L.stats.lastActiveAt};n(L.id,{derivedAttributes:L.derivedAttributes,stats:K})}catch{}},6e4);return()=>clearInterval(U)},[d==null?void 0:d.id]);const P=U=>a.pathname===U,M=U=>{const R=P(U),L=yt(Qe.getState().activeSeasonalTheme);return R?`px-2 py-1 rounded bg-gradient-to-r ${L} text-white font-semibold hover:brightness-110 transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`:"hover:text-amber-400 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 rounded"},C=({to:U,label:R,feature:L,testId:oe})=>{const{getSelectedHero:K}=Z(),xe=K();if(!L)return e.jsx($e,{to:U,className:M(U),"data-testid":oe,children:R});const W=Ba.getState().getGateStatus(L,xe);return W.enabled?e.jsx($e,{to:U,className:M(U),"data-testid":oe,children:R}):e.jsxs("span",{title:`${W.reason||"Bloqueado"} â€¢ ${W.nextHint||""}`,className:"opacity-60 cursor-not-allowed px-2 py-1 rounded",children:["ğŸ”’ ",R]})},A=()=>{var K;const{getSelectedHero:U}=Z(),R=U();if(!R)return e.jsx($e,{to:"/dungeon-infinita",className:M("/dungeon-infinita"),children:"ğŸ—ï¸ Dungeon Infinita"});const L=((K=R.rankData)==null?void 0:K.currentRank)||We.calculateRank(R);return["C","B","A","S","SS","SSS"].includes(L)?e.jsx($e,{to:"/dungeon-infinita",className:M("/dungeon-infinita"),children:"ğŸ—ï¸ Dungeon Infinita"}):e.jsx("span",{title:`Requer rank C â€¢ Rank atual ${L}`,className:"opacity-60 cursor-not-allowed px-2 py-1 rounded",children:"ğŸ”’ ğŸ—ï¸ Dungeon Infinita"})},O=U=>{const R=yt(Qe.getState().activeSeasonalTheme);return U?`px-2 py-1 rounded bg-gradient-to-r ${R} text-white font-semibold hover:brightness-110 transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`:"px-2 py-1 rounded hover:text-amber-400 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"},S=U=>U.some(R=>P(R)),I=N==="futurista"?"bg-gradient-to-br from-gray-900 via-cyan-900 to-black":N==="noir"?"bg-gradient-to-br from-black via-slate-900 to-black":"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900";return e.jsxs("div",{className:`min-h-screen ${I} text-white`,children:[e.jsx("header",{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 shadow-2xl shadow-amber-500/20",children:e.jsxs("div",{className:"container mx-auto px-3 md:px-4 py-3 md:py-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs($e,{to:"/journey",className:"text-xl md:text-2xl font-bold text-amber-400 font-serif focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 rounded",children:[et.icons.ui.guild," Forjador de HerÃ³is"]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[e.jsx(dl,{}),Q&&e.jsx("button",{onClick:async()=>{try{je.featureUsedData("system","pwa-install-click",{device:navigator.userAgent})}catch{}if(!$)return;const U=await $.prompt(),R=(U==null?void 0:U.outcome)||"dismissed";try{je.featureUsedData("system",R==="accepted"?"pwa-install-accepted":"pwa-install-dismissed",{device:navigator.userAgent})}catch{}Y(!1),X(null)},className:`px-2 py-1 rounded text-xs bg-gradient-to-r ${yt(Qe.getState().activeSeasonalTheme)} text-white hover:brightness-110`,title:"Instalar o app",children:"â¬‡ï¸ Instalar"}),!Q&&(()=>{const U=navigator.userAgent||"",R=/iPhone|iPad|iPod/i.test(U),L=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone;return R&&!L?e.jsxs("div",{className:"relative ml-2",children:[e.jsx("button",{onClick:()=>{J(oe=>!oe);try{je.featureUsedData("system","pwa-ios-tip-toggle",{open:!G})}catch{}},className:`px-2 py-1 rounded text-xs bg-gradient-to-r ${yt(Qe.getState().activeSeasonalTheme)} text-white hover:brightness-110`,title:"Como instalar no iOS",children:"ğŸ“± Instalar no iOS"}),G&&e.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-slate-800 border border-slate-600 rounded p-3 text-xs text-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Adicionar Ã  Tela de InÃ­cio"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:"1) Toque em Compartilhar"}),e.jsx("div",{children:"2) Selecione â€œAdicionar Ã  Tela de InÃ­cioâ€"}),e.jsx("div",{children:"3) Confirme â€œAdicionarâ€"})]}),e.jsx("button",{onClick:()=>{J(!1);try{je.featureUsed("system","pwa-ios-tip-close")}catch{}},className:"mt-2 px-2 py-1 bg-gray-700 rounded",children:"Fechar"})]})]}):null})(),e.jsxs("div",{className:"hidden md:flex items-center gap-2 ml-2",children:[e.jsx(C,{to:"/journey",label:"Jornada"}),e.jsx(C,{to:"/shop",label:"Loja",feature:"shop_basic"}),e.jsx(C,{to:"/premium",label:"Premium"})]})]}),d&&e.jsxs("div",{className:"hidden md:flex items-center space-x-3 bg-slate-800 border border-amber-400 px-4 py-2 rounded-lg",children:[e.jsx("span",{className:"text-2xl",children:d.avatar}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium flex items-center space-x-2",children:[e.jsx("span",{children:d.name}),(()=>{var L;const U=(L=d.stats)==null?void 0:L.profileMedal;return(U!=null&&U.expiresAt?Date.now()<new Date(U.expiresAt).getTime():!1)?e.jsxs("span",{className:"text-amber-400 text-xs flex items-center gap-1",children:[U.icon," ",U.name]}):null})(),d.activeTitle&&d.titles.find(U=>U.id===d.activeTitle)&&e.jsxs("span",{className:"text-amber-400 text-xs",children:[(ae=d.titles.find(U=>U.id===d.activeTitle))==null?void 0:ae.badge,(ne=d.titles.find(U=>U.id===d.activeTitle))==null?void 0:ne.name]})]}),e.jsxs("div",{className:"text-xs text-amber-600",children:[gn(d.class)," ",d.class," â€¢ NÃ­vel ",d.progression.level]})]})]})]}),!_t&&e.jsx("div",{className:"mt-3 bg-amber-900/30 border border-amber-500/40 text-amber-200 text-xs md:text-sm px-3 py-2 rounded",children:"Modo offline: configure `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY` para sincronizar."}),e.jsx("nav",{className:"mt-3 md:mt-4 overflow-visible",children:e.jsxs("div",{className:"flex w-full justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-3 md:gap-6 items-center flex-wrap overflow-visible",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ee(re==="aventura"?null:"aventura"),className:`${O(S(["/journey","/create","/gallery","/dungeon-infinita"]))} text-sm md:text-base`,children:"ğŸ§­ Aventura"}),re==="aventura"&&e.jsx("div",{className:"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2",children:e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:e.jsx(C,{to:"/journey",label:"ğŸ  InÃ­cio"})}),e.jsx("li",{children:e.jsxs($e,{to:(()=>{const U=new URLSearchParams(a.search),R=U.get("ref"),L=U.get("by");return R?`/create?ref=${R}${L?`&by=${L}`:""}`:"/create"})(),className:M("/create"),children:[et.icons.ui.profile," Criar HerÃ³i"]})}),e.jsx("li",{children:e.jsxs($e,{to:"/gallery",className:M("/gallery"),children:[et.icons.ui.inventory," Ver Galeria"]})}),e.jsx("li",{children:e.jsx(A,{})})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ee(re==="gestao"?null:"gestao"),className:`${O(S(["/inventory","/stable","/hero-forge"]))} text-sm md:text-base`,children:"ğŸ§° GestÃ£o"}),re==="gestao"&&e.jsx("div",{className:"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2",children:e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:e.jsx(C,{to:"/inventory",label:"ğŸ’ InventÃ¡rio",feature:"hunting_basic"})}),e.jsx("li",{children:e.jsx(C,{to:"/stable",label:"ğŸ´ EstÃ¡bulo",feature:"stable_basic"})}),e.jsx("li",{children:e.jsx(C,{to:"/hero-forge",label:"âš’ï¸ Forja",feature:"crafting_simple"})})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ee(re==="comunidade"?null:"comunidade"),className:`${O(S(["/guild-hub","/tavern"]))} text-sm md:text-base`,children:"ğŸ‘¥ Comunidade"}),re==="comunidade"&&e.jsx("div",{className:"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2",children:e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:e.jsx($e,{to:"/guild-hub",className:M("/guild-hub"),children:"ğŸ° Guilda dos Aventureiros"})}),e.jsx("li",{children:e.jsx($e,{to:"/tavern",className:M("/tavern"),children:"ğŸº Taverna"})})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ee(re==="conta"?null:"conta"),className:`${O(S(["/metrics"]))} text-sm md:text-base`,children:"ğŸ‘¤ Conta"}),re==="conta"&&e.jsx("div",{className:"absolute z-40 mt-2 w-56 bg-slate-800 border border-slate-600 rounded shadow-lg p-2",children:e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:e.jsx($e,{to:"/metrics",className:M("/metrics"),children:"ğŸ“Š MÃ©tricas"})}),!1]})})]})]}),g>=xn.length-1&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ee(re==="extras"?null:"extras"),className:`${O(S(["/leaderboards","/shop","/premium","/organizer","/events-history"]))} text-sm md:text-base`,children:"â­ Extras"}),re==="extras"&&e.jsx("div",{className:"absolute right-0 z-40 mt-2 w-64 bg-slate-800 border border-slate-600 rounded shadow-lg p-2",children:e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:e.jsx(C,{to:"/leaderboards",label:`${et.icons.ui.leaderboard} Ranking`})}),e.jsx("li",{children:e.jsx(C,{to:"/shop",label:"ğŸª Loja",feature:"shop_basic"})}),e.jsx("li",{children:e.jsx($e,{to:"/premium",className:M("/premium"),children:"âœ¨ Premium"})}),e.jsx("li",{children:e.jsxs($e,{to:te>0?"/organizer?nearFull=1":"/organizer",title:"Eventos quase lotados no seu painel",className:M("/organizer"),children:["ğŸ› ï¸ Organizador ",te>0&&e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] rounded bg-red-600 text-white",children:te})]})}),e.jsx("li",{children:e.jsx($e,{to:"/events-history",className:M("/events-history"),children:"ğŸ—‚ï¸ HistÃ³rico"})})]})})]})]})}),e.jsx(at.Suspense,{fallback:null,children:e.jsx(Il,{})})]})}),e.jsxs("main",{className:"container mx-auto py-6 md:py-8 px-3 md:px-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx(at.Suspense,{fallback:null,children:e.jsx(Rl,{style:{display:"block",minHeight:60}})})}),e.jsx(_i,{})]}),e.jsx(ol,{}),d&&s&&e.jsx(at.Suspense,{fallback:null,children:e.jsx(Ml,{hero:d})}),d&&e.jsx("button",{"aria-label":s?"Ocultar HUD":"Mostrar HUD",title:s?"Ocultar HUD":"Mostrar HUD",onClick:()=>t(U=>!U),className:`fixed bottom-[calc(1rem+var(--safe-bottom))] right-4 z-50 px-3 py-2 rounded-full shadow-lg transition-colors text-xs sm:text-sm md:text-base max-w-[80vw]
            ${s?"bg-gray-800 text-gray-200 hover:bg-gray-700":"bg-amber-600 text-white hover:bg-amber-700"} focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`,children:s?"Ocultar Painel":"Mostrar Painel"}),e.jsx(Ec,{notifications:m,onRemove:u}),e.jsx(at.Suspense,{fallback:null,children:e.jsx(El,{})}),e.jsx("footer",{className:"bg-gray-800 py-6 mt-10 md:mt-12",children:e.jsx("div",{className:"container mx-auto px-3 md:px-4 text-center text-gray-400 text-sm md:text-base",children:e.jsxs("p",{children:["Â© ",new Date().getFullYear()," Forjador de HerÃ³is - Criado com React, TypeScript e Zustand"]})})}),e.jsx(at.Suspense,{fallback:null,children:e.jsx(Pl,{})})]})},yn="hero-forge-image-cache-v2";function jn(){try{const a=localStorage.getItem(yn);if(!a)return{};const s=JSON.parse(a);return s&&typeof s=="object"?s:{}}catch{return{}}}function wn(a){try{localStorage.setItem(yn,JSON.stringify(a))}catch{}}function Nn(a){const s=jn(),t=s[a];if(!t)return null;if(Date.now()>t.expiresAt)return delete s[a],wn(s),null;const r=t.url||"";return typeof r=="string"&&r.includes("pollinations.ai")?`/api/pollinations-image?prompt=${encodeURIComponent(a)}&width=512&height=512`:r}function Sn(a,s,t,r){if(typeof s!="string"||s.startsWith("data:"))return;const i=jn();i[a]={url:s,expiresAt:Date.now()+Math.max(t,6e4),source:r||"other"},wn(i)}const ui={guerreiro:e.jsx(ms,{className:"w-4 h-4"}),mago:e.jsx(Br,{className:"w-4 h-4"}),ladino:e.jsx(Or,{className:"w-4 h-4"}),clerigo:e.jsx(Is,{className:"w-4 h-4"}),patrulheiro:e.jsx(hs,{className:"w-4 h-4"}),paladino:e.jsx(us,{className:"w-4 h-4"}),arqueiro:e.jsx(hs,{className:"w-4 h-4"}),bardo:e.jsx(Cs,{className:"w-4 h-4"}),monge:e.jsx(Is,{className:"w-4 h-4"}),assassino:e.jsx(Or,{className:"w-4 h-4"}),barbaro:e.jsx(ms,{className:"w-4 h-4"}),lanceiro:e.jsx(ms,{className:"w-4 h-4"}),druida:e.jsx(Is,{className:"w-4 h-4"}),feiticeiro:e.jsx(Br,{className:"w-4 h-4"})},pi={fire:"from-red-900/20 via-orange-800/30 to-yellow-700/20",water:"from-blue-900/20 via-cyan-800/30 to-blue-700/20",earth:"from-green-900/20 via-stone-800/30 to-green-700/20",air:"from-slate-900/20 via-sky-800/30 to-slate-700/20",thunder:"from-purple-900/20 via-yellow-800/30 to-blue-700/20",light:"from-yellow-900/20 via-white/30 to-yellow-700/20",dark:"from-purple-900/20 via-gray-800/30 to-black/20",physical:"from-gray-900/20 via-slate-800/30 to-gray-700/20"},Dl={fire:"border-red-500/50 shadow-red-500/20",water:"border-blue-500/50 shadow-blue-500/20",earth:"border-green-500/50 shadow-green-500/20",air:"border-sky-500/50 shadow-sky-500/20",thunder:"border-yellow-500/50 shadow-yellow-500/20",light:"border-yellow-400/50 shadow-yellow-400/20",dark:"border-purple-500/50 shadow-purple-500/20",physical:"border-gray-500/50 shadow-gray-500/20"},$l=({hero:a,onClick:s,showDetails:t=!0,size:r="medium",onEdit:i,onImageChange:n,onDelete:o,index:c})=>{var te,D,$,X,Q,Y;const[l,d]=x.useState(!1),[m,u]=x.useState(!1),{selectHero:p,getSelectedHero:g,updateHero:v}=Z(),y=g(),w=a.origin==="npc",k=Pa(G=>({rm:G.reducedMotionEnabled,sd:G.saveDataEnabled,net:G.networkEffectiveType})),E=!k.rm&&!k.sd&&(k.net==="4g"||k.net==="unknown"),h=(y==null?void 0:y.id)===a.id,b=Ui(a.element),f={small:"w-full max-w-[12rem] sm:max-w-[12rem] md:max-w-[14rem] aspect-[4/5]",medium:"w-full max-w-[14rem] md:max-w-[16rem] aspect-[4/5]",large:"w-full max-w-[16rem] lg:max-w-[18rem] aspect-[4/5]"},j=()=>{w||(p(a.id),s==null||s())},N=x.useMemo(()=>{const G=a.image||"";if(!(G.includes("image.pollinations.ai/prompt/")||G.includes("/api/pollinations-image?prompt=")))return G;const re=(()=>{try{if(G.includes("image.pollinations.ai/prompt/")){const ee=G.split("image.pollinations.ai/prompt/")[1];return decodeURIComponent(ee.split("?")[0]||"")}if(G.includes("/api/pollinations-image?prompt=")){const ee=new URL(G,window.location.origin);return decodeURIComponent(ee.searchParams.get("prompt")||"")}}catch{}return""})();if(re){const ee=Nn(re);return ee||`/api/pollinations-image?prompt=${encodeURIComponent(re)}&width=512&height=512`}return G},[a.image]),T=()=>{try{const G=a.image||"";if(!(G.includes("image.pollinations.ai/prompt/")||G.includes("/api/pollinations-image?prompt=")))return;const re=(()=>{try{if(G.includes("image.pollinations.ai/prompt/")){const ee=G.split("image.pollinations.ai/prompt/")[1];return decodeURIComponent(ee.split("?")[0]||"")}if(G.includes("/api/pollinations-image?prompt=")){const ee=new URL(G,window.location.origin);return decodeURIComponent(ee.searchParams.get("prompt")||"")}}catch{}return""})();re&&Sn(re,N,864e5,"pollinations")}catch{}};x.useEffect(()=>{m&&(async()=>{try{const G=a.image||"";let J="";if(G.includes("image.pollinations.ai/prompt/"))try{J=decodeURIComponent(G.split("image.pollinations.ai/prompt/")[1].split("?")[0]||"")}catch{}else if(G.includes("/api/pollinations-image?prompt="))try{const ee=new URL(G,window.location.origin);J=decodeURIComponent(ee.searchParams.get("prompt")||"")}catch{}if(!J){const ee=a.gender==="feminino"?"female":"male";J=`${a.name||"Hero"}, ${ee} ${a.race} ${a.class}, epic fantasy portrait, detailed, studio lighting`}const re=await fetch("/api/gerar-imagem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:J})});if(re.ok){const ee=await re.json(),fe=(ee==null?void 0:ee.imagem)||"";fe&&v(a.id,{image:fe})}}catch{}})()},[m]);const F=x.useMemo(()=>{try{const G=a.image||"";if(!(G.includes("image.pollinations.ai/prompt/")||G.includes("/api/pollinations-image?prompt=")))return;const re=(()=>{try{if(G.includes("image.pollinations.ai/prompt/")){const P=G.split("image.pollinations.ai/prompt/")[1];return decodeURIComponent(P.split("?")[0]||"")}if(G.includes("/api/pollinations-image?prompt=")){const P=new URL(G,window.location.origin);return decodeURIComponent(P.searchParams.get("prompt")||"")}}catch{}return""})();if(!re)return;const ee=`/api/pollinations-image?prompt=${encodeURIComponent(re)}&width=256&height=256`,fe=`/api/pollinations-image?prompt=${encodeURIComponent(re)}&width=384&height=384`,_=`/api/pollinations-image?prompt=${encodeURIComponent(re)}&width=512&height=512`;return`${ee} 256w, ${fe} 384w, ${_} 512w`}catch{return}},[a.image]);return e.jsxs("div",{className:`
        ${f[r]}
        relative group cursor-pointer
        transform transition-all duration-300 ease-out
        ${l&&E?"scale-105 -translate-y-2":""}
        ${h?"ring-2 ring-yellow-400 ring-opacity-60":""}
        ${(()=>{const G=(a.mounts||[]).find(J=>J.id===a.activeMountId);return(G==null?void 0:G.stage)==="lendaria"?"shadow-[0_0_15px_#F59E0B] ring-2 ring-amber-400":(G==null?void 0:G.stage)==="encantada"?"shadow-[0_0_10px_#8B5CF6] ring-2 ring-purple-400/60":""})()}
      `,style:{contentVisibility:"auto",containIntrinsicSize:"320px 400px",willChange:"transform"},onMouseEnter:()=>{d(!0);try{wt(()=>import("./HeroDetail-78e4bc53.js"),["assets/HeroDetail-78e4bc53.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])}catch{}},onFocus:()=>{d(!0);try{wt(()=>import("./HeroDetail-78e4bc53.js"),["assets/HeroDetail-78e4bc53.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])}catch{}},onMouseLeave:()=>d(!1),onBlur:()=>d(!1),onClick:j,role:"button","aria-roledescription":"CartÃ£o de herÃ³i","aria-label":`Abrir detalhes de ${a.name}`,"aria-selected":h,tabIndex:0,"data-hero-card":"1","data-hero-id":a.id,"data-index":typeof c=="number"?c:void 0,onKeyDown:G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),j())},children:[e.jsxs("div",{className:`
        absolute inset-0 rounded-lg
        bg-gradient-to-br from-yellow-600/20 via-amber-700/30 to-yellow-800/20
        border-2 ${Dl[a.element]}
        shadow-lg ${l?"shadow-xl shadow-yellow-500/30":""}
        transition-all duration-300
      `,children:[e.jsx("div",{className:"absolute top-2 left-2 text-yellow-400/60 text-xs",children:"âšœ"}),e.jsx("div",{className:"absolute top-2 right-2 text-yellow-400/60 text-xs",children:"âšœ"}),e.jsx("div",{className:"absolute bottom-2 left-2 text-yellow-400/60 text-xs",children:"âšœ"}),e.jsx("div",{className:"absolute bottom-2 right-2 text-yellow-400/60 text-xs",children:"âšœ"})]}),e.jsxs("div",{className:`
        absolute inset-1 rounded-md
        bg-gradient-to-br ${pi[a.element]}
        backdrop-blur-sm
      `,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-50/10 via-yellow-100/5 to-amber-200/10 rounded-md"}),l&&E&&e.jsxs("div",{className:"absolute inset-0 overflow-hidden rounded-md",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-1 h-1 bg-yellow-400 rounded-full animate-pulse opacity-60"}),e.jsx("div",{className:"absolute top-1/3 right-1/3 w-1 h-1 bg-yellow-400 rounded-full animate-pulse opacity-40 animation-delay-300"}),e.jsx("div",{className:"absolute bottom-1/4 left-1/3 w-1 h-1 bg-yellow-400 rounded-full animate-pulse opacity-50 animation-delay-600"})]})]}),e.jsx("div",{className:"relative h-3/4 p-3",children:e.jsxs("div",{className:"relative h-full rounded-md overflow-hidden",children:[a.image&&!m?e.jsx("img",{src:N,srcSet:F,alt:`${a.name} â€” ${a.class} â€¢ ${a.race}`,className:"w-full h-full object-cover",loading:"lazy",decoding:"async",width:640,height:800,sizes:"(min-width: 1280px) 18rem, (min-width: 768px) 16rem, 14rem",onLoad:T,onError:()=>u(!0)}):e.jsx("div",{className:`
              w-full h-full flex items-center justify-center
              bg-gradient-to-br ${pi[a.element]}
              text-4xl sm:text-6xl
            `,children:ui[a.class]||"ğŸ¦¸"}),e.jsx("div",{className:`
            absolute inset-0 
            bg-gradient-to-t from-transparent via-transparent to-yellow-400/10
            ${l&&E?"opacity-100":"opacity-0"}
            transition-opacity duration-300
          `}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-sm rounded-full px-2 py-1 text-xs text-yellow-400 font-bold",children:[Ms(((te=a==null?void 0:a.rankData)==null?void 0:te.currentRank)||"F")," ",((D=a==null?void 0:a.rankData)==null?void 0:D.currentRank)||"F"]})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-sm rounded-full px-2 py-1 text-xs text-white font-bold",children:["Nv. ",(($=a.progression)==null?void 0:$.level)||1]})})]})}),e.jsx("div",{className:"absolute bottom-2 left-2 right-2 h-1/3 z-40",children:e.jsxs("div",{className:"h-full bg-black/80 backdrop-blur-md rounded-md border border-yellow-500/30 p-3 flex flex-col justify-between shadow-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("h3",{className:"text-white font-bold text-lg truncate font-serif leading-tight drop-shadow-lg",style:{textShadow:"2px 2px 4px rgba(0,0,0,1)"},children:a.name||"Nome nÃ£o definido"})}),e.jsxs("div",{className:"flex flex-col space-y-1 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300",children:[e.jsxs("div",{className:"flex items-center space-x-1 min-w-0 flex-1",children:[ui[a.class]??e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize truncate",children:a.class})]}),e.jsx("div",{className:"flex items-center space-x-1 ml-2",children:e.jsx("span",{className:"text-base",children:(b==null?void 0:b.icon)||"âš¡"})})]}),(a.activePetId||a.activeMountId)&&e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-300",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.activePetId&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-emerald-700/40 border border-emerald-600/50 text-emerald-200",children:["ğŸ¾ ",((X=(a.pets||[]).find(G=>G.id===a.activePetId))==null?void 0:X.name)||"Mascote"]}),a.activeMountId&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-purple-700/40 border border-purple-600/50 text-purple-200",children:["ğŸ‡ ",((Q=(a.mounts||[]).find(G=>G.id===a.activeMountId))==null?void 0:Q.stage)||"Montaria"," ",(()=>{const G=(a.mounts||[]).find(re=>re.id===a.activeMountId),J=G==null?void 0:G.rarity;return J==="lendario"?"ğŸ‘‘":J==="epico"?"âœ¨":J==="raro"?"ğŸ”·":J==="incomum"?"ğŸŸ©":J==="comum"?"âšª":""})()]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-400",children:[e.jsx("span",{className:"capitalize truncate",children:a.race}),e.jsxs("span",{className:"text-sm whitespace-nowrap",children:[((Y=a.progression)==null?void 0:Y.xp)||0," XP"]})]})]})]})}),t&&l&&!w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 rounded-lg z-50",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("button",{onClick:G=>{G.stopPropagation(),s==null||s()},className:"bg-yellow-600 hover:bg-yellow-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-yellow-300","aria-label":"Ver detalhes",children:[e.jsx(Zn,{className:"w-3 h-3"}),e.jsx("span",{children:"Ver Detalhes"})]}),i&&e.jsxs("button",{onClick:G=>{G.stopPropagation(),i(a)},className:"bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300","aria-label":"Editar herÃ³i",children:[e.jsx(eo,{className:"w-3 h-3"}),e.jsx("span",{children:"Editar"})]}),n&&e.jsxs("button",{onClick:G=>{G.stopPropagation(),n(a)},className:"bg-purple-600 hover:bg-purple-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-300","aria-label":"Trocar foto",children:[e.jsx(to,{className:"w-3 h-3"}),e.jsx("span",{children:"Trocar Foto"})]}),o&&e.jsx("button",{onClick:G=>{G.stopPropagation(),o()},className:"bg-red-600 hover:bg-red-500 text-white px-3 py-2 rounded-md font-bold text-xs transition-colors duration-200 flex items-center space-x-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-300","aria-label":"Remover herÃ³i",children:e.jsx("span",{children:"Remover"})})]})}),h&&e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx("div",{className:"bg-yellow-500 text-white rounded-full p-1",children:e.jsx(Cs,{className:"w-4 h-4 fill-current"})})})]})},_l=at.lazy(()=>wt(()=>import("./GalleryLightbox-41f59662.js"),["assets/GalleryLightbox-41f59662.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/icons-5fe8db7b.js"])),ql=({onCreateHero:a,onHeroSelect:s,onHeroEdit:t,onHeroImageChange:r,showCreateButton:i=!0,cardSize:n="medium",viewMode:o="grid"})=>{const c=Z(H=>H.heroes);Z(H=>H.createHero);const l=Z(H=>H.deleteHero),d=Z(H=>H.getSelectedHero),m=Z(H=>H.purchaseHeroSlotForSelected),[u,p]=x.useState(""),[g,v]=x.useState(""),[y,w]=x.useState("all"),[k,E]=x.useState("all"),[h,b]=x.useState("all"),[f,j]=x.useState(o),[N,T]=x.useState(!1),[F,te]=x.useState("name"),[D,$]=x.useState("asc"),[X,Q]=x.useState(null),[Y,G]=x.useState(null),[J,re]=x.useState(""),[ee,fe]=x.useState(!1),_=x.useRef(0),P=x.useRef(null),[M,C]=Xn(),[A,O]=x.useState(null),[S,I]=x.useState(!1),ae=x.useMemo(()=>c.filter(H=>H.origin!=="npc"),[c]),ne=x.useMemo(()=>js(ae),[ae]),U=x.useMemo(()=>ys(ae),[ae]),R=ne<U,L=x.useMemo(()=>Sr(),[c]),oe=x.useMemo(()=>Array.from(new Set(c.map(H=>H.race))).sort(),[c]),K=x.useMemo(()=>c.filter(H=>{if(H.origin==="npc")return!1;const me=g.toLowerCase(),de=H.name.toLowerCase().includes(me)||H.class.toLowerCase().includes(me)||H.race.toLowerCase().includes(me),ve=y==="all"||H.class===y,Ae=k==="all"||H.element===k,Te=h==="all"||H.race===h;return de&&ve&&Ae&&Te}),[c,g,y,k,h]),xe=x.useMemo(()=>{const H=[...K];return H.sort((me,de)=>{var Ae,Te,qe,Oe,it,nt,Xe,we;let ve=0;switch(F){case"name":ve=me.name.localeCompare(de.name);break;case"level":ve=(((Ae=me.progression)==null?void 0:Ae.level)||0)-(((Te=de.progression)==null?void 0:Te.level)||0);break;case"rank":ve=(((qe=me.progression)==null?void 0:qe.rank)||"F").localeCompare(((Oe=de.progression)==null?void 0:Oe.rank)||"F");break;case"createdAt":ve=new Date(me.createdAt||0).getTime()-new Date(de.createdAt||0).getTime();break;case"xp":ve=(((it=me.progression)==null?void 0:it.xp)||0)-(((nt=de.progression)==null?void 0:nt.xp)||0);break;case"gold":ve=(((Xe=me.progression)==null?void 0:Xe.gold)||0)-(((we=de.progression)==null?void 0:we.gold)||0);break;default:ve=0}return D==="asc"?ve:-ve}),H},[K,F,D]);x.useEffect(()=>{const H=setTimeout(()=>v(u),200);return()=>clearTimeout(H)},[u]),x.useEffect(()=>{try{const H=Object.fromEntries(M),me=nt=>typeof H[nt]=="string"?H[nt]:void 0,de=me("vm");de&&j(de);const ve=me("sb");ve&&te(ve);const Ae=me("so");Ae&&$(Ae);const Te=me("sc");Te&&w(Te);const qe=me("se");qe&&E(qe);const Oe=me("sr");Oe&&b(Oe);const it=me("q");if(it&&p(it),!de&&!ve&&!Ae&&!Te&&!qe&&!Oe&&!it){const nt=localStorage.getItem("gallery_prefs");if(nt){const Xe=JSON.parse(nt);Xe&&typeof Xe=="object"&&(typeof Xe.viewMode=="string"&&j(Xe.viewMode),typeof Xe.sortBy=="string"&&te(Xe.sortBy),typeof Xe.sortOrder=="string"&&$(Xe.sortOrder),typeof Xe.selectedClass=="string"&&w(Xe.selectedClass),typeof Xe.selectedElement=="string"&&E(Xe.selectedElement),typeof Xe.selectedRace=="string"&&b(Xe.selectedRace),typeof Xe.searchTerm=="string"&&p(Xe.searchTerm))}}}catch{}},[]),x.useEffect(()=>{try{const H={viewMode:f,sortBy:F,sortOrder:D,selectedClass:y,selectedElement:k,selectedRace:h,searchTerm:u};localStorage.setItem("gallery_prefs",JSON.stringify(H))}catch{}},[f,F,D,y,k,h,u]),x.useEffect(()=>{try{const H={};H.vm=String(f),H.sb=String(F),H.so=String(D),y!=="all"&&(H.sc=String(y)),k!=="all"&&(H.se=String(k)),h!=="all"&&(H.sr=String(h)),u&&(H.q=String(u)),C(H,{replace:!0})}catch{}},[f,F,D,y,k,h,u]),x.useEffect(()=>{const H=_.current,me=Math.min(xe.length,H+24);for(let de=H;de<me;de++){const ve=xe[de];if(ve!=null&&ve.image)try{const Ae=ve.image,Te=Ae.includes("image.pollinations.ai/prompt/")?Ae.replace("https://image.pollinations.ai/prompt/","/api/pollinations-image?prompt=").replace("?n=1&","&"):Ae,qe=new Image;qe.loading="lazy",qe.decoding="async",qe.src=Te}catch{}}_.current=me},[xe]);const W=x.useCallback(H=>{const me=xe.findIndex(de=>de.id===H.id);Q(me>=0?me:null),s==null||s(H)},[xe,s]),B=x.useCallback(H=>{try{const de=`${H.gender==="feminino"?"female, woman, heroine, feminine features, soft face, long hair, no beard":"male, man, masculine features"}, ${H.race} ${H.class}, ${H.name}, epic fantasy portrait, highly detailed, studio lighting`,ve=(H.backstory||"").slice(0,140),Ae=ve?`${de}, theme: ${ve}`:de;G(H),re(Ae)}catch{G(H),re(`${H.name}, ${H.race} ${H.class}, epic fantasy portrait`)}},[]),se=x.useCallback(async()=>{var H,me,de,ve;if(Y){fe(!0);try{const Ae=await fetch("/api/gerar-imagem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:J})});if(!Ae.ok)throw new Error(`HTTP ${Ae.status}`);const Te=await Ae.json(),qe=(Te==null?void 0:Te.imagem)||"";qe&&(Z.getState().updateHero(Y.id,{image:qe}),(me=(H=window.notificationBus)==null?void 0:H.emit)==null||me.call(H,{type:"item",title:"Avatar atualizado",message:"Imagem gerada com novo prompt.",icon:"ğŸ–¼ï¸",duration:2500}),G(null))}catch(Ae){(ve=(de=window.notificationBus)==null?void 0:de.emit)==null||ve.call(de,{type:"quest",title:"Falha ao gerar imagem",message:String((Ae==null?void 0:Ae.message)||Ae||"Erro"),icon:"âš ï¸",duration:3500})}finally{fe(!1)}}},[Y,J]),z=x.useCallback(()=>{const H=d==null?void 0:d();H&&l(H.id)},[d,l]),V={small:"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",medium:"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",large:"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"},ie=H=>{var me;try{const de=Array.from(document.querySelectorAll('[data-hero-card="1"]'));if(!de.length)return;const ve=document.activeElement;let Ae=de.findIndex(qe=>qe===ve);Ae===-1&&(Ae=0);const Te=Math.max(0,Math.min(de.length-1,Ae+H));(me=de[Te])==null||me.focus()}catch{}},he=H=>{var me,de;if(H.key==="ArrowRight")H.preventDefault(),ie(1);else if(H.key==="ArrowLeft")H.preventDefault(),ie(-1);else if(H.key==="Enter"){const ve=document.activeElement;ve==null||ve.click()}else H.key==="Escape"?Q(null):H.key.toLowerCase()==="f"?T(ve=>!ve):H.key.toLowerCase()==="v"?j(ve=>ve==="grid"?"list":"grid"):H.key==="Home"?(H.preventDefault(),ie(-9999)):H.key==="End"?(H.preventDefault(),ie(9999)):H.key==="PageDown"?(me=window.scrollBy)==null||me.call(window,{top:window.innerHeight,behavior:"smooth"}):H.key==="PageUp"&&((de=window.scrollBy)==null||de.call(window,{top:-window.innerHeight,behavior:"smooth"}))};return e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-900/20 to-yellow-800/20 backdrop-blur-sm rounded-lg border border-yellow-500/30 p-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 font-serif",children:"Galeria de HerÃ³is"}),e.jsxs("span",{className:"bg-yellow-600/20 text-yellow-300 px-3 py-1 rounded-full text-sm",role:"status","aria-live":"polite","aria-atomic":"true",children:[xe.length," ",xe.length===1?"herÃ³i":"herÃ³is"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ao,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar herÃ³is...",value:u,onChange:H=>p(H.target.value),className:"pl-10 pr-4 py-2 bg-black/30 border border-yellow-500/30 rounded-md text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400 w-40 sm:w-64"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Lr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsxs("select",{"aria-label":"Ordenar por",value:F,onChange:H=>te(H.target.value),className:"pl-10 pr-8 py-2 bg-black/30 border border-yellow-500/30 rounded-md text-white focus:outline-none focus:border-yellow-400",children:[e.jsx("option",{value:"name",children:"Nome"}),e.jsx("option",{value:"level",children:"NÃ­vel"}),e.jsx("option",{value:"rank",children:"Rank"}),e.jsx("option",{value:"createdAt",children:"Criado"}),e.jsx("option",{value:"xp",children:"XP"}),e.jsx("option",{value:"gold",children:"Ouro"})]})]}),e.jsx("button",{"aria-label":"Alternar ordem",onClick:()=>$(H=>H==="asc"?"desc":"asc"),className:`p-2 rounded-md border transition-colors ${D==="asc"?"bg-black/30 text-yellow-400 hover:bg-yellow-600/20":"bg-yellow-600 text-white"}`,children:e.jsx(Lr,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>T(!N),className:`p-2 rounded-md border transition-colors ${N?"bg-yellow-600 border-yellow-500 text-white":"bg-black/30 border-yellow-500/30 text-yellow-400 hover:bg-yellow-600/20"}`,children:e.jsx(so,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex border border-yellow-500/30 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>j("grid"),className:`p-2 transition-colors ${f==="grid"?"bg-yellow-600 text-white":"bg-black/30 text-yellow-400 hover:bg-yellow-600/20"}`,children:e.jsx(ro,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j("list"),className:`p-2 transition-colors ${f==="list"?"bg-yellow-600 text-white":"bg-black/30 text-yellow-400 hover:bg-yellow-600/20"}`,children:e.jsx(io,{className:"w-4 h-4"})})]}),i&&e.jsxs("button",{onClick:a,disabled:!R,className:`${R?"bg-yellow-600 hover:bg-yellow-500 text-white":"bg-gray-700 text-gray-300 cursor-not-allowed"} px-3 sm:px-4 py-2 rounded-md font-bold transition-colors flex items-center gap-2 text-sm sm:text-base w-full sm:w-auto`,children:[e.jsx(Hr,{className:"w-4 h-4"}),e.jsx("span",{children:R?"Criar HerÃ³i":`Slots ${ne}/${U}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-1 rounded bg-black/30 border border-yellow-500/30 text-yellow-300 text-xs",children:["Slots ",ne,"/",U]}),e.jsxs("button",{onClick:()=>m(),className:"px-3 py-2 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm",children:["Comprar slot (",L,")"]})]}),e.jsxs("button",{onClick:z,className:"bg-red-600 hover:bg-red-500 text-white px-3 py-2 rounded-md font-bold transition-colors text-sm flex items-center gap-2",children:[e.jsx(no,{className:"w-4 h-4"}),"Remover Selecionado"]})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[u&&e.jsxs("button",{onClick:()=>p(""),className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:['Busca: "',u,'" âœ•']}),y!=="all"&&e.jsxs("button",{onClick:()=>w("all"),className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:["Classe: ",y," âœ•"]}),k!=="all"&&e.jsxs("button",{onClick:()=>E("all"),className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:["Elemento: ",k," âœ•"]}),h!=="all"&&e.jsxs("button",{onClick:()=>b("all"),className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:["RaÃ§a: ",h," âœ•"]})]}),N&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-yellow-500/30",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-yellow-300 mb-2",children:"Classe"}),e.jsxs("select",{value:y,onChange:H=>w(H.target.value),className:"w-full bg-black/30 border border-yellow-500/30 rounded-md text-white p-2 focus:outline-none focus:border-yellow-400",children:[e.jsx("option",{value:"all",children:"Todas as Classes"}),e.jsx("option",{value:"guerreiro",children:"Guerreiro"}),e.jsx("option",{value:"mago",children:"Mago"}),e.jsx("option",{value:"ladino",children:"Ladino"}),e.jsx("option",{value:"clerigo",children:"ClÃ©rigo"}),e.jsx("option",{value:"patrulheiro",children:"Patrulheiro"}),e.jsx("option",{value:"paladino",children:"Paladino"}),e.jsx("option",{value:"arqueiro",children:"Arqueiro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-yellow-300 mb-2",children:"Elemento"}),e.jsxs("select",{value:k,onChange:H=>E(H.target.value),className:"w-full bg-black/30 border border-yellow-500/30 rounded-md text-white p-2 focus:outline-none focus:border-yellow-400",children:[e.jsx("option",{value:"all",children:"Todos os Elementos"}),e.jsx("option",{value:"fire",children:"ğŸ”¥ Fogo"}),e.jsx("option",{value:"ice",children:"â„ï¸ Gelo"}),e.jsx("option",{value:"thunder",children:"âš¡ Raio"}),e.jsx("option",{value:"earth",children:"ğŸŒ Terra"}),e.jsx("option",{value:"light",children:"âœ¨ Luz"}),e.jsx("option",{value:"dark",children:"ğŸŒ‘ Sombra"}),e.jsx("option",{value:"physical",children:"âš”ï¸ FÃ­sico"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-yellow-300 mb-2",children:"RaÃ§a"}),e.jsxs("select",{value:h,onChange:H=>b(H.target.value),className:"w-full bg-black/30 border border-yellow-500/30 rounded-md text-white p-2 focus:outline-none focus:border-yellow-400",children:[e.jsx("option",{value:"all",children:"Todas as RaÃ§as"}),oe.map(H=>e.jsx("option",{value:H,children:H},H))]})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-2",children:e.jsx("button",{onClick:()=>{p(""),w("all"),E("all"),b("all")},className:"px-3 py-2 rounded bg-gray-700 text-white text-xs","aria-label":"Resetar filtros",children:"Resetar filtros"})})]})]}),xe.length>0?e.jsx("div",{ref:P,className:`${f==="grid"?`grid ${V[n]} gap-4 sm:gap-6`:"flex flex-col space-y-4"}`,role:"list","aria-label":"Galeria de HerÃ³is",onKeyDown:he,children:xe.map((H,me)=>e.jsx($l,{hero:H,onClick:()=>W(H),size:f==="list"?"small":n,showDetails:!0,onEdit:t,onImageChange:B,onDelete:()=>O(H.id),index:me},H.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl sm:text-6xl mb-4",children:"ğŸ¦¸"}),e.jsx("h3",{className:"text-xl font-bold text-yellow-400 mb-2",children:"Nenhum herÃ³i encontrado"}),e.jsx("p",{className:"text-gray-400 mb-6",children:u||y!=="all"||k!=="all"?"Tente ajustar os filtros de busca.":"VocÃª ainda nÃ£o criou nenhum herÃ³i."}),i&&e.jsxs("button",{onClick:a,className:"bg-yellow-600 hover:bg-yellow-500 text-white px-6 py-3 rounded-md font-bold transition-colors flex items-center space-x-2 mx-auto",children:[e.jsx(Hr,{className:"w-5 h-5"}),e.jsx("span",{children:"Criar Primeiro HerÃ³i"})]})]}),X!==null&&e.jsx(at.Suspense,{fallback:null,children:e.jsx(_l,{items:xe,index:X,onClose:()=>Q(null),onNavigate:H=>Q(Math.max(0,Math.min(H,xe.length-1)))})}),A&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-yellow-500/30 bg-black/80 p-5 text-white",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Confirmar ExclusÃ£o"}),e.jsx("div",{className:"text-sm text-gray-300",children:"Tem certeza que deseja remover este herÃ³i da galeria?"}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{"aria-busy":S,onClick:()=>{I(!0),setTimeout(()=>{var H,me;try{l(A),(me=(H=window.notificationBus)==null?void 0:H.emit)==null||me.call(H,{type:"item",title:"HerÃ³i removido",message:"Personagem excluÃ­do da galeria.",icon:"ğŸ—‘ï¸",duration:2500})}catch{}I(!1),O(null)},600)},className:`px-3 py-2 rounded ${S?"bg-gray-700 cursor-wait":"bg-red-600 hover:bg-red-500"} text-white`,children:S?"Excluindoâ€¦":"Confirmar"}),e.jsx("button",{onClick:()=>O(null),className:"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white",children:"Cancelar"})]})]})}),Y&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"w-full max-w-lg rounded-xl border border-yellow-500/30 bg-black/80 p-5 text-white",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Editar Prompt de Imagem"}),e.jsxs("div",{className:"text-sm text-gray-300 mb-3",children:["HerÃ³i: ",Y.name," â€” ",Y.race," ",Y.class]}),e.jsx("textarea",{value:J,onChange:H=>re(H.target.value),rows:4,className:"w-full rounded-md bg-gray-700 border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Escreva o prompt para gerar o avatar"}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:se,disabled:ee||!J.trim(),className:`px-3 py-2 rounded ${ee?"bg-gray-700 cursor-wait":"bg-purple-600 hover:bg-purple-500"} text-white`,children:ee?"Gerandoâ€¦":"Gerar"}),e.jsx("button",{onClick:()=>G(null),className:"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white",children:"Cancelar"}),e.jsxs("label",{className:"px-3 py-2 rounded bg-green-600 hover:bg-green-500 text-white cursor-pointer",children:["Upload Foto",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async H=>{var me;try{const de=(me=H.target.files)==null?void 0:me[0];if(!de)return;const ve=new FileReader;ve.onload=()=>{var Te,qe;const Ae=String(ve.result||"");Z.getState().updateHero(Y.id,{image:Ae}),(qe=(Te=window.notificationBus)==null?void 0:Te.emit)==null||qe.call(Te,{type:"item",title:"Foto carregada",message:"Imagem do herÃ³i atualizada.",icon:"ğŸ–¼ï¸",duration:2500})},ve.readAsDataURL(de)}catch{}}})]}),e.jsx("button",{onClick:()=>{const H="epic medieval fantasy hero-smith, male character, standing in a mystical forge, glowing magic hammer, runic leather armor, long dark cloak with gold details, blue particles around, cinematic lighting, ultra-detailed, high fantasy, dramatic atmosphere, sharp textures",me=`${(Y==null?void 0:Y.name)||""}, ${(Y==null?void 0:Y.race)||""} ${(Y==null?void 0:Y.class)||""}`.trim();re(`${me?me+", ":""}${H}`)},className:"px-3 py-2 rounded bg-amber-600 hover:bg-amber-500 text-white",children:"Template Lexica (Masculino)"}),e.jsx("button",{onClick:()=>{const H="epic medieval fantasy hero-smith, female character, in an ancient enchanted forge, glowing magical hammer or staff, runic armor with silver details, flowing cloak, mystical particles, soft ethereal light, ultra-detailed, high fantasy, elegant and powerful",me=`${(Y==null?void 0:Y.name)||""}, ${(Y==null?void 0:Y.race)||""} ${(Y==null?void 0:Y.class)||""}`.trim();re(`${me?me+", ":""}${H}`)},className:"px-3 py-2 rounded bg-pink-600 hover:bg-pink-500 text-white",children:"Template Lexica (Feminino)"})]})]})})]})};class Er extends at.Component{constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,t){console.warn("[ErrorBoundary]",s,t)}render(){return this.state.hasError?this.props.fallback||e.jsxs("div",{className:"p-4 rounded bg-red-900/40 border border-red-700 text-red-200",children:[e.jsx("div",{className:"font-semibold",children:"Ocorreu um erro ao renderizar."}),e.jsx("div",{className:"text-sm",children:"Tente voltar e abrir a criaÃ§Ã£o novamente."})]}):this.props.children}}class Ta extends Error{constructor(t){super(t.message);Ue(this,"code");Ue(this,"provider");Ue(this,"retryable");this.name="AIError",this.code=t.code,this.provider=t.provider,this.retryable=t.retryable}}class Fl{constructor(){Ue(this,"config");Ue(this,"cache",new Map);Ue(this,"usageStats",{totalRequests:0,totalTokens:0,totalCost:0,requestsByType:{},averageResponseTime:0,errorRate:0});this.config=this.loadConfig()}fetchWithTimeout(s,t,r=8e3){const i=new AbortController,n=setTimeout(()=>i.abort(),Math.max(1e3,r));return fetch(s,{...t||{},signal:i.signal}).finally(()=>clearTimeout(n))}sleep(s){return new Promise(t=>setTimeout(t,Math.max(0,s)))}parseRetrySeconds(s){if(!s)return;const t=Number(s);if(!isNaN(t)&&t>0)return t;const r=s.match(/try again in\s*([\d.]+)s/i);if(r){const i=parseFloat(r[1]);if(!isNaN(i)&&i>0)return i}}loadConfig(){const s=(typeof import.meta<"u"?{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}:void 0)||{},t=String(s.VITE_AI_SERVICE_PROVIDER||"").toLowerCase(),r=t==="huggingface"||t==="hf"?"huggingface":t==="anthropic"?"anthropic":t==="openai"?"openai":"groq",i=String(s.VITE_AI_MODEL||"llama-3.1-8b-instant"),n=String(s.VITE_AI_IMAGE_MODEL||"stabilityai/sd-turbo");return{provider:r,apiKey:"",model:i,imageModel:n,baseURL:r==="huggingface"?"/api/hf-text":"/api/groq-openai",maxTokens:2e3,temperature:.7}}generateCacheKey(s){const t=JSON.stringify(s);let r=0;for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);r=(r<<5)-r+n,r|=0}return`k${Math.abs(r).toString(36)}`}isValidCache(s){return Date.now()<s.expiresAt}async makeOpenAITextRequest(s,t){var d,m,u,p,g,v,y;const r={"Content-Type":"application/json"};this.config.apiKey&&(r.Authorization=`Bearer ${this.config.apiKey}`);const i=((t==null?void 0:t.baseURL)??this.config.baseURL)||"";let n=`${i}/chat/completions`;typeof i=="string"&&i.startsWith("/api/")&&(n=i.includes("groq-chat")?i:`${i}/chat/completions`);const o=3;let c=0,l="";for(;c<=o;){const w=Math.max(200,(s.maxTokens||this.config.maxTokens||2e3)-c*200);console.debug("[AI][OpenAIText] Request",{endpoint:n,provider:this.config.provider,model:this.config.model,maxTokens:w,temperature:s.temperature||this.config.temperature,promptLen:((d=s.prompt)==null?void 0:d.length)||0,hasContext:!!s.context,attempt:c});const k=await this.fetchWithTimeout(n,{method:"POST",headers:r,body:JSON.stringify({model:(t==null?void 0:t.model)||this.config.model,messages:[...s.systemMessage?[{role:"system",content:s.systemMessage}]:[],...s.context?[{role:"user",content:s.context}]:[],{role:"user",content:s.prompt}],max_tokens:w,temperature:s.temperature||this.config.temperature})},12e3);if(k.ok){const j=await k.json();return console.debug("[AI][OpenAIText] Success",{status:k.status,model:j.model,textLen:((g=(p=(u=(m=j==null?void 0:j.choices)==null?void 0:m[0])==null?void 0:u.message)==null?void 0:p.content)==null?void 0:g.length)||0}),{text:j.choices[0].message.content,usage:j.usage,model:j.model,provider:"openai"}}if((k.status===404||k.status===405)&&i.includes("groq-openai")){n="/api/groq-chat",c++,await this.sleep(200);continue}const E=await k.text();let h={};try{h=JSON.parse(E)}catch{h={error:{message:E}}}l=((v=h.error)==null?void 0:v.message)||E||"Unknown error occurred";const b=(typeof import.meta<"u"?{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}:void 0)||{};if((b.VITE_AI_SILENT==="true"||!!b.DEV?console.debug:console.error)("[AI][OpenAIText] Error",{status:k.status,statusText:k.statusText,endpoint:n,message:l,rawSnippet:typeof E=="string"?E.slice(0,300):"",retryAfter:k.headers.get("retry-after")||void 0}),k.status===429){const j=k.headers.get("retry-after"),N=this.parseRetrySeconds(j),T=this.parseRetrySeconds(l),te=Math.round((N??T??3)*1e3)*Math.pow(2,c),D=Math.floor(Math.random()*300);await this.sleep(Math.max(1e3,te+D)),c++;continue}throw new Ta({code:((y=h.error)==null?void 0:y.code)||"unknown_error",message:l,provider:"openai",retryable:k.status>=500})}throw new Ta({code:"rate_limit",message:l||"Rate limit reached. Please try again later.",provider:"openai",retryable:!0})}async makeHuggingFaceTextRequest(s){var o;const t="/api/hf-text";console.debug("[AI][HFText] Request",{endpoint:t,model:this.config.model,maxTokens:s.maxTokens||this.config.maxTokens,temperature:s.temperature||this.config.temperature,promptLen:((o=s.prompt)==null?void 0:o.length)||0,hasContext:!!s.systemMessage});const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s.prompt,systemMessage:s.systemMessage,maxTokens:s.maxTokens||this.config.maxTokens,temperature:s.temperature||this.config.temperature})}),i=await r.text();let n={text:""};try{n=JSON.parse(i)}catch{n={text:i}}if(!r.ok){const c=(n==null?void 0:n.error)??n,l=typeof c=="string"?c:(c==null?void 0:c.message)||"Erro ao gerar com Hugging Face";if(console.error("[AI][HFText] Error",{status:r.status,statusText:r.statusText,endpoint:t,message:l,rawSnippet:typeof i=="string"?i.slice(0,300):""}),r.status===404||r.status===405)try{return await this.makeOpenAITextRequest(s,{baseURL:"/api/groq-openai",model:"llama-3.1-8b-instant"})}catch{}throw new Ta({code:"hf_error",message:l,provider:"huggingface",retryable:r.status>=500})}return console.debug("[AI][HFText] Success",{status:r.status,textLen:(n.text||"").length}),{text:n.text||"",usage:void 0,model:this.config.model,provider:"huggingface"}}async makeAnthropicTextRequest(s){var i,n;const t=await fetch(`${this.config.baseURL}/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.config.model,max_tokens:s.maxTokens||this.config.maxTokens,temperature:s.temperature||this.config.temperature,system:s.systemMessage,messages:[...s.context?[{role:"user",content:s.context}]:[],{role:"user",content:s.prompt}]})});if(!t.ok){const o=await t.json();throw new Ta({code:((i=o.error)==null?void 0:i.type)||"unknown_error",message:((n=o.error)==null?void 0:n.message)||"Unknown error occurred",provider:"anthropic",retryable:t.status>=500})}const r=await t.json();return{text:r.content[0].text,usage:r.usage,model:r.model,provider:"anthropic"}}async makeOpenAIImageRequest(s){var i,n;const t=await fetch(`${this.config.baseURL}/images/generations`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:this.config.imageModel,prompt:s.prompt,size:s.size||"1024x1024",quality:s.quality||"standard",style:s.style||"vivid",n:s.n||1})});if(!t.ok){const o=await t.json();throw new Ta({code:((i=o.error)==null?void 0:i.code)||"unknown_error",message:((n=o.error)==null?void 0:n.message)||"Unknown error occurred",provider:"openai",retryable:t.status>=500})}const r=await t.json();return{url:r.data[0].url,revisedPrompt:r.data[0].revised_prompt,size:s.size||"1024x1024",model:this.config.imageModel,provider:"openai"}}async makeHuggingFaceImageRequest(s){const t={}.VITE_AI_CACHE_ENABLED!=="false";if(t){const o=Nn(s.prompt);if(o)return{url:o,revisedPrompt:s.prompt,size:s.size||"512x512",model:this.config.imageModel||"stabilityai/sd-turbo",provider:"cache"}}const r=await this.fetchWithTimeout("/api/gerar-imagem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s.prompt})},9e3),i=await r.json().catch(()=>({imagem:""}));if(!r.ok)throw new Ta({code:"hf_image_error",message:(i==null?void 0:i.error)||"Erro ao gerar imagem no Hugging Face",provider:"huggingface",retryable:r.status>=500});let n=i.imagem||"";if(!n||typeof n=="string"&&n.startsWith("data:image/svg+xml")){try{const o=await this.fetchWithTimeout(`/api/hero-image?prompt=${encodeURIComponent(s.prompt)}`,{method:"GET"},7e3),c=await o.json().catch(()=>({image:""}));o.ok&&typeof(c==null?void 0:c.image)=="string"&&c.image.length>0&&(n=c.image)}catch{}if(!n||typeof n=="string"&&n.startsWith("data:image/svg+xml")){const o=(s.size||"512x512").split("x"),c=encodeURIComponent(o[0]||"512"),l=encodeURIComponent(o[1]||"512");n=`/api/pollinations-image?prompt=${encodeURIComponent(s.prompt)}&width=${c}&height=${l}`}}if(t&&typeof n=="string"&&/^https?:\/\//.test(n)){const o=n.includes("lexica.art")?"lexica":n.includes("pollinations.ai")?"pollinations":"hf";Sn(s.prompt,n,7*24*60*60*1e3,o)}return{url:n,revisedPrompt:s.prompt,size:s.size||"512x512",model:this.config.imageModel||"stabilityai/sd-turbo",provider:"huggingface"}}async generateText(s){var i,n,o,c;if(!this.isConfigured())return{text:"AI service is not configured. Please check your API keys.",usage:{promptTokens:0,completionTokens:0,totalTokens:0},model:this.config.model,provider:this.config.provider,finishReason:"stop"};const t=Date.now(),r=this.generateCacheKey(s);if({}.VITE_AI_CACHE_ENABLED==="true"){const l=this.cache.get(r);if(l&&this.isValidCache(l))return l.response}try{console.debug("[AI][Text] Dispatch",{provider:this.config.provider,baseURL:this.config.baseURL,model:this.config.model,maxTokens:s.maxTokens||this.config.maxTokens,temperature:s.temperature||this.config.temperature,promptLen:((i=s.prompt)==null?void 0:i.length)||0,hasContext:!!s.context});let l;return this.config.provider==="openai"?l=await this.makeOpenAITextRequest(s):this.config.provider==="groq"?l=await this.makeOpenAITextRequest(s):this.config.provider==="anthropic"?l=await this.makeAnthropicTextRequest(s):l=await this.makeHuggingFaceTextRequest(s),this.updateUsageStats(t,((n=l.usage)==null?void 0:n.totalTokens)||0,"text"),{}.VITE_AI_CACHE_ENABLED==="true"&&this.cache.set(r,{key:r,response:l,timestamp:Date.now(),expiresAt:Date.now()+24*60*60*1e3}),console.debug("[AI][Text] Completed",{provider:l.provider,model:l.model,textLen:((o=l.text)==null?void 0:o.length)||0,totalTokens:(c=l.usage)==null?void 0:c.totalTokens}),l}catch(l){this.usageStats.errorRate++;const d=(typeof import.meta<"u"?{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}:void 0)||{};if((d.VITE_AI_SILENT==="true"||!!d.DEV?console.debug:console.error)("[AI][Text] Failed",{code:l==null?void 0:l.code,message:l==null?void 0:l.message,provider:(l==null?void 0:l.provider)||this.config.provider,retryable:l==null?void 0:l.retryable}),this.config.provider==="groq")try{return await this.makeHuggingFaceTextRequest(s)}catch{}throw l}}async generateTextSafe(s){var t,r;try{return await this.generateText(s)}catch(i){const n=(typeof import.meta<"u"?{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}:void 0)||{};return(n.VITE_AI_SILENT==="true"||!!n.DEV?console.debug:console.warn)("[AI][TextSafe] Fallback engaged",{code:i==null?void 0:i.code,message:((r=(t=i==null?void 0:i.message)==null?void 0:t.slice)==null?void 0:r.call(t,0,200))||String((i==null?void 0:i.message)||i),provider:(i==null?void 0:i.provider)||this.config.provider}),{text:this.buildFallbackText(s),usage:{promptTokens:0,completionTokens:0,totalTokens:0},model:this.config.model,provider:this.config.provider}}}buildFallbackText(s){const t=(s.systemMessage||"").toLowerCase(),r=s.prompt||"";if(t.includes("narrador")||t.includes("narrative")||r.toLowerCase().includes("narre"))return"O vento sussurra entre ruÃ­nas antigas enquanto o herÃ³i avanÃ§a com determinaÃ§Ã£o. ObstÃ¡culos surgem, mas cada passo revela novas oportunidades e perigos. Continue explorando: o destino se escreve com suas escolhas.";if(t.includes("missÃ£o")||r.toLowerCase().includes("missÃ£o"))return"MissÃ£o: Investigar atividades estranhas em um vilarejo prÃ³ximo. Objetivo: conversar com moradores e coletar pistas. Recompensa: experiÃªncia e ouro modestos. Dificuldade: normal.";if(t.includes("diÃ¡logo")||r.toLowerCase().includes("diÃ¡logo"))return'NPC: "Vi vocÃª pela estrada. Cuidado, viajanteâ€”os bosques escondem mais do que sombras. Precisa de ajuda?"';const i=r.trim();return i.length>0?`Resumo: ${i.slice(0,200)} ...`:"Texto nÃ£o disponÃ­vel no momento. Continue a aventura; conteÃºdo serÃ¡ carregado quando o serviÃ§o retornar."}async generateImage(s){if(!this.isConfigured())return{url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OTk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkFJIE5vdCBDb25maWd1cmVkPC90ZXh0Pjwvc3ZnPg==",revisedPrompt:s.prompt,size:s.size||"1024x1024",model:this.config.imageModel||"stabilityai/sd-turbo",provider:this.config.provider};const t=Date.now(),r=this.generateCacheKey(s),i={}.VITE_AI_CACHE_ENABLED!=="false";if(i){const n=this.cache.get(r);if(n&&this.isValidCache(n))return n.response}try{let n;return this.config.provider==="openai"?n=await this.makeOpenAIImageRequest(s):n=await this.makeHuggingFaceImageRequest(s),this.updateUsageStats(t,0,"image"),i&&this.cache.set(r,{key:r,response:n,timestamp:Date.now(),expiresAt:Date.now()+7*24*60*60*1e3}),n}catch(n){throw this.usageStats.errorRate++,n}}updateUsageStats(s,t,r){const i=Date.now()-s;this.usageStats.totalRequests++,this.usageStats.totalTokens+=t,this.usageStats.requestsByType[r]=(this.usageStats.requestsByType[r]||0)+1,this.usageStats.averageResponseTime=(this.usageStats.averageResponseTime*(this.usageStats.totalRequests-1)+i)/this.usageStats.totalRequests}getUsageStats(){return{...this.usageStats}}clearCache(){this.cache.clear()}getCacheSize(){return this.cache.size}isConfigured(){return this.config.provider==="huggingface"?!0:this.config.provider==="groq"?typeof this.config.baseURL=="string"&&this.config.baseURL.startsWith("/api/")||!!this.config.apiKey:!!this.config.apiKey}getProvider(){return this.config.provider}}const sa=new Fl,gi={Warrior:["${name} treinou entre aÃ§o e fogo, moldando sua coragem nas batalhas de ${place}.",'Chamado de "Escudo de ${place}", ${name} ergueu sua lÃ¢mina para proteger os fracos.',"Em ${place}, ${name} aprendeu que disciplina vale mais que forÃ§a bruta.","Quando os tambores ecoaram em ${place}, ${name} avanÃ§ou sem hesitar.","Cada cicatriz de ${name} conta uma histÃ³ria de honra e dever em ${place}."],Mage:["${name} estudou grimÃ³rios antigos em ${place}, dominando segredos arcanos.",'Chamado de "SÃ¡bio de ${place}", ${name} manipula o vÃ©u entre mundos.',"Em ${place}, ${name} aprendeu que conhecimento Ã© a maior arma.","Quando as estrelas alinharam-se sobre ${place}, ${name} recitou um antigo encantamento.","As runas de ${place} sussurraram o destino de ${name} nas noites longas."],Rogue:["Nas sombras de ${place}, ${name} move-se como o vento.",'Chamado de "Eco de ${place}", ${name} nunca estÃ¡ onde o inimigo espera.',"Em ${place}, ${name} aprendeu que silÃªncio pode ser mais poderoso que aÃ§o.","Quando a lua caiu sobre ${place}, ${name} roubou o segredo que virou a guerra.","Cada passo de ${name} em ${place} deixa apenas perguntas e nenhum rastro."],Cleric:["Sob as bÃªnÃ§Ã£os em ${place}, ${name} cura feridas e expulsa trevas.",'Chamado de "Luz de ${place}", ${name} mantÃ©m a fÃ© firme sob qualquer tormenta.',"Em ${place}, ${name} aprendeu que compaixÃ£o Ã© coragem de outro tipo.","Quando as campanas tocaram em ${place}, ${name} respondeu com oraÃ§Ã£o e aÃ§Ã£o.","Cada milagre de ${name} em ${place} acende esperanÃ§a onde antes havia medo."],Ranger:["Entre florestas de ${place}, ${name} conhece cada trilha e rastro.",'Chamado de "Guia de ${place}", ${name} anda onde poucos sobrevivem.',"Em ${place}, ${name} aprendeu que paciÃªncia supera pressa.","Quando o vento mudou em ${place}, ${name} jÃ¡ sabia o caminho seguro.","Os animais de ${place} reconhecem ${name} como parte da prÃ³pria natureza."],Paladin:["Jurando votos em ${place}, ${name} combate o mal com retidÃ£o.",'Chamado de "Voto de ${place}", ${name} nÃ£o recua diante da injustiÃ§a.',"Em ${place}, ${name} aprendeu que a verdade Ã© lÃ¢mina afiada.","Quando a escuridÃ£o caiu sobre ${place}, ${name} ergueu o estandarte da luz.","Cada ato de ${name} em ${place} grava um exemplo de virtude."]},Bl=["Alto Vale","Muralha de Pedra","Costa Ã‚mbar","PlanÃ­cies de Ã‰bano","Bosque das Runas"];function xi(a){return a[Math.floor(Math.random()*a.length)]}function Ol(a){const s={forca:"forÃ§a",destreza:"destreza",constituicao:"constituiÃ§Ã£o",inteligencia:"inteligÃªncia",sabedoria:"sabedoria",carisma:"carisma"},t=Object.entries(a),[r]=t.reduce((i,n)=>n[1]>i[1]?n:i,t[0]);return{key:r,label:s[r]}}function Ll(a){return Hl(a)}function Hl(a){const s=xi(gi[a.class]||gi.Warrior),t=xi(Bl),r=Ol(a.attributes),i=s.replaceAll("${name}",a.name||"Sem Nome").replaceAll("${place}",t),n=`Sua maior virtude Ã© a ${r.label}.`;return`${i} ${n}`}const Gl={short:{id:"short",title:"VersÃ£o Curta",usage:["menu","galeria","tela_inicial"],lang:"pt-BR",paragraphs:["HÃ¡ muito tempo, as terras de Altharion foram marcadas por perigos antigos e masmorras mortais.","Para proteger os novos aventureiros, surgiu a Guilda dos Aventureiros, que criou um programa Ãºnico de treinamento: o Forjador de HerÃ³is.","Agora, cada novo herÃ³i Ã© moldado com sabedoria, disciplina e escolhas que definirÃ£o o destino do mundo."]},cinematic:{id:"cinematic",title:"VersÃ£o CinematogrÃ¡fica",usage:["trailer","vÃ­deo_Ã©pico"],lang:"pt-BR",script:["â€œEm um mundo onde as sombras renascemâ€¦â€","â€œOnde masmorras devoram os despreparadosâ€¦â€","Corta para ruÃ­nas antigas e uma chama azul acendendo.","â€œA Guilda dos Aventureiros de Altharion ergueu-se para trazer ordem ao caos.â€","Imagens de aventureiros sendo treinados, batalhando, caindo, levantando.","â€œMas tantas vidas foram perdidas nos abismos esquecidosâ€¦â€","â€œâ€¦que a Guilda criou algo novo.â€","Aparece um sÃ­mbolo brilhante: Forjador de HerÃ³is","â€œUm programa forjado em suor, sabedoria e magia.â€","â€œUm ritual capaz de moldar nÃ£o apenas guerreirosâ€¦â€","â€œâ€¦mas lendas.â€","Som de espada sendo desembainhada.","â€œAgora, Ã© sua vez.â€","â€œEntre nas masmorras, tome decisÃµes que ecoarÃ£o para sempreâ€¦â€","â€œâ€¦e torne-se aquilo que Altharion tanto precisa.â€","Fade-out:","â€œO Forjador de HerÃ³is aguarda.â€"]},game_intro:{id:"game_intro",title:"NarraÃ§Ã£o Inicial do Jogo",usage:["intro"],lang:"pt-BR",lines:["Bem-vindo a Altharion.","Estas terras outrora foram prÃ³speras, mas com o despertar das antigas masmorras, o perigo retornou como nunca antes.","Durante anos, aventureiros inexperientes caÃ­ram nos labirintos sombriosâ€¦ e muitos nunca voltaram.","Para conter tantas perdas, surgiu a Guilda dos Aventureiros de Altharion, uma ordem dedicada a treinar, orientar e organizar aqueles que ousam desafiar o desconhecido.","Depois de inÃºmeras mortes, a Guilda criou sua maior obra:","o Forjador de HerÃ³is, um sistema de formaÃ§Ã£o capaz de preparar qualquer aspirante para enfrentar os horrores das profundezas.","Agora, vocÃª estÃ¡ aqui.","Seu nome serÃ¡ registrado.","Suas escolhas moldarÃ£o seu destinoâ€¦ e talvez o destino do mundo.","A forja estÃ¡ acesa.","Sua jornada comeÃ§a agora."]},topics:{id:"topics",title:"VersÃ£o em TÃ³picos",usage:["wiki","documentacao","historia_do_mundo"],lang:"pt-BR",sections:[{id:"origem_de_altharion",title:"Origem de Altharion",bullets:["Mundo antigo com vastos reinos, ruÃ­nas esquecidas e masmorras vivas.","Portais arcanos abriram passagens para criaturas do alÃ©m.","A magia primal permeia tudo, moldando a realidade e corrompendo territÃ³rios."]},{id:"problema_original",title:"Masmorras devorando aventureiros",bullets:["As masmorras nÃ£o sÃ£o apenas lugares â€” sÃ£o entidades vivas e mutÃ¡veis.","A cada geraÃ§Ã£o, a taxa de mortes entre aventureiros crescia.","Jovens guerreiros entravam despreparados, confiando apenas na coragem."]},{id:"criacao_da_guilda",title:"A criaÃ§Ã£o da Guilda dos Aventureiros",bullets:["Formada por veteranos que sobreviveram aos piores horrores.","OrganizaÃ§Ã£o responsÃ¡vel por distribuir missÃµes, registrar aventureiros, manter a ordem entre as facÃ§Ãµes, investigar as masmorras, coordenar times para expediÃ§Ãµes."]},{id:"forjador_de_herois",title:"Nasce o Forjador de HerÃ³is",bullets:["Criado apÃ³s inÃºmeras mortes desnecessÃ¡rias.","Objetivo: preparar novatos psicologicamente, fisicamente e espiritualmente.","Sistema que treina atributos, guia decisÃµes, oferece missÃµes graduais, simula combate, registra reputaÃ§Ã£o com facÃ§Ãµes, molda o carÃ¡ter do herÃ³i desde o comeÃ§o.","Por isso Ã© chamado de Forjador: seu herÃ³i Ã© literalmente moldado."]},{id:"foco_do_mundo",title:"O foco do mundo",bullets:["As decisÃµes moldam a narrativa.","FacÃ§Ãµes reagem Ã s escolhas do jogador.","Ranks definem quÃ£o longe ele pode ir.","Masmorras profundas exigem preparo.","A Guilda observa e registra tudo."]}]},full:{id:"full",title:"Lore Definitiva",usage:["lore_completa"],lang:"pt-BR",paragraphs:["Antes das grandes cidades, antes dos reinos erguerem seus brasÃµes, Altharion era apenas uma terra selvagem.","A magia primal corria como rios invisÃ­veis, despertando criaturas nas profundezas e moldando florestas inteiras.","Com o passar das eras, homens e mulheres ousaram explorar o desconhecidoâ€¦ e descobriram as Masmorras Vivas: estruturas que se expandiam, consumiam energia e renasciam.","Muitos se voluntariavam para enfrentar tais lugares â€” jovens sonhadores, guerreiros orgulhosos, curiosos inconsequentes.","Mas as masmorras eram cruÃ©is, adaptativas, imprevisÃ­veis. E assim comeÃ§ou o que ficou conhecido como A Era das Perdas.","Uma geraÃ§Ã£o inteira foi consumida pelos abismos.","Fundada pelos poucos veteranos sobreviventes, a Guilda assumiu para si a responsabilidade de treinar aventureiros, investigar as masmorras, manter a ordem entre as facÃ§Ãµes, impedir que o caos se espalhe pelas cidades, proteger Altharion de ameaÃ§as arcanas.","Mas mesmo com toda sua disciplina, as mortes continuavam. Foi entÃ£o que surgiu a ideia que mudaria tudo.","A Guilda concluiu que nÃ£o bastava treinar aventureiros. Era preciso moldÃ¡-los desde a base.","Assim nasceu o Forjador de HerÃ³is â€” um programa Ãºnico, criado para testar personalidade, coragem e espÃ­rito; equilibrar atributos; guiar decisÃµes morais; expor o herÃ³i a desafios graduais; desenvolver reputaÃ§Ã£o com facÃ§Ãµes; simular situaÃ§Ãµes reais de combate; introduzir o herÃ³i ao mundo atravÃ©s de histÃ³rias interativas.","Cada aventureiro passa por um ritual simbÃ³lico: a Forja, onde seu destino comeÃ§a a ser escrito.","VocÃª Ã© um dos aspirantes. Mas diferente dos outrosâ€¦ suas escolhas realmente mudarÃ£o o mundo.","AlianÃ§as serÃ£o feitas e quebradas. FacÃ§Ãµes responderÃ£o Ã s suas aÃ§Ãµes. MissÃµes terÃ£o consequÃªncias. As masmorras reagirÃ£o ao seu estilo de jogo.","E, acima de tudo, o Forjador de HerÃ³is testarÃ¡ se vocÃª Ã© digno de se tornar uma lenda de Altharion."]}};function es(a){return Gl[a]}const zl=()=>{const a=Wt(),{updateHero:s,createHero:t}=Z(),r=x.useRef(null),[i,n]=at.useState(null),o=()=>{a("/create")},c=p=>{a(`/hero/${p.id}`)},l=p=>{a(`/hero/${p.id}`)},d=p=>{var g;n(p),(g=r.current)==null||g.click()},m=p=>{var v;const g=(v=p.target.files)==null?void 0:v[0];if(g&&i){const y=new FileReader;y.onload=w=>{var E;const k=(E=w.target)==null?void 0:E.result;s(i.id,{image:k}),n(null)},y.readAsDataURL(g)}},u=es("short");return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-gray-900 to-slate-800",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6",children:[e.jsx("input",{ref:r,type:"file",accept:"image/*",onChange:m,className:"hidden"}),e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold text-amber-400 mb-1 sm:mb-2",children:"âš”ï¸ Hero Forge"}),e.jsx("p",{className:"text-gray-300 text-sm sm:text-base",children:"Gerencie seus herÃ³is Ã©picos"})]}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs($e,{to:"/quests",className:"bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-blue-500/30",children:[e.jsx("div",{className:"text-xl sm:text-2xl mb-1 sm:mb-2",children:"âš”ï¸"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"MissÃµes"})]}),e.jsxs($e,{to:"/guild-hub",className:"bg-gradient-to-br from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-purple-500/30",children:[e.jsx("div",{className:"text-xl sm:text-2xl mb-1 sm:mb-2",children:"ğŸ°"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Guilda dos Aventureiros"})]}),e.jsxs($e,{to:"/titles",className:"bg-gradient-to-br from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-amber-500/30",children:[e.jsx("div",{className:"text-xl sm:text-2xl mb-1 sm:mb-2",children:"ğŸ‘‘"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"TÃ­tulos"})]}),e.jsxs($e,{to:"/leaderboards",className:"bg-gradient-to-br from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 text-white p-3 sm:p-4 rounded-lg text-center transition-all transform hover:scale-105 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xl sm:text-2xl mb-1 sm:mb-2",children:"ğŸ†"}),e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Rankings"})]})]})}),e.jsxs("div",{className:"mb-6 sm:mb-8 rounded-lg p-4 border border-amber-500/30 bg-amber-900/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm text-amber-300 font-semibold",children:"Forjador de HerÃ³is â€” IntroduÃ§Ã£o"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{to:"/intro?version=game_intro",className:"px-3 py-1 rounded bg-amber-600 text-black text-xs",children:"NarraÃ§Ã£o"}),e.jsx($e,{to:"/intro?version=cinematic",className:"px-3 py-1 rounded bg-indigo-600 text-white text-xs",children:"Trailer"})]})]}),e.jsx("div",{className:"space-y-2 text-xs sm:text-sm text-gray-200",children:u.paragraphs.map((p,g)=>e.jsx("p",{children:p},g))})]}),e.jsx(Er,{children:e.jsx(ql,{onCreateHero:o,onHeroSelect:c,onHeroEdit:l,onHeroImageChange:d,showCreateButton:!0,cardSize:"medium",viewMode:"grid"})})]})})};function Ul(a,s=""){switch(a){case"nome":return{systemMessage:"Gere NOME COMPLETO de herÃ³i medieval em PT-BR. Responda SOMENTE com duas palavras: primeiro nome e sobrenome, sem aspas, sem pontuaÃ§Ã£o.",prompt:`ForneÃ§a apenas "Nome Sobrenome" Ã©pico medieval/fantasia, exatamente duas palavras. Sem epÃ­tetos, sem vÃ­rgulas, sem explicaÃ§Ãµes. Contexto: ${s||"herÃ³i desconhecido"}.`,maxTokens:12,temperature:.9};case"frase":return{systemMessage:"VocÃª cria uma frase de batalha Ã©pica em PT-BR, curta, forte e memorÃ¡vel. Responda apenas com a frase.",prompt:`Crie uma Ãºnica frase de batalha Ã©pica para um herÃ³i. Contexto opcional: ${s||"herÃ³i classe desconhecida"}. Evite aspas.`,maxTokens:40,temperature:.8};case"historia":return{systemMessage:"VocÃª Ã© um narrador mestre e gera uma histÃ³ria Ã©pica medieval em PT-BR (100â€“200 palavras).",prompt:`Escreva uma histÃ³ria Ã©pica medieval sobre o herÃ³i. Contexto: ${s||"herÃ³i desconhecido"}. Use o sexo quando fornecido para ajustar pronomes e detalhes. Foque em emoÃ§Ã£o, imagens vÃ­vidas e progresso do herÃ³i.`,maxTokens:350,temperature:.8};case"missao":default:return{systemMessage:"VocÃª Ã© um mestre de RPG e cria uma missÃ£o breve em PT-BR, com objetivo claro e recompensa.",prompt:`Gere uma missÃ£o medieval fantasiosa de dificuldade moderada. Contexto: ${s||"nenhum"}. Inclua tÃ­tulo, objetivo principal e recompensa curta.`,maxTokens:200,temperature:.7};case"translate":return{systemMessage:"Translate the provided Portuguese text to natural English suitable for an AI image prompt. Return only the translated text.",prompt:String(s||""),maxTokens:300,temperature:.3}}}async function Fs(a,s=""){const{systemMessage:t,prompt:r,maxTokens:i,temperature:n}=Ul(a,s);try{let c=((await sa.generateTextSafe({systemMessage:t,prompt:r,maxTokens:i,temperature:n})).text||"").trim();if(a==="nome"){c=c.replace(/["'â€œâ€`\.\,;:]/g,"").trim();const l=c.split(/\s+/).filter(Boolean);if(l.length>=2)c=`${l[0]} ${l[1]}`;else if(l.length===1){const d=["da Rocha","do Vale","Silvar","Montclair","Valencius","Stormblade","Noctis","Dawnhart","Ironwood","Winterborn"],m=d[Math.floor(Math.random()*d.length)];c=`${l[0]} ${m}`}}if(c.length>0)return c}catch{}switch(a){case"nome":return"Valen Ironwood";case"frase":return"Por honra e aÃ§o, avanÃ§o sem medo!";case"historia":return"Sob o cÃ©u cinzento, um herÃ³i ergueu-se contra a marÃ© de sombras, encontrando coragem nas cicatrizes do passado e esperanÃ§a no brilho da lÃ¢mina. A jornada recomeÃ§a, e o destino chama.";case"missao":default:return"MissÃ£o: Patrulhar os arredores e investigar pegadas suspeitas. Recompensa: 50 ouro e experiÃªncia. Dificuldade: normal."}}async function Vl(a){const s=await fetch("/api/hero-create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`Erro ao gerar herÃ³i: ${s.status}`);return s.json()}const hi={humano:{first:["Erik","Mira","Roland","Selene","Alba","Marcus","Elena","Gareth","Lyanna","Cedric","Aria","Theron","Vera","Aldric","Nora","Darius","Celia","Roderick","Iris","Magnus","Luna","Cassius","Stella"],last:["Vargas","Dorn","Marin","Cavaleiro","Ferreira","Santos","Silva","Monteiro","Pereira","Costa","Almeida","Rocha","Cardoso","Ribeiro","Machado","Barbosa","Correia","Teixeira","Moreira","Carvalho"]},elfo:{first:["Elarion","Sylwen","Althir","Thalindra","Aelindra","Celeborn","Galadriel","Legolas","Arwen","Elrond","Nimrodel","Thranduil","Elaria","Silvyr","Moonwhisper","Starweaver","Dawnbringer","Nightsong"],last:["Lunarwind","Silvertree","Aelaris","Moonblade","Starfall","Dawnstrider","Nightwhisper","Goldleaf","Silverbrook","Crystalwind","Shadowmere","Brightbane","Swiftarrow","Lightbringer","Forestwalker","Stormwind"]},anao:{first:["Durak","Brom","Thrain","Hilda","Thorin","Dain","Balin","Dwalin","Gimli","Gloin","Oin","Nori","Dori","Ori","Bifur","Bofur","Bombur","Fili","Kili","Grenda","Magna","Vera"],last:["Ferrobarba","Pedramar","Martelo-de-Ferro","Barba-de-AÃ§o","Punho-de-Pedra","Escudo-de-Ferro","Machado-Dourado","Forja-Negra","Barba-Branca","PÃ©-de-Ferro","CoraÃ§Ã£o-de-Pedra","MÃ£o-de-Ferro","Barba-Vermelha"]},orc:{first:["Gor","Krag","Thokk","Urgar","Grash","Morg","Skar","Vrak","Grom","Thrall","Durotan","Orgrim","Blackhand","Kilrogg","Ner'zhul","Gul'dan","Cho'gall","Teron","Kargath","Dentarg"],last:["Sangrent","Ruptura","Osso-Quebrado","Garra-Negra","Dente-Afiado","Punho-de-Ferro","Olho-Vermelho","Cicatriz-Profunda","LÃ¢mina-Suja","CrÃ¢nio-Rachado","Pele-Dura","ForÃ§a-Bruta","Raiva-Eterna"]},halfling:{first:["Bilbo","Frodo","Sam","Merry","Pippin","Rosie","Daisy","Poppy","Lily","Violet","Peregrin","Meriadoc","Samwise","Fredegar","Folco","Odo","Drogo","Primula","Belladonna","Mirabella","Donnamira"],last:["Bolseiro","Gamgee","Tuk","Brandebuque","Sacola-Dourada","PÃ©-Peludo","Colina-Verde","Vale-Alegre","Pedra-Branca","Ãgua-Clara","Campo-Florido","Boa-Sorte","CoraÃ§Ã£o-Alegre","Sorriso-Largo","Barriga-Cheia"]}},fi={guerreiro:["Pelas chamas da honra!","Mostrem seu valor!","AÃ§o nunca falha!","Por glÃ³ria e batalha!","Que o ferro encontre a carne!","Nenhum passo atrÃ¡s!","A vitÃ³ria ou a morte!"],mago:["Que o cosmos exalte meu nome!","Pelas letras ancestrais!","Que o selo se quebre!","Magia flui atravÃ©s de mim!","Os elementos me obedecem!","Conhecimento Ã© poder!","Que a realidade se curve!"],arqueiro:["Minha mira nunca falha!","SilÃªncio e precisÃ£o!","Uma flecha, um alvo!","Que o vento guie minha flecha!","DistÃ¢ncia Ã© minha aliada!","Olhos de Ã¡guia, mÃ£os firmes!","A caÃ§a comeÃ§ou!"],clerigo:["Pela luz divina!","Que a fÃ© me guie!","A cura vem dos cÃ©us!","ProteÃ§Ã£o aos justos!","Luz contra as trevas!","BÃªnÃ§Ã£os sobre nÃ³s!","O divino me fortalece!"],ladino:["Sombras, me guiem!","Essa carteira nÃ£o vai se esvaziar sozinha!","Sorria e corra!","SilÃªncio Ã© ouro!","Nas sombras eu prospero!","RÃ¡pido e mortal!","VocÃª nÃ£o me viu chegando!"],default:["Por glÃ³ria e ouro!","Pelo rei!","Avante, herÃ³is!","A aventura nos chama!","Que a sorte nos favoreÃ§a!"]};function ns(a){const s=["a","ia","ra","na","la","sa"],t=a.toLowerCase();return s.some(r=>t.endsWith(r))}function os(a){const s=fi[a.toLowerCase()]||fi.default;return s[Math.floor(Math.random()*s.length)]}function Ql(a,s=3,t){const r=[],i=hi[a]||hi.humano;let n=i.first.slice();t==="feminino"&&(n=n.filter(ns).length?n.filter(ns):n),t==="masculino"&&(n=n.filter(o=>!ns(o)).length?n.filter(o=>!ns(o)):n);for(let o=0;o<s;o++){let c;do{const l=n[Math.floor(Math.random()*n.length)],d=i.last[Math.floor(Math.random()*i.last.length)];c=`${l} ${d}`}while(r.includes(c));r.push(c)}return r}function Xl(a){return!a||a.trim().length===0?{valid:!1,message:"Nome nÃ£o pode estar vazio"}:a.length<2?{valid:!1,message:"Nome deve ter pelo menos 2 caracteres"}:a.length>50?{valid:!1,message:"Nome deve ter no mÃ¡ximo 50 caracteres"}:/[<>{}[\]\\/|`~!@#$%^&*()+=;:'"?]/.test(a)?{valid:!1,message:"Nome contÃ©m caracteres invÃ¡lidos"}:{valid:!0}}function Jl({heroClass:a,plannedTalents:s=[],onToggle:t,currentLevel:r=1}){const i=wr[a]||[],[n,o]=x.useState(null);return e.jsxs("div",{className:"p-4 rounded bg-gray-700",children:[e.jsx("div",{className:"text-white font-semibold",children:"PrÃ³ximas Habilidades"}),i.length===0&&e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:"Nenhuma habilidade definida para esta classe."}),i.length>0&&e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-3",children:i.map(c=>e.jsxs("div",{className:"p-3 rounded bg-gray-800 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-amber-300 text-sm",children:["NÃ­vel ",c.level]}),e.jsx("div",{className:`text-xs ${r>=c.level?"text-emerald-300":"text-gray-400"}`,children:r>=c.level?"DisponÃ­vel":`DisponÃ­vel no NÃ­vel ${c.level}`})]}),e.jsx("div",{className:"mt-1 h-2 bg-gray-700 rounded",children:e.jsx("div",{className:"h-2 bg-amber-500 rounded",style:{width:`${Math.min(100,Math.floor(r/c.level*100))}%`}})}),e.jsx("ul",{className:"mt-1 text-xs text-gray-300",children:c.skills.map(l=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>o({level:c.level,skill:l}),className:`w-full text-left px-2 py-1 rounded ${(n==null?void 0:n.skill.id)===l.id?"bg-gray-700 text-white":"hover:bg-gray-700"}`,"aria-pressed":(n==null?void 0:n.skill.id)===l.id,children:[l.name," â€” ",l.type,l.element?` â€¢ ${l.element}`:"",l.cooldown?` â€¢ CD ${l.cooldown}`:""]})},l.id))}),n&&n.level===c.level&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-gray-700 text-xs text-gray-200",children:[e.jsx("div",{className:"text-white font-semibold",children:n.skill.name}),e.jsxs("div",{children:["Tipo: ",n.skill.type,n.skill.element?` â€¢ ${n.skill.element}`:""]}),n.skill.description&&e.jsx("div",{className:"mt-1",children:n.skill.description}),typeof n.skill.cost=="number"&&e.jsxs("div",{children:["Custo: ",n.skill.cost]}),typeof n.skill.cooldown=="number"&&e.jsxs("div",{children:["Cooldown: ",n.skill.cooldown," turnos"]}),e.jsxs("div",{className:"mt-1",children:["PrÃ©-requisito: atingir nÃ­vel ",c.level]}),t&&e.jsx("div",{className:"mt-2 flex gap-2",children:e.jsx("button",{type:"button",onClick:()=>t(n.skill.id),className:`px-2 py-1 rounded ${s.includes(n.skill.id)?"bg-emerald-600 text-white":"bg-gray-600 text-gray-200 hover:bg-gray-500"}`,children:s.includes(n.skill.id)?"âœ“ Planejada":"Planejar talento"})})]})]},`${a}-${c.level}`))})]})}function bi(a,s){const t=Qt[a];if(!(t!=null&&t.suggestedRaces)||t.suggestedRaces.length===0)return{ok:!0,message:"CompatÃ­vel"};const r=t.suggestedRaces.includes(s);return{ok:r,message:r?"Excelente sinergia de raÃ§a para esta classe.":"Funciona, mas nÃ£o Ã© a raÃ§a mais sinÃ©rgica para esta classe."}}function Bs(a){const s=Qt[a];if(!s)return[];const t=s.baseAttributes,r=(i,n)=>({attribute:i,priority:n,hint:`Priorize ${i} (${n}). Base ${t[i]}`});switch(a){case"guerreiro":return[r("forca","alta"),r("constituicao","alta"),r("destreza","media")];case"mago":return[r("inteligencia","alta"),r("sabedoria","alta"),r("constituicao","media")];case"ladino":return[r("destreza","alta"),r("forca","media"),r("carisma","media")];case"clerigo":return[r("sabedoria","alta"),r("inteligencia","media"),r("constituicao","media")];case"patrulheiro":return[r("destreza","alta"),r("sabedoria","media"),r("forca","media")];case"paladino":return[r("constituicao","alta"),r("forca","alta"),r("sabedoria","media")];case"arqueiro":return[r("destreza","alta"),r("sabedoria","media"),r("forca","media")];case"bardo":return[r("carisma","alta"),r("sabedoria","media"),r("destreza","media")];case"monge":return[r("constituicao","alta"),r("destreza","alta"),r("sabedoria","media")];case"assassino":return[r("destreza","alta"),r("forca","media"),r("inteligencia","media")];case"barbaro":return[r("forca","alta"),r("constituicao","alta"),r("destreza","media")];case"lanceiro":return[r("destreza","alta"),r("forca","alta"),r("constituicao","media")];case"druida":return[r("sabedoria","alta"),r("inteligencia","media"),r("constituicao","media")];case"feiticeiro":return[r("inteligencia","alta"),r("carisma","media"),r("sabedoria","media")];default:return[]}}function Cn(){try{const a=localStorage.getItem("hfn_prefs");return a?JSON.parse(a)||{}:{}}catch{return{}}}function Wl(a){try{const t={...Cn(),...a};localStorage.setItem("hfn_prefs",JSON.stringify(t))}catch{}}const Kl={guerreiro:["attack","buff","support"],mago:["attack","buff","support"],ladino:["attack","buff","support"],clerigo:["support","buff","attack"],patrulheiro:["attack","buff","support"],paladino:["buff","attack","support"],arqueiro:["attack","buff","support"],bardo:["support","buff","attack"],monge:["buff","attack","support"],assassino:["attack","buff","support"],barbaro:["attack","buff","support"],lanceiro:["attack","buff","support"],druida:["support","buff","attack"],feiticeiro:["attack","buff","support"]};function xs(a){const s=wr[a]||[],t=Kl[a]||["attack","buff","support"],r=[];for(const i of s){const o=[...i.skills].sort((c,l)=>t.indexOf(c.type)-t.indexOf(l.type))[0];o!=null&&o.id&&r.push(o.id)}return r}function kn(a,s){const t=Qt[a],r=t==null?void 0:t.baseAttributes,n=da(a)[0]||"physical",o=xs(a);return{attributes:r,element:n,plannedTalents:o}}const Yl=[{id:"guerreiro-humano-equilibrado",name:"Guerreiro Humano â€“ Equilibrado",class:"guerreiro",race:"humano"},{id:"guerreiro-anao-tanque",name:"Guerreiro AnÃ£o â€“ Tanque",class:"guerreiro",race:"anao"},{id:"mago-elfo-controle",name:"Mago Elfo â€“ Controle",class:"mago",race:"elfo"},{id:"mago-humano-raio",name:"Mago Humano â€“ Raio",class:"mago",race:"humano"},{id:"ladino-halfling-critico",name:"Ladino Halfling â€“ CrÃ­tico",class:"ladino",race:"halfling"},{id:"ladino-humano-evasao",name:"Ladino Humano â€“ EvasÃ£o",class:"ladino",race:"humano"},{id:"clerigo-humano-suporte",name:"ClÃ©rigo Humano â€“ Suporte",class:"clerigo",race:"humano"},{id:"clerigo-elfo-luz",name:"ClÃ©rigo Elfo â€“ Luz",class:"clerigo",race:"elfo"},{id:"patrulheiro-elfo-precisao",name:"Patrulheiro Elfo â€“ PrecisÃ£o",class:"patrulheiro",race:"elfo"},{id:"patrulheiro-humano-versatil",name:"Patrulheiro Humano â€“ VersÃ¡til",class:"patrulheiro",race:"humano"},{id:"paladino-humano-defesa",name:"Paladino Humano â€“ Defesa",class:"paladino",race:"humano"},{id:"paladino-anao-resistencia",name:"Paladino AnÃ£o â€“ ResistÃªncia",class:"paladino",race:"anao"},{id:"arqueiro-elfo-critico",name:"Arqueiro Elfo â€“ CrÃ­tico",class:"arqueiro",race:"elfo"},{id:"arqueiro-halfling-precisao",name:"Arqueiro Halfling â€“ PrecisÃ£o",class:"arqueiro",race:"halfling"},{id:"bardo-humano-buffs",name:"Bardo Humano â€“ Buffs",class:"bardo",race:"humano"},{id:"bardo-elfo-controle",name:"Bardo Elfo â€“ Controle",class:"bardo",race:"elfo"},{id:"monge-humano-regeneracao",name:"Monge Humano â€“ RegeneraÃ§Ã£o",class:"monge",race:"humano"},{id:"assassino-halfling-critico",name:"Assassino Halfling â€“ CrÃ­tico",class:"assassino",race:"halfling"},{id:"assassino-humano-furtividade",name:"Assassino Humano â€“ Furtividade",class:"assassino",race:"humano"},{id:"barbaro-orc-fogo",name:"BÃ¡rbaro Orc â€“ Fogo",class:"barbaro",race:"orc"},{id:"barbaro-humano-terra",name:"BÃ¡rbaro Humano â€“ Terra",class:"barbaro",race:"humano"},{id:"lanceiro-elfo-perfuracao",name:"Lanceiro Elfo â€“ PerfuraÃ§Ã£o",class:"lanceiro",race:"elfo"},{id:"lanceiro-humano-salto",name:"Lanceiro Humano â€“ Salto",class:"lanceiro",race:"humano"},{id:"druida-elfo-equilibrado",name:"Druida Elfo â€“ Equilibrado",class:"druida",race:"elfo"},{id:"druida-humano-suporte",name:"Druida Humano â€“ Suporte",class:"druida",race:"humano"},{id:"feiticeiro-humano-debuffs",name:"Feiticeiro Humano â€“ Debuffs",class:"feiticeiro",race:"humano"},{id:"feiticeiro-orc-invocacoes",name:"Feiticeiro Orc â€“ InvocaÃ§Ãµes",class:"feiticeiro",race:"orc"}];function vi(){return Yl}function Zl(a){const s=kn(a.class,a.race);return{name:"",race:a.race,class:a.class,alignment:"neutro-puro",attributes:s.attributes||kr(),element:s.element,plannedTalents:s.plannedTalents}}const ed="hfn_creation_draft";function yi(a){try{localStorage.setItem(ed,JSON.stringify(a))}catch{}}function td(a){const s=[],t=Qt[a.class];if(t!=null&&t.requirements){const r=t.requirements({attributes:a.attributes,race:a.race});r.ok||s.push(r.message||"Requisitos da classe nÃ£o atendidos")}return Ns(a.attributes),(!a.name||String(a.name).trim().length<2)&&s.push("Nome do herÃ³i nÃ£o definido"),a.race||s.push("RaÃ§a nÃ£o selecionada"),a.class||s.push("Classe nÃ£o selecionada"),{ok:s.length===0,issues:s}}function An(a){const s=[];Ns(a.attributes),s.push({label:"Atributos",status:"ok",detail:"DistribuiÃ§Ã£o completa"});const t=Qt[a.class];if(t!=null&&t.requirements){const o=t.requirements({attributes:a.attributes,race:a.race});s.push({label:"Requisitos de Classe",status:o.ok?"ok":"error",detail:o.ok?"OK":o.message||"Pendentes"})}else s.push({label:"Requisitos de Classe",status:"ok",detail:"OK"});const r=da(a.class,a.race),i=r.includes(a.element);s.push({label:"Sinergia de Elemento",status:i?"ok":"warn",detail:i?"Ideal":`Recomendados: ${r.join(", ")}`});const n=!!a.name&&!!a.race&&!!a.class;return s.push({label:"Campos BÃ¡sicos",status:n?"ok":"error",detail:n?"Nome/RaÃ§a/Classe OK":"Preencha todos os campos"}),s}function Os(a){const s=An(a);return s.some(t=>t.status==="error")?{status:"error",message:"PendÃªncias crÃ­ticas"}:s.some(t=>t.status==="warn")?{status:"warn",message:"Ajustes recomendados"}:{status:"ok",message:"Pronto para criar"}}const ad={guerreiro:["Priorize forÃ§a e constituiÃ§Ã£o","Elementos fÃ­sicos ou terra sÃ£o estÃ¡veis"],mago:["InteligÃªncia e sabedoria elevadas","Luz, gelo ou trevas trazem controle"],ladino:["Destreza alta para crÃ­ticos","Evite elementos lentos"],clerigo:["Sabedoria e suporte","Luz favorece cura"],patrulheiro:["Destreza e visÃ£o tÃ¡tica","TrovÃ£o e vento ajudam mobilidade"],paladino:["ConstituiÃ§Ã£o e forÃ§a","Luz para defesa e cura"],arqueiro:["Destreza e precisÃ£o","TrovÃ£o ou gelo para controle"],bardo:["Carisma e sabedoria","Suporte de grupo Ã© essencial"],monge:["ConstituiÃ§Ã£o e destreza","Terra e vento aumentam sobrevivÃªncia"],assassino:["Destreza e burst","Trevas para sinergia com crÃ­tico"],barbaro:["ForÃ§a e constituiÃ§Ã£o","Fogo aumenta dano"],lanceiro:["Destreza e forÃ§a","TrovÃ£o aumenta alcance"],druida:["Sabedoria e inteligÃªncia","Terra e vento combinam com controle"],feiticeiro:["InteligÃªncia e carisma","Trevas favorecem debuffs"]};function ji(a){return ad[a]||[]}const wi=()=>{var ue,ye,Be,Ge,ke,De,Ne,pe,be,Se,Fe,ze,jt,bt;const[a,s]=x.useState({name:"",race:"humano",class:"guerreiro",alignment:"neutro-puro",attributes:kr(),background:"",backstory:"",element:"physical",skills:[],image:"",battleQuote:""}),[t,r]=x.useState(!1),[i,n]=x.useState(!1),[o,c]=x.useState(!1),[l,d]=x.useState(!1),[m,u]=x.useState(!1);x.useState(!1);const[p,g]=x.useState(!1),[v,y]=x.useState([]),[w,k]=x.useState(!1),[E,h]=x.useState(null),[b,f]=x.useState(!1),[j,N]=x.useState(""),T=x.useRef(null),[F,te]=x.useState(!1),[D,$]=x.useState([]),[X,Q]=x.useState([]),[Y,G]=x.useState([]),{createHero:J,acceptReferralInvite:re}=Z(),{activeSeasonalTheme:ee}=Qe(),fe=Wt(),_=ua(),P=new URLSearchParams(_.search),M=P.get("ref")||void 0,C=P.get("by")||void 0;x.useState(!1);const A=`px-3 py-2 rounded bg-gradient-to-r ${yt(ee)} text-white hover:brightness-110 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1`,O="px-2 py-1 rounded bg-gray-600 text-white text-xs hover:bg-gray-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",S=Ns(a.attributes),I=va(a.class),ae=at.useMemo(()=>{try{return ht(a.attributes,a.class,1)}catch{return}},[a.attributes,a.class]);x.useEffect(()=>{const q=Kr(a.element);console.log("[hero-form] element-adv",{element:a.element,adv:q}),console.log("[hero-form] class-meta",Qt[a.class]);const le=Cn();typeof le.autoSuggestDisabled=="boolean"&&ie(le.autoSuggestDisabled)},[a.element,a.class]),x.useEffect(()=>{const q=le=>{if(le.altKey&&le.key.toLowerCase()==="v"){const Ce=td(a);Ce.ok?N("Build vÃ¡lido âœ…"):N(Ce.issues.join(" â€¢ "))}else if(le.altKey&&le.key.toLowerCase()==="a"){const Ce=da(a.class,a.race);Ce.length&&Oe(Ce[0]),xe(),s(_e=>({..._e,plannedTalents:xs(_e.class)})),N("RecomendaÃ§Ãµes aplicadas")}};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[a]);const ne=x.useRef(null);x.useEffect(()=>{ne.current&&window.clearTimeout(ne.current),ne.current=window.setTimeout(()=>{yi(a)},300)},[a]),x.useEffect(()=>{const q=()=>{try{yi(a)}catch{}};return window.addEventListener("beforeunload",q),()=>window.removeEventListener("beforeunload",q)},[a]);const U=async()=>{n(!0);try{const q=Ql(a.race,5,a.gender);y(q),k(!0)}catch(q){console.error("Erro ao gerar nomes:",q)}finally{n(!1)}},R=q=>{s(le=>({...le,name:q})),k(!1)},L=async()=>{c(!0);try{const q=await Fs("nome",`sexo: ${a.gender}; raÃ§a: ${a.race}; classe: ${a.class}`);q&&(s(le=>({...le,name:q})),k(!1))}catch(q){console.error("Erro ao gerar nome via IA:",q)}finally{c(!1)}},oe=(q,le)=>{let Ce=a.attributes;le&&pr(a.attributes,q)?Ce=tl(a.attributes,q):!le&&gr(a.attributes,q)&&(Ce=al(a.attributes,q)),Ce!==a.attributes&&s(_e=>({..._e,attributes:Ce}))},K=()=>{const q=sl(a.attributes);s(le=>({...le,attributes:q}))},xe=()=>{const q=Bs(a.class),Ce={alta:bi(a.class,a.race).ok?3:2,media:1,baixa:.5},_e={forca:a.element==="fire"?1:0,destreza:a.element==="thunder"||a.element==="ice"?1:0,constituicao:a.element==="earth"?1:0,inteligencia:a.element==="dark"||a.element==="ice"||a.element==="light"?1:0};let Je=Ns(a.attributes),Nt={...a.attributes};const lt=q.sort((ot,xt)=>(Ce[ot.priority]+(_e[ot.attribute]||0))*(ve[ot.attribute]||1)>(Ce[xt.priority]+(_e[xt.attribute]||0))*(ve[xt.attribute]||1)?-1:1);for(;Je>0;){for(const ot of lt)break;break}s(ot=>({...ot,attributes:Nt}))},[W,B]=x.useState(!1),[se,z]=x.useState(null),[V,ie]=x.useState(!1),[he,H]=x.useState(!0),[me,de]=x.useState(!1),[ve,Ae]=x.useState({forca:1,destreza:1,constituicao:1,inteligencia:1,sabedoria:1,carisma:1}),[Te,qe]=x.useState(!1),Oe=q=>{s(le=>({...le,element:q,skills:va(le.class)})),B(!1),z(null),$(le=>[...le,`Elemento alterado para ${q}`]),Q(le=>[...le,{field:"element",prev:String(a.element),next:String(q),timestamp:new Date().toISOString()}]),G([])},it=()=>{const q=zi();Oe(q)},nt=q=>{const le=Qt[q];if(le!=null&&le.requirements){const lt=le.requirements({attributes:a.attributes,race:a.race});if(!lt.ok){N(lt.message||"Requisitos da classe nÃ£o atendidos.");return}}const Ce=va(q),_e=os(q),Je=da(q,a.race),Nt=V?a.element:(a.element==="physical"||!Je.includes(a.element))&&Je.length?Je[0]:a.element;s(lt=>({...lt,class:q,skills:Ce,battleQuote:_e,element:Nt,plannedTalents:[]})),!V&&Nt!==a.element&&(z(a.element),B(!0),H(!0)),$(lt=>[...lt,`Classe alterada para ${q}`]),Q(lt=>[...lt,{field:"class",prev:String(a.class),next:String(q),timestamp:new Date().toISOString()}]),G([])},Xe=q=>{const le=da(a.class),Ce=V?a.element:(a.element==="physical"||!le.includes(a.element))&&le.length?le[0]:a.element;s(_e=>({..._e,race:q,element:Ce})),!V&&Ce!==a.element&&(z(a.element),B(!0),H(!0)),$(_e=>[..._e,`RaÃ§a alterada para ${q}`]),Q(_e=>[..._e,{field:"race",prev:String(a.race),next:String(q),timestamp:new Date().toISOString()}]),G([])},we=()=>{try{const q=J(a);if(M){re(M,q.id);try{const le=Z.getState().getReferralInviteByCode(M);le!=null&&le.id&&Z.getState().logReferralActivity(le.id,"accepted",C?`by:${C}`:`new:${q.id}`)}catch{}}te(!1),fe("/")}catch(q){console.error("Erro ao criar herÃ³i:",q),N("Erro ao criar herÃ³i. Tente novamente.")}},Re=()=>{const q=os(a.class);s(le=>({...le,battleQuote:q}))},rt=async()=>{d(!0);try{const q=`${a.name||"HerÃ³i"}; classe ${a.class}; sexo ${a.gender||"masculino"}; resumo: ${(a.backstory||"").slice(0,180)}`,le=await Fs("frase",q);le&&(s(Ce=>({...Ce,battleQuote:le})),ge.emit({type:"achievement",title:"Frase gerada!",message:"A frase de batalha foi atualizada.",icon:"ğŸ’¬",duration:3500}))}catch(q){console.error("Erro ao gerar frase via IA:",q),ge.emit({type:"quest",title:"Falha ao gerar frase",message:"Verifique a chave de IA e a conexÃ£o.",icon:"âš ï¸",duration:4500})}finally{d(!1)}},Pe=async()=>{g(!0);try{const q=await Vl({race:a.race,klass:a.class,attrs:a.attributes,gender:a.gender});q.image?(s(le=>({...le,image:q.image})),ge.emit({type:"achievement",title:"Avatar gerado!",message:"Imagem criada com IA usando seus dados.",icon:"ğŸ–¼ï¸",duration:4e3})):N("A IA nÃ£o retornou uma imagem. Tente novamente.")}catch(q){console.error("Erro ao gerar imagem via IA:",q),N("Falha ao gerar imagem com IA. Tente novamente mais tarde."),ge.emit({type:"quest",title:"Falha na geraÃ§Ã£o de imagem",message:"Tente novamente mais tarde.",icon:"âš ï¸",duration:4500})}finally{g(!1)}},ce=q=>{var Ce;const le=(Ce=q.target.files)==null?void 0:Ce[0];if(le){const _e=new FileReader;_e.onload=Je=>{var lt;const Nt=(lt=Je.target)==null?void 0:lt.result;s(ot=>({...ot,image:Nt}))},_e.readAsDataURL(le)}},Ie=q=>{q.preventDefault();const le=Qt[a.class];if(le!=null&&le.requirements){const Je=le.requirements({attributes:a.attributes,race:a.race});if(!Je.ok){N(Je.message||"Requisitos da classe nÃ£o atendidos.");return}}const Ce=ci(a.attributes);if(!Ce.valid){N(Ce.errors.join(", ")||"Atributos invÃ¡lidos");return}if(!a.name.trim()){N("Nome Ã© obrigatÃ³rio");return}const _e=Xl(a.name);if(!_e.valid){N(_e.message||"Nome invÃ¡lido");return}te(!0)},Le=()=>{const q=X.slice(-1)[0];if(q){if(Q(le=>le.slice(0,-1)),G(le=>[...le,q]),q.field==="class"){const le=q.prev,Ce=va(le),_e=os(le);s(Je=>({...Je,class:le,skills:Ce,battleQuote:_e})),$(Je=>[...Je,`Desfeito: classe voltou para ${le}`])}else if(q.field==="race"){const le=q.prev;s(Ce=>({...Ce,race:le})),$(Ce=>[...Ce,`Desfeito: raÃ§a voltou para ${le}`])}else if(q.field==="element"){const le=q.prev;s(Ce=>({...Ce,element:le,skills:va(Ce.class)})),$(Ce=>[...Ce,`Desfeito: elemento voltou para ${le}`])}}},ct=()=>{const q=Y.slice(-1)[0];if(q){if(G(le=>le.slice(0,-1)),Q(le=>[...le,q]),q.field==="class"){const le=q.next,Ce=va(le),_e=os(le);s(Je=>({...Je,class:le,skills:Ce,battleQuote:_e})),$(Je=>[...Je,`Refeito: classe alterada para ${le}`])}else if(q.field==="race"){const le=q.next;s(Ce=>({...Ce,race:le})),$(Ce=>[...Ce,`Refeito: raÃ§a alterada para ${le}`])}else if(q.field==="element"){const le=q.next;s(Ce=>({...Ce,element:le,skills:va(Ce.class)})),$(Ce=>[...Ce,`Refeito: elemento alterado para ${le}`])}}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-gray-800 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-3xl font-bold text-amber-400 mb-2 text-center",children:"Forjar Novo HerÃ³i - VersÃ£o 3.0"}),(()=>{const q=Os(a);return e.jsxs("div",{className:`mb-4 p-2 rounded text-sm text-center ${q.status==="ok"?"bg-emerald-700/30 text-emerald-200":q.status==="warn"?"bg-amber-700/30 text-amber-200":"bg-red-700/30 text-red-200"}`,children:["ProntidÃ£o do build: ",q.message]})})(),e.jsx("div",{className:"mb-4 flex items-center justify-end gap-2",children:e.jsxs("select",{onChange:q=>{const le=vi().find(Ce=>Ce.id===q.target.value);le&&s(Ce=>({...Ce,...Zl(le)}))},defaultValue:"",className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:[e.jsx("option",{value:"",disabled:!0,children:"Carregar preset..."}),vi().map(q=>e.jsx("option",{value:q.id,children:q.name},q.id))]})}),e.jsx(Er,{children:e.jsxs("form",{onSubmit:Ie,className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-amber-400 mb-4",children:"1. RaÃ§a e Nome"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"RaÃ§a"}),e.jsxs("select",{value:a.race,onChange:q=>Xe(q.target.value),className:"mt-1 block w-full rounded-md bg-gray-600 border-gray-500 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"humano",children:"Humano"}),e.jsx("option",{value:"elfo",children:"Elfo"}),e.jsx("option",{value:"anao",children:"AnÃ£o"}),e.jsx("option",{value:"orc",children:"Orc"}),e.jsx("option",{value:"halfling",children:"Halfling"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Nome"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:q=>s({...a,name:q.target.value}),className:"mt-1 block w-full rounded-md bg-gray-600 border-gray-500 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Nome do herÃ³i",required:!0}),e.jsx("button",{type:"button",onClick:U,disabled:i,className:"mt-1 px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-md text-sm font-medium transition-colors disabled:opacity-60",children:i?"...":"ğŸ²"}),e.jsx("button",{type:"button",onClick:L,disabled:o,className:"mt-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-sm font-medium transition-colors disabled:opacity-60",children:o?"...":"ğŸ¤– IA"})]}),w&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-600 rounded-md",children:[e.jsxs("p",{className:"text-xs text-gray-300 mb-2",children:["SugestÃµes para ",a.race,":"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:v.map((q,le)=>e.jsx("button",{type:"button",onClick:()=>R(q),className:"px-2 py-1 bg-purple-600 hover:bg-purple-700 rounded text-xs transition-colors",children:q},le))})]}),ji(a.class).length>0&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-gray-800 text-xs text-gray-200",children:[e.jsx("div",{className:"font-semibold",children:"Dicas de classe"}),e.jsx("ul",{className:"mt-1 list-disc pl-5",children:ji(a.class).map((q,le)=>e.jsx("li",{children:q},`tip-${le}`))})]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Sexo"}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>s(q=>({...q,gender:"masculino"})),className:`px-3 py-2 rounded ${(a.gender||"masculino")==="masculino"?"bg-indigo-600 text-white":"bg-gray-600 text-gray-200"}`,children:"Masculino"}),e.jsx("button",{type:"button",onClick:()=>s(q=>({...q,gender:"feminino"})),className:`px-3 py-2 rounded ${a.gender==="feminino"?"bg-pink-600 text-white":"bg-gray-600 text-gray-200"}`,children:"Feminino"})]})]})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-amber-400 mb-4",children:"2. Classe e Habilidades"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Classe"}),e.jsx("div",{role:"radiogroup","aria-label":"SeleÃ§Ã£o de classe",className:"mt-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.values(Qt).map((q,le,Ce)=>e.jsxs("button",{type:"button",role:"radio","aria-checked":a.class===q.id,onClick:()=>nt(q.id),onKeyDown:_e=>{const Je=Ce.map(lt=>lt.id),Nt=Je.indexOf(a.class);if(_e.key==="ArrowRight"||_e.key==="ArrowDown"){const lt=Je[(Nt+1)%Je.length];nt(lt)}else if(_e.key==="ArrowLeft"||_e.key==="ArrowUp"){const lt=Je[(Nt-1+Je.length)%Je.length];nt(lt)}},className:`text-left p-3 rounded border transition-transform duration-200 active:scale-95 focus:scale-105 ${a.class===q.id?"border-amber-500 bg-amber-500/20":"border-gray-600 bg-gray-700"} hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500`,tabIndex:0,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-white font-semibold",children:[q.icon," ",q.name]}),a.class===q.id&&e.jsx("span",{className:"text-xs text-amber-300",children:"Selecionado"})]}),e.jsx("p",{className:"text-xs text-gray-300 mt-1",children:q.description}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["Atributos base: ",Object.entries(q.baseAttributes).map(([_e,Je])=>`${_e}:${Je}`).join(" â€¢ ")]}),e.jsxs("div",{className:"mt-2 text-xs text-emerald-300",children:["Vantagens: ",q.advantages.join(", ")]}),q.disadvantages.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-red-300",children:["Desvantagens: ",q.disadvantages.join(", ")]}),q.requirements&&(()=>{const _e=q.requirements({attributes:a.attributes,race:a.race});return e.jsx("div",{className:`mt-1 text-xs ${_e.ok?"text-emerald-300":"text-yellow-300"}`,children:_e.ok?"Requisitos atendidos":_e.message||"Requisitos pendentes"})})()]},q.id))}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{const q=kn(a.class,a.race);s(le=>({...le,attributes:q.attributes,element:q.element,plannedTalents:q.plannedTalents}))},className:A,children:"Aplicar preset de classe"}),e.jsx("button",{type:"button",onClick:()=>{const q=da(a.class,a.race);q.length&&Oe(q[0]),xe(),s(le=>({...le,plannedTalents:xs(le.class)})),N("RecomendaÃ§Ãµes aplicadas")},className:A,children:"Aplicar recomendaÃ§Ãµes"})]}),e.jsxs("div",{className:"mt-3 p-3 rounded bg-gray-700",children:[e.jsx("div",{className:"text-white font-semibold",children:"Sinergias"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:e.jsx("button",{type:"button",onClick:()=>qe(q=>!q),className:O,children:Te?"Ocultar detalhes":"Mostrar detalhes"})}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[da(a.class,a.race).map(q=>e.jsx("button",{type:"button",onClick:()=>Oe(q),className:`px-2 py-1 rounded text-xs ${a.element===q?"bg-amber-600 text-white":"bg-gray-600 text-gray-200 hover:bg-gray-500"}`,children:q},q)),(((ue=Qt[a.class])==null?void 0:ue.suggestedRaces)||[]).map(q=>e.jsx("button",{type:"button",onClick:()=>Xe(q),className:`px-2 py-1 rounded text-xs ${a.race===q?"bg-amber-600 text-white":"bg-gray-600 text-gray-200 hover:bg-gray-500"}`,children:q},q))]}),Te&&e.jsxs("div",{className:"mt-3 space-y-2 text-xs",children:[(()=>{const q=Kr(a.element),le=Array.isArray(q==null?void 0:q.strong)?q.strong.join(", "):String((q==null?void 0:q.strong)||""),Ce=Array.isArray(q==null?void 0:q.weak)?q.weak.join(", "):String((q==null?void 0:q.weak)||""),_e=Array.isArray(q==null?void 0:q.neutral)?q.neutral.join(", "):String((q==null?void 0:q.neutral)||"");return e.jsxs("div",{className:"text-gray-400",children:["Forte ",le," â€¢ Fraco ",Ce," â€¢ Neutro ",_e]})})(),e.jsxs("div",{className:"p-2 rounded bg-gray-800 text-gray-200",children:[e.jsx("div",{className:"font-semibold",children:"Resumo"}),e.jsxs("div",{children:["Elemento: ",da(a.class,a.race)[0]||"â€”"]}),e.jsxs("div",{children:["RaÃ§as: ",(((ye=Qt[a.class])==null?void 0:ye.suggestedRaces)||[]).join(", ")||"â€”"]}),e.jsxs("div",{children:["Plano: ",Bs(a.class).map(q=>`${q.attribute}:${q.priority}`).join(" â€¢ ")]})]}),(()=>{const q=bi(a.class,a.race);return e.jsxs("div",{className:`${q.ok?"text-emerald-300":"text-yellow-300"}`,children:["Compatibilidade: ",q.message]})})(),e.jsx("div",{className:"flex flex-wrap gap-2",children:Bs(a.class).map(q=>e.jsxs("span",{className:"px-2 py-1 rounded bg-gray-600 text-gray-200",children:[q.attribute,":",q.priority]},q.attribute))}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:V,onChange:q=>{ie(q.target.checked),Wl({autoSuggestDisabled:q.target.checked})}}),"NÃ£o sugerir automaticamente"]}),e.jsx("button",{type:"button",onClick:Le,className:O,children:"Desfazer"}),e.jsx("button",{type:"button",onClick:ct,className:O,children:"Refazer"})]})]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-2",children:ae&&e.jsxs("div",{className:"p-3 rounded bg-gray-700",children:[e.jsx("div",{className:"text-white font-semibold",children:"PrÃ©-visualizaÃ§Ã£o de atributos derivados"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:["HP: ",ae.hp," â€¢ MP: ",ae.mp," â€¢ Iniciativa: ",ae.initiative," â€¢ Classe de Armadura: ",ae.armorClass," â€¢ Sorte: ",ae.luck]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-300 mb-2",children:"Habilidades Iniciais:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:I.map(q=>e.jsxs("div",{className:"bg-gray-600 p-3 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-white",children:q.name}),e.jsxs("p",{className:"text-xs text-gray-300",children:[q.type,q.element?` â€¢ ${q.element}`:""]}),e.jsxs("p",{className:"text-xs text-amber-300",children:["Custo: ",q.cost]})]}),e.jsx("button",{type:"button",onClick:()=>h(E===q.id?null:q.id),className:"text-blue-400 hover:text-blue-300 text-sm",children:"â„¹ï¸"})]}),E===q.id&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-700 rounded text-xs",children:[e.jsx("p",{className:"text-gray-300",children:q.description}),q.basePower&&e.jsxs("p",{className:"text-amber-300",children:["Poder: ",q.basePower]}),q.duration&&e.jsxs("p",{className:"text-green-300",children:["DuraÃ§Ã£o: ",q.duration," turnos"]}),q.cooldown&&e.jsxs("p",{className:"text-red-300",children:["Cooldown: ",q.cooldown," turnos"]})]})]},q.id))})]}),e.jsxs("div",{className:"mt-4 p-4 rounded bg-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:et.icons.classes[((Be=a.class)==null?void 0:Be[0].toUpperCase())+((Ge=a.class)==null?void 0:Ge.slice(1))]||"ğŸ§"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-semibold",children:["PrÃ©via: ",a.name||"â€”"," â€¢ ",a.class]}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Alinhamento: ",a.alignment," â€¢ RaÃ§a: ",a.race]})]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-2",children:An(a).map((q,le)=>e.jsxs("div",{className:`p-2 rounded text-xs ${q.status==="ok"?"bg-emerald-700/30 text-emerald-200":q.status==="warn"?"bg-amber-700/30 text-amber-200":"bg-red-700/30 text-red-200"}`,children:[e.jsx("div",{className:"font-semibold",children:q.label}),q.detail&&e.jsx("div",{children:q.detail})]},`chk-${le}`))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-white font-semibold",children:"Ãrvore de Talentos"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{type:"button",onClick:()=>s(q=>({...q,plannedTalents:xs(q.class)})),className:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-700",children:"Aplicar plano sugerido"})})]}),e.jsx(Jl,{heroClass:a.class,plannedTalents:a.plannedTalents||[],currentLevel:1,onToggle:q=>s(le=>({...le,plannedTalents:(le.plannedTalents||[]).includes(q)?(le.plannedTalents||[]).filter(Ce=>Ce!==q):[...le.plannedTalents||[],q]}))})]})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-amber-400 mb-4",children:"3. Atributos"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("p",{className:"text-sm text-amber-300 font-semibold",children:["Pontos restantes: ",S]}),e.jsx("button",{type:"button",onClick:K,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition-colors",children:"Auto-Distribuir"}),e.jsx("button",{type:"button",onClick:xe,className:"px-3 py-1 bg-emerald-600 hover:bg-emerald-700 rounded text-sm transition-colors",children:"Auto-distribuir recomendaÃ§Ãµes"}),e.jsx("button",{type:"button",onClick:()=>de(q=>!q),className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 rounded text-sm transition-colors",children:me?"Ocultar avanÃ§ado":"PersonalizaÃ§Ã£o avanÃ§ada"})]}),j&&e.jsx("p",{className:"text-sm text-red-400 mb-4",role:"status","aria-live":"polite",children:j}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries(a.attributes).filter(([q])=>["forca","destreza","constituicao","inteligencia"].includes(q)).map(([q,le])=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 capitalize mb-1",children:q}),e.jsx("p",{className:"text-xs text-gray-400 text-center mb-2",children:ws[q].description}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{type:"button",onClick:()=>oe(q,!1),className:"px-2 py-1 bg-red-700 hover:bg-red-600 rounded-l-md disabled:opacity-50 transition-colors",disabled:!gr(a.attributes,q),children:"-"}),e.jsx("span",{className:"px-4 py-1 bg-gray-600 min-w-[3rem] text-center",children:le}),e.jsx("button",{type:"button",onClick:()=>oe(q,!0),className:"px-2 py-1 bg-green-700 hover:bg-green-600 rounded-r-md disabled:opacity-50 transition-colors",disabled:!pr(a.attributes,q),children:"+"})]})]},q))}),me&&e.jsxs("div",{className:"mt-4 p-3 rounded bg-gray-800",children:[e.jsx("div",{className:"text-white font-semibold mb-2",children:"Pesos avanÃ§ados de atributos"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.keys(ve).map(q=>e.jsxs("div",{className:"text-xs text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"capitalize",children:q}),e.jsx("span",{className:"text-amber-300",children:ve[q].toFixed(2)})]}),e.jsx("input",{type:"range",min:.5,max:3,step:.1,value:ve[q],onChange:le=>Ae(Ce=>({...Ce,[q]:Number(le.target.value)})),className:"w-full"})]},`w-${q}`))}),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Os pesos influenciam a auto-distribuiÃ§Ã£o recomendada, permitindo personalizaÃ§Ã£o avanÃ§ada."})]})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-amber-400 mb-4",children:"4. Elemento"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{type:"button",onClick:it,className:`px-3 py-2 rounded-md text-sm font-medium transition-colors bg-gradient-to-r ${yt(ee)} text-white hover:brightness-110 flex items-center gap-2`,children:[((De=(ke=Ke[ee||""])==null?void 0:ke.accents)==null?void 0:De[0])||"",e.jsx("span",{children:"ğŸ² Gerar AleatÃ³rio"})]}),e.jsx("button",{type:"button",onClick:()=>f(!b),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors bg-gradient-to-r ${yt(ee)} text-white hover:brightness-110`,children:"â„¹ï¸ RelaÃ§Ãµes"})]}),b&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-600 rounded-md text-sm",children:[e.jsx("h5",{className:"font-medium text-white mb-2",children:"Vantagens Elementais:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsx("p",{children:"Fogo vence Gelo"}),e.jsx("p",{children:"Gelo vence TrovÃ£o"}),e.jsx("p",{children:"TrovÃ£o vence Terra"}),e.jsx("p",{children:"Terra vence Fogo"}),e.jsx("p",{children:"Luz contra Sombra"}),e.jsx("p",{children:"FÃ­sico Ã© neutro"})]})]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-7 gap-2",children:Object.entries(Zs).map(([q,le])=>e.jsxs("button",{type:"button",onClick:()=>Oe(q),className:`p-3 rounded-md text-center transition-colors ${a.element===q?"bg-amber-600 text-white":"bg-gray-600 hover:bg-gray-500 text-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:le.icon}),e.jsx("div",{className:"text-xs",children:le.name})]},q))})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-amber-400 mb-4",children:"5. HistÃ³ria"}),e.jsxs("div",{className:"flex gap-3 mb-2",children:[e.jsxs("button",{type:"button",onClick:()=>{r(!0),setTimeout(()=>{const q=Ll(a);s(le=>({...le,backstory:q})),r(!1)},600)},className:`px-3 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-60 bg-gradient-to-r ${yt(ee)} text-white hover:brightness-110 flex items-center gap-2`,disabled:t||!a.name.trim(),children:[((pe=(Ne=Ke[ee||""])==null?void 0:Ne.accents)==null?void 0:pe[0])||"",e.jsx("span",{children:t?"Gerando...":"Gerar histÃ³ria"})]}),e.jsx("button",{type:"button",onClick:async()=>{u(!0);try{const q=`${a.name||"HerÃ³i"}, sexo ${a.gender||"masculino"}, classe ${a.class}, raÃ§a ${a.race}, elemento ${a.element}`,le=await Fs("historia",q);s(Ce=>({...Ce,backstory:le})),ge.emit({type:"achievement",title:"HistÃ³ria gerada!",message:"A histÃ³ria do herÃ³i foi atualizada.",icon:"ğŸ“–",duration:4e3})}catch(q){console.error("Erro ao gerar histÃ³ria via IA:",q),ge.emit({type:"quest",title:"Falha ao gerar histÃ³ria",message:"Verifique a chave de IA e a conexÃ£o.",icon:"âš ï¸",duration:4500})}finally{u(!1)}},className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-sm font-medium transition-colors disabled:opacity-60",disabled:m||!a.name.trim(),children:m?"Gerando...":"ğŸ¤– HistÃ³ria (IA)"})]}),e.jsx("textarea",{value:a.backstory||"",onChange:q=>s({...a,backstory:q.target.value}),rows:4,className:"mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Conte a histÃ³ria do seu herÃ³i..."})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-amber-400 mb-4",children:"6. Frase de Batalha"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("button",{type:"button",onClick:Re,className:`px-3 py-2 rounded-md text-sm font-medium transition-colors bg-gradient-to-r ${yt(ee)} text-white hover:brightness-110 flex items-center gap-2`,children:[((Se=(be=Ke[ee||""])==null?void 0:be.accents)==null?void 0:Se[0])||"",e.jsx("span",{children:"ğŸ² Gerar AleatÃ³ria"})]}),e.jsxs("button",{type:"button",onClick:rt,disabled:l,className:`px-3 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-60 bg-gradient-to-r ${yt(ee)} text-white hover:brightness-110 flex items-center gap-2`,children:[((ze=(Fe=Ke[ee||""])==null?void 0:Fe.accents)==null?void 0:ze[0])||"",e.jsx("span",{children:l?"Gerando...":"ğŸ¤– Gerar com IA"})]})]}),e.jsx("textarea",{value:a.battleQuote||"",onChange:q=>s({...a,battleQuote:q.target.value}),rows:2,className:"w-full rounded-md bg-gray-600 border-gray-500 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Digite uma frase Ã©pica conectada Ã  histÃ³ria..."})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-amber-400 mb-4",children:"7. Imagem do HerÃ³i"}),e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:T,type:"file",accept:"image/*",onChange:ce,className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>{var q;return(q=T.current)==null?void 0:q.click()},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md font-medium transition-colors",children:"ğŸ“ Upload de Imagem"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Formatos aceitos: JPG, PNG, GIF (mÃ¡x. 5MB)"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("button",{type:"button",onClick:Pe,disabled:p,className:`w-full px-4 py-2 rounded-md font-medium transition-colors disabled:opacity-60 bg-gradient-to-r ${yt(ee)} text-white hover:brightness-110 flex items-center gap-2`,children:[((bt=(jt=Ke[ee||""])==null?void 0:jt.accents)==null?void 0:bt[0])||"",e.jsx("span",{children:p?"Gerando...":"ğŸ¤– Gerar Avatar IA"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Usa sexo, raÃ§a, classe e (opcional) resumo da histÃ³ria para criar a imagem."})]}),a.image&&e.jsx("div",{className:"w-24 h-24 bg-gray-600 rounded-md overflow-hidden",children:e.jsx("img",{src:a.image.includes("image.pollinations.ai/prompt/")?a.image.replace("https://image.pollinations.ai/prompt/","/api/pollinations-image?prompt=").replace("?n=1&","&"):a.image,alt:"Preview do herÃ³i",className:"w-full h-full object-cover"})})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"submit",className:"px-8 py-4 bg-amber-600 hover:bg-amber-700 rounded-md font-bold text-lg transition-colors disabled:opacity-60",disabled:!ci(a.attributes).valid||!a.name.trim(),children:"âš”ï¸ Forjar HerÃ³i"})})]})}),F&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-create-title",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>te(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-lg rounded-lg border border-gray-700 bg-gray-800 p-4 shadow-xl",children:[e.jsx("h2",{id:"confirm-create-title",className:"text-lg font-bold text-white",children:"Confirmar CriaÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-gray-300 mt-1",children:["VocÃª estÃ¡ prestes a criar ",a.name||"um herÃ³i"," da classe ",a.class,". Deseja concluir?"]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-400",children:["Atributos: ",Object.entries(a.attributes).map(([q,le])=>`${q}:${le}`).join(" â€¢ ")]}),a.plannedTalents&&a.plannedTalents.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-amber-300",children:["Talentos planejados: ",a.plannedTalents.length]}),D.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"HistÃ³rico de decisÃµes:"}),e.jsx("ul",{className:"mt-1 text-xs text-gray-400 list-disc pl-5",children:D.slice(-6).map((q,le)=>e.jsx("li",{children:q},`log-${le}`))}),e.jsx("div",{className:"mt-2 flex gap-2 justify-end",children:e.jsx("button",{type:"button",onClick:async()=>{try{await navigator.clipboard.writeText(JSON.stringify(D))}catch{}},className:"px-2 py-1 rounded bg-gray-600 text-white text-xs",children:"Exportar histÃ³rico"})})]}),(()=>{const q=Os(a);return e.jsxs("div",{className:`mt-2 p-2 rounded text-xs text-center ${q.status==="ok"?"bg-emerald-700/30 text-emerald-200":q.status==="warn"?"bg-amber-700/30 text-amber-200":"bg-red-700/30 text-red-200"}`,children:["ProntidÃ£o: ",q.message]})})(),e.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>te(!1),className:"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700",children:"Voltar"}),(()=>{const le=Os(a).status==="error";return e.jsx("button",{type:"button",onClick:we,disabled:le,className:`px-3 py-2 rounded ${le?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-emerald-600 text-white hover:bg-emerald-700"}`,children:"Confirmar"})})()]})]})]})]})},sd=({achievement:a,isUnlocked:s=!1,showProgress:t=!1})=>{const r=a.maxProgress?Math.round(a.progress/a.maxProgress*100):100,i=o=>{switch(o){case"comum":return"text-slate-300 border-slate-600";case"raro":return"text-blue-300 border-blue-500/40";case"Ã©pico":return"text-violet-300 border-violet-500/40";case"lendÃ¡rio":return"text-amber-300 border-amber-500/40";default:return"text-slate-300 border-slate-600"}},n=o=>{switch(o){case"comum":return"bg-slate-500";case"raro":return"bg-blue-500";case"Ã©pico":return"bg-violet-500";case"lendÃ¡rio":return"bg-amber-500";default:return"bg-slate-500"}};return e.jsxs("div",{className:`
        relative p-4 rounded-lg border-2 transition-all duration-200 bg-slate-800
        ${s?`${i(a.rarity)} shadow-md`:"text-slate-400 border-slate-700 opacity-60"}
        ${s?"hover:shadow-xl transform hover:-translate-y-1":""}
      `,children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`
            w-12 h-12 rounded-full flex items-center justify-center text-2xl
            ${s?"bg-slate-700":"bg-slate-600"}
          `,children:a.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:`font-bold text-lg ${s?"text-white":"text-slate-400"}`,children:a.title}),e.jsx("span",{className:`
                px-2 py-1 rounded-full text-xs font-medium uppercase tracking-wide
                ${s?"bg-slate-700 text-slate-200 border border-slate-600":"bg-slate-700 text-slate-400 border border-slate-600"}
              `,children:a.rarity})]}),e.jsx("p",{className:`text-sm mb-2 ${s?"text-slate-300":"text-slate-400"}`,children:a.description}),t&&a.maxProgress&&a.maxProgress>1&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 text-slate-300",children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[a.progress,"/",a.maxProgress]})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${n(a.rarity)}`,style:{width:`${r}%`}})})]}),s&&a.unlockedAt&&e.jsxs("div",{className:"text-xs text-slate-400 mt-2",children:["Desbloqueado em ",new Date(a.unlockedAt).toLocaleDateString("pt-BR")]}),a.rewards&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[a.rewards.xp&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-emerald-900/30 text-emerald-300 border border-emerald-700/40",children:["+",a.rewards.xp," XP"]}),a.rewards.gold&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-amber-900/30 text-amber-300 border border-amber-700/40",children:["+",a.rewards.gold," ğŸª™"]}),a.rewards.title&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-violet-900/30 text-violet-300 border border-violet-700/40",children:["TÃ­tulo: ",a.rewards.title]})]})]})]}),s&&e.jsx("div",{className:"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-amber-300/10 to-transparent opacity-0 hover:opacity-20 transition-opacity duration-300 pointer-events-none"})]})},rd=({hero:a})=>{var w,k,E;const[s,t]=x.useState("all"),[r,i]=x.useState("all"),n=Oi.map(h=>{const b=a.progression.achievements.find(j=>j.id===h.id);if(b)return{...b,isUnlocked:!0};let f=0;switch(h.id){case"primeira-missao":f=a.stats.questsCompleted>=1?1:0;break;case"heroi-da-vila":f=Math.min(h.maxProgress,a.stats.questsCompleted);break;case"cacador-experiente":f=Math.min(h.maxProgress,Math.floor(a.stats.questsCompleted*.4));break;case"explorador-corajoso":f=Math.min(h.maxProgress,Math.floor(a.stats.questsCompleted*.3));break;case"lenda-epica":f=Math.min(h.maxProgress,Math.floor(a.stats.questsCompleted*.1));break;case"amigo-dos-animais":f=Math.min(h.maxProgress,a.stats.companionQuestsCompleted||0);break;case"domador-de-feras":f=Math.min(h.maxProgress,a.stats.beastEssenceCollected||0);break;case"cavaleiro-mitico":f=Math.min(h.maxProgress,a.stats.mountScrollsFound||0);break}return{...h,progress:f,isUnlocked:!1}}),o=Number(((w=a.stats)==null?void 0:w.miniCardsWins)||0),c=Number(((k=a.stats)==null?void 0:k.miniRpsBestStreak)||0),l=[{id:"cards-champion-achievement",title:"CampeÃ£o das Cartas",description:"VenÃ§a 10 partidas no Jogo das Cartas",icon:"ğŸƒ",maxProgress:10,progress:o,isUnlocked:!!(a.achievements||[]).find(h=>h.id==="cards-champion-achievement")||!!(a.progression.achievements||[]).find(h=>h.id==="cards-champion-achievement")},{id:"rps-master-achievement",title:"Mestre do RPS",description:"Alcance sequÃªncia de 5 vitÃ³rias em RPS",icon:"ğŸ¯",maxProgress:5,progress:c,isUnlocked:!!(a.achievements||[]).find(h=>h.id==="rps-master-achievement")||!!(a.progression.achievements||[]).find(h=>h.id==="rps-master-achievement")}],d=[...n,...l],m=d.filter(h=>!(s==="unlocked"&&!h.isUnlocked||s==="locked"&&h.isUnlocked||r!=="all"&&h.rarity!==r)),u=d.filter(h=>h.isUnlocked).length,p=d.length,g=Math.round(u/p*100),{activeSeasonalTheme:v}=Qe(),y=v&&((E=Ke[v])==null?void 0:E.border)||"border-amber-600/30";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`bg-gradient-to-r ${et.gradients.backgrounds.hero} text-white p-6 rounded-lg border border-slate-700`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ğŸ† Conquistas"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold",children:[u,"/",p]}),e.jsx("div",{className:"text-sm opacity-90",children:"Desbloqueadas"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm mb-1",children:"Progresso Geral"}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 bg-gradient-to-r ${et.gradients.buttons.royal}`,style:{width:`${g}%`}})}),e.jsxs("div",{className:"text-sm mt-1",children:[g,"% completo"]})]})]})]}),e.jsxs("div",{className:`flex flex-wrap gap-4 p-4 rounded-lg border ${y} bg-gray-800`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-200",children:"Status:"}),e.jsxs("select",{value:s,onChange:h=>t(h.target.value),className:"px-3 py-1 border border-gray-700 bg-gray-900 text-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"unlocked",children:"Desbloqueadas"}),e.jsx("option",{value:"locked",children:"Bloqueadas"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-200",children:"Raridade:"}),e.jsxs("select",{value:r,onChange:h=>i(h.target.value),className:"px-3 py-1 border border-gray-700 bg-gray-900 text-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"comum",children:"Comum"}),e.jsx("option",{value:"raro",children:"Raro"}),e.jsx("option",{value:"Ã©pico",children:"Ã‰pico"}),e.jsx("option",{value:"lendÃ¡rio",children:"LendÃ¡rio"})]})]})]}),e.jsx("div",{className:"grid gap-4",children:m.length>0?m.map(h=>e.jsx(sd,{achievement:h,isUnlocked:h.isUnlocked,showProgress:!h.isUnlocked},h.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ”"}),e.jsx("div",{children:"Nenhuma conquista encontrada com os filtros selecionados."})]})}),a.progression.titles&&a.progression.titles.length>0&&e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"ğŸ–ï¸ TÃ­tulos Conquistados"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.progression.titles.map((h,b)=>e.jsx("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium text-white bg-gradient-to-r ${et.gradients.buttons.royal} border border-purple-700/40`,children:h},b))})]}),e.jsxs("div",{className:"bg-blue-900/20 p-4 rounded-lg border border-blue-600/30",children:[e.jsx("h4",{className:"font-semibold text-blue-300 mb-2",children:"ğŸ’¡ PrÃ³ximas Conquistas"}),e.jsxs("div",{className:"text-sm text-blue-200 space-y-1",children:[!a.progression.achievements.some(h=>h.id==="primeira-missao")&&e.jsx("div",{children:'â€¢ Complete sua primeira missÃ£o para desbloquear "Primeira Aventura"'}),a.stats.questsCompleted<5&&e.jsxs("div",{children:["â€¢ Complete ",5-a.stats.questsCompleted,' missÃµes para "HerÃ³i da Vila"']}),a.stats.questsCompleted<10&&e.jsx("div",{children:"â€¢ Continue completando missÃµes para desbloquear mais conquistas!"}),(a.stats.companionQuestsCompleted||0)<5&&e.jsxs("div",{children:["â€¢ Conclua ",5-(a.stats.companionQuestsCompleted||0),' missÃµes de Companheiros para "Amigo dos Animais"']}),(a.stats.beastEssenceCollected||0)<3&&e.jsxs("div",{children:["â€¢ Colete ",3-(a.stats.beastEssenceCollected||0),' EssÃªncias Bestiais para "Domador de Feras"']}),(a.stats.mountScrollsFound||0)<2&&e.jsxs("div",{children:["â€¢ Encontre ",2-(a.stats.mountScrollsFound||0),' Pergaminhos de Montaria para "Cavaleiro MÃ­tico"']})]})]})]})},id=({hero:a})=>{const s=t=>{const r=Math.min(6,Math.max(0,[...Array(7)].findIndex((c,l)=>t<[-1e3,-500,-100,0,100,500,1e3][l+1]||l===6))),i=[-1e3,-500,-100,0,100,500,1e3][r],n=[-1e3,-500,-100,0,100,500,1e3][r+1]||1e3;if(t>=1e3)return 100;if(t<=-1e3)return 0;const o=(t-i)/(n-i)*100;return Math.max(0,Math.min(100,o))};return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-amber-400 mb-4 flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ReputaÃ§Ã£o das FacÃ§Ãµes"]}),e.jsx("div",{className:"space-y-4",children:(a.reputationFactions||[]).map(t=>{const r=As(t.reputation),i=sc(a,t.name),n=jr[t.name],o=s(t.reputation);return e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",title:`${r.name}: ${r.description}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400",children:n==null?void 0:n.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`font-bold ${r.color}`,children:r.name}),e.jsxs("div",{className:"text-sm text-gray-400",children:[t.reputation,"/1000"]}),(i.goldBonus!==0||i.xpBonus!==0)&&e.jsxs("div",{className:"text-xs text-gray-300 mt-1",children:[i.goldBonus!==0&&e.jsxs("span",{className:i.goldBonus>0?"text-yellow-300":"text-red-400",children:["Ouro ",i.goldBonus>0?"+":"",Math.round(i.goldBonus*100),"%"]}),i.xpBonus!==0&&e.jsxs("span",{className:`ml-2 ${i.xpBonus>0?"text-blue-300":"text-red-400"}`,children:["XP ",i.xpBonus>0?"+":"",Math.round(i.xpBonus*100),"%"]})]})]})]}),e.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2 mb-3",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${t.reputation>=0?"bg-gradient-to-r from-green-500 to-blue-500":"bg-gradient-to-r from-red-500 to-orange-500"}`,style:{width:`${o}%`}})}),(i.goldBonus!==0||i.xpBonus!==0)&&e.jsxs("div",{className:"flex space-x-4 text-sm",children:[i.goldBonus!==0&&e.jsxs("span",{className:i.goldBonus>0?"text-yellow-400":"text-red-400",children:["Gold: ",i.goldBonus>0?"+":"",Math.round(i.goldBonus*100),"%"]}),i.xpBonus!==0&&e.jsxs("span",{className:i.xpBonus>0?"text-blue-400":"text-red-400",children:["XP: ",i.xpBonus>0?"+":"",Math.round(i.xpBonus*100),"%"]})]}),r.questModifiers.specialQuestsUnlocked.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-purple-400 font-medium",children:"MissÃµes Especiais:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:r.questModifiers.specialQuestsUnlocked.map(c=>e.jsx("span",{className:"px-2 py-1 bg-purple-600/30 text-purple-300 text-xs rounded",children:c.replace("_"," ")},c))})]}),n&&e.jsxs("div",{className:"mt-3 text-xs",children:[n.allyFactions.length>0&&e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-green-400",children:"Aliados: "}),e.jsx("span",{className:"text-gray-400",children:n.allyFactions.join(", ")})]}),n.opposingFactions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-red-400",children:"Inimigos: "}),e.jsx("span",{className:"text-gray-400",children:n.opposingFactions.join(", ")})]})]})]},t.name)})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-900/30 rounded-lg border border-blue-500/30",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-400 mb-2",children:"ğŸ’¡ Dicas de ReputaÃ§Ã£o"}),e.jsxs("ul",{className:"text-xs text-gray-300 space-y-1",children:[e.jsx("li",{children:"â€¢ MissÃµes do hub da Guilda afetam sua reputaÃ§Ã£o com facÃ§Ãµes"}),e.jsx("li",{children:"â€¢ Maior reputaÃ§Ã£o = melhores recompensas e missÃµes especiais"}),e.jsx("li",{children:"â€¢ Cuidado: algumas facÃ§Ãµes sÃ£o inimigas entre si"}),e.jsx("li",{children:"â€¢ ReputaÃ§Ã£o negativa pode fechar certas oportunidades"})]})]})]})},nd=({hero:a})=>{var E;const{allocateAttributePoints:s}=Z(),[t,r]=x.useState({}),[i,n]=x.useState(""),o=a.attributePoints||0,c=((E=a.rankData)==null?void 0:E.currentRank)||We.calculateRank(a),l=x.useMemo(()=>Cr(c),[c]),d=x.useMemo(()=>Object.values(t).reduce((h,b)=>h+(typeof b=="number"?Math.max(0,b):0),0),[t]),m=Math.max(0,o-d),u=x.useMemo(()=>["forca","destreza","constituicao","inteligencia"],[]),p=h=>{const b=a.attributes[h],f=t[h]||0;return m>0&&b+f<l},g=h=>(t[h]||0)>0,v=h=>{p(h)&&r(b=>({...b,[h]:(b[h]||0)+1}))},y=h=>{g(h)&&r(b=>({...b,[h]:Math.max(0,(b[h]||0)-1)}))},w=()=>{r({}),n("")},k=()=>{if(d<=0){n("Selecione pelo menos 1 ponto para aplicar.");return}s(a.id,t)?(n("Pontos aplicados com sucesso!"),w()):n("NÃ£o foi possÃ­vel aplicar. Verifique limites e pontos disponÃ­veis.")};return o<=0?e.jsx("div",{className:"bg-gray-700 p-4 rounded border border-gray-600 text-sm text-gray-200",children:"Nenhum ponto de atributo disponÃ­vel no momento."}):e.jsxs("div",{className:"bg-gray-700 p-4 rounded border border-gray-600 space-y-4 text-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-300",children:["Pontos disponÃ­veis: ",e.jsx("span",{className:"font-semibold",children:o})]}),e.jsxs("div",{className:"text-sm text-gray-300",children:["A gastar: ",e.jsx("span",{className:"font-semibold",children:d})," â€¢ Restantes: ",e.jsx("span",{className:"font-semibold",children:m})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.map(h=>{const b=ws[h],f=a.attributes[h],j=t[h]||0,N=f+j;return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-3 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:b.icon}),e.jsx("span",{className:"font-medium text-white",children:b.name})]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[f," â†’ ",e.jsx("span",{className:"font-semibold",children:N})]})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-400 leading-snug min-w-0 break-words",children:b.description}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{className:`px-2 py-1 text-sm rounded ${g(h)?"bg-gray-700 text-gray-200 hover:bg-gray-600":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,onClick:()=>y(h),disabled:!g(h),children:"-"}),e.jsx("div",{className:"w-8 text-center text-sm",children:j||0}),e.jsx("button",{className:`px-2 py-1 text-sm rounded ${p(h)?`bg-gradient-to-r ${et.gradients.buttons.primary} text-white`:"bg-gray-800 text-gray-500 cursor-not-allowed"}`,onClick:()=>v(h),disabled:!p(h),children:"+"})]})]})]},h)})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{className:"px-3 py-2 text-sm rounded bg-gray-700 text-gray-200 hover:bg-gray-600",onClick:w,children:"Cancelar"}),e.jsx("button",{className:`px-3 py-2 text-sm rounded ${d>0?`bg-gradient-to-r ${et.gradients.buttons.primary} text-white`:"bg-gray-800 text-gray-500 cursor-not-allowed"}`,onClick:k,disabled:d<=0,children:"Aplicar"})]}),i&&e.jsx("div",{className:"text-xs text-gray-400",children:i})]})},Me={surface:"bg-gray-800",surfaceText:"text-gray-100",cardBase:"bg-gray-800 p-6 rounded-lg text-gray-100",tabActive:"bg-gray-700 text-white border-gray-600",tabInactive:"bg-gray-900 text-gray-200 border-gray-700 hover:bg-gray-800",breadcrumbText:"text-gray-400"},od=({hero:a})=>{var D;const s=ua(),[t,r]=x.useState("overview"),{useItem:i,equipItem:n,sellItem:o,unequipItem:c}=Z(),{activeSeasonalTheme:l}=Qe(),d=l&&((D=Ke[l])==null?void 0:D.border)||"border-amber-600/30",m=a.progression.level>=pn,u=xr(a.progression.level),p=m?u:xr(a.progression.level+1),g=a.progression.xp-u,v=Math.max(0,g),y=Math.max(1,p-u),w=m?100:Math.max(0,Math.min(100,v/y*100)),k=[a.inventory.equippedMainHand,a.inventory.equippedOffHand].filter(Boolean).map($=>Ee.find(X=>X.id===$)).filter(Boolean),E=[a.inventory.equippedHelm,a.inventory.equippedChest,a.inventory.equippedBelt,a.inventory.equippedGloves,a.inventory.equippedBoots,a.inventory.equippedCape].filter(Boolean).map($=>Ee.find(X=>X.id===$)).filter(Boolean),h=[a.inventory.equippedRingLeft,a.inventory.equippedRingRight,a.inventory.equippedNecklace,a.inventory.equippedEarringLeft,a.inventory.equippedEarringRight].filter(Boolean).map($=>Ee.find(X=>X.id===$)).filter(Boolean),f=(()=>{let $={attack:0,defense:0,hp:0,mp:0};return[...k,...E,...h].forEach(X=>{if(X&&(X.effects&&($.attack+=X.effects.attack||0,$.defense+=X.effects.defense||0,$.hp+=X.effects.hp||0,$.mp+=X.effects.mp||0),X.bonus)){const Q=X.bonus.forca||0,Y=X.bonus.destreza||0,G=X.bonus.constituicao||0,J=X.bonus.inteligencia||0;$.attack+=Q,$.defense+=Math.floor(Y/4),$.hp+=Math.floor(G/2)*a.progression.level,$.mp+=Math.floor(J/2)*a.progression.level}}),$})(),j=[{id:"overview",label:"VisÃ£o Geral",icon:"ğŸ“Š"},{id:"equipment",label:"Equipamentos",icon:"âš”ï¸"},{id:"achievements",label:"Conquistas",icon:"ğŸ†"},{id:"reputation",label:"ReputaÃ§Ã£o",icon:"â­"}],N=x.useMemo(()=>[a.derivedAttributes.hp,a.derivedAttributes.mp,a.derivedAttributes.armorClass,a.derivedAttributes.initiative,a.derivedAttributes.luck].join("-"),[a.derivedAttributes.hp,a.derivedAttributes.mp,a.derivedAttributes.armorClass,a.derivedAttributes.initiative,a.derivedAttributes.luck]),[T,F]=x.useState(!1);x.useEffect(()=>{F(!0);const $=setTimeout(()=>F(!1),1400);return()=>clearTimeout($)},[N]);const te=typeof a.derivedAttributes.power=="number"?a.derivedAttributes.power:ht(a.attributes,a.class,a.progression.level,a.inventory,a.activeTitle).power;return x.useEffect(()=>{if(s.hash){const $=s.hash.replace("#",""),X=document.getElementById($);X&&X.scrollIntoView({behavior:"smooth",block:"start"})}},[s.hash]),e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsx("div",{className:`bg-gradient-to-r ${et.gradients.backgrounds.hero} text-white p-6 rounded-lg border border-slate-700 shadow-xl`,children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-6xl",children:a.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:a.name}),e.jsxs("p",{className:"text-lg opacity-90",children:[a.class," â€¢ NÃ­vel ",a.progression.level]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"ğŸª™"}),e.jsx("span",{children:a.progression.gold})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"â­"}),e.jsx("span",{children:a.progression.reputation})]})]})]})]})}),e.jsx("div",{className:"border-b border-slate-700",children:e.jsx("nav",{className:"flex gap-2 flex-wrap",children:j.map($=>e.jsxs("button",{onClick:()=>r($.id),className:`flex items-center gap-2 py-2 px-3 rounded border font-medium text-sm transition-colors ${t===$.id?Me.tabActive:Me.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:[e.jsx("span",{children:$.icon}),e.jsxs("span",{className:"flex items-center gap-2",children:[$.label,$.id==="overview"&&typeof a.attributePoints=="number"&&a.attributePoints>0&&e.jsxs("span",{className:"ml-1 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-amber-600 text-white animate-pulse",children:[a.attributePoints," pts"]})]})]},$.id))})}),t==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:`${Me.cardBase} border ${d}`,children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"ğŸ“ˆ ProgressÃ£o"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-300",children:"ExperiÃªncia"}),e.jsx("span",{className:"text-gray-200",children:m?"MAX":`${a.progression.xp} XP`})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`bg-gradient-to-r ${et.gradients.buttons.success} h-3 rounded-full transition-all duration-500`,style:{width:`${w}%`}})}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:m?"NÃ­vel MÃ¡ximo":`${v}/${y} XP para o nÃ­vel ${a.progression.level+1}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:a.stats.questsCompleted}),e.jsx("div",{className:"text-sm text-gray-300",children:"MissÃµes Completas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:a.stats.totalCombats}),e.jsx("div",{className:"text-sm text-gray-300",children:"Combates"})]})]})]})]}),e.jsxs("div",{id:"atributos",className:`${Me.cardBase} border border-slate-700`,children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"ğŸ’ª Atributos"}),e.jsx("div",{className:"mb-4",children:e.jsx(nd,{hero:a})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"ForÃ§a"}),e.jsx("span",{className:"font-medium text-white",children:a.attributes.forca})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Destreza"}),e.jsx("span",{className:"font-medium text-white",children:a.attributes.destreza})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"ConstituiÃ§Ã£o"}),e.jsx("span",{className:"font-medium text-white",children:a.attributes.constituicao})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"InteligÃªncia"}),e.jsx("span",{className:"font-medium text-white",children:a.attributes.inteligencia})]})})]}),e.jsxs("div",{className:`mt-6 pt-4 border-t border-slate-700 transition ${T?"ring-2 ring-amber-500 rounded-md":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-white",children:"Atributos Derivados"}),T&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs bg-amber-600/20 text-amber-400",children:[e.jsx("span",{children:"âš¡"}),e.jsx("span",{children:"Atributos atualizados"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"HP"}),e.jsxs("span",{className:"font-medium text-white",children:[a.derivedAttributes.currentHp,"/",a.derivedAttributes.hp,f.hp>0&&e.jsxs("span",{className:"text-green-600",children:[" (+",f.hp,")"]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"MP"}),e.jsxs("span",{className:"font-medium text-white",children:[a.derivedAttributes.currentMp,"/",a.derivedAttributes.mp,f.mp>0&&e.jsxs("span",{className:"text-blue-600",children:[" (+",f.mp,")"]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Ataque"}),e.jsxs("span",{className:"font-medium text-white",children:[a.attributes.forca,f.attack>0&&e.jsxs("span",{className:"text-red-600",children:[" (+",f.attack,")"]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Defesa"}),e.jsxs("span",{className:"font-medium text-white",children:[a.derivedAttributes.armorClass,f.defense>0&&e.jsxs("span",{className:"text-blue-600",children:[" (+",f.defense,")"]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Poder"}),e.jsx("span",{className:"font-medium text-white",children:te})]})]})]})]}),e.jsxs("div",{className:`${Me.cardBase} border ${d} lg:col-span-2`,children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"ğŸ’ InventÃ¡rio"}),Object.keys(a.inventory.items).length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:Object.entries(a.inventory.items).map(([$,X])=>{const Q=Ee.find(Y=>Y.id===$);return!Q||X<=0?null:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:Q.icon}),e.jsx("div",{className:"text-sm font-medium text-white",children:Q.name}),e.jsxs("div",{className:"text-xs text-gray-300",children:["x",X]}),Q.type==="consumable"&&e.jsx("button",{onClick:()=>i(a.id,$),className:"mt-2 px-2 py-1 bg-emerald-600 text-white text-xs rounded hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Usar"})]},$)})}):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ“¦"}),e.jsx("div",{children:"InventÃ¡rio vazio"})]})]})]}),t==="equipment"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:`${Me.cardBase} border ${d}`,children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-white",children:"âš”ï¸ Armas"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["mainHand","offHand"].map(($,X)=>{const Q=$==="mainHand"?a.inventory.equippedMainHand:a.inventory.equippedOffHand,Y=Q?Ee.find(G=>G.id===Q):null;return e.jsx("div",{className:"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded",children:Y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:Y.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:Y.name}),e.jsx("div",{className:"text-xs text-gray-300",children:Y.description})]})]}),e.jsx("button",{onClick:()=>c(a.id,Q),className:"px-3 py-1 bg-gray-700 text-white text-sm rounded",children:"Desequipar"})]}):e.jsx("div",{className:"text-gray-400 text-center w-full",children:"Slot vazio"})},`w-${X}`)})})]}),e.jsxs("div",{className:`${Me.cardBase} border ${d}`,children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-white",children:"ğŸ›¡ï¸ Armaduras"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["helm","chest","belt","gloves","boots","cape"].map($=>{const X=$==="helm"?a.inventory.equippedHelm:$==="chest"?a.inventory.equippedChest:$==="belt"?a.inventory.equippedBelt:$==="gloves"?a.inventory.equippedGloves:$==="boots"?a.inventory.equippedBoots:a.inventory.equippedCape,Q=X?Ee.find(Y=>Y.id===X):null;return e.jsx("div",{className:"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded",children:Q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:Q.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:Q.name}),e.jsx("div",{className:"text-xs text-gray-300",children:Q.description})]})]}),e.jsx("button",{onClick:()=>c(a.id,X),className:"px-3 py-1 bg-gray-700 text-white text-sm rounded",children:"Desequipar"})]}):e.jsx("div",{className:"text-gray-400 text-center w-full",children:"Slot vazio"})},`a-${$}`)})})]}),e.jsxs("div",{className:`${Me.cardBase} border ${d}`,children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-white",children:"ğŸ’ AcessÃ³rios"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["ringLeft","ringRight","necklace","earringLeft","earringRight"].map($=>{const X=$==="ringLeft"?a.inventory.equippedRingLeft:$==="ringRight"?a.inventory.equippedRingRight:$==="necklace"?a.inventory.equippedNecklace:$==="earringLeft"?a.inventory.equippedEarringLeft:a.inventory.equippedEarringRight,Q=X?Ee.find(Y=>Y.id===X):null;return e.jsx("div",{className:"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded",children:Q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:Q.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:Q.name}),e.jsx("div",{className:"text-xs text-gray-300",children:Q.description})]})]}),e.jsx("button",{onClick:()=>c(a.id,X),className:"px-3 py-1 bg-gray-700 text-white text-sm rounded",children:"Desequipar"})]}):e.jsx("div",{className:"text-gray-400 text-center w-full",children:"Slot vazio"})},`x-${$}`)})})]})]}),e.jsxs("div",{className:`${Me.cardBase} border ${d}`,children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-white",children:"ğŸ“Š BÃ´nus Totais"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Ataque"}),e.jsxs("span",{className:`font-medium ${f.attack>0?"text-red-400":"text-gray-400"}`,children:["+",f.attack]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Defesa"}),e.jsxs("span",{className:`font-medium ${f.defense>0?"text-blue-400":"text-gray-400"}`,children:["+",f.defense]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"HP"}),e.jsxs("span",{className:`font-medium ${f.hp>0?"text-green-400":"text-gray-400"}`,children:["+",f.hp]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"MP"}),e.jsxs("span",{className:`font-medium ${f.mp>0?"text-purple-400":"text-gray-400"}`,children:["+",f.mp]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3 text-white",children:"Equipar"}),e.jsx("div",{className:"space-y-2",children:Object.entries(a.inventory.items).map(([$,X])=>{const Q=Ee.find(G=>G.id===$);return!Q||X<=0||Q.type==="consumable"||Q.type==="cosmetic"||Q.type==="material"||(a.inventory.equippedWeapons||[]).includes($)||(a.inventory.equippedArmorSlots||[]).includes($)||(a.inventory.equippedAccessories||[]).includes($)?null:e.jsxs("button",{onClick:()=>n(a.id,$),className:"w-full flex items-center space-x-2 p-2 bg-gray-800 border border-gray-700 rounded text-white hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("span",{children:Q.icon}),e.jsx("span",{className:"text-sm",children:Q.name})]},$)})})]})]})]}),t==="achievements"&&e.jsx(rd,{hero:a}),t==="reputation"&&e.jsx(id,{hero:a})]})},cd=()=>{var c,l;const{activitiesLog:a}=Z(),[s,t]=x.useState("all"),[r,i]=x.useState("all"),n=x.useMemo(()=>(Array.isArray(a)?a:[]).filter(m=>(s==="all"||m.type===s)&&(r==="all"||m.location===r)).sort((m,u)=>new Date(u.ts).getTime()-new Date(m.ts).getTime()),[a,s,r]),o=((l=Ke[((c=Z.getState().useMonetizationStore)==null?void 0:c.activeSeasonalTheme)||""])==null?void 0:l.border)||"border-slate-700";return e.jsxs("div",{className:`bg-gray-800 p-6 rounded-lg border ${o} text-slate-200`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"ğŸ—‚ï¸ Atividades"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:s,onChange:d=>t(d.target.value),className:"border rounded px-2 py-1 text-sm bg-slate-900 border-slate-600 text-slate-200",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"dialogue",children:"DiÃ¡logos"}),e.jsx("option",{value:"rumor",children:"Rumores"}),e.jsx("option",{value:"tip",children:"Dicas"}),e.jsx("option",{value:"event",children:"Eventos"})]}),e.jsxs("select",{value:r,onChange:d=>i(d.target.value),className:"border rounded px-2 py-1 text-sm bg-slate-900 border-slate-600 text-slate-200",children:[e.jsx("option",{value:"all",children:"Todos locais"}),e.jsx("option",{value:"tavern",children:"Taverna"}),e.jsx("option",{value:"guild",children:"Guilda"})]})]})]}),e.jsxs("ul",{className:"space-y-2",children:[n.map((d,m)=>e.jsxs("li",{className:"p-3 rounded border bg-slate-800 border-slate-700 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:d.text}),e.jsxs("div",{className:"text-xs text-slate-400",children:[new Date(d.ts).toLocaleString()," â€¢ ",d.location||"â€”"," â€¢ ",d.type]})]}),e.jsx("div",{className:"text-xs text-slate-400",children:d.importance==="high"?"Importante":d.importance==="low"?"Leve":"Normal"})]},`${d.ts}-${m}`)),n.length===0&&e.jsx("li",{className:"p-3 rounded border bg-slate-800 border-slate-700 text-sm text-slate-400",children:"Sem atividades no filtro atual."})]})]})},ld=({hero:a})=>{const[s,t]=x.useState("browse"),[r,i]=x.useState(""),[n,o]=x.useState(""),{guilds:c,availableQuests:l,createGuild:d,joinGuild:m,leaveGuild:u,acceptQuest:p,completeQuest:g,refreshQuests:v,depositGoldToGuild:y,withdrawGoldFromGuild:w,contributeXPToGuild:k,ensureDefaultGuildExists:E,heroes:h,selectHero:b}=Z(),[f,j]=x.useState(""),[N,T]=x.useState(""),[F,te]=x.useState(""),D=a.progression.guildId?c.find(J=>J.id===a.progression.guildId):null;x.useEffect(()=>{try{Z.getState().triggerAutoInteraction("guild")}catch{}},[a.id]);const $=()=>{r.trim()&&n.trim()&&(d(a.id,r.trim(),n.trim()),i(""),o(""),t("my-guild"))},X=J=>{m(a.id,J),t("my-guild")},Q=()=>{D&&(u(a.id,D.id),t("browse"))},Y=()=>{E();const J=c.find(re=>re.name==="Foja dos Herois");J&&(m(a.id,J.id),t("my-guild"))},G=[{id:"browse",label:"Explorar Partys",icon:"ğŸ”"},{id:"my-guild",label:D?"Minha Party":"Sem Party",icon:"ğŸ‘¥"},{id:"create",label:"Criar Party",icon:"â•"}];return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"ğŸ‘¥ Sistema de Party"}),e.jsx("p",{className:"text-lg opacity-90",children:D?`Membro da ${D.name}`:"Aventureiro Independente"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm opacity-90",children:"HerÃ³i:"}),e.jsx("select",{value:a.id,onChange:J=>b(J.target.value),className:"bg-white text-indigo-800 px-2 py-1 rounded shadow-sm",children:h.filter(J=>J.origin!=="npc").map(J=>e.jsx("option",{value:J.id,children:J.name},J.id))})]})]})}),e.jsx(cd,{}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8",children:G.map(J=>e.jsxs("button",{onClick:()=>t(J.id),className:`
                flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm transition-colors
                ${s===J.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
              `,children:[e.jsx("span",{children:J.icon}),e.jsx("span",{children:J.label})]},J.id))})}),s==="browse"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Partys DisponÃ­veis"}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(J=>e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:J.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:J.description})]}),e.jsx("div",{className:"text-2xl",children:"ğŸ°"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Membros:"}),e.jsx("span",{className:"font-medium",children:J.members.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"XP da Party:"}),e.jsx("span",{className:"font-medium",children:J.guildXP})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tesouro:"}),e.jsxs("span",{className:"font-medium",children:[J.bankGold," ğŸª™"]})]})]}),a.progression.guildId===J.id?e.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-2 rounded text-center text-sm font-medium",children:"âœ“ Membro desta party"}):a.progression.guildId?e.jsx("div",{className:"bg-gray-100 text-gray-600 px-3 py-2 rounded text-center text-sm",children:"JÃ¡ Ã© membro de outra party"}):e.jsx("button",{onClick:()=>X(J.id),className:"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors",children:"Entrar na Party"})]},J.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ°"}),e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Nenhuma party encontrada"}),e.jsx("p",{children:"Crie a primeira party!"})]})]}),s==="my-guild"&&e.jsx("div",{className:"space-y-6",children:D?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:D.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:D.description})]}),e.jsx("button",{onClick:Q,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors",children:"Sair da Party"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:D.members.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Membros"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:D.guildXP}),e.jsx("div",{className:"text-sm text-gray-600",children:"XP da Party"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-indigo-600",children:D.level??Math.max(1,Math.floor(D.guildXP/250)+1)}),e.jsx("div",{className:"text-sm text-gray-600",children:"NÃ­vel da Party"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:D.bankGold}),e.jsx("div",{className:"text-sm text-gray-600",children:"Tesouro"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded border border-gray-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-2",children:"Depositar Ouro"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:1,value:f,onChange:J=>j(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Quantidade"}),e.jsx("button",{onClick:()=>{const J=parseInt(f,10);!isNaN(J)&&J>0&&y(a.id,J)&&j("")},className:"px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Depositar"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Seu ouro: ",a.progression.gold]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded border border-gray-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-2",children:"Sacar Ouro"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:1,value:N,onChange:J=>T(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Quantidade"}),e.jsx("button",{onClick:()=>{const J=parseInt(N,10);!isNaN(J)&&J>0&&w(a.id,J)&&T("")},className:"px-3 py-2 bg-amber-600 text-white rounded hover:bg-amber-700",children:"Sacar"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Tesouro da party: ",D.bankGold]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Necessita papel: lÃ­der/oficial"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded border border-gray-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-2",children:"Contribuir XP"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:1,value:F,onChange:J=>te(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Quantidade"}),e.jsx("button",{onClick:()=>{const J=parseInt(F,10);!isNaN(J)&&J>0&&k(a.id,J)&&(v(a.progression.level),te(""))},className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Contribuir"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Aumenta o nÃ­vel da party"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-800",children:"ğŸ‘¥ Membros"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.members.map(J=>{const re=J===a.id,ee=h.find(C=>C.id===J),fe=(ee==null?void 0:ee.origin)==="npc",_=re?a.name:(ee==null?void 0:ee.name)||`Membro ${J.slice(-4)}`,P=re?`${a.class} â€¢ NÃ­vel ${a.progression.level}`:ee?`${ee.class} â€¢ NÃ­vel ${ee.progression.level}`:"Aventureiro",M=re?a.avatar:(ee==null?void 0:ee.avatar)||"ğŸ‘¤";return e.jsx("div",{className:`p-3 rounded-lg border ${re?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:M}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:_}),fe&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded",children:"NPC"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:P})]}),re&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"VocÃª"}),D.roles&&D.roles[J]&&e.jsx("span",{className:"text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded",children:D.roles[J]==="lider"?"LÃ­der":D.roles[J]==="oficial"?"Oficial":"Membro"})]})},J)})})]})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ°"}),e.jsx("h3",{className:"text-xl font-medium mb-2",children:"VocÃª nÃ£o estÃ¡ em nenhuma guilda"}),e.jsx("p",{className:"mb-6",children:"Explore guildas existentes ou crie a sua prÃ³pria!"}),e.jsxs("div",{className:"space-x-4",children:[e.jsx("button",{onClick:()=>t("browse"),className:"bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition-colors",children:"Explorar Guildas"}),e.jsx("button",{onClick:()=>t("create"),className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors",children:"Criar Guilda"}),e.jsx("button",{onClick:Y,className:"bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition-colors",children:"Entrar na Foja dos Herois"})]})]})}),s==="create"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"â• Criar Nova Party"}),a.progression.guildId?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âš ï¸"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"VocÃª jÃ¡ estÃ¡ em uma party"}),e.jsx("p",{children:"Saia da sua party atual para criar uma nova."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome da Party"}),e.jsx("input",{type:"text",value:r,onChange:J=>i(J.target.value),placeholder:"Digite o nome da sua party...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:n,onChange:J=>o(J.target.value),placeholder:"Descreva o propÃ³sito e valores da sua party...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",maxLength:200})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"ğŸ’¡ Dicas para criar uma party"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Escolha um nome Ãºnico e memorÃ¡vel"}),e.jsx("li",{children:"â€¢ Descreva claramente o foco da party (PvE, social, etc.)"}),e.jsx("li",{children:"â€¢ Defina expectativas para os membros"}),e.jsx("li",{children:"â€¢ Seja acolhedor para atrair novos aventureiros"})]})]}),e.jsx("button",{onClick:$,disabled:!r.trim()||!n.trim(),className:"w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Criar Party"})]})]})})]})};async function dd(a,s){var t;if(!_t)return{ok:!0,offline:!0};try{const{data:r}=await Ze.auth.getUser(),i=(t=r==null?void 0:r.user)==null?void 0:t.id;if(!i)return{ok:!1,error:"FaÃ§a login para registrar a run."};const n={user_id:i,hero_id:a.id,hero_name:a.name,max_floor_reached:s.max_floor_reached,victory:s.victory,total_xp:s.total_xp,total_gold:s.total_gold,logs:s.logs,started_at:s.started_at,finished_at:s.finished_at||new Date().toISOString()},{error:o}=await Ze.from("dungeon_runs").insert(n);return o?{ok:!1,error:o.message}:{ok:!0}}catch(r){return{ok:!1,error:(r==null?void 0:r.message)||"Falha ao salvar run."}}}async function md(a,s){var t;if(!_t)return{ok:!0,offline:!0};try{const{data:r}=await Ze.auth.getUser(),i=(t=r==null?void 0:r.user)==null?void 0:t.id;if(!i)return{ok:!1,error:"FaÃ§a login para iniciar a run."};const n={user_id:i,hero_id:a.id,hero_name:a.name,max_floor_reached:0,victory:!1,total_xp:0,total_gold:0,logs:[],started_at:s||new Date().toISOString()},{data:o,error:c}=await Ze.from("dungeon_runs").insert(n).select("id").limit(1);return c?{ok:!1,error:c.message}:{ok:!0,runId:Array.isArray(o)&&o.length?o[0].id:void 0}}catch(r){return{ok:!1,error:(r==null?void 0:r.message)||"Falha ao iniciar run."}}}async function mt(a,s){if(!_t)return{ok:!0,offline:!0};try{const{error:t}=await Ze.from("dungeon_runs").update({max_floor_reached:s.max_floor_reached,total_xp:s.total_xp,total_gold:s.total_gold,logs:s.logs}).eq("id",a);return t?{ok:!1,error:t.message}:{ok:!0}}catch(t){return{ok:!1,error:(t==null?void 0:t.message)||"Falha ao atualizar run."}}}async function ud(a,s){if(!_t)return{ok:!0,offline:!0};try{const{error:t}=await Ze.from("dungeon_runs").update({victory:s.victory,max_floor_reached:s.max_floor_reached,total_xp:s.total_xp,total_gold:s.total_gold,logs:s.logs,finished_at:s.finished_at||new Date().toISOString()}).eq("id",a);return t?{ok:!1,error:t.message}:{ok:!0}}catch(t){return{ok:!1,error:(t==null?void 0:t.message)||"Falha ao finalizar run."}}}async function pd(a=10){if(!_t)return{data:[],offline:!0};try{const{data:s,error:t}=await Ze.from("dungeon_leaderboard").select("*").limit(a);if(t){const r=String(t.message||"");return r.includes("Could not find the table")||r.includes("does not exist")?{data:[],offline:!0}:{data:[],error:t.message}}return{data:Array.isArray(s)?s:[]}}catch(s){return{data:[],error:(s==null?void 0:s.message)||"Falha ao carregar leaderboard da dungeon."}}}async function gd(){if(!_t)return{data:{},offline:!0};try{const a=new Date;a.setDate(a.getDate()-7);const{data:s,error:t}=await Ze.from("dungeon_runs").select("hero_name, max_floor_reached, finished_at").gte("finished_at",a.toISOString()).order("max_floor_reached",{ascending:!1}).order("finished_at",{ascending:!0}).limit(1),{data:r,error:i}=await Ze.from("dungeon_runs").select("hero_name, total_gold, finished_at").gte("finished_at",a.toISOString()).order("total_gold",{ascending:!1}).order("finished_at",{ascending:!0}).limit(1);if(t||i){const c=String((t==null?void 0:t.message)||(i==null?void 0:i.message)||"");return c.includes("Could not find the table")||c.includes("does not exist")?{data:{},offline:!0}:{data:{},error:(t==null?void 0:t.message)||(i==null?void 0:i.message)}}const n=Array.isArray(s)&&s.length?s[0]:void 0,o=Array.isArray(r)&&r.length?r[0]:void 0;return{data:{bestRun:n,biggestLoot:o}}}catch(a){return{data:{},error:(a==null?void 0:a.message)||"Falha ao carregar destaques semanais da dungeon."}}}const Ls=[{id:"basic-combat",name:"Treinamento BÃ¡sico de Combate",description:"Aprenda os fundamentos do combate corpo a corpo",icon:"âš”ï¸",cost:30,currency:"gold",duration:3,fatiguePenalty:15,rewards:{xp:25,attributes:{forca:1}}},{id:"agility-training",name:"Treinamento de Agilidade",description:"Melhore sua velocidade e reflexos",icon:"ğŸƒ",cost:30,currency:"gold",duration:3,fatiguePenalty:15,rewards:{xp:30,attributes:{destreza:1}}},{id:"magic-studies",name:"Estudos MÃ¡gicos",description:"Aprofunde seus conhecimentos arcanos",icon:"ğŸ“š",cost:35,currency:"arcaneEssence",duration:3,fatiguePenalty:15,rewards:{xp:40,attributes:{inteligencia:1}},requirements:{level:3}},{id:"meditation",name:"MeditaÃ§Ã£o Espiritual",description:"FortaleÃ§a sua mente e espÃ­rito",icon:"ğŸ§˜",cost:30,currency:"glory",duration:3,fatiguePenalty:10,rewards:{xp:35,attributes:{inteligencia:1}}},{id:"endurance-training",name:"Treinamento de ResistÃªncia",description:"Aumente sua resistÃªncia fÃ­sica",icon:"ğŸ’ª",cost:40,currency:"gold",duration:3,fatiguePenalty:25,rewards:{xp:45,attributes:{constituicao:1}},requirements:{level:2}},{id:"charisma-workshop",name:"Workshop de LideranÃ§a",description:"Desenvolva suas habilidades sociais",icon:"ğŸ­",cost:50,currency:"glory",duration:3,fatiguePenalty:10,rewards:{xp:50,attributes:{destreza:1}},requirements:{level:5}},{id:"advanced-combat",name:"Combate AvanÃ§ado",description:"TÃ©cnicas avanÃ§adas de combate",icon:"ğŸ—¡ï¸",cost:100,currency:"glory",duration:3,fatiguePenalty:30,rewards:{xp:100,attributes:{forca:2,destreza:1}},requirements:{level:10}},{id:"treasure-hunting",name:"CaÃ§a ao Tesouro",description:"Aprenda a encontrar tesouros escondidos",icon:"ğŸ’°",cost:75,currency:"gold",duration:3,fatiguePenalty:20,rewards:{xp:60,gold:150},requirements:{level:7}}],Mn=()=>{var b,f,j;const{getSelectedHero:a,updateHero:s,updateDailyGoalProgress:t}=Z(),r=a(),[i,n]=x.useState(null),[o,c]=x.useState(null),[l,d]=x.useState(0),m=((b=r==null?void 0:r.rankData)==null?void 0:b.currentRank)||(r?We.calculateRank(r):void 0),u=m?Cr(m):void 0,p={...((f=r==null?void 0:r.stats)==null?void 0:f.trainingAttemptsByStatus)||{}};if(x.useEffect(()=>{if(!i||!o)return;const N=setInterval(()=>{d(T=>T+1)},500);return()=>clearInterval(N)},[i,o]),x.useEffect(()=>{if(!r)return;const N=r.stats.lastTrainingDate?new Date(r.stats.lastTrainingDate).toDateString():"",T=new Date().toDateString();N!==T&&s(r.id,{stats:{...r.stats,trainingsToday:0,trainingAttemptsByStatus:{},lastTrainingDate:new Date().toISOString()}})},[r==null?void 0:r.id]),x.useEffect(()=>{if(!r)return;const N=r.stats.trainingActiveUntil,T=r.stats.trainingActiveName;if(!N||!T)return;const F=new Date(N).getTime(),te=Date.now(),D=Ls.find($=>$.name===T)||null;if(!D){s(r.id,{stats:{...r.stats,trainingActiveUntil:void 0,trainingActiveName:void 0}});return}te<F?(n(D.id),c(F)):k(D)},[r==null?void 0:r.id]),!r)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ’ª"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Centro de Treinamento"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para comeÃ§ar o treinamento."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]});const g=N=>{if(r.progression.level<=1&&(N.id==="basic-combat"||N.id==="agility-training"))return 0;const T=Pa.getState().trainingCostReductionPercent||0,F=Math.max(0,Math.min(100,T)),te=Math.ceil(N.cost*(1-F/100));return Math.max(0,te)},v=N=>{const T=N.currency||"gold",F=r.progression;return(T==="gold"?F.gold||0:T==="glory"?F.glory||0:F.arcaneEssence||0)>=g(N)},y=N=>{var T,F;return!((T=N.requirements)!=null&&T.level&&r.progression.level<N.requirements.level||(F=N.requirements)!=null&&F.gold&&r.progression.gold<N.requirements.gold)},w=N=>{if(!v(N)||!y(N))return;if(N.rewards.attributes&&u!==void 0&&Object.entries(N.rewards.attributes).some(([P])=>(r.attributes[P]||0)>=u)){alert("Este treinamento nÃ£o pode ser iniciado: atributo jÃ¡ estÃ¡ no limite.");return}const T=new Date,F=T.toISOString(),te=r.stats.lastTrainingDate?new Date(r.stats.lastTrainingDate).toDateString():"",D=T.toDateString(),$={...r.stats.trainingAttemptsByStatus||{}},X=10;if(te!==D){for(const _ of Object.keys($))delete $[_];s(r.id,{stats:{...r.stats,trainingsToday:0,lastTrainingDate:F}})}if(N.rewards.attributes&&Object.keys(N.rewards.attributes).some(P=>($[P]||0)>=X)){alert("Limite diÃ¡rio de treino por status atingido (10). Volte amanhÃ£.");return}const Q=N.currency||"gold",Y=r.progression,G={...Y},J=g(N);Q==="gold"?G.gold=(Y.gold||0)-J:Q==="glory"?G.glory=(Y.glory||0)-J:G.arcaneEssence=(Y.arcaneEssence||0)-J,s(r.id,{progression:G}),n(N.id);const ee=r.progression.level===1&&(r.stats.trainingsToday||0)===0?.5:N.duration,fe=Date.now()+ee*60*1e3;c(fe),s(r.id,{stats:{...r.stats,trainingActiveUntil:new Date(fe).toISOString(),trainingActiveName:N.name,lastTrainingDate:F}}),setTimeout(()=>{k(N)},ee*60*1e3)},k=N=>{const T={},F=r.progression.fatigue||0;let te=1;if(F>=70?te=.5:F>=40&&(te=.75),N.rewards.xp){const J=r.progression.level===1&&(r.stats.trainingsToday||0)===0?150:N.rewards.xp,re=Math.floor(J*te);try{Z.getState().gainXP(r.id,re)}catch{}}if(N.rewards.gold){const G=Math.floor(N.rewards.gold*te);T.progression={...T.progression||{},gold:(r.progression.gold||0)+G}}N.rewards.attributes&&u!==void 0&&(T.attributes={...r.attributes},Object.entries(N.rewards.attributes).forEach(([G,J])=>{const ee=(r.attributes[G]||0)+Math.max(1,Math.floor(J*te));T.attributes[G]=Math.min(u,ee)}));const D=new Date().toISOString(),$=(r.stats.trainingsToday||0)+1,X={...r.stats.trainingAttemptsByStatus||{}};N.rewards.attributes&&Object.keys(N.rewards.attributes).forEach(G=>{X[G]=(X[G]||0)+1}),T.stats={...r.stats,trainingsToday:$,lastTrainingDate:D,trainingDailyLimit:10,trainingAttemptsByStatus:X,trainingActiveUntil:void 0,trainingActiveName:void 0};const Q=N.fatiguePenalty??20,Y=Math.min(100,(r.progression.fatigue||0)+Q);T.progression={...T.progression||{},fatigue:Y};try{delete T.progression.xp}catch{}try{delete T.progression.level}catch{}try{delete T.progression.stars}catch{}try{delete T.progression.titles}catch{}if(s(r.id,T),t(r.id,"attribute-trained",1),N.rewards.xp){const G=r.progression.level===1&&(r.stats.trainingsToday||0)>=1;t(r.id,"xp-gained",G?150:N.rewards.xp)}N.rewards.gold&&t(r.id,"gold-earned",N.rewards.gold),n(null),c(null),alert(`Treinamento concluÃ­do! Efetividade ${Math.round(te*100)}%. Recompensas de ${N.name} aplicadas.`);try{localStorage.setItem("hfn_training_basic_done","1")}catch{}try{Ve.markStepValidated("basic-training"),Ve.saveState()}catch{}},E=()=>o?Math.max(0,o-Date.now()):0,h=N=>{const T=Math.floor(N/6e4),F=Math.floor(N%6e4/1e3);return`${T}:${F.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-2",children:"ğŸ’ª Centro de Treinamento"}),e.jsx("p",{className:"text-gray-600",children:"Aprimore suas habilidades e atributos atravÃ©s de treinamentos especializados"}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-center gap-2",children:[e.jsx("div",{className:"bg-blue-100 border border-blue-400 rounded-lg px-3 py-2 inline-flex items-center",children:e.jsxs("span",{className:"text-blue-800 font-medium",children:["ğŸ’° Ouro: ",r.progression.gold||0,"g"]})}),e.jsx("div",{className:"bg-purple-100 border border-purple-400 rounded-lg px-3 py-2 inline-flex items-center",children:e.jsxs("span",{className:"text-purple-800 font-medium",children:["ğŸ† GlÃ³ria: ",r.progression.glory||0]})}),e.jsx("div",{className:"bg-indigo-100 border border-indigo-400 rounded-lg px-3 py-2 inline-flex items-center",children:e.jsxs("span",{className:"text-indigo-800 font-medium",children:["âœ¨ EssÃªncia Arcana: ",r.progression.arcaneEssence||0]})}),e.jsx("div",{className:"bg-red-100 border border-red-400 rounded-lg px-3 py-2 inline-flex items-center",children:e.jsxs("span",{className:"text-red-800 font-medium",children:["ğŸ˜´ Fadiga: ",r.progression.fatigue||0,"/100"]})})]}),e.jsx("div",{className:"mt-2 bg-green-100 border border-green-400 rounded-lg p-2 inline-block ml-2",children:e.jsx("span",{className:"text-green-800 font-medium",children:"ğŸ—“ï¸ Limite por status: 10 tentativas por atributo"})}),e.jsx("div",{className:"mt-2 flex flex-wrap justify-center gap-2",children:["forca","destreza","constituicao","inteligencia"].slice().sort((N,T)=>(p[T]||0)-(p[N]||0)).map(N=>{const T=p[N]||0,te=T>=10?"bg-red-100 border border-red-400 text-red-800":"bg-gray-100 border border-gray-300 text-gray-800";return e.jsxs("div",{className:`${te} rounded px-3 py-1 text-sm`,children:[e.jsx("span",{className:"font-medium capitalize",children:N}),": ",T,"/10"]},N)})})]}),i&&e.jsx("div",{className:"bg-yellow-100 border border-yellow-400 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-800 mb-2",children:"ğŸƒ Treinamento em Andamento"}),e.jsx("p",{className:"text-yellow-700",children:(j=Ls.find(N=>N.id===i))==null?void 0:j.name}),e.jsxs("p",{className:"text-yellow-600 text-sm mt-1",children:["Tempo restante: ",h(E())]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ls.map(N=>{const T=v(N),F=y(N),te={...r.stats.trainingAttemptsByStatus||{}},D=10,$=N.rewards.attributes&&u!==void 0?Object.entries(N.rewards.attributes).some(([Y])=>(r.attributes[Y]||0)>=u):!1,X=N.rewards.attributes?Object.keys(N.rewards.attributes).some(Y=>(te[Y]||0)>=D):!1,Q=T&&F&&!i&&!$&&!X;return e.jsxs("div",{className:`${Me.cardBase} border-2 shadow-sm ${Q?"border-green-400 hover:shadow-md":"border-gray-700"} transition-shadow`,children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:N.icon}),e.jsx("h3",{className:"text-lg font-bold",children:N.name}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:N.description})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Custo:"}),e.jsxs("span",{className:`font-medium ${(N.currency||"gold")==="gold"?"text-yellow-600":(N.currency||"gold")==="glory"?"text-purple-700":"text-indigo-700"}`,children:[g(N)," ",(N.currency||"gold")==="gold"?"ouro":(N.currency||"gold")==="glory"?"glÃ³ria":"essÃªncia"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"DuraÃ§Ã£o:"}),e.jsx("span",{className:"font-medium",children:r.progression.level===1&&(r.stats.trainingsToday||0)===0?"30s":`${N.duration} min`})]})]}),N.requirements&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Requisitos:"}),N.requirements.level&&e.jsxs("div",{className:`text-xs ${r.progression.level>=N.requirements.level?"text-green-600":"text-red-600"}`,children:["NÃ­vel ",N.requirements.level,"+"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Recompensas:"}),e.jsxs("div",{className:"space-y-1",children:[N.rewards.xp&&e.jsxs("div",{className:"text-xs text-blue-600",children:["+",r.progression.level===1&&(r.stats.trainingsToday||0)===0?150:N.rewards.xp," XP"]}),N.rewards.gold&&e.jsxs("div",{className:"text-xs text-yellow-600",children:["+",N.rewards.gold," Ouro"]}),N.rewards.attributes&&Object.entries(N.rewards.attributes).map(([Y,G])=>{const J=te[Y]||0,re=J>=10,ee=re?"text-red-600":"text-green-600";return e.jsxs("div",{className:`text-xs ${ee}`,children:["+",G," ",Y.charAt(0).toUpperCase()+Y.slice(1),e.jsxs("span",{className:re?"ml-2 text-red-600":"ml-2 text-gray-500",children:["(",J,"/10 hoje)"]})]},Y)})]})]}),e.jsx("button",{onClick:()=>w(N),disabled:!Q,className:`w-full py-2 px-4 rounded font-medium transition-colors ${Q?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:T?F?$?"Atributo no limite":i?"Treinamento em andamento":X?"Limite por status atingido":"Iniciar Treinamento":"Requisitos nÃ£o atendidos":(N.currency||"gold")==="gold"?"Ouro Insuficiente":(N.currency||"gold")==="glory"?"GlÃ³ria Insuficiente":"EssÃªncia Insuficiente"})]},N.id)})})]})};function En(a=new Date){const s=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0");return`${s}-${t}-${r}`}function xd(a){return a<=2?[{type:"Goblin",count:2,level:Math.max(1,a)},{type:"Lobo",count:1,level:a}]:a<=5?[{type:"Bandido",count:1,level:a},{type:"Esqueleto",count:1,level:a}]:[{type:"Troll",count:1,level:a},{type:"Bandido",count:2,level:a}]}function Rn(a,s){return`idle_daily_${a}_${s}`}function hd(a,s){var u;const t=Number(((u=a==null?void 0:a.progression)==null?void 0:u.level)||1),r=Math.max(1,Math.min(3,s||(t<=2?1:t<=5?2:3))),i=En(new Date),n=a.id||a.name||"anon",o=[];let c=0,l=0,d=0;for(let p=0;p<r;p++){const g=xd(t),v=Ki(a,g);o.push({victory:v.victory,xpGained:v.xpGained,goldGained:v.goldGained,itemsGained:v.itemsGained||[],log:v.log||[],enemies:g}),c+=v.xpGained,l+=v.goldGained,d+=v.victory?1:0}const m={heroId:n,dateKey:i,runs:o,xpTotal:c,goldTotal:l,victories:d};try{typeof window<"u"&&window.localStorage&&window.localStorage.setItem(Rn(n,i),JSON.stringify(m))}catch{}return m}function fd(a){const s=a.id||a.name||"anon",t=En(new Date);try{if(typeof window<"u"&&window.localStorage){const r=window.localStorage.getItem(Rn(s,t));if(r)return JSON.parse(r)}}catch{}return null}function Pn(a,s){const t=fd(a);return t||hd(a,s)}const In=()=>{var F,te,D;const{getSelectedHero:a,heroes:s}=Z(),t=a(),{activeSeasonalTheme:r}=Qe(),i=r&&((F=Ke[r])==null?void 0:F.border)||"border-amber-600/30",n=r&&((te=Ke[r])==null?void 0:te.border)||"border-amber-500/30",[o,c]=x.useState((t==null?void 0:t.id)??((D=s[0])==null?void 0:D.id)??null),l=(o?s.find($=>$.id===o):void 0)||t,[d,m]=x.useState("xp"),[u,p]=x.useState([]),[g,v]=x.useState("top"),[y,w]=x.useState([]),[k,E]=x.useState(!1),[h,b]=x.useState(null);if(x.useEffect(()=>{if(!l)return;const $=Ya(s);p($);let X=!0;return(async()=>{try{const Q=await fetch("/api/daily/leaderboard");if(!X)return;const Y=await Q.json();if(!X)return;w(Array.isArray(Y.entries)?Y.entries:[])}catch{}try{const Q=await Pn(l);if(!X)return;b(Q)}catch{}})(),()=>{X=!1}},[l,s]),!l)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-400 mb-4",children:"Selecione um HerÃ³i"}),e.jsx("p",{className:"text-gray-300",children:"VocÃª precisa selecionar um herÃ³i para ver os rankings."})]});const f=u.find($=>$.id===d),j=Zi(l,s),N=vs.find($=>$.id===d),T=($,X=!1)=>e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg transition-all ${X?"bg-amber-600/20 border border-amber-500 shadow-lg":"bg-gray-700 hover:bg-gray-600"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:mc($.rank)}),e.jsxs("span",{className:`font-bold text-lg ${dc($.rank)}`,children:["#",$.rank]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("h3",{className:`font-semibold ${X?"text-amber-400":"text-white"}`,children:[$.heroName,$.isNPC&&e.jsx("span",{className:"ml-2 text-xs bg-gray-600 px-2 py-1 rounded",children:"NPC"}),X&&e.jsx("span",{className:"ml-2 text-xs bg-amber-600 px-2 py-1 rounded",children:"VOCÃŠ"})]})}),e.jsxs("p",{className:"text-sm text-gray-400",children:[$.heroRace," ",$.heroClass]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`font-bold ${(N==null?void 0:N.color)||"text-white"}`,children:(N==null?void 0:N.formatValue($.value))||$.value}),$.change!==0&&e.jsx("div",{className:"text-xs text-gray-400",children:lc($.change)})]})]},$.heroId);return e.jsxs("div",{className:"space-y-6",children:[l&&e.jsxs("div",{className:`${Me.cardBase} border ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-bold text-white flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ğŸ“…"}),"Ranking DiÃ¡rio (MVP)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-gray-300",children:"HerÃ³i:"}),e.jsx("select",{value:o??"",onChange:$=>c($.target.value),className:"bg-gray-700 text-white text-sm px-2 py-1 rounded border border-gray-600",children:s.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))}),e.jsx("button",{onClick:async()=>{if(!k){E(!0);try{await fetch("/api/daily/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hero:l})});const X=await(await fetch("/api/daily/leaderboard")).json();w(Array.isArray(X.entries)?X.entries:[]),ge.emit({type:"achievement",title:"Ranking DiÃ¡rio",message:"Resultado enviado com sucesso! Confira o Top do dia.",icon:"ğŸ“…",duration:3500})}catch{ge.emit({type:"quest",title:"Falha no envio",message:"NÃ£o foi possÃ­vel enviar seu resultado diÃ¡rio.",icon:"âš ï¸",duration:4e3})}finally{E(!1)}}},className:`px-3 md:px-4 py-2 rounded-lg font-medium transition-colors text-sm md:text-base ${k?"bg-gray-700 text-gray-400":"bg-amber-600 text-white hover:bg-amber-700"}`,children:k?"Enviando...":"Enviar Resultado de Hoje"})]})]}),h&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-3 md:mb-4 text-center",children:[e.jsxs("div",{className:"bg-gray-700 rounded p-2 md:p-3",children:[e.jsx("div",{className:"text-blue-400 text-base md:text-lg",children:"âœ¨ XP Hoje"}),e.jsx("div",{className:"text-white text-lg md:text-xl font-bold",children:h.xpTotal??0})]}),e.jsxs("div",{className:"bg-gray-700 rounded p-2 md:p-3",children:[e.jsx("div",{className:"text-yellow-400 text-base md:text-lg",children:"ğŸª™ Ouro Hoje"}),e.jsx("div",{className:"text-white text-lg md:text-xl font-bold",children:h.goldTotal??0})]}),e.jsxs("div",{className:"bg-gray-700 rounded p-2 md:p-3",children:[e.jsx("div",{className:"text-green-400 text-base md:text-lg",children:"âœ… VitÃ³rias"}),e.jsx("div",{className:"text-white text-lg md:text-xl font-bold",children:h.victories??0})]}),e.jsxs("div",{className:"bg-gray-700 rounded p-2 md:p-3",children:[e.jsx("div",{className:"text-purple-400 text-base md:text-lg",children:"â™»ï¸ ExecuÃ§Ãµes"}),e.jsx("div",{className:"text-white text-lg md:text-xl font-bold",children:Array.isArray(h.runs)?h.runs.length:0})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base md:text-lg font-semibold text-white mb-2",children:"Top de Hoje"}),y.length===0?e.jsx("div",{className:"text-gray-400",children:"Nenhuma entrada enviada ainda."}):e.jsx("div",{className:"space-y-2",children:y.slice(0,10).map($=>e.jsxs("div",{className:`flex items-center justify-between p-2 md:p-3 rounded ${$.heroId===l.id?"bg-amber-600/20 border border-amber-500":"bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-medium",children:$.heroName}),e.jsxs("span",{className:"text-gray-400 text-xs md:text-sm",children:["Nv ",$.heroLevel]}),$.heroId===l.id&&e.jsx("span",{className:"text-amber-400 bg-amber-600/20 px-2 py-0.5 rounded text-[11px] md:text-xs",children:"VocÃª"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-white text-sm md:text-base font-bold",children:[Math.round($.score)," pts"]}),e.jsxs("div",{className:"text-gray-400 text-[11px] md:text-xs",children:[$.victoriesToday," vitÃ³rias â€¢ ",$.xpToday," XP â€¢ ",$.goldToday," ouro"]})]})]},$.heroId))})]})]}),e.jsxs("div",{className:`bg-gradient-to-r from-amber-900/50 to-amber-800/30 rounded-lg p-4 md:p-6 border ${n}`,children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-amber-400 mb-3 md:mb-4 flex items-center",children:[e.jsx("span",{className:"text-2xl md:text-3xl mr-2 md:mr-3",children:"ğŸ†"}),"Rankings & Leaderboards"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl md:text-2xl font-bold text-yellow-400",children:["#",j.globalRank]}),e.jsx("div",{className:"text-xs md:text-sm text-gray-400",children:"Ranking Global"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl md:text-2xl font-bold text-blue-400",children:["#",j.classRank]}),e.jsx("div",{className:"text-xs md:text-sm text-gray-400",children:"Ranking da Classe"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-purple-400",children:j.achievements}),e.jsx("div",{className:"text-xs md:text-sm text-gray-400",children:"Conquistas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-green-400",children:j.totalScore.toLocaleString()}),e.jsx("div",{className:"text-xs md:text-sm text-gray-400",children:"PontuaÃ§Ã£o Total"})]})]})]}),e.jsxs("div",{className:`${Me.cardBase}`,children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-4 md:mb-6",children:vs.map($=>e.jsxs("button",{onClick:()=>m($.id),className:`flex items-center space-x-2 px-3 md:px-4 py-2 rounded font-medium transition-colors text-sm md:text-base ${d===$.id?Me.tabActive:Me.tabInactive}`,children:[e.jsx("span",{children:$.icon}),e.jsx("span",{children:$.name})]},$.id))}),e.jsxs("div",{className:"flex gap-2 mb-3 md:mb-4",children:[e.jsx("button",{onClick:()=>v("top"),className:`px-3 md:px-4 py-2 rounded font-medium transition-colors text-sm md:text-base ${g==="top"?Me.tabActive:Me.tabInactive}`,children:"Top 10"}),e.jsx("button",{onClick:()=>v("around"),className:`px-3 md:px-4 py-2 rounded font-medium transition-colors text-sm md:text-base ${g==="around"?Me.tabActive:Me.tabInactive}`,children:"Ao Redor de VocÃª"})]}),f&&N&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center",children:[e.jsx("span",{className:"mr-2",children:N.icon}),N.name]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Atualizado: ",f.lastUpdated.toLocaleTimeString()]})]}),e.jsx("p",{className:"text-gray-400 mb-6",children:N.description}),e.jsx("div",{className:"space-y-2",children:g==="top"?oc(f,10).map($=>T($,$.heroId===l.id)):cc(f,l.id,5).map($=>T($,$.heroId===l.id))}),f.entries.length===0&&e.jsx("div",{className:"text-center p-8 text-gray-400",children:e.jsx("p",{children:"Nenhum herÃ³i encontrado neste ranking."})})]})]}),e.jsxs("div",{className:"bg-blue-900/30 rounded-lg p-6 border border-blue-500/30",children:[e.jsxs("h4",{className:"text-lg font-semibold text-blue-400 mb-3 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ğŸ’¡"}),"Como Melhorar seu Ranking"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-white mb-2",children:"ğŸ“ˆ ExperiÃªncia & NÃ­vel"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"â€¢ Complete missÃµes regularmente"}),e.jsx("li",{children:"â€¢ Participe de combates"}),e.jsx("li",{children:"â€¢ Explore novas Ã¡reas"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-white mb-2",children:"ğŸ’° Riqueza"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"â€¢ Venda itens desnecessÃ¡rios"}),e.jsx("li",{children:"â€¢ Complete missÃµes com recompensas altas"}),e.jsx("li",{children:"â€¢ Invista em equipamentos valiosos"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-white mb-2",children:"ğŸ… Conquistas"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"â€¢ Desbloqueie tÃ­tulos especiais"}),e.jsx("li",{children:"â€¢ Complete desafios Ãºnicos"}),e.jsx("li",{children:"â€¢ Mantenha streaks de login"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-white mb-2",children:"â­ ReputaÃ§Ã£o"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"â€¢ FaÃ§a escolhas narrativas positivas"}),e.jsx("li",{children:"â€¢ Ajude diferentes facÃ§Ãµes"}),e.jsx("li",{children:"â€¢ Mantenha boa reputaÃ§Ã£o geral"})]})]})]})]})]})},bd="1.0.0";function Ni({items:a,activeId:s,onChange:t,size:r="md",className:i=""}){const n=r==="sm"?"px-3 py-1":"px-3 py-2";return e.jsx("div",{className:`flex gap-2 ${i} xs:flex-nowrap xs:overflow-x-auto xs:-mx-3 xs:px-3 md:flex-wrap`,children:a.map(o=>e.jsxs("button",{onClick:()=>t(o.id),className:`${n} rounded border text-sm ${s===o.id?Me.tabActive:Me.tabInactive}`,children:[o.icon?e.jsx("span",{className:"mr-2",children:o.icon}):null,o.label]},o.id))})}const Tn=()=>{const{heroes:a,getSelectedHero:s}=Z(),t=s(),r=x.useMemo(()=>a.filter(l=>l.origin==="npc"),[a]),i=6,n=60,[o,c]=x.useState([]);return at.useEffect(()=>{function l(u,p){const g=[...u];for(let v=g.length-1;v>0;v--){const y=Math.floor(Math.random()*(v+1));[g[v],g[y]]=[g[y],g[v]]}return g.slice(0,Math.max(0,Math.min(p,g.length)))}const d=r.map(u=>u.id);c(l(d,i));const m=setInterval(()=>c(l(r.map(u=>u.id),i)),Math.max(10,n)*1e3);return()=>clearInterval(m)},[r,i,n]),r.length===0?null:e.jsxs("div",{className:`${Me.cardBase} border border-gray-700`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Atividades de Aventureiros NPC"}),e.jsx("div",{className:"text-xs text-gray-400",children:"SimulaÃ§Ã£o ativa"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:r.filter(l=>o.includes(l.id)).map(l=>{var g;const d=(((g=l.npcMemory)==null?void 0:g.interactions)||[]).slice(-1)[0],m=(l.socialRelations||{})[(t==null?void 0:t.id)||""]||0,u=l.npcMood,p=u==="feliz"?"ğŸ˜„":u==="tranquilo"?"ğŸ™‚":u==="neutro"?"ğŸ˜":u==="estressado"?"ğŸ˜£":u==="irritado"?"ğŸ˜¡":u==="triste"?"ğŸ˜¢":u==="cansado"?"ğŸ˜´":"â€”";return e.jsxs("div",{className:"bg-gray-900 border border-gray-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500 animate-pulse"}),l.name]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Rel ",m," â€¢ ",p]})]}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:d?`${new Date(d.ts).toLocaleTimeString()} â€¢ ${d.summary}`:"Sem atividades recentes"})]},l.id)})})]})},vd=()=>{const{npcInteractionOverlay:a,setNPCInteractionOverlay:s,respondToNPCInteraction:t}=Z(),r=!!a,[i,n]=x.useState(0);if(x.useEffect(()=>{n(0)},[r]),!r)return null;const o=a,c=o.lines||[],l=c[i]||"",d=Z.getState().getSelectedHero(),m=Z.getState().heroes.find(w=>w.id===o.npcId),u=m&&(m.socialRelations||{})[(d==null?void 0:d.id)||""]||0,p=u>=40?"friendly":u<=-30?"hostile":"neutral",g=p==="friendly"?"ğŸ™‚":p==="hostile"?"ğŸ˜ ":"ğŸ˜",v=p==="friendly"?"ğŸ¤":p==="hostile"?"âœ‹":"ğŸ–ï¸",y=p==="friendly"?"translate-y-0":p==="hostile"?"scale-110":"opacity-90";return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>s(void 0)}),e.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-300 p-4 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"ğŸ’¬ InteraÃ§Ã£o"}),e.jsx("button",{onClick:()=>s(void 0),className:"text-gray-600",children:"âœ–"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded border text-gray-800",children:[e.jsxs("div",{className:`text-2xl transition-all ${y}`,children:[g," ",v]}),e.jsxs("div",{className:"text-sm mt-1",children:[o.npcName,": ",l]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>n(w=>Math.max(0,w-1)),className:"px-3 py-1 rounded bg-gray-600 text-white",children:"Anterior"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[i+1,"/",c.length]}),e.jsx("button",{onClick:()=>n(w=>Math.min(c.length-1,w+1)),className:"px-3 py-1 rounded bg-indigo-600 text-white",children:"PrÃ³ximo"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>t("accept"),className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Aceitar"}),e.jsx("button",{onClick:()=>t("decline"),className:"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:"Recusar"}),e.jsx("button",{onClick:()=>t("later"),className:"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700",children:"Depois"})]})]})]})};class yd{parseJsonResponse(s){const t=n=>{let o=n.trim();return o=o.replace(/^```\s*json\s*/i,"").replace(/^```\s*/i,""),o=o.replace(/```\s*$/i,"").trim(),o},r=n=>{let o="",c=!1,l=null,d=!1;for(let m=0;m<n.length;m++){const u=n[m];if(!c){(u==='"'||u==="'")&&!d&&(c=!0,l=u),o+=u,d=u==="\\"?!d:!1;continue}if(!d&&u===l){c=!1,l=null,o+=u,d=!1;continue}if(!d&&(u===`
`||u==="\r")){o+=u===`
`?"\\n":"\\r",d=!1;continue}o+=u,d?d=!1:d=u==="\\"}return o},i=r(t(s));try{return JSON.parse(i)}catch{const n=i.indexOf("{"),o=i.lastIndexOf("}");if(n!==-1&&o!==-1&&o>n){const l=r(i.slice(n,o+1));return JSON.parse(l)}const c=r(i).split(`
`).filter(l=>!l.trim().startsWith("//")).join(`
`);return JSON.parse(c)}}getSystemPrompt(){return`VocÃª Ã© um conselheiro especialista em RPG medieval fantÃ¡stico, focado em ajudar herÃ³is a otimizar sua progressÃ£o e experiÃªncia de jogo.

Suas recomendaÃ§Ãµes devem ser:
- Personalizadas para o herÃ³i especÃ­fico
- Baseadas em dados e anÃ¡lise inteligente
- PrÃ¡ticas e acionÃ¡veis
- Balanceadas entre eficiÃªncia e diversÃ£o
- Escritas em portuguÃªs brasileiro

Considere sempre:
- O nÃ­vel atual e objetivos do herÃ³i
- Pontos fortes e fracos
- Atividades recentes e padrÃµes
- Tempo disponÃ­vel para jogar
- ProgressÃ£o natural e sustentÃ¡vel`}buildRecommendationPrompt(s){var o,c,l,d,m;const{hero:t,context:r,maxRecommendations:i}=s;let n=`Analise o perfil do herÃ³i e forneÃ§a ${i||3} recomendaÃ§Ãµes personalizadas.

PERFIL DO HERÃ“I:
- Nome: ${t.name}
- Classe: ${t.class}
- NÃ­vel: ${t.progression.level}
- Rank: ${t.rank||"F"}
- Atributos: ${Object.entries(t.attributes).map(([u,p])=>`${u}: ${p}`).join(", ")}`;return t.achievements&&t.achievements.length>0&&(n+=`
- Conquistas: ${t.achievements.slice(-5).map(u=>u.title).join(", ")}`),r&&(n+=`

CONTEXTO ADICIONAL:`,(o=r.recentActivities)!=null&&o.length&&(n+=`
- Atividades recentes: ${r.recentActivities.join(", ")}`),(c=r.currentGoals)!=null&&c.length&&(n+=`
- Objetivos atuais: ${r.currentGoals.join(", ")}`),(l=r.weaknesses)!=null&&l.length&&(n+=`
- Pontos fracos: ${r.weaknesses.join(", ")}`),(d=r.strengths)!=null&&d.length&&(n+=`
- Pontos fortes: ${r.strengths.join(", ")}`),r.availableTime&&(n+=`
- Tempo disponÃ­vel: ${r.availableTime}`),(m=r.preferredActivities)!=null&&m.length&&(n+=`
- Atividades preferidas: ${r.preferredActivities.join(", ")}`)),n+=`

FORNEÃ‡A RECOMENDAÃ‡Ã•ES EM JSON:
{
  "recommendations": [
    {
      "type": "training|quest|equipment|social|progression|strategy",
      "priority": "low|medium|high|critical",
      "title": "TÃ­tulo da RecomendaÃ§Ã£o",
      "description": "DescriÃ§Ã£o clara (50-80 palavras)",
      "reasoning": "Por que esta recomendaÃ§Ã£o Ã© importante (30-50 palavras)",
      "actionSteps": ["Passo 1", "Passo 2", "Passo 3"],
      "estimatedBenefit": "BenefÃ­cio esperado",
      "estimatedTime": "Tempo necessÃ¡rio",
      "prerequisites": ["PrÃ©-requisito 1", "PrÃ©-requisito 2"],
      "relatedAchievements": ["Conquista relacionada"]
    }
  ]
}

TIPOS DE RECOMENDAÃ‡ÃƒO:
- training: Treino de atributos ou habilidades
- quest: MissÃµes especÃ­ficas para progressÃ£o
- equipment: Melhorias de equipamentos
- social: InteraÃ§Ãµes sociais e guildas
- progression: EstratÃ©gias de progressÃ£o geral
- strategy: TÃ¡ticas e estratÃ©gias de combate`,n}async generateRecommendations(s){try{if(!sa.isConfigured())return this.generateFallbackRecommendations(s);const t=await sa.generateTextSafe({prompt:this.buildRecommendationPrompt(s),systemMessage:this.getSystemPrompt(),maxTokens:1e3,temperature:.7});return this.parseJsonResponse(t.text).recommendations.map(i=>({id:this.generateRecommendationId(),type:i.type,priority:i.priority,title:i.title,description:i.description,reasoning:i.reasoning,actionSteps:i.actionSteps||[],estimatedBenefit:i.estimatedBenefit,estimatedTime:i.estimatedTime,prerequisites:i.prerequisites,relatedAchievements:i.relatedAchievements}))}catch(t){return console.warn("Error generating recommendations, using fallback:",t),this.generateFallbackRecommendations(s)}}async analyzeHeroWeaknesses(s){try{if(!sa.isConfigured())return this.getFallbackWeaknesses(s);const t=`Analise os atributos do herÃ³i ${s.name} e identifique pontos fracos:

Atributos:
${Object.entries(s.attributes).map(([i,n])=>`- ${i}: ${n}`).join(`
`)}

Classe: ${s.class}
NÃ­vel: ${s.progression.level}

Identifique 2-3 pontos fracos principais baseados nos atributos mais baixos e na classe do herÃ³i.
Responda apenas com uma lista simples, uma fraqueza por linha.`;return(await sa.generateTextSafe({prompt:t,systemMessage:"VocÃª Ã© um analista especializado em balanceamento de personagens de RPG.",maxTokens:150,temperature:.5})).text.split(`
`).map(i=>i.trim()).filter(i=>i.length>0).slice(0,3)}catch(t){return console.error("Error analyzing weaknesses:",t),this.getFallbackWeaknesses(s)}}async suggestOptimalBuild(s){try{if(!sa.isConfigured())return this.getFallbackBuild(s);const t=`Sugira um build otimizado para ${s.name} (${s.class}, nÃ­vel ${s.progression.level}):

Atributos atuais:
${Object.entries(s.attributes).map(([i,n])=>`- ${i}: ${n}`).join(`
`)}

ForneÃ§a em JSON:
{
  "attributePriorities": ["Atributo mais importante", "Segundo mais importante", "Terceiro"],
  "skillRecommendations": ["Habilidade 1", "Habilidade 2", "Habilidade 3"],
  "equipmentSuggestions": ["Equipamento 1", "Equipamento 2", "Equipamento 3"],
  "playstyleAdvice": "Conselho sobre estilo de jogo (100-150 palavras)"
}`,r=await sa.generateTextSafe({prompt:t,systemMessage:"VocÃª Ã© um especialista em builds otimizados para RPG medieval.",maxTokens:400,temperature:.6});return this.parseJsonResponse(r.text)}catch(t){return console.warn("Error suggesting optimal build, using fallback:",t),this.getFallbackBuild(s)}}async generateDailyGoals(s,t){var r,i;try{if(!sa.isConfigured())return this.getFallbackDailyGoals(s);const n=`Gere 3-5 objetivos diÃ¡rios personalizados para ${s.name}:

HerÃ³i: ${s.name} (${s.class}, nÃ­vel ${s.progression.level}, rank ${s.rank||"F"})

${t?`
Contexto:
- Tempo disponÃ­vel: ${t.availableTime}
- Atividades preferidas: ${((r=t.preferredActivities)==null?void 0:r.join(", "))||"NÃ£o especificado"}
- Objetivos atuais: ${((i=t.currentGoals)==null?void 0:i.join(", "))||"NÃ£o especificado"}
`:""}

Os objetivos devem ser:
- EspecÃ­ficos e mensurÃ¡veis
- Apropriados para o nÃ­vel do herÃ³i
- Variados e interessantes
- RealizÃ¡veis no tempo disponÃ­vel

Responda apenas com uma lista simples, um objetivo por linha.`;return(await sa.generateTextSafe({prompt:n,systemMessage:"VocÃª cria objetivos diÃ¡rios motivadores para jogadores de RPG.",maxTokens:200,temperature:.8})).text.split(`
`).map(c=>c.trim()).filter(c=>c.length>0).slice(0,5)}catch(n){return console.warn("Error generating daily goals, using fallback:",n),this.getFallbackDailyGoals(s)}}generateRecommendationId(){return`rec_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateFallbackRecommendations(s){const{hero:t}=s,r=[],i=Object.entries(t.attributes).sort(([,n],[,o])=>n-o)[0];return r.push({id:this.generateRecommendationId(),type:"training",priority:"medium",title:`Treinar ${i[0]}`,description:`Seu atributo ${i[0]} estÃ¡ abaixo da mÃ©dia. Focar no treinamento deste atributo melhorarÃ¡ significativamente sua performance geral.`,reasoning:`${i[0]} Ã© seu atributo mais fraco e limitante.`,actionSteps:["Encontre um instrutor especializado","Complete exercÃ­cios de treinamento","Pratique regularmente"],estimatedBenefit:"Melhoria significativa na performance",estimatedTime:"1-2 horas de jogo"}),r.push({id:this.generateRecommendationId(),type:"quest",priority:"high",title:"MissÃ£o de ProgressÃ£o",description:`Como ${t.class} de nÃ­vel ${t.progression.level}, vocÃª deveria focar em missÃµes que desafiem suas habilidades atuais e ofereÃ§am boa experiÃªncia.`,reasoning:"ProgressÃ£o constante Ã© essencial para o desenvolvimento.",actionSteps:["Procure missÃµes apropriadas para seu nÃ­vel","Prepare equipamentos adequados","Execute a missÃ£o com cuidado"],estimatedBenefit:"ExperiÃªncia e recompensas valiosas",estimatedTime:"30-45 minutos"}),r}getFallbackWeaknesses(s){return Object.entries(s.attributes).sort(([,r],[,i])=>r-i).slice(0,2).map(([r])=>`${r} baixo para a classe ${s.class}`)}getFallbackBuild(s){return{attributePriorities:{Warrior:["strength","constitution","agility"],Mage:["intelligence","wisdom","constitution"],Rogue:["agility","intelligence","strength"],Paladin:["strength","charisma","constitution"],Ranger:["agility","wisdom","strength"],Cleric:["wisdom","charisma","constitution"]}[s.class]||["strength","constitution","agility"],skillRecommendations:["Habilidade de classe principal","Habilidade de sobrevivÃªncia","Habilidade social"],equipmentSuggestions:["Arma principal melhorada","Armadura defensiva","AcessÃ³rio de atributo"],playstyleAdvice:`Como ${s.class}, foque em suas habilidades naturais enquanto desenvolve Ã¡reas complementares para um personagem bem equilibrado.`}}getFallbackDailyGoals(s){return[`Completar 2 missÃµes apropriadas para nÃ­vel ${s.progression.level}`,"Treinar atributo mais fraco por 30 minutos","Interagir com 3 NPCs diferentes","Coletar recursos para crafting","Participar de uma atividade social"]}}const Si=new yd,cs=({rank:a,progress:s,size:t="medium",showProgress:r=!1,animated:i=!0,onClick:n})=>{const{activeSeasonalTheme:o}=Qe(),[c,l]=x.useState(!1),d=a||(s==null?void 0:s.currentRank)||"F",m=fa[d]||{name:String(d),color:"#9CA3AF"};x.useEffect(()=>{if(i&&(s!=null&&s.canPromote)){const v=setInterval(()=>{l(y=>!y)},1e3);return()=>clearInterval(v)}},[i,s==null?void 0:s.canPromote]);const u=()=>{switch(t){case"small":return"w-16 h-16 text-xs";case"large":return"w-32 h-32 text-xl";default:return"w-24 h-24 text-base"}},p=()=>{var w;const v=o&&((w=Ke[o])==null?void 0:w.border)||et.effects.borders.gold;return`
      inline-flex items-center justify-center
      border-2 rounded-lg font-bold transition-all duration-300
      ${t==="small"?"w-12 h-12 text-sm":t==="medium"?"w-16 h-16 text-base":"w-20 h-20 text-lg"}
      ${i?"hover:scale-110 cursor-pointer":""}
      bg-gradient-to-br ${Ss(d)} ${v} text-white ${et.effects.shadows.glow}
    `},g=()=>!c||!(s!=null&&s.canPromote)?"":`${et.effects.shadows.large} scale-110`;return e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsxs("div",{className:`
          ${u()}
          ${p()}
          ${g()}
          ${i?"hover:scale-110":""}
          relative overflow-hidden focus:outline-none focus:ring-2 focus:ring-indigo-500
        `,tabIndex:n?0:-1,role:n?"button":void 0,onClick:n,children:[e.jsx("span",{className:"font-bold z-10",children:d}),e.jsx("span",{className:"absolute top-1 right-1 text-xs opacity-80",children:Ms(d)}),d==="S"&&i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"}),(s==null?void 0:s.canPromote)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-ping"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-sm",style:{color:(m==null?void 0:m.color)||"#9CA3AF"},children:(m==null?void 0:m.name)||String(a)}),r&&s&&s.nextRank&&e.jsxs("div",{className:"mt-2 w-24",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mb-1",children:[e.jsx("span",{children:d}),e.jsx("span",{children:s.nextRank})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-500",style:{width:`${s.progressPercentage}%`,backgroundColor:(m==null?void 0:m.color)||"#9CA3AF"}})}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 text-center",children:[Math.round(s.progressPercentage),"%"]})]})]})]})},jd=({hero:a,progress:s,showEstimate:t=!0,compact:r=!1})=>{var l;const i=fa[s.currentRank]||{name:String(s.currentRank||""),description:""},n=s.nextRank?fa[s.nextRank]||{name:String(s.nextRank||""),description:""}:null,o=t?We.estimateTimeToNextRank(a):null,c=d=>d>=90?"bg-green-500":d>=70?"bg-yellow-500":d>=50?"bg-blue-500":"bg-gray-500";return r?e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(cs,{rank:s.currentRank,size:"small"}),s.nextRank&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 mx-4",children:[e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${c(s.progressPercentage)}`,style:{width:`${s.progressPercentage}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 text-center",children:[Math.round(s.progressPercentage),"%"]})]}),e.jsx(cs,{rank:s.nextRank,size:"small"})]})]}),s.nextRank&&e.jsx("div",{className:"text-sm text-gray-400 text-center",children:s.canPromote?"ğŸ‰ Pronto para promoÃ§Ã£o!":`PrÃ³ximo: ${n==null?void 0:n.name}`})]}):e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(cs,{rank:s.currentRank,size:"medium"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:(i==null?void 0:i.name)||"Rank"}),e.jsx("div",{className:"text-sm text-gray-400",children:(i==null?void 0:i.description)||""})]})]}),s.nextRank&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 mx-8",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:"text-2xl",children:"â†’"})}),e.jsxs("div",{className:"w-full bg-gray-700 rounded-full h-4 relative",children:[e.jsx("div",{className:`h-4 rounded-full transition-all duration-500 ${c(s.progressPercentage)}`,style:{width:`${s.progressPercentage}%`}}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-semibold text-white",children:[Math.round(s.progressPercentage),"%"]})]}),o&&e.jsx("div",{className:"text-xs text-gray-400 mt-2 text-center",children:o.description})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(cs,{rank:s.nextRank,size:"medium",animated:s.canPromote}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:(n==null?void 0:n.name)||"PrÃ³ximo Rank"}),e.jsx("div",{className:"text-sm text-gray-400",children:(n==null?void 0:n.description)||""})]})]})]}),!s.nextRank&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ‘‘"}),e.jsx("div",{className:"font-semibold text-xl text-yellow-400",children:"Rank MÃ¡ximo!"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Lenda Viva AlcanÃ§ada"})]})]}),e.jsx("div",{className:"border-t border-gray-700 pt-4",children:(()=>{var y;const d=s.nextRank?_a[s.nextRank]:void 0;if(!(!!s.nextRank&&!!d))return e.jsx("div",{className:"text-center text-sm text-gray-400",children:"Sem prÃ³ximo rank â€” requisitos concluÃ­dos."});const u=Math.max(0,(s.requiredXP||0)-(s.currentXP||0)),p=Math.max(0,(s.requiredMissions||0)-(s.currentMissions||0)),g=d&&typeof d.titles=="number"?Math.max(0,d.titles-(((y=a.titles)==null?void 0:y.length)||0)):0,v=Array.isArray(d==null?void 0:d.specialRequirements)?d.specialRequirements:[];return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("div",{className:"font-semibold",children:"âš¡ XP"}),e.jsx("div",{className:u>0?"text-red-400":"text-green-400",children:u>0?`${u.toLocaleString()} restante`:"âœ“"})]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("div",{className:"font-semibold",children:"ğŸ—¡ï¸ MissÃµes"}),e.jsx("div",{className:p>0?"text-red-400":"text-green-400",children:p>0?`${p} restantes`:"âœ“"})]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("div",{className:"font-semibold",children:"ğŸ† TÃ­tulos"}),e.jsx("div",{className:g>0?"text-red-400":"text-green-400",children:g>0?`${g} restantes`:"âœ“"})]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("div",{className:"font-semibold",children:"âœ¨ Especiais"}),v.length>0?e.jsx("div",{className:"text-red-400",children:v.map(w=>w==="legendary_quest"?"MissÃ£o lendÃ¡ria":w==="epic_achievement"?"Feito Ã©pico":String(w)).join(" â€¢ ")}):e.jsx("div",{className:"text-green-400",children:"âœ“"})]})]})})()}),s.nextRank&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold",children:"âš¡ ExperiÃªncia"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[s.currentXP.toLocaleString()," / ",s.requiredXP.toLocaleString()]})]}),e.jsx("div",{className:"w-full bg-gray-600 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full bg-blue-500 transition-all duration-500",style:{width:`${Math.min(100,s.currentXP/s.requiredXP*100)}%`}})}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:s.requiredXP-s.currentXP>0?`${(s.requiredXP-s.currentXP).toLocaleString()} XP restante`:"Requisito cumprido âœ“"})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold",children:"ğŸ—¡ï¸ MissÃµes"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[s.currentMissions," / ",s.requiredMissions]})]}),e.jsx("div",{className:"w-full bg-gray-600 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full bg-green-500 transition-all duration-500",style:{width:`${Math.min(100,s.currentMissions/s.requiredMissions*100)}%`}})}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:s.requiredMissions-s.currentMissions>0?`${s.requiredMissions-s.currentMissions} missÃµes restantes`:"Requisito cumprido âœ“"})]}),(()=>{var m,u,p,g;const d=s.nextRank?_a[s.nextRank]:void 0;return!d||typeof d.titles!="number"?null:e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold",children:"ğŸ† TÃ­tulos"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[((m=a.titles)==null?void 0:m.length)||0," / ",d.titles]})]}),e.jsx("div",{className:"w-full bg-gray-600 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full bg-purple-500 transition-all duration-500",style:{width:`${Math.min(100,(((u=a.titles)==null?void 0:u.length)||0)/(d.titles||1)*100)}%`}})}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:(d.titles||0)-(((p=a.titles)==null?void 0:p.length)||0)>0?`${(d.titles||0)-(((g=a.titles)==null?void 0:g.length)||0)} tÃ­tulos restantes`:"Requisito cumprido âœ“"})]})})(),(()=>{const d=s.nextRank?_a[s.nextRank]:void 0,m=d==null?void 0:d.specialRequirements;return!Array.isArray(m)||m.length===0?null:e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"font-semibold",children:"âœ¨ Requisitos Especiais"})}),e.jsx("div",{className:"space-y-1",children:m.map((u,p)=>e.jsxs("div",{className:"text-sm text-gray-400",children:[u==="legendary_quest"&&"ğŸŒŸ Completar missÃ£o lendÃ¡ria",u==="epic_achievement"&&"âš¡ Conquistar feito Ã©pico"]},p))})]})})()]}),s.canPromote&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-yellow-900 font-bold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:["ğŸ‰ Promover para ",n==null?void 0:n.name,"!"]})}),e.jsx("div",{className:"border-t border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:a.progression.level}),e.jsx("div",{className:"text-sm text-gray-400",children:"NÃ­vel"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:a.progression.xp.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-400",children:"XP Total"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:a.stats.questsCompleted||0}),e.jsx("div",{className:"text-sm text-gray-400",children:"MissÃµes"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:((l=a.titles)==null?void 0:l.length)||0}),e.jsx("div",{className:"text-sm text-gray-400",children:"TÃ­tulos"})]})]})})]})};function wd(){var l;const{getSelectedHero:a,getHeroRankProgress:s}=Z(),t=a(),[r,i]=x.useState([]),[n,o]=x.useState(null),c=t?s(t.id):null;return x.useEffect(()=>{let d=!1;if(t)return(async()=>{try{const[m,u]=await Promise.all([Si.analyzeHeroWeaknesses(t),Si.suggestOptimalBuild(t)]);if(d)return;i(m||[]),o(u||null)}catch{d||(i([]),o(null))}})(),()=>{d=!0}},[t==null?void 0:t.id,(l=t==null?void 0:t.progression)==null?void 0:l.level]),t?e.jsxs("div",{className:`${Me.cardBase} border border-gray-700`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ğŸ§™ Conselhos do Mestre da Guilda"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Progresso de Rank"}),t&&c?e.jsx(jd,{hero:t,progress:c.progress,showEstimate:!0,compact:!1}):e.jsx("div",{className:"text-sm text-gray-400",children:"Selecione um herÃ³i para ver o progresso de rank."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"SugestÃ£o de Build"}),n?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"Prioridades:"})," ",n.attributePriorities.join(", ")]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"Habilidades:"})," ",n.skillRecommendations.join(", ")]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"Equipamentos:"})," ",n.equipmentSuggestions.join(", ")]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"Estilo de jogo:"})," ",n.playstyleAdvice]})]}):e.jsx("div",{className:"text-sm text-gray-400",children:"Construindo recomendaÃ§Ãµesâ€¦"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Pontos Fracos"}),r.length?e.jsx("ul",{className:"space-y-2",children:r.map((d,m)=>e.jsx("li",{className:"p-2 rounded border bg-gray-900 border-gray-700",children:d},`weak-${m}`))}):e.jsx("div",{className:"text-sm text-gray-400",children:"Analisando atributosâ€¦"})]})]})]}):e.jsx("div",{className:`${Me.cardBase} border border-gray-700`,children:e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ¦¸"}),e.jsx("p",{children:"Selecione um herÃ³i para receber conselhos personalizados."})]})})}const Nd=at.lazy(()=>wt(()=>import("./EggIdentificationNPC-0c8fce97.js"),["assets/EggIdentificationNPC-0c8fce97.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Sd=at.lazy(()=>wt(()=>import("./RelationshipsPanel-16082cf0.js"),["assets/RelationshipsPanel-16082cf0.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Cd=()=>{var K,xe,W;const{guilds:a,ensureDefaultGuildExists:s,refreshQuests:t,availableQuests:r,heroes:i,getSelectedHero:n,sellItem:o,getHeroRankProgress:c,activateGuildEvent:l,clearGuildEvent:d,approvePartyAlliance:m,rejectPartyAlliance:u,ensureNPCAdventurersSeedExists:p,startNPCSimulation:g,stopNPCSimulation:v}=Z(),y=Pa(B=>B.npcSeedTarget||30),w=n();w&&c(w.id);const{activeSeasonalTheme:k}=Qe(),E=k&&((K=Ke[k])==null?void 0:K.border)||"border-gray-200",[h,b]=x.useState({}),[f,j]=x.useState("todos"),[N,T]=x.useState("todas"),[F,te]=x.useState("missoes"),[D,$]=x.useState("salao"),X=[{id:"missoes",label:"MissÃµes",sections:[{id:"salao",label:"SalÃ£o Principal",icon:"ğŸ›ï¸"},{id:"sala-herois",label:"SalÃ£o dos HerÃ³is",icon:"ğŸ†"}]},{id:"social",label:"Social",sections:[{id:"relacoes",label:"RelaÃ§Ãµes",icon:"ğŸ¤"},{id:"zoologo",label:"Mestre ZoÃ³logo Arkemis",icon:"ğŸ”®"}]},{id:"gestao",label:"GestÃ£o",sections:[{id:"conselhos",label:"Conselhos do Mestre da Guilda",icon:"ğŸ§™"}]}],Q=X.find(B=>B.id===F)||X[0],Y=X.flatMap(B=>B.sections),G=B=>{var se;return((se=Y.find(z=>z.id===B))==null?void 0:se.label)||""};x.useEffect(()=>{Q.sections.find(B=>B.id===D)||$(Q.sections[0].id)},[F]),x.useEffect(()=>{s(),p(y),g();try{Z.getState().triggerAutoInteraction("guild")}catch{}const B=setInterval(()=>{try{Z.getState().triggerAutoInteraction("guild")}catch{}},Math.max(6e4,(Pa.getState().npcRotationSeconds||60)*1e3));return()=>{clearInterval(B),v()}},[s,y]);const J=a.find(B=>B.name==="Foja dos Herois");J&&(J.level??Math.max(1,Math.floor(J.guildXP/250)+1)),w&&J&&((J.councilMembers||[]).includes(w.id)||((xe=J.roles)==null||xe[w.id])),(W=w==null?void 0:w.rankData)==null||W.currentRank;const ee=x.useMemo(()=>Ya(i),[i]).find(B=>B.id==="level"),fe=ee?ee.entries.slice(0,5):[],[_,P]=x.useState([]),[M,C]=x.useState(null),[A,O]=x.useState(!1),[S,I]=x.useState({});x.useEffect(()=>{(async()=>{const B=await pd(10);B.offline&&O(!0),B.error&&C(B.error),B.data&&P(B.data)})()},[]),x.useEffect(()=>{(async()=>{const B=new Date,se=new Date(B.getTime()-7*24*60*60*1e3),z=vt.getActivityFeed({dateRange:{start:se,end:B},showOnlyPublic:!0}),V=z.activities.filter(de=>de.type==="epic-quest-completed"||de.type==="quest-completed").sort((de,ve)=>{var Ae,Te,qe,Oe,it,nt,Xe,we;return Number(((Te=(Ae=ve.data)==null?void 0:Ae.questReward)==null?void 0:Te.xp)||0)+Number(((Oe=(qe=ve.data)==null?void 0:qe.questReward)==null?void 0:Oe.gold)||0)-(Number(((nt=(it=de.data)==null?void 0:it.questReward)==null?void 0:nt.xp)||0)+Number(((we=(Xe=de.data)==null?void 0:Xe.questReward)==null?void 0:we.gold)||0))})[0],ie=z.activities.filter(de=>de.type==="rank-promotion").slice(0,5).map(de=>({heroName:de.data.heroName,newRank:String(de.data.newRank||"")})),he=z.activities.filter(de=>de.type==="guild-event-activated").sort((de,ve)=>ve.timestamp.getTime()-de.timestamp.getTime())[0],{data:H,offline:me}=await gd();I({bestQuest:V?{heroName:V.data.heroName,questName:String(V.data.questName||"MissÃ£o extraordinÃ¡ria")}:void 0,biggestLoot:H!=null&&H.biggestLoot?{heroName:H.biggestLoot.hero_name,totalGold:H.biggestLoot.total_gold}:void 0,promotions:ie,weeklyEvent:he?{guildName:String(he.data.guildName||"Guilda"),eventName:String(he.data.eventName||"Evento da Guilda"),xpBuffPercent:he.data.xpBuffPercent,trainingDiscountPercent:he.data.trainingDiscountPercent,expiresAt:typeof he.data.eventExpiresAt=="string"?he.data.eventExpiresAt:void 0}:void 0})})()},[]);const ae=w?Object.entries(w.inventory.items).filter(([,B])=>B>0):[],ne=ae.filter(([B])=>{const se=Ee.find(z=>z.id===B);return!(!se||f!=="todos"&&se.type!==f||N!=="todas"&&se.rarity!==N)}),U=(B,se,z)=>{const V=Math.max(1,Math.min(z,Math.floor(se||1)));b(ie=>({...ie,[B]:V}))},R=B=>{if(!w)return;const se=Ee.find(me=>me.id===B),z=w.inventory.items[B]||0,V=Math.max(1,Math.min(z,h[B]||1)),ie=se&&(se.type==="weapon"&&w.inventory.equippedWeapon===B||se.type==="armor"&&w.inventory.equippedArmor===B||se.type==="accessory"&&(w.inventory.equippedAccessories||[]).includes(B));if(!se){ge.emit({title:"Item desconhecido",message:"NÃ£o foi possÃ­vel identificar o item para venda.",type:"error",icon:"âš ï¸"});return}if(ie){ge.emit({title:"Item equipado",message:"Desequipe o item antes de vendÃª-lo (use o painel de Equipamentos).",type:"error",icon:"âš ï¸"});return}if(z<=0){ge.emit({title:"Sem estoque",message:"VocÃª nÃ£o possui este item no inventÃ¡rio.",type:"error",icon:"âš ï¸"});return}const he=Math.floor(se.price*.6*V);o(w.id,B,V)?(ge.emit({title:"Venda concluÃ­da",message:`${V}x ${se.name} vendido por ${he} ouro!`,type:"success",icon:"ğŸ’°"}),b(me=>({...me,[B]:1}))):ge.emit({title:"Falha na venda",message:`NÃ£o foi possÃ­vel vender ${se.name}. Verifique a quantidade.`,type:"error",icon:"âš ï¸"})},L=()=>{if(!w)return;const B=ae.filter(([V,ie])=>{const he=Ee.find(H=>H.id===V);return!!he&&he.type==="consumable"&&ie>0});if(B.length===0){ge.emit({title:"Nada para vender",message:"Nenhum consumÃ­vel disponÃ­vel no inventÃ¡rio.",type:"error",icon:"âš ï¸"});return}let se=0,z=0;B.forEach(([V,ie])=>{const he=Ee.find(me=>me.id===V),H=Math.floor(he.price*.6);se+=H*ie,z+=ie,o(w.id,V,ie)}),ge.emit({title:"Venda em massa concluÃ­da",message:`${z} consumÃ­veis vendidos por ${se} ouro!`,type:"success",icon:"ğŸ’°"})},oe=B=>{if(!w)return;const se=Ee.find(H=>H.id===B),z=w.inventory.items[B]||0;if(!se){ge.emit({title:"Item desconhecido",message:"NÃ£o foi possÃ­vel identificar o item para venda.",type:"error",icon:"âš ï¸"});return}if(se.type==="weapon"&&w.inventory.equippedWeapon===B||se.type==="armor"&&w.inventory.equippedArmor===B||se.type==="accessory"&&(w.inventory.equippedAccessories||[]).includes(B)){ge.emit({title:"Item equipado",message:"Desequipe o item antes de vendÃª-lo (use o painel de Equipamentos).",type:"error",icon:"âš ï¸"});return}if(z<=0){ge.emit({title:"Sem estoque",message:"VocÃª nÃ£o possui este item no inventÃ¡rio.",type:"error",icon:"âš ï¸"});return}const ie=Math.floor(se.price*.6*z);o(w.id,B,z)?(ge.emit({title:"Venda concluÃ­da",message:`${z}x ${se.name} vendido por ${ie} ouro!`,type:"success",icon:"ğŸ’°"}),b(H=>({...H,[B]:1}))):ge.emit({title:"Falha na venda",message:`NÃ£o foi possÃ­vel vender ${se.name}.`,type:"error",icon:"âš ï¸"})};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:`${Me.surface} p-6 rounded-lg border ${E} mb-4 ${Me.surfaceText} overflow-hidden`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"ğŸ° Foja dos Herois"}),e.jsx("p",{className:"text-gray-300 mt-2",children:"Hub central: missÃµes, recrutamento, ranks, treino e tesouro."})]}),e.jsx("div",{className:"text-4xl",children:"ğŸ›¡ï¸"})]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-400",children:["Guild Hub v",bd]}),e.jsx(Ni,{items:X.map(B=>({id:B.id,label:B.label})),activeId:F,onChange:B=>te(B),size:"sm",className:"mt-6"}),e.jsx(Ni,{items:Q.sections.map(B=>({id:B.id,label:B.label,icon:B.icon})),activeId:D,onChange:B=>$(B),className:"mt-2"}),e.jsxs("div",{className:`mt-2 text-xs ${Me.breadcrumbText}`,children:["Guild Hub â€º ",Q.label," â€º ",G(D)]})]}),D==="salao"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:e.jsx(Tn,{})}),e.jsx(vd,{}),e.jsxs("div",{className:`${Me.cardBase} border ${E}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ğŸ“œ Quadro de MissÃµes"}),e.jsx("a",{href:"/quests",className:"px-4 py-2 rounded bg-amber-600 text-black hover:bg-amber-500 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Abrir"})]}),e.jsx("div",{className:"text-sm text-gray-300",children:"MissÃµes unificadas de caÃ§a e escolta com interface clara e progressÃ£o integrada da guilda."})]}),e.jsxs("div",{className:`${Me.cardBase} border ${E}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ğŸ† Ranking RÃ¡pido"}),e.jsx("a",{href:"/leaderboards",className:"px-4 py-2 rounded bg-amber-600 text-black hover:bg-amber-500 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Ver Completo"})]}),fe.length>0?e.jsx("ul",{className:"space-y-2",children:fe.map((B,se)=>{var z;return e.jsxs("li",{className:"flex items-center justify-between bg-gray-900 border border-gray-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-xl",children:[se+1,"."]}),e.jsx("span",{className:"font-semibold",children:B.heroName}),((z=i.find(V=>V.id===B.heroId))==null?void 0:z.origin)==="npc"&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded",children:"NPC"})]}),e.jsxs("span",{className:"text-sm text-gray-300",children:["NÃ­vel ",B.value]})]},B.heroId)})}):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ†"}),e.jsx("p",{children:"Nenhum herÃ³i no ranking ainda."})]})]}),e.jsxs("div",{className:`bg-gray-800 p-6 rounded-lg border ${E} text-gray-100`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ğŸ—ï¸ Dungeon Infinita"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("a",{href:"/dungeon-infinita",className:"px-4 py-2 rounded bg-purple-600 text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Jogar"})})]}),A&&e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Modo offline: conecte o Supabase para ver o ranking."}),M&&e.jsx("div",{className:"text-sm text-red-600 mb-2",children:M}),_.length>0?e.jsx("ul",{className:"space-y-2",children:_.map((B,se)=>e.jsxs("li",{className:"flex items-center justify-between bg-gray-900 border border-gray-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-xl",children:[se+1,"."]}),e.jsx("span",{className:"font-semibold",children:B.hero_name})]}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Andar ",B.max_floor_reached," â€¢ ",B.total_xp," XP â€¢ ",B.total_gold," ouro"]})]},`${B.hero_name}-${B.finished_at}-${se}`))}):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ—ï¸"}),e.jsx("p",{children:"Nenhuma tentativa registrada ainda."})]})]}),e.jsxs("div",{className:`bg-gray-800 p-6 rounded-lg border ${E} text-gray-100`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ğŸ’° Mercado de EspÃ³lios"}),e.jsxs("div",{className:"flex items-center gap-2",children:[w&&e.jsx("button",{onClick:L,className:"px-4 py-2 rounded bg-amber-600 text-black hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",title:"Vender todos os consumÃ­veis do inventÃ¡rio",children:"Vender todos consumÃ­veis"}),!w&&e.jsx("a",{href:"/",className:"px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Selecionar HerÃ³i"})]})]}),w&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-300",children:"Tipo"}),e.jsxs("select",{value:f,onChange:B=>j(B.target.value),className:"px-2 py-1 border rounded text-sm bg-gray-900 text-gray-200 border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"consumable",children:"ConsumÃ­vel"}),e.jsx("option",{value:"weapon",children:"Arma"}),e.jsx("option",{value:"armor",children:"Armadura"}),e.jsx("option",{value:"accessory",children:"AcessÃ³rio"}),e.jsx("option",{value:"material",children:"Material"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-300",children:"Raridade"}),e.jsxs("select",{value:N,onChange:B=>T(B.target.value),className:"px-2 py-1 border rounded text-sm bg-gray-900 text-gray-200 border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"todas",children:"Todas"}),e.jsx("option",{value:"comum",children:"Comum"}),e.jsx("option",{value:"raro",children:"Raro"}),e.jsx("option",{value:"epico",children:"Ã‰pico"}),e.jsx("option",{value:"lendario",children:"LendÃ¡rio"})]})]}),e.jsx("button",{onClick:()=>{j("todos"),T("todas")},className:"px-3 py-1 rounded bg-gray-900 text-gray-200 hover:bg-gray-800 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 border border-gray-700",children:"Limpar filtros"})]}),w?ne.length>0?e.jsx("div",{className:"space-y-3",children:ne.map(([B,se])=>{const z=Ee.find(H=>H.id===B);if(!z)return null;const V=Math.floor(z.price*.6),ie=h[B]??1,he=z.type==="weapon"&&w.inventory.equippedWeapon===B||z.type==="armor"&&w.inventory.equippedArmor===B||z.type==="accessory"&&(w.inventory.equippedAccessories||[]).includes(B);return e.jsxs("div",{className:"flex items-center justify-between bg-gray-900 border border-gray-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-2xl",children:z.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:z.name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Qtd: ",se," â€¢ PreÃ§o venda: ",V," ouro/un"]}),he&&e.jsx("div",{className:"text-xs text-red-600",children:"Equipado â€” desequipe para vender."})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"number",min:1,max:se,value:ie,onChange:H=>U(B,Number(H.target.value),se),className:"w-20 px-2 py-1 border rounded bg-gray-900 text-gray-200 border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500","aria-label":`Quantidade para vender ${z.name}`}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Total: ",V*Math.max(1,Math.min(se,ie))," ouro"]}),e.jsx("button",{onClick:()=>R(B),disabled:he,className:`px-4 py-2 rounded text-white ${he?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:"Vender"}),e.jsx("button",{onClick:()=>oe(B),disabled:he||se<=0,className:`px-4 py-2 rounded text-white ${he||se<=0?"bg-gray-400 cursor-not-allowed":"bg-amber-600 hover:bg-amber-700"} focus:outline-none focus:ring-2 focus:ring-indigo-500`,title:he?"Item equipado â€” desequipe para vender":"Vender toda a quantidade disponÃ­vel",children:"Vender Tudo"})]})]},B)})}):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ“¦"}),e.jsx("p",{children:"Nenhum espÃ³lio para vender no momento."})]}):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ¦¸"}),e.jsx("p",{children:"Selecione um herÃ³i para acessar o mercado."})]})]})]}),D==="treinamento"&&e.jsxs("div",{className:`${Me.cardBase} border border-gray-200`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ğŸ‹ï¸ Sala de Treinamento"}),e.jsx(Mn,{})]}),D==="sala-herois"&&e.jsxs("div",{className:`${Me.cardBase} border border-gray-200`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ğŸ† SalÃ£o dos HerÃ³is"}),e.jsx(In,{})]}),D==="relacoes"&&e.jsx("div",{className:`${Me.cardBase} border ${E}`,children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"text-xs text-gray-400",children:"Carregando RelaÃ§Ãµesâ€¦"}),children:e.jsx(Sd,{})})}),D==="conselhos"&&e.jsx("div",{className:`${Me.cardBase} border ${E}`,children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"text-xs text-gray-400",children:"Gerando Conselhosâ€¦"}),children:e.jsx(wd,{})})}),D==="zoologo"&&e.jsxs("div",{className:`${Me.cardBase} border border-gray-200`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ğŸ”® Mestre ZoÃ³logo Arkemis"}),e.jsx("div",{className:"text-sm text-gray-300 mb-4",children:"IdentificaÃ§Ã£o oficial de ovos misteriosos, com custos variÃ¡veis por raridade."}),e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded p-4",children:w?e.jsx("div",{className:"space-y-4",children:e.jsx(at.Suspense,{fallback:e.jsx("div",{className:"text-sm text-gray-300",children:"Carregando..."}),children:e.jsx(Nd,{})})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ¦¸"}),e.jsx("p",{children:"Selecione um herÃ³i para consultar o Mestre ZoÃ³logo."})]})})]})]})},kd=({heroes:a,onHeroSelect:s})=>{const{getSelectedHero:t}=Z(),r=t();a.filter(o=>o.origin!=="npc");const i=(r==null?void 0:r.id)||null,n=o=>{s(o)};return a.length===0?e.jsxs("div",{className:"text-center p-8 bg-slate-800/50 rounded-lg border border-amber-500/30",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ğŸ¦¸"}),e.jsx("h3",{className:"text-xl font-bold text-amber-400 mb-2",children:"Nenhum HerÃ³i Criado"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"VocÃª precisa criar um herÃ³i primeiro para acessar as missÃµes."}),e.jsx("a",{href:"/",className:"inline-block px-6 py-3 bg-amber-600 hover:bg-amber-700 text-white font-medium rounded-lg transition-colors",children:"Criar Primeiro HerÃ³i"})]}):e.jsxs("div",{className:"bg-slate-800/50 rounded-lg border border-amber-500/30 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-amber-400 mb-4 text-center",children:"Escolha seu HerÃ³i"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(o=>{const c=Ui(o.element);return e.jsx("div",{onClick:()=>n(o.id),className:`bg-slate-700/50 rounded-lg p-4 border transition-all cursor-pointer group ${i===o.id?"border-amber-500 bg-amber-900/20":"border-slate-600 hover:border-amber-500 hover:bg-slate-700/70"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-3xl",children:o.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-white group-hover:text-amber-400 transition-colors",children:o.name}),e.jsxs("div",{className:"text-sm text-gray-300 flex items-center space-x-2",children:[e.jsxs("span",{children:[gn(o.class)," ",o.class]}),e.jsxs("span",{style:{color:(c==null?void 0:c.color)||"#9CA3AF"},children:[(c==null?void 0:c.icon)||"âš¡"," ",o.element]})]}),e.jsxs("div",{className:"text-xs text-amber-600",children:["NÃ­vel ",o.progression.level," â€¢ ",o.progression.experience," XP"]}),i===o.id&&e.jsx("div",{className:"text-xs text-green-400 mt-1 font-medium",children:"âœ“ HerÃ³i selecionado! Carregando missÃµes..."})]})]})},o.id)})})]})},Ad=()=>{var O;const{getSelectedHero:a,availableQuests:s,refreshQuests:t,acceptQuest:r,completeQuest:i,abandonQuest:n,clearActiveQuests:o,gainXP:c,gainGold:l,addItemToInventory:d,updateHero:m,updateDailyGoalProgress:u,selectHero:p,heroes:g,getQuestById:v}=Z(),y=a(),w=x.useMemo(()=>(g||[]).filter(S=>S.origin!=="npc"),[g]),k=x.useMemo(()=>{try{const S=new Set;return(s||[]).filter(I=>{const ae=String(I.id);return S.has(ae)?!1:(S.add(ae),!0)})}catch{return s}},[s]),E=x.useMemo(()=>{try{return Array.from(new Set(y.activeQuests||[]))}catch{return y.activeQuests}},[y.activeQuests]),h=x.useMemo(()=>{try{return Array.from(new Set(y.completedQuests||[]))}catch{return y.completedQuests}},[y.completedQuests]),[b,f]=x.useState("available"),[j,N]=x.useState(()=>{try{return new URLSearchParams(window.location.search).get("companions")==="1"?!0:localStorage.getItem("questboard_companions_only")==="1"}catch{return!1}}),[T,F]=x.useState(0),[te,D]=x.useState(null),[$,X]=x.useState(()=>Date.now());x.useEffect(()=>{!y&&w.length>0&&(p(w[0].id),t(w[0].progression.level))},[y==null?void 0:y.id,w.length]),x.useEffect(()=>{console.log("Estado do herÃ³i selecionado mudou:",(y==null?void 0:y.name)||"Nenhum")},[y]),x.useEffect(()=>{const S=setInterval(()=>{t((y==null?void 0:y.progression.level)||1)},6e5);return()=>clearInterval(S)},[y==null?void 0:y.id]);const Q=()=>{if(!y)return;const S=Date.now();te&&S<te||(t(y.progression.level),D(S+5*60*1e3))},Y=S=>{console.log("Clique detectado! Selecionando herÃ³i:",S),p(S);const I=w.find(ae=>ae.id===S);I&&(console.log("Atualizando missÃµes para herÃ³i:",I.name,"Level:",I.progression.level),t(I.progression.level)),console.log("HerÃ³i selecionado, forÃ§ando atualizaÃ§Ã£o..."),F(ae=>ae+1),setTimeout(()=>{const ae=g.find(ne=>ne.id===S);console.log("HerÃ³i encontrado:",ae==null?void 0:ae.name)},100)};if(!y)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ“œ"}),e.jsx("h2",{className:"text-3xl font-bold text-amber-400 mb-4",children:"Quadro de MissÃµes"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Selecione um herÃ³i para ver as missÃµes disponÃ­veis"})]}),e.jsx(kd,{heroes:w,onHeroSelect:Y})]});const G=S=>{switch(S){case"rapida":return"text-green-400 bg-green-900/20";case"padrao":return"text-yellow-400 bg-yellow-900/20";case"epica":return"text-purple-400 bg-purple-900/20";default:return"text-gray-400 bg-gray-900/20"}},J=S=>{switch(S){case"rapida":return"RÃ¡pida";case"padrao":return"PadrÃ£o";case"epica":return"Ã‰pica";default:return"Desconhecido"}},re=S=>{switch(S){case"contrato":return"ğŸ“œ";case"caca":return"âš”ï¸";case"exploracao":return"ğŸ—ºï¸";case"historia":return"ğŸ“–";default:return"â“"}};x.useEffect(()=>{const S=setInterval(()=>X(Date.now()),1e3);return()=>clearInterval(S)},[]);const ee=x.useMemo(()=>{var I;const S=(I=y==null?void 0:y.questing)!=null&&I.cooldownEndsAt?new Date(y.questing.cooldownEndsAt).getTime():0;return S?Math.max(0,S-$):0},[(O=y==null?void 0:y.questing)==null?void 0:O.cooldownEndsAt,$]),fe=ee>0,_=S=>{const I=Math.max(0,Math.floor(S/1e3)),ae=Math.floor(I/3600),ne=Math.floor(I%3600/60),U=I%60,R=L=>String(L).padStart(2,"0");return ae>0?`${R(ae)}:${R(ne)}:${R(U)}`:`${R(ne)}:${R(U)}`},P=S=>y.progression.level>=S.levelRequirement&&!y.activeQuests.includes(S.id)&&!fe,M=S=>{P(S)&&y&&(console.log("ğŸ¯ Aceitando missÃ£o:",S.title,"para herÃ³i:",y.name),r(y.id,S.id))},C=({hero:S,quest:I})=>{var Re,rt;const[ae,ne]=x.useState(!1),[U,R]=x.useState(!1),[L,oe]=x.useState(0),[K,xe]=x.useState([]),[W,B]=x.useState(!1),[se,z]=x.useState(I.categoryHint==="escolta"?100:null),[V,ie]=x.useState(!1),[he,H]=x.useState(0),[me,de]=x.useState(null),ve=x.useMemo(()=>{var ct;const Pe=((ct=S.rankData)==null?void 0:ct.currentRank)||S.rank||"F",ce=Pe==="F"||Pe==="E",Ie=Pe==="D",Le=I.phasesHint||(I.difficulty==="epica"?6:I.difficulty==="padrao"?4:3);return ce&&I.difficulty==="rapida"?2:Ie&&I.difficulty==="epica"?Math.max(5,Le):Math.max(2,Le)},[(Re=S.rankData)==null?void 0:Re.currentRank,S.rank,I.phasesHint,I.difficulty]),Ae=x.useMemo(()=>I.difficulty==="rapida"?2:I.difficulty==="epica"?4:3,[I.difficulty]),Te=I.biomeHint||"Floresta Nebulosa",qe=I.categoryHint||(I.type==="caca","controle"),Oe=x.useMemo(()=>{var ce;const Pe=(ce=S==null?void 0:S.questing)!=null&&ce.cooldownEndsAt?new Date(S.questing.cooldownEndsAt).getTime():0;return Pe?Math.max(0,Pe-Date.now()):0},[(rt=S==null?void 0:S.questing)==null?void 0:rt.cooldownEndsAt]),it=Oe>0;x.useEffect(()=>{var Pe;try{const Ie=(((Pe=S.stats)==null?void 0:Pe.missionRunState)||{})[String(I.id)];Ie&&(oe(Math.max(0,Ie.phase||0)),z(typeof Ie.npcIntegrity=="number"?Ie.npcIntegrity:I.categoryHint==="escolta"?100:null),ne(!!Ie.running),R(!!Ie.finished),Array.isArray(Ie.logs)&&Ie.logs.length>0&&xe(Ie.logs.map(Le=>({phase:Le.phase,success:!0,xp:Le.xp,gold:Le.gold,narrative:Le.narrative,itemsAwarded:[]}))))}catch{}},[S.id,I.id]);const nt=(Pe,ce,Ie,Le,ct)=>{var ue;try{const ye={...((ue=S.stats)==null?void 0:ue.missionRunState)||{}};ye[String(I.id)]={phase:Pe,npcIntegrity:ce??void 0,running:Ie,finished:Le,logs:ct},m(S.id,{stats:{...S.stats,missionRunState:ye}})}catch{}},Xe=()=>{var Ie;if(it){de("Cooldown ativo para missÃµes. Aguarde o tempo de recarga.");return}const Pe=Math.max(0,Number(((Ie=S.progression)==null?void 0:Ie.fatigue)||0)),ce=ut.computeEffectiveStaminaCost(S,Ae);if(Pe+ce>100){de("Fadiga alta â€” descanse antes de iniciar.");return}ne(!0),R(!1),oe(0),xe([]),de(null),H(0),z(qe==="escolta"?100:null),ie(!1),nt(0,qe==="escolta"?100:null,!0,!1,[])},we=()=>{var Dr,$r,_r,qr,Fr;if(U)return;const Pe=L>=2?1:0,ce=(Dr=S.stats)==null?void 0:Dr.helpStatus,Ie=ce&&ce.staminaCostReduction?Math.max(0,Math.min(2,ce.staminaCostReduction)):0,Le=Math.max(1,Ae+Pe-Ie),ct=ut.computeEffectiveStaminaCost(S,Le);if(Math.max(0,Number((($r=S.progression)==null?void 0:$r.fatigue)||0))+ct>100){de("Fadiga alta â€” pare e descanse."),ne(!1);return}ut.consumeStamina(S,Le),m(S.id,{progression:S.progression});const ye=I.difficulty==="epica"?.45:I.difficulty==="dificil"?.6:I.difficulty==="medio"?.7:.8,Be=.06,Ge=S.attributes,ke=qe==="controle"?(Ge.destreza||0)*.01:qe==="coleta"?(Ge.inteligencia||0)*.01:qe==="escolta"?(Ge.constituicao||0)*.008:(Ge.forca||0)*.008,De=.2,Ne=ce&&ce.successBoostPercent?Math.max(0,Math.min(.2,ce.successBoostPercent)):0,pe=Math.max(De,Math.min(.95,ye-L*Be+ke+Ne)),Se=Math.random()<pe,Fe=ma(he),ze=((_r=I.baseRewardsHint)==null?void 0:_r.xp)||25,jt=((qr=I.baseRewardsHint)==null?void 0:qr.gold)||25,bt=1+Math.max(0,ve-3)*.15,q=Math.round(ze*bt),le=Math.round(jt*bt),Ce=qe==="especial"&&L+1===ve,_e=Ce?1.5:1,Je=To(S),{getHeroParty:Nt,consumeOneMissionContract:lt}=Z.getState(),ot=Nt(S.id),xt=ot&&ot.contractByHeroId&&ot.contractByHeroId[S.id]?Math.max(0,Math.min(.5,(ot.contractByHeroId[S.id].rewardShare||0)/100)):0,St=ce&&ce.boostXpPercent?Math.max(0,Math.min(.5,ce.boostXpPercent)):0,Yt=ce&&ce.goldBonusPercent?Math.max(0,Math.min(.5,ce.goldBonusPercent)):0,Ht=Math.round((Se?q:Math.round(q*.5))*(1+xt)*Fe*_e*(1+Je+St)),Ye=Math.round((Se?le:Math.round(le*.3))*(1+xt)*Fe*_e*(1+Math.min(.25,Je)+Yt));c(S.id,Ht),l(S.id,Ye);const dt=Math.random()<(Se?.5:.25)?[]:[];dt.forEach(st=>d(S.id,st.id||"",1));const Gt={controle:["pele-lobo-sombrio","colmilho-vampirico","osso-antigo"],coleta:["erva-sangue","essencia-lunar","cristal-runico"],escolta:["pergaminho-protecao","pergaminho-velocidade"],especial:Ce?["lamina-alpha","armadura-pedra-rachada"]:[]}[qe]||[],Dt=[];if(Gt.length){const st=Ce?1:Se?.7:.4,zt=Math.max(0,Math.min(.25,(ve-3)*.05)),Zt=ce&&ce.lootDropBonusPercent?Math.max(0,Math.min(.5,ce.lootDropBonusPercent)):0,pa=Math.min(1,st+zt+Zt),Ut=new Date().getHours(),ga=Ut<6||Ut>=18,Ft=Ut>=8&&Ut<17,Pt=Gt.filter(xa=>xa==="essencia-lunar"?ga:xa==="erva-sangue"?Ft:xa==="cristal-runico"?Te==="Caverna Antiga"||Te==="RuÃ­nas Antigas":!0);if(Pt.length&&Math.random()<pa){const xa=Pt[Math.floor(Math.random()*Pt.length)];d(S.id,xa,1),Dt.push(xa)}}const Et={"Colinas de Boravon":["Lobo Sombrio","Bandido"],"Rio Marfim":["Slime Ãcido","Serpente do Rio"],"Floresta Nebulosa":["Morcego Vampiro","Bruxa da NÃ©voa"],"RuÃ­nas Antigas":["Golem Rachado","Esqueleto"],"Floresta Umbral":["Bruxa da NÃ©voa","Lobo Sombrio"],"Caverna Antiga":["Troll de Pedra","Slime Ãcido"]},ba=qe==="escolta"?.25:.15,Ia=ce&&ce.ambushReductionPercent?Math.max(0,Math.min(.9,ce.ambushReductionPercent)):0,Es=Math.random()<Math.max(0,(ba+(I.difficulty==="dificil"?.05:I.difficulty==="epica"?.1:0))*(1-Ia));let Rt=se,Pr="";if(Es){const st=Et[Te]||["Inimigos"],zt=st[Math.floor(Math.random()*st.length)],Zt=Math.round((S.derivedAttributes.hp||20)*.1),pa=Math.max(0,Math.round(Zt*(1-Ia))),Ut=S.derivedAttributes.currentHp??(S.derivedAttributes.hp||0),ga=Math.max(0,Ut-pa);m(S.id,{derivedAttributes:{...S.derivedAttributes,currentHp:ga}}),Pr=` â€¢ Emboscada: ${zt} causa dano.`,Rt!==null&&(Rt=Math.max(0,(Rt??0)-10));const Ft=S.derivedAttributes.hp||1;ga/Ft<.2&&(B(!1),de("HP baixo, auto desativado."))}if(!Se){const st=S.derivedAttributes.hp||1,zt=S.derivedAttributes.currentHp??st,Zt=Math.round(st*.1),pa=Math.max(0,zt-Zt),Ut=Math.min(100,(S.progression.fatigue||0)+6);m(S.id,{derivedAttributes:{...S.derivedAttributes,currentHp:pa},progression:{...S.progression,fatigue:Ut}}),Rt!==null&&(Rt=Math.max(0,(Rt??0)-15));const ga=S.derivedAttributes.hp||1;pa/ga<.2&&(B(!1),de("HP baixo, auto desativado."))}Rt!=null&&z(Rt);const Gn=st=>{var zt;return((zt=Ee.find(Zt=>Zt.id===st))==null?void 0:zt.name)||st},Ir={phase:L+1,success:Se,xp:Ht,gold:Ye,narrative:(Se?`Progresso na fase ${L+1}.`:`RevÃ©s na fase ${L+1}.`)+Pr+(Je>0?` â€¢ Buff de relaÃ§Ã£o +${Math.round(Je*100)}%`:"")+(xt>0?` â€¢ Acordo da party +${Math.round(xt*100)}%`:""),itemsAwarded:[...dt.map(st=>({id:st.id,name:st.name})),...Dt.map(st=>({id:st,name:Gn(st)}))]},zn=[...K,{phase:L+1,xp:Ht,gold:Ye,narrative:Ir.narrative}];xe(st=>[...st,Ir]),(dt.length>0||Dt.length>0)&&ie(!0),H(st=>st+(Se?1:0));const Tr=L+1;oe(st=>st+1);const Rs=Rt!=null&&Rt<=0||Tr>=ve;if(Rs){R(!0),ne(!1),u(S.id,"quest-completed",1);const st=((Fr=S.rankData)==null?void 0:Fr.currentRank)||S.rank||"F",zt=st==="F"||st==="E",Zt=st==="D",pa=I.difficulty==="rapida"?zt?3:Zt?6:10:I.difficulty==="padrao"?zt?8:Zt?12:20:zt?20:Zt?30:50;let Ut=Date.now()+pa*60*1e3;ce&&ce.reduceCooldownMinutes&&(Ut=Math.max(Date.now(),Ut-ce.reduceCooldownMinutes*60*1e3));const ga=new Date(Ut).toISOString();if(m(S.id,{questing:{...S.questing||{},cooldownEndsAt:ga,lastCompletedAt:new Date().toISOString()}}),ce&&ce.missionsRemaining){const Ft={...ce,missionsRemaining:Math.max(0,(ce.missionsRemaining||0)-1)};if(Ft.missionsRemaining<=0){const Pt={...S.stats||{}};delete Pt.helpStatus,m(S.id,{stats:Pt})}else{const Pt={...S.stats||{}};Pt.helpStatus=Ft,m(S.id,{stats:Pt})}}if(I.difficulty==="rapida"&&!V){const Ft=qe==="coleta"?"erva-sangue":"osso-antigo";d(S.id,Ft,1)}if(ot){const Ft=Z.getState().heroes.find(Pt=>Pt.id===ot.leaderId);if(Ft&&Ft.origin==="npc"){const Pt={...Ft.socialRelations||{}},xa=Se?3:-2;Pt[S.id]=Math.max(-100,Math.min(100,(Pt[S.id]||0)+xa)),Z.getState().updateHero(Ft.id,{socialRelations:Pt})}}ot&&ot.contractByHeroId&&ot.contractByHeroId[S.id]&&lt(ot.id,S.id)}nt(Math.min(Tr,ve),Rt,!Rs,Rs,zn.map(st=>({phase:st.phase,xp:st.xp||0,gold:st.gold||0,narrative:st.narrative||""})))};return x.useEffect(()=>{if(ae&&W&&!U){const Pe=setTimeout(()=>{we()},500);return()=>clearTimeout(Pe)}},[ae,W,U,L]),e.jsxs("div",{className:"mt-4 p-4 border rounded bg-gray-800 border-gray-700",children:[e.jsxs("div",{className:"text-white font-semibold",children:["ExecuÃ§Ã£o da MissÃ£o â€” ",Te]}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["Fases: ",ve," â€¢ Dificuldade: ",I.difficulty]}),!ae&&!U&&e.jsxs("div",{className:"mt-3",children:[e.jsx("button",{onClick:Xe,disabled:it,className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:"Iniciar"}),e.jsx("button",{onClick:()=>B(Pe=>!Pe),className:`ml-2 px-3 py-2 rounded ${W?"bg-teal-600":"bg-teal-700"} text-white hover:bg-teal-500`,children:W?"Auto: ON":"Auto: OFF"}),it&&e.jsxs("div",{className:"mt-2 text-sm text-amber-300",children:["Cooldown ativo: aguarde ",_(Oe),"."]}),me&&e.jsx("div",{className:"mt-2 text-sm text-red-300",children:me})]}),ae&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"text-gray-200",children:["Fase ",Math.min(ve,((K==null?void 0:K.length)||0)+1)," de ",ve]}),se!==null&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Integridade do NPC: ",se,"%"]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:we,className:"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700",children:"Prosseguir"}),e.jsx("button",{onClick:()=>B(Pe=>!Pe),className:`px-3 py-2 rounded ${W?"bg-teal-600":"bg-teal-700"} text-white hover:bg-teal-500`,children:W?"Auto: ON":"Auto: OFF"})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-400",children:["Multiplicador atual: x",ma(he).toFixed(2)]})]}),K.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-white font-semibold",children:"Registro"}),e.jsx("ul",{className:"mt-2 text-sm text-gray-300 list-disc pl-5",children:K.map(Pe=>e.jsxs("li",{children:["Fase ",Pe.phase,": ",Pe.narrative," â€¢ +",Pe.xp," XP, +",Pe.gold," ouro",Pe.itemsAwarded&&Pe.itemsAwarded.length?" â€¢ Loot":""]},Pe.phase))})]}),U&&e.jsx(Md,{heroId:S.id,questId:I.id,onConcluded:()=>{ne(!1),R(!0)}})]})},A=(S,I=!1,ae=!1)=>{var ne,U,R;return e.jsxs("div",{"data-testid":"quest-card",className:"bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-amber-500 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:re(S.type)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:S.title}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-medium ${G(S.difficulty)}`,children:J(S.difficulty)}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["NÃ­vel ",S.levelRequirement,"+"]}),S.isGuildQuest&&e.jsxs("span",{className:"px-2 py-1 rounded-md text-xs font-medium bg-purple-900/30 text-purple-300 border border-purple-600/30 flex items-center gap-1",children:["ğŸ° Guilda ",e.jsx("span",{className:"text-emerald-300",children:"ğŸ¾"})]}),(()=>{var L;try{const oe=(((L=S.rewards)==null?void 0:L.items)||[]).map(W=>typeof W=="string"?W:W.id),K=new Set(["racao-basica","racao-deluxe","pedra-alma","pedra-magica","essencia-vinculo","essencia-bestial","pergaminho-montaria","essencia-calor","brasas-magicas"]);return oe.some(W=>K.has(W))?e.jsx("span",{className:"px-2 py-1 rounded-md text-xs font-medium bg-emerald-900/30 text-emerald-300 border border-emerald-600/30 flex items-center gap-1",children:"ğŸ¾ Companheiros"}):null}catch{return null}})(),(()=>{var L;try{const oe=a();if(!oe)return null;const K=oe.inventory.items||{};let xe=0;if(String(S.id).startsWith("companion-")){const B=String(S.id).split("-")[1];xe=(K[B]||0)>0?100:0}else{const W=new Set(["racao-basica","racao-deluxe","pedra-alma","pedra-magica","essencia-vinculo","essencia-bestial","pergaminho-montaria","essencia-calor","brasas-magicas"]),B=(((L=S.rewards)==null?void 0:L.items)||[]).map(V=>typeof V=="string"?V:V.id).filter(V=>W.has(V)),se=B.length,z=B.filter(V=>(K[V]||0)>0).length;xe=se>0?Math.round(z/se*100):0}return e.jsxs("span",{className:"px-2 py-1 rounded-md text-xs font-medium bg-indigo-900/30 text-indigo-300 border border-indigo-600/30 flex items-center gap-1",children:["Progresso ",xe,"%"]})}catch{return null}})(),(()=>{const L=S.difficulty,oe=S.phasesHint??(L==="epica"?6:L==="padrao"?4:3),K=L==="epica"?"bg-purple-900/30 text-purple-300 border border-purple-600/30":L==="padrao"?"bg-amber-900/30 text-amber-300 border border-amber-600/30":"bg-green-900/30 text-green-300 border border-green-600/30",xe=S.phasesHint?"definido pela missÃ£o":L==="epica"?"dificuldade Ã©pica":L==="padrao"?"dificuldade padrÃ£o":"dificuldade rÃ¡pida";return e.jsxs("span",{className:`px-2 py-1 rounded-md text-xs font-medium ${K}`,title:`Estimativa de ${oe} fases (${xe}).`,children:["Fases previstas: ",oe]})})()]})]})]}),typeof S.timeLimit=="number"&&e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-red-400 text-sm",children:["â° ",S.timeLimit>=60?`${Math.round(S.timeLimit/60)} h`:`${S.timeLimit} min`]})})]}),e.jsx("p",{className:"text-gray-300 mb-4",children:S.description}),S.objectives&&S.objectives.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-amber-400 font-medium mb-2",children:"Objetivos:"}),e.jsx("ul",{className:"space-y-1",children:S.objectives.map((L,oe)=>e.jsxs("li",{className:"text-gray-300 text-sm flex items-center space-x-2",children:[e.jsx("span",{className:"text-amber-400",children:"â€¢"}),e.jsx("span",{children:L})]},oe))})]}),e.jsxs("div",{className:"border-t border-gray-700 pt-4",children:[e.jsx("h4",{className:"text-amber-400 font-medium mb-2",children:"Recompensas:"}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"ğŸª™"}),e.jsxs("span",{children:[((ne=S.rewards)==null?void 0:ne.gold)||0," ouro"]})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"â­"}),e.jsxs("span",{children:[((U=S.rewards)==null?void 0:U.xp)||0," XP"]})]}),((R=S.rewards)==null?void 0:R.items)&&S.rewards.items.length>0&&e.jsx("span",{className:"flex items-center space-x-2",children:S.rewards.items.map(({id:L,qty:oe},K)=>{const xe=Ee.find(se=>se.id===L),W=xe==null?void 0:xe.rarity,B=W==="lendario"?"text-amber-300":W==="epico"?"text-purple-300":W==="raro"?"text-blue-300":W==="incomum"?"text-green-300":"text-gray-300";return e.jsxs("span",{className:`flex items-center gap-1 ${B}`,children:[e.jsx("span",{children:(xe==null?void 0:xe.icon)||"ğŸ"}),e.jsxs("span",{children:[L," x",oe||1]})]},`${L}-${K}`)})})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[(()=>{const L=y.completedQuests.includes(S.id);return!I&&!ae&&!L?e.jsx("button",{onClick:()=>M(S),disabled:!P(S),className:`px-4 py-2 rounded-md font-medium transition-colors ${P(S)?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:P(S)?"Aceitar MissÃ£o":fe?`Aguarde recarga (${_(ee)})`:"Requisitos nÃ£o atendidos"}):L&&!I?e.jsx("span",{className:"px-4 py-2 bg-gray-700 rounded-md font-medium text-gray-300",children:"âœ… JÃ¡ concluÃ­da"}):null})(),I&&(S.type==="caca"||S.categoryHint==="escolta")&&e.jsx("span",{className:"px-2 py-1 rounded-md text-xs font-medium bg-green-900/30 text-green-300 border border-green-600/30",children:"ExecuÃ§Ã£o por fases"}),ae&&e.jsx("span",{className:"px-4 py-2 bg-gray-600 rounded-md font-medium text-gray-300",children:"âœ… ConcluÃ­da"})]})]})};return e.jsxs("div",{className:"container mx-auto p-6",children:[(()=>{var S;try{const I=((S=y.rankData)==null?void 0:S.currentRank)||"F",ae=localStorage.getItem("heroforge-onboarding"),ne=ae?JSON.parse(ae):{},U=Array.isArray(ne==null?void 0:ne.validatedSteps)?ne.validatedSteps:[],R=localStorage.getItem("hfn_training_basic_done")==="1",L=U.includes("create-hero")&&U.includes("accept-quest")&&R;if(I==="F"&&!L)return e.jsxs("div",{className:"mb-6 p-3 rounded-lg bg-amber-900/20 border border-amber-600/40 text-amber-200 text-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ”’ Quadro de MissÃµes bloqueado no Rank F."}),e.jsx("span",{className:"font-semibold",children:"Conclua o treinamento e aceite sua primeira missÃ£o."})]}),e.jsx("a",{href:"/training",className:"px-2 py-1 rounded bg-amber-600 hover:bg-amber-700 text-black text-xs",children:"Treinar"})]})}catch{}return null})(),fe&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-amber-900/20 border border-amber-600/40 text-amber-200 text-sm",children:["â±ï¸ Cooldown de missÃµes ativo: aguarde ",_(ee)," para aceitar ou iniciar uma nova missÃ£o."]}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-amber-400",children:["Quadro de MissÃµes ",j&&e.jsxs("span",{className:"ml-2 text-sm px-2 py-1 rounded bg-emerald-800/40 text-emerald-200 border border-emerald-600/40",children:["Companheiros (",s.filter(S=>S.isGuildQuest).length,")"]})]}),e.jsx("div",{className:"mt-1 text-sm text-gray-300",children:"Novas missÃµes a cada 1h â€¢ RÃ¡pidas (5â€“10 min) â€¢ Ã‰picas (25â€“40 min)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Q,disabled:te?Date.now()<te:!1,className:`px-3 py-2 rounded-md font-medium transition-colors ${te&&Date.now()<te?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-gray-600 text-white hover:bg-gray-500"}`,title:te&&Date.now()<te?`Aguarde ${Math.max(0,Math.ceil((te-Date.now())/6e4))} min`:"Atualizar lista de missÃµes",children:"Atualizar MissÃµes"}),e.jsxs("button",{onClick:()=>N(S=>{try{localStorage.setItem("questboard_companions_only",S?"0":"1")}catch{}return!S}),className:`px-3 py-2 rounded-md font-medium transition-colors ${j?"bg-emerald-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,title:"Mostrar apenas missÃµes de companheiros",children:["ğŸ¾ Companheiros ",j?"âœ“":""]}),y&&y.activeQuests.length>0&&e.jsx("button",{onClick:()=>{o(y.id),t(y.progression.level)},className:"px-3 py-2 rounded-md font-medium transition-colors bg-red-600 text-white hover:bg-red-700",title:"Remover todas as missÃµes ativas",children:"Abandonar Todas"})]})]}),(()=>{const S=s.find(I=>I.isGuildQuest&&I.sticky&&String(I.id).startsWith("companion-"));return S?e.jsxs("div",{className:"mb-6 p-3 rounded-lg bg-emerald-900/30 border border-emerald-600/30 text-emerald-200 text-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ¾ Nova MissÃ£o de Companheiros adicionada:"}),e.jsx("span",{className:"font-semibold",children:S.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:"#",className:"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-xs",onClick:I=>{I.preventDefault(),f("available")},children:"Ver"}),e.jsx("button",{className:"px-2 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-xs",onClick:()=>{M(S),f("active")},children:"Aceitar agora"})]})]}):null})(),e.jsxs("div",{className:"flex space-x-1 mb-6 bg-gray-800 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>f("available"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${b==="available"?"bg-amber-600 text-white":"text-gray-400 hover:text-white"}`,children:["DisponÃ­veis (",s.length,")"]}),e.jsxs("button",{onClick:()=>f("active"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${b==="active"?"bg-amber-600 text-white":"text-gray-400 hover:text-white"}`,children:["Ativas (",y.activeQuests.length,")"]}),e.jsxs("button",{onClick:()=>f("completed"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${b==="completed"?"bg-amber-600 text-white":"text-gray-400 hover:text-white"}`,children:["ConcluÃ­das (",y.completedQuests.length,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[b==="available"&&k.filter(S=>!y.activeQuests.includes(S.id)).filter(S=>!(y.completedQuests||[]).includes(S.id)).filter(S=>j?S.isGuildQuest:!0).map(S=>e.jsx(at.Fragment,{children:A(S)},`available-${S.id}`)),b==="active"&&E.map(S=>v(S)||k.find(I=>I.id===S)).filter(S=>!!S).map((S,I)=>e.jsxs("div",{children:[A(S,!0),y&&e.jsx(C,{hero:y,quest:S},`runner-${S.id}`),y&&!(S.type==="caca"||S.categoryHint==="escolta")&&e.jsx(Ed,{hero:y,quest:S},`auto-${S.id}`),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{onClick:()=>n(y.id,S.id),className:"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:"Abandonar"})})]},`active-${S.id}-${I}`)),b==="completed"&&h.map(S=>v(S)||k.find(I=>I.id===S)).filter(S=>!!S).map((S,I)=>e.jsx(at.Fragment,{children:A(S,!1,!0)},`completed-${S.id}-${I}`))]}),b==="available"&&s.length===0&&e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-400",children:"Nenhuma missÃ£o disponÃ­vel no momento."}),e.jsx("button",{onClick:()=>{console.log("ğŸ² Gerando novas missÃµes para herÃ³i:",y==null?void 0:y.name,"Level:",y==null?void 0:y.progression.level),t((y==null?void 0:y.progression.level)||1)},className:"mt-4 px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded-md font-medium transition-colors",children:"Gerar Novas MissÃµes"})]}),b==="active"&&y.activeQuests.length===0&&e.jsx("div",{className:"text-center p-8",children:e.jsx("p",{className:"text-gray-400",children:"VocÃª nÃ£o tem missÃµes ativas."})}),b==="completed"&&y.completedQuests.length===0&&e.jsx("div",{className:"text-center p-8",children:e.jsx("p",{className:"text-gray-400",children:"VocÃª ainda nÃ£o completou nenhuma missÃ£o."})})]})},Md=({heroId:a,questId:s,onConcluded:t})=>{const r=Z(d=>d.completeQuest),i=Z(d=>d.updateHero),n=Z(d=>d.heroes),[o,c]=at.useState(!1),l=async()=>{var d;if(!o){c(!0);try{r(a,s,!1);const m=n.find(u=>u.id===a);if(m){const u=Z.getState().getQuestById,p=u(s),g=((d=m.rankData)==null?void 0:d.currentRank)||m.rank||"F",v=g==="F"||g==="E",y=g==="D",w=p&&p.difficulty==="rapida"?v?3:y?6:10:p&&p.difficulty==="padrao"?v?8:y?12:20:v?20:y?30:50,k=new Date(Date.now()+w*60*1e3).toISOString();i(a,{questing:{...m.questing||{},cooldownEndsAt:k,lastCompletedAt:new Date().toISOString()}})}t==null||t()}finally{c(!1)}}};return e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-sm text-gray-200",children:"MissÃ£o finalizada."}),e.jsx("button",{onClick:l,disabled:o,className:`mt-2 px-3 py-2 rounded ${o?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:o?"Concluindo...":"Concluir Oficialmente"})]})},Ed=({hero:a,quest:s})=>{const t=Z(o=>o.completeQuest),r=Z(o=>o.updateHero),[i,n]=at.useState(!1);return at.useEffect(()=>{var o;if(!i)try{const c={...((o=a.stats)==null?void 0:o.missionRunState)||{}},l=String(s.id),d=c[l];if(d!=null&&d.finished||d!=null&&d.running)return;c[l]={phase:0,running:!0,finished:!1,logs:[]},r(a.id,{stats:{...a.stats,missionRunState:c}}),n(!0),setTimeout(()=>{var y;t(a.id,s.id,!1);const m=((y=a.rankData)==null?void 0:y.currentRank)||a.rank||"F",u=m==="F"||m==="E",p=m==="D",g=s.difficulty==="rapida"?u?3:p?6:10:s.difficulty==="padrao"?u?8:p?12:20:u?20:p?30:50,v=new Date(Date.now()+g*60*1e3).toISOString();r(a.id,{questing:{...a.questing||{},cooldownEndsAt:v,lastCompletedAt:new Date().toISOString()}})},100)}catch{}},[a.id,s.id,i]),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Finalizando missÃ£o..."})},Rd=()=>{var P;const{getSelectedHero:a,setActiveTitle:s,addTitleToSelectedHero:t,toggleFavoriteTitle:r}=Z(),i=a(),[n,o]=x.useState("all"),[c,l]=x.useState("all"),[d,m]=x.useState("");x.useState(!1);const[u,p]=x.useState(!1),[g,v]=x.useState(!1),[y,w]=x.useState("favoritesFirst"),[k,E]=x.useState(null),[h,b]=x.useState(null),f=x.useRef(null),[j,N]=x.useState(null),[T,F]=x.useState(null),te=x.useRef(((P=i==null?void 0:i.titles)==null?void 0:P.map(M=>M.id))||[]),D=ua();if(x.useEffect(()=>{try{const M=new URLSearchParams(D.search),C=M.get("q")||"",A=M.get("fav"),O=M.get("category"),S=M.get("rarity"),I=M.get("sort"),ae=M.get("new");C&&m(C),A&&p(A==="1"),ae&&v(ae==="1"),O&&o(O),S&&l(S),I&&w(I)}catch{}},[D.search]),!i)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-400 mb-4",children:"Selecione um HerÃ³i"}),e.jsx("p",{className:"text-gray-300",children:"VocÃª precisa selecionar um herÃ³i para gerenciar tÃ­tulos."})]});const $=an(i);let X=i.titles;if(n!=="all"&&(X=fc(X,n)),c!=="all"&&(X=za(X,c)),d&&(X=X.filter(M=>M.name.toLowerCase().includes(d.toLowerCase())||M.description.toLowerCase().includes(d.toLowerCase()))),u&&(X=X.filter(M=>M.favorite)),g){const M=Date.now()-864e5;X=X.filter(C=>new Date(C.unlockedAt).getTime()>=M)}const Q={comum:1,raro:2,epico:3,lendario:4,especial:5};X=[...X].sort((M,C)=>{switch(y){case"name":return M.name.localeCompare(C.name,"pt-BR");case"rarity":return Q[C.rarity]-Q[M.rarity]||M.name.localeCompare(C.name,"pt-BR");case"recent":return new Date(C.unlockedAt).getTime()-new Date(M.unlockedAt).getTime();case"favoritesFirst":default:return+!!C.favorite-+!!M.favorite||Q[C.rarity]-Q[M.rarity]||M.name.localeCompare(C.name,"pt-BR")}});const Y=()=>{let M=null,C=-1/0;if(i.titles.forEach(A=>{const O=ha(A.id),S=Object.values(O).reduce((ne,U)=>ne+(typeof U=="number"?U:0),0),I=Date.now()-new Date(A.unlockedAt).getTime()<24*60*60*1e3?1:0,ae=(Q[A.rarity]||0)*10+S*2+I;ae>C&&(C=ae,M=A.id)}),M){E(M),f.current&&window.clearTimeout(f.current);const A=i.titles.find(O=>O.id===M);b(A?`SugestÃ£o: ${A.name}`:"SugestÃ£o disponÃ­vel"),f.current=window.setTimeout(()=>b(null),2e3);try{je.featureUsed(i.id,"titles-suggest-best")}catch{}}},G=()=>{if(!k)return;s(k);const M=i.titles.find(C=>C.id===k);f.current&&window.clearTimeout(f.current),b(M?`Equipado: ${M.name}`:"SugestÃ£o equipada"),f.current=window.setTimeout(()=>b(null),2e3);try{je.featureUsed(i.id,"titles-equip-suggestion")}catch{}};at.useEffect(()=>{const M=i.titles.map(O=>O.id),C=te.current,A=M.filter(O=>!C.includes(O));if(A.length){const O=i.titles.find(S=>S.id===A[0]);O&&(f.current&&window.clearTimeout(f.current),b(`Novo tÃ­tulo desbloqueado: ${O.name}`),(O.rarity==="epico"||O.rarity==="lendario")&&(N("âœ¨"),F(O)),f.current=window.setTimeout(()=>{b(null),N(null),F(null)},2500))}te.current=M},[i.titles.length]);const J=M=>{s(M);const C=i.titles.find(O=>O.id===M),A=C?`TÃ­tulo equipado: ${C.name}`:"TÃ­tulo equipado";f.current&&window.clearTimeout(f.current),b(A),f.current=window.setTimeout(()=>b(null),2e3);try{je.featureUsed(i.id,"titles-equip")}catch{}},re=()=>{s(void 0),f.current&&window.clearTimeout(f.current),b("TÃ­tulo removido"),f.current=window.setTimeout(()=>b(null),2e3);try{je.featureUsed(i.id,"titles-remove")}catch{}},ee=M=>{switch(M){case"combat":return"âš”ï¸";case"exploration":return"ğŸ—ºï¸";case"social":return"ğŸ‘¥";case"achievement":return"ğŸ†";case"special":return"â­";default:return"ğŸ“œ"}},fe=M=>{switch(M){case"combat":return"Combate";case"exploration":return"ExploraÃ§Ã£o";case"social":return"Social";case"achievement":return"Conquistas";case"special":return"Especial";default:return"Outros"}},_=M=>{switch(M){case"comum":return"Comum";case"raro":return"Raro";case"epico":return"Ã‰pico";case"lendario":return"LendÃ¡rio";case"especial":return"Especial";default:return"Desconhecido"}};return e.jsxs("div",{className:"container mx-auto p-6",children:[h&&e.jsx("div",{className:"fixed right-6 top-6 z-50 bg-gray-900 border border-gray-700 text-white px-4 py-2 rounded-md shadow",children:h}),j&&T&&e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:e.jsxs("div",{className:"pointer-events-auto bg-gray-900/90 border border-amber-600 text-white px-6 py-4 rounded-xl shadow-xl",children:[e.jsx("div",{className:"text-5xl text-amber-400 text-center",children:j}),e.jsxs("div",{className:"mt-2 text-center text-xl",children:[e.jsx("span",{className:"mr-2 text-3xl",children:T.badge}),e.jsx("span",{children:T.name})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("button",{onClick:()=>{var A;const M=`${Qa(i)} â€” novo tÃ­tulo conquistado!`,C=`${window.location.origin}/hero/${i.id}`;if(navigator.share)navigator.share({title:"HeroForge",text:M,url:C}).catch(()=>{var O;try{(O=navigator.clipboard)==null||O.writeText(C)}catch{}});else{try{(A=navigator.clipboard)==null||A.writeText(C)}catch{}f.current&&window.clearTimeout(f.current),b("Link copiado para compartilhar"),f.current=window.setTimeout(()=>b(null),2e3)}try{je.featureUsed(i.id,"titles-share-celebration")}catch{}},className:"px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded-md font-medium",children:"Compartilhar"})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-amber-400",children:"Gerenciar TÃ­tulos"}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:Y,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-sm",title:"Sugerir melhor tÃ­tulo",children:"Sugerir Melhor"}),e.jsx("button",{onClick:G,disabled:!k,className:`px-3 py-2 rounded-md text-sm ${k?"bg-green-600 hover:bg-green-700":"bg-gray-700 cursor-not-allowed"}`,title:"Equipar sugestÃ£o",children:"Equipar SugestÃ£o"}),e.jsx("button",{onClick:()=>{var A;const M=i.titles.map(O=>({id:O.id,favorite:!!O.favorite})),C=JSON.stringify(M);try{(A=navigator.clipboard)==null||A.writeText(C)}catch{}f.current&&window.clearTimeout(f.current),b("TÃ­tulos (com favoritos) exportados"),f.current=window.setTimeout(()=>b(null),2e3);try{je.featureUsed(i.id,"titles-export-favorites")}catch{}},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-sm",title:"Exportar tÃ­tulos",children:"Exportar"}),e.jsx("button",{onClick:()=>{const M=window.prompt("Cole o JSON com IDs de tÃ­tulos");if(M)try{const C=JSON.parse(M);if(Array.isArray(C)){C.forEach(A=>{const O=typeof A=="string"?A:A==null?void 0:A.id,S=typeof A=="object"?!!(A!=null&&A.favorite):!1;if(!O)return;const I=It.find(ae=>ae.id===O);I&&(t({...I,unlockedAt:new Date},!1),S&&r(O,!0))}),f.current&&window.clearTimeout(f.current),b("TÃ­tulos importados"),f.current=window.setTimeout(()=>b(null),2e3);try{je.featureUsed(i.id,"titles-import-favorites")}catch{}}}catch{}},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-sm",title:"Importar tÃ­tulos",children:"Importar"})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"TÃ­tulo Ativo"}),$?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-4xl",children:$.badge}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-lg font-bold ${is($.rarity)}`,children:$.name}),e.jsx("p",{className:"text-gray-300 text-sm",children:$.description}),e.jsxs("p",{className:"text-amber-400 text-sm mt-1",children:["Como serÃ¡ exibido: ",Qa(i)]}),(()=>{var A;const M=(A=i.stats)==null?void 0:A.profileMedal;return(M!=null&&M.expiresAt?Date.now()<new Date(M.expiresAt).getTime():!1)?e.jsxs("div",{className:"mt-2 text-xs text-amber-300 flex items-center gap-2",children:[e.jsx("span",{children:"Medalha ativa:"}),e.jsxs("span",{className:"flex items-center gap-1",children:[M.icon," ",M.name]}),e.jsxs("span",{className:"text-gray-400",children:["expira ",new Date(M.expiresAt).toLocaleDateString()]})]}):null})(),(()=>{const M=ha($.id),C=Object.entries(M).filter(([,A])=>typeof A=="number"&&A!==0);return C.length?e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"BÃ´nus passivo:"})," ",C.map(([A,O],S)=>e.jsxs("span",{children:[A," +",O,S<C.length-1?", ":""]},A))]}):null})(),$&&k&&(()=>{const M=i.titles.find(I=>I.id===k);if(!M)return null;const C=ha($.id),A=ha(M.id),S=Array.from(new Set([...Object.keys(C),...Object.keys(A)])).map(I=>({k:I,av:Number(C[I]||0),bv:Number(A[I]||0),dv:Number(A[I]||0)-Number(C[I]||0)}));return e.jsxs("div",{className:"mt-3 text-xs",children:[e.jsx("div",{className:"font-semibold text-white mb-1",children:"ComparaÃ§Ã£o com SugestÃ£o"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-gray-300",children:[e.jsx("div",{className:"font-medium",children:"Atributo"}),e.jsx("div",{className:"font-medium",children:"Ativo"}),e.jsx("div",{className:"font-medium",children:"SugestÃ£o"}),S.map(I=>e.jsxs(at.Fragment,{children:[e.jsx("div",{children:I.k}),e.jsx("div",{className:"text-gray-200",children:I.av>=0?`+${I.av}`:`${I.av}`}),e.jsxs("div",{className:I.dv>0?"text-green-400":I.dv<0?"text-red-400":"text-gray-200",children:[I.bv>=0?`+${I.bv}`:`${I.bv}`," ",I.dv!==0&&e.jsxs("span",{className:"ml-1",children:["(",I.dv>0?"+":"",I.dv,")"]})]})]},I.k))]})]})})()]})]}),e.jsx("button",{onClick:re,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md font-medium transition-colors",children:"Remover TÃ­tulo"}),e.jsx("button",{onClick:()=>{var M;try{const C=Qa(i);(M=navigator.clipboard)==null||M.writeText(C),alert("ExibiÃ§Ã£o copiada para a Ã¡rea de transferÃªncia")}catch{alert("NÃ£o foi possÃ­vel copiar automaticamente. Copie manualmente: "+Qa(i))}},className:"ml-3 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md font-medium transition-colors",title:"Copiar exibiÃ§Ã£o",children:"Copiar ExibiÃ§Ã£o"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-400 mb-4",children:"Nenhum tÃ­tulo ativo"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione um tÃ­tulo abaixo para exibi-lo em seu perfil"})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Buscar TÃ­tulo"}),e.jsx("input",{type:"text",value:d,onChange:M=>m(M.target.value),placeholder:"Nome ou descriÃ§Ã£o...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Categoria"}),e.jsxs("select",{value:n,onChange:M=>o(M.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"all",children:"Todas as Categorias"}),e.jsx("option",{value:"combat",children:"âš”ï¸ Combate"}),e.jsx("option",{value:"exploration",children:"ğŸ—ºï¸ ExploraÃ§Ã£o"}),e.jsx("option",{value:"social",children:"ğŸ‘¥ Social"}),e.jsx("option",{value:"achievement",children:"ğŸ† Conquistas"}),e.jsx("option",{value:"special",children:"â­ Especial"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Raridade"}),e.jsxs("select",{value:c,onChange:M=>l(M.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"all",children:"Todas as Raridades"}),e.jsx("option",{value:"comum",children:"Comum"}),e.jsx("option",{value:"raro",children:"Raro"}),e.jsx("option",{value:"epico",children:"Ã‰pico"}),e.jsx("option",{value:"lendario",children:"LendÃ¡rio"}),e.jsx("option",{value:"especial",children:"Especial"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Ordenar por"}),e.jsxs("select",{value:y,onChange:M=>w(M.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"favoritesFirst",children:"Favoritos primeiro"}),e.jsx("option",{value:"rarity",children:"Raridade"}),e.jsx("option",{value:"recent",children:"Mais recentes"}),e.jsx("option",{value:"name",children:"Nome (Aâ€“Z)"})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center space-x-3",children:[e.jsx("input",{id:"favOnly",type:"checkbox",checked:u,onChange:M=>p(M.target.checked),className:"h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-600 rounded"}),e.jsx("label",{htmlFor:"favOnly",className:"text-sm text-gray-300",children:"Mostrar apenas favoritos"}),e.jsx("input",{id:"newOnly",type:"checkbox",checked:g,onChange:M=>v(M.target.checked),className:"ml-4 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-600 rounded"}),e.jsx("label",{htmlFor:"newOnly",className:"text-sm text-gray-300",children:"Apenas novos (24h)"}),e.jsx("button",{onClick:()=>{o("all"),l("all"),m(""),p(!1),v(!1),w("favoritesFirst")},className:"ml-4 px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-sm",title:"Limpar filtros",children:"Limpar filtros"})]})]}),i.titles.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Top 3 TÃ­tulos"}),e.jsx("button",{onClick:()=>{[...i.titles].map(C=>{const A=ha(C.id),O=Object.values(A).reduce((ae,ne)=>ae+(typeof ne=="number"?ne:0),0),S=Date.now()-new Date(C.unlockedAt).getTime()<24*60*60*1e3?1:0,I=(Q[C.rarity]||0)*10+O*2+S;return{id:C.id,score:I}}).sort((C,A)=>A.score-C.score).slice(0,3).forEach(C=>r(C.id,!0)),f.current&&window.clearTimeout(f.current),b("Favoritos atualizados com Top 3"),f.current=window.setTimeout(()=>b(null),2e3);try{je.featureUsed(i.id,"titles-favorite-top3")}catch{}},className:"px-3 py-2 bg-amber-600 hover:bg-amber-700 rounded-md text-sm",children:"Favoritar Top 3"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...i.titles].map(M=>{const C=ha(M.id),A=Object.values(C).reduce((I,ae)=>I+(typeof ae=="number"?ae:0),0),O=Date.now()-new Date(M.unlockedAt).getTime()<24*60*60*1e3?1:0,S=(Q[M.rarity]||0)*10+A*2+O;return{t:M,score:S}}).sort((M,C)=>C.score-M.score).slice(0,3).map(({t:M,score:C})=>e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-bold ${is(M.rarity)}`,children:M.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:["PontuaÃ§Ã£o: ",C]})]}),e.jsx("div",{className:"text-2xl",children:M.badge})]})},M.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:X.map(M=>e.jsxs("div",{className:`bg-gray-800 rounded-lg p-6 border transition-all hover:border-amber-500 ${($==null?void 0:$.id)===M.id?"border-amber-500 bg-amber-900/10 animate-pulse":"border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-3xl",children:M.badge}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-lg font-bold ${is(M.rarity)}`,children:M.name}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-medium ${is(M.rarity)} ${yc(M.rarity)}`,children:_(M.rarity)}),k===M.id&&e.jsx("span",{className:"px-2 py-1 rounded-md text-xs font-medium bg-green-900/20 text-green-400",children:"SugestÃ£o"}),Date.now()-new Date(M.unlockedAt).getTime()<24*60*60*1e3&&e.jsx("span",{className:"px-2 py-1 rounded-md text-xs font-medium bg-amber-900/20 text-amber-400",children:"Novo"}),e.jsxs("span",{className:"text-gray-400 text-xs flex items-center space-x-1",children:[e.jsx("span",{children:ee(M.category)}),e.jsx("span",{children:fe(M.category)})]}),(()=>{const C=ha(M.id),A=Object.entries(C).filter(([,O])=>typeof O=="number"&&O!==0).slice(0,3);return A.length?e.jsx("span",{className:"text-gray-300 text-xs",children:A.map(([O,S],I)=>e.jsxs("span",{className:"ml-1 px-1.5 py-0.5 bg-gray-700 rounded",children:[O," +",S]},O))}):null})()]})]})]}),e.jsx("button",{onClick:()=>r(M.id),className:`ml-2 px-2 py-1 rounded-md text-xs font-medium ${M.favorite?"bg-amber-600 hover:bg-amber-700 text-black":"bg-gray-700 hover:bg-gray-600 text-white"} transition-colors`,title:M.favorite?"Remover dos favoritos":"Adicionar aos favoritos",children:M.favorite?"â˜… Favorito":"â˜† Favoritar"})]}),e.jsx("p",{className:"text-gray-300 text-sm mb-4",children:M.description}),e.jsxs("div",{className:"text-xs text-gray-400 mb-4",children:["Desbloqueado em: ",new Date(M.unlockedAt).toLocaleDateString("pt-BR")]}),e.jsx("div",{className:"flex justify-end",children:($==null?void 0:$.id)===M.id?e.jsx("span",{className:"px-4 py-2 bg-amber-600 rounded-md font-medium text-sm",children:"âœ“ Ativo"}):e.jsx("button",{onClick:()=>J(M.id),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md font-medium text-sm transition-colors",children:"Equipar TÃ­tulo"})})]},M.id))}),X.length===0&&e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-400 mb-4",children:i.titles.length===0?"VocÃª ainda nÃ£o possui tÃ­tulos desbloqueados.":"Nenhum tÃ­tulo encontrado com os filtros aplicados."}),i.titles.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"Complete conquistas e missÃµes para desbloquear tÃ­tulos!"})]}),e.jsxs("div",{className:"mt-8 bg-gray-800 rounded-lg p-6 border border-gray-700",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"EstatÃ­sticas de TÃ­tulos"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:i.titles.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-400",children:za(i.titles,"comum").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Comuns"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:za(i.titles,"raro").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Raros"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:za(i.titles,"epico").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Ã‰picos"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:za(i.titles,"lendario").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"LendÃ¡rios"})]})]})]})]})},Pd=({heroId:a})=>{var v,y,w,k,E;const{heroes:s,generateDailyGoalsForHero:t,completeDailyGoal:r,cleanupExpiredGoals:i}=Z(),n=s.find(h=>h.id===a),o=x.useRef(new Set),{activeSeasonalTheme:c}=Qe();if(x.useEffect(()=>{if(!a||o.current.has(a))return;const h=s.find(N=>N.id===a);if(!h)return;const b=new Date,f=h.dailyGoals&&h.dailyGoals.length>0&&h.dailyGoals.some(N=>(typeof N.expiresAt=="string"?new Date(N.expiresAt):N.expiresAt)<=b),j=h.dailyGoals&&h.dailyGoals.length>0&&h.dailyGoals.some(N=>(typeof N.expiresAt=="string"?new Date(N.expiresAt):N.expiresAt)>b);o.current.add(a),f&&setTimeout(()=>i(a),0),j||setTimeout(()=>t(a),0)},[a]),x.useEffect(()=>{if(!a)return;const h=setInterval(()=>{const b=s.find(N=>N.id===a);if(!b)return;const f=new Date;b.dailyGoals&&b.dailyGoals.length>0&&b.dailyGoals.some(N=>(typeof N.expiresAt=="string"?new Date(N.expiresAt):N.expiresAt)>f)||(i(a),t(a))},6e4);return()=>clearInterval(h)},[a,s]),!n||!n.dailyGoals||n.dailyGoals.length===0)return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:"ğŸ¯ Metas DiÃ¡rias"}),e.jsxs("div",{className:"text-gray-400 text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"â³"}),e.jsx("p",{children:"Gerando suas metas diÃ¡rias..."})]})]});const l=h=>{h.completed&&r(a,h.id)},d=h=>{const b=new Date,j=(typeof h=="string"?new Date(h):h).getTime()-b.getTime();if(j<=0)return"Expirado";const N=Math.floor(j/(1e3*60*60)),T=Math.floor(j%(1e3*60*60)/(1e3*60));return N>0?`${N}h ${T}m`:`${T}m`},m=n.dailyGoals.filter(h=>h.completed),u=n.dailyGoals.filter(h=>h.completed&&!h.claimed),p=n.dailyGoals.length,g=p>0?m.length/p*100:0;return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:"ğŸ¯ Metas DiÃ¡rias"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Progresso: ",m.length,"/",p]}),e.jsx("div",{className:"w-24 bg-gray-700 rounded-full h-2 mt-1",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})}),e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"px-2 py-1 rounded-full bg-gray-700 text-orange-300 border border-orange-500/40",children:["ğŸ”¥ Streak: ",((v=n.stats)==null?void 0:v.dailyCompletionStreak)||0]}),e.jsxs("button",{onClick:()=>{i(a),t(a)},className:`px-2 py-1 rounded bg-gradient-to-r ${yt(c)} text-white border border-white/10 hover:brightness-110 flex items-center gap-2`,children:[((w=(y=Ke[c||""])==null?void 0:y.accents)==null?void 0:w[0])||"",e.jsx("span",{children:"â™»ï¸ Atualizar Metas"})]}),u.length>0&&e.jsxs("button",{onClick:()=>u.forEach(h=>r(a,h.id)),className:`px-2 py-1 rounded bg-gradient-to-r ${yt(c)} text-white border border-white/10 hover:brightness-110 flex items-center gap-2`,children:[((E=(k=Ke[c||""])==null?void 0:k.accents)==null?void 0:E[0])||"",e.jsx("span",{children:"ğŸ Coletar Tudo"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:n.dailyGoals.map(h=>{var F,te;const b=tn(h),f=gc(h.id),j=xc(h.id),N=h.progress/h.maxProgress*100,T=d(h.expiresAt);return e.jsx("div",{className:`bg-gray-700 rounded-lg p-4 border-l-4 transition-all duration-300 ${h.completed?"border-green-500 bg-green-900/20":"border-gray-600 hover:border-blue-500"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:f}),e.jsx("h4",{className:`font-semibold ${j}`,children:h.description}),h.completed&&!h.claimed&&e.jsx("span",{className:"text-green-400 text-sm",children:"âœ“ Completa"}),h.claimed&&e.jsx("span",{className:"text-blue-300 text-sm",children:"ğŸ Coletado"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-400 mb-1",children:[e.jsxs("span",{children:["Progresso: ",h.progress,"/",h.maxProgress]}),e.jsxs("span",{children:["Expira em: ",T]})]}),e.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${h.completed?"bg-green-500":"bg-gradient-to-r from-blue-500 to-purple-500"}`,style:{width:`${Math.min(N,100)}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-yellow-400",children:[e.jsx("span",{children:"â­"}),e.jsxs("span",{children:[b.xp," XP"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-yellow-500",children:[e.jsx("span",{children:"ğŸ’°"}),e.jsxs("span",{children:[b.gold," Ouro"]})]}),typeof b.glory=="number"&&b.glory>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-300",children:[e.jsx("span",{children:"ğŸ†"}),e.jsxs("span",{children:[b.glory," GlÃ³ria"]})]}),typeof b.arcaneEssence=="number"&&b.arcaneEssence>0&&e.jsxs("div",{className:"flex items-center gap-1 text-purple-300",children:[e.jsx("span",{children:"âœ¨"}),e.jsxs("span",{children:[b.arcaneEssence," EssÃªncia Arcana"]})]}),b.items&&b.items.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-purple-400",children:[e.jsx("span",{children:"ğŸ"}),e.jsxs("span",{children:[b.items.length," Item(s)"]})]})]})]}),h.completed&&!h.claimed&&e.jsxs("button",{onClick:()=>l(h),className:`ml-4 bg-gradient-to-r ${yt(c)} text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center gap-2 hover:brightness-110`,children:[e.jsx("span",{children:((te=(F=Ke[c||""])==null?void 0:F.accents)==null?void 0:te[0])||"ğŸ"}),e.jsx("span",{children:"Coletar"})]})]})},h.id)})}),m.length===p&&p>0&&e.jsxs("div",{className:"mt-6 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ğŸ†"}),e.jsx("h4",{className:"text-white font-bold mb-1",children:"ParabÃ©ns!"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"VocÃª completou todas as metas diÃ¡rias! Volte amanhÃ£ para novas metas."})]}),e.jsxs("div",{className:"mt-6 bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-white font-semibold mb-2 flex items-center gap-2",children:"ğŸ’¡ Dicas"}),e.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[e.jsx("li",{children:"â€¢ Complete missÃµes para progredir em vÃ¡rias metas"}),e.jsx("li",{children:"â€¢ Metas mais difÃ­ceis oferecem recompensas maiores"}),e.jsx("li",{children:'â€¢ A meta "Dia Perfeito" oferece bÃ´nus especiais'}),e.jsx("li",{children:"â€¢ Novas metas sÃ£o geradas a cada dia"})]})]})]})},Id=()=>{const{selectedHeroId:a,gainXP:s,gainGold:t,addTitle:r}=Z(),[i,n]=x.useState([]),[o,c]=x.useState([]),[l,d]=x.useState({hours:0,minutes:0});x.useEffect(()=>{m();const h=setInterval(m,6e4);return()=>clearInterval(h)},[a]);const m=()=>{const h=ia.getActiveEvents();if(n(h),a){const f=ia.getEventProgress(a);c(f)}const b=ia.getTimeUntilNextRotation();d(b)},u=h=>o.find(b=>b.eventId===h),p=h=>{const b=u(h.id);return b?Math.min(b.progress/h.targetValue*100,100):0},g=async h=>{if(!a)return;const b=ia.claimEventRewards(a,h.id);if(b){for(const f of b)switch(f.type){case"xp":f.amount&&s(a,f.amount);break;case"gold":f.amount&&t(a,f.amount);break;case"title":f.titleId&&r(a,f.titleId);break}m()}},v=h=>{switch(h){case"common":return"border-gray-300 bg-gray-50";case"rare":return"border-blue-300 bg-blue-50";case"epic":return"border-purple-300 bg-purple-50";case"legendary":return"border-yellow-300 bg-yellow-50";default:return"border-gray-300 bg-gray-50"}},y=h=>h.map(b=>{switch(b.type){case"xp":return`${b.amount} XP`;case"gold":return`${b.amount} ğŸª™`;case"title":return`TÃ­tulo: ${b.titleId}`;case"item":return b.itemName||"Item";default:return""}}).join(", "),w=i.filter(h=>h.type==="daily"),k=i.filter(h=>h.type==="weekly"),E=i.filter(h=>h.type==="special");return a?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"ğŸª Eventos Especiais"}),e.jsx("p",{className:"text-gray-600",children:"Participe de eventos limitados e ganhe recompensas exclusivas!"}),e.jsx("div",{className:"mt-4 inline-flex items-center px-4 py-2 bg-blue-100 rounded-lg",children:e.jsxs("span",{className:"text-sm text-blue-800",children:["â° PrÃ³xima rotaÃ§Ã£o em: ",l.hours,"h ",l.minutes,"m"]})})]}),w.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4 flex items-center",children:["â˜€ï¸ Eventos DiÃ¡rios",e.jsx("span",{className:"ml-2 text-sm bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:w.length})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(h=>{const b=u(h.id),f=p(h),j=(b==null?void 0:b.completed)||!1,N=j&&!(b!=null&&b.rewardsClaimed);return e.jsxs("div",{className:`border-2 rounded-lg p-6 ${v(h.rarity)} transition-all duration-200 hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:h.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:h.name}),e.jsx("p",{className:"text-sm text-gray-600",children:h.description})]})]}),j&&e.jsx("span",{className:"text-green-500 text-xl",children:"âœ…"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:h.objective}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`bg-gradient-to-r ${h.color} h-2 rounded-full transition-all duration-300`,style:{width:`${f}%`}})}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[(b==null?void 0:b.progress)||0," / ",h.targetValue]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Recompensas:"}),e.jsx("p",{className:"text-sm text-gray-600",children:y(h.rewards)})]}),N&&e.jsx("button",{onClick:()=>g(h),className:"w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-2 px-4 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 font-medium",children:"ğŸ Resgatar Recompensas"}),(b==null?void 0:b.rewardsClaimed)&&e.jsx("div",{className:"w-full bg-gray-100 text-gray-500 py-2 px-4 rounded-lg text-center text-sm",children:"âœ… Recompensas Resgatadas"})]},h.id)})})]}),k.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4 flex items-center",children:["ğŸ“… Eventos Semanais",e.jsx("span",{className:"ml-2 text-sm bg-purple-100 text-purple-800 px-2 py-1 rounded-full",children:k.length})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:k.map(h=>{const b=u(h.id),f=p(h),j=(b==null?void 0:b.completed)||!1,N=j&&!(b!=null&&b.rewardsClaimed);return e.jsxs("div",{className:`border-2 rounded-lg p-6 ${v(h.rarity)} transition-all duration-200 hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-4xl mr-4",children:h.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:h.name}),e.jsx("p",{className:"text-sm text-gray-600",children:h.description})]})]}),j&&e.jsx("span",{className:"text-green-500 text-2xl",children:"âœ…"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 mb-3",children:h.objective}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`bg-gradient-to-r ${h.color} h-3 rounded-full transition-all duration-300`,style:{width:`${f}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[(b==null?void 0:b.progress)||0," / ",h.targetValue]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Recompensas Ã‰picas:"}),e.jsx("p",{className:"text-gray-600",children:y(h.rewards)})]}),N&&e.jsx("button",{onClick:()=>g(h),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200 font-medium text-lg",children:"ğŸ‘‘ Resgatar Recompensas Ã‰picas"}),(b==null?void 0:b.rewardsClaimed)&&e.jsx("div",{className:"w-full bg-gray-100 text-gray-500 py-3 px-4 rounded-lg text-center",children:"âœ… Recompensas Ã‰picas Resgatadas"})]},h.id)})})]}),E.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4 flex items-center",children:["â­ Eventos Especiais",e.jsx("span",{className:"ml-2 text-sm bg-red-100 text-red-800 px-2 py-1 rounded-full",children:E.length})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:E.map(h=>{const b=u(h.id),f=p(h),j=(b==null?void 0:b.completed)||!1,N=j&&!(b!=null&&b.rewardsClaimed);return e.jsxs("div",{className:`border-2 rounded-lg p-6 ${v(h.rarity)} transition-all duration-200 hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-4xl mr-4",children:h.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:h.name}),e.jsx("p",{className:"text-sm text-gray-600",children:h.description})]})]}),j&&e.jsx("span",{className:"text-green-500 text-2xl",children:"âœ…"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 mb-3",children:h.objective}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`bg-gradient-to-r ${h.color} h-3 rounded-full transition-all duration-300`,style:{width:`${f}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[(b==null?void 0:b.progress)||0," / ",h.targetValue]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Recompensas LendÃ¡rias:"}),e.jsx("p",{className:"text-gray-600",children:y(h.rewards)})]}),N&&e.jsx("button",{onClick:()=>g(h),className:"w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-3 px-4 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 font-medium text-lg",children:"ğŸ† Resgatar Recompensas LendÃ¡rias"}),(b==null?void 0:b.rewardsClaimed)&&e.jsx("div",{className:"w-full bg-gray-100 text-gray-500 py-3 px-4 rounded-lg text-center",children:"âœ… Recompensas LendÃ¡rias Resgatadas"})]},h.id)})})]}),i.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸª"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum Evento Ativo"}),e.jsx("p",{className:"text-gray-600",children:"Novos eventos serÃ£o gerados em breve. Volte mais tarde!"})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸª"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Eventos Especiais"}),e.jsx("p",{className:"text-gray-600",children:"Selecione um herÃ³i para ver os eventos disponÃ­veis"})]})})},Td=({heroId:a,showFilters:s=!0,maxItems:t=20,compact:r=!1})=>{const[i,n]=x.useState([]),[o,c]=x.useState({}),[l,d]=x.useState({}),[m,u]=x.useState({}),{currentHero:p}=Z();x.useEffect(()=>{g()},[a,o,t]);const g=()=>{let j;a?j=vt.getHeroActivities(a,t):j=vt.getActivityFeed(o).activities.slice(0,t),n(j)},v=j=>{vt.likeActivity(j)&&g()},y=j=>{var T;const N=(T=m[j])==null?void 0:T.trim();!N||!p||vt.addComment(j,p.id,p.name,N)&&(u(F=>({...F,[j]:""})),g())},w=async j=>{const N=vt.shareActivity(j);if(N){if(navigator.share)try{await navigator.share({title:"HeroForge - Conquista Ã‰pica",text:N.shareText,url:N.shareUrl})}catch{k(N.shareUrl)}else k(N.shareUrl);g()}},k=j=>{navigator.clipboard.writeText(j).then(()=>{console.log("Link copiado para a Ã¡rea de transferÃªncia!")})},E=j=>{d(N=>({...N,[j]:!N[j]}))},h=j=>{const T=new Date().getTime()-j.getTime(),F=Math.floor(T/6e4),te=Math.floor(T/36e5),D=Math.floor(T/864e5);return F<1?"agora mesmo":F<60?`${F}m atrÃ¡s`:te<24?`${te}h atrÃ¡s`:D<7?`${D}d atrÃ¡s`:j.toLocaleDateString("pt-BR")},b=()=>e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tipo de Atividade"}),e.jsxs("select",{className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",onChange:j=>{const N=j.target.value?[j.target.value]:void 0;c(T=>({...T,types:N}))},children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"quest-completed",children:"MissÃµes Completadas"}),e.jsx("option",{value:"epic-quest-completed",children:"MissÃµes Ã‰picas"}),e.jsx("option",{value:"level-up",children:"Subida de NÃ­vel"}),e.jsx("option",{value:"achievement-unlocked",children:"Conquistas"}),e.jsx("option",{value:"title-earned",children:"TÃ­tulos"}),e.jsx("option",{value:"event-completed",children:"Eventos"}),e.jsx("option",{value:"daily-goal-completed",children:"Metas DiÃ¡rias"}),e.jsx("option",{value:"combat-victory",children:"VitÃ³rias em Combate"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"PerÃ­odo"}),e.jsxs("select",{className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",onChange:j=>{const N=j.target.value;let T;if(N==="today"){const F=new Date;F.setHours(0,0,0,0);const te=new Date(F);te.setDate(te.getDate()+1),T={start:F,end:te}}else if(N==="week"){const F=new Date;F.setDate(F.getDate()-7),T={start:F,end:new Date}}else if(N==="month"){const F=new Date;F.setDate(F.getDate()-30),T={start:F,end:new Date}}c(F=>({...F,dateRange:T}))},children:[e.jsx("option",{value:"",children:"Todo o perÃ­odo"}),e.jsx("option",{value:"today",children:"Hoje"}),e.jsx("option",{value:"week",children:"Ãšltima semana"}),e.jsx("option",{value:"month",children:"Ãšltimo mÃªs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Visibilidade"}),e.jsxs("select",{className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",onChange:j=>{const N=j.target.value==="public"?!0:void 0;c(T=>({...T,showOnlyPublic:N}))},children:[e.jsx("option",{value:"",children:"Todas as atividades"}),e.jsx("option",{value:"public",children:"Apenas pÃºblicas"})]})]})]})]}),f=({activity:j})=>e.jsx("div",{className:`bg-gradient-to-r ${j.color} p-0.5 rounded-lg mb-4`,children:e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:"text-2xl",children:j.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:j.message}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:h(j.timestamp)}),!r&&j.data.questReward&&e.jsxs("div",{className:"mt-2 text-sm text-gray-300",children:[e.jsxs("span",{className:"text-yellow-400",children:["+",j.data.questReward.xp," XP"]}),j.data.questReward.gold>0&&e.jsxs("span",{className:"ml-2 text-yellow-500",children:["+",j.data.questReward.gold," ouro"]})]})]})]})}),!r&&e.jsx("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-700",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>v(j.id),className:"flex items-center space-x-1 text-gray-400 hover:text-red-400 transition-colors",children:[e.jsx("span",{children:"â¤ï¸"}),e.jsx("span",{className:"text-sm",children:j.likes})]}),e.jsxs("button",{onClick:()=>E(j.id),className:"flex items-center space-x-1 text-gray-400 hover:text-blue-400 transition-colors",children:[e.jsx("span",{children:"ğŸ’¬"}),e.jsx("span",{className:"text-sm",children:j.comments.length})]}),e.jsxs("button",{onClick:()=>w(j.id),className:"flex items-center space-x-1 text-gray-400 hover:text-green-400 transition-colors",children:[e.jsx("span",{children:"ğŸ”—"}),e.jsx("span",{className:"text-sm",children:j.shares})]})]})}),!r&&l[j.id]&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-700",children:[j.comments.map(N=>e.jsx("div",{className:"mb-3 last:mb-0",children:e.jsx("div",{className:"flex items-start space-x-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:N.authorName}),e.jsx("span",{className:"text-xs text-gray-400",children:h(N.timestamp)})]}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:N.content})]})})},N.id)),p&&e.jsxs("div",{className:"mt-3 flex space-x-2",children:[e.jsx("input",{type:"text",placeholder:"Adicionar comentÃ¡rio...",value:m[j.id]||"",onChange:N=>u(T=>({...T,[j.id]:N.target.value})),className:"flex-1 bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm",onKeyPress:N=>{N.key==="Enter"&&y(j.id)}}),e.jsx("button",{onClick:()=>y(j.id),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Enviar"})]})]})]})});return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[!r&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:a?"Atividades do HerÃ³i":"Feed de Atividades"}),e.jsx("p",{className:"text-gray-400",children:"Acompanhe as conquistas e aventuras Ã©picas!"})]}),s&&!r&&e.jsx(b,{}),e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ®"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Nenhuma atividade encontrada"}),e.jsx("p",{className:"text-gray-400",children:a?"Este herÃ³i ainda nÃ£o possui atividades registradas.":"Comece sua jornada Ã©pica para ver atividades aqui!"})]}):i.map(j=>e.jsx(f,{activity:j},j.id))}),i.length>=t&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>g(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors",children:"Carregar mais atividades"})})]})};let Hs=null,Ci=0;function Dn(){return Hs||(Hs=new(window.AudioContext||window.webkitAudioContext)),Hs}function Oa(a,s=30){const t=Dn();let r=0;a.forEach(i=>{const n=t.createOscillator(),o=t.createGain();n.type=i.t||"sine",n.frequency.value=i.f,o.gain.value=i.v??.12,n.connect(o),o.connect(t.destination);const c=t.currentTime+r/1e3,l=c+i.d/1e3;n.start(c),o.gain.setValueAtTime(o.gain.value,c),o.gain.exponentialRampToValueAtTime(1e-4,l),n.stop(l),r+=i.d+s})}function La(a=80){const s=Date.now();return s-Ci<a?!1:(Ci=s,!0)}function ja(){La()&&Oa([{f:740,d:90},{f:880,d:90},{f:988,d:120}])}function wa(){La()&&Oa([{f:220,d:140,t:"sawtooth",v:.08},{f:180,d:140,t:"sawtooth",v:.08},{f:140,d:160,t:"sawtooth",v:.08}])}function $n(){La()&&Oa([{f:660,d:100,t:"triangle",v:.12},{f:880,d:140,t:"triangle",v:.12},{f:990,d:120,t:"triangle",v:.12},{f:1320,d:180,t:"sine",v:.12}])}function ea(){const a=Dn();a.state==="suspended"&&a.resume().catch(()=>{})}function Dd(){La(200)&&Oa([{f:420,d:40,t:"square",v:.1},{f:360,d:30,t:"square",v:.09},{f:520,d:50,t:"triangle",v:.11}],12)}function $d(){La(250)&&Oa([{f:1200,d:60,t:"sine",v:.08},{f:1350,d:60,t:"sine",v:.08},{f:1500,d:80,t:"sine",v:.08}],20)}function _d(){La(120)&&Oa([{f:680,d:60,t:"sine",v:.06}])}const qd=({isVisible:a,newRank:s,onComplete:t})=>{const[r,i]=x.useState(!1),[n,o]=x.useState(!1);return x.useEffect(()=>{if(a){const c=setTimeout(()=>i(!0),500),l=setTimeout(()=>o(!0),1e3),d=setTimeout(()=>t(),3e3);return()=>{clearTimeout(c),clearTimeout(l),clearTimeout(d)}}},[a,t]),e.jsx(oa,{children:a&&e.jsxs(tt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80",children:[e.jsx(tt.div,{initial:{scale:0},animate:{scale:1},transition:{duration:.8,ease:"easeOut"},className:"absolute inset-0 bg-gradient-radial from-yellow-400/20 via-transparent to-transparent"}),e.jsx(oa,{children:r&&e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(20)].map((c,l)=>e.jsx(tt.div,{initial:{opacity:0,y:100,x:Math.random()*(typeof window<"u"?window.innerWidth:1e3),scale:0},animate:{opacity:[0,1,0],y:-100,scale:[0,1,0],rotate:360},transition:{duration:2,delay:l*.1,ease:"easeOut"},className:"absolute w-2 h-2 bg-yellow-400 rounded-full"},l))})}),e.jsxs(tt.div,{initial:{scale:0,rotateY:180},animate:{scale:1,rotateY:0},transition:{duration:1,ease:"easeOut"},className:"relative z-10 text-center",children:[e.jsx(tt.h1,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.8},className:"text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 mb-8",children:"PROMOÃ‡ÃƒO!"}),e.jsx(oa,{children:n&&e.jsxs(tt.div,{initial:{scale:0,rotateZ:-180},animate:{scale:1,rotateZ:0},transition:{duration:.8,ease:"easeOut"},className:`inline-flex items-center px-8 py-4 rounded-full bg-gradient-to-r ${Ss(s)} text-white text-2xl font-bold shadow-2xl`,children:[e.jsx(tt.span,{animate:{rotate:[0,10,-10,0]},transition:{duration:.5,repeat:2},className:"text-4xl mr-4",children:Ms(s)}),e.jsxs("span",{children:["Rank ",s]})]})}),e.jsx(tt.p,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:1.5,duration:.8},className:"text-xl text-gray-300 mt-8",children:"ParabÃ©ns pela sua ascensÃ£o heroica!"}),e.jsx(tt.div,{animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:`absolute inset-0 -z-10 rounded-full bg-gradient-to-r ${Ss(s)} blur-3xl`})]}),e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(8)].map((c,l)=>e.jsx(tt.div,{initial:{scaleY:0,opacity:0},animate:{scaleY:1,opacity:[0,.8,0]},transition:{duration:1.5,delay:.5+l*.1,ease:"easeOut"},className:"absolute top-0 bottom-0 w-1 bg-gradient-to-b from-yellow-400 to-transparent",style:{left:`${50+Math.cos(l*Math.PI/4)*30}%`,transform:`rotate(${l*45}deg)`,transformOrigin:"center"}},l))})]})})},Fd=({progress:a,isAnimating:s,color:t="from-blue-400 to-blue-600"})=>e.jsxs("div",{className:"relative w-full h-4 bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:`h-full bg-gradient-to-r ${t} relative transition-all duration-300 ease-out`,style:{width:`${a}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-20"})}),s&&e.jsx("div",{className:"absolute inset-0",children:[...Array(3)].map((r,i)=>e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-50",style:{left:`${a/100*(20+i*20)}%`,top:`${4+i*2}px`}},i))})]}),Bd=at.memo(({rank:a,isFloating:s=!0})=>a?e.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-full bg-gradient-to-r ${Ss(a)} text-white font-bold ${et.effects.shadows.glow}`,children:[e.jsx("span",{className:"text-xl mr-2",children:Ms(a)}),e.jsx("span",{children:a})]}):null),Da=({rank:a,size:s="medium",isFloating:t=!0,className:r=""})=>e.jsx("div",{className:r,children:e.jsx(Bd,{rank:a,isFloating:t})}),ki=({progress:a,color:s,isAnimating:t=!1})=>e.jsx(Fd,{progress:a,isAnimating:t,color:s}),Od=({heroId:a,className:s=""})=>{var Q,Y,G,J,re,ee,fe,_;const{heroes:t,getHeroRankProgress:r,getRankLeaderboard:i,promoteHero:n,updateHero:o,getSelectedHero:c}=Z(),{activeSeasonalTheme:l}=Qe(),d=l&&((Q=Ke[l])==null?void 0:Q.border)||"border-amber-700/30",[m,u]=x.useState("overview"),[p,g]=x.useState(""),[v,y]=x.useState("all"),[w,k]=x.useState(a??((Y=c())==null?void 0:Y.id)??((G=t[0])==null?void 0:G.id)??null);x.useEffect(()=>{a&&k(a)},[a]),x.useEffect(()=>{var P;!w&&t.length>0&&k(((P=c())==null?void 0:P.id)??t[0].id)},[t,w]);const E=(w?t.find(P=>P.id===w):void 0)||c()||t[0];x.useEffect(()=>{if(E&&!E.rankData){const P=We.initializeRankData(E);o(E.id,{rankData:P})}},[E]);const h=E?r(E.id):null,b=i(),f=x.useMemo(()=>{var P;return(P=E==null?void 0:E.rankData)!=null&&P.rankHistory?v==="all"?E.rankData.rankHistory:E.rankData.rankHistory.filter(M=>M.rank===v):[]},[(J=E==null?void 0:E.rankData)==null?void 0:J.rankHistory,v]),j=x.useMemo(()=>{if(!E||!p)return null;const P=t.find(M=>M.id===p);return P?{current:E,compare:P,currentProgress:r(E.id),compareProgress:r(P.id)}:null},[E,p,t]);if(!E||!h)return e.jsx("div",{className:`bg-gray-900 border border-gray-700 rounded-lg p-6 ${s}`,children:e.jsxs("div",{className:"text-center text-slate-400",children:[e.jsx(Wa,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum herÃ³i selecionado para anÃ¡lise de evoluÃ§Ã£o"})]})});const N=()=>{h.progress.canPromote&&n(E.id)&&(ea(),$n())},T=()=>{var P;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`bg-gradient-to-r from-amber-900/20 to-yellow-900/20 rounded-lg p-6 border ${d}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-amber-100",children:E.name}),e.jsxs("p",{className:"text-amber-300",children:[E.class," â€¢ ",E.race]})]}),e.jsx(Da,{rank:h.progress.currentRank,size:"large"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-xs text-amber-300",children:"Selecionar herÃ³i:"}),e.jsx("select",{value:w??"",onChange:M=>k(M.target.value),className:"bg-slate-800 text-amber-100 text-sm px-2 py-1 rounded border border-amber-700/40",children:t.map(M=>e.jsx("option",{value:M.id,children:M.name},M.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-100",children:E.progression.level}),e.jsx("div",{className:"text-sm text-amber-300",children:"NÃ­vel"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-100",children:(E.progression.xp||0).toLocaleString()}),e.jsx("div",{className:"text-sm text-amber-300",children:"XP Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-100",children:E.stats.questsCompleted}),e.jsx("div",{className:"text-sm text-amber-300",children:"MissÃµes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-100",children:h.rankData.totalRankPoints}),e.jsx("div",{className:"text-sm text-amber-300",children:"Pontos de Rank"})]})]})]}),e.jsx(ki,{progress:h.progress,estimate:h.estimate,onPromote:N,variant:"detailed"}),((P=h.rankData)==null?void 0:P.rankHistory)&&h.rankData.rankHistory.length>0&&e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-100 mb-4 flex items-center",children:[e.jsx(oo,{className:"w-5 h-5 mr-2 text-amber-400"}),"Conquistas Recentes"]}),e.jsx("div",{className:"space-y-2",children:h.rankData.rankHistory.slice(-3).slice().reverse().map((M,C)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-600 rounded",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Da,{rank:M.rank,size:"small"}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"text-slate-100 font-medium",children:["Promovido para Rank ",M.rank]}),e.jsx("div",{className:"text-slate-400 text-sm",children:new Date(M.achievedAt).toLocaleDateString("pt-BR")})]})]}),M.notableAchievement&&e.jsx("div",{className:"text-purple-300 text-sm",children:M.notableAchievement})]},C))})]})]})},F=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(ki,{progress:h.progress,estimate:h.estimate,onPromote:N,variant:"detailed"}),e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-100 mb-4 flex items-center",children:[e.jsx(hs,{className:"w-5 h-5 mr-2 text-blue-400"}),"AnÃ¡lise Detalhada de Progresso"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-300",children:"ExperiÃªncia"}),e.jsxs("span",{className:"text-slate-400",children:[(h.progress.currentXP||0).toLocaleString()," / ",(h.progress.requiredXP||0).toLocaleString()]})]}),e.jsx("div",{className:"w-full bg-slate-600 rounded-full h-2 overflow-hidden",children:(()=>{const P=Math.max(0,Math.min(100,(h.progress.currentXP||0)/Math.max(1,h.progress.requiredXP||0)*100));return e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-500",style:{width:`${P}%`}})})()}),e.jsx("div",{className:"text-xs text-slate-400",children:h.progress.nextRank?`Faltam ${((h.progress.requiredXP||0)-(h.progress.currentXP||0)).toLocaleString()} XP`:"Rank mÃ¡ximo atingido!"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-300",children:"MissÃµes"}),e.jsxs("span",{className:"text-slate-400",children:[h.progress.currentMissions||0," / ",h.progress.requiredMissions||0]})]}),e.jsx("div",{className:"w-full bg-slate-600 rounded-full h-2 overflow-hidden",children:(()=>{const P=Math.max(0,Math.min(100,(h.progress.currentMissions||0)/Math.max(1,h.progress.requiredMissions||0)*100));return e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${P}%`}})})()}),e.jsx("div",{className:"text-xs text-slate-400",children:h.progress.nextRank?`Faltam ${(h.progress.requiredMissions||0)-(h.progress.currentMissions||0)} missÃµes`:"Todas as missÃµes concluÃ­das!"})]})]}),h.estimate&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(co,{className:"w-4 h-4 mr-2 text-amber-400"}),e.jsx("span",{className:"text-slate-200 font-medium",children:"Estimativa para PrÃ³ximo Rank"})]}),e.jsxs("div",{className:"text-slate-300",children:[h.estimate.estimatedDays," dias (",h.estimate.estimatedHours," horas de jogo)"]}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Baseado no seu ritmo atual de progresso"})]})]})]}),te=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-100 flex items-center",children:[e.jsx(Gr,{className:"w-5 h-5 mr-2 text-purple-400"}),"HistÃ³rico de Ranks"]}),e.jsxs("select",{value:v,onChange:P=>y(P.target.value),className:"bg-slate-700 border border-slate-600 rounded px-3 py-1 text-slate-200",children:[e.jsx("option",{value:"all",children:"Todos os Ranks"}),e.jsx("option",{value:"S",children:"Rank S"}),e.jsx("option",{value:"A",children:"Rank A"}),e.jsx("option",{value:"B",children:"Rank B"}),e.jsx("option",{value:"C",children:"Rank C"}),e.jsx("option",{value:"D",children:"Rank D"}),e.jsx("option",{value:"E",children:"Rank E"}),e.jsx("option",{value:"F",children:"Rank F"})]})]}),e.jsx("div",{className:"space-y-4",children:f.length===0?e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(Wa,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum histÃ³rico encontrado para o filtro selecionado"})]}):[...f].reverse().map((P,M)=>e.jsxs("div",{className:"flex items-center p-4 bg-slate-700 rounded-lg",children:[e.jsx(Da,{rank:P.rank,size:"medium"}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-slate-100 font-medium",children:["Promovido para Rank ",P.rank]}),e.jsx("div",{className:"text-slate-400 text-sm",children:new Date(P.achievedAt).toLocaleDateString("pt-BR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"text-right",children:P.notableAchievement&&e.jsx("div",{className:"text-purple-300 text-sm",children:P.notableAchievement})})]}),P.specialAchievement&&e.jsxs("div",{className:"mt-2 text-sm text-purple-300",children:["ğŸ† ",P.specialAchievement]})]})]},M))})]}),D=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-100 flex items-center",children:[e.jsx(zr,{className:"w-5 h-5 mr-2 text-green-400"}),"Ranking Global"]}),e.jsx("div",{className:"space-y-3",children:b.map((P,M)=>e.jsxs("div",{className:`flex items-center p-4 rounded-lg ${P.heroId===E.id?"bg-gradient-to-r from-amber-900/30 to-yellow-900/30 border border-amber-700/50":"bg-gray-900 border border-gray-700"}`,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-slate-600 text-slate-200 font-bold mr-4",children:P.position}),e.jsx(Da,{rank:P.rank,size:"small"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("div",{className:"text-slate-100 font-medium",children:P.heroName}),e.jsx("div",{className:"text-slate-400 text-sm",children:P.heroClass})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-amber-400 font-bold",children:P.rankPoints}),e.jsx("div",{className:"text-slate-400 text-sm",children:"pontos"})]}),P.heroId===E.id&&e.jsx(Cs,{className:"w-5 h-5 ml-2 text-amber-400"})]},P.heroId))})]}),$=()=>{var P,M,C,A;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-100 flex items-center",children:[e.jsx(Ts,{className:"w-5 h-5 mr-2 text-cyan-400"}),"ComparaÃ§Ã£o de HerÃ³is"]}),e.jsxs("select",{value:p,onChange:O=>g(O.target.value),className:"bg-slate-700 border border-slate-600 rounded px-3 py-1 text-slate-200",children:[e.jsx("option",{value:"",children:"Selecione um herÃ³i para comparar"}),t.filter(O=>O.id!==E.id).map(O=>e.jsxs("option",{value:O.id,children:[O.name," (",O.class,")"]},O.id))]})]}),j?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h5",{className:"text-lg font-semibold text-slate-100",children:j.current.name}),e.jsx("p",{className:"text-slate-400",children:j.current.class}),e.jsx("div",{className:"mt-2",children:e.jsx(Da,{rank:((P=j.currentProgress)==null?void 0:P.progress.currentRank)||"F",size:"large"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"NÃ­vel"}),e.jsx("span",{className:"text-slate-100",children:j.current.level})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"XP Total"}),e.jsx("span",{className:"text-slate-100",children:(j.current.progression.xp||0).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"MissÃµes"}),e.jsx("span",{className:"text-slate-100",children:j.current.stats.questsCompleted})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"Pontos de Rank"}),e.jsx("span",{className:"text-slate-100",children:((M=j.currentProgress)==null?void 0:M.rankData.totalRankPoints)||0})]})]})]}),e.jsxs("div",{className:"bg-slate-700 rounded-lg p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h5",{className:"text-lg font-semibold text-slate-100",children:j.compare.name}),e.jsx("p",{className:"text-slate-400",children:j.compare.class}),e.jsx(Da,{rank:((C=j.compareProgress)==null?void 0:C.progress.currentRank)||"F",size:"large",className:"mt-2"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"NÃ­vel"}),e.jsx("span",{className:"text-slate-100",children:j.compare.level})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"XP Total"}),e.jsx("span",{className:"text-slate-100",children:(j.compare.progression.xp||0).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"MissÃµes"}),e.jsx("span",{className:"text-slate-100",children:j.compare.stats.questsCompleted})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-300",children:"Pontos de Rank"}),e.jsx("span",{className:"text-slate-100",children:((A=j.compareProgress)==null?void 0:A.rankData.totalRankPoints)||0})]})]})]})]}):e.jsxs("div",{className:"text-center text-slate-400 py-8",children:[e.jsx(Ts,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Selecione um herÃ³i para comparar"})]})]})},X=[{id:"overview",label:"VisÃ£o Geral",icon:lo},{id:"progress",label:"Progresso",icon:hs},{id:"history",label:"HistÃ³rico",icon:Gr},{id:"leaderboard",label:"Ranking",icon:zr},{id:"comparison",label:"ComparaÃ§Ã£o",icon:Ts}];return e.jsxs("div",{className:`bg-slate-800 rounded-lg ${s}`,children:[e.jsxs("div",{className:"p-6 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-100 flex items-center font-serif tracking-wide",children:[e.jsx(Wa,{className:"w-6 h-6 mr-2 text-amber-400"}),"Painel de EvoluÃ§Ã£o"]}),(()=>{const P=Ke[l||""],M=(P==null?void 0:P.accents)||[];return M.length?e.jsxs("div",{className:"text-xl opacity-80",children:[M[0],M[1],M[2]]}):null})()]}),(((ee=(re=h.rankData)==null?void 0:re.pendingCelebrations)==null?void 0:ee.length)||0)>0&&e.jsxs("div",{className:"bg-amber-500 text-amber-900 px-3 py-1 rounded-full text-sm font-medium",children:[((_=(fe=h.rankData)==null?void 0:fe.pendingCelebrations)==null?void 0:_.length)||0," nova(s) conquista(s)!"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 sm:space-x-1 bg-slate-700 rounded-lg p-1 overflow-x-auto",children:X.map(({id:P,label:M,icon:C})=>e.jsxs("button",{onClick:()=>u(P),className:`flex items-center px-2 sm:px-3 py-2 rounded-md text-xs sm:text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ${m===P?"bg-slate-600 text-slate-100":"text-slate-400 hover:text-slate-200 hover:bg-slate-600/50"}`,children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),M]},P))})]}),e.jsxs("div",{className:"p-6",children:[m==="overview"&&T(),m==="progress"&&F(),m==="history"&&te(),m==="leaderboard"&&D(),m==="comparison"&&$()]})]})},Ld=({celebration:a,onClose:s,onViewRewards:t,className:r=""})=>{const[i,n]=x.useState(!0),[o,c]=x.useState(!1),[l,d]=x.useState("intro");Wt(),x.useEffect(()=>{const p=setTimeout(()=>n(!0),100),g=setTimeout(()=>d("celebrate"),800),v=setTimeout(()=>d("rewards"),2e3);return()=>{clearTimeout(p),clearTimeout(g),clearTimeout(v)}},[]);const m=()=>{n(!1),setTimeout(s,300)};return(p=>{switch(p){case"S":return us;case"SS":return us;case"SSS":return us;case"A":return Wa;case"B":return Cs;case"C":return uo;case"D":return mo;default:return Wa}})(a.newRank),e.jsxs(e.Fragment,{children:[e.jsx(qd,{isVisible:i&&!o,newRank:a.newRank,onComplete:()=>c(!0)}),e.jsx(oa,{children:i&&o&&e.jsx(tt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80",onClick:m,children:e.jsx(tt.div,{initial:{scale:0,y:50},animate:{scale:1,y:0},exit:{scale:0,y:50},transition:{duration:.5,ease:"easeOut"},className:"bg-gradient-to-br from-purple-900 to-blue-900 p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 text-center border border-purple-500",onClick:p=>p.stopPropagation(),children:e.jsxs("div",{className:"relative z-10",children:[e.jsx(tt.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:.5,repeat:2},className:"text-4xl mb-4",children:"ğŸ"}),e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4",children:"Recompensas de Rank!"}),a.rewards&&a.rewards.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"space-y-2",children:a.rewards.map((p,g)=>e.jsxs(tt.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:g*.1},className:"flex items-center justify-center bg-purple-800 bg-opacity-50 rounded-lg p-3",children:[e.jsx("span",{className:"text-yellow-400 mr-3 text-lg",children:p.icon}),e.jsxs("div",{className:"text-white",children:[e.jsx("span",{className:"font-semibold",children:p.name}),e.jsx("span",{className:"block text-sm text-purple-200",children:p.description})]})]},g))})}),e.jsx(tt.button,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:m,className:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-yellow-600 hover:to-orange-600 transition-all duration-200 shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Continuar Jornada"})]})})})})]})},Hd=({celebrations:a,onCelebrationViewed:s,onViewRewards:t})=>{const[r,i]=x.useState(0);if(a.length===0)return null;const n=()=>{s(r),r<a.length-1&&i(r+1)},o=a[r];return e.jsx(Ld,{celebration:o,onClose:n,onViewRewards:t?()=>t(o):void 0})},Ai={medieval:"border-amber-500/40 bg-gradient-to-br from-slate-800 to-slate-900 shadow-amber-500/20",futurista:"border-cyan-400/40 bg-gradient-to-br from-slate-900 to-black shadow-cyan-400/20",noir:"border-gray-500/40 bg-gradient-to-br from-black to-slate-900 shadow-black/40"},_n=({children:a})=>{var n;const{activeFrameId:s,activeSeasonalTheme:t}=Qe(),r=Ai[s||"medieval"]||Ai.medieval,i=t?((n=Ke[t])==null?void 0:n.accents)||[]:[];return e.jsxs("div",{className:`rounded-xl p-4 border ${r} relative`,children:[i.length>0&&e.jsxs("div",{className:"absolute -top-2 -right-2 text-sm opacity-80",children:[e.jsx("span",{className:"mr-1",children:i[0]}),e.jsx("span",{className:"mr-1",children:i[1]}),e.jsx("span",{children:i[2]})]}),a]})},Gd=({open:a,onClose:s,previewFrameId:t})=>{const{setActiveFrame:r}=Qe();return a?e.jsxs("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:s}),e.jsxs("div",{className:"relative z-10 w-[92vw] max-w-2xl rounded-2xl border border-white/20 bg-slate-900 shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-200",children:"PrÃ©-visualizaÃ§Ã£o de Moldura"}),e.jsx("button",{onClick:s,className:"text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600",children:"Fechar"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{children:e.jsxs(_n,{children:[e.jsx("div",{className:"text-white font-semibold mb-1",children:"Exemplo de DiÃ¡logo"}),e.jsx("div",{className:"text-gray-300",children:"Uma mensagem aparece com a moldura selecionada para vocÃª avaliar o estilo antes da compra."}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Visual: ",t||"medieval"]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(t),className:"px-3 py-2 text-xs rounded bg-amber-600 hover:bg-amber-700 text-white",children:"Aplicar"}),e.jsx("button",{onClick:s,className:"px-3 py-2 text-xs rounded bg-gray-700 hover:bg-gray-600",children:"Cancelar"})]})]})]})]}):null},zd=()=>{var Q,Y,G,J,re,ee,fe,_,P,M;const{getSelectedHero:a,updateHero:s}=Z(),t=a(),{ownedFrames:r,activeFrameId:i,setActiveFrame:n,markPurchase:o,ownedThemes:c,activeThemeId:l,setActiveTheme:d}=Qe(),[m,u]=x.useState(!1),[p,g]=x.useState(void 0),[v,y]=x.useState("consumables"),[w,k]=x.useState(!1),[E,h]=x.useState(!1),[b,f]=x.useState(""),[j,N]=x.useState("");if(x.useEffect(()=>{je.pageVisited((t==null?void 0:t.id)||"system","/shop"),je.featureUsed((t==null?void 0:t.id)||"system","shop-open")},[]),!t)return e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸª"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-2",children:"Loja do Aventureiro"}),e.jsx("p",{className:"text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base",children:"Selecione um herÃ³i para acessar a loja."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-4 sm:px-6 py-2 rounded hover:bg-blue-700 transition-colors text-sm sm:text-base",children:"Voltar Ã  Lista de HerÃ³is"})]});const T=C=>{try{je.featureUsed(t.id,"shop-buy-click")}catch{}const A=bs(t,C);if(A.success&&A.item){try{je.itemAcquired(t.id,{itemId:C})}catch{}const O=A.currency||"gold",S={...t.progression};A.newBalance!==void 0?O==="gold"?S.gold=A.newBalance:O==="glory"?S.glory=A.newBalance:O==="arcaneEssence"&&(S.arcaneEssence=A.newBalance):A.newGold!==void 0&&(S.gold=A.newGold),s(t.id,{progression:S,inventory:{...t.inventory,items:{...t.inventory.items,[C]:(t.inventory.items[C]||0)+1}}}),alert(A.message)}else{try{je.featureUsed(t.id,"shop-buy-denied")}catch{}alert(A.message)}},F=(C,A)=>{const O=yr(t,C),S=Fa(C,t),I=S<C.price,ae=Gi[C.rarity];return e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 shadow-sm hover:shadow-md transition-shadow",style:{borderColor:ae.color},children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"text-3xl mb-2",children:C.icon||"ğŸ“¦"}),e.jsx("h3",{className:"font-bold text-gray-800",style:{color:ae.color},children:C.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:C.description})]}),C.bonus&&e.jsx("div",{className:"text-xs text-center mb-3 space-y-1",children:Object.entries(C.bonus).map(([ne,U])=>e.jsxs("div",{className:"text-green-600",children:["+",U," ",ne.charAt(0).toUpperCase()+ne.slice(1)]},ne))}),C.effects&&e.jsxs("div",{className:"text-xs text-center mb-3 space-y-1",children:[C.effects.hp&&e.jsxs("div",{className:"text-red-600",children:["+",C.effects.hp," HP"]}),C.effects.mp&&e.jsxs("div",{className:"text-blue-600",children:["+",C.effects.mp," MP"]}),C.effects.duration&&e.jsxs("div",{className:"text-purple-600",children:["DuraÃ§Ã£o: ",C.effects.duration,"min"]})]}),e.jsx("div",{className:"text-center mb-3",children:(()=>{const ne=C.currency||"gold",U=ne==="gold"?"ouro":ne==="glory"?"glÃ³ria":"essÃªncia arcana";return I?e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:[C.price," ",U]}),e.jsxs("span",{className:"text-lg font-bold text-green-600 ml-2",children:[S," ",U]})]}):e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:[C.price," ",U]})})()}),e.jsx("button",{onClick:()=>T(C.id),disabled:!O,className:`w-full py-2 px-4 rounded font-medium transition-colors ${O?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:(()=>{if(O)return"Comprar";const ne=C.currency||"gold";return`${ne==="gold"?"Ouro":ne==="glory"?"GlÃ³ria":"EssÃªncia Arcana"} Insuficiente`})()})]},`${C.id}-${A??0}`)},te=Bo(),D=C=>{const A=Z.getState().refineEquippedItem(t.id,C);alert(A?"Refino realizado! (chance aplicada)":"Falha: requisitos nÃ£o atendidos ou item indisponÃ­vel.")},$=()=>{if(!b||!j){alert("Selecione dois itens para fundir.");return}const C=Z.getState().fuseItems(t.id,b,j);alert(C?"FusÃ£o concluÃ­da! Novo item adicionado ao inventÃ¡rio.":"Falha na fusÃ£o (verifique tipos e quantidades).")},X=C=>{const A=Z.getState().enchantEquippedItem(t.id,C,"lifesteal");alert(A?"Encantamento aplicado: Lifesteal!":"EssÃªncia insuficiente ou item nÃ£o equipado.")};return e.jsxs("div",{className:"max-w-full lg:max-w-7xl mx-auto p-4 sm:p-6",children:[(()=>{var A;const C=((A=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:A.border)||"border-amber-500/30";return e.jsxs("div",{className:`text-center mb-6 sm:mb-8 ${et.layout.containers.panel} p-6 border ${C}`,children:[e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold text-white mb-2",children:"ğŸª Loja do Aventureiro"}),e.jsx("p",{className:"text-slate-300 text-sm sm:text-base",children:"Equipamentos, consumÃ­veis e itens especiais para sua jornada"}),e.jsxs("div",{className:"mt-3 sm:mt-4 flex flex-wrap justify-center gap-2",children:[e.jsx("div",{className:"bg-amber-900/20 border border-amber-500/40 rounded-lg p-2 sm:p-3 inline-block",children:e.jsxs("span",{className:"text-amber-300 font-medium text-sm sm:text-base",children:["ğŸ’° Ouro: ",t.progression.gold||0]})}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-500/40 rounded-lg p-2 sm:p-3 inline-block",children:e.jsxs("span",{className:"text-blue-300 font-medium text-sm sm:text-base",children:["ğŸ† GlÃ³ria: ",t.progression.glory||0]})}),e.jsx("div",{className:"bg-purple-900/20 border border-purple-500/40 rounded-lg p-2 sm:p-3 inline-block",children:e.jsxs("span",{className:"text-purple-300 font-medium text-sm sm:text-base",children:["âœ¨ EssÃªncia Arcana: ",t.progression.arcaneEssence||0]})})]}),e.jsx("div",{className:"mt-3 sm:mt-4",children:e.jsx("a",{href:"#cosmetics",className:"inline-block px-3 sm:px-4 py-2 bg-gradient-to-r from-rose-600 to-amber-600 text-white rounded-lg hover:brightness-110 transition-colors text-sm sm:text-base",children:"ğŸ’– Apoie o projeto (CosmÃ©ticos)"})})]})})(),e.jsxs("div",{className:"flex flex-wrap justify-center gap-2 mb-4 sm:mb-6",children:[e.jsx("button",{onClick:()=>{k(!1),h(!1),je.featureUsed(t.id,"shop-tab-catalog")},className:`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${!w&&!E?Me.tabActive:Me.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:"CatÃ¡logo Geral"}),e.jsx("button",{onClick:()=>{k(!0),h(!1),je.featureUsed(t.id,"shop-tab-daily")},className:`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${w?Me.tabActive:Me.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:"â­ Ofertas DiÃ¡rias"}),e.jsx("button",{onClick:()=>{k(!1),h(!0),je.featureUsed(t.id,"shop-tab-forge")},className:`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${E?Me.tabActive:Me.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:"âš’ï¸ Forja e Encantamentos"})]}),e.jsx("div",{className:"max-w-full sm:max-w-4xl mx-auto mb-6",children:e.jsxs("div",{className:`rounded-lg border bg-gray-800 p-3 sm:p-4 ${et.effects.shadows.small}`,children:[e.jsx("div",{className:"text-sm sm:text-base text-gray-200",children:"O jogo core Ã© gratuito e justo. Compras sÃ£o 100% opcionais e apenas cosmÃ©ticas ou narrativas."}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:e.jsxs("button",{onClick:async()=>{try{const{startCheckout:C,verifyPurchase:A}=await wt(()=>Promise.resolve().then(()=>Ja),void 0),O=await C("remove-ads");O.ok&&(await A(O.sessionId||"")).ok&&(je.purchaseInitiated(t.id,"remove-ads"),o("remove-ads",{id:O.sessionId||`rcpt-${Date.now()}`}),Qe.getState().removeAdsForever(),je.purchaseCompleted(t.id,"remove-ads",O.sessionId||void 0),alert("AnÃºncios removidos. Obrigado pelo apoio!"))}catch{je.purchaseInitiated(t.id,"remove-ads"),o("remove-ads",{id:`rcpt-${Date.now()}`}),Qe.getState().removeAdsForever(),je.purchaseCompleted(t.id,"remove-ads"),alert("AnÃºncios removidos. Obrigado pelo apoio!")}},className:`px-3 sm:px-4 py-2 rounded bg-gradient-to-r ${((Q=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:Q.buttonGradient)||"from-rose-600 to-amber-600"} text-white text-sm sm:text-base hover:brightness-110 flex items-center gap-2`,children:[((G=(Y=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:Y.accents)==null?void 0:G[0])||"",e.jsx("span",{children:"Remover anÃºncios (IAP Ãºnico)"})]})})]})}),e.jsx("div",{className:"max-w-full sm:max-w-4xl mx-auto mb-6",children:e.jsxs("div",{className:"rounded-lg border bg-gray-800 p-3 sm:p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm sm:text-base text-gray-200 flex items-center gap-2",children:[e.jsx("span",{children:((re=(J=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:J.accents)==null?void 0:re[0])||"ğŸ­"}),e.jsx("span",{children:"Ofertas sazonais disponÃ­veis conforme o tema atual."})]}),e.jsx($e,{to:"/premium",onClick:()=>{je.featureUsed(t.id,"shop-premium-banner-click")},className:`px-3 py-2 rounded bg-gradient-to-r ${((ee=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:ee.buttonGradient)||"from-amber-600 to-yellow-600"} text-white text-sm hover:brightness-110`,children:"Ver Ofertas"})]})}),w?e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-center mb-4 sm:mb-6 text-amber-400",children:"â­ Ofertas Especiais do Dia (20% OFF)"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:te.map(F)})]}):E?e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-center mb-4 sm:mb-6 text-white",children:"âš’ï¸ Forja e Encantamentos"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-3",children:"Refinar Raridade"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:["weapon","armor","accessory"].map(C=>{var U,R;const A=(()=>C==="weapon"?t.inventory.equippedMainHand||t.inventory.equippedOffHand||t.inventory.equippedWeapon||(t.inventory.equippedWeapons||[])[0]:C==="armor"?t.inventory.equippedChest||t.inventory.equippedArmor||(t.inventory.equippedArmorSlots||[])[0]:t.inventory.equippedNecklace||t.inventory.equippedRingLeft||t.inventory.equippedRingRight||t.inventory.equippedAccessory||(t.inventory.equippedAccessories||[])[0])(),O=A?$t.weapons.items.concat($t.armor.items,$t.accessories.items).find(L=>L.id===A)||((U=t.inventory.customItems)==null?void 0:U[A]):void 0,S=A?((R=t.inventory.refined)==null?void 0:R[A])||(O==null?void 0:O.rarity):void 0,I=C==="weapon"?"Arma":C==="armor"?"Armadura":"AcessÃ³rio",ne=S?{comum:{gold:100,essence:10,nextLabel:"Incomum"},incomum:{gold:200,essence:20,nextLabel:"Raro"},raro:{gold:400,essence:40,nextLabel:"Ã‰pico"},epico:{gold:1e3,essence:100,nextLabel:"LendÃ¡rio"}}[S]:void 0;return e.jsxs("div",{className:"p-4 rounded-lg border bg-gray-800 text-gray-200",children:[e.jsx("div",{className:"font-semibold",children:I}),e.jsx("div",{className:"text-sm text-gray-600",children:A?(O==null?void 0:O.name)||"Item Personalizado":"Nenhum equipado"}),e.jsxs("div",{className:"text-sm mt-1",children:["Raridade: ",S||"-"]}),e.jsx("button",{onClick:()=>D(C),disabled:!A||!ne,className:`mt-3 w-full py-2 px-4 rounded ${A&&ne?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:ne?`Refinar â†’ ${ne.nextLabel} (ğŸ’° ${ne.gold}, âœ¨ ${ne.essence})`:"NÃ£o disponÃ­vel"})]},C)})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-3",children:"Fundir Itens"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Consome 2 itens do mesmo tipo para criar um novo item Ãºnico."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Item A"}),e.jsxs("select",{value:b,onChange:C=>f(C.target.value),className:"w-full border rounded p-2",children:[e.jsx("option",{value:"",children:"Selecione"}),Object.entries(t.inventory.items).map(([C,A])=>({id:C,qty:A,item:$t.weapons.items.concat($t.armor.items,$t.accessories.items).find(O=>O.id===C)})).filter(C=>C.item&&C.qty>0).map(C=>e.jsxs("option",{value:C.id,children:[C.item.name," (x",C.qty,")"]},C.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Item B"}),e.jsxs("select",{value:j,onChange:C=>N(C.target.value),className:"w-full border rounded p-2",children:[e.jsx("option",{value:"",children:"Selecione"}),Object.entries(t.inventory.items).map(([C,A])=>({id:C,qty:A,item:$t.weapons.items.concat($t.armor.items,$t.accessories.items).find(O=>O.id===C)})).filter(C=>C.item&&C.qty>0).map(C=>e.jsxs("option",{value:C.id,children:[C.item.name," (x",C.qty,")"]},C.id))]})]})]}),e.jsxs("button",{onClick:$,className:`mt-3 px-4 py-2 bg-gradient-to-r ${((fe=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:fe.buttonGradient)||"from-green-600 to-emerald-600"} text-white rounded hover:brightness-110 flex items-center gap-2`,children:[((P=(_=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:_.accents)==null?void 0:P[0])||"",e.jsx("span",{children:"Fundir"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-3",children:"Encantar Item"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Aplica efeito especial (lifesteal) ao item equipado. Custo: âœ¨ 50 EssÃªncia."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:["weapon","armor","accessory"].map(C=>{var I,ae,ne,U,R,L;const A=(()=>C==="weapon"?t.inventory.equippedMainHand||t.inventory.equippedOffHand||t.inventory.equippedWeapon||(t.inventory.equippedWeapons||[])[0]:C==="armor"?t.inventory.equippedChest||t.inventory.equippedArmor||(t.inventory.equippedArmorSlots||[])[0]:t.inventory.equippedNecklace||t.inventory.equippedRingLeft||t.inventory.equippedRingRight||t.inventory.equippedAccessory||(t.inventory.equippedAccessories||[])[0])(),O=C==="weapon"?"Arma":C==="armor"?"Armadura":"AcessÃ³rio",S=A?(ae=(I=t.inventory.enchantments)==null?void 0:I[A])==null?void 0:ae.special:void 0;return e.jsxs("div",{className:"p-4 rounded-lg border bg-gray-800 text-gray-200",children:[e.jsx("div",{className:"font-semibold",children:O}),e.jsx("div",{className:"text-sm text-gray-600",children:A?((ne=$t.weapons.items.concat($t.armor.items,$t.accessories.items).find(oe=>oe.id===A))==null?void 0:ne.name)||"Item Personalizado":"Nenhum equipado"}),e.jsxs("div",{className:"text-sm mt-1",children:["Encanto: ",S||"-"]}),e.jsxs("button",{onClick:()=>X(C),disabled:!A,className:`mt-3 w-full py-2 px-4 rounded ${A?`bg-gradient-to-r ${((U=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:U.buttonGradient)||"from-purple-600 to-violet-600"} text-white hover:brightness-110 flex items-center gap-2`:"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[A&&((L=(R=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:R.accents)==null?void 0:L[0])||"",e.jsx("span",{children:"Encantar (Lifesteal)"})]})]},C)})})]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-4 sm:mb-6",children:Object.entries($t).map(([C,A])=>e.jsxs("button",{onClick:()=>y(C),className:`px-3 sm:px-4 py-2 rounded font-medium transition-colors text-sm sm:text-base ${v===C?Me.tabActive:Me.tabInactive} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:[A.icon," ",A.name]},C))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:$t[v].items.map(F)}),e.jsxs("div",{id:"cosmetics",className:"mt-8 sm:mt-12",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-white",children:"ğŸ¨ CosmÃ©ticos (visual) e Premium"}),e.jsx("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:"Personalize molduras e fundos do herÃ³i. Itens premium sÃ£o opcionais e nÃ£o afetam o balanceamento narrativo."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6",children:[{id:"frame-gold",name:"Moldura Dourada",icon:"ğŸŸ¨",req:"500 XP",unlocked:(t.progression.xp||0)>=500},{id:"frame-royal",name:"Moldura Real",icon:"ğŸ‘‘",req:"Rank B+",unlocked:(((M=t.rankData)==null?void 0:M.currentRank)||"F")<="B"},{id:"bg-aurora",name:"Fundo Aurora",icon:"ğŸŒŒ",req:"ReputaÃ§Ã£o 10+",unlocked:(t.progression.reputation||0)>=10},{id:"frame-futurista",name:"Moldura Futurista (Premium)",icon:"ğŸ§ª",req:"Produto Premium",unlocked:r.includes("futurista")},{id:"frame-noir",name:"Moldura Noir (Premium)",icon:"ğŸ•¶ï¸",req:"Produto Premium",unlocked:r.includes("noir")},{id:"theme-futurista",name:"Tema Futurista (Premium)",icon:"ğŸŒŒ",req:"Tema Premium",unlocked:c.includes("futurista")},{id:"theme-noir",name:"Tema Noir (Premium)",icon:"ğŸ–¤",req:"Tema Premium",unlocked:c.includes("noir")},{id:"season-natal",name:"Tema Sazonal: Festival de Inverno",icon:"ğŸŒ¿",req:"Sazonal",unlocked:!0},{id:"season-pascoa",name:"Tema Sazonal: Renascimento RÃºnico",icon:"ğŸ¥š",req:"Sazonal",unlocked:!0},{id:"season-ano-novo",name:"Tema Sazonal: Profecias do Ano Novo",icon:"ğŸ†",req:"Sazonal",unlocked:!0},{id:"season-carnaval",name:"Tema Sazonal: Mascarada dos Bardos",icon:"ğŸ­",req:"Sazonal",unlocked:!0}].map(C=>{var A,O,S;return e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg border ${C.unlocked?"border-emerald-500/40 bg-emerald-900/10":"border-slate-600 bg-slate-800"} text-white`,children:[e.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:C.icon}),e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:C.name}),e.jsxs("div",{className:"text-xs sm:text-sm text-gray-300",children:["Requisito: ",C.req]}),e.jsxs("div",{className:"mt-2 sm:mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>{if(C.id.startsWith("frame-")){const ae={"frame-gold":"medieval","frame-royal":"medieval","frame-futurista":"futurista","frame-noir":"noir"}[C.id];g(ae),u(!0)}},className:"px-3 py-2 rounded-lg text-sm font-medium bg-gray-700 text-white hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"PrÃ©-visualizar"}),e.jsx("button",{disabled:!C.unlocked,onClick:()=>{if(C.id.startsWith("frame-")){const ae={"frame-gold":"medieval","frame-royal":"medieval","frame-futurista":"futurista","frame-noir":"noir"}[C.id];n(ae)}else if(C.id.startsWith("theme-")){const I=C.id==="theme-futurista"?"futurista":"noir";d(I)}else if(C.id.startsWith("season-")){const ae={"season-natal":"natal","season-pascoa":"pascoa","season-ano_novo":"ano_novo","season-ano-novo":"ano_novo","season-carnaval":"carnaval"}[C.id];Qe.getState().setActiveSeasonalTheme(ae)}},className:`px-3 py-2 rounded text-sm font-medium ${C.unlocked?Me.tabActive:"bg-gray-700 text-gray-400 cursor-not-allowed"} focus:outline-none focus:ring-2 focus:ring-indigo-500`,children:C.unlocked?C.id.startsWith("frame-")?i===(C.id==="frame-futurista"?"futurista":C.id==="frame-noir"?"noir":"medieval")?"Aplicado":"Aplicar":C.id.startsWith("theme-")&&l===(C.id==="theme-futurista"?"futurista":"noir")?"Aplicado":"Aplicar":"Bloqueado"}),C.id==="frame-futurista"||C.id==="frame-noir"||C.id==="theme-futurista"||C.id==="theme-noir"?e.jsxs("button",{onClick:()=>{const I=C.id.endsWith("futurista")?"futurista":"noir";C.id.startsWith("frame-")?r.includes(I)||(je.purchaseInitiated(t.id,`frame-${I}`),o(`frame-${I}`,{id:`rcpt-${Date.now()}`}),je.purchaseCompleted(t.id,`frame-${I}`)):c.includes(I)||(je.purchaseInitiated(t.id,`theme-${I}`),o(`theme-${I}`,{id:`rcpt-${Date.now()}`}),je.purchaseCompleted(t.id,`theme-${I}`))},className:`px-3 py-2 rounded-lg text-sm font-medium bg-gradient-to-r ${((A=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:A.buttonGradient)||"from-amber-600 to-yellow-600"} text-white hover:brightness-110 flex items-center gap-2`,children:[((S=(O=Ke[Qe.getState().activeSeasonalTheme||""])==null?void 0:O.accents)==null?void 0:S[0])||"",e.jsx("span",{children:"Comprar Premium"})]}):null]})]},C.id)})}),e.jsx("div",{className:"mt-6 text-sm text-gray-300",children:"Itens premium sÃ£o opcionais; servem apenas para personalizaÃ§Ã£o visual."})]}),e.jsx(Gd,{open:m,previewFrameId:p,onClose:()=>u(!1)}),e.jsxs("div",{id:"premium-content",className:"mt-10",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-white",children:"ğŸ“¦ ConteÃºdo Premium"}),e.jsx("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:"Opcional, narrativo e sem impacto em balanceamento. Gratuito permanece completo."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"p-4 rounded-lg border bg-gray-800 text-white",children:[e.jsx("div",{className:"font-semibold",children:"CapÃ­tulo BÃ´nus: Ecos do Destino"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Adiciona um capÃ­tulo extra Ã  sua jornada com cenas exclusivas."}),e.jsx("button",{onClick:()=>{if(je.purchaseInitiated(t.id,"dlc-ecos-destino"),o("dlc-ecos-destino",{id:`rcpt-${Date.now()}`}),t){const C=new Date().toISOString(),A=t.journeyChapters||[],O={id:`dlc-bonus-${t.id}`,index:(A.length||0)+1,title:"CapÃ­tulo BÃ´nus: Ecos do Destino",summary:"Um eco misterioso revela caminhos ocultos e memÃ³rias antigas.",createdAt:C,levelMilestone:t.progression.level,locked:!1,relatedQuests:t.completedQuests||[]};s(t.id,{journeyChapters:[...A,O]})}je.purchaseCompleted(t.id,"dlc-ecos-destino")},className:"mt-2 px-3 py-2 rounded bg-amber-600 text-white hover:bg-amber-700",children:"Comprar DLC"})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-gray-800 text-white",children:[e.jsx("div",{className:"font-semibold",children:"Final Alternativo: Caminho das Sombras"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Desbloqueia um epÃ­logo alternativo com escolhas dramÃ¡ticas."}),e.jsx("button",{onClick:()=>{o("dlc-final-sombras",{id:`rcpt-${Date.now()}`})},className:"mt-2 px-3 py-2 rounded bg-amber-600 text-white hover:bg-amber-700",children:"Comprar DLC"})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-gray-800 text-white",children:[e.jsx("div",{className:"font-semibold",children:"Passe de Temporada"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"ConteÃºdo narrativo exclusivo por temporada."}),e.jsx("button",{onClick:()=>{je.purchaseInitiated(t.id,"season-pass"),o("season-pass",{id:`rcpt-${Date.now()}`}),je.purchaseCompleted(t.id,"season-pass")},className:"mt-2 px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700",children:"Ativar Passe"})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-gray-800 text-white",children:[e.jsx("div",{className:"font-semibold",children:"Apoio ao Criador (Tip Jar)"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Recompensas simbÃ³licas: emblemas e molduras de agradecimento."}),e.jsx("div",{className:"flex gap-2",children:["bronze","silver","gold"].map(C=>e.jsx("button",{onClick:()=>{je.purchaseInitiated(t.id,`tip-${C}`),o(`tip-${C}`,{id:`rcpt-${Date.now()}`}),je.purchaseCompleted(t.id,`tip-${C}`)},className:`px-3 py-2 rounded ${C==="gold"?"bg-yellow-600":C==="silver"?"bg-gray-400":"bg-orange-600"} text-white hover:opacity-90`,children:C==="bronze"?"Bronze":C==="silver"?"Prata":"Ouro"},C))})]})]})]})]})]})},Ud=[{title:"Bando de LadrÃµes na Estrada",description:"Um grupo de bandidos estÃ¡ atacando comerciantes na estrada principal.",type:"narrative",difficulty:"medio",levelRequirement:2,timeLimit:3,rewards:{gold:80,xp:120},repeatable:!1,location:"Estrada do Norte",narrative:{intro:"VocÃª encontra um grupo de bandidos atacando uma caravana de comerciantes.",situation:"Os bandidos parecem estar em vantagem numÃ©rica, mas vocÃª pode tentar diferentes abordagens..."},enhancedChoices:[{id:"frontal-attack",text:"Ataque Frontal",description:"Confrontar os bandidos diretamente em combate",riskThreshold:60,rollModifiers:{attribute:"forca",multiplier:3,bonus:5},successEffects:[{type:"gold",value:120,description:"Recompensa dos comerciantes"},{type:"xp",value:150,description:"ExperiÃªncia de combate"},{type:"reputation",target:"Comerciantes",value:15},{type:"reputation",target:"Guarda da Cidade",value:10},{type:"reputation",target:"Bandidos",value:-20}],failureEffects:[{type:"gold",value:-30,description:"Ferimentos custaram poÃ§Ãµes"},{type:"reputation",target:"Bandidos",value:-5},{type:"npc_relation",target:"Mercador Aldric",value:5,description:"Tentativa valorizada"}],requirements:{level:2}},{id:"negotiate",text:"Negociar",description:"Tentar negociar a libertaÃ§Ã£o dos comerciantes",riskThreshold:45,rollModifiers:{attribute:"carisma",multiplier:4,bonus:0},successEffects:[{type:"gold",value:-50,description:"Pagamento aos bandidos"},{type:"xp",value:100,description:"ExperiÃªncia diplomÃ¡tica"},{type:"reputation",target:"Comerciantes",value:20},{type:"reputation",target:"Diplomatas",value:15},{type:"reputation",target:"Bandidos",value:10}],failureEffects:[{type:"world_event",target:"bandit_ambush",probability:.3},{type:"reputation",target:"Bandidos",value:-10}]},{id:"stealth-rescue",text:"Resgate Furtivo",description:"Esperar a oportunidade e resgatar os comerciantes silenciosamente",riskThreshold:55,rollModifiers:{attribute:"destreza",multiplier:3,bonus:10},successEffects:[{type:"gold",value:100,description:"Recompensa dos comerciantes"},{type:"xp",value:130,description:"ExperiÃªncia furtiva"},{type:"reputation",target:"Comerciantes",value:25},{type:"item",target:"pocao-media",description:"Presente dos comerciantes"}],failureEffects:[{type:"spawn_enemy",target:"bandit_patrol",probability:.4},{type:"reputation",target:"Bandidos",value:-15}],requirements:{level:3}},{id:"ignore",text:"Ignorar e Seguir",description:"NÃ£o se envolver e continuar seu caminho",riskThreshold:0,successEffects:[{type:"reputation",target:"Comerciantes",value:-10},{type:"npc_relation",target:"Mercador Aldric",value:-15}],failureEffects:[]}],storySeeds:{context:"Conflito entre bandidos e comerciantes",tone:"tense",previousDecisions:[]}},{title:"O Artefato Misterioso",description:"Um artefato antigo foi descoberto, mas parece emanar energia sinistra.",type:"narrative",difficulty:"dificil",levelRequirement:4,timeLimit:3,rewards:{gold:150,xp:200},repeatable:!1,location:"RuÃ­nas Antigas",narrative:{intro:"Nas profundezas de ruÃ­nas antigas, vocÃª encontra um orbe pulsante emanando energia mÃ¡gica.",situation:"O artefato sussurra em sua mente, prometendo poder, mas vocÃª sente uma presenÃ§a maligna..."},enhancedChoices:[{id:"take-artifact",text:"Pegar o Artefato",description:"Tocar e tentar controlar o poder do artefato",riskThreshold:70,rollModifiers:{attribute:"sabedoria",multiplier:2,bonus:-10},successEffects:[{type:"item",target:"orbe-poder",description:"Artefato poderoso"},{type:"xp",value:250,description:"Conhecimento arcano"},{type:"world_event",target:"magical_awakening",probability:.2}],failureEffects:[{type:"gold",value:-100,description:"MaldiÃ§Ã£o custou recursos"},{type:"world_event",target:"dark_corruption",probability:.5},{type:"npc_relation",target:"SÃ¡bia Elara",value:-20,description:"Desaprova escolhas perigosas"}],requirements:{level:4}},{id:"study-carefully",text:"Estudar com Cuidado",description:"Examinar o artefato sem tocÃ¡-lo diretamente",riskThreshold:40,rollModifiers:{attribute:"inteligencia",multiplier:3,bonus:5},successEffects:[{type:"xp",value:180,description:"Conhecimento seguro"},{type:"gold",value:80,description:"InformaÃ§Ãµes valiosas"},{type:"npc_relation",target:"SÃ¡bia Elara",value:15},{type:"reputation",target:"Diplomatas",value:10}],failureEffects:[{type:"xp",value:50,description:"Conhecimento limitado"}]},{id:"destroy-artifact",text:"Destruir o Artefato",description:"Tentar destruir o artefato para evitar que cause mal",riskThreshold:65,rollModifiers:{attribute:"forca",multiplier:2,bonus:0},successEffects:[{type:"xp",value:160,description:"Ato heroico"},{type:"reputation",target:"Guarda da Cidade",value:20},{type:"world_event",target:"evil_prevented",probability:.8}],failureEffects:[{type:"world_event",target:"artifact_explosion",probability:.6},{type:"gold",value:-50,description:"Danos colaterais"}],requirements:{level:3}},{id:"leave-untouched",text:"Deixar Intocado",description:"Sair das ruÃ­nas sem mexer no artefato",riskThreshold:0,successEffects:[{type:"xp",value:80,description:"Sabedoria da cautela"},{type:"reputation",target:"Aventureiros",value:-5,description:"Considerado cauteloso demais"}],failureEffects:[]}],worldStateRequirements:{factionReputation:{Aventureiros:0}},storySeeds:{context:"Descoberta de artefato mÃ¡gico perigoso",tone:"mysterious",previousDecisions:[]}}],Ra=class Ra{static getInstance(){return Ra.instance||(Ra.instance=new Ra),Ra.instance}generateEnhancedMission(s){const t=Ud.filter(o=>!(o.levelRequirement>s.progression.level||o.worldStateRequirements&&!ut.checkWorldStateRequirements(s,o.worldStateRequirements)));if(t.length===0)return this.generateFallbackMission(s);const r=t[Math.floor(Math.random()*t.length)],i=ut.generateStorySeeds(s),n={...r,id:`enhanced_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,status:"available",storySeeds:{...r.storySeeds,previousDecisions:i.previousDecisions,tone:i.tone},staminaCost:this.calculateStaminaCost(r.difficulty)};return n.enhancedChoices&&n.enhancedChoices.length>3&&(n.enhancedChoices=n.enhancedChoices.slice(0,3)),n}calculateStaminaCost(s){switch(s){case"facil":return 20;case"medio":return 40;case"dificil":return 60;case"epica":return 80;default:return 30}}generateFallbackMission(s){return{id:`fallback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:"Tarefa Simples",description:"Uma tarefa bÃ¡sica para ganhar experiÃªncia.",type:"narrative",difficulty:"facil",levelRequirement:1,rewards:{gold:30,xp:50},repeatable:!0,status:"available",enhancedChoices:[{id:"accept",text:"Aceitar",description:"Aceitar a tarefa",riskThreshold:30,successEffects:[{type:"gold",value:30},{type:"xp",value:50}],failureEffects:[{type:"gold",value:15},{type:"xp",value:25}]},{id:"decline",text:"Recusar",description:"Recusar a tarefa",riskThreshold:0,successEffects:[],failureEffects:[]}],storySeeds:{context:"Tarefa bÃ¡sica",tone:"neutral",previousDecisions:[]},staminaCost:20}}processEnhancedChoice(s,t,r){var c;const i=(c=t.enhancedChoices)==null?void 0:c.find(l=>l.id===r);if(!i)throw new Error("Escolha nÃ£o encontrada");if(!ut.canAcceptQuest(s,t.staminaCost||30))return{success:!1,results:{error:"Fadiga alta"},narrative:"Sua fadiga estÃ¡ alta para aceitar esta missÃ£o. Descanse um pouco."};ut.consumeStamina(s,t.staminaCost||30);const n=ut.processChoice(s,t.id,i.id,i.text,i.successEffects,i.failureEffects,i.riskThreshold,i.rollModifiers),o=this.generateResultNarrative(i,n.success,n.rollResult);return{success:n.success,results:n,narrative:o}}generateResultNarrative(s,t,r){const i=t?`Sua escolha de "${s.text}" foi bem-sucedida!`:`Sua tentativa de "${s.text}" nÃ£o saiu como esperado...`,n=`(Rolou ${r.roll} + ${r.modifiers} = ${r.total} vs ${r.threshold})`;return`${i}

${n}

${t?"As consequÃªncias de sua aÃ§Ã£o se desenrolam favoravelmente.":"VocÃª terÃ¡ que lidar com as consequÃªncias imprevistas."}`}};Ue(Ra,"instance");let fr=Ra;const Mi=fr.getInstance(),Vd=()=>{var w,k,E;const{getSelectedHero:a,updateHero:s,gainGold:t}=Z(),[r,i]=x.useState(Date.now()),n=a(),o=(w=n==null?void 0:n.stats)==null?void 0:w.trainingActiveUntil,c=(k=n==null?void 0:n.stats)==null?void 0:k.trainingActiveName,[l,d]=x.useState(null),[m,u]=x.useState(!1);x.useEffect(()=>{const h=setInterval(()=>{i(Date.now())},1e3);return()=>clearInterval(h)},[]),x.useEffect(()=>{if(o){const h=new Date(o).getTime(),b=Math.max(0,h-r);b>0?d(Math.ceil(b/1e3)):d(null)}else d(null)},[r,o]);const p=h=>{if(h===null)return"--:--";const b=Math.floor(h/60),f=h%60;return`${b}:${f.toString().padStart(2,"0")}`};if(!n)return null;const g=Math.max(0,Number(((E=n.progression)==null?void 0:E.fatigue)||0)),v=Math.max(0,Math.min(100,g/100*100)),y=()=>v>=80?"from-green-500 to-green-600":v>=50?"from-yellow-500 to-yellow-600":v>=20?"from-orange-500 to-orange-600":"from-red-500 to-red-600";return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white flex items-center",children:"ğŸ˜´ Fadiga"}),e.jsxs("div",{className:"text-sm text-gray-300",children:[g,"/100"]})]}),e.jsxs("div",{className:"relative h-4 bg-gray-700 rounded-full overflow-hidden mb-3",children:[e.jsx(tt.div,{className:`h-full bg-gradient-to-r ${y()}`,initial:{width:0},animate:{width:`${v}%`},transition:{duration:.5}}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-semibold text-white",children:[Math.round(v),"%"]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"text-gray-300",children:"Fadiga aumenta ao realizar aÃ§Ãµes e treinos."}),e.jsx("div",{className:"text-gray-400",children:"Descanse na taverna para reduzir a fadiga."})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-700",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Descanso na Taverna:"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[{label:"Soneca",cost:15,recovery:15},{label:"Noite",cost:30,recovery:30},{label:"Luxo",cost:60,recovery:60}].map(h=>e.jsxs("button",{disabled:m||g<=0,onClick:()=>{if(m)return;u(!0);const b={...n};ut.rest(b,"item",h.recovery),s(n.id,{progression:b.progression,stats:b.stats}),t(n.id,-h.cost),u(!1)},className:`p-2 rounded ${g>0?"bg-amber-700 hover:bg-amber-800 text-white border border-amber-500":"bg-gray-700 text-gray-400 border border-gray-600"} text-center`,children:[e.jsx("div",{className:"font-semibold",children:h.label}),e.jsxs("div",{children:["-",h.recovery," â€¢ ",h.cost," ğŸª™"]})]},h.label))})]}),e.jsxs("div",{className:"mt-3 text-center",children:[g>=80&&e.jsx("div",{className:"text-red-400 text-sm font-semibold",children:"âš ï¸ Fadiga muito alta â€” descanse!"}),g>0&&g<80&&e.jsx("div",{className:"text-yellow-400 text-sm",children:"ğŸ”” Fadiga presente â€” considere descansar."}),l!==null&&e.jsxs("div",{className:"mt-2 text-sm text-yellow-300",children:["ğŸƒ Treino: ",c||"Em andamento"," â€” ",p(l)]})]})]})},Qd=()=>{var c,l,d;const{getSelectedHero:a,updateHero:s}=Z(),[t,r]=x.useState([]),i=a();if(!i)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ­"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para ver a demonstraÃ§Ã£o do sistema de estado de mundo."})]});const n=()=>{const m=[],u=Mi.generateEnhancedMission(i);if(m.push({type:"mission_generated",title:"MissÃ£o Gerada",data:u}),u.enhancedChoices&&u.enhancedChoices.length>0){const g=u.enhancedChoices[0],v=Mi.processEnhancedChoice(i,u,g.id);m.push({type:"choice_processed",title:"Escolha Processada",data:v}),s(i.id,{worldState:i.worldState,progression:i.progression})}const p=ut.generateStorySeeds(i);m.push({type:"story_seeds",title:"Story Seeds Gerados",data:p}),r(m)},o=()=>{r([])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"DemonstraÃ§Ã£o do Sistema de Estado de Mundo"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Este sistema implementa decisÃµes com consequÃªncias, estado de mundo persistente e narrativa procedural."}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:n,className:"px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Executar DemonstraÃ§Ã£o"}),e.jsx("button",{onClick:o,className:"px-6 py-3 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Limpar Resultados"})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Estado Atual do HerÃ³i"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx(Vd,{})}),e.jsxs("div",{className:"bg-gray-700 rounded p-4",children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"InformaÃ§Ãµes BÃ¡sicas"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsxs("div",{children:["Nome: ",i.name]}),e.jsxs("div",{children:["Classe: ",i.class]}),e.jsxs("div",{children:["NÃ­vel: ",i.progression.level]})]})]}),e.jsxs("div",{className:"bg-gray-700 rounded p-4",children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"DecisÃµes Tomadas"}),e.jsxs("div",{className:"text-sm text-gray-300",children:[((c=i.worldState)==null?void 0:c.decisionLog.length)||0," decisÃµes registradas"]}),(l=i.worldState)==null?void 0:l.decisionLog.slice(-3).map((m,u)=>{var p;return e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["â€¢ ",m.choiceText," (",(p=m.rollResult)!=null&&p.success?"Sucesso":"Falha",")"]},u)})]})]}),((d=i.worldState)==null?void 0:d.factions)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"ReputaÃ§Ã£o com FacÃ§Ãµes"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(i.worldState.factions).map(([m,u])=>e.jsxs("div",{className:"bg-gray-700 rounded p-2",children:[e.jsx("div",{className:"text-sm text-white",children:m}),e.jsxs("div",{className:`text-xs ${u.reputation>0?"text-green-400":u.reputation<0?"text-red-400":"text-gray-400"}`,children:[u.reputation>0?"+":"",u.reputation]})]},m))})]})]}),t.length>0&&e.jsx("div",{className:"space-y-4",children:t.map((m,u)=>{var p;return e.jsxs(tt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:u*.2},className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:m.title}),m.type==="mission_generated"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-gray-700 rounded p-4",children:[e.jsx("h4",{className:"font-semibold text-white",children:m.data.title}),e.jsx("p",{className:"text-gray-300 text-sm mt-1",children:m.data.description}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["LocalizaÃ§Ã£o: ",m.data.location," â€¢ NÃ­vel: ",m.data.levelRequirement,"+ â€¢ Stamina: ",m.data.staminaCost||30]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-semibold text-white",children:"Escolhas DisponÃ­veis:"}),(p=m.data.enhancedChoices)==null?void 0:p.map((g,v)=>{var y;return e.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[e.jsx("div",{className:"font-medium text-white",children:g.text}),e.jsx("div",{className:"text-sm text-gray-300",children:g.description}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Dificuldade: ",g.riskThreshold,"% â€¢",((y=g.rollModifiers)==null?void 0:y.attribute)&&` Usa ${g.rollModifiers.attribute}`]})]},v)})]})]}),m.type==="choice_processed"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`p-4 rounded ${m.data.success?"bg-green-900 border border-green-500":"bg-red-900 border border-red-500"}`,children:[e.jsx("h4",{className:"font-semibold text-white",children:m.data.success?"âœ… Sucesso!":"âŒ Falha"}),e.jsx("p",{className:"text-gray-300 text-sm mt-1 whitespace-pre-line",children:m.data.narrative})]}),e.jsxs("div",{className:"bg-gray-700 rounded p-4",children:[e.jsx("h5",{className:"font-semibold text-white mb-2",children:"Detalhes do Roll:"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Roll: ",m.data.results.rollResult.roll," + Modificadores: ",m.data.results.rollResult.modifiers," =",m.data.results.rollResult.total," vs ",m.data.results.rollResult.threshold]})]}),m.data.results.appliedEffects.length>0&&e.jsxs("div",{className:"bg-gray-700 rounded p-4",children:[e.jsx("h5",{className:"font-semibold text-white mb-2",children:"Efeitos Aplicados:"}),m.data.results.appliedEffects.map((g,v)=>e.jsxs("div",{className:"text-sm text-gray-300",children:["â€¢ ",g.description||`${g.type}: ${g.value}`]},v))]})]}),m.type==="story_seeds"&&e.jsx("div",{className:"bg-gray-700 rounded p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Contexto:"}),e.jsx("span",{className:"text-gray-300 ml-2",children:m.data.context})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Tom:"}),e.jsx("span",{className:"text-gray-300 ml-2",children:m.data.tone})]}),m.data.previousDecisions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"DecisÃµes Recentes:"}),e.jsx("div",{className:"ml-2 text-sm text-gray-300",children:m.data.previousDecisions.map((g,v)=>e.jsxs("div",{children:["â€¢ ",g]},v))})]})]})}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-gray-400 hover:text-white",children:"Ver dados brutos (JSON)"}),e.jsx("pre",{className:"mt-2 p-4 bg-gray-900 rounded text-xs text-gray-300 overflow-auto",children:JSON.stringify(m.data,null,2)})]})]},u)})}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Como Funciona o Sistema"}),e.jsxs("div",{className:"space-y-4 text-gray-300",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:"1. WorldState"}),e.jsx("p",{className:"text-sm",children:"MantÃ©m o estado persistente do mundo, incluindo reputaÃ§Ã£o com facÃ§Ãµes, status de NPCs, eventos ativos e histÃ³rico de decisÃµes."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:"2. Decision Log"}),e.jsx("p",{className:"text-sm",children:"Registra todas as escolhas do jogador com timestamp, impacto e resultados de rolls, criando uma narrativa persistente."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:"3. Enhanced Choices"}),e.jsx("p",{className:"text-sm",children:"Escolhas com modificadores de atributos, thresholds de risco e efeitos de sucesso/falha que impactam o mundo."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:"4. Story Seeds"}),e.jsx("p",{className:"text-sm",children:"Contexto gerado baseado no estado atual do mundo e decisÃµes passadas, usado para criar narrativas dinÃ¢micas."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:"5. Stamina System"}),e.jsx("p",{className:"text-sm",children:'Sistema de "forced rest" onde missÃµes consomem stamina que se recupera ao longo do tempo, criando um loop de engajamento.'})]})]})]})]})},Xd=a=>a>=1100?"S":a>=800?"A":a>=550?"B":a>=350?"C":a>=200?"D":a>=100?"E":"F";async function Jd(a,s){var t;if(!(a!=null&&a.id))return{ok:!1,error:"HerÃ³i invÃ¡lido."};if(!_t)return{ok:!0,offline:!0};try{const{data:r}=await Ze.auth.getUser(),i=(t=r==null?void 0:r.user)==null?void 0:t.id;if(!i)return{ok:!1,error:"FaÃ§a login para pontuar reputaÃ§Ã£o."};const{data:n,error:o}=await Ze.from("guild_members").select("*").eq("user_id",i).eq("hero_id",a.id).limit(1);if(o)return{ok:!1,error:o.message};const c=n&&n[0],l=Math.max(0,((c==null?void 0:c.reputation)||0)+s),d=Xd(l),{data:m,error:u}=await Ze.from("guild_members").upsert({user_id:i,hero_id:a.id,hero_name:a.name,reputation:l,rank:d},{onConflict:"user_id,hero_id"}).select("*").limit(1);return u?{ok:!1,error:u.message}:{ok:!0,member:m&&m[0]}}catch(r){return{ok:!1,error:(r==null?void 0:r.message)||"Erro ao atualizar reputaÃ§Ã£o."}}}function br(a){const s=new Set(["weapon","armor","accessory"]),t=["comum","raro","epico","lendario"],r=t.indexOf(a),i=Ee.filter(d=>{if(!s.has(d.type))return!1;const m=t.indexOf(d.rarity);return a==="comum"?m===0:m>=r});if(i.length===0)return[];const n=()=>i[Math.floor(Math.random()*i.length)],o=[n()],c=Xo();a!=="raro"&&a!=="comum"&&Math.random()<Math.min(.8,.35+c)&&o.push(n());const l={};for(const d of o)l[d.id]=d;return Object.values(l)}function Wd({hero:a,enemies:s,onClose:t,onResult:r,floor:i,partyRarityBonusPercent:n}){var m;const[o,c]=x.useState(null),[l,d]=x.useState(null);return x.useEffect(()=>{const u=Wi(a,s,{floor:i,partyBonusPercent:n});c(u)},[a,s,i,n]),x.useEffect(()=>{if(!o)return;const u=(a.pets||[]).find(v=>v.id===a.activePetId),p=u==null?void 0:u.exclusiveSkill,g=(o.log||[]).filter(v=>v.includes("Companheiro")).length;p&&g>0?(d({name:p,count:g}),ge.emit({type:"quest",title:"Skill do Mascote",message:`${p} ativou ${g} vez(es)`,icon:"ğŸ¾",duration:2500})):d(null)},[o]),e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"battle-dialog-title",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:t}),e.jsxs("div",{className:"relative z-10 w-full max-w-3xl rounded-lg border border-gray-700 bg-gray-800 p-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{id:"battle-dialog-title",className:"text-xl font-bold text-white",children:"âš”ï¸ Batalha"}),e.jsx("button",{onClick:t,className:"text-gray-300 hover:text-white",children:"âœ–"})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-300",children:["Inimigos: ",s.map(u=>`${u.count} ${u.type}${u.count>1?"s":""}`).join(", ")]}),e.jsx("div",{className:"mt-4 max-h-64 overflow-y-auto rounded bg-gray-700 p-3 text-sm",children:((m=o==null?void 0:o.log)==null?void 0:m.map((u,p)=>e.jsx("div",{className:`leading-relaxed ${u.includes("Companheiro")?"text-emerald-300":"text-gray-200"}`,children:u},p)))||e.jsx("div",{className:"text-gray-200",children:"Resolvendo combate..."})}),o&&e.jsxs("div",{className:"mt-4",children:[o.petElementHighlights&&o.petElementHighlights.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-1",children:"Elementos aplicados pelo companheiro"}),e.jsx("div",{className:"flex gap-2 text-base",children:o.petElementHighlights.map((u,p)=>{const g=u==="earth"?"â›°ï¸":u==="light"?"âœ¨":u==="dark"?"ğŸŒ‘":"ğŸŒ€";return e.jsx("span",{title:u,children:g},`${u}-${p}`)})})]}),e.jsx("div",{className:`text-lg font-semibold ${o.victory?"text-green-400":"text-red-400"}`,children:o.victory?"VitÃ³ria":"Derrota"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-300",children:["Dano recebido: ",o.damage]}),(o.xpGained||o.goldGained)&&e.jsxs("div",{className:"text-sm text-gray-300",children:["Recompensas: ",o.xpGained," XP â€¢ ",o.goldGained," ouro"]}),l&&e.jsxs("div",{className:"mt-1 text-sm text-emerald-300",children:["ğŸ¾ Skill do mascote: ",l.name," â€¢ ativou ",l.count,"x"]}),o.itemsGained&&o.itemsGained.length>0&&e.jsxs("div",{className:"text-sm text-gray-300",children:["Itens: ",o.itemsGained.map(u=>u.name).join(", ")]}),((o.petDamage||0)>0||(o.petHealing||0)>0||(o.petStuns||0)>0)&&e.jsxs("div",{className:"mt-3 rounded bg-gray-700 p-3",children:[e.jsx("div",{className:"text-sm text-amber-300 font-semibold mb-1",children:"Companheiro"}),e.jsxs("div",{className:"text-sm text-gray-200",children:["Dano: ",o.petDamage||0," â€¢ Cura: ",o.petHealing||0," â€¢ Controles: ",o.petStuns||0]}),typeof o.petEnergyUsed=="number"&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Energia consumida: ",o.petEnergyUsed]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>{r(o),t()},className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Concluir"}),e.jsx("button",{onClick:t,className:"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700",children:"Fechar"})]})]})]})]})}function Vt(a){return a[Math.floor(Math.random()*a.length)]}function Mt(a,s){return a.toLowerCase().includes(s.toLowerCase())}function Gs(a){return a&&a[0].toUpperCase()+a.slice(1)}function Kd(a){const s=a.toLowerCase();return s.includes("social_hostil")?"a confusÃ£o na taverna":s.includes("social_amigavel")?"aquele banquete na guilda":s.includes("social_neutro")?"aquele encontro casual na praÃ§a":s.includes("missao")?"a missÃ£o passada":s.includes("treino")?"o treino no pÃ¡tio":"o incidente anterior"}function Yd(a,s,t){var J,re,ee,fe,_,P,M,C;const r=((J=a.npcPersonality)==null?void 0:J.archetype)||"explorador",i=((re=a.npcPersonality)==null?void 0:re.chatStyle)||"amigavel",n=(a.socialRelations||{})[s.id]||0,o=n>20?"friendly":n<-20?"hostile":"neutral",c=["Pelos deuses!","Pela barba de Merlim!","Por todos os dracos!","CÃ©us e aÃ§o!","Que sorte!","Por Taranis!"],l=["essas passagens","esses corredores antigos","essa caverna","essas minas","essas ruÃ­nas","essa mata fechada"],d=["verifique Ã¡gua e tochas","mantenha o abrigo ao alcance","olhe marcas no chÃ£o","escute o eco antes de avanÃ§ar","prenda a corda na cintura","mantenha a lÃ¢mina afiada"],m=["espere... ouÃ§o passos","silÃªncio, algo se move","luzes ao longe","cheiro de mofo recente","corrente de ar vindo da esquerda"],u=["melhor nÃ£o subestimar isso","isso me lembra um velho contratempo","o mapa pode estar errado","nÃ£o gosto desse silÃªncio","preciso ver pegadas"],p={caverna:["caverna","gruta escura","fendas rochosas"],ruina:["ruÃ­nas","pÃ¡tio antigo","salÃµes quebrados"],floresta:["mata fechada","clareira oculta","troncos retorcidos"],cidade:["becos","colunas da praÃ§a","arcadas do mercado"],montanha:["desfiladeiro","encosta Ã­ngreme","penhascos ventosos"]},g={competitivo:["Nada como provar valor","NinguÃ©m vai nos superar hoje","Hora de subir no ranking"],colaborativo:["Juntos vamos mais longe","Compartilhe o loot, compartilhe a glÃ³ria","Cobertura de flanco e avanÃ§o"],mercador:["NegÃ³cio bom Ã© metade da batalha","Veja preÃ§os, veja risco","Investir hoje, lucrar amanhÃ£"],explorador:["Mapeie, marque e avance","Sinta o vento, leia o terreno","Curiosidade abre portas"],sabio:["Observe padrÃµes","A mente vence a lÃ¢mina","Conhecimento Ã© proteÃ§Ã£o"],caotico:["Improviso vence tÃ¡tica","Se der errado, corra","Vamos mexer nesse ninho"]},v={mercador:"Oferta:",competitivo:"Desafio:",colaborativo:"Proposta:",sabio:"Conselho:",caotico:"Ideia:",explorador:"Plano:"},y=Mt(t,"caverna")||Mt(t,"corredor")||Mt(t,"coluna")||Mt(t,"mina")||Mt(t,"ruÃ­na"),w=o==="friendly"?Vt(c):o==="hostile"?"Tsc.":"Hmm.",k=ft(),E=(()=>{if(!k.npcBiomeLexiconEnabled)return y?Vt(l):"este trecho";const A=t.toLowerCase();return Mt(A,"caverna")||Mt(A,"gruta")?Vt(p.caverna):Mt(A,"ruÃ­na")||Mt(A,"ruinas")?Vt(p.ruina):Mt(A,"floresta")||Mt(A,"mata")?Vt(p.floresta):Mt(A,"cidade")||Mt(A,"praÃ§a")||Mt(A,"mercado")?Vt(p.cidade):Mt(A,"montanha")||Mt(A,"penhasco")?Vt(p.montanha):y?Vt(l):"este trecho"})(),h=Vt(d),b=Math.random()<(k.npcDialogueWhisperProb??.25)?Vt(m):"",f=Math.random()<(k.npcDialogueThoughtProb??.35)?Vt(u):"",j=Vt(g[r]||g.explorador),N=v[r]||"Plano:",T=((fe=(((ee=a.npcMemory)==null?void 0:ee.interactions)||[]).slice(-1)[0])==null?void 0:fe.summary)||"",F=T?`E nÃ£o quero repetir ${Kd(T)}.`:"",te=i==="sarcastico"?"digo com um meio sorriso":i==="formal"?"digo com postura firme":i==="quieto"?"digo em voz baixa":"digo com brilho nos olhos",D=`${w} ${N} ${j}.`,$=`${Gs(s.name)}, pegue seu equipamento e ${h}. ${te}: ${t?Gs(t):"vamos avanÃ§ar"} por ${E}.`,X=`${Gs(s.name)}, ${y?"cautela":"forÃ§a"}!${b?" [sussurrando] "+b+".":""}${f?" (pensando) "+f+".":""} ${F}`.trim(),Q=o==="friendly"?`${D} ${$} ${X}`:o==="hostile"?`${D} NÃ£o confie nas aparÃªncias. ${$} ${X}`:`${D} ${$} ${X}`,Y=(P=(_=import.meta)==null?void 0:_.env)==null?void 0:P.VITE_AI_PROVIDER,G=(C=(M=import.meta)==null?void 0:M.env)==null?void 0:C.VITE_AI_MODEL;if(Y&&G)try{return Q}catch{return Q}return Q}function Zd(){const a=Z(ue=>ue.getSelectedHero()),s=Z(ue=>ue.gainXP),t=Z(ue=>ue.gainGold),r=Z(ue=>ue.gainGlory),i=Z(ue=>ue.gainArcaneEssence),n=Z(ue=>ue.updateHero),o=Z(ue=>ue.addItemToInventory),c=Z(ue=>ue.equipItem),l=Z(ue=>ue.unequipItem),d=Z(ue=>ue.generateEggForSelected),[m,u]=x.useState(0),[p,g]=x.useState(!1),[v,y]=x.useState(!1),[w,k]=x.useState(!1),[E,h]=x.useState(null),[b,f]=x.useState([]),[j,N]=x.useState(!1),[T,F]=x.useState(0),[te,D]=x.useState(void 0),[$,X]=x.useState([]),[Q,Y]=x.useState(!1),[G,J]=x.useState(!1),[re,ee]=x.useState("none"),[fe,_]=x.useState(!1),[P,M]=x.useState(!1),[C,A]=x.useState(0),[O,S]=x.useState(1),[I,ae]=x.useState(0),[ne,U]=x.useState(1),[R,L]=x.useState(null),oe=Z(ue=>ue.useItem),[K,xe]=x.useState(null),[W,B]=x.useState(!1),[se,z]=x.useState("none"),V=x.useMemo(()=>b.reduce((ue,ye)=>ue+ye.xpGained,0),[b]),ie=x.useMemo(()=>b.reduce((ue,ye)=>ue+ye.goldGained,0),[b]),he=ue=>{switch(ue){case"F":case"E":return 3;case"D":case"C":return 4;case"B":return 5;case"A":return 6;case"S":return 7;case"SS":return 8;case"SSS":return 9;default:return 3}},H=a?We.calculateRank(a):void 0,me=he(H),[de,ve]=x.useState("normal"),Ae=x.useMemo(()=>Wo(de),[de]),Te=ue=>ue<=10?"ruinas":ue<=20?"cripta-nevada":ue<=30?"floresta-fungica":ue<=40?"deserto-oculto":"abismo-eterio",qe=ue=>ue==="ruinas"?"from-stone-700 to-gray-900":ue==="cripta-nevada"?"from-slate-600 to-blue-900":ue==="floresta-fungica"?"from-emerald-700 to-teal-900":ue==="deserto-oculto"?"from-amber-700 to-orange-900":"from-indigo-700 to-purple-900",Oe=()=>{var ke,De,Ne;if(!a){h("Selecione um herÃ³i para jogar a Dungeon.");return}if(!H||H==="F"||H==="E"){h("Rank insuficiente. A Dungeon Infinita requer rank D ou superior.");return}const ue=Date.now(),ye=(ke=a==null?void 0:a.dungeon)!=null&&ke.cooldownEndsAt?new Date(a.dungeon.cooldownEndsAt).getTime():0;if(ye&&ue<ye){h("Cooldown ativo para a dungeon. Aguarde antes de tentar novamente.");return}if((((Ne=(De=a==null?void 0:a.dungeon)==null?void 0:De.stamina)==null?void 0:Ne.current)??0)<=0){h("Stamina de dungeon insuficiente. Aguarde a recuperaÃ§Ã£o.");return}g(!0),y(!1),u(0),f([]),h(null),N(!1),F(0);const Ge=new Date().toISOString();D(Ge),J(!1),ee("none"),_(!1),A(0),S(1),ae(0),U(1),(async()=>{if(!a)return;const pe=await md(a,Ge);pe.ok&&pe.runId?xe(pe.runId):xe(null)})()},it=(ue,ye,Be,Ge)=>`${ue?"VocÃª avanÃ§a com determinaÃ§Ã£o.":"VocÃª tropeÃ§a e sofre um revÃ©s."} ${ye==="combat"?"Um combate acirrado ocorre.":ye==="trap"?"Uma armadilha quase te pega.":ye==="chest"?"VocÃª encontra um baÃº modesto.":ye==="rest"?"VocÃª encontra um canto seguro para descansar.":"O corredor estÃ¡ silencioso."} (+${Be} XP, +${Ge} ouro)`,nt=2,Xe=ue=>{var Be,Ge;if(!a||w||v)return;const ye=((Ge=(Be=a.dungeon)==null?void 0:Be.stamina)==null?void 0:Ge.current)??0;if(ye<nt){h("Stamina de dungeon insuficiente.");return}n(a.id,{dungeon:{...a.dungeon||{},stamina:{...(a.dungeon||{}).stamina||{current:0,max:0,lastRecovery:new Date().toISOString(),recoveryRate:0},current:Math.max(0,ye-nt)}}}),k(!0);try{const ke=(ue==="safe"?.8:ue==="normal"?.6:.4)+Ae.successBaseBias,Ne=Math.random()<ke;let pe="none";const be=Math.random();be<.28?pe="combat":be<.38?(ee("mystic_shrine"),_(!0),pe="rest"):be<.5?(ee("ancient_chest"),_(!0),pe="chest"):be<.58?(ee("environment_puzzle"),_(!0),pe="none"):be<.66?(ee("npc_encounter"),_(!0),pe="none"):be<.74?(ee("mysterious_merchant"),_(!0),pe="none"):be<.8?(ee("secret_gate"),_(!0),pe="none"):be<.88?(ee("corrupted_fountain"),_(!0),pe="none"):be<.94?(ee("celestial_portal"),_(!0),pe="none"):(be<.98&&(ee("echo_of_past"),_(!0)),pe="none");const Se=m+1;if(Se>me){k(!1),y(!0),N(!1);const xt={floor:Se,success:!0,event:"none",xpGained:0,goldGained:0,narrative:`Um portal selado bloqueia seu caminho. Rank atual (${H||"â€”"}) permite atÃ© ${me} andares.`},St=[...b,xt];f(St),K&&mt(K,{max_floor_reached:St.length,total_xp:St.reduce((Yt,Ht)=>Yt+Ht.xpGained,0),total_gold:St.reduce((Yt,Ht)=>Yt+Ht.goldGained,0),logs:St});return}const Fe=as(Se),ze=Jo(Se);if(pe==="combat"){const xt=Te(Se),Yt=Fe?{ruinas:["GuardiÃ£o de Pedra"],"cripta-nevada":["TitÃ£ de Gelo"],"floresta-fungica":["Rei Goblin"],"deserto-oculto":["Arauto Ãgneo"],"abismo-eterio":["Draco EtÃ©reo","Feiticeiro das Sombras"]}[xt]||["Troll"]:ze?["Ogro","GuardiÃ£o"]:["Goblin","Esqueleto","Bandido","Lobo"],Ht=Yt[Math.floor(Math.random()*Yt.length)],Ye=Fe||ze?1:Math.random()<.2?2:1,dt=Math.max(1,Math.floor(((a.progression.level||1)+Se*(Fe?.5:ze?.4:.3))*Ae.enemy));X([{type:Ht,count:Ye,level:dt}]),M(!0);return}const jt=Ne?ue==="safe"?5:ue==="normal"?8:12:3,bt=Ne?ue==="safe"?1:ue==="normal"?2:3:0,q=ma(T)*O*ne*Ae.rewards,le=Fe?1.5:1,Ce=Math.round(jt*q*le),_e=Math.round(bt*q*le),Je=Math.round(_e*.5),Nt=Fe?Math.round(1*q):0;s(a.id,Ce),t(a.id,_e),Je>0&&r(a.id,Je),Nt>0&&i(a.id,Nt);const lt={floor:Se,success:Ne,event:pe,xpGained:Ce,goldGained:_e,narrative:it(Ne,pe,Ce,_e)},ot=[...b,lt];if(f(ot),a!=null&&a.dungeon){const xt=a.dungeon.maxFloor||0,St=Math.max(xt,ot.length);n(a.id,{dungeon:{...a.dungeon,maxFloor:St}})}if(K&&mt(K,{max_floor_reached:ot.length,total_xp:ot.reduce((xt,St)=>xt+St.xpGained,0),total_gold:ot.reduce((xt,St)=>xt+St.goldGained,0),logs:ot}),Ne&&pe==="combat"?gt.combatVictory({heroId:a.id,heroName:a.name,heroClass:a.class,enemiesDefeated:Fe?["Boss da faixa"]:["Guardas da masmorra"]}):(pe==="chest"||pe==="rest"||pe==="trap")&&gt.eventCompleted({heroId:a.id,heroName:a.name,heroClass:a.class,eventCompleted:pe}),fe||N(!0),Fe&&!Ne&&pe==="combat"){const xt=Math.round(ie*na.deathPenalty.normal.gold),St=Math.round(V*na.deathPenalty.normal.xp);t(a.id,-xt),s(a.id,-St),y(!0),g(!1),N(!1)}}finally{k(!1)}},we=()=>{if(!v){if(m+1>=me){N(!1),y(!0);const ue={floor:m+1,success:!0,event:"none",xpGained:0,goldGained:0,narrative:`VocÃª atingiu o limite de andares permitido pelo seu rank (${H||"â€”"}). Avance de rank para desbloquear mais andares.`},ye=[...b,ue];f(ye),K&&mt(K,{max_floor_reached:ye.length,total_xp:ye.reduce((Be,Ge)=>Be+Ge.xpGained,0),total_gold:ye.reduce((Be,Ge)=>Be+Ge.goldGained,0),logs:ye});return}N(!1),F(ue=>ue+1),u(ue=>ue+1),C>0&&A(ue=>{const ye=ue-1;return ye<=0&&S(1),Math.max(0,ye)}),I>0&&ae(ue=>{const ye=ue-1;return ye<=0&&U(1),Math.max(0,ye)})}},Re=async()=>{N(!1),y(!0),g(!1),J(!0),await rt()},rt=async()=>{if(!a)return;const ue=G,ye={max_floor_reached:b.length,victory:ue,total_xp:V,total_gold:ie,logs:b,finished_at:new Date().toISOString(),started_at:te};if(K){const ke=await ud(K,{victory:ue,max_floor_reached:ye.max_floor_reached,total_xp:ye.total_xp,total_gold:ye.total_gold,logs:ye.logs,finished_at:ye.finished_at});ke.ok||h(ke.error||"Falha ao salvar run.")}else{const ke=await dd(a,ye);ke.ok||h(ke.error||"Falha ao salvar run.")}const Be=15*60*1e3,Ge=new Date(Date.now()+Be).toISOString();a.dungeon&&n(a.id,{dungeon:{...a.dungeon,cooldownEndsAt:Ge}}),ue&&await Jd(a,25)},Pe=()=>{g(!1),y(!1),u(0),f([]),h(null)},ce=ue=>{if(!a)return;const ye=m+1,Be=as(ye),Ge=ma(T)*O*ne*Ae.rewards,ke=Be?1.5:1;switch(re){case"ancient_chest":{if(ue==="open"){const De=(na.rarityIncreasePerFloor||0)*ye,Ne=Math.min(100,Math.random()*100+De);let pe="comum";Ne>=98?pe="lendario":Ne>=90?pe="epico":Ne>=70&&(pe="raro");const be=br(pe),Se=Math.round((pe==="comum"?10:pe==="raro"?25:pe==="epico"?60:150)*Ge*ke),Fe=Math.round((pe==="comum"?2:pe==="raro"?4:pe==="epico"?8:15)*ke),ze=pe==="raro"||pe==="epico"?1:pe==="lendario"?2:0;t(a.id,Se),Fe>0&&r(a.id,Fe),ze>0&&i(a.id,ze),be.length&&be.forEach(Ce=>{o(a.id,Ce.id,1)}),(pe==="epico"||pe==="lendario")&&Math.random()<.2&&d();const jt=be.map(Ce=>Ce.name),bt=be.map(Ce=>Ce.id),q={floor:ye,success:!0,event:"chest",xpGained:0,goldGained:Se,narrative:`BaÃº antigo: ${pe.toUpperCase()} â€¢ +${Se} ouro â€¢ +${Fe} glÃ³ria${ze>0?` â€¢ +${ze} essÃªncia`:""}${be.length?" â€¢ Itens raros":""}`};jt.length&&(q.itemsAwarded=jt,q.itemIdsAwarded=bt);const le=[...b,q];f(le),K&&mt(K,{max_floor_reached:le.length,total_xp:le.reduce((Ce,_e)=>Ce+_e.xpGained,0),total_gold:le.reduce((Ce,_e)=>Ce+_e.goldGained,0),logs:le})}else{const De={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:"VocÃª deixou o baÃº intacto."},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne})}break}case"mystic_shrine":{if(ue==="heal"){const De=a.derivedAttributes.hp||1,Ne=a.derivedAttributes.currentHp??De,pe=Math.min(De,Ne+Math.round(De*.5));n(a.id,{derivedAttributes:{...a.derivedAttributes,currentHp:pe}});{const be={floor:ye,success:!0,event:"rest",xpGained:4,goldGained:0,narrative:"SantuÃ¡rio mÃ­stico: vocÃª recupera forÃ§as (+HP)."},Se=[...b,be];if(f(Se),a.dungeon){const Fe=a.dungeon.maxFloor||0,ze=Math.max(Fe,Se.length);n(a.id,{dungeon:{...a.dungeon,maxFloor:ze}})}K&&mt(K,{max_floor_reached:Se.length,total_xp:Se.reduce((Fe,ze)=>Fe+ze.xpGained,0),total_gold:Se.reduce((Fe,ze)=>Fe+ze.goldGained,0),logs:Se})}s(a.id,Math.round(4*Ge))}else if(ue==="bless"){A(3),S(1.15);{const De={floor:ye,success:!0,event:"rest",xpGained:6,goldGained:0,narrative:"SantuÃ¡rio mÃ­stico: bÃªnÃ§Ã£o temporÃ¡ria por 3 andares."},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne})}s(a.id,Math.round(6*Ge))}break}case"dark_trap":{const De=Math.round((a.derivedAttributes.hp||20)*.25),Ne=a.derivedAttributes.currentHp??(a.derivedAttributes.hp||0),pe=Math.max(0,Ne-De);n(a.id,{derivedAttributes:{...a.derivedAttributes,currentHp:pe}}),ae(3),U(.9);{const be={floor:ye,success:!1,event:"trap",xpGained:0,goldGained:0,narrative:"Armadilha sombria: vocÃª sofre dano e fica debilitado por 3 andares."},Se=[...b,be];f(Se),K&&mt(K,{max_floor_reached:Se.length,total_xp:Se.reduce((Fe,ze)=>Fe+ze.xpGained,0),total_gold:Se.reduce((Fe,ze)=>Fe+ze.goldGained,0),logs:Se})}break}case"mysterious_merchant":{if(ue==="buy"){const De=Math.round(50*ke);if(a.progression.gold>=De){t(a.id,-De);const pe=br("raro")[0];pe&&o(a.id,pe.id,1);{const be={floor:ye,success:!0,event:"none",xpGained:0,goldGained:-De,narrative:`Mercador misterioso: vocÃª compra ${pe?pe.name:"um artefato"} por ${De} ouro.`};pe&&(be.itemsAwarded=[pe.name],be.itemIdsAwarded=[pe.id]);const Se=[...b,be];f(Se),K&&mt(K,{max_floor_reached:Se.length,total_xp:Se.reduce((Fe,ze)=>Fe+ze.xpGained,0),total_gold:Se.reduce((Fe,ze)=>Fe+ze.goldGained,0),logs:Se})}}else{const Ne={floor:ye,success:!1,event:"none",xpGained:0,goldGained:0,narrative:"Mercador misterioso: ouro insuficiente."},pe=[...b,Ne];f(pe),K&&mt(K,{max_floor_reached:pe.length,total_xp:pe.reduce((be,Se)=>be+Se.xpGained,0),total_gold:pe.reduce((be,Se)=>be+Se.goldGained,0),logs:pe})}}else{const De={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:"Mercador misterioso: vocÃª recusa a oferta."},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne})}break}case"secret_gate":{const De=Math.random()<.7,Ne=De?1+Math.floor(Math.random()*3):-(1+Math.floor(Math.random()*2));u(Se=>Math.max(0,Se+Ne));const pe={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:`PortÃ£o secreto: vocÃª Ã© teleportado ${De?`${Ne} andares Ã  frente`:`${Math.abs(Ne)} andares atrÃ¡s`}.`},be=[...b,pe];f(be),K&&mt(K,{max_floor_reached:be.length,total_xp:be.reduce((Se,Fe)=>Se+Fe.xpGained,0),total_gold:be.reduce((Se,Fe)=>Se+Fe.goldGained,0),logs:be});break}case"echo_of_past":{const De={floor:ye,success:!0,event:"none",xpGained:2,goldGained:0,narrative:"Eco do passado: â€œO corredor escureceâ€¦ passos ecoam nas sombras. Um olhar flamejante te observa.â€"},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne}),s(a.id,Math.round(2*Ge));break}case"environment_puzzle":{if(ue==="attempt")if(Math.random()<.6){const Ne=Math.round(10*Ge);s(a.id,Ne);const pe={floor:ye,success:!0,event:"none",xpGained:Ne,goldGained:0,narrative:"Quebra-cabeÃ§a ambiental resolvido. Portas se abrem adiante."},be=[...b,pe];f(be),K&&mt(K,{max_floor_reached:be.length,total_xp:be.reduce((Se,Fe)=>Se+Fe.xpGained,0),total_gold:be.reduce((Se,Fe)=>Se+Fe.goldGained,0),logs:be})}else{const Ne={floor:ye,success:!1,event:"none",xpGained:0,goldGained:0,narrative:"VocÃª falha no mecanismo e libera uma fumaÃ§a irritante."},pe=[...b,Ne];f(pe),K&&mt(K,{max_floor_reached:pe.length,total_xp:pe.reduce((be,Se)=>be+Se.xpGained,0),total_gold:pe.reduce((be,Se)=>be+Se.goldGained,0),logs:pe})}else{const De={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:"VocÃª ignora o enigma e segue em frente."},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne})}break}case"npc_encounter":{if(ue==="talk"){const Ne=Yd(a,a,`bioma ${Te(ye)}`),pe={floor:ye,success:!0,event:"rest",xpGained:3,goldGained:0,narrative:Ne},be=[...b,pe];f(be),s(a.id,Math.round(3*Ge)),K&&mt(K,{max_floor_reached:be.length,total_xp:be.reduce((Se,Fe)=>Se+Fe.xpGained,0),total_gold:be.reduce((Se,Fe)=>Se+Fe.goldGained,0),logs:be})}else{const De={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:"VocÃª passa silenciosamente pelo viajante."},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne})}break}case"collectible_relic":{if(ue==="collect"){const De=["reliquia-brilho-eterno","reliquia-contos-sussurrados","coroa-quebrada"],Ne=De[Math.floor(Math.random()*De.length)];o(a.id,Ne,1);const pe={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:"VocÃª encontra uma relÃ­quia com histÃ³rias gravadas."};pe.itemIdsAwarded=[Ne];const be=[...b,pe];f(be),K&&mt(K,{max_floor_reached:be.length,total_xp:be.reduce((Se,Fe)=>Se+Fe.xpGained,0),total_gold:be.reduce((Se,Fe)=>Se+Fe.goldGained,0),logs:be})}else{const De={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:"VocÃª deixa a relÃ­quia onde estÃ¡."},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne})}break}case"corrupted_fountain":{if(ue==="purify")if(Math.random()<.5){A(2),S(1.2);const Ne={floor:ye,success:!0,event:"rest",xpGained:5,goldGained:0,narrative:"VocÃª purifica a fonte e recebe uma benÃ§Ã£o."},pe=[...b,Ne];f(pe),s(a.id,Math.round(5*Ge)),K&&mt(K,{max_floor_reached:pe.length,total_xp:pe.reduce((be,Se)=>be+Se.xpGained,0),total_gold:pe.reduce((be,Se)=>be+Se.goldGained,0),logs:pe})}else{ae(2),U(.85);const Ne={floor:ye,success:!1,event:"trap",xpGained:0,goldGained:0,narrative:"A corrupÃ§Ã£o te atinge; vocÃª Ã© enfraquecido."},pe=[...b,Ne];f(pe),K&&mt(K,{max_floor_reached:pe.length,total_xp:pe.reduce((be,Se)=>be+Se.xpGained,0),total_gold:pe.reduce((be,Se)=>be+Se.goldGained,0),logs:pe})}else{const De={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:"VocÃª evita a fonte corrompida."},Ne=[...b,De];f(Ne),K&&mt(K,{max_floor_reached:Ne.length,total_xp:Ne.reduce((pe,be)=>pe+be.xpGained,0),total_gold:Ne.reduce((pe,be)=>pe+be.goldGained,0),logs:Ne})}break}case"celestial_portal":{const De=Math.random()<.8,Ne=De?2+Math.floor(Math.random()*4):-(1+Math.floor(Math.random()*2));u(Se=>Math.max(0,Se+Ne));const pe={floor:ye,success:!0,event:"none",xpGained:0,goldGained:0,narrative:De?"Um portal celeste te empurra adiante.":"O portal te joga de volta, mas vocÃª aprende com o salto."},be=[...b,pe];f(be),K&&mt(K,{max_floor_reached:be.length,total_xp:be.reduce((Se,Fe)=>Se+Fe.xpGained,0),total_gold:be.reduce((Se,Fe)=>Se+Fe.goldGained,0),logs:be});break}}ee("none"),_(!1),N(!0)},Ie=Te(m+1),[Le,ct]=x.useState({x:50,y:50});return e.jsxs("div",{className:`relative overflow-hidden max-w-3xl mx-auto p-6 bg-gradient-to-b ${qe(Ie)} rounded-lg shadow-xl`,onMouseMove:ue=>{const ye=ue.currentTarget.getBoundingClientRect(),Be=(ue.clientX-ye.left)/ye.width*100,Ge=(ue.clientY-ye.top)/ye.height*100;ct({x:Be,y:Ge})},children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Dungeon Infinita"}),e.jsxs("p",{className:"text-gray-300",children:["Andar atual: ",m+1," ",as(m+1)?"â€” Boss":""]}),e.jsxs("p",{className:"text-indigo-200",children:["Bioma: ",Te(m+1)]}),e.jsxs("p",{className:"text-indigo-300",children:["Limite por rank: atÃ© ",me," andares (",H||"â€”",")"]}),e.jsxs("p",{className:"text-indigo-300",children:["Streak: ",T," â€¢ Multiplicador: x",ma(T).toFixed(2)]}),!p&&!v&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mb-3 flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Dificuldade:"}),e.jsxs("select",{value:de,onChange:ue=>ve(ue.target.value),className:"px-2 py-1 rounded bg-gray-700 text-gray-100",children:[e.jsx("option",{value:"facil",children:"FÃ¡cil"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"dificil",children:"DifÃ­cil"}),e.jsx("option",{value:"epico",children:"Ã‰pico"}),e.jsx("option",{value:"hardcore",children:"Hardcore"}),e.jsx("option",{value:"caotico",children:"CaÃ³tico"})]})]}),e.jsx("button",{onClick:Oe,disabled:!a||!H||H==="F"||H==="E",className:"px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:"Iniciar Tentativa"}),(!H||H==="F"||H==="E")&&e.jsx("div",{className:"mt-2 text-sm text-red-300",children:"Requer rank D ou superior para entrar."})]}),e.jsxs("div",{className:"vfx-layer",children:[e.jsx("div",{className:"vfx-fog"}),Ie==="cripta-nevada"&&e.jsx("div",{className:"vfx-snow",children:Array.from({length:50}).map((ue,ye)=>e.jsx("span",{className:"flake",style:{"--x":`${Math.random()*100}%`,"--dur":`${7+Math.random()*5}s`,"--delay":`${Math.random()*4}s`}},`flake-${ye}`))}),Ie==="deserto-oculto"&&e.jsx("div",{className:"vfx-embers",children:Array.from({length:40}).map((ue,ye)=>e.jsx("span",{className:"ember",style:{"--x":`${Math.random()*100}%`,"--dur":`${5+Math.random()*4}s`,"--delay":`${Math.random()*3}s`}},`ember-${ye}`))}),Ie==="floresta-fungica"&&e.jsx("div",{className:"vfx-spores",children:Array.from({length:36}).map((ue,ye)=>e.jsx("span",{className:"spore",style:{"--x":`${Math.random()*100}%`,"--dur":`${6+Math.random()*6}s`,"--delay":`${Math.random()*2.5}s`}},`spore-${ye}`))}),Ie==="abismo-eterio"&&e.jsx("div",{className:"vfx-stars",children:Array.from({length:60}).map((ue,ye)=>e.jsx("span",{className:"star",style:{"--x":`${Math.random()*100}%`,"--y":`${Math.random()*100}%`,"--dur":`${2+Math.random()*3}s`,"--delay":`${Math.random()*2}s`}},`star-${ye}`))}),e.jsx("div",{className:"lantern-overlay",style:{"--lx":`${Le.x}%`,"--ly":`${Le.y}%`}})]}),p&&e.jsxs("div",{className:"mt-4 p-4 border rounded bg-gray-800 border-gray-700",children:[e.jsxs("div",{className:"text-gray-200",children:["Andar ",m+1]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>Xe("safe"),disabled:w,className:"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600 disabled:opacity-50",children:"Seguro"}),e.jsx("button",{onClick:()=>Xe("normal"),disabled:w,className:"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600 disabled:opacity-50",children:"PadrÃ£o"}),e.jsx("button",{onClick:()=>Xe("risky"),disabled:w,className:"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600 disabled:opacity-50",children:"Arriscado"})]}),P&&$.length>0&&e.jsxs("div",{className:"mt-4 p-3 border border-red-700 bg-red-900/20 rounded",children:[e.jsx("div",{className:"text-white font-semibold",children:"Combate"}),e.jsxs("div",{className:"mt-1 text-gray-200",children:["Inimigos: ",$.map(ue=>`${ue.count} ${ue.type}${ue.count>1?"s":""}`).join(", ")]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>{M(!1),Y(!0)},className:"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:"Atacar"}),e.jsx("button",{onClick:()=>{const ue=a.derivedAttributes.hp||1,ye=a.derivedAttributes.currentHp??ue,Be=Math.min(ue,ye+20);n(a.id,{derivedAttributes:{...a.derivedAttributes,currentHp:Be}}),M(!1),Y(!0)},className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Usar item"}),e.jsx("button",{onClick:()=>{Math.random()<.6?(f(ye=>[...ye,{floor:m+1,success:!0,event:"none",xpGained:2,goldGained:0,narrative:"VocÃª fugiu do combate."}]),s(a.id,2),M(!1),N(!0)):(M(!1),Y(!0))},className:"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700",children:"Fugir"})]})]}),j&&!v&&e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:we,className:"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700",children:"Subir"}),e.jsx("button",{onClick:Re,className:"px-3 py-2 rounded bg-amber-600 text-black hover:bg-amber-500",children:"Sair com prÃªmios"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["Multiplicador atual: x",ma(T).toFixed(2)]})]}),W&&!v&&e.jsxs("div",{className:"mt-4 p-3 border border-yellow-700 bg-yellow-900/20 rounded",children:[e.jsx("div",{className:"text-white font-semibold",children:"Recompensa de Chefe"}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>{var ue,ye,Be;z("forca"),n(a.id,{dungeon:{...a.dungeon||{},permanentBonusAttributes:{...((ue=a.dungeon)==null?void 0:ue.permanentBonusAttributes)||{},forca:(((Be=(ye=a.dungeon)==null?void 0:ye.permanentBonusAttributes)==null?void 0:Be.forca)||0)+1}}}),B(!1),N(!0)},className:"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:"+1 atributo permanente"}),e.jsx("button",{onClick:()=>{var ye;const ue=((ye=a.dungeon)==null?void 0:ye.rareItemBonusPercent)??0;n(a.id,{dungeon:{...a.dungeon||{},rareItemBonusPercent:Math.min(100,ue+10)}}),B(!1),N(!0)},className:"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700",children:"+10% item raro"}),e.jsx("button",{onClick:()=>{var ye;const ue=((ye=a.dungeon)==null?void 0:ye.specialSkills)||[];n(a.id,{dungeon:{...a.dungeon||{},specialSkills:[...ue,"habilidade-especial"]}}),B(!1),N(!0)},className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Habilidade especial"}),e.jsx("button",{onClick:()=>{var ye;const ue=((ye=a.dungeon)==null?void 0:ye.eternalBuffs)||[];n(a.id,{dungeon:{...a.dungeon||{},eternalBuffs:[...ue,"buff-eterno"]}}),B(!1),N(!0)},className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Buff eterno da dungeon"})]})]}),fe&&!v&&e.jsxs("div",{className:"mt-4 p-3 border border-indigo-700 bg-indigo-900/20 rounded",children:[e.jsx("div",{className:"text-white font-semibold",children:"Eventos AleatÃ³rios"}),re==="ancient_chest"&&e.jsxs("div",{className:"mt-2 text-gray-200",children:["BaÃº Antigo: abrir pode dar loot raro ou ser armadilha.",e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>ce("open"),className:"px-3 py-2 rounded bg-amber-600 text-black hover:bg-amber-500",children:"Abrir"}),e.jsx("button",{onClick:()=>ce("skip"),className:"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700",children:"Ignorar"})]})]}),re==="mystic_shrine"&&e.jsxs("div",{className:"mt-2 text-gray-200",children:["SantuÃ¡rio MÃ­stico: cura HP ou concede bÃªnÃ§Ã£o temporÃ¡ria.",e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>ce("heal"),className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Cura"}),e.jsx("button",{onClick:()=>ce("bless"),className:"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700",children:"BÃªnÃ§Ã£o"})]})]}),re==="mysterious_merchant"&&e.jsxs("div",{className:"mt-2 text-gray-200",children:["Mercador Misterioso: vende itens raros por ouro coletado.",e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>ce("buy"),className:"px-3 py-2 rounded bg-yellow-600 text-black hover:bg-yellow-500",children:"Comprar"}),e.jsx("button",{onClick:()=>ce("skip"),className:"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700",children:"Recusar"})]})]}),re==="secret_gate"&&e.jsxs("div",{className:"mt-2 text-gray-200",children:["PortÃ£o Secreto: teleporta 1-3 andares Ã  frente (ou atrÃ¡s).",e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>ce("teleport"),className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Usar PortÃ£o"})})]}),re==="echo_of_past"&&e.jsxs("div",{className:"mt-2 text-gray-200",children:["Eco do Passado: mostra uma histÃ³ria curta do mundo.",e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>ce("listen"),className:"px-3 py-2 rounded bg-gray-600 text-white hover:bg-gray-700",children:"Escutar"})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-white font-semibold",children:"Registro"}),e.jsx("ul",{className:"mt-2 text-sm text-gray-300 list-disc pl-5",children:b.map((ue,ye)=>e.jsxs("li",{children:["Andar ",ue.floor,": ",ue.narrative]},`floor-${ue.floor}-${ye}`))})]}),b.some(ue=>ue.itemIdsAwarded&&ue.itemIdsAwarded.length>0||ue.itemsAwarded&&ue.itemsAwarded.length>0)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-white font-semibold",children:"Loot por Andar"}),e.jsx("ul",{className:"mt-2 text-sm text-gray-200 list-disc pl-5",children:b.filter(ue=>ue.itemIdsAwarded&&ue.itemIdsAwarded.length>0||ue.itemsAwarded&&ue.itemsAwarded.length>0).map((ue,ye)=>e.jsxs("li",{className:"flex flex-col gap-1",children:[e.jsxs("span",{children:["Andar ",ue.floor,":"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(ue.itemIdsAwarded&&ue.itemIdsAwarded.length>0?ue.itemIdsAwarded:[]).map((Be,Ge)=>{const ke=Ee.find(ze=>ze.id===Be),De=(ke==null?void 0:ke.rarity)==="lendario"?"bg-yellow-600":(ke==null?void 0:ke.rarity)==="epico"?"bg-purple-600":(ke==null?void 0:ke.rarity)==="raro"?"bg-blue-600":"bg-gray-600",Ne=ke&&(ke.type==="weapon"||ke.type==="armor"||ke.type==="accessory"),pe=(ke==null?void 0:ke.type)==="consumable",be=!!a&&((ke==null?void 0:ke.type)==="weapon"&&a.inventory.equippedWeapon===Be||(ke==null?void 0:ke.type)==="armor"&&a.inventory.equippedArmor===Be||(ke==null?void 0:ke.type)==="accessory"&&(a.inventory.equippedAccessories||[]).includes(Be)),Se=[];ke!=null&&ke.bonus&&Object.entries(ke.bonus).forEach(([ze,jt])=>{typeof jt=="number"&&jt!==0&&Se.push(`${ze}: ${jt>0?"+":""}${jt}`)});const Fe=Ne?`${ke==null?void 0:ke.name} â€” ${Se.length?Se.join(", "):"sem bÃ´nus"}`:pe?`${ke==null?void 0:ke.name} â€” ConsumÃ­vel`:(ke==null?void 0:ke.name)||Be;return e.jsxs("button",{title:Fe,onClick:()=>{if(a){if(Ne)if(be){const ze=l(a.id,Be);L(ze?`${ke==null?void 0:ke.name} desequipado!`:`NÃ£o foi possÃ­vel desequipar ${ke==null?void 0:ke.name}.`)}else{const ze=c(a.id,Be);L(ze?`${ke==null?void 0:ke.name} equipado!`:`NÃ£o foi possÃ­vel equipar ${ke==null?void 0:ke.name}.`)}else if(pe){const ze=oe(a.id,Be),jt=(ke==null?void 0:ke.name)||Be;L(ze?`${jt} usado! Efeito aplicado.`:`NÃ£o foi possÃ­vel usar ${jt}.`)}else return;setTimeout(()=>L(null),2e3)}},className:`px-2 py-1 rounded ${De} text-white text-xs hover:opacity-90`,children:[ke!=null&&ke.icon?`${ke.icon} `:"",(ke==null?void 0:ke.name)||Be,Ne?be?" â€¢ Desequipar":" â€¢ Equipar":pe?" â€¢ Usar":""]},`${ue.floor}-${Be}-${Ge}`)}),!ue.itemIdsAwarded&&ue.itemsAwarded&&ue.itemsAwarded.length>0&&e.jsx("span",{className:"px-2 py-1 rounded bg-gray-600 text-white text-xs",children:ue.itemsAwarded.join(", ")})]})]},`loot-${ue.floor}-${ye}`))}),R&&e.jsx("div",{className:"mt-2 text-xs text-green-300",children:R})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-200",children:["Total: ",V," XP, ",ie," ouro"]})]}),v&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-700 rounded",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Run finalizada"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Andares concluÃ­dos: ",b.length," â€¢ Total: ",V," XP, ",ie," ouro"]}),E&&e.jsx("div",{className:"mt-2 text-red-300",children:E}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:rt,className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Salvar tentativa"}),e.jsx("button",{onClick:Pe,className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Reiniciar"})]})]}),Q&&$.length>0&&a&&e.jsx(Wd,{hero:a,enemies:$,floor:m+1,partyRarityBonusPercent:0,onClose:()=>Y(!1),onResult:ue=>{var q;const ye=m+1,Be=as(ye),Ge=ma(T),ke=Be?1.5:1,De=Math.round((ue.xpGained||0)*Ge*ke*Ae.rewards),Ne=Math.round((ue.goldGained||0)*Ge*ke*Ae.rewards),pe=Math.round(Ne*.5),be=Be?1:0;s(a.id,De),t(a.id,Ne),pe>0&&r(a.id,pe),be>0&&i(a.id,be);const Se=a.derivedAttributes.currentHp??(a.derivedAttributes.hp||0),Fe=Math.max(0,Se-(ue.damage||0));n(a.id,{derivedAttributes:{...a.derivedAttributes,currentHp:Fe}});const ze=!!ue.victory,jt={floor:ye,success:ze,event:"combat",xpGained:De,goldGained:Ne,narrative:it(ze,"combat",De,Ne)},bt=[...b,jt];if(f(bt),K&&mt(K,{max_floor_reached:bt.length,total_xp:bt.reduce((le,Ce)=>le+Ce.xpGained,0),total_gold:bt.reduce((le,Ce)=>le+Ce.goldGained,0),logs:bt}),ze&&Be&&(Math.random()<.3&&o(a.id,"essencia-bestial",1),Math.random()<.25&&o(a.id,"pergaminho-montaria",1)),ze)gt.combatVictory({heroId:a.id,heroName:a.name,heroClass:a.class,enemiesDefeated:Be?["Boss da faixa"]:$.map(le=>le.type)}),Be?(B(!0),N(!1)):N(!0);else{if(Be){const Ce=Math.round(ie*na.deathPenalty.normal.gold),_e=Math.round(V*na.deathPenalty.normal.xp);t(a.id,-Ce),s(a.id,-_e)}y(!0),g(!1),N(!1);const le={...a.stats||{}};n(a.id,{stats:{...le,inDungeon:!1}})}if(Y(!1),X([]),ze&&Be){const le=((q=a.rankData)==null?void 0:q.currentRank)||"F",_e={F:0,E:.02,D:.04,C:.06,B:.08,A:.1,S:.12}[le]||0,Je=Math.min(.6,.3+_e),Nt=Math.min(.5,.25+_e*.5);Math.random()<Je&&o(a.id,"essencia-bestial",1),Math.random()<Nt&&o(a.id,"pergaminho-montaria",1)}}})]})}const em={"Colinas de Boravon":[{target:"Lobo Sombrio",objectivePrefix:"Abater"},{target:"Bandido Errante",objectivePrefix:"Neutralizar"}],"Rio Marfim":[{target:"Slime Ãcido",objectivePrefix:"Reduzir"},{target:"Serpente do Rio",objectivePrefix:"Afastar"}],"Floresta Nebulosa":[{target:"Morcego Vampiro",objectivePrefix:"Eliminar"},{target:"Bruxa da NÃ©voa",objectivePrefix:"Derrubar"}],"RuÃ­nas Antigas":[{target:"Golem Rachado",objectivePrefix:"Destruir"}],"Floresta Umbral":[{target:"Bruxa da NÃ©voa",objectivePrefix:"Derrubar"}],"Caverna Antiga":[{target:"Troll de Pedra",objectivePrefix:"CaÃ§ar"}]};function tm(a){const s=["Colinas de Boravon","Rio Marfim","Floresta Nebulosa","RuÃ­nas Antigas","Floresta Umbral","Caverna Antiga"];return s[Math.floor(Math.random()*s.length)]}function am(a){const s=a||"F";return s==="F"?["controle","coleta","escolta"]:s==="E"?["controle","coleta","escolta"]:s==="D"?["controle","coleta","escolta"]:s==="C"?["controle","coleta","escolta"]:s==="B"?["controle","coleta","escolta","especial"]:["controle","coleta","escolta","especial"]}function sm(a){return a==="controle"||a==="coleta"?3:a==="escolta"?4:3}function rm(a){return a==="especial"?"A":"F"}function zs(a,s,t){var T,F;const r=(T=a.rankData)==null?void 0:T.currentRank,i=am(r),n=(a.class||"").toLowerCase(),c=((F=Object.entries({arqueiro:["controle","especial","escolta"],guerreiro:["controle","especial"],mago:["coleta","especial"],clerigo:["escolta","controle"],paladino:["escolta","controle"],assassino:["controle","especial"]}).find(([te])=>n.includes(te)))==null?void 0:F[1])||[],l=r==="F"?i:c.length?[...c,...i]:i,d=t&&i.includes(t)?t:l[Math.floor(Math.random()*l.length)],m=s||tm(),u=em[m],p=u[Math.floor(Math.random()*u.length)],g=d==="controle"?6+Math.floor(Math.random()*5):d==="coleta"?4+Math.floor(Math.random()*4):1;let v=d==="especial"?"epica":a.progression.level<5?"facil":a.progression.level<10?"medio":"dificil",y=sm(d);const w=rm(d);w==="F"&&(v="facil"),w==="F"&&d==="coleta"&&(y=2),w==="F"&&d==="escolta"&&(y=3);let k={xp:v==="epica"?120:v==="dificil"?90:v==="medio"?60:40,gold:v==="epica"?70:v==="dificil"?50:v==="medio"?35:20};w==="F"&&d==="escolta"&&(k={...k,xp:k.xp+8,gold:k.gold+5}),w==="F"&&d==="controle"&&(k={...k,xp:k.xp+5,gold:k.gold+3});const E=d==="controle"?`Controle da ${p.target}`:d==="coleta"?"Coleta de Recursos":d==="escolta"?"Escolta Segura":"Alvo Especial",h=d==="coleta"?`Coletar ${g} ${p.target==="Bruxa da NÃ©voa"?"EssÃªncias Umbral":"Ervas/Recursos"}`:`${p.objectivePrefix} ${d==="controle"?g:p.target}`,b=d==="controle"?`A populaÃ§Ã£o de ${p.target} ameaÃ§a caravanas em ${m}. Reduza sua presenÃ§a.`:d==="coleta"?`Recursos raros foram avistados em ${m}. Obtenha-os sob risco controlado.`:d==="escolta"?`Um NPC precisa alcanÃ§ar ${m} em seguranÃ§a. O caminho Ã© perigoso.`:`Um alvo Ãºnico foi identificado em ${m}. Derrube-o para obter recompensas.`,f=v==="epica"?5:v==="dificil"?4:v==="medio"?3:2,j=(()=>{if(m==="Floresta Nebulosa"||m==="Floresta Umbral")return Math.random()<.7?"noite":void 0;if(m==="Rio Marfim")return Math.random()<.6?"dia":void 0;if(d==="coleta"&&Math.random()<.5)return Math.random()<.5?"noite":"dia"})(),N=c.length?`Classe favorecida em ${d}`:void 0;return{id:`hunt_${Date.now()}_${Math.random().toString(36).slice(2)}`,title:E,category:d,biome:m,objective:h,target:p.target,amount:g,phases:y,difficulty:v,rankRequired:w,baseRewards:k,narrative:b,staminaPerPhase:f,classHint:N,timeHint:j}}function im(){var R,L,oe,K,xe,W,B,se;const a=Z(z=>z.getSelectedHero()),s=Z(z=>z.gainXP),t=Z(z=>z.gainGold),r=Z(z=>z.addItemToInventory),i=Z(z=>z.updateHero),n=Z(z=>z.updateDailyGoalProgress),o=Z(z=>z.generateEggForSelected),[c,l]=x.useState("Colinas de Boravon"),[d,m]=x.useState(null),[u,p]=x.useState(null),[g,v]=x.useState(!1),[y,w]=x.useState(!1),[k,E]=x.useState(0),[h,b]=x.useState([]),[f,j]=x.useState(null),[N,T]=x.useState(0),[F,te]=x.useState(null),[D,$]=x.useState(!1),X=Z(z=>z.getHeroRankProgress),Q=x.useMemo(()=>a?X(a.id):null,[a==null?void 0:a.id,(R=a==null?void 0:a.progression)==null?void 0:R.xp,(L=a==null?void 0:a.stats)==null?void 0:L.questsCompleted]),[Y,G]=x.useState(!1),[J,re]=x.useState(!1),ee=x.useMemo(()=>{var V;const z=(V=a==null?void 0:a.hunting)!=null&&V.cooldownEndsAt?new Date(a.hunting.cooldownEndsAt).getTime():0;return z?Math.max(0,z-Date.now()):0},[(oe=a==null?void 0:a.hunting)==null?void 0:oe.cooldownEndsAt]),fe=ee>0,_=()=>{var ie;const z=((ie=a==null?void 0:a.rankData)==null?void 0:ie.currentRank)||"F";return{F:8,E:12,D:15,C:20,B:25,A:30,S:40}[z]||15},P=x.useMemo(()=>(u==null?void 0:u.phases)||0,[u==null?void 0:u.phases]);(K=a==null?void 0:a.rankData)==null||K.currentRank,x.useEffect(()=>{var V;if(!a)return;const z=((V=a.rankData)==null?void 0:V.currentRank)==="F"?d??void 0:void 0;p(zs(a,c,z))},[a==null?void 0:a.id,c,d]);const M=x.useMemo(()=>{var he;if(!a||!u)return!1;const z=(he=a.rankData)==null?void 0:he.currentRank,V=Xt.indexOf(z||"F"),ie=Xt.indexOf(u.rankRequired);return V>=ie},[(xe=a==null?void 0:a.rankData)==null?void 0:xe.currentRank,u==null?void 0:u.rankRequired]);x.useEffect(()=>{var ie;if(!u||!a)return;const z=Xt.indexOf(((ie=a.rankData)==null?void 0:ie.currentRank)||"F"),V=Xt.indexOf(u.rankRequired);z<V?j("Rank insuficiente para esta missÃ£o de caÃ§a."):j(null)},[u==null?void 0:u.id,(W=a==null?void 0:a.rankData)==null?void 0:W.currentRank]);const C=()=>{var ie;if(!a||!u)return;if(!M){j("Rank insuficiente para esta missÃ£o de caÃ§a.");return}if(fe){j("Cooldown ativo para MissÃµes de CaÃ§a. Aguarde o tempo de recarga.");return}const z=ut.computeEffectiveStaminaCost(a,A);if(Math.max(0,Number(((ie=a.progression)==null?void 0:ie.fatigue)||0))+z>100){j("Fadiga alta â€” descanse antes de iniciar.");return}v(!0),w(!1),E(0),b([]),j(null),T(0),te(u.category==="escolta"?100:null),$(!1)},A=(u==null?void 0:u.rankRequired)==="F"?2:Math.max(2,(u==null?void 0:u.staminaPerPhase)||3),O=x.useMemo(()=>{if(!a||!u)return null;const z=a.attributes,V=u.difficulty==="epica"?.45:u.difficulty==="dificil"?.6:u.difficulty==="medio"?.7:.8,ie=u.category==="controle"?(z.destreza||0)*.01:u.category==="coleta"?(z.inteligencia||0)*.01:u.category==="escolta"?(z.constituicao||0)*.008:(z.forca||0)*.008,he=Math.max(.2,Math.min(.95,V+ie));return Math.round(he*100)},[a==null?void 0:a.id,u==null?void 0:u.id]),S=x.useMemo(()=>{if(!u)return null;const z=(O??80)/100,V=Math.round(z*u.baseRewards.xp+(1-z)*Math.round(u.baseRewards.xp*.5)),ie=Math.round(z*u.baseRewards.gold+(1-z)*Math.round(u.baseRewards.gold*.3));return{xp:V*u.phases,gold:ie*u.phases}},[u==null?void 0:u.id,O]),I=x.useMemo(()=>{if(!u)return 0;const z=Math.max(0,u.phases-2),V=A*u.phases+z;return ut.computeEffectiveStaminaCost(a,V)},[u==null?void 0:u.phases,A]),ae=()=>{var _e,Je,Nt,lt,ot,xt,St,Yt,Ht;if(!a||!u||y)return;const z=u.rankRequired==="F"?0:k>=2?1:0,V=A+z,ie=ut.computeEffectiveStaminaCost(a,V);if(Math.max(0,Number(((_e=a.progression)==null?void 0:_e.fatigue)||0))+ie>100){j("Fadiga alta â€” pare e descanse."),v(!1);return}ut.consumeStamina(a,V),i(a.id,{progression:a.progression});const H=u.difficulty==="epica"?.45:u.difficulty==="dificil"?.6:u.difficulty==="medio"?.7:.8,me=.06,de=a.attributes,ve=u.category==="controle"?(de.destreza||0)*.01:u.category==="coleta"?(de.inteligencia||0)*.01:u.category==="escolta"?(de.constituicao||0)*.008:(de.forca||0)*.008,Ae=(((Je=a.rankData)==null?void 0:Je.currentRank)||"F")==="F"?.3:.2,Te=Math.max(Ae,Math.min(.95,H-k*me+ve)),Oe=Math.random()<Te,it=ma(N),nt=u.baseRewards.xp,Xe=u.baseRewards.gold,we=u.category==="especial"&&k+1===u.phases,Re=we?1.5:1,rt=Math.round((Oe?nt:Math.round(nt*.5))*it*Re);let Pe=Math.round((Oe?Xe:Math.round(Xe*.3))*it*Re);const ce=ut.getMountStaminaReduction(a);if(ce>0){const Ye=1+Math.min(.3,ce*.5);Pe=Math.round(Pe*Ye)}s(a.id,rt),t(a.id,Pe);const Ie=we?"epico":k>=2?"raro":k>=1?"incomum":"comum",Le=Math.random()<(Oe?.5:.25)?br(Ie):[];Le.forEach(Ye=>r(a.id,Ye.id,1));const ue={controle:["pele-lobo-sombrio","colmilho-vampirico","osso-antigo"],coleta:["erva-sangue","essencia-lunar","cristal-runico"],escolta:["pergaminho-protecao","pergaminho-velocidade"],especial:we?["lamina-alpha","armadura-pedra-rachada"]:[]}[u.category]||[],ye=[];if(ue.length){const Ye=we?1:Oe?.7:.4,dt=new Date().getHours(),kt=dt<6||dt>=18,Gt=dt>=8&&dt<17,Dt=ue.filter(Et=>Et==="essencia-lunar"?kt:Et==="erva-sangue"?Gt:Et==="cristal-runico"?u.biome==="Caverna Antiga"||u.biome==="RuÃ­nas Antigas":!0);if(Dt.length&&Math.random()<Ye){const Et=Dt[Math.floor(Math.random()*Dt.length)];r(a.id,Et,1),ye.push(Et)}}if(u.timeHint==="noite"){const Ye=new Date().getHours();(Ye<6||Ye>=18)&&Math.random()<(Oe?.6:.3)&&(r(a.id,"essencia-lunar",1),ye.push("essencia-lunar"))}const Be=Ye=>{var dt;return((dt=Ee.find(kt=>kt.id===Ye))==null?void 0:dt.name)||Ye},Ge={"Colinas de Boravon":["Lobo Sombrio","Bandido"],"Rio Marfim":["Slime Ãcido","Serpente do Rio"],"Floresta Nebulosa":["Morcego Vampiro","Bruxa da NÃ©voa"],"RuÃ­nas Antigas":["Golem Rachado","Esqueleto"],"Floresta Umbral":["Bruxa da NÃ©voa","Lobo Sombrio"],"Caverna Antiga":["Troll de Pedra","Slime Ãcido"]},ke=u.category==="escolta"?.25:.15,De=(((Nt=a.rankData)==null?void 0:Nt.currentRank)||"F")==="F",Ne=Math.random()<ke-(De?.05:0)+(u.difficulty==="dificil"?.05:u.difficulty==="epica"?.1:0);let pe="";if(Ne){const Ye=Ge[u.biome]||["Inimigos"],dt=Ye[Math.floor(Math.random()*Ye.length)],kt=Math.round((a.derivedAttributes.hp||20)*.1),Gt=Math.round(kt*((((lt=a.rankData)==null?void 0:lt.currentRank)||"F")==="F"?.5:1)),Dt=a.derivedAttributes.currentHp??(a.derivedAttributes.hp||0),Et=Math.max(0,Dt-Gt);if(i(a.id,{derivedAttributes:{...a.derivedAttributes,currentHp:Et}}),pe=` â€¢ Emboscada: ${dt} causa dano durante a fase.`,F!==null){const Ia=(((ot=a.rankData)==null?void 0:ot.currentRank)||"F")==="F"&&u.category==="escolta"?7:10;te(Math.max(0,F-Ia))}const ba=a.derivedAttributes.hp||1;Et/ba<.2&&(G(!1),j("HP baixo, auto desativado."))}if(!Oe){const Ye=a.derivedAttributes.hp||1,dt=a.derivedAttributes.currentHp??Ye,kt=Math.round(Ye*(we?.2:.1)),Gt=Math.round(kt*((((xt=a.rankData)==null?void 0:xt.currentRank)||"F")==="F"?.5:1)),Dt=Math.max(0,dt-Gt),Et=Math.min(100,(a.progression.fatigue||0)+(we?10:6));if(i(a.id,{derivedAttributes:{...a.derivedAttributes,currentHp:Dt},progression:{...a.progression,fatigue:Et}}),F!==null){const Ia=we?30:15,Es=(((St=a.rankData)==null?void 0:St.currentRank)||"F")==="F"&&u.category==="escolta"?we?20:10:Ia,Rt=Math.max(0,F-Es);te(Rt)}const ba=a.derivedAttributes.hp||1;Dt/ba<.2&&(G(!1),j("HP baixo, auto desativado."))}let be="";const Se=new Date().getHours(),Fe=Se<6||Se>=18,ze=((Yt=a.rankData)==null?void 0:Yt.currentRank)||"F",bt={F:0,E:.01,D:.02,C:.03,B:.04,A:.05,S:.06}[ze]||0,q=u.biome==="Floresta Nebulosa"||u.biome==="Floresta Umbral"?Fe?.15+bt:.07+bt:u.biome==="Caverna Antiga"?we?.2+bt:.06+bt:.05+bt;Math.random()<q&&(o(),be=" ğŸ¥š Ovo misterioso encontrado."),we&&(u.biome==="Caverna Antiga"||u.biome==="RuÃ­nas Antigas")&&Math.random()<.25&&(r(a.id,"essencia-bestial",1),ye.push("essencia-bestial")),Oe&&F!==null&&(((Ht=a.rankData)==null?void 0:Ht.currentRank)||"F")==="F"&&u.category==="escolta"&&te(Math.min(100,(F||0)+5));const le={phase:k+1,success:Oe,xp:rt,gold:Pe,narrative:(Oe?`Progresso na fase ${k+1}.`:`RevÃ©s na fase ${k+1}.`)+pe+be,itemsAwarded:[...Le.map(Ye=>({id:Ye.id,name:Ye.name})),...ye.map(Ye=>({id:Ye,name:Be(Ye)}))]},Ce=[...h,le];if(b(Ce),(Le.length>0||ye.length>0)&&$(!0),T(Ye=>Ye+(Oe?1:0)),E(Ye=>Ye+1),F!==null&&F<=0||k+1>=P){w(!0),v(!1);const Ye=Z.getState(),dt=Ye.heroes.find(kt=>kt.id===a.id);if(dt){const kt={...dt.stats,questsCompleted:(dt.stats.questsCompleted||0)+1,lastActiveAt:new Date().toISOString()};Ye.updateHero(a.id,{stats:kt});const Gt=dt.rankData??We.initializeRankData(dt),Dt=We.updateRankData({...dt,stats:kt},Gt);Ye.updateHero(a.id,{rankData:Dt}),n(a.id,"quest-completed",1);const Et=_(),ba=new Date(Date.now()+Et*60*1e3).toISOString();Ye.updateHero(a.id,{hunting:{...dt.hunting||{},cooldownEndsAt:ba,lastCompletedAt:new Date().toISOString()}})}if(u.rankRequired==="F"&&!D){const kt=u.category==="coleta"?"erva-sangue":"osso-antigo";r(a.id,kt,1),b(Gt=>[...Gt,{phase:P,success:!0,xp:0,gold:0,narrative:"Recompensa de novato concedida.",itemsAwarded:[{id:kt}]}])}}},ne=()=>{if(!a||!u)return;const z=Z.getState(),V=z.heroes.find(ve=>ve.id===a.id);if(!V)return;const ie={...V.stats,questsCompleted:(V.stats.questsCompleted||0)+1,lastActiveAt:new Date().toISOString()};z.updateHero(a.id,{stats:ie});const he=V.rankData??We.initializeRankData(V),H=We.updateRankData({...V,stats:ie},he);z.updateHero(a.id,{rankData:H}),n(a.id,"quest-completed",1);const me=_(),de=new Date(Date.now()+me*60*1e3).toISOString();z.updateHero(a.id,{hunting:{...V.hunting||{},cooldownEndsAt:de,lastCompletedAt:new Date().toISOString()}}),w(!0),v(!1)},U=()=>{if(!a||!u)return;let z=zs(a,c),V=0;for(;V<10&&z.category===u.category&&z.biome===u.biome;)z=zs(a,c),V++;p(z),j(null)};return x.useEffect(()=>{if(g&&Y&&!y){const z=setTimeout(()=>{ae()},500);return()=>clearTimeout(z)}},[g,Y,y,k]),e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"MissÃµes de CaÃ§a"}),a&&e.jsxs("div",{className:"text-gray-300",children:["Rank: ",((B=a.rankData)==null?void 0:B.currentRank)||"â€”"]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("select",{value:c,onChange:z=>l(z.target.value),className:"px-3 py-2 rounded bg-gray-800 text-white",children:["Colinas de Boravon","Rio Marfim","Floresta Nebulosa","RuÃ­nas Antigas","Floresta Umbral","Caverna Antiga"].map(z=>e.jsx("option",{value:z,children:z},z))}),((se=a==null?void 0:a.rankData)==null?void 0:se.currentRank)==="F"&&e.jsxs("select",{value:d||"",onChange:z=>m(z.target.value||null),className:"ml-2 px-3 py-2 rounded bg-gray-800 text-white",children:[e.jsx("option",{value:"",children:"AleatÃ³ria"}),["controle","coleta","escolta"].map(z=>e.jsx("option",{value:z,children:z},z))]})]}),u&&e.jsxs("div",{className:"mt-4 p-4 border rounded bg-gray-800 border-gray-700",children:[e.jsxs("div",{className:"text-white font-semibold",children:[u.title," â€” ",u.biome]}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["Objetivo: ",u.objective]}),J&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"text-gray-300 text-sm",children:["Fases: ",u.phases," â€¢ Dificuldade: ",u.difficulty," â€¢ Recompensa base: +",u.baseRewards.xp," XP, +",u.baseRewards.gold," ouro"]}),u.rankRequired==="F"&&(u.category==="escolta"||u.category==="controle")&&e.jsxs("div",{className:"text-emerald-300 text-xs",children:["BÃ´nus Novato ativo para ",u.category,"."]}),e.jsxs("div",{className:"text-gray-400 text-xs",children:["Custo estimado de fadiga: ",A," Ã— ",u.phases," + ",Math.max(0,u.phases-2)," = ",A*u.phases+Math.max(0,u.phases-2)]}),(()=>{const z=ut.getMountStaminaReduction(a);if(!z)return null;const V=Math.round(z*100),ie=A*u.phases+Math.max(0,u.phases-2),he=ut.computeEffectiveStaminaCost(a,ie);return e.jsxs("div",{className:"text-emerald-300 text-xs",children:["Montaria ativa reduz custo em ",V,"% â€¢ Efetivo: ",he]})})(),O!==null&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Chance inicial estimada de sucesso (fase 1): ",O,"%"]}),Q&&Q.progress&&e.jsxs("div",{className:"text-gray-400 text-xs mt-1",children:["Progresso para ",Q.progress.nextRank||Q.progress.currentRank,": XP ",Q.progress.currentXP,"/",Q.progress.requiredXP," â€¢ MissÃµes ",Q.progress.currentMissions,"/",Q.progress.requiredMissions]}),S&&e.jsxs("div",{className:"text-gray-300 text-sm mt-1",children:["Estimativa bruta de recompensa: ~ +",S.xp," XP, +",S.gold," ouro"]}),(()=>{const z=ut.getMountStaminaReduction(a);if(!z)return null;const V=Math.round(Math.min(.3,z*.5)*100);return e.jsxs("div",{className:"text-emerald-300 text-xs",children:["BÃ´nus de ouro por montaria: +",V,"%"]})})(),e.jsxs("div",{className:"text-gray-400 text-xs",children:["Dica: atributo que ajuda nesta missÃ£o: ",u.category==="controle"?"Destreza":u.category==="coleta"?"InteligÃªncia":u.category==="escolta"?"ConstituiÃ§Ã£o":"ForÃ§a"]}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["Requer Rank: ",u.rankRequired]}),u.classHint&&e.jsx("div",{className:"text-gray-400 text-xs",children:u.classHint}),u.timeHint&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Melhor perÃ­odo: ",u.timeHint]}),e.jsxs("div",{className:"text-gray-400 text-xs",children:["PossÃ­vel loot: ",(u.category==="controle"?["pele-lobo-sombrio","colmilho-vampirico","osso-antigo"]:u.category==="coleta"?["erva-sangue","essencia-lunar","cristal-runico"]:u.category==="escolta"?["pergaminho-protecao","pergaminho-velocidade"]:[]).map((z,V)=>{var ie;return e.jsx("span",{className:"inline-block ml-1 px-2 py-0.5 rounded bg-gray-700 text-white text-xs",children:((ie=Ee.find(he=>he.id===z))==null?void 0:ie.name)||z},`pv_${z}_${V}`)})]})]}),!g&&!y&&e.jsxs("div",{className:"mt-3",children:[e.jsx("button",{onClick:C,disabled:!a||!M||fe,className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:"Iniciar CaÃ§ada"}),e.jsx("button",{onClick:U,disabled:!a||g||fe,className:"ml-2 px-3 py-2 rounded bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50",children:"Nova MissÃ£o"}),e.jsx("button",{onClick:()=>re(z=>!z),className:"ml-2 px-3 py-2 rounded bg-gray-700 text-white hover:bg-gray-600",children:J?"Ocultar Detalhes":"Detalhes da MissÃ£o"}),!M&&e.jsx("div",{className:"mt-2 text-sm text-red-300",children:"Rank insuficiente para esta missÃ£o."}),a&&(()=>{var ie;const z=Math.max(0,Number(((ie=a.progression)==null?void 0:ie.fatigue)||0)),V=ut.computeEffectiveStaminaCost(a,A);return z+V>100})()&&e.jsx("div",{className:"mt-2 text-sm text-amber-300",children:"Fadiga alta para iniciar. Descanse antes."}),a&&(()=>{var ie;return Math.max(0,Number(((ie=a.progression)==null?void 0:ie.fatigue)||0))+I>100})()&&e.jsx("div",{className:"mt-2 text-sm text-amber-300",children:"AtenÃ§Ã£o: orÃ§amento de fadiga pode nÃ£o cobrir todas as fases."}),M&&u.rankRequired==="F"&&e.jsx("div",{className:"mt-2 text-sm text-emerald-300",children:"MissÃ£o inicial liberada para Novatos (Rank F)."}),fe&&e.jsxs("div",{className:"mt-2 text-sm text-amber-300",children:["Cooldown ativo: aguarde ",Math.ceil(ee/6e4)," min."]}),f&&e.jsx("div",{className:"mt-2 text-sm text-red-300",children:f})]}),g&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"text-gray-200",children:["Fase ",k+1," de ",P]}),F!==null&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Integridade do NPC: ",F,"%"]}),(()=>{const z=(u==null?void 0:u.rankRequired)==="F"?0:k>=2?1:0,V=A+z,ie=ut.computeEffectiveStaminaCost(a,V),he=Math.round(ut.getMountStaminaReduction(a)*100);return e.jsxs("div",{className:"text-emerald-300 text-xs",children:["Custo desta fase: base ",V," â€¢ efetivo ",ie,he?` â€¢ reduÃ§Ã£o ${he}%`:""]})})(),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:ae,className:"px-3 py-2 rounded bg-purple-600 text-white hover:bg-purple-700",children:"Prosseguir"}),e.jsx("button",{onClick:ne,className:"px-3 py-2 rounded bg-amber-600 text-black hover:bg-amber-500",children:"Recuar e guardar loot"}),e.jsx("button",{onClick:()=>G(z=>!z),className:`px-3 py-2 rounded ${Y?"bg-teal-600":"bg-teal-700"} text-white hover:bg-teal-500`,children:Y?"Auto: ON":"Auto: OFF"})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-400",children:["Multiplicador atual: x",ma(N).toFixed(2)]})]}),h.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-white font-semibold",children:"Registro"}),e.jsx("ul",{className:"mt-2 text-sm text-gray-300 list-disc pl-5",children:h.map(z=>e.jsxs("li",{children:["Fase ",z.phase,": ",z.narrative," â€¢ +",z.xp," XP, +",z.gold," ouro",z.itemsAwarded&&z.itemsAwarded.length?" â€¢ Loot":""]},z.phase))}),h.some(z=>z.itemsAwarded&&z.itemsAwarded.length>0)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-white font-semibold",children:"Loot acumulado"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:h.flatMap(z=>z.itemsAwarded||[]).map((z,V)=>e.jsx("span",{className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:z.name||z.id},`${z.id}_${V}`))})]})]}),y&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-sm text-gray-200",children:"CaÃ§ada finalizada."}),e.jsxs("div",{className:"mt-2 text-sm text-gray-300",children:["Total: +",h.reduce((z,V)=>z+V.xp,0)," XP, +",h.reduce((z,V)=>z+V.gold,0)," ouro"]}),h.some(z=>z.itemsAwarded&&z.itemsAwarded.length)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-white font-semibold text-sm",children:"Itens recebidos"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:h.flatMap(z=>z.itemsAwarded||[]).map((z,V)=>e.jsx("span",{className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:z.name||z.id},`fin_${z.id}_${V}`))})]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>w(!1),className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Completar MissÃ£o"})})]})]})]})}const Ei=()=>{var J,re,ee,fe,_;const{getSelectedHero:a,equipItem:s,sellItem:t,useItem:r,unequipItem:i,upgradeItem:n,socketJewel:o,removeJewel:c,fuseJewels:l}=Z(),d=a(),{activeSeasonalTheme:m}=Qe(),u=m&&((J=Ke[m])==null?void 0:J.border)||"border-slate-600",[p,g]=x.useState("todos"),[v,y]=x.useState("todas"),[w,k]=x.useState(""),[E,h]=x.useState({}),[b,f]=x.useState(null);d!=null&&d.inventory.equippedWeapons,d!=null&&d.inventory.equippedArmorSlots,d!=null&&d.inventory.equippedAccessories;const j=x.useCallback(P=>{switch(P){case"lendario":return"border-amber-400 bg-amber-900/10";case"epico":return"border-violet-400 bg-violet-900/10";case"raro":return"border-blue-400 bg-blue-900/10";case"incomum":return"border-emerald-400 bg-emerald-900/10";default:return"border-slate-600 bg-slate-800"}},[]),N=P=>{if(!P)return 0;const M=Ee.find(C=>C.id===P);return M?M.type==="weapon"?2:M.type==="armor"?3:M.type==="accessory"?1:0:0},T=P=>{const[M,C,A]=P.split(":"),O=new Jt(crypto.randomUUID(),C,Number(A)),S=O.getBonus(),I=[];return S.forca&&I.push(`+${S.forca} ForÃ§a`),S.inteligencia&&I.push(`+${S.inteligencia} InteligÃªncia`),S.destreza&&I.push(`+${S.destreza} Destreza`),S.constituicao&&I.push(`+${S.constituicao} ConstituiÃ§Ã£o`),S.armorClass&&I.push(`+${S.armorClass} Defesa`),`${C.toUpperCase()} Nv.${O.nivel} â€¢ ${I.join(" / ")}`},F=P=>{const M=Ee.find(A=>A.id===P);if(!M)return"";const C=[M.name];if(M.bonus){const A=M.bonus,O={forca:"ForÃ§a",destreza:"Destreza",constituicao:"ConstituiÃ§Ã£o",inteligencia:"InteligÃªncia"};for(const S of Object.keys(A)){const I=S==="sabedoria"?"inteligencia":S==="carisma"?"destreza":S;C.push(`+${A[S]} ${O[I]||I}`)}}if(M.effects){const A=M.effects;A.hp&&C.push(`+${A.hp} HP`),A.mp&&C.push(`+${A.mp} MP`),A.special&&C.push(`${A.special}`)}return C.join(" â€¢ ")},te=(P,M)=>{P.dataTransfer.setData("text/plain",M)},D=(P,M)=>{P.dataTransfer.setData("application/jewel",M)},$=P=>M=>{M.preventDefault();const C=M.dataTransfer.getData("text/plain"),A=Ee.find(S=>S.id===C);if(!d||!A||P==="mainHand"&&A.type!=="weapon"||P==="offHand"&&A.type!=="weapon"||P==="helm"&&!(A.type==="armor"&&A.slot==="helm")||P==="chest"&&!(A.type==="armor"&&(!A.slot||A.slot==="chest"))||P==="belt"&&!(A.type==="armor"&&A.slot==="belt")||P==="gloves"&&!(A.type==="armor"&&A.slot==="gloves")||P==="boots"&&!(A.type==="armor"&&A.slot==="boots")||P==="cape"&&!(A.type==="armor"&&A.slot==="cape")||P==="necklace"&&!(A.type==="accessory"&&A.slot==="necklace")||(P==="ringLeft"||P==="ringRight")&&!(A.type==="accessory"&&(A.slot==="ring"||!A.slot))||(P==="earringLeft"||P==="earringRight")&&!(A.type==="accessory"&&A.slot==="earring"))return;const O=s(d.id,C);f(O?{message:`Equipado: ${A.name}`,type:"success"}:{message:`NÃ£o foi possÃ­vel equipar ${A.name}.`,type:"error"}),setTimeout(()=>f(null),1500)},X=P=>P.preventDefault(),Q=x.useMemo(()=>d?Object.entries(d.inventory.items).filter(([,P])=>P>0):[],[d]),Y=x.useMemo(()=>Q.filter(([P])=>{const M=Ee.find(C=>C.id===P);return!(!M||p!=="todos"&&M.type!==p||v!=="todas"&&M.rarity!==v||w&&!M.name.toLowerCase().includes(w.toLowerCase()))}),[Q,p,v,w]),G=(P,M,C)=>{const A=Math.max(1,Math.min(C,Number.isFinite(M)?M:1));h(O=>({...O,[P]:A}))};return d?e.jsxs("div",{className:"max-w-5xl mx-auto p-6",children:[e.jsxs("div",{className:`${et.layout.containers.panel} ${u} p-6 mb-6 text-slate-200`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"ğŸ’ InventÃ¡rio"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Gerencie seus itens: equipar, consumir e vender."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-400",children:"HerÃ³i"}),e.jsx("div",{className:"font-semibold text-slate-100",children:d.name})]})]}),b&&e.jsx("div",{role:"status","aria-live":"polite",className:`mt-4 px-4 py-2 rounded text-sm ${b.type==="success"?"bg-emerald-900/20 text-emerald-300 border border-emerald-700":"bg-red-900/20 text-red-300 border border-red-700"}`,children:b.message})]}),e.jsxs("div",{className:`${et.layout.containers.panel} ${u} p-6 mt-6 text-slate-200`,children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"âš™ï¸ Equipamentos"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Armas"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["mainHand","offHand"].map(P=>{const M=P==="mainHand"?d.inventory.equippedMainHand:d.inventory.equippedOffHand,C=M?Ee.find(A=>A.id===M):void 0;return e.jsxs("div",{onDrop:$(P),onDragOver:X,className:`h-20 rounded border flex items-center justify-center text-sm ${M?j(C==null?void 0:C.rarity):"border-dashed border-slate-600 bg-slate-800"}`,title:M?F(M):P==="mainHand"?"Arraste arma (mÃ£o principal)":"Arraste arma (mÃ£o secundÃ¡ria)",children:[M?e.jsxs("button",{onClick:()=>{i(d.id,M)&&f({message:"Desequipado.",type:"success"})},className:"px-2 py-1 bg-slate-700 text-white rounded",children:[C==null?void 0:C.icon," ",C==null?void 0:C.name]}):e.jsx("span",{className:"text-slate-400",children:P==="mainHand"?"MÃ£o Principal":"MÃ£o SecundÃ¡ria"}),M&&e.jsx("div",{className:"mt-1 w-full px-2",children:e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:N(M)}).map((A,O)=>{var ae;const I=(((ae=d.inventory.equippedJewelsByItemId)==null?void 0:ae[M])||[])[O];return e.jsx("div",{onDrop:ne=>{ne.preventDefault();const U=ne.dataTransfer.getData("application/jewel");if(U){const R=o(d.id,M,U);f(R?{message:"Joia engastada.",type:"success"}:{message:"NÃ£o foi possÃ­vel engastar.",type:"error"}),setTimeout(()=>f(null),1500)}},onDragOver:X,className:`h-6 w-6 rounded-full border ${I?"border-violet-600 bg-violet-900/20":"border-slate-600 bg-slate-900"} flex items-center justify-center text-[10px]`,title:I?T(I):"Solte joia aqui",children:I?e.jsx("button",{onClick:()=>{const ne=c(d.id,M,O);f(ne?{message:"Joia removida.",type:"success"}:{message:"Falha ao remover.",type:"error"}),setTimeout(()=>f(null),1200)},className:"text-slate-200",children:"Ã—"}):e.jsx("span",{className:"text-slate-500",children:"â€¢"})},O)})})})]},P)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Armadura"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[["helm",d.inventory.equippedHelm,"Helmo"],["chest",d.inventory.equippedChest,"Armadura"],["belt",d.inventory.equippedBelt,"Cintura"],["gloves",d.inventory.equippedGloves,"Luvas"],["boots",d.inventory.equippedBoots,"Botas"],["cape",d.inventory.equippedCape,"Asa/Capa"]].map(([P,M,C])=>{const A=M?Ee.find(O=>O.id===M):void 0;return e.jsxs("div",{onDrop:$(P),onDragOver:X,className:`h-20 rounded border flex items-center justify-center text-sm ${M?j(A==null?void 0:A.rarity):"border-dashed border-slate-600 bg-slate-800"}`,title:M?F(M):`Arraste ${C} aqui`,children:[M?e.jsxs("button",{onClick:()=>{i(d.id,M)&&f({message:"Desequipado.",type:"success"})},className:"px-2 py-1 bg-slate-700 text-white rounded",children:[A==null?void 0:A.icon," ",A==null?void 0:A.name]}):e.jsx("span",{className:"text-slate-400",children:C}),M&&e.jsx("div",{className:"mt-1 w-full px-2",children:e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:N(M)}).map((O,S)=>{var ne;const ae=(((ne=d.inventory.equippedJewelsByItemId)==null?void 0:ne[M])||[])[S];return e.jsx("div",{onDrop:U=>{U.preventDefault();const R=U.dataTransfer.getData("application/jewel");if(R){const L=o(d.id,M,R);f(L?{message:"Joia engastada.",type:"success"}:{message:"NÃ£o foi possÃ­vel engastar.",type:"error"}),setTimeout(()=>f(null),1500)}},onDragOver:X,className:`h-6 w-6 rounded-full border ${ae?"border-violet-600 bg-violet-900/20":"border-slate-600 bg-slate-900"} flex items-center justify-center text-[10px]`,title:ae?T(ae):"Solte joia aqui",children:ae?e.jsx("button",{onClick:()=>{const U=c(d.id,M,S);f(U?{message:"Joia removida.",type:"success"}:{message:"Falha ao remover.",type:"error"}),setTimeout(()=>f(null),1200)},className:"text-slate-200",children:"Ã—"}):e.jsx("span",{className:"text-slate-500",children:"â€¢"})},S)})})})]},P)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"AcessÃ³rios"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[["ringLeft",d.inventory.equippedRingLeft,"Anel (esq.)"],["ringRight",d.inventory.equippedRingRight,"Anel (dir.)"],["necklace",d.inventory.equippedNecklace,"Colar"],["earringLeft",d.inventory.equippedEarringLeft,"Brinco (esq.)"],["earringRight",d.inventory.equippedEarringRight,"Brinco (dir.)"]].map(([P,M,C])=>{const A=M?Ee.find(O=>O.id===M):void 0;return e.jsxs("div",{onDrop:$(P),onDragOver:X,className:`h-20 rounded border flex items-center justify-center text-xs ${M?j(A==null?void 0:A.rarity):"border-dashed border-slate-600 bg-slate-800"}`,title:M?F(M):`Arraste ${C} aqui`,children:[M?e.jsxs("button",{onClick:()=>{i(d.id,M)&&f({message:"Desequipado.",type:"success"})},className:"px-2 py-1 bg-slate-700 text-white rounded",children:[A==null?void 0:A.icon," ",A==null?void 0:A.name]}):e.jsx("span",{className:"text-slate-400",children:C}),M&&e.jsx("div",{className:"mt-1 w-full px-2",children:e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:N(M)}).map((O,S)=>{var ne;const ae=(((ne=d.inventory.equippedJewelsByItemId)==null?void 0:ne[M])||[])[S];return e.jsx("div",{onDrop:U=>{U.preventDefault();const R=U.dataTransfer.getData("application/jewel");if(R){const L=o(d.id,M,R);f(L?{message:"Joia engastada.",type:"success"}:{message:"NÃ£o foi possÃ­vel engastar.",type:"error"}),setTimeout(()=>f(null),1500)}},onDragOver:X,className:`h-6 w-6 rounded-full border ${ae?"border-violet-600 bg-violet-900/20":"border-slate-600 bg-slate-900"} flex items-center justify-center text-[10px]`,title:ae?T(ae):"Solte joia aqui",children:ae?e.jsx("button",{onClick:()=>{const U=c(d.id,M,S);f(U?{message:"Joia removida.",type:"success"}:{message:"Falha ao remover.",type:"error"}),setTimeout(()=>f(null),1200)},className:"text-slate-200",children:"Ã—"}):e.jsx("span",{className:"text-slate-500",children:"â€¢"})},S)})})})]},P)})}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-16 rounded border border-slate-600 bg-slate-800 flex items-center justify-center text-xs",title:"Mascote ativo",children:e.jsxs("span",{className:"text-slate-300",children:["Mascote: ",((ee=(re=d.pets)==null?void 0:re.find(P=>P.id===d.activePetId))==null?void 0:ee.name)||"-"]})}),e.jsx("div",{className:"h-16 rounded border border-slate-600 bg-slate-800 flex items-center justify-center text-xs",title:"Montaria ativa",children:e.jsxs("span",{className:"text-slate-300",children:["Montaria: ",((_=(fe=d.mounts)==null?void 0:fe.find(P=>P.id===d.activeMountId))==null?void 0:_.name)||"-"]})})]})]})]}),e.jsx("div",{className:"text-xs text-slate-400 mt-3",children:"Arraste itens da lista e solte nos slots compatÃ­veis."})]}),e.jsx("div",{className:`${et.layout.containers.panel} ${u} p-4 text-slate-200`,children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-slate-300",children:"Tipo"}),e.jsxs("select",{value:p,onChange:P=>g(P.target.value),className:"px-2 py-1 border rounded text-sm bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"consumable",children:"ConsumÃ­vel"}),e.jsx("option",{value:"weapon",children:"Arma"}),e.jsx("option",{value:"armor",children:"Armadura"}),e.jsx("option",{value:"accessory",children:"AcessÃ³rio"}),e.jsx("option",{value:"material",children:"Material"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-slate-300",children:"Raridade"}),e.jsxs("select",{value:v,onChange:P=>y(P.target.value),className:"px-2 py-1 border rounded text-sm bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"todas",children:"Todas"}),e.jsx("option",{value:"comum",children:"Comum"}),e.jsx("option",{value:"incomum",children:"Incomum"}),e.jsx("option",{value:"raro",children:"Raro"}),e.jsx("option",{value:"epico",children:"Ã‰pico"}),e.jsx("option",{value:"lendario",children:"LendÃ¡rio"})]})]}),e.jsx("input",{type:"text",value:w,onChange:P=>k(P.target.value),placeholder:"Buscar por nome",className:"flex-1 min-w-0 sm:min-w-[200px] px-3 py-1 border rounded text-sm bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),e.jsx("button",{onClick:()=>{g("todos"),y("todas"),k("")},className:"px-3 py-1 rounded bg-slate-700 text-slate-100 hover:bg-slate-600 text-sm",children:"Limpar filtros"})]})}),e.jsx("div",{className:`${et.layout.containers.panel} ${u} p-6 mt-6 text-slate-200`,children:Y.length>0?e.jsx("div",{className:"space-y-3",children:Y.map(([P,M])=>{const C=Ee.find(I=>I.id===P);if(!C)return null;const A=Math.floor(C.price*.6),O=E[P]??1,S=C.type==="weapon"&&[d.inventory.equippedMainHand,d.inventory.equippedOffHand].includes(P)||C.type==="armor"&&[d.inventory.equippedHelm,d.inventory.equippedChest,d.inventory.equippedBelt,d.inventory.equippedGloves,d.inventory.equippedBoots,d.inventory.equippedCape].includes(P)||C.type==="accessory"&&[d.inventory.equippedRingLeft,d.inventory.equippedRingRight,d.inventory.equippedNecklace,d.inventory.equippedEarringLeft,d.inventory.equippedEarringRight].includes(P);return e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 border border-slate-700 p-3 rounded",draggable:!0,onDragStart:I=>te(I,P),title:F(P),children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-2xl",children:C.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-100",children:C.name}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Qtd: ",M," â€¢ PreÃ§o venda: ",A," ouro/un"]}),S&&e.jsxs("div",{className:"text-xs text-emerald-300",children:["Equipado"," ",(()=>{var ae;const I=((ae=d.inventory.upgrades)==null?void 0:ae[P])??0;return I>0?`â€¢ Aprimorado +${I}`:""})()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[C.type==="consumable"?e.jsx("button",{onClick:()=>{const I=r(d.id,P);f(I?{message:`Consumido: ${C.name}. Efeito aplicado.`,type:"success"}:{message:`NÃ£o foi possÃ­vel consumir ${C.name}.`,type:"error"}),setTimeout(()=>f(null),1800)},disabled:M<=0,className:`px-3 py-2 rounded text-white ${M<=0?"bg-slate-500 cursor-not-allowed":"bg-violet-600 hover:bg-violet-700"}`,children:"Usar"}):S?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{const I=i(d.id,P);f(I?{message:`Desequipado: ${C.name}. Atributos atualizados.`,type:"success"}:{message:`NÃ£o foi possÃ­vel desequipar ${C.name}.`,type:"error"}),setTimeout(()=>f(null),1800)},className:"px-3 py-2 rounded text-white bg-slate-700 hover:bg-slate-800",children:"Desequipar"}),(C.type==="weapon"||C.type==="armor"||C.type==="accessory")&&e.jsx("button",{onClick:()=>{var ne;const I=n(d.id,P),ae=(((ne=d.inventory.upgrades)==null?void 0:ne[P])??0)+(I?1:0);f(I?{message:`Aprimorado: ${C.name} para +${ae}.`,type:"success"}:{message:`NÃ£o foi possÃ­vel aprimorar ${C.name}. Ouro insuficiente?`,type:"error"}),setTimeout(()=>f(null),2e3)},className:"px-3 py-2 rounded text-white bg-amber-600 hover:bg-amber-700",children:"Aprimorar"})]}):e.jsx("button",{onClick:()=>{const I=s(d.id,P);f(I?{message:`Equipado: ${C.name}. Atributos atualizados.`,type:"success"}:{message:`NÃ£o foi possÃ­vel equipar ${C.name}.`,type:"error"}),setTimeout(()=>f(null),1800)},className:"px-3 py-2 rounded text-white bg-indigo-600 hover:bg-indigo-700",children:"Equipar"}),e.jsx("input",{type:"number",min:1,max:M,value:O,onChange:I=>G(P,Number(I.target.value),M),className:"w-16 sm:w-20 px-2 py-1 border rounded bg-slate-900 border-slate-600 text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":`Quantidade para vender ${C.name}`}),e.jsxs("div",{className:"text-sm text-slate-300",children:["Total: ",A*Math.max(1,Math.min(M,O))," ouro"]}),e.jsx("button",{onClick:()=>{const I=Math.max(1,Math.min(M,O)),ae=t(d.id,P,I),ne=A*Math.max(1,Math.min(M,O));f(ae?{message:`Vendido: ${I}x ${C.name} por ${ne} ouro.`,type:"success"}:{message:`NÃ£o foi possÃ­vel vender ${C.name}.`,type:"error"}),setTimeout(()=>f(null),1800)},disabled:S,className:`px-4 py-2 rounded text-white ${S?"bg-slate-500 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-700"}`,title:S?"Item equipado â€” desequipe para vender":"Vender quantidade selecionada",children:"Vender"})]})]},P)})}):e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx("div",{className:"text-3xl sm:text-5xl mb-2",children:"ğŸ“¦"}),e.jsx("p",{children:"Nenhum item corresponde aos filtros."})]})}),e.jsxs("div",{className:`${et.layout.containers.panel} ${u} p-6 mt-6 text-slate-200`,children:[e.jsx("h2",{className:"text-xl font-bold mb-3",children:"ğŸ’ Joias"}),Object.entries(d.inventory.jewels||{}).length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:Object.entries(d.inventory.jewels||{}).map(([P,M])=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 border border-slate-700 p-2 rounded",draggable:!0,onDragStart:C=>D(C,P),title:T(P),children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-slate-100",children:T(P)}),e.jsxs("div",{className:"text-slate-400",children:["Qtd: ",M]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>{const C=l(d.id,P);f(C?{message:"FusÃ£o realizada.",type:"success"}:{message:"Falha na fusÃ£o.",type:"error"}),setTimeout(()=>f(null),1600)},className:"px-3 py-1 rounded bg-violet-600 text-white hover:bg-violet-700",disabled:(M||0)<2,children:"Fundir"})})]},P))}):e.jsx("div",{className:"text-slate-400",children:"Nenhuma joia. Obtenha joias e arraste sobre os sockets dos itens equipados."}),e.jsx("div",{className:"text-xs text-slate-400 mt-2",children:"Arraste uma joia para um equipamento equipado para engastar. Funda 2 joias iguais para subir de nÃ­vel."})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-3",children:"ğŸ’"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"InventÃ¡rio"}),e.jsx("p",{className:"text-gray-600",children:"Selecione ou crie um herÃ³i para acessar o inventÃ¡rio."}),e.jsx("div",{className:"mt-4",children:e.jsx("a",{href:"/create",className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Criar HerÃ³i"})})]})})},ya=({label:a,value:s})=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-300",children:a}),e.jsx("span",{className:"text-gray-100 font-medium",children:s})]}),nm=({petId:a,onClose:s})=>{var l,d;const{getSelectedHero:t,setActivePet:r}=Z(),i=t(),n=(l=i==null?void 0:i.pets)==null?void 0:l.find(m=>m.id===a),o=Wt(),c=((i==null?void 0:i.hatchHistory)||[]).find(m=>m.petId===a);return n?e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-amber-500 bg-slate-900 p-5 text-white",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ£"}),e.jsx("div",{className:"text-xl font-bold",children:"Mascote Eclodido!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ya,{label:"Nome",value:n.name}),e.jsx(ya,{label:"Tipo",value:n.type}),e.jsx(ya,{label:"Classe",value:n.petClass}),e.jsx(ya,{label:"Raridade",value:n.rarity}),typeof(c==null?void 0:c.hatchCost)=="number"&&e.jsx(ya,{label:"Custo gasto",value:`${c.hatchCost} ouro`}),((d=n.mutation)==null?void 0:d.variant)&&e.jsx(ya,{label:"MutaÃ§Ã£o",value:n.mutation.variant}),n.exclusiveSkill&&e.jsx(ya,{label:"Habilidade",value:n.exclusiveSkill}),e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:["Qualidade: ",n.qualityRoll,"% â€¢ NÃ­vel: ",n.level," â€¢ EstÃ¡gio: ",n.stage.replace("_"," ")]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>{r(n.id),s()},className:"px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-700",children:"Tornar Ativo"}),e.jsx("button",{onClick:()=>{s(),o("/meus")},className:"px-3 py-2 rounded bg-purple-600 hover:bg-purple-700",children:"Ver Mascotes"}),e.jsx("button",{onClick:()=>{s(),o("/pets")},className:"px-3 py-2 rounded bg-amber-600 hover:bg-amber-700",children:"Ir Ã  CÃ¢mara"}),e.jsx("button",{onClick:s,className:"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600",children:"Fechar"})]})]})}):null},om=a=>{if(!a)return"";const s=new Date(a).getTime(),t=Math.max(0,s-Date.now()),r=Math.floor(t/36e5),i=Math.floor(t%36e5/6e4),n=Math.floor(t%6e4/1e3);return r>0?`${r}h ${i}m ${n}s`:i>0?`${i}m ${n}s`:`${n}s`},ls=({active:a,onClick:s,label:t,icon:r})=>e.jsxs("button",{onClick:s,className:`px-3 py-2 rounded border ${a?"bg-amber-600 text-white border-amber-500":"bg-gray-800 border-gray-700 text-gray-200"} hover:bg-amber-700 transition-colors`,children:[r," ",t]}),Ri=({egg:a,onIdentify:s,onIncubate:t,onAccelerateEssencia:r,onAccelerateBrasas:i,onAccelerateGold:n,onHatch:o,inventory:c,gold:l})=>{var g;const d=om(a.incubationEndsAt),m=cn[a.baseRarity],p={comum:5,incomum:10,raro:20,epico:50,lendario:100,mistico:200}[String(((g=a.identified)==null?void 0:g.rarity)||a.baseRarity)]||0;return e.jsxs("div",{className:"p-4 rounded-lg bg-slate-800 border border-slate-700 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold",children:a.name}),e.jsxs("div",{className:"text-xs text-amber-300",children:["Raridade: ",a.baseRarity]})]}),e.jsx("div",{className:"text-xs text-gray-300",children:a.description}),e.jsxs("div",{className:"text-sm",children:["Status: ",e.jsx("span",{className:"font-medium",children:a.status}),a.status==="identificado"&&a.identified&&e.jsxs("span",{className:"ml-2 text-gray-300",children:["â€¢ ",a.identified.type," â€¢ ",a.identified.petClass," â€¢ Chance de habilidade ",a.identified.skillChancePercent,"%"]}),a.status==="incubando"&&a.incubatingSlot!==void 0&&e.jsxs("span",{className:"ml-2 text-gray-300",children:["â€¢ Slot ",a.incubatingSlot+1," â€¢ Fim em ",d]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[a.status==="misterioso"&&e.jsxs("button",{onClick:s,className:"px-3 py-1 rounded bg-indigo-600 hover:bg-indigo-700 text-white text-sm",children:["ğŸ”® Identificar (",m.min,"â€“",m.max," ouro)"]}),a.status==="identificado"&&(()=>{var w;const y=(((w=Z.getState().getSelectedHero())==null?void 0:w.eggs)||[]).filter(k=>k.status==="incubando"&&typeof k.incubatingSlot=="number").length>=3;return e.jsx("button",{onClick:t,disabled:y,className:`px-3 py-1 rounded text-white text-sm ${y?"bg-gray-700 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"}`,children:"ğŸª½ Incubar"})})(),a.status==="incubando"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:!c["essencia-calor"],onClick:r,className:`px-3 py-1 rounded ${c["essencia-calor"]?"bg-red-600 hover:bg-red-700":"bg-gray-700"} text-white text-sm`,children:"ğŸ”¥ EssÃªncia (-15m)"}),e.jsx("button",{disabled:!c["brasas-magicas"],onClick:i,className:`px-3 py-1 rounded ${c["brasas-magicas"]?"bg-orange-600 hover:bg-orange-700":"bg-gray-700"} text-white text-sm`,children:"â™¨ï¸ Brasas (-1h)"}),e.jsx("button",{onClick:()=>n(50),className:"px-3 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm",children:"ğŸ’° Acelerar com Ouro"})]}),(a.status==="pronto_para_chocar"||a.status==="incubando")&&e.jsx("button",{onClick:o,disabled:(()=>{const v=Z.getState().getSelectedHero();if(!v||!v.hatchCooldownEndsAt)return!1;const y=Date.now()<new Date(v.hatchCooldownEndsAt).getTime(),w=(v.progression.gold||0)<p;return y||w})(),className:`px-3 py-1 rounded text-white text-sm ${(()=>{const v=Z.getState().getSelectedHero(),y=(v==null?void 0:v.hatchCooldownEndsAt)&&Date.now()<new Date(v.hatchCooldownEndsAt).getTime(),w=v?(v.progression.gold||0)<p:!1;return y||w?"bg-gray-700 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-700"})()}`,children:"ğŸ£ Chocar"}),(a.status==="pronto_para_chocar"||a.status==="incubando")&&(()=>{const v=Z.getState().getSelectedHero(),y=v!=null&&v.hatchCooldownEndsAt?Math.max(0,new Date(v.hatchCooldownEndsAt).getTime()-Date.now()):0,w=y>0?`${Math.ceil(y/1e3)}s`:"",k=(v==null?void 0:v.progression.gold)||0,E=y>0?Math.max(0,Math.min(100,Math.round(y/300))):0;return e.jsxs("div",{className:"text-xs text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-amber-300",children:["Custo: ",p," ouro"]}),w&&e.jsxs("span",{children:["CD: ",w]}),k<p&&e.jsx("span",{className:"text-red-300",children:"Ouro insuficiente"})]}),y>0&&e.jsx("div",{className:"w-40 bg-gray-700 rounded-full h-1.5 mt-1",children:e.jsx("div",{className:"h-1.5 rounded-full bg-amber-500",style:{width:`${E}%`}})})]})})(),(a.status==="pronto_para_chocar"||a.status==="incubando")&&(()=>{var b;const v={comum:5,incomum:10,raro:20,epico:50,lendario:100,mistico:200},y=String(((b=a.identified)==null?void 0:b.rarity)||a.baseRarity),w=v[y]||0,k=Z.getState().getSelectedHero(),E=k!=null&&k.hatchCooldownEndsAt?Math.max(0,new Date(k.hatchCooldownEndsAt).getTime()-Date.now()):0,h=E>0?`${Math.ceil(E/1e3)}s`:"";return e.jsxs("div",{className:"text-xs text-gray-300 flex items-center gap-2",children:[e.jsxs("span",{className:"text-amber-300",children:["Custo: ",w," ouro"]}),h&&e.jsxs("span",{children:["CD: ",h]})]})})()]})]})},cm=({pet:a,onTrain:s,onSoulStone:t,onFeedBasic:r,onFeedDeluxe:i,onSetActive:n,onRename:o,onRefine:c,onSuggestMission:l,onSell:d,inventory:m,isActive:u})=>{var p;return e.jsxs("div",{className:"p-4 rounded-lg bg-slate-800 border border-slate-700 flex flex-col gap-2 overflow-hidden clip-container",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"font-semibold",children:[a.name," ",u&&e.jsx("span",{className:"ml-2 text-xs bg-emerald-700 text-white px-2 py-1 rounded",children:"Ativo"})," ",((p=a.mutation)==null?void 0:p.visualBadge)&&e.jsx("span",{className:"ml-1",children:a.mutation.visualBadge})]}),e.jsxs("div",{className:"text-xs text-amber-300",children:[a.type," â€¢ ",a.petClass," â€¢ ",a.rarity??"comum"]})]}),e.jsxs("div",{className:"text-sm",children:["NÃ­vel ",a.level," â€¢ EstÃ¡gio: ",a.stage.replace("_"," ")]}),a.exclusiveSkill&&e.jsxs("div",{className:"text-xs text-emerald-300",children:["Skill Exclusiva: ",a.exclusiveSkill]}),e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-amber-300 text-[10px]",children:"Energia"}),e.jsxs("span",{className:"text-gray-300 text-[10px]",children:[Math.max(0,Math.min(100,a.energy||0)),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:"h-1.5 rounded-full bg-amber-500",style:{width:`${Math.max(0,Math.min(100,a.energy||0))}%`}})}),a.exclusiveSkill&&e.jsx("div",{className:"mt-1 text-xs",children:(()=>{const v={"Instinto Feral":8,"Pulso Arcano":10,"Aura Sagrada":9,"Sussurro Sombrio":12}[a.exclusiveSkill]||8,y=(a.energy||0)>=v;return e.jsx("span",{className:`px-2 py-0.5 rounded ${y?"bg-green-700 text-white":"bg-gray-700 text-gray-300"}`,children:y?"Skill pronta":"Skill indisponÃ­vel"})})()})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 clearfix min-w-0",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm",children:"ğŸ– Treinar (+100 XP)"}),e.jsx("button",{disabled:!m["pedra-alma"],onClick:t,className:`px-3 py-1 rounded ${m["pedra-alma"]?"bg-violet-600 hover:bg-violet-700":"bg-gray-700"} text-white text-sm`,children:"ğŸª¨ Pedra de Alma (+300 XP)"}),e.jsx("button",{disabled:!m["racao-basica"],onClick:r,className:`px-3 py-1 rounded ${m["racao-basica"]?"bg-orange-600 hover:bg-orange-700":"bg-gray-700"} text-white text-sm`,children:"ğŸ– RaÃ§Ã£o (+50 XP)"}),e.jsx("button",{disabled:!m["racao-deluxe"],onClick:i,className:`px-3 py-1 rounded ${m["racao-deluxe"]?"bg-amber-600 hover:bg-amber-700":"bg-gray-700"} text-white text-sm`,children:"ğŸ— RaÃ§Ã£o Deluxe (+150 XP)"}),e.jsx("button",{onClick:n,className:"px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-700 text-white text-sm",children:"â­ Tornar Ativo"}),e.jsx("button",{disabled:!m["essencia-vinculo"]&&!m["pedra-magica"],onClick:c,className:`px-3 py-1 rounded ${m["essencia-vinculo"]||m["pedra-magica"]?"bg-indigo-600 hover:bg-indigo-700":"bg-gray-700"} text-white text-sm`,children:"ğŸ”— Refinar VÃ­nculo (+1%)"}),l&&!(m["essencia-vinculo"]||m["pedra-magica"])&&e.jsx("button",{"aria-label":"Sugerir MissÃ£o",onClick:l,className:"px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-700 active:brightness-90 text-white text-sm",children:"ğŸ¾ Sugerir MissÃ£o"}),d&&e.jsx("button",{"aria-label":"Vender Mascote",onClick:d,className:"px-3 py-1 rounded bg-green-700 hover:bg-green-800 active:brightness-90 text-white text-sm",children:"ğŸ’¸ Vender Mascote"}),e.jsx("button",{disabled:!m["tonico-companheiro"],onClick:()=>{if(m["tonico-companheiro"]&&consumeInventoryItem(Z.getState().getSelectedHero().id,"tonico-companheiro",1)){const g=Z.getState().getSelectedHero();Z.getState().updateHero(g.id,{pets:(g.pets||[]).map(v=>v.id===a.id?{...v,energy:Math.min(100,(v.energy||0)+50)}:v)})}},className:`px-3 py-1 rounded ${m["tonico-companheiro"]?"bg-yellow-600 hover:bg-yellow-700":"bg-gray-700"} text-white text-sm`,children:"âš¡ TÃ´nico de Energia (+50)"})]}),(()=>{const v=(m["essencia-vinculo"]||0)>0||(m["pedra-magica"]||0)>0?1:0,y=Math.round(v/1*100);return e.jsx("div",{className:"mt-1 w-full bg-gray-700 rounded h-2",children:e.jsx("div",{className:"h-2 bg-indigo-500",style:{width:`${y}%`}})})})(),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap min-w-0",children:[e.jsx("input",{type:"text",placeholder:"Renomear",className:"px-2 py-1 rounded bg-slate-700 text-white text-sm",onKeyDown:g=>{g.key==="Enter"&&o(g.target.value)}}),e.jsx("span",{className:"text-xs text-gray-300",children:"Pressione Enter para salvar"})]})]})},lm=()=>{const{getSelectedHero:a,generateEggForSelected:s,identifyEggForSelected:t,startIncubationForSelected:r,accelerateIncubationForSelected:i,hatchEggForSelected:n,consumeInventoryItem:o,addPetXPForSelected:c,setActivePet:l,updateHero:d,refinePetForSelected:m,suggestCompanionQuestForSelected:u}=Z(),p=a(),g=ua(),v=Wt(),[y,w]=x.useState("ovos"),[k,E]=x.useState(null),[h,b]=x.useState(null),[f,j]=x.useState("todos"),[N,T]=x.useState(null),[F,te]=x.useState(0),[D,$]=x.useState(null),[X,Q]=x.useState(!1);if(x.useEffect(()=>{const R=setInterval(()=>{var L,oe;(oe=(L=Z.getState()).updateIncubationTick)==null||oe.call(L)},1e3);return()=>clearInterval(R)},[]),x.useEffect(()=>{try{const L=new URLSearchParams(g.search).get("hatchNext"),oe=p.eggs||[];if(L&&oe.length>0){const K=oe.find(xe=>xe.status==="pronto_para_chocar");K&&T(K.id),v("/pets",{replace:!0})}}catch{}},[g.search]),!p)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ¾"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar Mascotes."})]});const Y=p.eggs||[],G=(p.pets||[]).filter(Boolean).map(R=>({...R,rarity:R.rarity??"comum"})),J=p.inventory.items||{},re=["mistico","lendario","epico","raro","incomum","comum"],ee=["pronto_para_chocar","incubando","identificado","misterioso"],fe=[...Y].sort((R,L)=>{var B,se;const oe=ee.indexOf(R.status),K=ee.indexOf(L.status);if(oe!==K)return oe-K;const xe=re.indexOf(String(((B=R.identified)==null?void 0:B.rarity)||R.baseRarity)),W=re.indexOf(String(((se=L.identified)==null?void 0:se.rarity)||L.baseRarity));return xe-W}),_=(()=>{const R={comum:0,incomum:0,raro:0,epico:0,lendario:0,mistico:0};return Y.forEach(L=>{var K;const oe=String(((K=L.identified)==null?void 0:K.rarity)||L.baseRarity);R[oe]=(R[oe]||0)+1}),R})(),P=(()=>{const R=p.hatchHistory||[],L=R.length;let oe=0,K=0;const xe={comum:0,incomum:0,raro:0,epico:0,lendario:0,mistico:0},W=Date.now(),B={total:0,mutations:0,cost:0},se={total:0,mutations:0,cost:0};R.forEach(he=>{var de,ve,Ae;const H=G.find(Te=>Te.id===he.petId),me=new Date(he.timestamp).getTime();H&&(xe[String(H.rarity??"comum")]=(xe[String(H.rarity??"comum")]||0)+1,(de=H.mutation)!=null&&de.variant&&oe++),typeof he.hatchCost=="number"&&(K+=he.hatchCost),W-me<=7*24*60*60*1e3&&(B.total+=1,(ve=H==null?void 0:H.mutation)!=null&&ve.variant&&(B.mutations+=1),typeof he.hatchCost=="number"&&(B.cost+=he.hatchCost)),W-me<=30*24*60*60*1e3&&(se.total+=1,(Ae=H==null?void 0:H.mutation)!=null&&Ae.variant&&(se.mutations+=1),typeof he.hatchCost=="number"&&(se.cost+=he.hatchCost))});const z=L>0?Math.round(oe/L*100):0,V=B.total>0?Math.round(B.mutations/B.total*100):0,ie=se.total>0?Math.round(se.mutations/se.total*100):0;return{total:L,counts:xe,rate:z,totalCost:K,last7:B,last30:se,rate7:V,rate30:ie}})(),M=(()=>{const R=p.hatchHistory||[];if(f==="todos")return R;const L=["comum","incomum","raro","epico","lendario","mistico"],oe=L.indexOf(f);return R.filter(K=>{const xe=G.find(W=>W.id===K.petId);return xe?L.indexOf(xe.rarity??"comum")>=oe:!1})})(),C=[void 0,void 0,void 0];Y.filter(R=>R.status==="incubando").forEach(R=>{typeof R.incubatingSlot=="number"&&(C[R.incubatingSlot]=R)});const A=R=>t(R),O=(R,L)=>r(R,L),S=R=>{o(p.id,"essencia-calor",1)&&i(R,"essencia")},I=R=>{o(p.id,"brasas-magicas",1)&&i(R,"brasas")},ae=(R,L)=>i(R,"ouro",L),ne=async R=>{T(R)},U=()=>{const R=N;Z.getState().getSelectedHero()&&F>0&&Z.getState().accelerateHatchCooldownForSelected(F),T(null),te(0),E(R),setTimeout(()=>{n(R);const oe=Z.getState().getSelectedHero();if(oe){Z.getState().updateHero(oe.id,{eggs:(oe.eggs||[]).filter(xe=>xe.id!==R)});const K=(oe.hatchHistory||[]).slice(-1)[0];K!=null&&K.petId&&b(K.petId)}E(null)},1200)};return e.jsxs("div",{className:"max-w-6xl mx-auto clip-container overflow-hidden",children:[e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsx(ls,{active:y==="ovos",onClick:()=>w("ovos"),label:"InventÃ¡rio de Ovos",icon:"ğŸ¥š"}),e.jsx(ls,{active:y==="camara",onClick:()=>w("camara"),label:"CÃ¢mara de EclosÃ£o",icon:"ğŸª½"}),e.jsx(ls,{active:y==="meus",onClick:()=>w("meus"),label:"Meus Mascotes",icon:"ğŸ¾"}),e.jsx(ls,{active:y==="historico",onClick:()=>w("historico"),label:"HistÃ³rico de EclosÃµes",icon:"ğŸ“œ"}),e.jsxs("label",{className:"ml-auto flex items-center gap-1 text-xs text-gray-300",children:[e.jsx("input",{type:"checkbox",onChange:R=>{try{localStorage.setItem("auto_accept_companion_mission",R.target.checked?"1":"0"),p!=null&&p.id&&trackMetric.featureUsed(p.id,`pref:auto_accept_companion_mission:${R.target.checked?"on":"off"}`)}catch{}},defaultChecked:(()=>{try{return localStorage.getItem("auto_accept_companion_mission")==="1"}catch{return!1}})()})," Aceitar missÃ£o sugerida"]})]}),y==="ovos"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Ovos"}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Capacidade: ",Y.length,"/30"]}),(()=>{const R=p.hatchCooldownEndsAt?Math.max(0,new Date(p.hatchCooldownEndsAt).getTime()-Date.now()):0;if(R>0){const L=Math.max(0,Math.min(100,Math.round(R/300)));return e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Cooldown de Chocagem: ",Math.ceil(R/1e3),"s"]}),e.jsx("div",{className:"w-40 bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:"h-1.5 rounded-full bg-amber-500",style:{width:`${L}%`}})})]})}return null})()]})}),e.jsx("div",{className:"flex justify-end mb-2",children:(()=>{var he,H;const R=fe.filter(me=>me.status==="pronto_para_chocar");if(R.length===0)return null;const L=R[0],K={comum:5,incomum:10,raro:20,epico:50,lendario:100,mistico:200}[String(((he=L.identified)==null?void 0:he.rarity)||L.baseRarity)]||0,xe=p.hatchCooldownEndsAt?Math.max(0,new Date(p.hatchCooldownEndsAt).getTime()-Date.now()):0,W=p.progression.gold||0,B=xe>0||W<K,se=String(((H=L.identified)==null?void 0:H.rarity)||L.baseRarity),z=["epico","lendario","mistico"].includes(se),V=B?"bg-gray-700 cursor-not-allowed":z?"bg-gradient-to-r from-amber-600 to-emerald-600 hover:brightness-110":"bg-amber-600 hover:bg-amber-700",ie=z?"ğŸ£â­ Chocar PrÃ³ximo":"ğŸ£ Chocar PrÃ³ximo";return e.jsx("button",{onClick:()=>T(L.id),disabled:B,className:`px-3 py-2 rounded text-white text-sm ${V}`,children:ie})})()}),e.jsx("div",{className:"text-xs text-gray-300 flex flex-wrap gap-2",children:Object.entries(_).map(([R,L])=>e.jsxs("span",{className:"px-2 py-1 rounded bg-slate-800 border border-slate-700",children:[R,": ",L]},R))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[Y.length===0&&e.jsx("div",{className:"text-gray-400",children:"Nenhum ovo ainda. Explore missÃµes e dungeons para encontrar ovos!"}),fe.map(R=>e.jsx(Ri,{egg:R,inventory:J,gold:p.progression.gold,onIdentify:()=>A(R.id),onIncubate:()=>O(R.id),onAccelerateEssencia:()=>S(R.id),onAccelerateBrasas:()=>I(R.id),onAccelerateGold:L=>ae(R.id,L),onHatch:()=>ne(R.id)},R.id))]})]}),y==="camara"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-bold",children:"CÃ¢mara de EclosÃ£o"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[0,1,2].map(R=>e.jsxs("div",{className:"p-4 rounded-lg bg-slate-900 border border-slate-700",children:[e.jsxs("div",{className:"font-semibold mb-2",children:["Slot ",R+1]}),C[R]?e.jsx(Ri,{egg:C[R],inventory:J,gold:p.progression.gold,onIdentify:()=>{},onIncubate:()=>{},onAccelerateEssencia:()=>S(C[R].id),onAccelerateBrasas:()=>I(C[R].id),onAccelerateGold:L=>ae(C[R].id,L),onHatch:()=>ne(C[R].id)}):e.jsx("div",{className:"text-gray-400 text-sm",children:"Vazio. Selecione um ovo identificado para incubar."})]},R))}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-sm text-gray-300",children:"ElegÃ­veis para incubaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-2",children:[Y.filter(R=>R.status==="identificado").map(R=>{var L,oe,K;return e.jsxs("div",{className:"p-3 rounded bg-slate-800 border border-slate-700 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:R.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[(L=R.identified)==null?void 0:L.type," â€¢ ",(oe=R.identified)==null?void 0:oe.petClass," â€¢ ",(K=R.identified)==null?void 0:K.rarity]})]}),e.jsx("button",{onClick:()=>O(R.id),className:"px-3 py-1 rounded bg-purple-600 hover:bg-purple-700 text-white text-sm",children:"Incubar"})]},R.id)}),Y.filter(R=>R.status==="identificado").length===0&&e.jsx("div",{className:"text-gray-400",children:"Nenhum ovo identificado no momento."})]})]})]}),y==="meus"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Meus Mascotes"}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Capacidade: ",G.length,"/50"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[G.length===0&&e.jsx("div",{className:"text-gray-400",children:"Nenhum mascote ainda. Incube e choque ovos para obter companheiros!"}),G.map(R=>e.jsx(cm,{pet:R,inventory:J,onTrain:()=>c(R.id,100),onSoulStone:()=>{o(p.id,"pedra-alma",1)&&c(R.id,300)},onFeedBasic:()=>{o(p.id,"racao-basica",1)&&(c(R.id,50),d(p.id,{pets:(p.pets||[]).map(L=>L.id===R.id?{...L,energy:Math.min(100,(L.energy||0)+10)}:L)}))},onFeedDeluxe:()=>{o(p.id,"racao-deluxe",1)&&(c(R.id,150),d(p.id,{pets:(p.pets||[]).map(L=>L.id===R.id?{...L,energy:Math.min(100,(L.energy||0)+30)}:L)}))},onSetActive:()=>l(R.id),onRename:L=>d(p.id,{pets:(p.pets||[]).map(oe=>oe.id===R.id?{...oe,name:L}:oe)}),isActive:p.activePetId===R.id,onRefine:()=>m(R.id),onSuggestMission:()=>{var oe,K,xe,W;if(u())try{(K=(oe=window.notificationBus)==null?void 0:oe.emit)==null||K.call(oe,{type:"quest",title:"MissÃ£o sugerida",message:"Uma missÃ£o de companheiros foi adicionada ao quadro",icon:"ğŸ¾",duration:2500})}catch{}else try{(W=(xe=window.notificationBus)==null?void 0:xe.emit)==null||W.call(xe,{type:"item",title:"Sem missÃ£o disponÃ­vel",message:"Nenhuma necessidade detectada para sugerir missÃ£o.",icon:"â„¹ï¸",duration:2e3})}catch{}},onSell:()=>$(R.id)},R.id))]})]}),y==="historico"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-bold",children:"HistÃ³rico de EclosÃµes"}),e.jsxs("div",{className:"text-xs text-gray-300 flex flex-wrap gap-2",children:[e.jsxs("span",{className:"px-2 py-1 rounded bg-slate-800 border border-slate-700",children:["Total: ",P.total]}),Object.entries(P.counts).map(([R,L])=>e.jsxs("span",{className:"px-2 py-1 rounded bg-slate-800 border border-slate-700",children:[R,": ",L]},`sum-${R}`)),e.jsxs("span",{className:"px-2 py-1 rounded bg-slate-800 border border-slate-700",children:["Taxa de mutaÃ§Ã£o: ",P.rate,"%"]}),e.jsxs("span",{className:"px-2 py-1 rounded bg-slate-800 border border-slate-700",children:["Custo total: ",P.totalCost," ouro"]})]}),e.jsxs("div",{className:"text-xs text-gray-300 flex flex-wrap gap-2",children:[e.jsxs("span",{className:"px-2 py-1 rounded bg-slate-800 border border-slate-700",children:["Ãšltimos 7 dias: ",P.last7.total," â€¢ MutaÃ§Ã£o ",P.rate7,"% â€¢ Custo ",P.last7.cost," ouro"]}),e.jsxs("span",{className:"px-2 py-1 rounded bg-slate-800 border border-slate-700",children:["Ãšltimos 30 dias: ",P.last30.total," â€¢ MutaÃ§Ã£o ",P.rate30,"% â€¢ Custo ",P.last30.cost," ouro"]})]}),e.jsxs("div",{className:"flex gap-2 items-center text-xs",children:[e.jsx("span",{className:"text-gray-300",children:"Filtrar:"}),["todos","raro","epico","lendario","mistico"].map(R=>e.jsx("button",{onClick:()=>j(R),className:`px-2 py-1 rounded ${f===R?"bg-amber-600 text-white":"bg-gray-700 text-gray-200"}`,children:R},R))]}),e.jsxs("div",{className:"space-y-2",children:[M.length===0&&e.jsx("div",{className:"text-gray-400",children:"Nenhuma eclosÃ£o registrada para este filtro."}),M.map(R=>{var L,oe;return e.jsxs("div",{className:"p-3 rounded bg-slate-800 border border-slate-700 text-sm text-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:["ğŸ£ Eclodiu em ",new Date(R.timestamp).toLocaleString()," â€¢ Mascote ",((L=(p.pets||[]).find(K=>K.id===R.petId))==null?void 0:L.name)||R.petId.slice(0,8)," â€¢ Raridade ",(oe=(p.pets||[]).find(K=>K.id===R.petId))==null?void 0:oe.rarity]}),(()=>{var xe;const K=(p.pets||[]).find(W=>W.id===R.petId);return(xe=K==null?void 0:K.mutation)!=null&&xe.variant?e.jsx("span",{className:"px-2 py-1 rounded bg-amber-700 text-white text-xs",children:"âœ¨ Mutado"}):null})()]},R.timestamp)})]})]}),e.jsx(oa,{children:k&&e.jsx(tt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:(()=>{var K,xe;const R=(p.eggs||[]).find(W=>W.id===k),L=(K=R==null?void 0:R.identified)==null?void 0:K.type,oe=L==="feral"?"from-emerald-700 to-emerald-900":L==="arcano"?"from-indigo-700 to-indigo-900":L==="sagrado"?"from-amber-600 to-amber-900":L==="sombrio"?"from-slate-800 to-black":"from-slate-800 to-slate-900";return e.jsxs(tt.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:`p-6 rounded-xl bg-gradient-to-br ${oe} border border-amber-500 text-center text-white`,children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ¥š"}),e.jsx("div",{className:"text-lg font-semibold mb-2",children:"O ovo estÃ¡ se movendo!"}),e.jsxs("div",{className:"text-sm opacity-90",children:["Rachadurasâ€¦ luzâ€¦ uma criatura ",((xe=R==null?void 0:R.identified)==null?void 0:xe.type)||"misteriosa"," emergeâ€¦"]})]})})()})}),N&&(()=>{var z,V;const R=Y.find(ie=>ie.id===N),oe={comum:5,incomum:10,raro:20,epico:50,lendario:100,mistico:200}[String(((z=R.identified)==null?void 0:z.rarity)||R.baseRarity)]||0,K=p.hatchCooldownEndsAt?Math.max(0,new Date(p.hatchCooldownEndsAt).getTime()-Date.now()):0,W=(p.progression.gold||0)<oe,B=Math.floor(F/10*60*1e3),se=K>0?Math.max(0,K-B):0;return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-amber-500 bg-slate-900 p-5 text-white",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Confirmar Chocagem"}),e.jsxs("div",{className:"text-sm text-gray-200",children:["Custo: ",oe," ouro"]}),K>0&&e.jsxs("div",{className:"text-sm text-gray-300 mt-1",children:["Cooldown ativo: ",Math.ceil(K/1e3),"s"]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-300",children:[e.jsxs("div",{children:["Ovo: ",R.name]}),e.jsxs("div",{children:["Raridade: ",String(((V=R.identified)==null?void 0:V.rarity)||R.baseRarity)]}),R.identified&&e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{children:["Tipo: ",R.identified.type," â€¢ Classe: ",R.identified.petClass]}),Array.isArray(R.identified.candidates)&&R.identified.candidates.length>0&&e.jsxs("div",{className:"mt-1",children:["PossÃ­veis mascotes: ",R.identified.candidates.join(", ")]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs text-gray-300",children:"Acelerar cooldown com ouro (10 ouro = 1 min)"}),e.jsx("input",{type:"number",min:0,value:F,onChange:ie=>te(Math.max(0,Number(ie.target.value))),className:"mt-1 w-full px-2 py-1 rounded bg-slate-800 border border-slate-700"}),F>0&&e.jsxs("div",{className:"mt-2 text-xs text-amber-300",children:["ReduÃ§Ã£o prevista: ",Math.floor(B/6e4)," min â€¢ Novo cooldown: ",Math.ceil(se/1e3),"s"]})]}),W&&e.jsx("div",{className:"mt-2 text-xs text-red-300",children:"Ouro insuficiente para chocar."}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{disabled:W,onClick:U,className:`px-3 py-2 rounded ${W?"bg-gray-700 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-700"}`,children:"Confirmar"}),e.jsx("button",{onClick:()=>{te(0),T(null)},className:"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600",children:"Cancelar"})]})]})})})(),D&&(()=>{var se;const R=(p.pets||[]).find(z=>z.id===D),oe={comum:100,incomum:200,raro:400,epico:800,lendario:1600,mistico:3e3}[String(R.rarity??"comum")]||100,K=Math.max(0,R.level||1)*20,xe=Math.max(0,R.refineLevel||0)*50,W=(se=R.mutation)!=null&&se.variant?200:0,B=oe+K+xe+W;return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-amber-500 bg-slate-900 p-5 text-white",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Confirmar Venda de Mascote"}),e.jsxs("div",{className:"text-sm text-gray-200",children:["VocÃª receberÃ¡ ",B," ouro por ",R.name,"."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:["Raridade: ",String(R.rarity??"comum")," â€¢ NÃ­vel ",R.level," â€¢ Refino ",R.refineLevel||0]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{"aria-busy":X,onClick:()=>{Q(!0),setTimeout(()=>{var z,V;try{Z.getState().sellPetForSelected(D),(V=(z=window.notificationBus)==null?void 0:z.emit)==null||V.call(z,{type:"gold",title:"Venda concluÃ­da",message:`${R.name} vendido por ${B} ouro.`,icon:"ğŸ’°",duration:3e3})}catch{}Q(!1),$(null)},600)},className:`px-3 py-2 rounded ${X?"bg-gray-700 cursor-wait":"bg-green-700 hover:bg-green-800"} text-white`,children:X?"Processandoâ€¦":"Confirmar"}),e.jsx("button",{onClick:()=>$(null),className:"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600",children:"Cancelar"})]})]})})})(),h&&e.jsx(nm,{petId:h,onClose:()=>b(null)})]})};crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString(),crypto.randomUUID(),new Date().toISOString();const dm=()=>{const{getSelectedHero:a,addMountToSelected:s,setActiveMount:t,evolveMountForSelected:r,refineCompanion:i,buyItem:n,setFavoriteMount:o,generateMountForSelected:c}=Z(),l=a(),[d,m]=x.useState("estagio"),[u,p]=x.useState(void 0),[g,v]=x.useState(void 0),[y,w]=x.useState("todos"),[k,E]=x.useState("todos"),[h,b]=x.useState("todos"),[f,j]=x.useState(""),[N,T]=x.useState(void 0),[F,te]=x.useState(0);if(x.useEffect(()=>{const _=setInterval(()=>te(P=>P+1),1e3);return()=>clearInterval(_)},[]),x.useEffect(()=>{const _=P=>{const M=(l==null?void 0:l.favoriteMountIds)||[];P.key==="1"&&M[0]&&t(M[0]),P.key==="2"&&M[1]&&t(M[1]),P.key==="3"&&M[2]&&t(M[2])};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[l==null?void 0:l.favoriteMountIds]),!l)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ‡"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar Montarias."})]});const D=l.mounts||[],$=l.activeMountId,X=l.inventory.items||{},Q=(X["pedra-magica"]||0)>0||(X["essencia-vinculo"]||0)>0,Y=(X["pergaminho-montaria"]||0)>0&&(l.progression.gold||0)>=200,G=x.useMemo(()=>{const _=[...D];if(d==="maestria")_.sort((P,M)=>Math.max(0,M.mastery||0)-Math.max(0,P.mastery||0));else if(d==="velocidade")_.sort((P,M)=>(M.speedBonus||0)-(P.speedBonus||0));else if(d==="raridade"){const P={comum:0,incomum:1,raro:2,epico:3,lendario:4,mistico:5};_.sort((M,C)=>P[C.rarity]-P[M.rarity]||M.name.localeCompare(C.name))}else if(d==="estagio"){const P={comum:0,encantada:1,lendaria:2};_.sort((M,C)=>P[C.stage]-P[M.stage]||M.name.localeCompare(C.name))}else _.sort((P,M)=>P.name.localeCompare(M.name));return _},[D,d]),J=x.useMemo(()=>{var C;if(!D.length)return;if(l!=null&&l.favoriteMountId&&D.some(A=>A.id===l.favoriteMountId))return l.favoriteMountId;const _={comum:0,encantada:1,lendaria:2},P={comum:0,incomum:1,raro:2,epico:3,lendario:4,mistico:5},M=A=>{const O=Object.values(A.attributes||{}).reduce((S,I)=>S+(typeof I=="number"?I:0),0);return(A.speedBonus||0)*3+O+(_[A.stage]||0)*2+(P[A.rarity]||0)};return(C=D.slice().sort((A,O)=>M(O)-M(A))[0])==null?void 0:C.id},[D,l==null?void 0:l.favoriteMountId]),re=x.useMemo(()=>{const _=(l.mounts||[]).find(P=>P.id===$);return Math.max(0,(_==null?void 0:_.speedBonus)||0)},[l.mounts,$]),ee={cavalo:"ğŸ‡",lobo:"ğŸº",grifo:"ğŸ¦…",javali:"ğŸ—",lagarto:"ğŸ¦",draconiano:"ğŸ‰",urso:"ğŸ»",felino:"ğŸˆ",cervo:"ğŸ¦Œ",alce:"ğŸ«",hipogrifo:"ğŸ¦…",rinoceronte:"ğŸ¦",wyvern:"ğŸ²"},fe={comum:"bg-gray-700 text-gray-200",incomum:"bg-emerald-700 text-emerald-100",raro:"bg-blue-700 text-blue-100",epico:"bg-purple-700 text-purple-100",lendario:"bg-amber-700 text-amber-100",mistico:"bg-pink-700 text-pink-100"};return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Montarias"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:!J,onClick:()=>J&&t(J),className:`px-3 py-2 rounded ${J?"bg-indigo-600 hover:bg-indigo-700":"bg-gray-700"} text-white text-sm`,children:"Ativar melhor"}),(l==null?void 0:l.favoriteMountId)&&e.jsx("button",{onClick:()=>t(l.favoriteMountId),className:"px-3 py-2 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm",children:"Ativar favorita â­"}),e.jsx("button",{onClick:()=>{try{const _=JSON.stringify((l.mounts||[]).map(P=>({name:P.name,type:P.type,rarity:P.rarity,stage:P.stage,speedBonus:P.speedBonus,attributes:P.attributes,refineLevel:P.refineLevel,mastery:P.mastery})),null,2);navigator.clipboard.writeText(_),ge.emit({type:"item",title:"Exportado",message:"EstÃ¡bulo copiado para a Ã¡rea de transferÃªncia",duration:3e3})}catch{ge.emit({type:"item",title:"Falha ao exportar",message:"Verifique permissÃµes do navegador",duration:3e3})}},className:"px-3 py-2 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm",children:"Exportar"}),e.jsx("button",{onClick:()=>{const _=window.prompt("Cole o JSON de montarias");if(!_)return;Z.getState().importMountsForSelected(_)||ge.emit({type:"item",title:"ImportaÃ§Ã£o falhou",message:"Formato invÃ¡lido ou sem capacidade",duration:3e3})},className:"px-3 py-2 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm",children:"Importar"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["ğŸ“œ Pergaminhos: ",e.jsx("span",{className:"text-amber-300 font-semibold",children:X["pergaminho-montaria"]||0}),e.jsxs("span",{className:"ml-3",children:["ğŸ§¬ EssÃªncia Bestial: ",e.jsx("span",{className:"text-amber-300 font-semibold",children:X["essencia-bestial"]||0})]}),e.jsxs("span",{className:"ml-3",children:["ğŸ”· Pedra MÃ¡gica: ",e.jsx("span",{className:"text-amber-300 font-semibold",children:X["pedra-magica"]||0})]}),e.jsxs("span",{className:"ml-3",children:["ğŸ”— EssÃªncia de VÃ­nculo: ",e.jsx("span",{className:"text-amber-300 font-semibold",children:X["essencia-vinculo"]||0})]}),e.jsxs("span",{className:"ml-3",children:["ğŸ›ï¸ EstÃ¡bulo: ",e.jsxs("span",{className:"text-amber-300 font-semibold",children:[D.length,"/",l.stableCapacity||50]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-gray-300",children:"Ordenar por"}),e.jsxs("select",{value:d,onChange:_=>m(_.target.value),className:"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded",children:[e.jsx("option",{value:"estagio",children:"EstÃ¡gio"}),e.jsx("option",{value:"raridade",children:"Raridade"}),e.jsx("option",{value:"velocidade",children:"Velocidade"}),e.jsx("option",{value:"nome",children:"Nome"}),e.jsx("option",{value:"maestria",children:"Maestria"})]}),e.jsx("input",{value:f,onChange:_=>j(_.target.value),placeholder:"Buscar por nome",className:"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded"}),e.jsxs("label",{className:"ml-2 flex items-center gap-1 text-xs text-gray-300",children:[e.jsx("span",{children:"Tipo"}),e.jsxs("select",{value:y,onChange:_=>w(_.target.value),className:"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded",children:[e.jsx("option",{value:"todos",children:"Todos"}),Object.keys(ee).map(_=>e.jsx("option",{value:_,children:_},_))]})]}),e.jsxs("label",{className:"ml-2 flex items-center gap-1 text-xs text-gray-300",children:[e.jsx("span",{children:"Raridade"}),e.jsx("select",{value:k,onChange:_=>E(_.target.value),className:"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded",children:["todos","comum","incomum","raro","epico","lendario","mistico"].map(_=>e.jsx("option",{value:_,children:_},_))})]}),e.jsxs("label",{className:"ml-2 flex items-center gap-1 text-xs text-gray-300",children:[e.jsx("span",{children:"EstÃ¡gio"}),e.jsx("select",{value:h,onChange:_=>b(_.target.value),className:"bg-slate-800 border border-slate-600 text-gray-200 text-xs px-2 py-1 rounded",children:["todos","comum","encantada","lendaria"].map(_=>e.jsx("option",{value:_,children:_},_))})]})]})]}),(Y||Q)&&e.jsxs("div",{className:"mb-3 rounded-lg p-2 bg-emerald-800/30 border border-emerald-500/30 text-emerald-200 text-xs",children:[Y&&e.jsx("span",{children:"EvoluÃ§Ã£o disponÃ­vel: use pergaminhos e ouro para avanÃ§ar o estÃ¡gio. "}),Q&&e.jsx("span",{children:"Refino possÃ­vel: consome materiais e pode falhar em nÃ­veis altos."})]}),(()=>{const P=["comum","incomum","raro","epico","lendario","mistico"].map(A=>({r:A,c:(D||[]).filter(O=>O.rarity===A).length})),C=Object.keys(ee).map(A=>({t:A,c:(D||[]).filter(O=>O.type===A).length})).sort((A,O)=>O.c-A.c).slice(0,3);return e.jsx("div",{className:"mb-3 rounded-lg p-2 bg-slate-800 border border-slate-700 text-xs text-gray-300",children:e.jsxs("div",{children:["Resumo: ",P.map(A=>`${A.r}:${A.c}`).join(" â€¢ ")," â€¢ Top tipos: ",C.map(A=>`${A.t}:${A.c}`).join(" â€¢ ")]})})})(),l.favoriteMountIds&&l.favoriteMountIds.length>0&&e.jsxs("div",{className:"mb-3 rounded-lg p-2 bg-slate-800 border border-amber-500/30",children:[e.jsx("div",{className:"text-xs text-amber-300 mb-1",children:"Favoritos"}),e.jsx("div",{className:"flex gap-2",children:l.favoriteMountIds.slice(0,3).map(_=>{const P=(l.mounts||[]).find(O=>O.id===_);if(!P)return null;const M=(l.favoriteMountIds||[]).slice(0,3).indexOf(_),C=M>=0?`[${M+1}]`:"",A=l.activeMountId===_;return e.jsxs("button",{onClick:()=>t(_),className:`px-2 py-1 rounded ${A?"bg-amber-800":"bg-amber-700 hover:bg-amber-800"} text-white text-[11px]`,children:[C," ",ee[P.type]," ",P.name]},_)})})]}),(()=>{let P=new Date().toDateString().split("").reduce((I,ae)=>I+ae.charCodeAt(0),0);const M=()=>{const I=Math.sin(P++)*1e4;return I-Math.floor(I)},C=Object.keys(ee),A=["comum","incomum","raro","epico","lendario"],O={comum:150,incomum:220,raro:400,epico:900,lendario:2e3,mistico:4e3},S=Array.from({length:3}).map(()=>{const I=C[Math.floor(M()*C.length)],ae=A[Math.floor(M()*A.length)];return{type:I,rarity:ae,price:O[ae]}});return e.jsxs("div",{className:"mb-3 rounded-lg p-3 bg-slate-800 border border-emerald-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-emerald-300 text-xs font-medium",children:"Mercador do EstÃ¡bulo"}),e.jsx("span",{className:"text-gray-400 text-[11px]",children:"Ofertas do dia"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:S.map((I,ae)=>e.jsxs("div",{className:"bg-slate-900 rounded p-2 border border-slate-700 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-200",children:[ee[I.type]," ",String(I.type)," â€¢ ",e.jsx("span",{className:`px-2 py-0.5 rounded ${fe[I.rarity]}`,children:I.rarity})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-amber-300 text-xs",children:["ğŸª™ ",I.price]}),e.jsx("button",{onClick:()=>Z.getState().buyMountOffer(l.id,I.type,I.rarity,I.price),className:"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-[11px]",children:"Comprar"})]})]},ae))})]})})(),u&&g&&e.jsxs("div",{className:"mb-3 rounded-lg p-3 bg-slate-800 border border-amber-500/40 text-amber-200 text-xs",children:[(()=>{const _=D.find(O=>O.id===u),P=D.find(O=>O.id===g);if(!_||!P)return null;const M=Math.max(0,(l.derivedAttributes.initiative||0)-re+(_.speedBonus||0)),C=Math.max(0,(l.derivedAttributes.initiative||0)-re+(P.speedBonus||0)),A=O=>Object.values(O.attributes||{}).reduce((S,I)=>S+(typeof I=="number"?I:0),0);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-white text-sm",children:[ee[_.type]," ",_.name]}),e.jsxs("div",{className:"text-amber-300",children:["Velocidade +",_.speedBonus," â€¢ Iniciativa ",M]}),e.jsxs("div",{className:"text-gray-300",children:["BÃ´nus ",A(_)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-white text-sm",children:[ee[P.type]," ",P.name]}),e.jsxs("div",{className:"text-amber-300",children:["Velocidade +",P.speedBonus," â€¢ Iniciativa ",C]}),e.jsxs("div",{className:"text-gray-300",children:["BÃ´nus ",A(P)]})]})]})})(),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>p(void 0),className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-[11px]",children:"Limpar A"}),e.jsx("button",{onClick:()=>v(void 0),className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-[11px]",children:"Limpar B"}),e.jsx("button",{onClick:()=>{p(void 0),v(void 0)},className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-[11px]",children:"Limpar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[D.length===0&&e.jsx("div",{className:"text-gray-400",children:"Nenhuma montaria ainda. Conquiste pergaminhos e essÃªncias em missÃµes para desbloquear."}),G.filter(_=>{const P=_.stage==="encantada",M=(X["pergaminho-montaria"]||0)>0,C=(X["essencia-bestial"]||0)>0,A=(l.progression.gold||0)>=(_.stage==="comum"?200:700),O=M&&A&&(!P||C),S=((X["pedra-magica"]||0)>0||(X["essencia-vinculo"]||0)>0)&&(_.refineLevel||0)<10;return!(y!=="todos"&&_.type!==y||k!=="todos"&&_.rarity!==k||h!=="todos"&&_.stage!==h||f&&!_.name.toLowerCase().includes(f.toLowerCase())||showEvolvableOnly&&!O||showRefinableOnly&&!S)}).map(_=>{const P=_.stage==="encantada",M=(X["pergaminho-montaria"]||0)>0,C=(X["essencia-bestial"]||0)>0,A=(l.progression.gold||0)>=(_.stage==="comum"?200:700),O=M&&A&&(!P||C),S=$===_.id,I=(_.refineLevel||0)>=10,ae=(_.refineLevel||0)+1,ne=ae<=3?100:ae<=6?75:45,U=Math.max(0,(l.derivedAttributes.initiative||0)-re+(_.speedBonus||0));return e.jsxs("div",{className:`p-4 rounded-lg ${S?"border-amber-500":"border-slate-700"} bg-slate-800 border flex flex-col gap-2`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"font-semibold",children:[ee[_.type]," ",_.name," ",_.stage==="encantada"&&e.jsx("span",{className:"ml-2 text-xs bg-purple-700 text-white px-2 py-1 rounded",children:"Encantada"})," ",_.stage==="lendaria"&&e.jsx("span",{className:"ml-2 text-xs bg-amber-600 text-white px-2 py-1 rounded",children:"LendÃ¡ria"})," ",typeof _.refineLevel=="number"&&_.refineLevel>0&&e.jsxs("span",{className:"ml-2 text-xs bg-violet-700 text-white px-2 py-1 rounded",children:["Refino +",_.refineLevel]})," ",typeof _.mastery=="number"&&_.mastery>0&&e.jsxs("span",{className:"ml-2 text-xs bg-emerald-700 text-white px-2 py-1 rounded",children:["Maestria ",_.mastery]})," ",(()=>{const R=Math.max(0,_.mastery||0),L=R>=30?"Mestre":R>=20?"Perito":R>=10?"Adepto":"";return L?e.jsx("span",{className:"ml-2 text-xs bg-emerald-800 text-white px-2 py-1 rounded",children:L}):null})()," ",l.favoriteMountId===_.id&&e.jsx("span",{className:"ml-2 text-xs bg-amber-700 text-white px-2 py-1 rounded",children:"â­ Favorita"})," ",J===_.id&&e.jsx("span",{className:"ml-2 text-xs bg-indigo-700 text-white px-2 py-1 rounded",children:"Recomendada"})," ",e.jsx("span",{className:`ml-2 text-[10px] px-2 py-1 rounded ${fe[_.rarity]}`,children:_.rarity})]}),e.jsxs("div",{className:"text-xs text-amber-300",children:[_.type," â€¢ ",_.stage," â€¢ ",_.rarity]})]}),e.jsxs("div",{className:"text-sm text-gray-200",children:["Velocidade: +",_.speedBonus]}),_.locked&&e.jsx("div",{className:"text-[11px] text-emerald-300",children:"ğŸ”’ Travada"}),!S&&e.jsxs("div",{className:"text-[11px] text-amber-300",children:["Iniciativa se ativar: ",U]}),S&&e.jsxs("div",{className:"text-xs text-amber-400",children:["Iniciativa atual: ",l.derivedAttributes.initiative]}),S&&(()=>{const R=l.mountBuff;if(!(R!=null&&R.speedBonus))return null;const L=R.expiresAt?new Date(R.expiresAt).getTime():0,oe=Math.max(0,L-Date.now());if(oe<=0)return null;const K=Math.floor(oe/6e4),xe=Math.floor(oe%6e4/1e3);return e.jsxs("div",{className:"text-[11px] text-emerald-300",children:["Buff de treino +",R.speedBonus," â€¢ expira em ",String(K).padStart(2,"0"),":",String(xe).padStart(2,"0")]})})(),_.attributes&&Object.keys(_.attributes).length>0&&e.jsxs("div",{className:"text-xs text-gray-300",children:["BÃ´nus: ",Object.entries(_.attributes).map(([R,L])=>`${R}+${L}`).join(", ")]}),(()=>{const R=_.stage==="encantada"?3:2,L=((X["pergaminho-montaria"]||0)>0?1:0)+((l.progression.gold||0)>=(_.stage==="comum"?200:700)?1:0)+(_.stage==="encantada"&&(X["essencia-bestial"]||0)>0?1:0),oe=Math.round(L/R*100);return e.jsx("div",{className:"mt-1 w-full bg-gray-700 rounded h-2",children:e.jsx("div",{className:"h-2 bg-indigo-500",style:{width:`${oe}%`}})})})(),(()=>{const L=Math.max(0,_.mastery||0)%10,oe=10-(L||10);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 w-full bg-gray-700 rounded h-2",children:e.jsx("div",{className:"h-2 bg-emerald-600",style:{width:`${L*10}%`}})}),e.jsxs("div",{className:"text-[11px] text-gray-400",children:["Maestria: ",L,"/10 â€¢ PrÃ³ximo bÃ´nus em ",oe]})]})})(),_.history&&_.history.length>0&&e.jsxs("div",{className:"text-[11px] text-gray-400",children:["HistÃ³rico: ",_.history.slice(0,3).map(R=>`${new Date(R.ts).toLocaleTimeString()} ${R.action}${R.details?` ${R.details}`:""}`).join(" â€¢ ")]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{disabled:S,title:S?"Montaria ativa":"",onClick:()=>t(_.id),className:`px-3 py-1 rounded ${S?"bg-gray-700 text-gray-300":"bg-indigo-600 hover:bg-indigo-700 text-white"} text-sm`,children:S?"Ativa":"Ativar"}),S&&e.jsx("button",{onClick:()=>t(void 0),className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm",children:"Desativar"}),e.jsx("button",{onClick:()=>o(l.favoriteMountId===_.id?void 0:_.id),className:"px-3 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm",children:l.favoriteMountId===_.id?"Remover Favorita":"Favoritar â­"}),e.jsx("button",{onClick:()=>p(_.id),className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm",children:"Comparar A"}),e.jsx("button",{onClick:()=>v(_.id),className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm",children:"Comparar B"}),e.jsx("button",{onClick:()=>Z.getState().toggleFavoriteMount(_.id),className:"px-3 py-1 rounded bg-amber-700 hover:bg-amber-800 text-white text-sm",children:(l.favoriteMountIds||[]).includes(_.id)?"Desafixar â­":"Fixar â­"}),e.jsx("button",{onClick:()=>Z.getState().toggleLockMount(_.id),className:"px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm",children:_.locked?"Destravar ğŸ”“":"Travar ğŸ”’"}),e.jsx("button",{onClick:()=>T(_.id),className:"px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm",children:"Detalhes"}),e.jsx("button",{disabled:!O,title:O?`Consome ğŸ“œ x1${P?" + ğŸ§¬ x1":""} e ${_.stage==="comum"?200:700} ouro`:"",onClick:()=>{O&&window.confirm(`Confirmar evoluÃ§Ã£o de ${_.name}? Custos: ğŸ“œ x1${P?" + ğŸ§¬ x1":""} e ${_.stage==="comum"?200:700} ouro.`)&&r(_.id)},className:`px-3 py-1 rounded ${O?"bg-purple-600 hover:bg-purple-700":"bg-gray-700"} text-white text-sm`,children:"Evoluir"}),S&&e.jsx("button",{onClick:()=>Z.getState().trainMountForSelected(),className:"px-3 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-sm",children:"Treinar"}),e.jsx("button",{onClick:()=>{const R=window.prompt("Novo nome para a montaria",_.name)||"";R.trim()&&Z.getState().renameMountForSelected(_.id,R.trim())},className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm",children:"Renomear"}),e.jsx("button",{disabled:!Q||I,title:I?"Refino mÃ¡ximo atingido":Q?"Consome ğŸ”· Pedra MÃ¡gica ou ğŸ”— EssÃªncia de VÃ­nculo":"",onClick:()=>{Q&&!I&&window.confirm(`Tentar refinar ${_.name}? Consome 1 material e pode falhar.`)&&i(l.id,"mount",_.id)},className:`px-3 py-1 rounded ${!Q||I?"bg-gray-700":"bg-violet-600 hover:bg-violet-700"} text-white text-sm`,children:I?"Refino MÃ¡x.":"Refinar"}),!Q&&!I&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{if(!window.confirm("Comprar ğŸ”· Pedra MÃ¡gica?"))return;n(l.id,"pedra-magica")?ge.emit({type:"item",title:"Material comprado",message:"ğŸ”· +1 adicionada ao inventÃ¡rio.",duration:3e3,icon:"ğŸ”·"}):ge.emit({type:"gold",title:"Compra falhou",message:"Verifique seu saldo.",duration:3e3})},className:"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white",children:"Comprar ğŸ”·"}),e.jsx("button",{onClick:()=>{if(!window.confirm("Comprar ğŸ”— EssÃªncia de VÃ­nculo?"))return;n(l.id,"essencia-vinculo")?ge.emit({type:"item",title:"Material comprado",message:"ğŸ”— +1 adicionada ao inventÃ¡rio.",duration:3e3,icon:"ğŸŒ€"}):ge.emit({type:"gold",title:"Compra falhou",message:"Verifique seu saldo.",duration:3e3})},className:"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white",children:"Comprar ğŸ”—"})]}),!I&&e.jsxs("span",{className:"text-[11px] text-gray-400 self-center",children:["Chance ~",ne,"%"]})]}),!O&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-2",children:["Requisitos: ğŸ“œ x1 ",P&&" â€¢ ğŸ§¬ x1"," â€¢ Ouro ",_.stage==="comum"?200:700,e.jsx("button",{disabled:(X["pergaminho-montaria"]||0)>0,onClick:()=>{if(!window.confirm("Comprar ğŸ“œ Pergaminho de Montaria?"))return;n(l.id,"pergaminho-montaria")?ge.emit({type:"item",title:"Pergaminho comprado",message:"ğŸ“œ +1 adicionado ao inventÃ¡rio.",duration:3e3,icon:"ğŸ“œ"}):ge.emit({type:"gold",title:"Compra falhou",message:"Verifique seu saldo.",duration:3e3})},className:`px-2 py-1 rounded ${(X["pergaminho-montaria"]||0)>0?"bg-gray-700":"bg-emerald-700 hover:bg-emerald-800"} text-white`,children:"Comprar ğŸ“œ"}),P&&e.jsx("button",{disabled:(X["essencia-bestial"]||0)>0,onClick:()=>{if(!window.confirm("Comprar ğŸ§¬ EssÃªncia Bestial?"))return;n(l.id,"essencia-bestial")?ge.emit({type:"item",title:"EssÃªncia comprada",message:"ğŸ§¬ +1 adicionada ao inventÃ¡rio.",duration:3e3,icon:"ğŸ§¬"}):ge.emit({type:"gold",title:"Compra falhou",message:"Verifique seu saldo.",duration:3e3})},className:`px-2 py-1 rounded ${(X["essencia-bestial"]||0)>0?"bg-gray-700":"bg-emerald-700 hover:bg-emerald-800"} text-white`,children:"Comprar ğŸ§¬"})]})]},_.id)})]}),N&&(()=>{const _=D.find(P=>P.id===N);return _?e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4 w-[90%] max-w-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"text-white font-semibold",children:[ee[_.type]," ",_.name]}),e.jsx("button",{onClick:()=>T(void 0),className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-xs",children:"Fechar"})]}),e.jsxs("div",{className:"text-xs text-gray-300 mb-2",children:["Tipo ",_.type," â€¢ ",_.stage," â€¢ ",_.rarity]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"text-sm text-gray-200",children:["Velocidade: +",_.speedBonus]}),e.jsxs("div",{className:"text-sm text-gray-200",children:["Maestria: ",Math.max(0,_.mastery||0)]}),e.jsxs("div",{className:"text-sm text-gray-200",children:["Estado: ",_.locked?"ğŸ”’ Travada":"ğŸ”“ Destravada"]}),_.attributes&&e.jsxs("div",{className:"col-span-2 text-xs text-gray-300",children:["BÃ´nus: ",Object.entries(_.attributes).map(([P,M])=>`${P}+${M}`).join(", ")]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"HistÃ³rico"}),e.jsx("div",{className:"max-h-40 overflow-auto text-[11px] text-gray-400 bg-slate-800 border border-slate-700 rounded p-2",children:(_.history||[]).map((P,M)=>e.jsxs("div",{children:[new Date(P.ts).toLocaleString()," â€¢ ",P.action,P.details?` ${P.details}`:""]},M))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Notas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{defaultValue:_.note||"",id:"mount-note-input",className:"flex-1 bg-slate-800 border border-slate-700 rounded px-2 py-1 text-xs text-gray-200"}),e.jsx("button",{onClick:()=>{const P=document.getElementById("mount-note-input"),M=(P==null?void 0:P.value)||"";Z.getState().setMountNoteForSelected(_.id,M)},className:"px-3 py-1 rounded bg-emerald-700 hover:bg-emerald-800 text-white text-sm",children:"Salvar nota"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(l.favoriteMountId===_.id?void 0:_.id),className:"px-3 py-1 rounded bg-amber-600 hover:bg-amber-700 text-white text-sm",children:l.favoriteMountId===_.id?"Remover Favorita":"Favoritar â­"}),e.jsx("button",{onClick:()=>{const P=window.prompt("Novo nome para a montaria",_.name)||"";P.trim()&&Z.getState().renameMountForSelected(_.id,P.trim())},className:"px-3 py-1 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm",children:"Renomear"}),e.jsx("button",{onClick:()=>Z.getState().toggleLockMount(_.id),className:"px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-white text-sm",children:_.locked?"Destravar ğŸ”“":"Travar ğŸ”’"}),e.jsx("button",{onClick:()=>{window.confirm(`Liberar ${_.name}?`)&&(Z.getState().removeMountForSelected(_.id),T(void 0))},className:"px-3 py-1 rounded bg-red-700 hover:bg-red-800 text-white text-sm",children:"Liberar"})]})]})}):null})()]})},mm=({hero:a})=>{var p,g,v,y,w,k,E,h,b;const[s,t]=x.useState(null),[r,i]=x.useState("all"),n=((p=a.worldState)==null?void 0:p.decisionLog)||[],o=n.filter(f=>{var j;return r==="all"?!0:((j=f.rollResult)==null?void 0:j.success)===(r==="success")}).sort((f,j)=>new Date(j.timestamp).getTime()-new Date(f.timestamp).getTime()),c=f=>new Date(f).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=f=>{const j=[];return f.impact.immediate.gold&&j.push(`${f.impact.immediate.gold>0?"+":""}${f.impact.immediate.gold} ouro`),f.impact.immediate.xp&&j.push(`+${f.impact.immediate.xp} XP`),f.impact.immediate.reputation&&Object.entries(f.impact.immediate.reputation).forEach(([N,T])=>{j.push(`${N}: ${T>0?"+":""}${T}`)}),f.impact.immediate.items&&j.push(`${f.impact.immediate.items.length} item(s)`),j.join(", ")||"Sem impactos imediatos"},m=(()=>{var f;return(f=a.worldState)!=null&&f.factions?Object.entries(a.worldState.factions).filter(([j,N])=>Math.abs(N.reputation)>5).sort(([j,N],[T,F])=>F.reputation-N.reputation).map(([j,N])=>{const T=As(N.reputation);return{name:j.charAt(0).toUpperCase()+j.slice(1),reputation:N.reputation,status:T.name,description:rc(N.reputation),color:T.color}}):[]})(),u=es("topics");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["DiÃ¡rio de ",a.name]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"DecisÃµes Tomadas"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:n.length})]}),e.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Taxa de Sucesso"}),e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[n.length>0?Math.round(n.filter(f=>{var j;return(j=f.rollResult)==null?void 0:j.success}).length/n.length*100):0,"%"]})]}),e.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Fadiga Atual"}),e.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[Math.max(0,Number(((g=a.progression)==null?void 0:g.fatigue)||0)),"/100"]})]})]}),e.jsx("div",{className:"flex space-x-2",children:["all","success","failure"].map(f=>e.jsx("button",{onClick:()=>i(f),className:`px-4 py-2 rounded transition-colors ${r===f?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:f==="all"?"Todas":f==="success"?"Sucessos":"Falhas"},f))})]}),m.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"ReputaÃ§Ã£o"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:m.map(({name:f,reputation:j,status:N,description:T,color:F})=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-700 rounded p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold",children:f}),e.jsx("div",{className:`text-sm ${F}`,title:T,children:N})]}),e.jsxs("div",{className:`text-lg font-bold ${j>0?"text-green-400":j<0?"text-red-400":"text-gray-400"}`,children:[j>0?"+":"",j]})]},f))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"HistÃ³ria do Mundo"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Wiki"})]}),e.jsx("div",{className:"space-y-4",children:u.sections.map(f=>e.jsxs("div",{className:"rounded border border-white/10 bg-white/5 p-4",children:[e.jsx("div",{className:"text-white font-semibold mb-2",children:f.title}),e.jsx("ul",{className:"list-disc ml-5 text-sm text-gray-200 space-y-1",children:f.bullets.map((j,N)=>e.jsx("li",{children:j},N))})]},f.id))}),e.jsx("div",{className:"mt-3 text-xs text-gray-400",children:"Base: Forjador de HerÃ³is â€” Altharion"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"HistÃ³rico de DecisÃµes"}),o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 text-lg",children:"Nenhuma decisÃ£o registrada ainda"}),e.jsx("div",{className:"text-gray-500 text-sm mt-2",children:"Complete missÃµes e eventos para comeÃ§ar a construir sua histÃ³ria"})]}):e.jsx("div",{className:"space-y-4",children:o.map((f,j)=>{var N,T,F,te,D,$,X,Q;return e.jsx(tt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:j*.1},className:`border-l-4 pl-4 py-3 cursor-pointer transition-all ${(N=f.rollResult)!=null&&N.success?"border-green-500 bg-green-900/20 hover:bg-green-900/30":"border-red-500 bg-red-900/20 hover:bg-red-900/30"}`,onClick:()=>t(f),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-lg ${(T=f.rollResult)!=null&&T.success?"âœ…":"âŒ"}`,children:(F=f.rollResult)!=null&&F.success?"âœ…":"âŒ"}),e.jsx("span",{className:"text-white font-semibold",children:f.choiceText})]}),e.jsx("div",{className:"text-gray-400 text-sm mt-1",children:c(f.timestamp)}),e.jsx("div",{className:"text-gray-300 text-sm mt-1",children:l(f)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Roll: ",(te=f.rollResult)==null?void 0:te.roll," + ",(D=f.rollResult)==null?void 0:D.modifiers," = ",(($=f.rollResult)==null?void 0:$.roll)+((X=f.rollResult)==null?void 0:X.modifiers)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["vs ",(Q=f.rollResult)==null?void 0:Q.threshold]})]})]})},f.id)})})]}),e.jsx(oa,{children:s&&e.jsx(tt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>t(null),children:e.jsxs(tt.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-gray-800 rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Detalhes da DecisÃ£o"}),e.jsx("button",{onClick:()=>t(null),className:"text-gray-400 hover:text-white text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Escolha"}),e.jsx("div",{className:"text-white font-semibold",children:s.choiceText})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Data"}),e.jsx("div",{className:"text-white",children:c(s.timestamp)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Resultado do Roll"}),e.jsx("div",{className:`text-lg font-bold ${(v=s.rollResult)!=null&&v.success?"text-green-400":"text-red-400"}`,children:(y=s.rollResult)!=null&&y.success?"Sucesso":"Falha"}),e.jsxs("div",{className:"text-gray-300 text-sm",children:["Roll: ",(w=s.rollResult)==null?void 0:w.roll," + Modificadores: ",(k=s.rollResult)==null?void 0:k.modifiers," = ",((E=s.rollResult)==null?void 0:E.roll)+((h=s.rollResult)==null?void 0:h.modifiers)," vs ",(b=s.rollResult)==null?void 0:b.threshold]})]}),Object.keys(s.impact.immediate).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm mb-2",children:"Impactos Imediatos"}),e.jsxs("div",{className:"bg-gray-700 rounded p-3 space-y-1",children:[s.impact.immediate.gold&&e.jsxs("div",{className:"text-yellow-400",children:["Ouro: ",s.impact.immediate.gold>0?"+":"",s.impact.immediate.gold]}),s.impact.immediate.xp&&e.jsxs("div",{className:"text-blue-400",children:["XP: +",s.impact.immediate.xp]}),s.impact.immediate.reputation&&Object.entries(s.impact.immediate.reputation).map(([f,j])=>e.jsxs("div",{className:"text-purple-400",children:[f,": ",j>0?"+":"",j]},f)),s.impact.immediate.items&&e.jsxs("div",{className:"text-green-400",children:["Itens: ",s.impact.immediate.items.join(", ")]})]})]}),Object.keys(s.impact.longTerm).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm mb-2",children:"Impactos de Longo Prazo"}),e.jsxs("div",{className:"bg-gray-700 rounded p-3 space-y-1",children:[s.impact.longTerm.npcRelations&&Object.entries(s.impact.longTerm.npcRelations).map(([f,j])=>e.jsxs("div",{className:"text-cyan-400",children:[f,": ",j>0?"+":"",j," relaÃ§Ã£o"]},f)),s.impact.longTerm.worldEvents&&e.jsxs("div",{className:"text-orange-400",children:["Eventos: ",s.impact.longTerm.worldEvents.join(", ")]})]})]})]})]})})})]})};function Us(a){return Math.max(.05,Math.min(.95,a))}function qn(a){return a>=7?"hard":a>=4?"normal":"easy"}function um(a){var g;const s=(a==null?void 0:a.name)||"HerÃ³i",t=(a==null?void 0:a.class)||(a==null?void 0:a.klass)||"Aventureiro",r=Number((a==null?void 0:a.level)||((g=a==null?void 0:a.progression)==null?void 0:g.level)||1)||1,i=qn(r),n="Recuperar um artefato antigo perdido",o="RuÃ­nas de Valthor",c="GuardiÃ£o espectral e armadilhas antigas",l=(a==null?void 0:a.attributes)||{},d=i==="easy"?0:i==="normal"?.1:.2,m=Us(.3+(Number(l.sabedoria)||0)*.05-d),u=Us(.3+(Number(l.forca)||0)*.05-d),p=Us(.3+(Number(l.destreza)||0)*.05-d);return{id:`m-${Date.now()}`,description:`${s} â€” ${t} â€” NÃ­vel ${r}. Objetivo: ${n}. Local: ${o}. Desafio: ${c}.`,objective:n,location:o,challenge:c,difficulty:i,choices:[{key:"A",text:"Investigar rotas alternativas com cautela",success:m},{key:"B",text:"Confrontar o guardiÃ£o diretamente",success:u},{key:"C",text:"Usar astÃºcia para distrair e infiltrar-se",success:p}]}}function pm(a,s,t){var f,j,N;const r=Number((t==null?void 0:t.level)||((f=t==null?void 0:t.progression)==null?void 0:f.level)||1)||1,i=((a==null?void 0:a.choices)||[]).find(T=>T.key===s),n=i?Number(i.success):.5,o=Math.random(),c=o<=n,l=(a==null?void 0:a.difficulty)||qn(r),m=(l==="easy"?12:l==="normal"?20:26)+Math.min(10,Math.floor(r/2)),u=Math.round(c?m*1.6:m*.6),p=Math.max(10,Math.min(50,u)),g=c?.35:.1,v=c?.2:.05,y=Math.random()<g,w=Math.random()<v,k=y?"RelÃ­quia menor das RuÃ­nas":"",E=w?l==="hard"?"Quebrador de GuardiÃµes":"Eco das RuÃ­nas":"",h=`Com determinaÃ§Ã£o e ${((j=i==null?void 0:i.text)==null?void 0:j.toLowerCase())||"tÃ¡tica cuidadosa"}, o herÃ³i supera o desafio em ${a==null?void 0:a.location}. O artefato Ã© recuperado e o caminho fica marcado por passos seguros.`,b=`A abordagem ${((N=i==null?void 0:i.text)==null?void 0:N.toLowerCase())||"arrisca"} sai do controle. O guardiÃ£o repele o avanÃ§o e o herÃ³i recua, aprendendo com cada ferida e armadilha ativada.`;return{success:c,xp:p,title:E,loot:k,narrative:c?h:b,roll:o,prob:n}}async function gm(a){let s=await fetch("/api/mission/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const r=await s.text();if(s.status===404&&(s=await fetch("/api/mission-generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})),!s.ok)try{return um(a.hero)}catch{const i=await s.text().catch(()=>"");throw new Error(`Falha ao gerar missÃ£o: ${s.status} ${(i||r||"").slice(0,200)}`)}}return(await s.json()).mission}async function xm(a){let s=await fetch("/api/mission/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const r=await s.text();if(s.status===404&&(s=await fetch("/api/mission-resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})),!s.ok)try{return pm(a.mission,a.choice,a.hero)}catch{const i=await s.text().catch(()=>"");throw new Error(`Falha ao resolver missÃ£o: ${s.status} ${(i||r||"").slice(0,200)}`)}}const t=await s.json();return t.result||t}function hm({autoStart:a=!1,compact:s=!1}={}){var h;const t=Z(b=>b.selectedHeroId),r=Z(b=>b.heroes),i=Z(b=>b.gainXP),n=x.useMemo(()=>r.find(b=>b.id===t),[r,t]),[o,c]=x.useState(!1),[l,d]=x.useState(null),[m,u]=x.useState(null),[p,g]=x.useState(""),[v,y]=x.useState(null);function w(b){return b*100+(b-1)*50}x.useEffect(()=>{if(v){const b=setTimeout(()=>y(null),1800);return()=>clearTimeout(b)}},[v]),x.useEffect(()=>{a&&n&&!l&&!o&&k()},[a,n==null?void 0:n.id]);async function k(){if(n){ea(),c(!0),g(""),u(null);try{const b=await gm({hero:{name:n.name,class:n.class,level:n.progression.level,attributes:n.attributes}});d(b),ge.emit({type:"quest",title:"MissÃ£o gerada",message:`${b.objective||"Objetivo desconhecido"} â€¢ Dificuldade: ${b.difficulty}`,duration:3200})}catch(b){g((b==null?void 0:b.message)||"Falha ao gerar missÃ£o")}finally{c(!1)}}}async function E(b){if(!(!n||!l)){ea(),c(!0),g("");try{const f=n.progression.level,j=await xm({mission:l,choice:b,hero:{level:n.progression.level}});if(u(j),ge.emit({type:"quest",title:j.success?"MissÃ£o concluÃ­da":"MissÃ£o falhou",message:l.objective||l.description,icon:j.success?"âš”ï¸":"âŒ",duration:3500}),j.success?ja():wa(),j!=null&&j.xp){i(n.id,j.xp),ge.emit({type:"xp",title:"XP Ganho!",message:"MissÃ£o rÃ¡pida",value:j.xp,duration:2800});const N=r.find(T=>T.id===n.id);N&&N.progression.level>f&&(y(N.progression.level),$n(),gt.levelUp({heroId:N.id,heroName:N.name,heroClass:N.class,heroLevel:N.progression.level})),j.success&&gt.questCompleted({heroId:n.id,heroName:n.name,heroClass:n.class,heroLevel:n.progression.level,questName:l.objective||l.description,questDifficulty:l.difficulty,xpGained:j.xp})}j.title&&(ge.emit({type:"achievement",title:"TÃ­tulo conquistado!",message:j.title,icon:"ğŸ‘‘",duration:4200}),gt.titleEarned({heroId:n.id,heroName:n.name,heroClass:n.class,heroLevel:n.progression.level,titleEarned:j.title}))}catch(f){g((f==null?void 0:f.message)||"Falha ao resolver missÃ£o")}finally{c(!1)}}}return n?e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"MissÃ£o RÃ¡pida"}),e.jsxs("p",{className:"text-gray-300",children:["HerÃ³i: ",n.name," (NÃ­vel ",n.progression.level,") â€¢ â­ Estrelas: ",n.progression.stars||0]}),n.activeTitle&&e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["TÃ­tulo ativo: ",e.jsx("span",{className:"font-medium",children:n.activeTitle})]})]}),e.jsx("div",{className:"mt-2",children:(()=>{const b=n.progression.level,f=n.progression.xp,j=w(b),N=w(b+1),T=Math.max(0,f-j),F=Math.max(1,N-j),te=Math.min(100,Math.max(0,Math.round(T/F*100)));return e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-300",children:["XP atual: ",T," / ",F," (",te,"%)"]}),e.jsx("div",{className:"w-full h-2 bg-gray-700 rounded mt-1",children:e.jsx("div",{className:"h-2 bg-green-500 rounded",style:{width:`${te}%`}})})]})})()}),!s&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:k,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",disabled:o,children:o?"Gerando...":l?"Gerar outra missÃ£o":"Gerar missÃ£o"})}),p&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 text-red-700 rounded",children:p}),l&&e.jsxs("div",{className:"mt-6 p-4 border rounded bg-gray-800 border-gray-700 shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"DescriÃ§Ã£o"}),e.jsx("p",{className:"mt-2 text-gray-200",children:l.description}),e.jsxs("div",{className:"mt-3 text-sm text-gray-300",children:["Dificuldade: ",e.jsx("span",{className:"font-medium",children:l.difficulty})]}),e.jsx("h4",{className:"mt-4 font-semibold",children:"Escolhas"}),e.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2",children:l.choices.map(b=>e.jsxs("button",{onClick:()=>E(b.key),className:"border border-gray-700 bg-gray-700 text-gray-100 px-3 py-2 rounded hover:bg-gray-600",disabled:o||!!m,children:[e.jsx("div",{className:"font-medium text-white",children:b.key}),e.jsx("div",{className:"text-sm text-gray-200",children:b.text}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Sucesso ~",Math.round(b.success*100),"%"]})]},b.key))}),m&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-700 rounded",children:[e.jsxs("div",{className:"text-lg font-semibold text-white",children:["Resultado: ",m.success?"Sucesso":"Falha"]}),e.jsx("p",{className:"mt-1 text-gray-200",children:m.narrative}),e.jsxs("div",{className:"mt-2 text-sm text-gray-200",children:["XP ganho: ",e.jsx("span",{className:"font-medium",children:m.xp})]}),(m.title||m.loot)&&e.jsxs("div",{className:"mt-1 text-sm text-gray-300",children:[m.title?`TÃ­tulo: ${m.title}`:""," ",m.loot?`Loot: ${m.loot}`:""]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:["Roll: ",(h=m.roll)==null?void 0:h.toFixed(2)," â€¢ Prob: ",Math.round((m.prob||0)*100),"%"]}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>{d(null),u(null)},className:"px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Nova missÃ£o"})})]})]}),v&&e.jsxs("div",{className:"fixed inset-0 pointer-events-none flex items-center justify-center z-50",children:[e.jsx("div",{className:"bg-black bg-opacity-50 absolute inset-0"}),e.jsxs("div",{className:"relative z-10 text-center p-6 rounded-xl bg-gray-800 shadow-xl border border-gray-700",children:[e.jsx("div",{className:"text-5xl mb-2",children:"ğŸ‰"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:["NÃ­vel ",v," alcanÃ§ado!"]}),e.jsxs("div",{className:"text-sm text-gray-300",children:["+1 â­ Estrela â€¢ Novo tÃ­tulo: ",n.activeTitle||"â€”"]})]})]})]}):e.jsxs("div",{className:"max-w-3xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ—¡ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Selecione um herÃ³i"}),e.jsx("p",{className:"text-gray-600",children:"Escolha um herÃ³i para jogar uma missÃ£o rÃ¡pida."})]})}const Fn=()=>{const{getSelectedHero:a}=Z(),s=a(),t=(s==null?void 0:s.journeyChapters)||[],r=[4,8,12,16,20].find(i=>((s==null?void 0:s.progression.level)??1)<i);return s?e.jsxs("div",{className:"mt-8 rounded-xl p-6 bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xl",children:"ğŸ“š"}),e.jsx("h3",{className:"text-lg font-bold",children:"CapÃ­tulos da Jornada"})]}),e.jsx("ul",{className:"space-y-3",children:t.map(i=>e.jsx("li",{className:"text-sm text-gray-200",children:e.jsxs(_n,{children:[e.jsx("div",{className:"font-semibold text-white mb-1",children:i.title}),e.jsx("div",{className:"text-gray-300",children:i.summary}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Criado em ",new Date(i.createdAt).toLocaleString()," â€¢ NÃ­vel ",i.levelMilestone]})]})},i.id))}),t.length===0&&e.jsx("div",{className:"text-sm text-gray-400",children:"Ainda sem capÃ­tulos. Eles sÃ£o gerados automaticamente a cada 4 nÃ­veis."}),r&&e.jsxs("div",{className:"mt-3 text-xs text-gray-400",children:["PrÃ³ximo capÃ­tulo em nÃ­vel ",r,"."]})]}):null},Su=Object.freeze(Object.defineProperty({__proto__:null,default:Fn},Symbol.toStringTag,{value:"Module"})),ds=({title:a,description:s,icon:t,ctaLabel:r,to:i,highlight:n,examples:o,stepIndex:c,testId:l})=>{var p;const d=Wt(),{activeSeasonalTheme:m}=Qe(),u=m&&((p=Ke[m])==null?void 0:p.border)||"border-white/20";return x.useMemo(()=>es("short"),[]),e.jsx("div",{className:`rounded-xl p-6 border transition-all duration-300 ${n?"border-amber-400 bg-amber-900/10":`${u} bg-white/10`} hover:bg-white/15 hover:border-amber-400`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"text-4xl",children:t}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("div",{className:"text-xl font-bold text-amber-300",children:a}),typeof c=="number"&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-gray-800 text-gray-200 text-xs border border-white/10",children:["Etapa ",c]})]}),e.jsx("div",{className:"text-gray-300 text-sm mb-4",children:s}),Array.isArray(o)&&o.length>0&&e.jsx("ul",{className:"text-xs text-gray-200 mb-4 list-disc ml-4",children:o.map((g,v)=>e.jsx("li",{children:g},v))}),(()=>{var y;const g=yt(m),v=((y=Ke[m||""])==null?void 0:y.accents)||[];return e.jsxs("button",{onClick:()=>d(i),className:`px-4 py-2 rounded-lg bg-gradient-to-r ${g} text-white font-semibold transition-all duration-200 hover:brightness-110 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 flex items-center gap-2`,"aria-label":r,"data-testid":l,children:[v[0]||"",e.jsx("span",{children:r})]})})()]})]})})},Vs=({percent:a,label:s})=>e.jsxs("div",{"data-testid":"journey-progress",children:[s&&e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:s}),e.jsx("div",{className:"w-full h-3 bg-slate-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":Math.max(0,Math.min(100,a)),"aria-valuemin":0,"aria-valuemax":100,children:e.jsx("div",{className:`h-3 bg-gradient-to-r ${et.gradients.buttons.success} rounded-full transition-all duration-500`,style:{width:`${Math.max(0,Math.min(100,a))}%`}})})]}),Pi=()=>{var B,se,z;const{getSelectedHero:a,heroes:s}=Z(),t=a(),[r,i]=x.useState(null),[n,o]=x.useState(!1),[c,l]=x.useState([]),[d,m]=x.useState(!1),[u,p]=x.useState(null),[g,v]=x.useState(null),[y,w]=x.useState(0),[k,E]=x.useState({completed:0,total:0}),[h,b]=x.useState(null),[f,j]=x.useState(()=>{try{return localStorage.getItem("hfn_show_hints")==="1"}catch{return!1}}),[N,T]=x.useState(()=>{try{return localStorage.getItem("hfn_skip_tutorials")==="1"}catch{return!1}}),[F,te]=x.useState(null),[D,$]=x.useState(""),[X,Q]=x.useState([]),[Y,G]=x.useState(!1),[J,re]=x.useState(null),ee=x.useRef(null),fe=x.useRef(!0),_=Wt(),P=ua(),M=new URLSearchParams(P.search),C=M.get("ref")||void 0,A=M.get("by")||void 0,{activeSeasonalTheme:O}=Qe(),S=O&&((B=Ke[O])==null?void 0:B.border)||"border-white/20";x.useEffect(()=>{try{!localStorage.getItem("introSeen")&&!N&&_("/intro")}catch{}},[N]);const I=x.useMemo(()=>{var ve,Ae;if(!t)return 0;const V=((ve=t.progression)==null?void 0:ve.xp)??0,ie=((Ae=t.progression)==null?void 0:Ae.level)??1,he=ie*100+(ie-1)*50,H=(ie-1)*100+(ie-2>=0?(ie-2)*50:0),me=Math.max(0,V-H),de=Math.max(1,he-H);return Math.round(me/de*100)},[t]);x.useEffect(()=>{if(t){const V=Pn(t);i(V),(async()=>{var he,H;const ie=(H=(he=import.meta)==null?void 0:he.env)==null?void 0:H.VITE_API_BASE;if(!ie){l([]);return}try{o(!0),await fetch(`${ie}/daily/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hero:t})});const de=await(await fetch(`${ie}/daily/leaderboard`)).json();l(Array.isArray(de==null?void 0:de.entries)?de.entries:[])}catch{}finally{o(!1)}})()}},[t]);async function ae(V){var ie;if(!(V!=null&&V.aborted)){fe.current&&(m(!0),p(null));try{if(!_t){!(V!=null&&V.aborted)&&fe.current&&(p("Nuvem desativada neste ambiente."),v(null));return}const{data:he}=await Ze.auth.getUser(),H=((ie=he==null?void 0:he.user)==null?void 0:ie.id)||null;if(!H)!(V!=null&&V.aborted)&&fe.current&&(p("FaÃ§a login para ver seu progresso."),v(null));else{const me=await fetch(`/api/player-progress?action=get&id=${encodeURIComponent(H)}`,{signal:V}),de=await me.json();if(!me.ok)throw new Error((de==null?void 0:de.error)||"Falha ao carregar progresso");!(V!=null&&V.aborted)&&fe.current&&v((de==null?void 0:de.progress)||null)}}catch(he){if((he==null?void 0:he.name)==="AbortError")return;!(V!=null&&V.aborted)&&fe.current&&(p((he==null?void 0:he.message)||String(he)),v(null))}finally{!(V!=null&&V.aborted)&&fe.current&&m(!1)}}}x.useEffect(()=>{fe.current=!0;let V=null;const ie=()=>{if(ee.current)try{ee.current.abort()}catch{}ee.current=new AbortController,ae(ee.current.signal)};d||(ie(),V=setInterval(ie,5*60*1e3));const he=()=>{document.hidden?V&&(clearInterval(V),V=null):V||(V=setInterval(ie,5*60*1e3))};return document.addEventListener("visibilitychange",he),()=>{if(V&&clearInterval(V),document.removeEventListener("visibilitychange",he),ee.current)try{ee.current.abort()}catch{}fe.current=!1}},[]),x.useEffect(()=>{(async()=>{try{if(!t){Q([]);return}G(!0);const V=await vl(t.id),ie=Array.isArray(V==null?void 0:V.interests)&&V.interests.length?V.interests.join(","):void 0,he=await Al(t.id,ie);Q(Array.isArray(he)?he.slice(0,3):[])}catch{Q([])}finally{G(!1)}})()},[t==null?void 0:t.id]),x.useEffect(()=>{try{Ve.loadState();const V=Ve.getProgress();w(V.percentage),E({completed:V.completed,total:V.total}),b(Ve.getCurrentStep());const ie=he=>{b((he==null?void 0:he.step)||null);const H=Ve.getProgress();w(H.percentage),E({completed:H.completed,total:H.total})};return Ve.on("step-changed",ie),Ve.on("step-completed",ie),Ve.on("flow-completed",()=>{const he=Ve.getProgress();w(he.percentage),E({completed:he.completed,total:he.total}),b(null)}),()=>{Ve.off("step-changed",ie),Ve.off("step-completed",ie)}}catch{}},[]);function ne(){var ie;const V=Ve.getCurrentStep();((ie=V==null?void 0:V.action)==null?void 0:ie.type)==="navigate"&&V.action.target&&_(V.action.target)}function U(){Ve.startFlow("first-steps"),ne()}function R(){Ve.nextStep()&&ne()}function L(){Ve.previousStep()&&ne()}function oe(){Ve.skipStep()&&ne()}function K(){try{const V={choice:F,text:D,ts:Date.now()};localStorage.setItem("journey-feedback",JSON.stringify(V))}catch{}}const xe=x.useMemo(()=>Xa.map(V=>{const ie=V.steps.length,he=V.steps.filter(de=>Ve.isStepCompleted(de.id)).length,H=ie>0?Math.round(he/ie*100):0,me=Ve.isFlowCompleted(V.id);return{flow:V,total:ie,completed:he,percentage:H,completedFlow:me}}),[k.completed,h]),W=x.useMemo(()=>es("short"),[]);return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsxs("h1",{className:"text-4xl font-bold text-amber-400 font-serif tracking-wide",children:[et.icons.ui.guild," Jornada do HerÃ³i"]}),(()=>{const V=Ke[O||""],ie=(V==null?void 0:V.accents)||[];return ie.length?e.jsxs("div",{className:"text-2xl opacity-80",children:[ie[0],ie[1],ie[2]]}):null})()]}),e.jsx("p",{className:"text-gray-300 italic",children:"Comece, personalize e avance com clareza."})]}),e.jsxs("div",{className:"rounded-xl p-6 mb-8 bg-amber-900/10 border border-amber-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm text-amber-300 font-semibold",children:"Forjador de HerÃ³is â€” IntroduÃ§Ã£o"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{to:"/intro?version=game_intro",className:"px-3 py-1 rounded bg-amber-600 text-black text-xs",children:"Ver NarraÃ§Ã£o"}),e.jsx($e,{to:"/intro?version=cinematic",className:"px-3 py-1 rounded bg-indigo-600 text-white text-xs",children:"Ver Trailer"})]})]}),e.jsx("div",{className:"space-y-2 text-sm text-gray-200",children:W.paragraphs.map((V,ie)=>e.jsx("p",{children:V},ie))})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-8 bg-white/10 border ${S}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Progresso da Jornada"}),e.jsxs("div",{className:"text-xs text-gray-300",children:[k.completed,"/",k.total]})]}),e.jsx(Vs,{percent:y}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:L,className:"px-3 py-1 rounded bg-gray-800 text-white text-xs",children:"Voltar"}),e.jsx("button",{onClick:ne,className:`px-3 py-1 rounded bg-gradient-to-r ${yt(O)} text-white text-xs`,children:"Continuar"}),e.jsx("button",{onClick:R,className:"px-3 py-1 rounded bg-gray-800 text-white text-xs",children:"AvanÃ§ar"})]}):e.jsx("button",{onClick:U,className:`px-3 py-1 rounded bg-gradient-to-r ${yt(O)} text-white text-xs`,children:"Iniciar Tutorial"})}),h&&e.jsxs("div",{className:"mt-4 rounded-lg border border-white/20 bg-white/5 p-3","aria-live":"polite",children:[e.jsx("div",{className:"text-white font-semibold text-sm",children:h.title}),e.jsx("div",{className:"text-[13px] text-gray-300",children:h.description}),h.content&&e.jsx("div",{className:"mt-2 text-xs text-gray-300",children:h.content}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[((se=h.action)==null?void 0:se.type)==="navigate"&&h.action.target&&e.jsx("button",{onClick:ne,className:`px-2 py-1 rounded bg-gradient-to-r ${yt(O)} text-white text-xs`,children:"Ir agora"}),h.skippable&&e.jsx("button",{onClick:oe,className:"px-2 py-1 rounded bg-gray-700 text-white text-xs",children:"Pular"}),e.jsx("button",{onClick:R,className:"px-2 py-1 rounded bg-gray-800 text-white text-xs",children:"Concluir e avanÃ§ar"})]})]})]}),e.jsxs("div",{className:`rounded-xl p-4 mb-8 bg-white/10 border ${S}`,children:[e.jsx("div",{className:"text-sm text-gray-400 mb-3",children:"Rastreador de Onboarding"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:xe.map(({flow:V,total:ie,completed:he,percentage:H,completedFlow:me})=>e.jsxs("div",{className:"rounded-lg p-3 border border-white/20 bg-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-white font-semibold text-sm",children:V.name}),e.jsxs("span",{className:`text-xs ${me?"text-emerald-300":"text-gray-300"}`,children:[he,"/",ie]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(Vs,{percent:H})}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{Ve.startFlow(V.id),ne()},className:"px-2 py-1 rounded bg-gray-800 text-white text-xs",children:he>0?"Retomar":"Iniciar"}),e.jsx("button",{onClick:()=>re(J===V.id?null:V.id),className:"px-2 py-1 rounded bg-gray-700 text-white text-xs","aria-expanded":J===V.id,children:"Etapas"})]}),J===V.id&&e.jsx("div",{className:"mt-2 space-y-1",children:V.steps.map(de=>{var ve;return e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-200",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[Ve.isStepCompleted(de.id)?"âœ…":"â¬œ"," ",de.title]}),((ve=de.action)==null?void 0:ve.type)==="navigate"&&de.action.target?e.jsx("button",{onClick:()=>_(de.action.target),className:"px-2 py-1 rounded bg-gray-700 text-white",children:"Ir"}):null]},de.id)})})]},V.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:`rounded-xl p-4 bg-white/10 border ${S}`,children:[e.jsx("div",{className:"text-sm text-gray-400",children:"HerÃ³is"}),e.jsx("div",{className:"text-2xl font-bold",children:s.length})]}),e.jsxs("div",{className:`rounded-xl p-4 bg-white/10 border ${S}`,children:[e.jsx("div",{className:"text-sm text-gray-400",children:"NÃ­vel"}),e.jsx("div",{className:"text-2xl font-bold",children:((z=t==null?void 0:t.progression)==null?void 0:z.level)??1})]}),e.jsx("div",{className:`rounded-xl p-4 bg-white/10 border ${S}`,children:e.jsx(Vs,{percent:I,label:"Progresso para o prÃ³ximo nÃ­vel"})})]}),e.jsx(Fn,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ds,{title:"Criar HerÃ³i (com IA)",description:"Crie rapidamente um herÃ³i com nome, frase, imagem e histÃ³ria.",icon:"ğŸ› ï¸",ctaLabel:"Forjar HerÃ³i",to:C?`/create?ref=${C}${A?`&by=${A}`:""}`:"/create",highlight:!t,examples:["Ex: Artemis, Arqueiro","Ex: HistÃ³ria gerada pela IA"],stepIndex:1,testId:"create-hero-button"}),e.jsx(ds,{title:"Ver Galeria",description:"Visualize, edite avatares e personalize tÃ­tulos e visuais.",icon:"ğŸ–¼ï¸",ctaLabel:"Abrir Galeria",to:"/gallery",examples:["Ex: Editar avatar","Ex: Favoritar um tÃ­tulo"],stepIndex:2,testId:"open-gallery-button"}),e.jsx(ds,{title:"MissÃµes IA",description:"Aceite desafios dinÃ¢micos e faÃ§a escolhas que afetam recompensas.",icon:"ğŸ—¡ï¸",ctaLabel:"Ir para MissÃµes",to:"/quests",examples:["Ex: Escolher caminho de exploraÃ§Ã£o","Ex: Ganhar XP e ouro"],stepIndex:3,testId:"open-quests-button"}),e.jsx(ds,{title:"Evoluir HerÃ³i",description:"Acompanhe nÃ­veis, ranks e conquistas com recompensas visuais.",icon:"ğŸ†",ctaLabel:"Ver EvoluÃ§Ã£o",to:"/evolution",examples:["Ex: Subir para nÃ­vel 2","Ex: Desbloquear um tÃ­tulo"],stepIndex:4,testId:"open-evolution-button"})]}),C&&e.jsx("div",{className:"mt-6 rounded-xl p-4 bg-emerald-900/20 border border-emerald-500/40",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-emerald-300",children:"ğŸ Convite recebido"}),e.jsx("div",{className:"text-sm text-gray-200",children:"Crie seu herÃ³i com este convite para ajudar quem te convidou a ganhar bÃ´nus."})]}),e.jsx($e,{to:`/create?ref=${C}`,className:"px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-semibold",children:"Criar com convite"})]})}),e.jsxs("div",{className:"mt-10 rounded-xl p-6 bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-gray-300 text-sm mb-3",children:"No final da jornada:"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs($e,{to:"/leaderboards",className:"px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white text-sm",children:[et.icons.ui.leaderboard," Ranking"]}),e.jsx($e,{to:"/shop",className:"px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white text-sm",children:"ğŸª Loja"}),e.jsx("span",{className:"px-3 py-2 rounded-lg bg-gray-800 text-gray-400 text-sm",children:e.jsx($e,{to:"/social-events",className:"text-white hover:text-amber-300",children:"ğŸ° Comunidade"})}),e.jsx($e,{to:"/premium",className:"px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white text-sm",children:"ğŸ¨ PersonalizaÃ§Ã£o"})]})]}),e.jsxs("div",{className:"mt-6 rounded-xl p-6 bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-lg font-semibold text-white mb-2",children:"PreferÃªncias"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-gray-300",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:V=>{j(V.target.checked);try{localStorage.setItem("hfn_show_hints",V.target.checked?"1":"0")}catch{}},"aria-checked":f}),"Mostrar dicas de UI"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:V=>{T(V.target.checked);try{localStorage.setItem("hfn_skip_tutorials",V.target.checked?"1":"0")}catch{}},"aria-checked":N}),"Pular tutoriais"]}),e.jsx("button",{onClick:()=>{try{localStorage.setItem("introSeen","1")}catch{}},className:"px-3 py-1 rounded bg-gray-800 text-white",children:"Pular introduÃ§Ã£o"})]})]}),e.jsxs("div",{className:`mt-6 rounded-xl p-6 bg-white/10 border ${S}`,children:[e.jsx("div",{className:"text-lg font-semibold text-white mb-2",children:"Feedback"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>te("up"),className:`px-3 py-2 rounded ${F==="up"?"bg-emerald-700 text-white":"bg-gray-800 text-white"}`,"aria-pressed":F==="up","aria-label":"Gostei",children:"ğŸ‘ Gostei"}),e.jsx("button",{onClick:()=>te("down"),className:`px-3 py-2 rounded ${F==="down"?"bg-red-700 text-white":"bg-gray-800 text-white"}`,"aria-pressed":F==="down","aria-label":"NÃ£o gostei",children:"ğŸ‘ NÃ£o gostei"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:D,onChange:V=>$(V.target.value),placeholder:"Comente sua experiÃªncia",className:"flex-1 px-3 py-2 rounded bg-gray-800 text-white border border-white/10 text-sm","aria-label":"ComentÃ¡rio"}),e.jsx("button",{onClick:K,className:`px-3 py-2 rounded bg-gradient-to-r ${yt(O)} text-white text-sm`,children:"Enviar"})]})]})]})},fm=["short","cinematic","game_intro","topics","full"],bm={initial:{opacity:0,y:10},enter:{opacity:1,y:0,transition:{duration:.8}},exit:{opacity:0,y:-10,transition:{duration:.6}}},vm=()=>{const a=ua(),s=at.useMemo(()=>{const b=new URLSearchParams(a.search).get("version")||"short",f=fm.includes(b)?b:"game_intro",j=es(f),N=(j==null?void 0:j.lines)||(j==null?void 0:j.script)||(j==null?void 0:j.paragraphs)||[],T=(j==null?void 0:j.title)||"NarraÃ§Ã£o Inicial do Jogo",F=Array.isArray(N)?N:[];return{title:T,lines:F,isCinematic:f==="cinematic"}},[a.search]),[t,r]=x.useState(0),[i,n]=x.useState(!0),[o,c]=x.useState(!0),l=Wt(),d=x.useRef(null),m=x.useRef(null),u=x.useRef(null),p=x.useRef(null),g=x.useMemo(()=>{var h;return((h=window.speechSynthesis)==null?void 0:h.getVoices())||[]},[]),v=()=>{var $;const h=(($=window.speechSynthesis)==null?void 0:$.getVoices())||g,b=X=>{const Q=((X==null?void 0:X.name)||"").toLowerCase(),Y=((X==null?void 0:X.voiceURI)||"").toLowerCase(),G=Q+" "+Y;return G.includes("google")&&G.match(/portugu[eÃª]s|portugues/)&&G.match(/brasil|brazil|pt-br/)},f=["Google portuguÃªs do Brasil","Google PortuguÃªs do Brasil","Google PT-BR","Google Brazilian Portuguese"].map(X=>X.toLowerCase()),j=h.find(X=>f.includes((X.name||"").toLowerCase())),N=h.find(b);if(j)return j;if(N)return N;const T=X=>{const Q=(X||"").toLowerCase();return/female|femin|mulher|ana|camila|luciana|maria|vit[oÃ³]ria|helena|gabriela|bruna|carla|laura/.test(Q)},F=X=>X.length?[...X].sort((Y,G)=>Number(T(G.name))-Number(T(Y.name)))[0]:null,te=h.filter(X=>(X.lang||"").toLowerCase()==="pt-br"),D=h.filter(X=>(X.lang||"").toLowerCase().startsWith("pt"));return F(te)||F(D)||F(h)||h[0]},y=h=>Math.min(9e3,1400+45*Math.min(h.length,160)),w=(h,b)=>{try{if(!o||!window.speechSynthesis){b==null||b();return}const f=new SpeechSynthesisUtterance(h),j=v();j&&(f.voice=j),f.lang="pt-BR",f.rate=.92,f.pitch=1.08,f.onstart=()=>{},f.onend=()=>b==null?void 0:b(),f.onerror=()=>{setTimeout(()=>b==null?void 0:b(),y(h))},p.current=f,window.speechSynthesis.speak(f)}catch{b==null||b()}};x.useEffect(()=>{const h=s.lines[t];if(!i||!h)return()=>{};if(d.current&&(clearTimeout(d.current),d.current=null),o&&window.speechSynthesis){try{const f=window.speechSynthesis;(f.speaking||f.pending)&&f.cancel()}catch{}const b=setTimeout(()=>{w(h,()=>{r(f=>Math.min(f+1,s.lines.length))})},50);return()=>{clearTimeout(b),d.current&&(clearTimeout(d.current),d.current=null)}}else{const b=y(h);return d.current=window.setTimeout(()=>{r(f=>Math.min(f+1,s.lines.length))},b),()=>{d.current&&(clearTimeout(d.current),d.current=null)}}},[t,i,o,s.lines]),x.useEffect(()=>{if(!m.current){const b=`${{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"/HeroForgeNew/"||"/"}audio/intro-ambient.mp3`,f=new Audio(b);f.preload="auto",f.loop=!0,f.volume=0,m.current=f,f.play().catch(()=>{});let j=0;const N=setInterval(()=>{j=Math.min(.25,j+.02),f.volume=j,j>=.25&&clearInterval(N)},500)}if(!u.current){const b=`${{VITE_GITHUB_PAGES:"true",VITE_OPENAI_API_KEY:"demo_key_for_build",VITE_AI_SERVICE_PROVIDER:"openrouter",VITE_GOOGLE_API_KEY:"demo_key_for_build",VITE_ANTHROPIC_API_KEY:"demo_key_for_build",VITE_OPENAI_API_URL:"https://openrouter.ai/api/v1",VITE_GOOGLE_API_URL:"https://generativelanguage.googleapis.com/v1beta",VITE_ANTHROPIC_API_URL:"https://api.anthropic.com",BASE_URL:"/HeroForgeNew/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"/HeroForgeNew/"||"/"}audio/intro-crescendo.mp3`,f=new Audio(b);f.preload="auto",f.loop=!0,f.volume=0,u.current=f}return()=>{const h=m.current,b=u.current;if(h){let f=h.volume;const j=setInterval(()=>{f=Math.max(0,f-.05),h.volume=f,f<=0&&(clearInterval(j),h.pause())},150)}if(b){let f=b.volume;const j=setInterval(()=>{f=Math.max(0,f-.05),b.volume=f,f<=0&&(clearInterval(j),b.pause())},150)}}},[]),x.useEffect(()=>{const h=u.current;if(!h)return;const b=Math.floor(s.lines.length*.75);if(t>=b){h.play().catch(()=>{});let f=h.volume;const j=setInterval(()=>{f=Math.min(.35,f+.02),h.volume=f,f>=.35&&clearInterval(j)},500);return()=>clearInterval(j)}},[t]);const k=t>=s.lines.length,E=()=>{var f;(f=window.speechSynthesis)==null||f.cancel();try{localStorage.setItem("introSeen","1")}catch{}const h=m.current,b=u.current;if(h){let j=h.volume;const N=setInterval(()=>{j=Math.max(0,j-.05),h.volume=j,j<=0&&(clearInterval(N),h.pause())},150)}if(b){let j=b.volume;const N=setInterval(()=>{j=Math.max(0,j-.05),b.volume=j,j<=0&&(clearInterval(N),b.pause())},150)}l("/journey")};return x.useEffect(()=>{if(k){try{localStorage.setItem("introSeen","1")}catch{}const h=m.current,b=u.current;if(h){let f=h.volume;const j=setInterval(()=>{f=Math.max(0,f-.05),h.volume=f,f<=0&&(clearInterval(j),h.pause())},150)}if(b){let f=b.volume;const j=setInterval(()=>{f=Math.max(0,f-.05),b.volume=f,f<=0&&(clearInterval(j),b.pause())},150)}}},[k]),e.jsxs("div",{className:"min-h-screen relative overflow-hidden bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute -top-24 left-1/2 -translate-x-1/2 w-[60vw] h-[60vw] rounded-full bg-amber-500/10 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-1/4 w-[30vw] h-[30vw] rounded-full bg-indigo-500/10 blur-3xl"}),s.isCinematic&&e.jsx("div",{className:"absolute top-1/3 left-1/2 -translate-x-1/2 w-[40vw] h-[40vw] rounded-full bg-cyan-400/10 blur-3xl animate-pulse"})]}),e.jsxs("div",{className:"relative z-10 container mx-auto px-6 py-10 flex flex-col items-center text-center",children:[e.jsx("div",{className:"text-amber-400 text-sm tracking-widest uppercase mb-4","aria-live":"polite",children:s.title}),e.jsxs("div",{className:"max-w-3xl",children:[e.jsx(oa,{mode:"wait",children:!k&&e.jsx(tt.p,{variants:bm,initial:"initial",animate:"enter",exit:"exit",className:"text-xl md:text-2xl text-slate-100 font-serif leading-relaxed",children:s.lines[t]},t)}),!k&&e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-3 text-sm",children:[e.jsx("button",{className:"px-3 py-2 rounded bg-amber-600 text-white hover:bg-amber-700",onClick:()=>{n(h=>{const b=!h;return window.speechSynthesis&&o&&(b?window.speechSynthesis.resume():window.speechSynthesis.pause()),b})},"aria-label":i?"Pausar":"Reproduzir",children:i?"Pausar":"Reproduzir"}),e.jsx("button",{className:`px-3 py-2 rounded ${o?"bg-gray-700 text-gray-200 hover:bg-gray-600":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,onClick:()=>c(h=>{var f;const b=!h;if(!b)try{(f=window.speechSynthesis)==null||f.cancel()}catch{}return b}),"aria-label":o?"Desativar NarraÃ§Ã£o":"Ativar NarraÃ§Ã£o",children:o?"NarraÃ§Ã£o Ativada":"NarraÃ§Ã£o Desativada"}),e.jsx("button",{className:"px-3 py-2 rounded bg-gray-700 text-gray-200 hover:bg-gray-600",onClick:E,children:"Pular"})]})]}),k&&e.jsxs(tt.div,{initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},transition:{duration:.8},className:"mt-12 bg-slate-800/60 backdrop-blur-sm border border-amber-500/40 rounded-xl p-6 w-full max-w-xl",children:[e.jsx("div",{className:"text-4xl md:text-5xl text-amber-400 mb-2",children:"âš”ï¸"}),e.jsx("div",{className:"text-slate-200 text-lg mb-4 font-medium",children:"O selo da Guilda de Altharion brilha diante de vocÃª."}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx($e,{to:"/create",className:"px-5 py-3 rounded bg-amber-600 text-white hover:bg-amber-700 shadow",children:"Forjar HerÃ³i"}),e.jsx($e,{to:"/journey",className:"px-5 py-3 rounded bg-gray-700 text-gray-200 hover:bg-gray-600",children:"Ir ao InÃ­cio"})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-400",children:"A introduÃ§Ã£o serÃ¡ mostrada uma vez; vocÃª pode revisitÃ¡-la via /intro."})]})]})]})},Bn=[{text:"Ouvi que {npc} anda perto da taverna com segredos.",tags:["gossip"],priority:"social",weight:3},{text:"Dizem que um herÃ³i venceu um golem rachado ontem.",tags:["event"],priority:"plot",weight:4},{text:"Se precisar de mapas, tenho uns rabiscos confiÃ¡veis.",tags:["humor","event"],priority:"social",weight:2},{text:"ManhÃ£ cheia: planejo patrulhar as ruÃ­nas.",tags:["time_morning"],priority:"ambient",weight:2},{text:"Noite longa: hoje quase virei comida de troll.",tags:["time_evening"],priority:"ambient",weight:2},{text:"Festival do sol chegando, precisaremos de tochas.",tags:["seasonal"],priority:"ambient",weight:1},{text:"MissÃ£o em andamento? Posso te cobrir no flanco.",tags:["guild_mission"],priority:"plot",weight:3,requiredRelation:20},{text:"Cuidado com emboscadas no mercado subterrÃ¢neo.",tags:["warning"],priority:"urgent",weight:4},{text:"Pela barba de Merlim, seu nome ecoou pela cidade.",tags:["humor","event"],priority:"social",weight:3,requiredReputation:200},{text:"Ouvi rumores de rivalidades na guilda hoje.",tags:["gossip","guild_mission"],priority:"social",weight:2},{text:"HÃ¡ um mapa antigo apontando para um acesso secreto.",tags:["event"],priority:"plot",weight:3},{text:"Planejando missÃ£o? Dividir o loot antes evita briga.",tags:["guild_mission"],priority:"plot",weight:3},{text:"Se me pagar com poÃ§Ãµes, conto um atalho seguro.",tags:["humor","event"],priority:"social",weight:2},{text:"A chuva traz bruxas; vÃ¡ armado Ã  Floresta Umbral.",tags:["seasonal","warning"],priority:"plot",weight:3},{text:"Seu arco canta; ouvi dizer que acertou trÃªs bandidos.",tags:["humor","event"],priority:"social",weight:2},{text:"De manhÃ£ o conselho decide missÃµes difÃ­ceis.",tags:["time_morning","guild_mission"],priority:"plot",weight:2},{text:"Ã€ noite a verdade aparece: quem falhou e quem brilhou.",tags:["time_evening","guild_mission"],priority:"plot",weight:2},{text:"Quer espalhar um rumor Ãºtil? Sei a pessoa certa.",tags:["gossip"],priority:"social",weight:2},{text:"Tenho uma pista de caverna com cristais rÃºnicos.",tags:["event"],priority:"plot",weight:3},{text:"Se for com rivais, tenha um plano de fuga.",tags:["warning","guild_mission"],priority:"plot",weight:3}];function On(a,s,t,r){ft();const i=r.getHours(),n=i>=5&&i<12,o=i>=18||i<2;if(a.requiredRelation&&((s.socialRelations||{})[t.id]||0)<a.requiredRelation||a.requiredReputation&&(t.progression.reputation||0)<a.requiredReputation)return-1;let c=a.weight||1;return a.priority==="urgent"&&(c+=3),a.tags.includes("time_morning")&&n&&(c+=2),a.tags.includes("time_evening")&&o&&(c+=2),c}function Qs(a,s,t,r=3){const i=new Date;return Bn.filter(c=>t.every(l=>c.tags.includes(l))).map(c=>({l:c,s:On(c,a,s,i)})).filter(c=>c.s>=0).sort((c,l)=>l.s-c.s).slice(0,Math.max(1,r)).map(c=>c.l.text.replace("{npc}",a.name))}function ym(a,s,t=3){const r=new Date;return Bn.map(n=>({l:n,s:On(n,a,s,r)})).filter(n=>n.s>=0).sort((n,o)=>o.s-n.s).slice(0,8).map(n=>n.l.text.replace("{npc}",a.name)).slice(0,t)}function Rr(a,s,t){return Math.max(s,Math.min(t,a))}function jm(a,s){const t=(a.npcMood||"neutro")==="irritado"?"hostil":"amigÃ¡vel",r=vr(a,s,t==="amigÃ¡vel"?"amigÃ¡vel":"neutro");ge.emit({type:"quest",title:"Conversar",message:`${a.name}: relaÃ§Ã£o ${r.value}`,icon:"ğŸ’¬",duration:2e3})}function wm(a,s){const t=a.npcMood!=="irritado"&&a.npcMood!=="triste",r=t?5:-3,i={...a.socialRelations||{}},n=i[s.id]||0,o=Math.max(.2,(100-Math.max(0,n))/100),c=Math.ceil(r*o);i[s.id]=Rr(n+c,-100,100),a.socialRelations=i,ge.emit({type:t?"achievement":"stamina",title:"Elogiar",message:`${a.name} ${t?"apreciou":"nÃ£o gostou"} do elogio`,icon:t?"ğŸ™‚":"ğŸ˜ ",duration:2e3})}function Nm(a,s){var i;const t=(a.socialRelations||{})[s.id]||0;if(t>=20&&a.npcMood!=="irritado"&&a.npcMood!=="cansado"){const n=["boost_xp","stamina_refill","reduce_cooldown","boost_initiative","gold_bonus","success_boost","stamina_discount","loot_bonus","ambush_shield"],o=n[Math.floor(Math.random()*n.length)],c=Date.now(),l=t>=80?3:t>=50?2:1,d={type:o,missionsRemaining:1,expiresAt:new Date(c+2*60*60*1e3).toISOString(),level:l};if(o==="boost_xp"&&(d.boostXpPercent=l===3?.2:l===2?.15:.1),o==="boost_initiative"&&(d.initiativeBonus=l===3?8:l===2?6:5),o==="gold_bonus"&&(d.goldBonusPercent=l===3?.2:l===2?.15:.1),o==="success_boost"&&(d.successBoostPercent=l===3?.1:l===2?.07:.05),o==="stamina_discount"&&(d.staminaCostReduction=l===3?2:1),o==="loot_bonus"&&(d.lootDropBonusPercent=l===3?.25:l===2?.15:.1),o==="ambush_shield"&&(d.ambushReductionPercent=l===3?.5:l===2?.35:.2),o==="reduce_cooldown"&&(d.reduceCooldownMinutes=l===3?12:l===2?8:5),o==="stamina_refill"){const p=l===3?30:l===2?20:10,g=Math.max(0,Number(((i=s.progression)==null?void 0:i.fatigue)||0)),v=Math.max(0,g-p);d.staminaRefillAmount=p,Z.getState().updateHero(s.id,{progression:{...s.progression||{},fatigue:v}})}const m={...s.stats||{}};m.helpStatus=d,Z.getState().updateHero(s.id,{stats:m});const u=o==="boost_xp"?`+${Math.round((d.boostXpPercent||0)*100)}% XP na prÃ³xima missÃ£o`:o==="stamina_refill"?`Fadiga -${d.staminaRefillAmount||10}`:o==="reduce_cooldown"?`Cooldown -${d.reduceCooldownMinutes||5} min na prÃ³xima missÃ£o`:o==="boost_initiative"?`+${d.initiativeBonus||5} Iniciativa na prÃ³xima missÃ£o`:o==="gold_bonus"?`+${Math.round((d.goldBonusPercent||0)*100)}% ouro na prÃ³xima missÃ£o`:o==="success_boost"?`+${Math.round((d.successBoostPercent||0)*100)}% chance de sucesso nas fases`:o==="stamina_discount"?`Custo de Fadiga reduzido em ${d.staminaCostReduction||1}`:o==="loot_bonus"?`Chance de loot +${Math.round((d.lootDropBonusPercent||0)*100)}%`:`ProteÃ§Ã£o contra emboscada (${Math.round((d.ambushReductionPercent||0)*100)}% menos risco/dano)`;ge.emit({type:"achievement",title:"Ajuda concedida",message:`${a.name}: ${u}`,icon:"ğŸ¤",duration:2500})}else ge.emit({type:"stamina",title:"Pedir ajuda",message:`${a.name} recusou`,icon:"âœ‹",duration:2e3})}function Sm(a,s,t){const r=t.includes("pocao")?"guerreiro":t.includes("pedra")||t.includes("arcane")?"mago":t.includes("flor")||t.includes("vinculo")?"social":"neutro";let i=4;r==="guerreiro"&&(a.class==="guerreiro"||a.class==="paladino")&&(i=7),r==="mago"&&(a.class==="mago"||a.class==="feiticeiro")&&(i=7),r==="social"&&(i=6);const n={...a.socialRelations||{}},o=n[s.id]||0,c=Math.max(.2,(100-Math.max(0,o))/100),l=Math.ceil(i*c);n[s.id]=Rr(o+l,-100,100),a.socialRelations=n;const d={...a.npcMemory||{}},m={...d.giftStatsByHeroId||{}},u=t.includes("lendario")||t.includes("deluxe")?3:t.includes("epico")?2:1,p=m[s.id]||{count:0,quality:0},g={count:p.count+1,quality:p.quality+u};if(m[s.id]=g,d.giftStatsByHeroId=m,Z.getState().updateHero(a.id,{npcMemory:d}),ge.emit({type:"achievement",title:"Presente",message:`${a.name} gostou do presente (${t})`,icon:"ğŸ",duration:2e3}),g.count>=3&&g.quality>=5)try{const v=t.includes("pocao")?"pergaminho-protecao":t.includes("pedra")?"essencia-vinculo":"racao-basica";Z.getState().addItemToInventory(s.id,v,1),ge.emit({type:"achievement",title:"Recompensa de Presente",message:`${a.name} te deu ${v} em agradecimento!`,icon:"ğŸ…",duration:3e3})}catch{}}function Cm(a,s){const t={...a.socialRelations||{}};t[s.id]=Rr((t[s.id]||0)-8,-100,100),a.socialRelations=t,ge.emit({type:"stamina",title:"Provocar",message:`${a.name} ficou irritado`,icon:"âš ï¸",duration:2e3})}const Xs=({color:a,icon:s,label:t})=>e.jsxs("span",{className:"px-2 py-1 rounded text-xs font-medium border",style:{borderColor:a,color:a},children:[e.jsx("span",{className:"mr-1",children:s}),t]}),km=()=>{var te;const{heroes:a,getSelectedHero:s,setNPCInteractionOverlay:t}=Z(),r=Z(D=>D.updateHero),i=Z(D=>D.restAtTavern),{activeSeasonalTheme:n}=Qe(),o=n&&((te=Ke[n])==null?void 0:te.border)||"border-amber-600/30",c=s(),l=x.useMemo(()=>a.filter(D=>D.origin==="npc"),[a]),[d,m]=x.useState([]);x.useEffect(()=>{const D=l.map(Q=>Q.id);function $(Q,Y){const G=[...Q];for(let J=G.length-1;J>0;J--){const re=Math.floor(Math.random()*(J+1));[G[J],G[re]]=[G[re],G[J]]}return G.slice(0,Math.max(0,Math.min(6,G.length)))}m($(D));const X=setInterval(()=>{const Q=l.map(Y=>Y.id);m($(Q))},6e4);return()=>clearInterval(X)},[l.length]);const[u,p]=x.useState(null);if(!c||l.length===0)return null;const g=l.find(D=>D.id===u)||l.find(D=>d.includes(D.id))||l[0],v=ym(g,c,1),y=Qs(g,c,["time_morning"],1),w=Qs(g,c,["time_evening"],1),k=Qs(g,c,["gossip"],1),E=Array.from(new Set([k[0],v[0],y[0],w[0]].filter(Boolean))),[h,b]=x.useState(null);x.useEffect(()=>{let D=!1;return(async()=>{var $,X;try{const Q=(g.npcRoutine||[]).find(A=>{const[O,S]=(A.start||"00:00").split(":").map(Number),[I,ae]=(A.end||"23:59").split(":").map(Number),ne=new Date().getHours();return ne>=O&&ne<I}),Y=(Q==null?void 0:Q.activity)||"exploracao",G=g.npcMood||"neutro",J=(g.socialRelations||{})[c.id]||0,re=`Atividade atual: ${Y}. Humor: ${G}. RelaÃ§Ã£o com ${c.name}: ${J}. PreferÃªncias: ${JSON.stringify((($=g.npcMemory)==null?void 0:$.preferences)||{})}. Ãšltimas interaÃ§Ãµes: ${(((X=g.npcMemory)==null?void 0:X.interactions)||[]).slice(-3).map(A=>A.summary).join(", ")}`,ee="VocÃª Ã© um NPC de fantasia. Gere um Ãºnico comentÃ¡rio curto e contextual (mÃ¡x. 1 linha), em PT-BR, baseado na rotina atual, humor e memÃ³rias. Evite repetiÃ§Ã£o e clichÃªs. Somente texto do NPC.",fe=`Crie uma fala Ãºnica e original relacionada Ã  ${Y}, refletindo o humor ${G}, mencionando discretamente um detalhe da rotina ou local, para o herÃ³i ${c.name}.`,C=((await sa.generateTextSafe({systemMessage:ee,prompt:fe,context:re,maxTokens:120,temperature:.8})).text||"").split(`
`).map(A=>A.trim()).filter(Boolean).map(A=>A.replace(/^NPC:\s*/i,"")).filter(A=>A.length>0).slice(0,1);!D&&C.length&&b(C)}catch{D||b(null)}})(),()=>{D=!0}},[g.id,c.id,g.npcMood]);const f=h&&h.length?h:E.slice(0,1),j=(g.socialRelations||{})[c.id]||0,N=j>=40?"feliz":j>=20?"tranquilo":g.npcMood,T=N==="feliz"?"ğŸ˜„":N==="tranquilo"?"ğŸ™‚":N==="neutro"?"ğŸ˜":N==="estressado"?"ğŸ˜£":N==="irritado"?"ğŸ˜¡":N==="triste"?"ğŸ˜¢":"ğŸ˜´",F=g.npcNeeds||{fadiga:20,fome:20,social:50,aventura:40,tarefa:40};return e.jsxs("div",{className:`${Me.cardBase} border ${o}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ğŸº Taverna"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xs,{color:"#F59E0B",icon:"ğŸŸ ",label:"Ambiental"}),e.jsx(Xs,{color:"#10B981",icon:"ğŸŸ¢",label:"Social"}),e.jsx(Xs,{color:"#EF4444",icon:"ğŸ”´",label:"Urgente"})]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:(d.length?d:l.slice(0,6).map(D=>D.id)).map(D=>l.find($=>$.id===D)).filter(Boolean).map(D=>e.jsx("button",{onClick:()=>p(D.id),className:`px-2 py-1 rounded border ${u===D.id?Me.tabActive:Me.tabInactive}`,children:D.name},D.id))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-300",children:[e.jsxs("span",{children:["Mood: ",T]}),e.jsxs("span",{children:["ğŸ’¤ ",F.fadiga,"%"]}),e.jsxs("span",{children:["ğŸ— ",F.fome,"%"]}),e.jsxs("span",{children:["ğŸ’¬ ",F.social,"%"]}),e.jsxs("span",{children:["âš”ï¸ ",F.aventura,"%"]}),e.jsxs("span",{children:["ğŸ”§ ",F.tarefa,"%"]})]}),f.map((D,$)=>e.jsxs("div",{className:"p-2 rounded border bg-gray-900 border-gray-700",children:[g.name,": ",D]},`l-${$}`))]}),(()=>{const D=c.stats||{},X=(D.lastInteractionByNpcId||{})[g.id],Q=!!X&&new Date(X).toDateString()===new Date().toDateString(),Y=ft().dailyNpcInteractionsLimit??2,G=D.dailyNpcInteractionsDate,J=D.dailyNpcInteractionsCount||0,re=new Date().toDateString(),fe=!(!!G&&new Date(G).toDateString()===re)||J<Y,_=!Q&&fe,P=()=>{const C={...c.stats.lastInteractionByNpcId,[g.id]:new Date().toISOString()},A={...c.stats},O=A.dailyNpcInteractionsDate,S=A.dailyNpcInteractionsCount||0,ae=!!O&&new Date(O).toDateString()===re?S+1:1,ne={...A,lastInteractionByNpcId:C,dailyNpcInteractionsDate:new Date().toISOString(),dailyNpcInteractionsCount:ae};Z.getState().updateHero(c.id,{stats:ne})},M=C=>{_&&(C(),P())};return e.jsxs("div",{children:[e.jsxs("div",{className:"mt-3 flex items-center gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>M(()=>jm(g,c)),className:`px-3 py-2 rounded ${_?`bg-gradient-to-r ${et.gradients.buttons.secondary} text-white`:"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"ğŸ’¬ Conversar"}),e.jsx("button",{onClick:()=>M(()=>wm(g,c)),className:`px-3 py-2 rounded ${_?`bg-gradient-to-r ${et.gradients.buttons.royal} text-white`:"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"ğŸ˜Š Elogiar"}),e.jsx("button",{onClick:()=>M(()=>Nm(g,c)),className:`px-3 py-2 rounded ${_?`bg-gradient-to-r ${et.gradients.buttons.primary} text-white`:"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"ğŸ¤ Pedir Ajuda"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{id:"gift-type",className:"px-2 py-1 border rounded text-sm bg-gray-900 text-gray-200 border-gray-700",children:[e.jsx("option",{value:"pocao-media",children:"PoÃ§Ã£o"}),e.jsx("option",{value:"flor-rara",children:"Flor"}),e.jsx("option",{value:"pedra-magica",children:"Pedra"}),e.jsx("option",{value:"essencia-vinculo",children:"EssÃªncia"})]}),e.jsx("button",{onClick:()=>{var A;const C=((A=document.getElementById("gift-type"))==null?void 0:A.value)||"pocao-media";M(()=>Sm(g,c,C))},className:`px-3 py-2 rounded ${_?`bg-gradient-to-r ${et.gradients.buttons.success} text-white`:"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"ğŸ Dar Presente"})]}),e.jsx("button",{onClick:()=>M(()=>Cm(g,c)),className:`px-3 py-2 rounded ${_?`bg-gradient-to-r ${et.gradients.buttons.danger} text-white`:"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"âš ï¸ Provocar"}),e.jsx("button",{onClick:()=>{if(!_)return;if(i(c.id,25,25,"short_rest")){const A={...c.stats},O=ft(),S=new Date(Date.now()+(O.restBuffDurationMinutes||10)*60*1e3).toISOString();r(c.id,{stats:{...A,restBuffActiveUntil:S}})}P()},className:`px-3 py-2 rounded ${_?`bg-gradient-to-r ${et.gradients.buttons.secondary} text-white`:"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"ğŸ›Œ Descansar"}),e.jsx("button",{onClick:()=>M(()=>{const C={...c.stats},A=C.meditationBuffCooldownEndsAt?new Date(C.meditationBuffCooldownEndsAt).getTime():0;if(A&&Date.now()<A)return;const O=ft(),S=new Date(Date.now()+(O.meditationDurationMinutes||2)*60*1e3).toISOString(),I=new Date(Date.now()+(O.meditationCooldownMinutes||10)*60*1e3).toISOString();r(c.id,{stats:{...C,meditationBuffActiveUntil:S,meditationBuffCooldownEndsAt:I}})}),className:"px-3 py-2 rounded bg-purple-700 text-white",children:"ğŸ§˜ Meditar"})]}),(()=>{var S;const C=(S=c.stats)==null?void 0:S.helpStatus;if(!C||C.expiresAt&&Date.now()>new Date(C.expiresAt).getTime())return null;const A=C.type==="boost_xp"?`Ajuda ativa: +${Math.round((C.boostXpPercent||0)*100)}% XP na prÃ³xima missÃ£o`:C.type==="stamina_refill"?`Ajuda ativa: Stamina recuperada (+${C.staminaRefillAmount||10})`:C.type==="reduce_cooldown"?`Ajuda ativa: Reduz cooldown de missÃ£o em ${C.reduceCooldownMinutes||5} min`:C.type==="boost_initiative"?`Ajuda ativa: +${C.initiativeBonus||5} Iniciativa na prÃ³xima missÃ£o`:C.type==="gold_bonus"?`Ajuda ativa: +${Math.round((C.goldBonusPercent||0)*100)}% ouro na prÃ³xima missÃ£o`:C.type==="success_boost"?`Ajuda ativa: +${Math.round((C.successBoostPercent||0)*100)}% chance de sucesso`:C.type==="stamina_discount"?`Ajuda ativa: Custo de Stamina reduzido em ${C.staminaCostReduction||1}`:C.type==="loot_bonus"?`Ajuda ativa: Chance de loot +${Math.round((C.lootDropBonusPercent||0)*100)}%`:`Ajuda ativa: ProteÃ§Ã£o contra emboscada (${Math.round((C.ambushReductionPercent||0)*100)}% menos risco/dano)`,O=C.type==="boost_xp"?"â­":C.type==="stamina_refill"?"ğŸ’¤":C.type==="reduce_cooldown"?"â±ï¸":C.type==="gold_bonus"?"ğŸª™":C.type==="success_boost"?"ğŸ¯":C.type==="stamina_discount"?"ğŸ’ª":C.type==="loot_bonus"?"ğŸ":"ğŸ›¡ï¸";return e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-purple-900/30 border border-purple-600/30 text-purple-200 inline-flex items-center gap-2",children:[O," ",A]})})(),(()=>{const C=c.stats||{},A=C.restBuffActiveUntil?new Date(C.restBuffActiveUntil).getTime():0,O=C.meditationBuffActiveUntil?new Date(C.meditationBuffActiveUntil).getTime():0,S=C.meditationBuffCooldownEndsAt?new Date(C.meditationBuffCooldownEndsAt).getTime():0,I=[];return A&&Date.now()<A&&I.push("Descanso ativo"),O&&Date.now()<O&&I.push("MeditaÃ§Ã£o ativa"),S&&Date.now()<S&&!(O&&Date.now()<O)&&I.push("MeditaÃ§Ã£o em cooldown"),I.length?e.jsx("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-indigo-900/30 border border-indigo-600/30 text-indigo-200 inline-flex items-center gap-2",children:I.join(" â€¢ ")}):null})()]})})()]})};async function Js(a){try{const s=await fetch("/api/tavern?action=dice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await s.json().catch(()=>({}));return s.ok?{ok:!0}:{ok:!1,error:(t==null?void 0:t.error)||"Falha ao registrar evento de dados"}}catch(s){return{ok:!1,error:(s==null?void 0:s.message)||"Erro desconhecido ao registrar evento de dados"}}}async function Am(){try{const a=await fetch("/api/tavern?action=settings-get",{method:"GET"}),s=await a.json().catch(()=>({}));if(!a.ok)return{settings:{},error:(s==null?void 0:s.error)||"Falha ao obter configuraÃ§Ãµes"};const t=Array.isArray(s==null?void 0:s.settings)?s.settings:[],r={};return t.forEach(i=>{i&&i.key&&(r[i.key]=String(i.value||""))}),{settings:r}}catch(a){return{settings:{},error:(a==null?void 0:a.message)||"Erro ao obter configuraÃ§Ãµes"}}}async function Mm(a){try{const s=await fetch("/api/tavern?action=reroll-usage-increment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({heroId:a})}),t=await s.json().catch(()=>({}));return s.ok?{ok:!!(t!=null&&t.ok),count:t==null?void 0:t.count,cap:t==null?void 0:t.cap,reason:t==null?void 0:t.reason}:{ok:!1,error:(t==null?void 0:t.error)||"Falha ao incrementar"}}catch(s){return{ok:!1,error:(s==null?void 0:s.message)||"Erro ao incrementar"}}}const Em=a=>[`Ouvi dizer que um dragÃ£o despertou nas minas do 12Âº andarâ€¦ (${new Date().toISOString().slice(0,10)})`,`AlguÃ©m viu o novo aventureiro ${a||"um herÃ³i misterioso"}? Derrotou um troll sozinho!`,"Dizem que o Festival de Lorien comeÃ§a amanhÃ£ â€” tragam suas moedas raras!","O mago da Torre de Cristal anda nervosoâ€¦ algo sobre um artefato perdido."],Ii=["ğŸ» PromoÃ§Ã£o: hidromel por metade do preÃ§o atÃ© o pÃ´r do sol!","ğŸ­ Concurso de histÃ³rias: melhor conto ganha um tÃ­tulo temporÃ¡rio.","ğŸ² Noite de dados: quem tirar 20 ganha medalha no perfil!","ğŸ¶ Bardo itinerante: canÃ§Ãµes Ã©picas apÃ³s o cair da noite.","ğŸ•¯ï¸ Velas da sorte: acenda uma e receba um pequeno bÃ´nus de XP."];function Rm(){const a=Math.floor(Date.now()/864e5)%Ii.length;return Ii[a]}const Pm=()=>{var O;const{getSelectedHero:a,restAtTavern:s}=Z(),t=a(),{activeSeasonalTheme:r}=Qe(),[i,n]=x.useState("npcs");x.useState([]);const[o,c]=x.useState([]);x.useState(!1),x.useState(void 0);const[l,d]=x.useState(60);x.useState({});const[m,u]=x.useState("all"),[p,g]=x.useState(null),[v,y]=x.useState(void 0),[w,k]=x.useState(null),[E,h]=x.useState(!1),[b,f]=x.useState(null),[j,N]=x.useState(!1),[T,F]=x.useState(null),[te,D]=x.useState(5),[$,X]=x.useState(10),[Q,Y]=x.useState([]),G=()=>{var I;const S=Z.getState().getSelectedHero();return S?Number(((I=S.stats)==null?void 0:I.tavernRerollTokens)||0):0},J=()=>{const S=Z.getState().getSelectedHero();if(!S)return{count:0,cap:te};const I=S.stats||{},ae=I.tavernRerollDate?new Date(I.tavernRerollDate):null,ne=new Date;return{count:ae&&ae.toDateString()===ne.toDateString()?Number(I.tavernRerollCount||0):0,cap:te}},re=()=>{const S=Z.getState().getSelectedHero();if(!S)return{count:0,cap:$};const I=S.stats||{},ae=I.tavernRollDate?new Date(I.tavernRollDate):null,ne=new Date;return{count:ae&&ae.toDateString()===ne.toDateString()?Number(I.tavernRollCount||0):0,cap:$}},ee=x.useMemo(()=>Em(t==null?void 0:t.name),[t==null?void 0:t.name]),fe=x.useMemo(()=>Rm(),[]),_=Z.getState().heroes,P=x.useMemo(()=>_.filter(S=>S.origin==="npc"),[_.length]);x.useState(null);const M=async()=>{const S=Z.getState(),ae=(S.heroes||[]).filter(oe=>oe.origin==="npc"),ne=new Date().toDateString(),U=Math.min(8,ae.length),R=ae.slice().sort(()=>Math.random()-.5).slice(0,U),L=[];for(const oe of R){const K=oe.stats||{};if((K.tavernDiceLastDate?new Date(K.tavernDiceLastDate).toDateString():"")===ne)continue;const W=Math.floor(Math.random()*20)+1,B=W===20;L.push({id:oe.id,name:oe.name,roll:W,critical:B});try{gt.tavernDice({heroId:oe.id,heroName:oe.name,heroClass:oe.class,heroLevel:oe.progression.level,roll:W,critical:B})}catch{}try{await Js({heroId:oe.id,heroName:oe.name,roll:W,critical:B})}catch{}const z={stats:{...K,tavernDiceLastDate:new Date().toISOString(),tavernDiceLastRoll:W,tavernDiceRolls:(K.tavernDiceRolls||0)+1,tavernCrits:(K.tavernCrits||0)+(B?1:0),tavernBestRoll:Math.max(W,K.tavernBestRoll||0)}};if(B){try{S.gainXP(oe.id,100)}catch{}const V={id:"mestre-dos-dados",name:"Mestre dos Dados",description:"Obteve um crÃ­tico (20) na Noite de Dados",rarity:"especial",category:"special",badge:"ğŸ²",unlockedAt:new Date};(oe.titles||[]).some(he=>he.id==="mestre-dos-dados")||(z.titles=[...oe.titles||[],V])}try{S.updateHero(oe.id,z)}catch{}}L.length&&Y(L)},C=()=>{const S=Z.getState(),I=S.availableQuests||[],ae=new Set(I.map(oe=>String(oe.id))),ne=S.getSelectedHero(),U=Math.max(1,(ne==null?void 0:ne.progression.level)||1),L=[{id:"tavern-delivery",title:"Entrega de Barris",description:"Leve barris do depÃ³sito Ã  Ã¡rea do balcÃ£o sem derramar.",type:"contrato",difficulty:"facil",levelRequirement:U,rewards:{gold:20,xp:25},repeatable:!0,sticky:!0,categoryHint:"controle",biomeHint:"cidade",narrative:{intro:"O taberneiro precisa de ajuda com um carregamento.",situation:"Mover barris com cuidado pelo salÃ£o."}},{id:"tavern-help",title:"Ajudar o Taberneiro",description:"Sirva clientes e acalme uma discussÃ£o antes que vire confusÃ£o.",type:"historia",difficulty:"medio",levelRequirement:U,rewards:{gold:30,xp:40},repeatable:!0,sticky:!0,categoryHint:"especial",biomeHint:"cidade",narrative:{intro:"Hora do pico, o salÃ£o estÃ¡ cheio.",situation:"Manter a ordem e atender pedidos."}},{id:"tavern-bard",title:"Evento do Bardo",description:"Auxilie o bardo com o set, promova o show e gerencie o pÃºblico.",type:"historia",difficulty:"medio",levelRequirement:U,rewards:{gold:25,xp:50},repeatable:!0,sticky:!0,categoryHint:"especial",biomeHint:"cidade",narrative:{intro:"O bardo itinerante precisa de suporte.",situation:"Garantir que o espetÃ¡culo ocorra sem incidentes."}}].filter(oe=>!ae.has(String(oe.id)));L.length&&Z.setState({availableQuests:[...L,...I]})};x.useEffect(()=>{o.length||(c(ee),g(new Date().toISOString()))},[ee]),x.useEffect(()=>{let S=null;return i==="npcs"&&(S=setInterval(()=>{try{on(t,P,ge.emit)}catch{}},3e4)),()=>{if(S)try{clearInterval(S)}catch{}}},[i,t==null?void 0:t.id,P.length]),x.useEffect(()=>{C()},[t==null?void 0:t.id]),x.useEffect(()=>{try{Z.getState().triggerAutoInteraction("tavern")}catch{}},[t==null?void 0:t.id]),x.useEffect(()=>{(async()=>{var S,I;try{const ae=await Am(),ne=(S=ae.settings)==null?void 0:S.reroll_daily_cap,U=Number(ne);!isNaN(U)&&U>0&&D(U);const R=(I=ae.settings)==null?void 0:I.roll_daily_cap,L=Number(R);!isNaN(L)&&L>0&&X(L)}catch{}})()},[]),x.useEffect(()=>{y(void 0)},[i]),x.useEffect(()=>(i==="eventos"&&M(),()=>{}),[i,m,l]);const A=r&&((O=Ke[r])==null?void 0:O.border)||"border-white/20";return e.jsx("div",{className:"max-w-5xl mx-auto p-6",children:e.jsxs("div",{className:`bg-white/10 border ${A} rounded-lg p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-royal-900/20 via-amber-800/10 to-transparent px-3 py-2 rounded",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-amber-300",children:'ğŸº Taverna "PÃ´nei Saltitante"'}),e.jsx("p",{className:"text-sm text-gray-300",children:"Rumores, comunidade e roleplay assÃ­ncrono."}),t&&(()=>{var oe;const S=new Date,I=new Date(S.getTime()-7*24*60*60*1e3),ne=vt.getActivityFeed({dateRange:{start:I,end:S},showOnlyPublic:!0}).activities.filter(K=>K.type==="tavern-dice"||K.type==="tavern-rest"),U={};ne.forEach(K=>{const xe=K.data.heroName;if(!xe)return;const W=K.type==="tavern-dice",B=K.type==="tavern-rest",se=W?+!!K.data.critical:0;U[xe]=(U[xe]||0)+(W?se*10+2:B?1:0)});const L=(oe=Object.entries(U).sort((K,xe)=>xe[1]-K[1])[0])==null?void 0:oe[0];return L&&L===t.name?e.jsx("span",{className:"mt-1 inline-flex items-center gap-1 text-xs text-amber-300",children:"ğŸ‘‘ CampeÃ£o da Semana"}):null})()]}),e.jsx("div",{className:"text-3xl",children:"ğŸ§™â€â™‚ï¸"})]}),e.jsx("div",{className:"mt-3 bg-amber-900/30 border border-amber-500/40 text-amber-200 text-xs md:text-sm px-3 py-2 rounded",children:"Ambiente focado em single-player: interaja com NPCs, eventos e descanso."}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>n("npcs"),className:`px-3 py-2 rounded ${i==="npcs"?Me.tabActive:Me.tabInactive}`,children:"ğŸ§‘â€ğŸ¤ NPCs"}),e.jsx("button",{onClick:()=>n("eventos"),className:`px-3 py-2 rounded ${i==="eventos"?Me.tabActive:Me.tabInactive}`,children:"ğŸ‰ Eventos da Taverna"}),e.jsx("button",{onClick:()=>n("descanso"),className:`px-3 py-2 rounded ${i==="descanso"?Me.tabActive:Me.tabInactive}`,children:"ğŸ›ï¸ Descanso"})]}),i==="npcs"&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(km,{}),e.jsx(Tn,{})]}),null,i==="eventos"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-amber-300 mb-2",children:"Eventos de Hoje"}),e.jsx("div",{className:"bg-gray-800/60 border border-white/10 rounded p-3 text-gray-200",children:fe}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"Uma fofoca diferente surge a cada dia. Participe para ganhar prestÃ­gio!"}),e.jsxs("div",{className:"mt-6 bg-gradient-to-br from-royal-900/30 via-amber-800/10 to-transparent border border-amber-500/30 rounded p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-300 flex items-center gap-2",children:"ğŸ² Noite de Dados Especial"}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:'Role um d20. Se tirar 20 (crÃ­tico): medalha por 7 dias, tÃ­tulo "Mestre dos Dados" e +100 XP.'}),e.jsxs("div",{className:"mt-3 flex items-center gap-3 flex-wrap",children:[e.jsx("button",{onClick:async()=>{if(E)return;const S=re();if(S.count>=S.cap){F("Limite diÃ¡rio de rolagens atingido");return}h(!0),N(!1),F(null),await new Promise(ne=>setTimeout(ne,600));const I=Math.floor(Math.random()*20)+1;f(I);const ae=I===20;if(t){try{gt.tavernDice({heroId:t.id,heroName:t.name,heroClass:t.class,heroLevel:t.progression.level,roll:I,critical:ae,betAmount:betAmount>0?betAmount:void 0})}catch{}try{await Js({heroId:t.id,heroName:t.name,roll:I,critical:ae,betAmount:betAmount>0?betAmount:void 0})}catch{}try{const ne=Z.getState().getSelectedHero();if(ne){const U={...ne.stats||{}};U.tavernRollDate=new Date().toISOString(),U.tavernRollCount=(U.tavernRollCount||0)+1,U.tavernDiceRolls=(U.tavernDiceRolls||0)+1,U.tavernCrits=(U.tavernCrits||0)+(ae?1:0),U.tavernBestRoll=Math.max(I,U.tavernBestRoll||0),Z.getState().updateHero(ne.id,{stats:U})}}catch{}}if(ae&&t){N(!0),F("CRÃTICO! VocÃª ganhou medalha, tÃ­tulo e +100 XP");try{ge.emit({type:"achievement",title:"CrÃ­tico na Taverna!",message:"+100 XP â€¢ Mestre dos Dados",icon:"ğŸ²",duration:3500})}catch{}try{Z.getState().gainXP(t.id,100)}catch{}try{const ne={id:"mestre-dos-dados",name:"Mestre dos Dados",description:"Obteve um crÃ­tico (20) na Noite de Dados",rarity:"especial",category:"special",badge:"ğŸ²",unlockedAt:new Date};Z.getState().addTitleToSelectedHero(ne,!1)}catch{}try{const ne=Z.getState().getSelectedHero();if(ne){const U=new Date(Date.now()+6048e5).toISOString(),R={...ne.stats||{}};R.profileMedal={icon:"ğŸ…",name:"Mestre dos Dados",expiresAt:U},Z.getState().updateHero(ne.id,{stats:R})}}catch{}}else F("Nada mal â€” continue tentando pelo crÃ­tico!");h(!1)},className:`px-4 py-2 rounded ${E?"bg-gray-700 text-gray-300":`bg-gradient-to-r ${yt(r)} text-white`}`,children:E?"Rolandoâ€¦":"Rolar d20"}),e.jsxs("div",{className:"relative min-w-[100px] h-[36px] flex items-center justify-center",children:[j&&e.jsx("div",{className:"dice-crit-ring"}),j&&e.jsx("div",{className:"dice-crit-sparkle"}),e.jsx("div",{className:`text-center text-2xl font-bold ${j?"text-amber-300 dice-crit-number":"text-gray-200"}`,children:b!==null?b:"â€”"})]}),T&&e.jsx("span",{className:"text-xs text-amber-300",children:T}),e.jsxs("div",{className:"ml-auto text-xs text-gray-300 flex items-center gap-2",children:[e.jsxs("span",{children:["Fichas: ",e.jsx("span",{className:"text-amber-300 font-semibold",children:G()})]}),(()=>{const I=Z.getState().getSelectedHero()?J():{count:0,cap:te};return e.jsxs("span",{children:["Hoje: ",e.jsxs("span",{className:"text-amber-300 font-semibold",children:[I.count,"/",I.cap]})]})})(),(()=>{const I=Z.getState().getSelectedHero()?re():{count:0,cap:$};return e.jsxs("span",{children:["Rolagens: ",e.jsxs("span",{className:"text-amber-300 font-semibold",children:[I.count,"/",I.cap]})]})})(),e.jsx("button",{onClick:async()=>{const S=Z.getState().getSelectedHero();if(!S||b===null||G()<=0||E)return;try{const U=await Mm(S.id);if(!U.ok&&U.reason==="cap"){F("Limite diÃ¡rio de rerrolagens atingido");return}U.cap&&U.count!==void 0&&D(Number(U.cap))}catch{}h(!0),N(!1),await new Promise(U=>setTimeout(U,400));const ae=Math.floor(Math.random()*20)+1;f(ae);const ne=ae===20;try{const U={...S.stats||{}};U.tavernRerollTokens=Math.max(0,(U.tavernRerollTokens||0)-1),U.tavernRerollDate=new Date().toISOString(),U.tavernRerollCount=(U.tavernRerollCount||0)+1,U.tavernDiceRolls=(U.tavernDiceRolls||0)+1,U.tavernCrits=(U.tavernCrits||0)+(ne?1:0),U.tavernBestRoll=Math.max(ae,U.tavernBestRoll||0),Z.getState().updateHero(S.id,{stats:U})}catch{}try{gt.tavernDice({heroId:S.id,heroName:S.name,heroClass:S.class,heroLevel:S.progression.level,roll:ae,critical:ne})}catch{}try{await Js({heroId:S.id,heroName:S.name,roll:ae,critical:ne})}catch{}if(ne){try{ge.emit({type:"achievement",title:"CrÃ­tico (rerrolado)!",message:"+100 XP â€¢ Mestre dos Dados",icon:"ğŸ²",duration:3500})}catch{}try{Z.getState().gainXP(S.id,100)}catch{}}h(!1)},className:`px-3 py-1 rounded ${G()>0?"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-700 text-gray-400"}`,disabled:G()<=0||E||b===null,children:"Rerrolar"})]})]}),Q.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-gray-200",children:[e.jsx("div",{className:"font-semibold text-amber-300 mb-1",children:"Participantes NPCs (hoje)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:Q.map(S=>e.jsxs("div",{className:"px-2 py-1 rounded border border-white/10 bg-black/20 flex items-center justify-between",children:[e.jsx("span",{children:S.name}),e.jsxs("span",{className:S.critical?"text-amber-300 font-bold":"text-gray-200",children:[S.roll,S.critical?" â€¢ CRÃTICO":""]})]},S.id))})]})]}),e.jsxs("div",{className:"mt-6 bg-gradient-to-br from-indigo-900/30 via-amber-800/10 to-transparent border border-indigo-500/30 rounded p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-300 flex items-center gap-2",children:"ğŸƒ Jogo das Cartas"}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Puxe 3 cartas (1â€“10). Soma das 2 maiores define o placar contra um NPC."}),t&&(()=>{const S=t.stats||{},I=Number(S.miniCardsWins||0),ae=Number(S.miniCardsLosses||0),ne=Number(S.miniCardsBestScore||0);return e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:["Placar pessoal: ",I," vitÃ³rias â€¢ ",ae," derrotas â€¢ melhor ",ne]})})(),e.jsxs("div",{className:"mt-3 flex items-center gap-3 flex-wrap",children:[e.jsx("button",{onClick:()=>{const S=Z.getState().getSelectedHero();if(!S)return;const I=()=>[1,2,3].map(()=>Math.floor(Math.random()*10)+1).sort((xe,W)=>W-xe).slice(0,2).reduce((xe,W)=>xe+W,0),ae=I(),U=(Z.getState().heroes||[]).filter(xe=>xe.origin==="npc"),R=U.length?U[Math.floor(Math.random()*U.length)]:void 0,L=I(),oe=ae>L,K={...S.stats||{}};K.miniCardsWins=Number(K.miniCardsWins||0)+(oe?1:0),K.miniCardsLosses=Number(K.miniCardsLosses||0)+(oe?0:1),K.miniCardsBestScore=Math.max(Number(K.miniCardsBestScore||0),ae),K.miniCardsLastDate=new Date().toISOString(),Z.getState().updateHero(S.id,{stats:K});try{Z.getState().updateAchievementProgress()}catch{}if(oe){try{Z.getState().gainXP(S.id,35)}catch{}try{ge.emit({type:"achievement",title:"VitÃ³ria nas Cartas",message:`Placar ${ae} â€¢ +35 XP`,icon:"ğŸƒ",duration:3e3})}catch{}}else try{ge.emit({type:"info",title:"Derrota nas Cartas",message:`NPC marcou ${L}`,icon:"ğŸƒ",duration:2500})}catch{}Y(xe=>{const W=(R==null?void 0:R.id)||`npc-${Date.now()}`,B=(R==null?void 0:R.name)||"NPC",se=L,z=!1;return[...xe.filter(V=>V.id!==W),{id:W,name:B,roll:se,critical:z}]})},className:"px-4 py-2 rounded bg-indigo-600 hover:bg-indigo-700 text-white",children:"Jogar"}),t&&(()=>{const ae=(Z.getState().heroes||[]).filter(ne=>ne.origin==="npc").slice(0,6).map(ne=>{const U=Math.floor(Math.random()*10)+Math.floor(Math.random()*10)+2;return{id:ne.id,name:ne.name,roll:U,critical:!1}}).sort((ne,U)=>U.roll-ne.roll);return e.jsxs("div",{className:"text-xs text-gray-300",children:["Top NPCs hoje: ",ae.slice(0,3).map(ne=>`${ne.name} ${ne.roll}`).join(" â€¢ ")]})})()]})]}),e.jsxs("div",{className:"mt-6 bg-gradient-to-br from-green-900/30 via-amber-800/10 to-transparent border border-green-500/30 rounded p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-300 flex items-center gap-2",children:"âœŠğŸ“„âœ‚ï¸ Pedra â€¢ Papel â€¢ Tesoura"}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Melhor de 5 contra um NPC. Vence quem fizer 3 pontos."}),t&&(()=>{const S=t.stats||{},I=Number(S.miniRpsWins||0),ae=Number(S.miniRpsLosses||0),ne=Number(S.miniRpsStreak||0),U=Number(S.miniRpsBestStreak||0);return e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:["Placar pessoal: ",I," vitÃ³rias â€¢ ",ae," derrotas â€¢ sequÃªncia ",ne," (melhor ",U,")"]})})(),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:["pedra","papel","tesoura"].map(S=>e.jsx("button",{onClick:()=>{const I=Z.getState().getSelectedHero();if(!I)return;const ae={pedra:"tesoura",papel:"pedra",tesoura:"papel"},ne=["pedra","papel","tesoura"][Math.floor(Math.random()*3)],U=ae[S]===ne,R={...I.stats||{}},L=Number(R.miniRpsStreak||0);R.miniRpsWins=Number(R.miniRpsWins||0)+(U?1:0),R.miniRpsLosses=Number(R.miniRpsLosses||0)+(U?0:1),R.miniRpsStreak=U?L+1:0,R.miniRpsBestStreak=Math.max(Number(R.miniRpsBestStreak||0),R.miniRpsStreak),R.miniRpsLastDate=new Date().toISOString(),Z.getState().updateHero(I.id,{stats:R});try{Z.getState().updateAchievementProgress()}catch{}if(U){try{Z.getState().gainXP(I.id,25)}catch{}try{ge.emit({type:"achievement",title:"VitÃ³ria no RPS",message:`NPC jogou ${ne} â€¢ +25 XP`,icon:"ğŸ¯",duration:2500})}catch{}}else try{ge.emit({type:"info",title:"Derrota no RPS",message:`NPC jogou ${ne}`,icon:"ğŸ¯",duration:2500})}catch{}},className:"px-3 py-2 rounded bg-green-700 hover:bg-green-800 text-white",children:S},S))})]})]}),i==="descanso"&&e.jsxs("div",{className:"mt-6 bg-gray-900/40 border border-white/10 rounded p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-300",children:"ğŸ›ï¸ Descanso na Taverna"}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Recupere sua Fadiga com uma boa noite de sono."}),e.jsx("div",{className:"mt-3 text-sm text-gray-200",children:t?e.jsxs("span",{children:["Saldo: Ouro ",t.progression.gold," â€¢ Fadiga ",t.progression.fatigue]}):e.jsx("span",{children:"Selecione um herÃ³i para descansar."})}),e.jsx("div",{className:"mt-3 flex items-center gap-3 flex-wrap",children:(()=>{const S=[{label:"Soneca",type:"soneca",cost:15,recovery:15},{label:"Noite padrÃ£o",type:"noite",cost:30,recovery:30},{label:"SuÃ­te de luxo",type:"luxo",cost:60,recovery:60}],I=(t==null?void 0:t.progression.fatigue)??0,ae=(t==null?void 0:t.progression.gold)??0,ne=t?I<=0?"Fadiga jÃ¡ estÃ¡ em 0":void 0:"Selecione um herÃ³i";return e.jsxs(e.Fragment,{children:[S.map(U=>{const R=!!t&&ae>=U.cost&&I>0;return e.jsxs("button",{onClick:()=>{if(!t)return;const L=s(t.id,U.cost,U.recovery,U.type);k(L?`VocÃª descansou (${U.label}) e recuperou atÃ© ${U.recovery} de Fadiga.`:"NÃ£o foi possÃ­vel descansar (verifique ouro e fadiga).")},disabled:!R,className:`px-3 py-2 rounded text-sm ${R?"bg-gradient-to-r from-amber-600 to-yellow-600 text-white hover:brightness-110":"bg-gray-700 text-gray-300"}`,title:`Recupera ${U.recovery} Fadiga por ${U.cost} ouro`,children:[U.label," (",U.cost," ouro)"]},U.type)}),e.jsx("span",{className:"text-xs text-gray-300 min-w-[180px]",children:ne??(ae<S[1].cost?"Ouro insuficiente":"Escolha o conforto do descanso")})]})})()}),w&&e.jsx("div",{className:"mt-3 text-xs text-green-300",children:w})]})]})})},Ti={dica:["Use essÃªncias arcanas para elevar a raridade sem perder o fio da lÃ¢mina.","Combine materiais de mesma categoria para criar itens Ãºnicos pela fusÃ£o.","A forja simples depende do seu rank. Suba o rank e novas receitas surgem.","Refinar a peÃ§a equipada pode render bÃ´nus poderosos â€” mas hÃ¡ risco."],historia:["JÃ¡ forjei a lÃ¢mina do GuardiÃ£o da Guilda. Brilhou como um sol ao romper o amanhecer.","Quando o martelo canta, lembro do meu mestre. Cada batida carrega um pedaÃ§o do seu legado.","O aÃ§o que nÃ£o falha Ã© aquele temperado com paciÃªncia. HerÃ³is apressados aprendem isso na marra."],comentario:["O ar hoje estÃ¡ bom para tÃªmpera. Sinto nos ossos.","Cuidado com as fagulhas. Elas tÃªm vontade prÃ³pria.","Nada como o cheiro de ferro aquecido para comeÃ§ar o dia."]},Im=({className:a=""})=>{var R,L,oe,K,xe;const{getSelectedHero:s,craftItem:t,refineEquippedItem:r,fuseItems:i,enchantEquippedItem:n,updateHero:o}=Z(),c=s(),[l,d]=x.useState("martelar"),[m,u]=x.useState(!1),[p,g]=x.useState(null),[v,y]=x.useState(!1),w=x.useRef(null),k=x.useRef(null),[E,h]=x.useState({x:0,y:0}),[b,f]=x.useState(!1),[j,N]=x.useState(null),[T,F]=x.useState(null),[te,D]=x.useState(0),[$,X]=x.useState(0),Q=x.useRef(null),[Y,G]=x.useState(null),[J,re]=x.useState([]),[ee,fe]=x.useState("eligible"),[_,P]=x.useState(""),M=(W,B)=>{if(T)return;if(b){ea();try{_d()}catch{}}F(W),D(0),X(0);const se=Date.now(),z=setInterval(()=>{const V=Date.now()-se,ie=Math.min(100,Math.floor(V/2400*100));if(D(ie),ie>=25&&$<1&&X(1),ie>=50&&$<2&&X(2),ie>=75&&$<3&&X(3),ie>=100){if(clearInterval(z),Q.current=null,t(c.id,W)){b&&ja(),g({type:"comentario",text:"Boa tÃªmpera. A peÃ§a parece equilibrada."}),N({type:"forjar:ok",at:Date.now()});try{ge.emit({type:"success",title:"Forja concluÃ­da",message:`${B} forjado com sucesso!`,timeoutMs:3e3})}catch{}}else{b&&wa(),g({type:"comentario",text:"Faltam insumos ou rank. Verifique seu inventÃ¡rio e posiÃ§Ã£o."}),N({type:"forjar:falha",at:Date.now()});try{ge.emit({type:"error",title:"Forja falhou",message:"Verifique materiais e rank.",timeoutMs:3e3})}catch{}}F(null),D(0),X(0),setTimeout(()=>{re(H=>{const me=H[0],de=H.slice(1);if(me){const ve=Na.find(Ae=>Ae.id===me);ve&&M(ve.id,ve.name)}return de})},200)}},80);Q.current=z},C=W=>{if(!c)return;const B=bs(c,W);if(B.success&&B.item){const se=B.currency||"gold",z={...c.progression};B.newBalance!==void 0?se==="gold"?z.gold=B.newBalance:se==="glory"?z.glory=B.newBalance:se==="arcaneEssence"&&(z.arcaneEssence=B.newBalance):B.newGold!==void 0&&(z.gold=B.newGold),o(c.id,{progression:z,inventory:{...c.inventory,items:{...c.inventory.items,[W]:(c.inventory.items[W]||0)+1}}});try{ge.emit({type:"success",title:"Material adquirido",message:B.message,timeoutMs:3e3})}catch{}}else try{ge.emit({type:"error",title:"Falha na compra",message:B.message,timeoutMs:3e3})}catch{}},A=W=>{const se=Z.getState().getSelectedHero();if(!se)return;const z=Na.find(ie=>ie.id===W);if(!z)return;let V=0;for(const ie of z.inputs){const he=se.inventory.items[ie.id]||0,H=Math.max(0,ie.qty-he);for(let me=0;me<H;me++){const de=bs(Z.getState().getSelectedHero(),ie.id);if(de.success&&de.item){const ve=Z.getState().getSelectedHero(),Ae=de.currency||"gold",Te={...ve.progression};de.newBalance!==void 0?Ae==="gold"?Te.gold=de.newBalance:Ae==="glory"?Te.glory=de.newBalance:Ae==="arcaneEssence"&&(Te.arcaneEssence=de.newBalance):de.newGold!==void 0&&(Te.gold=de.newGold),o(ve.id,{progression:Te,inventory:{...ve.inventory,items:{...ve.inventory.items,[ie.id]:(ve.inventory.items[ie.id]||0)+1}}}),V++}else break}}if(V>0)try{ge.emit({type:"success",title:"Materiais adquiridos",message:`Comprados ${V} insumos para a receita.`,timeoutMs:3e3})}catch{}else try{ge.emit({type:"error",title:"Compra indisponÃ­vel",message:"Saldo insuficiente ou item nÃ£o disponÃ­vel.",timeoutMs:3e3})}catch{}},O=x.useRef(null);x.useEffect(()=>{const W=setInterval(()=>{const B=["martelar","polir","inspecionar"];d(B[Math.floor(Math.random()*B.length)])},4e3);return()=>clearInterval(W)},[]),x.useEffect(()=>{if(c)try{const W=localStorage.getItem(`forgeView:${c.id}`),B=localStorage.getItem(`forgeQuery:${c.id}`);(W==="eligible"||W==="rank")&&fe(W),B&&P(B)}catch{}},[c==null?void 0:c.id]),x.useEffect(()=>{if(c)try{localStorage.setItem(`forgeView:${c.id}`,ee),localStorage.setItem(`forgeQuery:${c.id}`,_)}catch{}},[ee,_,c==null?void 0:c.id]),x.useEffect(()=>{const W=setInterval(()=>{const B=Math.max(-8,Math.min(12,(Math.random()-.5)*24)),se=Math.max(-6,Math.min(6,(Math.random()-.5)*12));h({x:B,y:se})},5e3);return()=>clearInterval(W)},[]),x.useEffect(()=>{const W=w.current;if(!W)return;const B=z=>{const V=k.current;if(!V)return;const ie=V.getBoundingClientRect(),he=ie.left+ie.width/2,H=ie.top+ie.height/2,me=z.clientX-he,de=z.clientY-H,ve=Math.sqrt(me*me+de*de);u(ve<140)};W.addEventListener("mousemove",B);const se=z=>{if(z.key.toLowerCase()==="t")U("comentario");else if(z.key.toLowerCase()==="f")y(V=>!V);else if(z.key==="Enter")try{if(!v||!c||T)return;const V=(ee==="eligible"?S:I).filter(H=>H.name.toLowerCase().includes(_.toLowerCase())),he=V.find(H=>H.inputs.every(me=>(c.inventory.items[me.id]||0)>=me.qty))||V[0];he&&M(he.id,he.name)}catch{}};return window.addEventListener("keydown",se),()=>{W.removeEventListener("mousemove",B),window.removeEventListener("keydown",se)}},[]),x.useEffect(()=>(O.current&&window.clearInterval(O.current),O.current=window.setInterval(()=>{if(!v&&!p){const W=Ti.comentario,B=W[Math.floor(Math.random()*W.length)];g({type:"comentario",text:B})}},2e4),()=>{O.current&&window.clearInterval(O.current),O.current=null}),[v,p]);const S=x.useMemo(()=>c?tc(c):[],[c]),I=x.useMemo(()=>{var z;if(!c)return[];const W=["F","E","D","C","B","A","S"],B=((z=c.rankData)==null?void 0:z.currentRank)||"F",se=W.indexOf(B);return Na.filter(V=>{const ie=W.indexOf(V.rankRequired||"F");return se>=ie})},[c]),ae=x.useMemo(()=>{var H;if(!c)return[];const W=["F","E","D","C","B","A","S"],B=((H=c.rankData)==null?void 0:H.currentRank)||"F",se=W.indexOf(B),z=c.inventory.items,V=me=>({comum:1,incomum:2,raro:3,epico:4,lendario:5})[(me||"comum").toLowerCase()]||1;return Na.map(me=>{const de=W.indexOf(me.rankRequired||"F"),ve=se>=de,Ae=me.inputs.map(qe=>({id:qe.id,qty:Math.max(0,qe.qty-(z[qe.id]||0))})).filter(qe=>qe.qty>0),Te=Math.max(...Ae.map(qe=>{var Oe;return V((Oe=Ee.find(it=>it.id===qe.id))==null?void 0:Oe.rarity)}))||1;return{id:me.id,name:me.name,missing:Ae,rankOk:ve,maxRarity:Te}}).filter(me=>me.rankOk&&me.missing.length>0).sort((me,de)=>{const ve=me.missing.reduce((Te,qe)=>Te+qe.qty,0),Ae=de.missing.reduce((Te,qe)=>Te+qe.qty,0);return ve!==Ae?ve-Ae:de.maxRarity-me.maxRarity}).slice(0,3)},[c]),ne=W=>{const B=(W||"").toLowerCase();return B==="lendario"?"bg-amber-900/40 text-amber-200 border-amber-600/40":B==="epico"?"bg-purple-900/40 text-purple-200 border-purple-600/40":B==="raro"?"bg-blue-900/40 text-blue-200 border-blue-600/40":B==="incomum"?"bg-green-900/40 text-green-200 border-green-600/40":"bg-slate-800/40 text-slate-200 border-white/10"},U=W=>{var V;const B=Ti[W],se=B[Math.floor(Math.random()*B.length)];let z="";if(W==="dica"&&c){const ie=((V=c.rankData)==null?void 0:V.currentRank)||"F",he=S.length;z=he>0?` VocÃª tem ${he} receita(s) aptas ao seu rank ${ie}.`:" Suba de rank ou junte materiais para liberar novas receitas."}g({type:W,text:`${se}${z}`}),y(!0);try{ea(),f(!0);const ie=window.speechSynthesis;if(ie){const he=new SpeechSynthesisUtterance(se);he.lang="pt-BR",he.rate=1,ie.cancel(),ie.speak(he)}}catch{}};return e.jsxs("div",{ref:w,className:`relative w-full min-h-[420px] rounded-2xl border border-white/10 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 overflow-hidden ${a}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-amber-700/30 via-transparent to-transparent"}),e.jsx("div",{className:"absolute left-6 right-6 top-6 bottom-24 rounded-2xl bg-slate-800/40 border border-amber-700/20"}),e.jsxs(tt.div,{ref:k,className:"absolute left-10 bottom-16 w-44 h-44 rounded-xl bg-slate-700/60 border border-white/10 flex items-center justify-center",animate:{x:E.x+(l==="inspecionar"?6:l==="polir"?-4:0),y:E.y+(l==="polir"?-3:0)},transition:{type:"spring",stiffness:120,damping:14},children:[T&&$===1&&e.jsx(tt.div,{className:"absolute inset-0",animate:{x:[-1,1,-1,0]},transition:{duration:.3,repeat:1/0}}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl",children:"ğŸ§‘â€ğŸ­"}),e.jsx("div",{className:"mt-1 text-xs text-amber-300",children:"Forjador"}),c&&e.jsxs("div",{className:"mt-1 text-[10px] inline-flex items-center gap-1 px-2 py-1 rounded bg-slate-800/60 border border-white/10",children:[e.jsx("span",{children:(L=fa[((R=c.rankData)==null?void 0:R.currentRank)||"F"])==null?void 0:L.icon}),e.jsx("span",{children:(K=fa[((oe=c.rankData)==null?void 0:oe.currentRank)||"F"])==null?void 0:K.name}),e.jsxs("span",{children:["(",((xe=c.rankData)==null?void 0:xe.currentRank)||"F",")"]})]}),e.jsx(oa,{children:m&&e.jsx(tt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},className:"mt-2 text-xs px-2 py-1 rounded bg-amber-800/40 text-amber-200 border border-amber-600/40",children:"SaudaÃ§Ãµes, herÃ³i."})})]}),l==="martelar"&&e.jsx(tt.div,{className:"absolute inset-0 rounded-xl",animate:{boxShadow:["0 0 0px rgba(251,191,36,0.0)","0 0 12px rgba(251,191,36,0.35)","0 0 0px rgba(251,191,36,0.0)"]},transition:{duration:1.2,repeat:1/0}}),e.jsx(tt.div,{className:"absolute right-2 top-2 text-3xl",animate:{rotate:l==="martelar"?[0,-20,0,-20,0]:0},transition:{duration:l==="martelar"?.8:.4,repeat:l==="martelar"?1/0:0},children:l==="martelar"?"ğŸ”¨":l==="polir"?"ğŸ§½":"ğŸ”"})]}),e.jsxs("div",{className:"absolute left-56 bottom-24 right-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>U("dica"),className:"px-3 py-2 rounded bg-amber-600 text-white text-xs hover:bg-amber-700",children:"Pedir dica"}),e.jsx("button",{onClick:()=>U("historia"),className:"px-3 py-2 rounded bg-amber-600 text-white text-xs hover:bg-amber-700",children:"Ouvir histÃ³ria"}),e.jsx("button",{onClick:()=>U("comentario"),className:"px-3 py-2 rounded bg-amber-600 text-white text-xs hover:bg-amber-700",children:"Comentar ambiente"}),e.jsx("button",{onClick:()=>y(W=>!W),className:"px-3 py-2 rounded bg-slate-700 text-white text-xs hover:bg-slate-600",children:"Abrir painel"}),!b&&e.jsx("button",{onClick:()=>{ea(),f(!0)},className:"px-3 py-2 rounded text-xs bg-slate-700 text-white hover:bg-slate-600",children:"Ativar Ã¡udio"}),b&&e.jsx("button",{onClick:()=>{var W;try{(W=window.speechSynthesis)==null||W.cancel()}catch{}f(!1)},className:"px-3 py-2 rounded text-xs bg-red-700 text-white hover:bg-red-800",children:"Silenciar Ã¡udio"})]}),e.jsx(oa,{children:p&&e.jsxs(tt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mt-3 p-3 rounded-lg bg-slate-800/60 border border-white/10",children:[e.jsx("div",{className:"text-xs text-amber-300 uppercase",children:p.type}),e.jsx("div",{className:"text-sm text-white mt-1",children:p.text})]})}),e.jsx(oa,{children:v&&c&&e.jsxs(tt.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:12},className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800/60 border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold text-white mb-2",children:"Forja Simples"}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("input",{value:_,onChange:W=>P(W.target.value),placeholder:"Buscar receita",className:"px-2 py-1 rounded bg-slate-700 text-white text-xs w-full"}),e.jsx("button",{onClick:()=>fe("eligible"),className:`px-2 py-1 rounded text-xs ${ee==="eligible"?"bg-emerald-700 text-white":"bg-slate-700 text-white hover:bg-slate-600"}`,children:"ElegÃ­veis"}),e.jsx("button",{onClick:()=>fe("rank"),className:`px-2 py-1 rounded text-xs ${ee==="rank"?"bg-emerald-700 text-white":"bg-slate-700 text-white hover:bg-slate-600"}`,children:"Aptas ao Rank"})]}),S.length===0&&e.jsx("div",{className:"text-xs text-gray-400",children:"Sem receitas disponÃ­veis."}),S.length>0&&e.jsx("div",{className:"space-y-2",children:(ee==="eligible"?S:I).filter(W=>W.name.toLowerCase().includes(_.toLowerCase())).map(W=>e.jsxs("div",{className:"p-2 rounded bg-slate-700/60 border border-white/10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-sm",children:W.name}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Rank: ",W.rankRequired||"F"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:!!T,onClick:()=>M(W.id,W.name),className:`px-2 py-1 rounded text-xs ${T?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-emerald-600 text-white hover:bg-emerald-700"}`,children:T?"Forjandoâ€¦":"Forjar"}),e.jsx("button",{onClick:()=>re(B=>B.length<3?[...B,W.id]:B),className:"px-2 py-1 rounded bg-slate-700 text-white text-xs hover:bg-slate-600",children:"Adicionar Ã  fila"}),T===W.id&&e.jsx("button",{onClick:()=>{Q.current&&(clearInterval(Q.current),Q.current=null),F(null),D(0),X(0)},className:"px-2 py-1 rounded bg-gray-700 text-white text-xs hover:bg-gray-600",children:"Cancelar"}),T===W.id&&e.jsxs("div",{className:"relative w-24 h-2 rounded bg-slate-700 overflow-hidden",children:[e.jsx("div",{className:`h-2 ${$===0?"bg-amber-500":$===1?"bg-red-500":$===2?"bg-blue-500":"bg-emerald-500"}`,style:{width:`${te}%`}}),e.jsx("div",{className:"absolute top-[-6px] text-[10px]",style:{left:`calc(${te}% - 6px)`},children:"âœ¨"}),e.jsxs("div",{className:"absolute right-1 top-[-14px] text-[10px] text-gray-200",children:["~",Math.max(0,Math.ceil(2400*(1-te/100)/1e3)),"s"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:[{l:"Aquecer",i:"ğŸ”¥"},{l:"Martelar",i:"ğŸ”¨"},{l:"TÃªmpera",i:"ğŸ’§"},{l:"Polir",i:"ğŸ§½"}].map((B,se)=>e.jsxs("span",{className:`px-2 py-0.5 rounded text-[10px] border ${T===W.id&&$>=se?"bg-emerald-700 text-white border-emerald-500":"bg-slate-700 text-gray-300 border-white/10"}`,children:[B.i," ",B.l]},B.l))}),e.jsx("button",{onClick:()=>G(Y===W.id?null:W.id),className:"px-2 py-1 rounded bg-slate-700 text-white text-xs hover:bg-slate-600",children:Y===W.id?"Ocultar detalhes":"Detalhes"})]}),J.length>0&&e.jsxs("div",{className:"mt-2 text-[10px] text-gray-300",children:["Fila: ",J.map((B,se)=>{const z=Na.find(me=>me.id===B),V=(z==null?void 0:z.name)||B,ie=se>0,he=se<J.length-1,H=Math.ceil(2400/1e3)*(se+1);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-slate-700 text-white mr-1",children:[e.jsx("span",{children:V}),e.jsxs("span",{className:"opacity-70",children:["~",H,"s"]}),e.jsx("button",{disabled:!ie,onClick:()=>re(me=>{const de=[...me],ve=de[se];return de[se]=de[se-1],de[se-1]=ve,de}),className:`px-1 rounded ${ie?"bg-slate-600 hover:bg-slate-500":"bg-slate-800 opacity-50"}`,children:"â†‘"}),e.jsx("button",{disabled:!he,onClick:()=>re(me=>{const de=[...me],ve=de[se];return de[se]=de[se+1],de[se+1]=ve,de}),className:`px-1 rounded ${he?"bg-slate-600 hover:bg-slate-500":"bg-slate-800 opacity-50"}`,children:"â†“"}),e.jsx("button",{onClick:()=>re(me=>me.filter((de,ve)=>ve!==se)),className:"px-1 rounded bg-red-700 hover:bg-red-800",children:"âœ•"})]},`${B}-${se}`)})]}),Y===W.id&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-800/60 border border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-1",children:"Consumo"}),e.jsx("div",{className:"flex flex-wrap gap-1 items-center",children:W.inputs.map(B=>{const se=Ee.find(he=>he.id===B.id),z=se?se.name:B.id,V=(se==null?void 0:se.icon)||"ğŸ“¦",ie=c.inventory.items[B.id]||0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded border text-xs ${ie>=B.qty?"bg-slate-700 text-white border-white/20":"bg-red-900/40 text-red-200 border-red-600/40"}`,children:[e.jsx("span",{children:V}),e.jsxs("span",{children:[B.qty,"x ",z]}),e.jsxs("span",{className:"opacity-70",children:["(VocÃª tem ",ie,")"]})]},`${W.id}-${B.id}`)})}),e.jsx("div",{className:"text-xs text-gray-300 mt-2 mb-1",children:"Resultado"}),(()=>{const B=Ee.find(ie=>ie.id===W.output.id),se=B?B.name:W.output.id,z=(B==null?void 0:B.icon)||"âš’ï¸",V=B==null?void 0:B.rarity;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded border text-xs ${ne(V)}`,children:[e.jsx("span",{children:z}),e.jsxs("span",{children:[W.output.qty,"x ",se]})]})})(),(()=>{const B=Ee.find(z=>z.id===W.output.id),se=B==null?void 0:B.bonus;return se?e.jsx("div",{className:"mt-2 text-[11px] text-gray-200",children:Object.entries(se).map(([z,V])=>e.jsxs("span",{className:"inline-block mr-2",children:["+",V," ",z]},z))}):null})(),(()=>{const B=W.inputs.map(H=>{const me=c.inventory.items[H.id]||0,de=Math.max(0,H.qty-me),ve=Ee.find(qe=>qe.id===H.id),Ae=ve?Fa(ve,c):0,Te=(ve==null?void 0:ve.currency)||"gold";return{id:H.id,need:de,priceEach:Ae,currency:Te,available:!!ve}}).filter(H=>H.need>0);if(B.length===0)return null;const se={gold:0,glory:0,arcaneEssence:0};B.forEach(H=>{if(!H.available)return;const me=H.currency;se[me]+=H.priceEach*H.need});const z=c.progression.gold||0,V=c.progression.glory||0,ie=c.progression.arcaneEssence||0,he=se.gold<=z&&se.glory<=V&&se.arcaneEssence<=ie;return e.jsxs("div",{className:"mt-3 p-2 rounded bg-slate-900/60 border border-white/10",children:[e.jsx("div",{className:"text-xs text-white mb-1",children:"Compra rÃ¡pida (faltantes)"}),e.jsxs("div",{className:"text-[11px] text-gray-200 space-x-2",children:[e.jsxs("span",{children:["Ouro: ",Math.ceil(se.gold)]}),e.jsxs("span",{children:["GlÃ³ria: ",Math.ceil(se.glory)]}),e.jsxs("span",{children:["EssÃªncia: ",Math.ceil(se.arcaneEssence)]})]}),e.jsxs("div",{className:"text-[11px] text-gray-400 mt-1",children:["Saldo â€¢ Ouro: ",z," â€¢ GlÃ³ria: ",V," â€¢ EssÃªncia: ",ie]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(W.id),disabled:!he,className:`px-2 py-1 rounded text-xs ${he?"bg-emerald-700 text-white hover:bg-emerald-800":"bg-slate-700 text-gray-300 cursor-not-allowed"}`,children:"Confirmar compra"}),!he&&e.jsx("span",{className:"text-[11px] text-red-300",children:"Saldo insuficiente para todos os insumos."})]})]})})()]})]},W.id))}),e.jsxs("div",{className:"mt-2 text-xs text-gray-300",children:["Tempo total estimado da fila: ",Math.ceil((J.length*2400+(T?2400*(1-te/100):0))/1e3),"s"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800/60 border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold text-white mb-2",children:"Aprimoramentos"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>{const W=r(c.id,"weapon");b&&(ea(),W?ja():wa()),N({type:W?"refinar:ok":"refinar:falha",at:Date.now()});try{ge.emit({type:W?"success":"error",title:W?"Refino realizado":"Refino falhou",message:W?"Arma refinada.":"Requisitos nÃ£o atendidos.",timeoutMs:3e3})}catch{}},className:"px-2 py-1 rounded bg-purple-600 text-white text-xs hover:bg-purple-700",children:"Refinar Arma"}),e.jsx("button",{onClick:()=>{const W=r(c.id,"armor");b&&(ea(),W?ja():wa()),N({type:W?"refinar:ok":"refinar:falha",at:Date.now()});try{ge.emit({type:W?"success":"error",title:W?"Refino realizado":"Refino falhou",message:W?"Armadura refinada.":"Requisitos nÃ£o atendidos.",timeoutMs:3e3})}catch{}},className:"px-2 py-1 rounded bg-purple-600 text-white text-xs hover:bg-purple-700",children:"Refinar Armadura"}),e.jsx("button",{onClick:()=>{const W=r(c.id,"accessory");b&&(ea(),W?ja():wa()),N({type:W?"refinar:ok":"refinar:falha",at:Date.now()});try{ge.emit({type:W?"success":"error",title:W?"Refino realizado":"Refino falhou",message:W?"AcessÃ³rio refinado.":"Requisitos nÃ£o atendidos.",timeoutMs:3e3})}catch{}},className:"px-2 py-1 rounded bg-purple-600 text-white text-xs hover:bg-purple-700",children:"Refinar AcessÃ³rio"}),e.jsx("button",{onClick:()=>{const W=n(c.id,"weapon","lifesteal");b&&(ea(),W?ja():wa()),N({type:W?"encantar:ok":"encantar:falha",at:Date.now()});try{ge.emit({type:W?"success":"error",title:W?"Encantamento aplicado":"Encantamento falhou",message:W?"Lifesteal ativo na arma.":"EssÃªncia insuficiente ou item nÃ£o equipado.",timeoutMs:3e3})}catch{}},className:"px-2 py-1 rounded bg-indigo-600 text-white text-xs hover:bg-indigo-700",children:"Encantar Arma"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Refinos e encantos consomem ouro/essÃªncia e podem falhar."})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800/60 border border-white/10 md:col-span-2",children:[e.jsx("div",{className:"text-sm font-semibold text-white mb-2",children:"FusÃ£o Procedural"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{placeholder:"ID do Item A",className:"px-2 py-1 rounded bg-slate-700 text-white text-xs",id:"fuse-a"}),e.jsx("input",{placeholder:"ID do Item B",className:"px-2 py-1 rounded bg-slate-700 text-white text-xs",id:"fuse-b"})]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>{var se,z;const W=(se=document.getElementById("fuse-a"))==null?void 0:se.value,B=(z=document.getElementById("fuse-b"))==null?void 0:z.value;if(W&&B){const V=i(c.id,W,B);b&&(ea(),V?ja():wa()),N({type:V?"fusao:ok":"fusao:falha",at:Date.now()});try{ge.emit({type:V?"success":"error",title:V?"FusÃ£o concluÃ­da":"FusÃ£o falhou",message:V?"Novo item Ãºnico gerado.":"Verifique tipos e quantidades.",timeoutMs:3e3})}catch{}}},className:"px-3 py-1 rounded bg-amber-600 text-white text-xs hover:bg-amber-700",children:"Fundir"})})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800/60 border border-white/10 md:col-span-2",children:[e.jsx("div",{className:"text-sm font-semibold text-white mb-2",children:"Dicas Inteligentes"}),ae.length===0&&e.jsx("div",{className:"text-xs text-gray-400",children:"Sem dicas no momento. VocÃª jÃ¡ possui materiais para as receitas aptas ou precisa subir de rank."}),ae.length>0&&e.jsx("div",{className:"space-y-2",children:ae.map(W=>e.jsxs("div",{className:"p-2 rounded bg-slate-700/60 border border-white/10",children:[e.jsx("div",{className:"text-white text-sm mb-1",children:W.name}),e.jsx("div",{className:"flex flex-wrap gap-1 items-center",children:W.missing.map(B=>{const se=Ee.find(ve=>ve.id===B.id),z=se?se.name:B.id,V=se==null?void 0:se.rarity,ie=(se==null?void 0:se.icon)||"ğŸ§±",he=se?Fa(se,c):0,H=(se==null?void 0:se.currency)||"gold",me=H==="gold"?"ouro":H==="glory"?"glÃ³ria":"essÃªncia",de=se?yr(c,se):!1;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded border text-xs ${ne(V)} ${B.qty===1?"animate-pulse":""}`,title:B.qty===1?"Falta 1 para completar":"",children:[e.jsx("span",{children:ie}),e.jsxs("span",{children:[B.qty,"x ",z]}),e.jsxs("button",{onClick:()=>C(B.id),disabled:!de,className:`ml-1 px-2 py-0.5 rounded ${de?"bg-emerald-700 hover:bg-emerald-800 text-white":"bg-slate-700 text-gray-300 cursor-not-allowed"}`,children:["Comprar (",he," ",me,")"]})]},`${W.id}-${B.id}`)})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("button",{onClick:()=>A(W.id),className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-700",children:"Comprar faltantes"}),e.jsx($e,{to:"/shop",className:"ml-2 inline-flex items-center gap-1 px-2 py-1 rounded bg-slate-700 text-white text-xs hover:bg-slate-600",children:"Ir Ã  Loja"})]})]},W.id))})]})]})})]}),e.jsx("div",{className:"absolute left-0 right-0 bottom-0 p-3 bg-slate-900/60 border-t border-white/10",children:e.jsx("div",{className:"text-xs text-gray-300",children:"Movimente o cursor para se aproximar do Forjador e interaja."})}),e.jsx(tt.div,{className:"absolute left-8 bottom-8 text-2xl",animate:{scale:[1,1.1,.95,1],opacity:[.7,1,.8,.7]},transition:{duration:1.6,repeat:1/0},children:"ğŸ”¥"}),e.jsx(tt.div,{className:"absolute left-24 bottom-20 text-xl",animate:{opacity:[0,1,0],y:[0,-6,0]},transition:{duration:1.2,repeat:1/0},children:"âœ¨"}),b&&e.jsx(Tm,{work:l}),e.jsx(Dm,{action:j,enabled:b,hero:c||null}),e.jsx($m,{action:j,hero:c||null})]})},Tm=({work:a})=>(x.useEffect(()=>{let s;if(a==="martelar")s=setInterval(()=>{try{Dd()}catch{}},3e3);else if(a==="polir")s=setInterval(()=>{try{$d()}catch{}},3800);else return;return()=>clearInterval(s)},[a]),null),Dm=({action:a,enabled:s,hero:t})=>(x.useEffect(()=>{if(!a)return;const r=setTimeout(()=>{var m,u;const i=a.type,n=(u=(m=t==null?void 0:t.titles)==null?void 0:m.find(p=>p.id===(t==null?void 0:t.activeTitle)))==null?void 0:u.name,o="Bom trabalho. A peÃ§a responde bem sob pressÃ£o.",c="Nem sempre o fogo obedece. Vamos ajustar o prÃ³ximo passo.";let l=n?` ${n} tem mÃ£os firmes para a forja.`:"";try{const p=`forgeHistory:${t==null?void 0:t.id}`,v=JSON.parse(localStorage.getItem(p)||"[]").slice(-3),y=v.filter(k=>k.ok).length,w=v.filter(k=>!k.ok).length;y>=3?l+=" SequÃªncia Ã³tima, continue assim.":w>=2&&(l+=" Vamos revisar materiais e rank para melhorar.")}catch{}const d=(i.endsWith(":ok")?o:c)+l;try{const p=new CustomEvent("npc-followup",{detail:{msg:d}});window.dispatchEvent(p)}catch{}},8e3);return()=>clearTimeout(r)},[a==null?void 0:a.type,a==null?void 0:a.at]),x.useEffect(()=>{const r=i=>{var o;const n=(o=i==null?void 0:i.detail)==null?void 0:o.msg;if(typeof n=="string"&&s)try{const c=window.speechSynthesis;if(c){const l=new SpeechSynthesisUtterance(n);l.lang="pt-BR",l.rate=1,c.cancel(),c.speak(l)}}catch{}};return window.addEventListener("npc-followup",r),()=>window.removeEventListener("npc-followup",r)},[s]),null),$m=({action:a,hero:s})=>{var n,o;const[t,r]=x.useState(!1);if(x.useEffect(()=>{if(!a||!String(a.type).endsWith(":ok"))return;r(!0);const c=setTimeout(()=>r(!1),1200);return()=>clearTimeout(c)},[a==null?void 0:a.type,a==null?void 0:a.at]),!t)return null;const i=((o=fa[((n=s==null?void 0:s.rankData)==null?void 0:n.currentRank)||"F"])==null?void 0:o.color)||"#22c55e";return e.jsx(tt.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0},className:"pointer-events-none absolute left-40 bottom-28 w-28 h-28 rounded-full",style:{boxShadow:`0 0 18px ${i}`}})},_m=()=>{const{getSelectedHero:a}=Z(),s=a();return s?e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-amber-400",children:"Forja do HerÃ³i"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{to:"/shop",className:"px-3 py-2 rounded bg-emerald-600 text-white text-sm hover:bg-emerald-700",children:"Visitar Loja"}),e.jsx($e,{to:"/inventory",className:"px-3 py-2 rounded bg-amber-600 text-white text-sm hover:bg-amber-700",children:"Ver InventÃ¡rio"}),e.jsx($e,{to:`/hero/${s.id}`,className:"px-3 py-2 rounded bg-slate-700 text-white text-sm hover:bg-slate-600",children:"Voltar ao HerÃ³i"})]})]}),e.jsx(Im,{})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âš’ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-200 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Selecione um herÃ³i para acessar a Forja."}),e.jsx($e,{to:"/gallery",className:"bg-amber-600 text-white px-6 py-2 rounded hover:bg-amber-700 transition-colors",children:"Ver Galeria"})]})};async function qm(a){try{const s=await Hn(),t=await fetch("/api/payments/create-checkout-session",{method:"POST",headers:s,body:JSON.stringify({productId:a})});if(!t.ok)try{const i=await t.json();throw new Error((i==null?void 0:i.message)||"Falha ao iniciar checkout")}catch{throw new Error("Falha ao iniciar checkout")}const r=await t.json();try{r!=null&&r.redirectUrl&&(window.location.href=r.redirectUrl)}catch{}return r}catch{return{ok:!0,sessionId:`local-${Date.now()}`}}}async function Ln(a){try{const s=await Hn(),t=await fetch("/api/payments/verify",{method:"POST",headers:s,body:JSON.stringify({sessionId:a})});if(!t.ok)try{const r=await t.json();throw new Error((r==null?void 0:r.message)||"Falha ao verificar")}catch{throw new Error("Falha ao verificar")}return await t.json()}catch{return{ok:!0}}}async function Hn(a){var t,r,i;const s={"Content-Type":"application/json"};try{const{data:n}=await Ze.auth.getSession(),o=(t=n==null?void 0:n.session)==null?void 0:t.access_token,c=(i=(r=n==null?void 0:n.session)==null?void 0:r.user)==null?void 0:i.id;o&&(s.Authorization=`Bearer ${o}`),!_t&&c&&(s["X-User-Id"]=c),!s["X-User-Id"]&&a&&!_t&&(s["X-User-Id"]=a)}catch{}return s}const Ja=Object.freeze(Object.defineProperty({__proto__:null,startCheckout:qm,verifyPurchase:Ln},Symbol.toStringTag,{value:"Module"})),Di=()=>{const{markPurchase:a,removeAdsForever:s,setActiveTheme:t,setActiveFrame:r,seasonPassActive:i,adsRemoved:n,ownedThemes:o,ownedFrames:c,activeThemeId:l,activeFrameId:d}=Qe(),m={}.VITE_PRICE_REMOVE_ADS||"",u={}.VITE_PRICE_SEASON_PASS||"",p={}.VITE_PRICE_THEME_MEDIEVAL||"",g={}.VITE_PRICE_FRAME_ORNATE||"",v=(()=>{try{const j={}.VITE_LOCALE||"pt-BR",N={}.VITE_CURRENCY||"BRL";return new Intl.NumberFormat(j,{style:"currency",currency:N})}catch{return null}})(),y=Number({}.VITE_PRICE_REMOVE_ADS_VALUE||"0"),w=Number({}.VITE_PRICE_SEASON_PASS_VALUE||"0"),k=Number({}.VITE_PRICE_THEME_MEDIEVAL_VALUE||"0"),E=Number({}.VITE_PRICE_FRAME_ORNATE_VALUE||"0"),h=(j,N)=>v&&N>0?v.format(N):j||"",[b,f]=x.useState("");return x.useEffect(()=>{je.pageVisited("system","/premium"),je.featureUsed("system","premium-center-open")},[]),x.useEffect(()=>{(async()=>{try{const j=new URLSearchParams(window.location.search),N=j.get("checkout"),T=j.get("sid"),F=j.get("p")||"";N==="success"&&T?(await Ln(T)).ok?(a(F||"premium",{id:T}),F==="remove-ads"?s():F.startsWith("theme-")?t(F.replace("theme-","")):F.startsWith("frame-")&&r(F.replace("frame-","")),je.purchaseCompleted("system",F||"premium",T),f("Compra concluÃ­da com sucesso. Obrigado pelo apoio!")):f("Falha ao verificar compra. Tente novamente."):N==="cancel"&&f("Pagamento cancelado.")}catch{}})()},[]),e.jsxs("div",{className:"max-w-5xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-amber-300 mb-2",children:"Centro Premium"}),b&&e.jsx("div",{className:"text-sm text-emerald-300 mb-3",children:b}),e.jsxs("div",{className:"mb-4 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-white/20 bg-white/5 p-3",children:[e.jsx("div",{className:"text-sm text-gray-200",children:"Status"}),e.jsxs("div",{className:"text-xs text-gray-300 mt-1",children:["Premium: ",i!=null&&i.active?"Ativo":"Inativo"]}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Ads: ",n?"Removidos":"Ativos"]}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Tema ativo: ",l||"-"]}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Frame ativo: ",d||"-"]})]}),e.jsxs("div",{className:"rounded-lg border border-white/20 bg-white/5 p-3",children:[e.jsx("div",{className:"text-sm text-gray-200",children:"CosmÃ©ticos"}),e.jsxs("div",{className:"text-xs text-gray-300 mt-1",children:["Temas: ",(o||[]).length]}),e.jsxs("div",{className:"text-xs text-gray-300",children:["Frames: ",(c||[]).length]})]})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-indigo-500/40 bg-indigo-900/10 p-3",children:[e.jsx("div",{className:"text-sm text-indigo-200",children:"AÃ§Ãµes rÃ¡pidas (Tema)"}),e.jsxs("select",{value:l||"",onChange:j=>{const N=j.target.value||void 0;t(N);try{je.featureUsed("system","theme-switch")}catch{}try{ge.publish({id:`theme-${Date.now()}`,type:"info",title:"Tema aplicado",message:`Tema ${N||""} ativo`,timeoutMs:3e3})}catch{}},className:"mt-2 w-full border border-indigo-700 bg-indigo-950 text-indigo-100 text-xs rounded p-2",children:[e.jsx("option",{value:"",children:"Selecionar"}),(o||[]).map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{className:"rounded-lg border border-cyan-500/40 bg-cyan-900/10 p-3",children:[e.jsx("div",{className:"text-sm text-cyan-200",children:"AÃ§Ãµes rÃ¡pidas (Frame)"}),e.jsxs("select",{value:d||"",onChange:j=>{const N=j.target.value||void 0;r(N);try{je.featureUsed("system","frame-switch")}catch{}try{ge.publish({id:`frame-${Date.now()}`,type:"info",title:"Frame aplicado",message:`Frame ${N||""} ativo`,timeoutMs:3e3})}catch{}},className:"mt-2 w-full border border-cyan-700 bg-cyan-950 text-cyan-100 text-xs rounded p-2",children:[e.jsx("option",{value:"",children:"Selecionar"}),(c||[]).map(j=>e.jsx("option",{value:j,children:j},j))]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx($e,{to:"/shop",className:"inline-block px-3 py-2 rounded bg-amber-600 text-white text-sm hover:bg-amber-700",children:"Abrir Loja"})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-amber-500/40 bg-amber-900/10 p-4",children:[e.jsx("div",{className:"text-lg font-semibold text-amber-300 mb-1",children:"Remover AnÃºncios"}),e.jsx("div",{className:"text-xs text-amber-200 mb-3",children:"ExperiÃªncia sem anÃºncios em todo o jogo"}),e.jsx("div",{className:"text-xs text-amber-200 mb-2",children:h(m,y)}),e.jsx("button",{onClick:async()=>{try{je.purchaseInitiated("system","remove-ads")}catch{}await(await wt(()=>Promise.resolve().then(()=>Ja),void 0)).startCheckout("remove-ads")},disabled:n,className:`px-3 py-2 rounded text-sm ${n?"bg-gray-400 text-gray-800 cursor-not-allowed":"bg-amber-600 text-white hover:bg-amber-700"}`,children:n?"Comprado":"Comprar"})]}),e.jsxs("div",{className:"rounded-lg border border-pink-500/40 bg-pink-900/10 p-4",children:[e.jsx("div",{className:"text-lg font-semibold text-pink-300 mb-1",children:"Season Pass"}),e.jsx("div",{className:"text-xs text-pink-200 mb-3",children:"Recompensas sazonais, cosmÃ©ticos e bÃ´nus"}),e.jsx("div",{className:"text-xs text-pink-200 mb-2",children:h(u,w)}),e.jsx("button",{onClick:async()=>{try{je.purchaseInitiated("system","season-pass")}catch{}await(await wt(()=>Promise.resolve().then(()=>Ja),void 0)).startCheckout("season-pass")},disabled:!!(i!=null&&i.active),className:`px-3 py-2 rounded text-sm ${i!=null&&i.active?"bg-gray-400 text-gray-800 cursor-not-allowed":"bg-pink-600 text-white hover:bg-pink-700"}`,children:i!=null&&i.active?"Ativo":"Comprar"})]}),e.jsxs("div",{className:"rounded-lg border border-indigo-500/40 bg-indigo-900/10 p-4",children:[e.jsx("div",{className:"text-lg font-semibold text-indigo-300 mb-1",children:"Tema Medieval"}),e.jsx("div",{className:"text-xs text-indigo-200 mb-3",children:"Paleta e decoraÃ§Ã£o temÃ¡tica"}),e.jsx("div",{className:"text-xs text-indigo-200 mb-2",children:h(p,k)}),e.jsx("button",{onClick:async()=>{try{je.purchaseInitiated("system","theme-medieval")}catch{}await(await wt(()=>Promise.resolve().then(()=>Ja),void 0)).startCheckout("theme-medieval")},disabled:(o||[]).includes("medieval"),className:`px-3 py-2 rounded text-sm ${(o||[]).includes("medieval")?"bg-gray-400 text-gray-800 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:(o||[]).includes("medieval")?l==="medieval"?"Ativo":"Comprado":"Comprar"})]}),e.jsxs("div",{className:"rounded-lg border border-cyan-500/40 bg-cyan-900/10 p-4",children:[e.jsx("div",{className:"text-lg font-semibold text-cyan-300 mb-1",children:"Frame Ornado"}),e.jsx("div",{className:"text-xs text-cyan-200 mb-3",children:"Moldura estilizada para UI"}),e.jsx("div",{className:"text-xs text-cyan-200 mb-2",children:h(g,E)}),e.jsx("button",{onClick:async()=>{try{je.purchaseInitiated("system","frame-ornate")}catch{}await(await wt(()=>Promise.resolve().then(()=>Ja),void 0)).startCheckout("frame-ornate")},disabled:(c||[]).includes("ornate"),className:`px-3 py-2 rounded text-sm ${(c||[]).includes("ornate")?"bg-gray-400 text-gray-800 cursor-not-allowed":"bg-cyan-600 text-white hover:bg-cyan-700"}`,children:(c||[]).includes("ornate")?d==="ornate"?"Ativo":"Comprado":"Comprar"})]})]})]})},Fm=()=>{var Pe;const{getSelectedHero:a}=Z(),s=a(),t=Wt(),[r,i]=x.useState("explore"),[n,o]=x.useState([]),[c,l]=x.useState([]),[d,m]=x.useState({tag:""}),[u,p]=x.useState(!1),[g,v]=x.useState("date"),[y,w]=x.useState(!1),[k,E]=x.useState(6),[h,b]=x.useState(0),[f,j]=x.useState(9),[N,T]=x.useState(0),[F,te]=x.useState(!0),[D,$]=x.useState(!0),[X,Q]=x.useState(!1),[Y,G]=x.useState(!1),[J,re]=x.useState(null),[ee,fe]=x.useState(null),[_,P]=x.useState(0),[M,C]=x.useState(0),[A,O]=x.useState(""),[S,I]=x.useState(""),[ae,ne]=x.useState(""),[U,R]=x.useState(""),[L,oe]=x.useState(""),[K,xe]=x.useState(""),[W,B]=x.useState(100),[se,z]=x.useState(""),[V,ie]=x.useState("public"),[he,H]=x.useState(""),[me,de]=x.useState([]),ve=!!s,{seasonPassActive:Ae}=Qe(),{activeSeasonalTheme:Te}=Qe(),qe=Te&&((Pe=Ke[Te])==null?void 0:Pe.border)||"border-slate-700",Oe=x.useMemo(()=>(s==null?void 0:s.id)||"",[s==null?void 0:s.id]),it=async()=>{var ce,Ie;if(!Oe){o([]),l([]);return}p(!0);try{try{je.featureUsed((s==null?void 0:s.id)||"system","events_initial_load_started")}catch{}const Le=await hr(Oe,{tag:d.tag||void 0,limit:f,offset:0});o(Le.items),T(Le.items.length),$(!!((ce=Le.pagination)!=null&&ce.hasMore));const ct=await mi(Oe,se?se.split(",").map(ue=>ue.trim()).join(","):void 0,{limit:k,offset:0});l(ct.items),b(ct.items.length),te(!!((Ie=ct.pagination)!=null&&Ie.hasMore));try{je.featureUsed((s==null?void 0:s.id)||"system","events_initial_load_completed")}catch{}}catch{}p(!1)};x.useEffect(()=>{it()},[Oe]),x.useEffect(()=>{(async()=>{if(!Oe){de([]);return}try{const ce=await Ar(Oe);de(ce)}catch{}})()},[Oe]),x.useEffect(()=>{if(r==="create"&&Ae!=null&&Ae.active&&W===100){B(200);try{je.featureUsed((s==null?void 0:s.id)||"system","event_capacity_auto_applied")}catch{}}},[r,Ae==null?void 0:Ae.active]),x.useEffect(()=>{try{je.featureUsed((s==null?void 0:s.id)||"system","events_sort_changed")}catch{}},[g]);const nt=async()=>{var ce;try{Q(!0),re(null);const Ie=await mi(Oe,se?se.split(",").map(ct=>ct.trim()).join(","):void 0,{limit:k,offset:h}),Le=new Map;[...c,...Ie.items].forEach(ct=>Le.set(ct.id,ct)),l(Array.from(Le.values())),b(h+Ie.items.length),te(!!((ce=Ie.pagination)!=null&&ce.hasMore)),je.featureUsed((s==null?void 0:s.id)||"system","events_load_more_backend_recommended")}catch{re("Falha ao carregar recomendaÃ§Ãµes");try{je.featureUsed((s==null?void 0:s.id)||"system","events_load_more_backend_recommended_error")}catch{}_<1&&(P(_+1),setTimeout(()=>{nt()},800))}finally{Q(!1)}},Xe=async()=>{var ce;try{G(!0),fe(null);const Ie=await hr(Oe,{tag:d.tag||void 0,limit:f,offset:N}),Le=new Map;[...n,...Ie.items].forEach(ct=>Le.set(ct.id,ct)),o(Array.from(Le.values())),T(N+Ie.items.length),$(!!((ce=Ie.pagination)!=null&&ce.hasMore)),je.featureUsed((s==null?void 0:s.id)||"system","events_load_more_backend_list")}catch{fe("Falha ao carregar eventos");try{je.featureUsed((s==null?void 0:s.id)||"system","events_load_more_backend_list_error")}catch{}M<1&&(C(M+1),setTimeout(()=>{Xe()},800))}finally{G(!1)}},we=x.useMemo(()=>{const ce=c.slice();return ce.sort((Ie,Le)=>g==="occupancy"?Lt(Le.capacity,Le.attendees)-Lt(Ie.capacity,Ie.attendees):new Date(Ie.dateTime).getTime()-new Date(Le.dateTime).getTime()),ce},[c,g]),Re=x.useMemo(()=>{const ce=n.slice();return ce.sort((Ie,Le)=>g==="occupancy"?Lt(Le.capacity,Le.attendees)-Lt(Ie.capacity,Ie.attendees):new Date(Ie.dateTime).getTime()-new Date(Le.dateTime).getTime()),ce},[n,g]),rt=async()=>{if(!Oe)return;const ce=he.split(",").map(Le=>Le.trim()).filter(Boolean),Ie={name:A.trim(),dateTime:new Date(S).toISOString(),locationText:ae.trim()||void 0,lat:U?Number(U):void 0,lng:L?Number(L):void 0,description:K.trim()||void 0,capacity:W,tags:se.split(",").map(Le=>Le.trim()).filter(Boolean),privacy:V,ownerId:Oe,invitedIds:ce};if(!(!Ie.name||!Ie.dateTime)){p(!0);try{const Le=await yl(Ie);O(""),I(""),ne(""),R(""),oe(""),xe(""),B(100),z(""),ie("public"),H(""),i("explore");const ct=await fn(Oe);o(ct),t(`/event/${Le.id}`)}catch{}p(!1)}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"ğŸ‰ Eventos Sociais"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i("explore"),className:`px-4 py-2 rounded ${r==="explore"?Me.tabActive:Me.tabInactive}`,children:"Explorar"}),e.jsx("button",{onClick:()=>i("create"),className:`px-4 py-2 rounded ${r==="create"?Me.tabActive:Me.tabInactive}`,children:"Criar Evento"}),e.jsx($e,{to:"/organizer",className:`${Me.tabActive}`,children:"Painel do Organizador"})]})]}),!ve&&e.jsx("div",{className:"bg-red-900/20 border border-red-600/40 p-4 rounded mb-6 text-red-300 text-sm",children:"Selecione um herÃ³i para atuar como usuÃ¡rio atual."}),r==="explore"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:`bg-gray-800 p-4 rounded border ${qe}`,children:e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"Tag"}),e.jsx("input",{value:d.tag,onChange:ce=>m({tag:ce.target.value}),placeholder:"ex: mÃºsica, jogos",className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"})]}),e.jsx("button",{onClick:it,className:`${Me.tabActive}`,children:"Filtrar"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-400 ml-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:ce=>w(ce.target.checked)}),"Quase lotados"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-400 ml-2",children:[e.jsx("span",{children:"Ordenar"}),e.jsxs("select",{value:g,onChange:ce=>v(ce.target.value),className:"px-2 py-1 rounded border bg-slate-900 border-slate-600 text-slate-200",children:[e.jsx("option",{value:"date",children:"Data"}),e.jsx("option",{value:"occupancy",children:"OcupaÃ§Ã£o"})]})]})]})}),y&&e.jsx("div",{className:"text-xs text-red-300 bg-red-900/20 border border-red-600/40 rounded p-3",children:"Filtrando por eventos quase lotados (ocupaÃ§Ã£o â‰¥ 90%)."}),u&&c.length===0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-slate-400 inline-flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full"}),e.jsx("span",{children:"Carregando sugestÃµesâ€¦"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((ce,Ie)=>e.jsxs("div",{className:"bg-slate-800 p-4 rounded border border-slate-700 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-slate-700 rounded w-2/3"}),e.jsx("div",{className:"h-3 bg-slate-700 rounded w-1/3 mt-2"}),e.jsx("div",{className:"h-24 bg-slate-800 rounded mt-4"})]},Ie))})]}),c.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"SugestÃµes para vocÃª"}),e.jsx("button",{onClick:it,className:`${Me.tabInactive}`,children:"Atualizar"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:we.filter(ce=>y?ta(ce.capacity,ce.attendees):!0).map(ce=>e.jsxs("div",{className:`bg-gray-800 p-4 rounded border ${qe} hover:shadow-lg hover:border-slate-600`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:ce.name}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(ce.dateTime).toLocaleString()}),ce.locationText&&e.jsx("div",{className:"text-xs text-slate-400",children:ce.locationText})]}),e.jsx("div",{className:"text-2xl",children:"ğŸ“"})]}),ta(ce.capacity,ce.attendees)?e.jsx("div",{className:"mt-1 text-[11px] px-2 py-0.5 rounded bg-red-900/20 text-red-300 border border-red-600/40 inline-block",children:"Quase lotado"}):null,e.jsx("div",{className:"text-sm text-slate-300 mt-2 line-clamp-3",children:ce.description}),e.jsxs("div",{className:"mt-1 text-[11px] text-slate-400",children:["OcupaÃ§Ã£o: ",Lt(ce.capacity,ce.attendees),"%"]}),e.jsx("div",{className:"w-full h-2 bg-slate-700 rounded mt-1",children:e.jsx("div",{className:`h-2 rounded ${ta(ce.capacity,ce.attendees)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${Lt(ce.capacity,ce.attendees)}%`}})}),e.jsx("div",{className:"mt-2 text-xs text-slate-400",children:ce.tags.join(", ")}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>t(`/event/${ce.id}`),className:`w-full px-3 py-2 rounded ${Me.tabActive}`,children:"Ver Detalhes"})})]},ce.id))}),e.jsxs("div",{className:"mt-3",children:[F?e.jsx("button",{onClick:nt,disabled:X,className:`${Me.tabInactive}`,children:X?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full"})," Carregandoâ€¦"]}):"Mostrar mais"}):e.jsx("span",{className:"text-xs text-slate-400",children:"Fim das recomendaÃ§Ãµes"}),J&&e.jsxs("div",{className:"text-xs text-red-300 mt-1 inline-flex items-center gap-2",children:[e.jsx("span",{children:J}),e.jsx("button",{onClick:nt,className:"px-2 py-0.5 rounded bg-red-900/20 border border-red-600/40 text-red-300",children:"Tentar novamente"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Todos os eventos"}),e.jsx("button",{onClick:it,className:`${Me.tabInactive}`,children:"Atualizar"})]}),u&&n.length===0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-slate-400 inline-flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full"}),e.jsx("span",{children:"Carregando eventosâ€¦"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((ce,Ie)=>e.jsxs("div",{className:"bg-slate-800 p-4 rounded border border-slate-700 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-slate-700 rounded w-2/3"}),e.jsx("div",{className:"h-3 bg-slate-700 rounded w-1/3 mt-2"}),e.jsx("div",{className:"h-24 bg-slate-800 rounded mt-4"})]},Ie))})]}),n.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Re.filter(ce=>y?ta(ce.capacity,ce.attendees):!0).map(ce=>e.jsxs("div",{className:`bg-gray-800 p-4 rounded border ${qe} hover:shadow-lg hover:border-slate-600`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:ce.name}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(ce.dateTime).toLocaleString()}),ce.locationText&&e.jsx("div",{className:"text-xs text-slate-400",children:ce.locationText})]}),e.jsx("div",{className:"text-2xl",children:"ğŸŸï¸"})]}),ta(ce.capacity,ce.attendees)?e.jsx("div",{className:"mt-1 text-[11px] px-2 py-0.5 rounded bg-red-900/20 text-red-300 border border-red-600/40 inline-block",children:"Quase lotado"}):null,e.jsx("div",{className:"text-sm text-slate-300 mt-2 line-clamp-3",children:ce.description}),e.jsxs("div",{className:"mt-1 text-[11px] text-slate-400",children:["OcupaÃ§Ã£o: ",Lt(ce.capacity,ce.attendees),"%"]}),e.jsx("div",{className:"w-full h-2 bg-slate-700 rounded mt-1",children:e.jsx("div",{className:`h-2 rounded ${ta(ce.capacity,ce.attendees)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${Lt(ce.capacity,ce.attendees)}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Capacidade: ",ce.capacity]}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>t(`/event/${ce.id}`),className:`w-full px-3 py-2 rounded ${Me.tabActive}`,children:"Ver Detalhes"})})]},ce.id))}),e.jsxs("div",{className:"mt-3",children:[D?e.jsx("button",{onClick:Xe,disabled:Y,className:`${Me.tabInactive}`,children:Y?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-gray-500 border-t-transparent rounded-full"})," Carregandoâ€¦"]}):"Mostrar mais"}):e.jsx("span",{className:"text-xs text-slate-400",children:"Fim dos resultados"}),ee&&e.jsxs("div",{className:"text-xs text-red-300 mt-1 inline-flex items-center gap-2",children:[e.jsx("span",{children:ee}),e.jsx("button",{onClick:Xe,className:"px-2 py-0.5 rounded bg-red-900/20 border border-red-600/40 text-red-300",children:"Tentar novamente"})]})]})]}):e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸŸï¸"}),e.jsx("div",{children:"Nenhum evento disponÃ­vel"})]})]})]}),r==="create"&&e.jsx("div",{className:`max-w-2xl mx-auto bg-gray-800 p-6 rounded border ${qe}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"Nome"}),e.jsx("input",{value:A,onChange:ce=>O(ce.target.value),className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"Data/HorÃ¡rio"}),e.jsx("input",{type:"datetime-local",value:S,onChange:ce=>I(ce.target.value),className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"LocalizaÃ§Ã£o"}),e.jsx("input",{value:ae,onChange:ce=>ne(ce.target.value),className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("input",{placeholder:"Lat",value:U,onChange:ce=>R(ce.target.value),className:"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),e.jsx("input",{placeholder:"Lng",value:L,onChange:ce=>oe(ce.target.value),className:"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:K,onChange:ce=>xe(ce.target.value),rows:4,className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"Limite de participantes"}),e.jsx("input",{type:"number",value:W,onChange:ce=>B(Number(ce.target.value)),className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:Ae!=null&&Ae.active?"Passe de temporada ativo: capacidade recomendada ampliada.":"Capacidade padrÃ£o."}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>B(Ae!=null&&Ae.active?200:100),className:`${Me.tabActive} text-xs`,children:"Aplicar capacidade sugerida"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"Categorias/tags (separadas por vÃ­rgula)"}),e.jsx("input",{value:se,onChange:ce=>z(ce.target.value),className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"Privacidade"}),e.jsxs("select",{value:V,onChange:ce=>ie(ce.target.value),className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200",children:[e.jsx("option",{value:"public",children:"PÃºblico"}),e.jsx("option",{value:"private",children:"Privado"}),e.jsx("option",{value:"invite",children:"Convidados especÃ­ficos"})]})]}),V!=="public"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200",children:"Convidados (IDs separados por vÃ­rgula)"}),e.jsx("input",{value:he,onChange:ce=>H(ce.target.value),className:"mt-1 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),me.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Selecione amigos para adicionar"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:me.map(ce=>e.jsx("button",{type:"button",onClick:()=>{const Ie=he.split(",").map(Le=>Le.trim()).filter(Boolean);Ie.includes(ce)||H(Ie.concat(ce).join(", "))},className:`${Me.tabInactive} text-xs`,children:ce.slice(0,6)},ce))})]})]}),e.jsx("button",{onClick:rt,disabled:!A.trim()||!S||u||!ve,className:`w-full px-4 py-2 rounded ${Me.tabActive}`,children:"Criar Evento"})]})})]})},Bm=()=>{const{id:a}=Jn(),{getSelectedHero:s}=Z(),t=s(),r=x.useMemo(()=>(t==null?void 0:t.id)||"",[t==null?void 0:t.id]),[i,n]=x.useState(null),[o,c]=x.useState(""),[l,d]=x.useState([]),[m,u]=x.useState(""),[p,g]=x.useState(!1),[v,y]=x.useState([]),[w,k]=x.useState(""),[E,h]=x.useState(""),[b,f]=x.useState(!1),[j,N]=x.useState(!1),[T,F]=x.useState(!1),[te,D]=x.useState(0),[$,X]=x.useState(5),[Q,Y]=x.useState(""),[G,J]=x.useState([]),[re,ee]=x.useState(!1),[fe,_]=x.useState(null),[P,M]=x.useState(null),[C,A]=x.useState(!1),[O,S]=x.useState(30),I=x.useRef(null),[ae,ne]=x.useState(!1),[U,R]=x.useState(30),L=x.useRef(null),[oe,K]=x.useState(0),[xe,W]=x.useState(null),B=x.useRef(null),se=x.useRef(null),z=x.useRef(null),V=async()=>{var Re;if(!a)return;const we=await jl(a,r);if(n(we),we){const rt=(Re=we.attendees)==null?void 0:Re[r];if(c(rt||""),f(!0),B.current)try{B.current.abort()}catch{}B.current=new AbortController;const Pe=await di(we.id,B.current.signal);d(Pe),W(Pe.length?Math.max(...Pe.map(Ie=>Ie.ts)):null),K(0),f(!1),N(!0);const ce=await qs(we.id,B.current.signal);y(ce),N(!1)}};x.useEffect(()=>{V()},[a,r]),x.useEffect(()=>()=>{var we,Re,rt;try{(we=B.current)==null||we.abort()}catch{}try{(Re=se.current)==null||Re.abort()}catch{}try{(rt=z.current)==null||rt.abort()}catch{}},[]),x.useEffect(()=>{(async()=>{if(!r){J([]);return}try{const we=await Ar(r);J(we)}catch{}})()},[r]);const ie=x.useMemo(()=>Object.values((i==null?void 0:i.attendees)||{}).filter(we=>we==="yes").length,[i==null?void 0:i.attendees]),he=x.useMemo(()=>ta(i==null?void 0:i.capacity,i==null?void 0:i.attendees),[i==null?void 0:i.capacity,i==null?void 0:i.attendees]),H=x.useMemo(()=>Lt(i==null?void 0:i.capacity,i==null?void 0:i.attendees),[i==null?void 0:i.capacity,i==null?void 0:i.attendees]),me=x.useMemo(()=>{var Pe;if(!i)return!1;const we=new Date(i.dateTime).getTime(),Re=Date.now()>=we,rt=((Pe=i.attendees)==null?void 0:Pe[r])==="yes";return Re&&rt},[i,r]),de=x.useMemo(()=>{if(!i)return"";if(typeof i.lat=="number"&&typeof i.lng=="number"){const we=`${i.lat},${i.lng}`;return`https://www.google.com/maps?q=${encodeURIComponent(we)}&output=embed`}return i.locationText?`https://www.google.com/maps?q=${encodeURIComponent(i.locationText)}&output=embed`:""},[i==null?void 0:i.lat,i==null?void 0:i.lng,i==null?void 0:i.locationText]),ve=async we=>{if(!(!i||!r))try{_(null);const Re=await Nl(i.id,r,we);n(Re),c(we);try{je.featureUsed((t==null?void 0:t.id)||"system","event_presence_set")}catch{}}catch(Re){_((Re==null?void 0:Re.message)||"Falha ao confirmar presenÃ§a")}},Ae=async()=>{if(!i||!r)return;const we=m.trim();if(!we)return;const Re=await Sl(i.id,r,we);d(rt=>[...rt.slice(-99),Re]),u("")},Te=async()=>{if(!i||!r)return;const we=w.trim();if(!we)return;F(!0),D(5);let Re=null;try{Re=setInterval(()=>{D(Pe=>Math.min(90,Pe+15))},150);const rt=await Cl(i.id,r,we,E.trim()||void 0);D(100),setTimeout(()=>{F(!1),D(0)},300),y(Pe=>[...Pe.slice(-99),rt]),k(""),h("");try{je.featureUsed((t==null?void 0:t.id)||"system","event_media_add")}catch{}}catch{F(!1),D(0)}finally{Re&&clearInterval(Re)}},qe=async()=>{if(!i||!r)return;await kl(i.id,r,$,Q.trim()||void 0)&&Y("")},Oe=async we=>{try{if(!i||!r||i.ownerId!==r)return;ee(!0);const Re=Array.isArray(i==null?void 0:i.invitedIds)?i.invitedIds.slice():[];Re.includes(we)||Re.push(we);const rt=await bn(i.id,r,{invitedIds:Re});n(rt)}catch{}finally{ee(!1)}};x.useEffect(()=>{if(!i||!C)return;const we=async()=>{try{if(se.current)try{se.current.abort()}catch{}se.current=new AbortController;const Re=await qs(i.id,se.current.signal);y(Re)}catch{}};I.current=setInterval(we,O*1e3);try{je.featureUsed((t==null?void 0:t.id)||"system","event_media_auto_refresh_enabled")}catch{}return()=>{var Re;if(I.current){clearInterval(I.current),I.current=null;try{je.featureUsed((t==null?void 0:t.id)||"system","event_media_auto_refresh_disabled")}catch{}}try{(Re=se.current)==null||Re.abort()}catch{}}},[C,i==null?void 0:i.id,O]),x.useEffect(()=>{if(!i||!ae)return;const we=async()=>{try{if(z.current)try{z.current.abort()}catch{}z.current=new AbortController;const Re=await di(i.id,z.current.signal);if(d(Re),(Re.length?Math.max(...Re.map(Pe=>Pe.ts)):null)!==null&&xe!==null){const Pe=Re.filter(ce=>ce.ts>xe).length;K(Pe)}}catch{}};L.current=setInterval(we,U*1e3);try{je.featureUsed((t==null?void 0:t.id)||"system","event_chat_auto_refresh_enabled")}catch{}return()=>{var Re;if(L.current){clearInterval(L.current),L.current=null;try{je.featureUsed((t==null?void 0:t.id)||"system","event_chat_auto_refresh_disabled")}catch{}}try{(Re=z.current)==null||Re.abort()}catch{}}},[ae,i==null?void 0:i.id,U]);const it=()=>{var Be;if(!i)return;const we=new Date(i.dateTime),Re=Ge=>String(Ge).padStart(2,"0"),rt=Ge=>{const ke=Ge.getUTCFullYear(),De=Re(Ge.getUTCMonth()+1),Ne=Re(Ge.getUTCDate()),pe=Re(Ge.getUTCHours()),be=Re(Ge.getUTCMinutes()),Se=Re(Ge.getUTCSeconds());return`${ke}${De}${Ne}T${pe}${be}${Se}Z`},Pe=rt(we),ce=rt(new Date(we.getTime()+2*60*60*1e3)),Le=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HeroForgeNew//Social Events//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${`evt-${i.id}@heroforgenew`}`,`DTSTAMP:${Pe}`,`DTSTART:${Pe}`,`DTEND:${ce}`,`SUMMARY:${(i.name||"Evento").replace(/\r|\n/g," ")}`,`DESCRIPTION:${(i.description||"").replace(/\r|\n/g," ")}`,`LOCATION:${(i.locationText||"").replace(/\r|\n/g," ")}`,"END:VEVENT","END:VCALENDAR"],ct=new Blob([Le.join(`\r
`)],{type:"text/calendar;charset=utf-8"}),ue=URL.createObjectURL(ct),ye=document.createElement("a");ye.href=ue,ye.download=`${((Be=i.name)==null?void 0:Be.replace(/[^a-z0-9]+/gi,"-"))||"evento"}.ics`,ye.click(),URL.revokeObjectURL(ue);try{je.featureUsed((t==null?void 0:t.id)||"system","event_ics_downloaded")}catch{}},nt=()=>{if(!i)return;const we=window.location.origin+`/event/${i.id}`,Re=`${i.name} â€” ${new Date(i.dateTime).toLocaleString()}${i.locationText?` â€¢ ${i.locationText}`:""}`,rt=`${Re}
${we}`,Pe=`https://wa.me/?text=${encodeURIComponent(rt)}`;`${encodeURIComponent(i.name||"Evento")}${encodeURIComponent(rt)}`;try{const ce=navigator;if(ce.share){ce.share({title:i.name,text:Re,url:we});try{je.featureUsed((t==null?void 0:t.id)||"system","event_shared_native")}catch{}return}}catch{}window.open(Pe,"_blank");try{je.featureUsed((t==null?void 0:t.id)||"system","event_shared_whatsapp")}catch{}},Xe=async()=>{try{if(!i)return;const we=window.location.origin+`/event/${i.id}`;await navigator.clipboard.writeText(we);try{je.featureUsed((t==null?void 0:t.id)||"system","event_link_copied")}catch{}}catch{}};return i?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded border",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:i.name}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(i.dateTime).toLocaleString()}),i.locationText&&e.jsx("div",{className:"text-sm text-gray-600",children:i.locationText}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Capacidade: ",i.capacity," â€¢ Confirmados: ",ie]})]}),e.jsx("div",{className:"text-3xl",children:"ğŸ‰"})]}),e.jsx("div",{className:"mt-3 text-gray-800 whitespace-pre-line",children:i.description}),he&&e.jsx("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-red-50 text-red-700 border border-red-200 inline-block",children:"Quase lotado"}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"OcupaÃ§Ã£o"}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded",children:e.jsx("div",{className:`h-2 rounded ${he?"bg-red-500":"bg-green-500"}`,style:{width:`${H}%`}})}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[H,"%"]})]}),de&&e.jsx("div",{className:"mt-4",children:e.jsx("iframe",{title:"map",src:de,className:"w-full h-64 rounded border",loading:"lazy"})}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>ve("yes"),disabled:ie>=(i.capacity||0)&&o!=="yes",className:`px-3 py-2 rounded ${o==="yes"?"bg-green-600 text-white":"bg-gray-200 text-gray-800"} ${ie>=(i.capacity||0)&&o!=="yes"?"opacity-60 cursor-not-allowed":""}`,children:"Vou"}),e.jsx("button",{onClick:()=>ve("maybe"),className:`px-3 py-2 rounded ${o==="maybe"?"bg-yellow-500 text-white":"bg-gray-200 text-gray-800"}`,children:"Talvez"}),e.jsx("button",{onClick:()=>ve("no"),className:`px-3 py-2 rounded ${o==="no"?"bg-red-500 text-white":"bg-gray-200 text-gray-800"}`,children:"NÃ£o vou"}),fe&&e.jsx("span",{className:"text-xs text-red-600 ml-2",children:fe}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("button",{onClick:it,className:"px-3 py-2 rounded bg-gray-800 text-white",children:"Adicionar ao calendÃ¡rio"}),e.jsx("button",{onClick:nt,className:"px-3 py-2 rounded bg-indigo-600 text-white",children:"Compartilhar"}),e.jsx("button",{onClick:Xe,className:"px-3 py-2 rounded bg-gray-200 text-gray-800",children:"Copiar Link"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Chat do Evento"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:we=>ne(we.target.checked)})," Auto-refresh"]}),e.jsxs("select",{value:U,onChange:we=>R(Number(we.target.value)),className:"px-2 py-1 rounded border text-xs",children:[e.jsx("option",{value:15,children:"15s"}),e.jsx("option",{value:30,children:"30s"}),e.jsx("option",{value:60,children:"60s"})]}),oe>0&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-amber-100 text-amber-700 text-xs",children:["Novas ",oe]}),e.jsx("button",{onClick:()=>{const we=l.length?Math.max(...l.map(Re=>Re.ts)):null;W(we),K(0)},className:"px-2 py-1 rounded bg-gray-200 text-gray-800 text-xs",children:"Marcar como lidas"})]})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto border rounded p-2 bg-gray-50",children:[b&&l.length===0&&e.jsxs("div",{className:"space-y-2 animate-pulse",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),p&&e.jsx("div",{className:"text-xs text-gray-600",children:"Enviandoâ€¦"}),l.length>0?l.map(we=>e.jsxs("div",{className:"text-sm text-gray-800 flex justify-between",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:we.userId.slice(0,6)}),": ",we.text]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(we.ts).toLocaleTimeString()})]},we.id)):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem mensagens ainda"})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{value:m,onChange:we=>u(we.target.value),placeholder:"Mensagem",className:"flex-1 p-2 border rounded"}),e.jsx("button",{onClick:Ae,disabled:!m.trim()||p,className:"px-3 py-2 rounded bg-blue-600 text-white",children:p?"Enviandoâ€¦":"Enviar"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"MÃ­dias"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r===i.ownerId&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:we=>A(we.target.checked)})," Auto-refresh"]}),e.jsxs("select",{value:O,onChange:we=>S(Number(we.target.value)),className:"px-2 py-1 rounded border text-xs",children:[e.jsx("option",{value:15,children:"15s"}),e.jsx("option",{value:30,children:"30s"}),e.jsx("option",{value:60,children:"60s"})]})]}),e.jsx("button",{onClick:async()=>{if(!i)return;const we=v.length;N(!0);try{const Re=await qs(i.id);y(Re),M(Math.max(0,Re.length-we));try{je.featureUsed((t==null?void 0:t.id)||"system","event_media_refresh")}catch{}}finally{N(!1)}},className:"px-2 py-1 rounded bg-gray-200 text-gray-800 text-xs",children:"Atualizar"})]})]}),P!==null&&e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Atualizado ",P," itens"]}),j&&v.length===0&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 animate-pulse",children:[e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsx("div",{className:"w-full h-32 bg-gray-200"})}),e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsx("div",{className:"w-full h-32 bg-gray-200"})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:v.map(we=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("img",{src:we.url,alt:we.caption||"",className:"w-full h-32 object-cover"}),we.caption&&e.jsx("div",{className:"text-xs p-2 text-gray-700",children:we.caption})]},we.id))}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("input",{value:w,onChange:we=>k(we.target.value),placeholder:"URL da imagem/vÃ­deo",className:"flex-1 p-2 border rounded"}),e.jsx("input",{value:E,onChange:we=>h(we.target.value),placeholder:"Legenda (opcional)",className:"flex-1 p-2 border rounded"}),e.jsx("button",{onClick:Te,disabled:!w.trim()||T,className:"px-3 py-2 rounded bg-indigo-600 text-white",children:T?"Enviandoâ€¦":"Adicionar"})]}),T&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded",children:e.jsx("div",{className:"h-2 rounded bg-indigo-600",style:{width:`${te}%`}})}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[te,"%"]})]})]})]}),me&&e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"font-semibold mb-2",children:"AvaliaÃ§Ã£o pÃ³s-evento"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:1,max:5,value:$,onChange:we=>X(Number(we.target.value))}),e.jsxs("div",{className:"text-sm text-gray-700",children:[$," â­"]})]}),e.jsx("textarea",{value:Q,onChange:we=>Y(we.target.value),rows:3,placeholder:"ComentÃ¡rio",className:"mt-2 w-full p-2 border rounded"}),e.jsx("button",{onClick:qe,className:"mt-2 px-3 py-2 rounded bg-amber-600 text-white",children:"Enviar AvaliaÃ§Ã£o"})]}),r===i.ownerId&&e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Convidar Amigos"}),G.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:G.map(we=>e.jsx("button",{onClick:()=>Oe(we),disabled:re||(i.invitedIds||[]).includes(we),className:`px-2 py-1 rounded ${(i.invitedIds||[]).includes(we)?"bg-gray-300 text-gray-700":"bg-indigo-600 text-white hover:bg-indigo-700"} text-xs`,children:we.slice(0,6)},we))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sua lista de amigos estÃ¡ vazia."})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸŸï¸"}),e.jsx("div",{className:"text-gray-600",children:"Evento nÃ£o encontrado"})]})},Om=()=>{var f;const{getSelectedHero:a}=Z(),s=a(),t=x.useMemo(()=>(s==null?void 0:s.id)||"",[s==null?void 0:s.id]),r=ua(),[i,n]=x.useState([]),[o,c]=x.useState(!1),[l,d]=x.useState(!1),[m,u]=x.useState("date"),[p,g]=x.useState(!1),{activeSeasonalTheme:v}=Z(),y=v&&((f=Ke[v])==null?void 0:f.border)||"border-slate-700",w=async()=>{if(!t){n([]);return}c(!0);try{const j=await fn(t,{ownerId:t});n(j)}catch{}c(!1)};x.useEffect(()=>{w()},[t]),x.useEffect(()=>{try{new URLSearchParams(r.search).get("nearFull")==="1"&&g(!0)}catch{}},[r.search]);const k=async(j,N)=>{if(!t)return;const T=await bn(j,t,N);n(F=>F.map(te=>te.id===j?T:te))},E=async j=>{if(!t)return;await wl(j,t)&&n(T=>T.filter(F=>F.id!==j))};x.useEffect(()=>{var j;try{(j=je.custom)==null||j.call(je,"organizer_sort_changed",{mode:m})}catch{}},[m]);const h=async()=>{try{if(!t)return;const j=new URLSearchParams;j.set("ownerId",t);const N=await fetch(`/api/events/export?${j.toString()}`);if(!N.ok)return;const T=await N.json(),F=new Blob([JSON.stringify((T==null?void 0:T.events)||[],null,2)],{type:"application/json"}),te=URL.createObjectURL(F),D=document.createElement("a");D.href=te,D.download=`events-${t}-${Date.now()}.json`,D.click(),URL.revokeObjectURL(te)}catch{}},b=async j=>{try{if(!t)return;d(!0);const N=await j.text(),T=JSON.parse(N);(await fetch("/api/events/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({actorId:t,events:Array.isArray(T)?T:[]})})).ok&&w()}catch{}finally{d(!1)}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[p&&e.jsx("div",{className:"mb-4 text-xs text-red-300 bg-red-900/20 border border-red-600/40 rounded p-3",children:"Filtrando por eventos quase lotados (ocupaÃ§Ã£o â‰¥ 90%)."}),i.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-6",children:(()=>{const j=i.length,N=Math.round(i.reduce((F,te)=>F+Lt(te.capacity,te.attendees),0)/Math.max(1,j)),T=i.filter(F=>ta(F.capacity,F.attendees)).length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`bg-gray-800 p-4 rounded border ${y}`,children:[e.jsx("div",{className:"text-sm text-slate-400",children:"Eventos"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:j})]}),e.jsxs("div",{className:`bg-gray-800 p-4 rounded border ${y}`,children:[e.jsx("div",{className:"text-sm text-slate-400",children:"OcupaÃ§Ã£o mÃ©dia"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[N,"%"]})]}),e.jsxs("div",{className:`bg-gray-800 p-4 rounded border ${y}`,children:[e.jsx("div",{className:"text-sm text-slate-400",children:"Quase lotados"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:T})]})]})})()}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"ğŸ› ï¸ Painel do Organizador"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:w,className:`${Me.tabInactive}`,children:"Atualizar"}),e.jsx("button",{onClick:h,className:`${Me.tabActive}`,children:"Exportar"}),e.jsxs("label",{className:`${Me.tabActive} cursor-pointer`,children:["Importar",e.jsx("input",{type:"file",accept:"application/json",onChange:j=>{var T;const N=(T=j.target.files)==null?void 0:T[0];N&&b(N)},className:"hidden"})]}),l&&e.jsx("span",{className:"text-xs text-slate-400",children:"Importandoâ€¦"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-400 ml-2",children:[e.jsx("span",{children:"Ordenar"}),e.jsxs("select",{value:m,onChange:j=>u(j.target.value),className:"px-2 py-1 rounded border bg-slate-900 border-slate-600 text-slate-200",children:[e.jsx("option",{value:"date",children:"Data"}),e.jsx("option",{value:"occupancy",children:"OcupaÃ§Ã£o"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-400 ml-2",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:j=>g(j.target.checked)})," Quase lotados"]})]})]}),!t&&e.jsx("div",{className:"bg-red-900/20 border border-red-600/40 p-4 rounded mb-6 text-red-300 text-sm",children:"Selecione um herÃ³i para gerenciar seus eventos."}),i.length>0?e.jsx("div",{className:"space-y-4",children:i.filter(j=>p?ta(j.capacity,j.attendees):!0).slice().sort((j,N)=>m==="occupancy"?Lt(N.capacity,N.attendees)-Lt(j.capacity,j.attendees):new Date(j.dateTime).getTime()-new Date(N.dateTime).getTime()).map(j=>{var N,T;return e.jsxs("div",{className:`bg-gray-800 p-4 rounded border ${y}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("input",{value:j.name,onChange:F=>k(j.id,{name:F.target.value}),className:"text-lg font-semibold text-white w-full bg-transparent"}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(j.dateTime).toLocaleString()}),(()=>{const F=Lt(j.capacity,j.attendees),te=ta(j.capacity,j.attendees);return e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[te&&e.jsx("span",{className:"px-2 py-0.5 rounded bg-red-900/20 text-red-300 border border-red-600/40 text-[11px]",children:"Quase lotado"}),e.jsxs("span",{className:"text-[11px] text-slate-400",children:["OcupaÃ§Ã£o: ",F,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-700 rounded mt-1",children:e.jsx("div",{className:`h-2 rounded ${te?"bg-red-500":"bg-emerald-500"}`,style:{width:`${F}%`}})})]})})()]}),e.jsx("button",{onClick:()=>E(j.id),className:"px-3 py-2 rounded bg-red-600 text-white",children:"Excluir"})]}),e.jsx("textarea",{value:j.description||"",onChange:F=>k(j.id,{description:F.target.value}),rows:3,className:"mt-2 w-full p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2",children:[e.jsx("input",{value:j.locationText||"",onChange:F=>k(j.id,{locationText:F.target.value}),placeholder:"LocalizaÃ§Ã£o",className:"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),e.jsx("input",{value:((N=j.lat)==null?void 0:N.toString())||"",onChange:F=>k(j.id,{lat:F.target.value?Number(F.target.value):void 0}),placeholder:"Lat",className:"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),e.jsx("input",{value:((T=j.lng)==null?void 0:T.toString())||"",onChange:F=>k(j.id,{lng:F.target.value?Number(F.target.value):void 0}),placeholder:"Lng",className:"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"}),e.jsx("input",{type:"number",value:j.capacity,onChange:F=>k(j.id,{capacity:Number(F.target.value)}),placeholder:"Capacidade",className:"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2",children:[e.jsxs("select",{value:j.privacy,onChange:F=>k(j.id,{privacy:F.target.value}),className:"p-2 border rounded bg-slate-900 border-slate-600 text-slate-200",children:[e.jsx("option",{value:"public",children:"PÃºblico"}),e.jsx("option",{value:"private",children:"Privado"}),e.jsx("option",{value:"invite",children:"Convidados"})]}),e.jsx("input",{value:(j.tags||[]).join(", "),onChange:F=>k(j.id,{tags:F.target.value.split(",").map(te=>te.trim()).filter(Boolean)}),placeholder:"Tags",className:"p-2 border rounded col-span-3 bg-slate-900 border-slate-600 text-slate-200"})]}),e.jsxs("div",{className:"text-xs text-slate-400 mt-2",children:["ID: ",j.id]})]},j.id)})}):e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ› ï¸"}),e.jsx("div",{children:"Nenhum evento criado"})]})]})},Lm=()=>{const{getSelectedHero:a,heroes:s}=Z(),t=a(),r=x.useMemo(()=>(t==null?void 0:t.id)||"",[t==null?void 0:t.id]),[i,n]=x.useState([]),[o,c]=x.useState(""),l=async()=>{if(!r){n([]);return}const u=await Ar(r);n(u)};x.useEffect(()=>{l()},[r]);const d=async()=>{if(!r||!o)return;await hl(r,o)&&l(),c("")},m=async u=>{if(!r)return;await fl(r,u)&&l()};return r?e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-gray-800 p-6 rounded border border-slate-700",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-4",children:"Amigos"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("select",{value:o,onChange:u=>c(u.target.value),className:"flex-1 p-2 border rounded bg-slate-900 border-slate-600 text-slate-200",children:[e.jsx("option",{value:"",children:"Selecionar herÃ³iâ€¦"}),s.filter(u=>u.id!==r).map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]}),e.jsx("button",{onClick:d,disabled:!o,className:`${Me.tabActive}`,children:"Adicionar"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Seus amigos"}),e.jsxs("ul",{className:"space-y-2",children:[i.map(u=>{var p;return e.jsxs("li",{className:"flex items-center justify-between bg-slate-800 p-2 rounded border border-slate-700",children:[e.jsx("span",{className:"text-slate-100",children:((p=s.find(g=>g.id===u))==null?void 0:p.name)||u.slice(0,6)}),e.jsx("button",{onClick:()=>m(u),className:"px-3 py-1 rounded bg-red-600 text-white text-sm",children:"Remover"})]},u)}),i.length===0&&e.jsx("li",{className:"text-xs text-slate-400",children:"VocÃª ainda nÃ£o tem amigos adicionados."})]})]})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ¤"}),e.jsx("div",{className:"text-slate-400",children:"Selecione um herÃ³i para gerenciar amigos"})]})},Hm=()=>{const{getSelectedHero:a}=Z(),s=a(),t=x.useMemo(()=>(s==null?void 0:s.id)||"",[s==null?void 0:s.id]),[r,i]=x.useState([]),n=Wt(),o=async()=>{if(!t){i([]);return}const c=await hn(t);i(c)};return x.useEffect(()=>{o()},[t]),t?e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"NotificaÃ§Ãµes"}),e.jsx("button",{onClick:o,className:`${Me.tabInactive}`,children:"Atualizar"})]}),r.length>0?e.jsx("div",{className:"space-y-3",children:r.map(c=>{var l,d;return e.jsxs("div",{className:"bg-gray-800 p-4 rounded border border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-300",children:"Evento recomendado"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:(l=c.event)==null?void 0:l.name}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date((d=c.event)==null?void 0:d.dateTime).toLocaleString()}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>{var m;return n(`/event/${(m=c.event)==null?void 0:m.id}`)},className:`${Me.tabActive}`,children:"Ver evento"})})]},c.id)})}):e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ””"}),e.jsx("div",{children:"Sem notificaÃ§Ãµes no momento"})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ””"}),e.jsx("div",{className:"text-slate-400",children:"Selecione um herÃ³i para ver notificaÃ§Ãµes"})]})},Gm=()=>{const{getSelectedHero:a}=Z(),s=a(),t=x.useMemo(()=>(s==null?void 0:s.id)||"",[s==null?void 0:s.id]),[r,i]=x.useState([]),n=Wt(),o=async()=>{if(!t){i([]);return}const c=await bl(t);i(c)};return x.useEffect(()=>{o()},[t]),t?e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"HistÃ³rico de ParticipaÃ§Ã£o"}),e.jsx("button",{onClick:o,className:"px-3 py-2 rounded bg-gray-200",children:"Atualizar"})]}),r.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(c=>e.jsxs("div",{className:"bg-white p-4 rounded border hover:shadow",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800",children:c.name}),e.jsx("div",{className:"text-xs text-gray-600",children:new Date(c.dateTime).toLocaleString()}),c.locationText&&e.jsx("div",{className:"text-xs text-gray-600",children:c.locationText}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>n(`/event/${c.id}`),className:"w-full px-3 py-2 rounded bg-blue-600 text-white",children:"Abrir"})})]},c.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ—‚ï¸"}),e.jsx("div",{children:"Nenhum evento no histÃ³rico"})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-2",children:"ğŸ—‚ï¸"}),e.jsx("div",{className:"text-gray-600",children:"Selecione um herÃ³i para ver seu histÃ³rico"})]})},zm=()=>{const{getSelectedHero:a,heroes:s}=Z(),t=a(),r=Z(c=>Array.isArray(c.parties)?c.parties:[]),i=Z(c=>c.acceptPartyInvite),n=Z(c=>c.declinePartyInvite);if(!t)return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-5xl mb-3",children:"ğŸ‘¥"}),e.jsx("div",{className:"text-gray-300",children:"Selecione um herÃ³i para gerenciar convites de party."})]});const o=r.filter(c=>Array.isArray(c.invites)&&c.invites.includes(t.id));return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-amber-300 mb-4",children:"Convites de Party"}),o.length===0?e.jsx("div",{className:"text-gray-400",children:"Nenhum convite pendente."}):e.jsx("div",{className:"space-y-3",children:o.map(c=>{const l=s.find(m=>m.id===c.leaderId),d=(l==null?void 0:l.name)||c.leaderId.slice(-4);return e.jsxs("div",{className:"flex items-center justify-between bg-white/5 border border-white/10 rounded p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold",children:c.name}),e.jsxs("div",{className:"text-xs text-gray-300",children:["LÃ­der: ",d," â€¢ Membros: ",Array.isArray(c.members)?c.members.length:0]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(t.id,c.id),className:"px-3 py-2 rounded bg-green-600 hover:bg-green-700 text-white text-sm",children:"Aceitar"}),e.jsx("button",{onClick:()=>n(t.id,c.id),className:"px-3 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white text-sm",children:"Recusar"})]})]},c.id)})})]})},Um=()=>{const a=x.useMemo(()=>pt.getKPIDashboard(),[]),s=a.performance,t=a.engagement,r=a.gameplay,i=x.useMemo(()=>{const g=pt.getEvents().filter(b=>b.eventType==="feature-used");let v=0,y=0;const w={};g.forEach(b=>{var N,T;const f=String(((N=b.data)==null?void 0:N.feature)||""),j=String(((T=b.data)==null?void 0:T.device)||"unknown");w[j]||(w[j]={accepted:0,dismissed:0}),f==="pwa-install-accepted"&&(v++,w[j].accepted++),f==="pwa-install-dismissed"&&(y++,w[j].dismissed++)});const k=v+y,E=k>0?v/k:0,h=Object.entries(w).map(([b,f])=>({device:b,accepted:f.accepted,dismissed:f.dismissed,rate:f.accepted+f.dismissed>0?f.accepted/(f.accepted+f.dismissed):0}));return{accepted:v,dismissed:y,total:k,rate:E,deviceRows:h}},[]),n=x.useMemo(()=>{const g=pt.getEvents().filter(k=>{var E;return k.eventType==="feature-used"&&String((E=k.data)==null?void 0:E.feature)==="pwa-installed"}),v={};return g.forEach(k=>{const E=k.timestamp.toISOString().split("T")[0];v[E]=(v[E]||0)+1}),Array.from({length:7},(k,E)=>{const h=new Date;return h.setDate(h.getDate()-(6-E)),h.toISOString().split("T")[0]}).map(k=>({day:k,count:v[k]||0}))},[]),o=x.useMemo(()=>{const p=pt.getEvents(),g=p.filter(Q=>Q.eventType==="feature-used"),v=g.filter(Q=>{var Y;return((Y=Q.data)==null?void 0:Y.feature)==="shop-open"}).length,y=g.filter(Q=>{var Y;return((Y=Q.data)==null?void 0:Y.feature)==="premium-center-open"}).length,w=g.filter(Q=>{var Y;return((Y=Q.data)==null?void 0:Y.feature)==="shop-premium-banner-click"}).length,k=p.filter(Q=>Q.eventType==="purchase-initiated").length,E=p.filter(Q=>Q.eventType==="purchase-completed").length,h=v>0?w/v:0,b=w>0?k/w:0,f=k>0?E/k:0,j=p.filter(Q=>Q.eventType==="ad-impression").length,N=p.filter(Q=>Q.eventType==="ad-click").length,T=j>0?N/j:0,F=p.filter(Q=>Q.eventType==="purchase-completed"),te={"remove-ads":4.99,"season-pass":9.99},D=F.reduce((Q,Y)=>{var J;const G=String(((J=Y.data)==null?void 0:J.productId)||"");return G&&te[G]!==void 0?Q+te[G]:G.startsWith("frame-")?Q+1.99:G.startsWith("theme-")?Q+2.99:Q},0),$=new Set(F.map(Q=>Q.userId).filter(Boolean)).size,X=$>0?D/$:0;return{shopOpens:v,premiumOpens:y,premiumBannerClicks:w,purchaseInitiated:k,purchaseCompleted:E,rateBanner:h,rateCheckout:b,ratePurchase:f,adImpressions:j,adClicks:N,adCtr:T,revenue:D,arppu:X}},[]),c=x.useMemo(()=>{const g=pt.getEvents().filter(w=>w.eventType==="feature-used"),v=g.filter(w=>{var k;return((k=w.data)==null?void 0:k.feature)==="theme-switch"}).length,y=g.filter(w=>{var k;return((k=w.data)==null?void 0:k.feature)==="frame-switch"}).length;return{themeSwitches:v,frameSwitches:y}},[]),[l,d]=x.useState([]),[m,u]=x.useState(null);return x.useEffect(()=>{const p=new AbortController;return(async()=>{try{const g=await fetch("/api/metrics/daily",{signal:p.signal}),v=await g.json();g.ok&&Array.isArray(v==null?void 0:v.days)&&d(v.days)}catch{}try{const g=await fetch("/api/metrics/summary",{signal:p.signal}),v=await g.json();g.ok&&v&&u(v)}catch{}})(),()=>{try{p.abort()}catch{}}},[]),e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ğŸ“Š MÃ©tricas e KPIs"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"VisÃ£o Geral"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["UsuÃ¡rios totais: ",a.overview.totalUsers]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["UsuÃ¡rios ativos: ",a.overview.activeUsers]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["SessÃµes: ",a.overview.totalSessions]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["DuraÃ§Ã£o mÃ©dia: ",Math.round(a.overview.averageSessionDuration),"s"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Engajamento"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["DAU: ",t.dailyActiveUsers]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["WAU: ",t.weeklyActiveUsers]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["MAU: ",t.monthlyActiveUsers]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["AÃ§Ãµes por sessÃ£o: ",t.averageActionsPerSession.toFixed(1)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Performance"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Load: ",Math.round(s.pageLoadTime),"ms"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Render: ",Math.round(s.componentRenderTime),"ms"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["API: ",Math.round(s.apiResponseTime),"ms"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Erros: ",(s.errorRate*100).toFixed(2),"%"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["MemÃ³ria: ",Math.round(s.memoryUsage),"MB"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Gameplay"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["HerÃ³is: ",r.totalHeroes]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["MissÃµes: ",r.totalQuestsCompleted]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["XP Total: ",r.totalXpGained]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Ouro Total: ",r.totalGoldEarned]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Classe popular: ",r.mostPopularClass]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["MissÃ£o mais completada: ",r.mostCompletedQuest]})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"TendÃªncias"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["RetenÃ§Ã£o 7 dias: ",(r.conversionFunnels.retention7Days*100).toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-2",children:["UsuÃ¡rios por dia (Ãºltimos 7): ",a.trends.userGrowth.slice(-7).map(p=>p.count).join(", ")]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["SessÃµes por dia (Ãºltimos 7): ",a.trends.engagementTrend.slice(-7).map(p=>p.sessions).join(", ")]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"InstalaÃ§Ã£o PWA"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Total: ",i.total]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Aceitas: ",i.accepted]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Recusas: ",i.dismissed]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Taxa de aceitaÃ§Ã£o: ",(i.rate*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"ConversÃ£o por dispositivo"}),i.deviceRows.length===0?e.jsx("div",{className:"text-sm text-gray-700",children:"Sem dados"}):e.jsx("ul",{className:"text-sm text-gray-700 space-y-1",children:i.deviceRows.map(p=>e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:p.device}),": ",p.accepted,"/",p.accepted+p.dismissed," (",(p.rate*100).toFixed(1),"%)"]},p.device))})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"InstalaÃ§Ãµes por dia (7d)"}),e.jsx("div",{className:"text-xs text-gray-700",children:n.map(p=>`${p.day.split("-").slice(1).join("/")}:${p.count}`).join(" | ")})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Funil de MonetizaÃ§Ã£o"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Aberturas Loja: ",o.shopOpens]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Aberturas Premium: ",o.premiumOpens]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Cliques em Banner Premium: ",o.premiumBannerClicks," (",(o.rateBanner*100).toFixed(1),"%)"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Checkouts iniciados: ",o.purchaseInitiated," (",(o.rateCheckout*100).toFixed(1),"%)"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Compras concluÃ­das: ",o.purchaseCompleted," (",(o.ratePurchase*100).toFixed(1),"%)"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["ImpressÃµes de anÃºncio: ",o.adImpressions]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Cliques em anÃºncio: ",o.adClicks," (CTR ",(o.adCtr*100).toFixed(2),"%)"]}),e.jsxs("div",{className:"text-sm text-gray-800 mt-2",children:["Receita estimada: US$",o.revenue.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-gray-800",children:["ARPPU: US$",o.arppu.toFixed(2)]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"PersonalizaÃ§Ã£o (local)"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Trocas de tema: ",c.themeSwitches]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Trocas de frame: ",c.frameSwitches]})]}),e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"PersonalizaÃ§Ã£o por dia (remoto)"}),l.length===0?e.jsx("div",{className:"text-sm text-gray-700",children:"Sem dados"}):e.jsx("div",{className:"text-xs text-gray-700",children:l.slice(-7).map(p=>`${p.day.split("-").slice(1).join("/")}: Tema ${Number(p.themeSwitches||0)}, Frame ${Number(p.frameSwitches||0)}`).join(" | ")})]})]}),e.jsx("div",{className:"mt-6 grid grid-cols-1",children:e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800 mb-2",children:"MÃ©tricas agregadas (remoto)"}),l.length===0?e.jsx("div",{className:"text-sm text-gray-700",children:"Sem dados remotos"}):e.jsx("div",{className:"text-xs text-gray-700",children:l.slice(-7).map(p=>`${p.day.split("-").slice(1).join("/")}: Inst ${p.installs}, Comp ${p.purchases}, Sess ${p.sessions}, DAU ${p.dau}`).join(" | ")}),m&&e.jsxs("div",{className:"text-sm text-gray-800 mt-2",children:["Total instalaÃ§Ãµes: ",m.installs," â€¢ Compras: ",m.purchases," â€¢ Receita estimada: US$",m.revenue.toFixed(2)]})]})})]})},Vm=()=>{const a=ua(),s=r=>a.pathname===r,t=r=>s(r)?"px-3 py-1 rounded bg-amber-700 text-white font-semibold shadow":"px-3 py-1 rounded hover:bg-amber-800/40 text-amber-200 transition-colors";return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-serif text-amber-300",children:"ğŸ´ EstÃ¡bulo"})}),e.jsx("div",{className:"mb-6 bg-slate-800 border border-slate-600 rounded p-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($e,{to:"/stable/pets",className:t("/stable/pets"),children:"ğŸ¾ Mascotes"}),e.jsx($e,{to:"/stable/mounts",className:t("/stable/mounts"),children:"ğŸ‡ Montarias"})]})}),e.jsx(_i,{})]})},Qm=({feature:a})=>{const{getSelectedHero:s}=Z(),t=s(),r=Ba(i=>i.getGateStatus)(a,t);return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ”’"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Recurso bloqueado"}),e.jsx("p",{className:"text-gray-600 mb-1",children:r.reason||"Progresso insuficiente"}),e.jsx("div",{className:"text-xs text-gray-500 mb-6",children:r.nextHint}),r.nextHint&&e.jsx("p",{className:"text-gray-500 mb-6",children:r.nextHint}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx($e,{to:"/training",className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors",children:"Ir treinar"}),e.jsx($e,{to:"/evolution",className:"bg-amber-600 text-black px-6 py-2 rounded hover:bg-amber-700 transition-colors",children:"Ver evoluÃ§Ã£o"})]})]})},Ha=({feature:a,children:s})=>{const{getSelectedHero:t}=Z(),r=t();return Ba(n=>n.isFeatureEnabled)(a,r)?e.jsx(e.Fragment,{children:s}):e.jsx(Qm,{feature:a})},Xm=at.lazy(()=>wt(()=>import("./HeroDetail-78e4bc53.js"),["assets/HeroDetail-78e4bc53.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Jm=at.lazy(()=>wt(()=>import("./DynamicMissionsPanel-1a47a2bd.js"),["assets/DynamicMissionsPanel-1a47a2bd.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/dynamicMissionsAI-cc3e32c1.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Wm=at.lazy(()=>wt(()=>import("./AIRecommendationsPanel-1dfb27be.js"),["assets/AIRecommendationsPanel-1dfb27be.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Km=at.lazy(()=>wt(()=>import("./MissionsHub-b0f11d8b.js"),["assets/MissionsHub-b0f11d8b.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/dynamicMissionsAI-cc3e32c1.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"])),Ym=at.lazy(()=>wt(()=>import("./AdminDashboard-63e6dfee.js"),["assets/AdminDashboard-63e6dfee.js","assets/motion-3c015c26.js","assets/vendor-374d307f.js","assets/router-6c8d423a.js","assets/supabase-4349ac75.js","assets/icons-5fe8db7b.js"]));function Zm(){const{getSelectedHero:a}=Z(),s=a();return s?e.jsx(od,{hero:s}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ¦¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para ver sua progressÃ£o."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function eu(){const{getSelectedHero:a}=Z(),s=a();return s?e.jsx(ld,{hero:s}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ‘¥"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar o sistema de party."}),e.jsx($e,{to:"/",className:"bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function tu(){const{getSelectedHero:a}=Z(),s=a();return s?e.jsx(Pd,{heroId:s.id}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ¯"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para ver suas metas diÃ¡rias."}),e.jsx($e,{to:"/",className:"bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function au(){const{getSelectedHero:a}=Z(),s=a();return s?e.jsx(Od,{heroId:s.id,className:"max-w-6xl mx-auto"}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ†"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para ver sua evoluÃ§Ã£o de ranks."}),e.jsx($e,{to:"/",className:"bg-amber-600 text-white px-6 py-2 rounded hover:bg-amber-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function su(){const{getSelectedHero:a,refreshQuests:s,availableQuests:t,acceptQuest:r}=Z(),i=a();if(!i)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ—¡ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para ver missÃµes dinÃ¢micas."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]});const n=o=>{s(i.progression.level);const c=t.find(l=>i.progression.level>=l.levelRequirement&&!i.activeQuests.includes(l.id));c?(r(i.id,c.id),console.log("âœ… MissÃ£o IA aceita, vinculada a missÃ£o:",c.title)):console.log("âš ï¸ Nenhuma missÃ£o disponÃ­vel para vincular")};return e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"p-6",children:"Carregando..."}),children:e.jsx(Jm,{hero:i,className:"max-w-6xl mx-auto",onMissionAccept:n})})}function ru(){const{getSelectedHero:a,refreshQuests:s,availableQuests:t,acceptQuest:r,gainXP:i}=Z(),n=a();if(!n)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ§ "}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para ver recomendaÃ§Ãµes de IA."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]});const o=c=>{if(c.type==="quest"){s(n.progression.level);const l=t.find(d=>n.progression.level>=d.levelRequirement&&!n.activeQuests.includes(d.id));l?(r(n.id,l.id),console.log("âœ… RecomendaÃ§Ã£o aplicada: missÃ£o aceita",l.title)):console.log("âš ï¸ Nenhuma missÃ£o elegÃ­vel para aceitar no momento")}else c.type==="training"||c.type==="progression"?(i(n.id,25),console.log("âœ… RecomendaÃ§Ã£o aplicada: bÃ´nus de XP")):console.log("â„¹ï¸ RecomendaÃ§Ã£o aplicada:",c.type)};return e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"p-6",children:"Carregando..."}),children:e.jsx(Wm,{hero:n,className:"max-w-6xl mx-auto",onRecommendationApply:o})})}function iu(){const{getSelectedHero:a}=Z(),s=a();return s?e.jsx(mm,{hero:s}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ“–"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para ver seu diÃ¡rio de aventuras."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function nu(){const{getSelectedHero:a}=Z();return a()?e.jsx(hm,{}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ—¡ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para jogar uma missÃ£o rÃ¡pida."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function ou(){const{getSelectedHero:a}=Z();return a()?e.jsx(Ha,{feature:"hunting_basic",children:e.jsx(im,{})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ—¡ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar missÃµes de caÃ§a."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function cu(){const{getSelectedHero:a}=Z();return a()?e.jsx(Ha,{feature:"hunting_basic",children:e.jsx(Ad,{})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ“œ"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar missÃµes."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function lu(){const{getSelectedHero:a}=Z();return a()?e.jsx(Ha,{feature:"shop_basic",children:e.jsx(zd,{})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ›’"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar a loja."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function du(){const{getSelectedHero:a}=Z();return a()?e.jsx(Ha,{feature:"crafting_simple",children:e.jsx(_m,{})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âš’ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar a forja."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function $i(){var i;const{getSelectedHero:a}=Z(),s=a();if(!s)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ°"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar a dungeon."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]});const t=((i=s.rankData)==null?void 0:i.currentRank)||We.calculateRank(s);return["C","B","A","S","SS","SSS"].includes(t)?e.jsx(Zd,{}):e.jsxs("div",{className:"max-w-3xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ”’"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Dungeon bloqueada"}),e.jsxs("p",{className:"text-gray-600",children:["Requer rank C. Rank atual: ",t,"."]}),e.jsxs("div",{className:"flex gap-3 justify-center mt-4",children:[e.jsx($e,{to:"/training",className:"bg-green-600 text-white px-6 py-2 rounded",children:"Ir treinar"}),e.jsx($e,{to:"/quests",className:"bg-amber-600 text-black px-6 py-2 rounded",children:"Fazer missÃµes"}),e.jsx($e,{to:"/evolution",className:"bg-indigo-600 text-white px-6 py-2 rounded",children:"Ver evoluÃ§Ã£o"})]})]})}function mu(){const{getSelectedHero:a}=Z();return a()?Ba(r=>r.basicTrainingOnly)?e.jsx(Ha,{feature:"hunting_basic",children:e.jsx(Ei,{})}):e.jsx(Ei,{}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ’"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar o inventÃ¡rio."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function uu(){const{getSelectedHero:a}=Z();return a()?e.jsx(Ha,{feature:"stable_basic",children:e.jsx(Vm,{})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ´"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Nenhum herÃ³i selecionado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Selecione um herÃ³i para acessar o EstÃ¡bulo."}),e.jsx($e,{to:"/",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Voltar Ã  Lista de HerÃ³is"})]})}function pu(){const a=Z(o=>o.heroes),s=Z(o=>o.markCelebrationViewed),t=Z(o=>o.selectedHeroId),r=a.find(o=>o.id===t);x.useEffect(()=>{{try{const p=window.top;p&&window.self!==p&&(p.location.href=window.self.location.href)}catch{}const o=document.createElement("meta");o.httpEquiv="Content-Security-Policy";const c={}.VITE_SUPABASE_URL;let l="";try{l=c?new URL(c).origin:""}catch{}const d=["'self'",l,"https://vercel.live","wss://vercel.live","https://*.vercel.live","wss://*.vercel.live"].filter(Boolean).join(" "),m=["https://pagead2.googlesyndication.com","https://tpc.googlesyndication.com","https://googleads.g.doubleclick.net","https://ep1.adtrafficquality.google","https://ep2.adtrafficquality.google"],u=["https://fonts.gstatic.com","https://vercel.live","https://*.vercel.live"];o.content=["default-src 'self'",`frame-src 'self' https://vercel.live https://*.vercel.live https://accounts.google.com https://www.google.com ${m.join(" ")}`,`connect-src ${d} ${m.join(" ")}`,"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://accounts.google.com",`font-src 'self' ${u.join(" ")} data:`,`script-src 'self' ${m.join(" ")} https://vercel.live https://*.vercel.live`,"img-src 'self' data: blob: https:"].join("; ")+";",document.head.appendChild(o)}},[]),x.useEffect(()=>{try{r?document.title=Qa(r):document.title="HeroForgeNew"}catch{}},[r==null?void 0:r.id,r==null?void 0:r.activeTitle,r==null?void 0:r.name]),x.useEffect(()=>{try{si(1);let o=null;const c=Z.getState().getSelectedHero,l=Z.getState().updateHero,d=()=>{if(o){try{clearInterval(o)}catch{}o=null}o=setInterval(()=>{const p=c();if(!p)return;const g={...p.stats||{}},v=Math.max(0,g.totalPlayTime||0)+1;g.totalPlayTime=v,g.lastActiveAt=new Date().toISOString(),l(p.id,{stats:g})},6e4)},m=()=>{if(o){try{clearInterval(o)}catch{}o=null}};d();const u=()=>{document.hidden?(lr(),m()):(si(1),d())};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u),lr(),m()}}catch{}},[]);const i=a.flatMap(o=>{var c;return(((c=o.rankData)==null?void 0:c.pendingCelebrations)||[]).map((l,d)=>({...l,heroId:o.id,celebrationIndex:d}))}),n=o=>{const c=i[o];c&&s(c.heroId,c.celebrationIndex)};return e.jsxs(e.Fragment,{children:[i.length>0&&e.jsx(Hd,{celebrations:i,onCelebrationViewed:n}),e.jsx(Wn,{children:e.jsxs(He,{path:"/",element:e.jsx(Tl,{}),children:[e.jsx(He,{index:!0,element:e.jsx(Pi,{})}),e.jsx(He,{path:"journey",element:e.jsx(Pi,{})}),e.jsx(He,{path:"intro",element:e.jsx(vm,{})}),e.jsx(He,{path:"create",element:e.jsx(wi,{})}),e.jsx(He,{path:"heroes/new",element:e.jsx(wi,{})}),e.jsx(He,{path:"gallery",element:e.jsx(zl,{})}),e.jsx(He,{path:"hero/:id",element:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"p-6",children:"Carregando herÃ³iâ€¦"}),children:e.jsx(Xm,{})})}),e.jsx(He,{path:"progression",element:e.jsx(Zm,{})}),e.jsx(He,{path:"evolution",element:e.jsx(au,{})}),e.jsx(He,{path:"guild",element:e.jsx(eu,{})}),e.jsx(He,{path:"guild-hub",element:e.jsx(Cd,{})}),e.jsx(He,{path:"missions",element:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"p-6",children:"Carregando..."}),children:e.jsx(Km,{})})}),e.jsx(He,{path:"dungeon-20",element:e.jsx($i,{})}),e.jsx(He,{path:"dungeon-infinita",element:e.jsx($i,{})}),e.jsx(He,{path:"hunting",element:e.jsx(ou,{})}),e.jsx(He,{path:"quests",element:e.jsx(cu,{})}),e.jsx(He,{path:"daily-goals",element:e.jsx(tu,{})}),e.jsx(He,{path:"events",element:e.jsx(Id,{})}),e.jsx(He,{path:"social-events",element:e.jsx(Fm,{})}),e.jsx(He,{path:"party-invites",element:e.jsx(zm,{})}),e.jsx(He,{path:"event/:id",element:e.jsx(Bm,{})}),e.jsx(He,{path:"organizer",element:e.jsx(Om,{})}),e.jsx(He,{path:"friends",element:e.jsx(Lm,{})}),e.jsx(He,{path:"notifications",element:e.jsx(Hm,{})}),e.jsx(He,{path:"events-history",element:e.jsx(Gm,{})}),e.jsx(He,{path:"metrics",element:e.jsx(Um,{})}),e.jsx(He,{path:"activities",element:e.jsx(Td,{})}),e.jsx(He,{path:"titles",element:e.jsx(Rd,{})}),e.jsx(He,{path:"leaderboards",element:e.jsx(In,{})}),e.jsx(He,{path:"ai-missions",element:e.jsx(su,{})}),e.jsx(He,{path:"ai-recommendations",element:e.jsx(ru,{})}),e.jsx(He,{path:"tavern",element:e.jsx(Pm,{})}),e.jsx(He,{path:"hero-journal",element:e.jsx(iu,{})}),e.jsx(He,{path:"quick-mission",element:e.jsx(nu,{})}),e.jsx(He,{path:"admin",element:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"p-6",children:"Carregando..."}),children:e.jsx(Ym,{})})}),e.jsx(He,{path:"shop",element:e.jsx(lu,{})}),e.jsx(He,{path:"premium-center",element:e.jsx(Di,{})}),e.jsx(He,{path:"premium",element:e.jsx(Di,{})}),e.jsxs(He,{path:"stable",element:e.jsx(uu,{}),children:[e.jsx(He,{index:!0,element:e.jsx(Ps,{to:"/stable/pets",replace:!0})}),e.jsx(He,{path:"pets",element:e.jsx(Er,{fallback:e.jsx("div",{className:"p-6 rounded bg-red-900/40 border border-red-700 text-red-200",children:"Falha ao carregar Mascotes"}),children:e.jsx(lm,{})})}),e.jsx(He,{path:"mounts",element:e.jsx(dm,{})})]}),e.jsx(He,{path:"inventory",element:e.jsx(mu,{})}),e.jsx(He,{path:"hero-forge",element:e.jsx(du,{})}),e.jsx(He,{path:"training",element:e.jsx(Mn,{})}),e.jsx(He,{path:"pets",element:e.jsx(Ps,{to:"/stable/pets",replace:!0})}),e.jsx(He,{path:"mounts",element:e.jsx(Ps,{to:"/stable/mounts",replace:!0})}),e.jsx(He,{path:"world-state-demo",element:e.jsx(Qd,{})})]})})]})}const gu=()=>window.location.hostname==="dilmax12.github.io"?"/HeroForgeNew":"/";Ws.createRoot(document.getElementById("root")).render(e.jsx(at.StrictMode,{children:e.jsx(Kn,{basename:gu(),future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(pu,{})})}));const xu=()=>{const a={}.VITE_GA_MEASUREMENT_ID;if(!a)return;const s=document.createElement("script");s.async=!0,s.src=`https://www.googletagmanager.com/gtag/js?id=${a}`,document.head.appendChild(s);const t=document.createElement("script");t.innerHTML=`window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js', new Date());gtag('config','${a}');`,document.head.appendChild(t)};xu(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});try{const a=ft(),s=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,r=!!(t&&t.saveData),i=t&&t.effectiveType?String(t.effectiveType):"unknown";a.updateSettings({reducedMotionEnabled:s,saveDataEnabled:r,networkEffectiveType:i}),a.updateSettings({autoInteractionEnabled:!0}),window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",n=>{try{ft().updateSettings({reducedMotionEnabled:!!n.matches})}catch{}}),t&&typeof t.addEventListener=="function"&&t.addEventListener("change",()=>{try{const n=navigator.connection;ft().updateSettings({saveDataEnabled:!!(n&&n.saveData),networkEffectiveType:n&&n.effectiveType?String(n.effectiveType):"unknown"})}catch{}})}catch{}export{Ms as A,Wd as B,je as C,Me as D,cn as E,Li as F,xs as G,$o as I,pn as L,Su as N,wr as P,Ee as S,wt as _,an as a,Qe as b,Nu as c,sa as d,We as e,Ze as f,tc as g,wu as h,Bt as i,kc as j,gl as k,Ac as l,et as m,xl as n,Pa as o,pt as p,yt as q,Si as r,Ke as s,_t as t,Z as u,xr as v,ut as w,Pn as x,ge as y,ht as z};
//# sourceMappingURL=index-324810f8.js.map
